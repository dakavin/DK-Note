---
æ–‡ç« æ ‡é¢˜: "[[10_å…¶ä»–æ“ä½œå¯¹è±¡ï¼ˆä¸é‡è¦ï¼ŒåŸºæœ¬ä¸è€ƒï¼‰]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  ä»‹ç»Redisä¸‰ç§ç‰¹æ®Šæ•°æ®ç±»å‹ï¼šBitmapsç”¨äºäºŒè¿›åˆ¶ä½æ“ä½œï¼ŒHyperLogLogç”¨äºåŸºæ•°ç»Ÿè®¡ï¼ŒGeospatialç”¨äºåœ°ç†ä½ç½®ç´¢å¼•ï¼Œæ¶µç›–åŸºæœ¬å‘½ä»¤å’Œåº”ç”¨åœºæ™¯ã€‚
tags:
- "Redis"
- "Bitmaps"
- "HyperLogLog"
- "Geospatial"
- "æ•°æ®ç±»å‹"
- "ä½æ“ä½œ"
- "åŸºæ•°ç»Ÿè®¡"
- "åœ°ç†ä½ç½®"
ç›¸å…³æ–‡ç« :
- "[[0_Cè¯­è¨€æçº²]]"
- "[[1_æŒä¹…åŒ–åŸºç¡€é¢è¯•é¢˜]]"
- "[[1_ç¼“å­˜åŸºç¡€é¢è¯•ä¸åˆ†æ]]"
- "[[1_JavaåŸºæœ¬æ•°æ®ç±»å‹]]"
- "[[1_Rediså†…å­˜é¢è¯•ä¸åˆ†æ]]"
æ–‡ç« åˆ†ç±»: "ğŸ—„ï¸ æ•°æ®åº“æŠ€æœ¯"
æ–‡ç« è·¯å¾„: "04-ğŸ—„ï¸ æ•°æ®åº“æŠ€æœ¯/02-ğŸ”´ Redis/03-ğŸ“ è®­ç»ƒè¥ç¬”è®°/2_Rediså¯¹è±¡/10_å…¶ä»–æ“ä½œå¯¹è±¡ï¼ˆä¸é‡è¦ï¼ŒåŸºæœ¬ä¸è€ƒï¼‰.md"
æ–‡ç« éš¾åº¦: åˆçº§ ğŸ’§
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­ åŸºç¡€çŸ¥è¯†
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2025-05-27 23:09:57
---

## 1 Bitmaps

`Bitmapæä¾›äºŒè¿›åˆ¶ä½æ“ä½œï¼Œå¯ä»¥è®¾ç½®ä½çš„å€¼ï¼Œå¯ä»¥è·å–ä½çš„å€¼`ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œä½ è¦å­˜å‚¨ä¸€ä¸ªunit8çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶æ”¯æŒæ›´æ”¹å®ƒçš„ä½ç½®ï¼Œæ¯”å¦‚åŸæ¥è¿™ä¸ªunit8æ˜¯1000 0000ï¼Œä½ æƒ³å°†å…¶æœ€åä¸€ä½æ”¹ä¸º1ï¼Œå˜æˆ 1000 0001 ï¼Œå°±å¯ä»¥ä½¿ç”¨Bitmapså¯¹è±¡ã€‚
### 1.1 åº”ç”¨åœºæ™¯

å‡è®¾æœ‰1000ä¸ªä¼ æ„Ÿå™¨ï¼Œéœ€è¦è®°å½•æ¯å°æ—¶è¿™1000ä¸ªä¼ æ„Ÿå™¨æ˜¯å¦æœ‰ä¸ŠæŠ¥ï¼Œå°±å¯ä»¥ç”¨Bitmapsã€‚

### 1.2 SETBIT

è¯­æ³•ï¼šSETBIT key offset value
åŠŸèƒ½ï¼šè®¾ç½®ä½å›¾å¯¹åº”ä½ç½®ä¸º1ï¼Œè¿”å›å€¼ä¸ºæ›´æ–°å‰çš„å€¼

```shell
127.0.0.1:6379> SETBIT data:2023-01-01-00:00 66 1
(integer) 0
```

### 1.3 GETBIT

è¯­æ³•ï¼šGETBIT key offset
åŠŸèƒ½ï¼šæŸ¥è¯¢ä½å›¾ï¼Œè¿”å›å¯¹åº”æ•°æ®

```shell
127.0.0.1:6379> GETBIT data:2023-01-01-00:00 66
(integer) 1
```

- What about server 456?
```shell
127.0.0.1:6379> GETBIT pings:2024-01-01-00:00 456
(integer) 0
```
## 2 HyperLogLog

### 2.1 ç®€ä»‹

Redisåœ¨ 2.8.9ç‰ˆæœ¬æ·»åŠ äº†HyperLogLogç»“æ„ã€‚

Redis HyperLogLogæ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLogçš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚

åœ¨Redisé‡Œé¢ï¼Œæ¯ä¸ªHyperLogLogé”®åªéœ€è¦èŠ±è´¹12KBå†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆå½¢æˆé²œæ˜å¯¹æ¯”ã€‚

ä½†æ˜¯ï¼Œå› ä¸ºHyperLogLogåªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå­˜å‚¨è¾“å…¥å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥HyperLogLogä¸èƒ½åƒé›†åˆé‚£æ ·ï¼Œè¿”å›è¾“å…¥çš„å„ä¸ªå…ƒç´ 

### 2.2 åŸºæœ¬æ“ä½œ

PFADDï¼Œå¢åŠ å…ƒç´ 

```shell
127.0.0.1:6379> PFADD members 123
(integer) 1
127.0.0.1:6379> PFADD members 500
(integer) 1
127.0.0.1:6379> PFADD members 12
(integer) 1
```

PFCOUNT

```shell
127.0.0.1:6379> PFCOUNT members
(integer) 3
```
## 3 Geospatial

### 3.1 ç®€ä»‹

åœ¨Redisçš„3.2ç‰ˆæœ¬ä¸­åŠ å…¥äº†åœ°ç†ç©ºé—´Geospatialçš„åŠŸèƒ½ï¼Œåœ¨ç‰¹å®šçš„åœ°ç†åº”ç”¨é‡Œèƒ½å‘æŒ¥ä½œç”¨ã€‚

Geospatialåœ¨å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯é‡Œä¸ä¼šç”¨åˆ°ï¼Œé¢è¯•ä¹Ÿæœºä¼šä¸ä¼šè€ƒåˆ°ï¼Œè¿™é‡Œä»‹ç»ä»…ä¸ºäº†çŸ¥è¯†å®Œæ•´æ€§ã€‚

### 3.2 åŸºæœ¬æ“ä½œ

GEOADDï¼šå¢åŠ ä¸€ä¸ªåœ°ç†ä½ç½®ç´¢å¼•

æ“ä½œä¾‹å­ï¼š
```shell
127.0.0.1:6379> GEOADD locations:ca -122.27652 37.805186 station:1
(integer) 1
127.0.0.1:6379> GEOADD locations:ca -122.2674526 37.8062344 station:2
(integer) 1
127.0.0.1:6379> GEOADD locations:ca -122.2469854 37.8104049 station:3
(integer) 1
```

GEOSEARCH è¿”å›åœ°ç†ä½ç½®ä¿¡æ¯
```shell
GEOSEARCH locations:ca FROMLONLAT -122.2612767 37.7936847 BYRADIUS 5 km WITHDIST
1)  1) "station:1"
	2) "1.8523"
2)  1) "station:2"
	2) "1.4979"
3)  1) "station:3"
	2) "2.2441"
```