---
æ–‡ç« æ ‡é¢˜: "[[11_å¯¹è±¡è¿‡æœŸæ—¶é—´]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  ä»‹ç»Redisè¿‡æœŸæ—¶é—´æœºåˆ¶ï¼ŒåŒ…æ‹¬è®¾ç½®æ–¹æ³•ï¼ˆSET EX/PXã€EXPIREå‘½ä»¤ï¼‰å’Œåˆ é™¤ç­–ç•¥ï¼ˆæƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤ï¼‰ï¼Œè¯¦ç»†åˆ†æäº†ä¸‰ç§åˆ é™¤ç­–ç•¥çš„ä¼˜ç¼ºç‚¹åŠRedisçš„å…·ä½“å®ç°æ–¹æ¡ˆã€‚
tags:
- "Redis"
- "è¿‡æœŸæ—¶é—´"
- "å†…å­˜ç®¡ç†"
- "ç¼“å­˜"
- "åˆ†å¸ƒå¼é”"
- "æƒ°æ€§åˆ é™¤"
- "å®šæœŸåˆ é™¤"
- "TTL"
ç›¸å…³æ–‡ç« :
- "[[5_åœºæ™¯åº”ç”¨é¢è¯•é¢˜]]"
- "[[1_ç¼“å­˜åŸºç¡€é¢è¯•ä¸åˆ†æ]]"
- "[[1_Rediså†…å­˜é¢è¯•ä¸åˆ†æ]]"
- "[[1_Stringé¢è¯•ä¸åˆ†æ]]"
- "[[3_SpringBootä¸­çš„æ—¥å¿—å’ŒRedisTemplate]]"
æ–‡ç« åˆ†ç±»: "ğŸ—„ï¸ æ•°æ®åº“æŠ€æœ¯"
æ–‡ç« è·¯å¾„: "04-ğŸ—„ï¸ æ•°æ®åº“æŠ€æœ¯/02-ğŸ”´ Redis/03-ğŸ“ è®­ç»ƒè¥ç¬”è®°/2_Rediså¯¹è±¡/11_å¯¹è±¡è¿‡æœŸæ—¶é—´.md"
æ–‡ç« éš¾åº¦: åˆçº§ ğŸ’§
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­ æ ¸å¿ƒèƒ½åŠ›
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2025-05-27 23:09:57
---

## 1 å¯¹è±¡è¿‡æœŸæ—¶é—´æ˜¯ä»€ä¹ˆ

Redisçš„è¿‡æœŸæ—¶é—´æ˜¯ç»™ä¸€ä¸ªKeyï¼ŒæŒ‡å®šä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œç­‰è¾¾åˆ°è¿™ä¸ªæ—¶é—´ï¼Œæ•°æ®å°±è¢«è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ï¼Œå¯ä»¥ç”±Redisè¿›è¡Œå›æ”¶ã€‚

## 2 ä¸ºä»€ä¹ˆè¦è¿‡æœŸæ—¶é—´

å¦‚æœä¸æ˜¯éœ€è¦å¸¸é©»çš„æ•°æ®ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥æœ‰æ•ˆåœ°èŠ‚çº¦å†…å­˜ã€‚

å¦å¤–ï¼Œæœ‰äº›åœºæ™¯åŠŸèƒ½ä¹Ÿéœ€è¦è¿‡æœŸæ—¶é—´æ”¯æŒï¼Œæ¯”å¦‚ç¼“å­˜ï¼Œå¦‚æœå­˜åœ¨æ—¶é—´è¿‡ä¹…ï¼Œå°±å¯èƒ½å¯¼è‡´å’Œæ•°æ®æºæ•°æ®å·®è·è¿‡å¤§ï¼Œè€Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ¸…é™¤ç¼“å­˜ä»¥ä¾¿åç»­å†æ¬¡åŠ è½½è¿›å»ã€‚

åˆæ¯”å¦‚åˆ†å¸ƒå¼é”ï¼Œå°±æ˜¯éœ€è¦ä¸€å®šæ—¶é—´ä¹‹åï¼Œæ•°æ®è‡ªåŠ¨æ¶ˆå¤±ï¼Œä»¥å®ç°æœ€å¤§å æ®æ—¶é—´çš„ç‰¹æ€§ã€‚

## 3 æ€ä¹ˆè®¾ç½®è¿‡æœŸæ—¶é—´

å¦‚æœæ˜¯ç®€å•çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¯­æ³•ï¼š

- `SET key value EX seconds`ï¼šè®¾ç½®å¤šå°‘ç§’ä¹‹åè¿‡æœŸ
- `SET key value PX milliseconds`ï¼šè®¾ç½®å¤šå°‘æ¯«ç§’ä¹‹åè¿‡æœŸ
- `TTL key`ï¼šæŸ¥çœ‹è¿˜æœ‰å¤šä¹…è¿‡æœŸ

```shell
127.0.0.1:6379> set tmpkey data ex 5
OK
127.0.0.1:6379> ttl tmpkey
(integer) 2
127.0.0.1:6379> get tmpkey
(nil)

127.0.0.1:6379> set tmpkey data px 5000
OK
127.0.0.1:6379> ttl tmpkey
(integer) 2
127.0.0.1:6379> get tmpkey
(nil)
```

æ›´é€šç”¨çš„è¿‡æœŸå‘½ä»¤æ˜¯EXPIREï¼Œå®ƒå¯ä»¥å¯¹æ‰€æœ‰æ•°æ®å¯¹è±¡è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ŒEXPIREä¹Ÿåˆ†ç§’å’Œæ¯«ç§’ï¼š

- `EXPIRE key seconds`ï¼šè®¾ç½®ä¸€ä¸ªkeyçš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºç§’
- `PEXPIRE key milliseconds`ï¼šè®¾ç½®ä¸€ä¸ªkeyçš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’

`è®¾ç½®è¿‡æœŸæ—¶é—´ä¹‹åä¼šæœ‰ä¸ªå­—å…¸ï¼Œä¸“é—¨è®°å½•è¿™äº›Keyå’Œè¿‡æœŸæ—¶é—´çš„å…³ç³»ï¼Œè¿™é‡Œä¸å±•å¼€è¯´ï¼Œåé¢åœ¨å°†Rediså†…å­˜çš„æ—¶å€™ä¼šè¯¦ç»†åˆ†æ`ã€‚

## 4 é”®è¿‡æœŸäº†å¤šä¹…åˆ é™¤

è¿‡æœŸä¹‹åçš„é”®å®é™…ä¸Š`ä¸æ˜¯ç«‹åˆ»åˆ é™¤çš„`ï¼Œä¸€èˆ¬è¿‡æœŸé”®æ¸…é™¤ç­–ç•¥æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯`å®šæ—¶åˆ é™¤`ã€`å®šæœŸåˆ é™¤`å’Œ`æƒ°æ€§åˆ é™¤`

å®šæ—¶åˆ é™¤ï¼š
- åœ¨è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´çš„åŒæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œè®©å®šæ—¶å™¨åœ¨é”®çš„è¿‡æœŸæ—¶é—´æ¥ä¸´æ—¶ï¼Œç«‹å³æ‰§è¡Œå¯¹é”®çš„åˆ é™¤æ“ä½œ
- å®šæ—¶åˆ é™¤å¯¹å†…å­˜æ¯”è¾ƒå‹å¥½ï¼Œä½†æ˜¯å¯¹CPUä¸å‹å¥½ï¼Œå¦‚æœæŸä¸ªæ—¶é—´æ®µæ¯”è¾ƒå¤šçš„Keyè¿‡æœŸï¼Œå¯èƒ½ä¼šå½±å“å‘½ä»¤å¤„ç†æ€§èƒ½

å®šæœŸåˆ é™¤ï¼š
- æ¯ä¸ªä¸€æ®µæ—¶é—´ï¼Œç¨‹åºå°±å¯¹æ•°æ®åº“è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œæ¯æ¬¡åˆ é™¤ä¸€éƒ¨åˆ†è¿‡æœŸé”®ï¼Œè¿™å±äºä¸€ç§æ¸è¿›å¼å…œåº•ç­–ç•¥

æƒ°æ€§åˆ é™¤ï¼š
- æŒ‡ä½¿ç”¨çš„æ—¶å€™ï¼Œå‘ç°Keyè¿‡æœŸäº†ï¼Œæ­¤æ—¶å†ç»§ç»­åˆ é™¤ï¼Œè¿™ä¸ªç­–ç•¥çš„æ€è·¯æ˜¯å¯¹åº”ç”¨è€Œè¨€ï¼Œåªè¦ä¸è®¿é—®ï¼Œè¿‡æœŸä¸è¿‡æœŸä¸šåŠ¡éƒ½æ— æ‰€è°“ï¼Œä½†æ˜¯è¿™æ ·çš„ ä»£ä»·å°±æ˜¯å¦‚æœæŸäº›keyä¸€ç›´ä¸æ¥è®¿é—®ï¼Œé‚£æœ¬è¯¥è¿‡æœŸçš„keyï¼Œå°±å˜æˆäº†å¸¸é©»keyã€‚
- è¿™ç§ç­–ç•¥å¯¹CPUæœ€å‹å¥½ï¼Œå¯¹å†…å­˜ä¸å¤ªå‹å¥½ã€‚


å®šæ—¶åˆ é™¤å®ç°èµ·æ¥æ²¡æœ‰æƒ³è±¡çš„å®¹æ˜“ï¼Œä¸»è¦è€ƒè™‘æ˜¯å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œæœ‰Keyé—æ¼äº†æ€ä¹ˆåŠï¼Œä»¥åŠå¦‚æœç¨‹åºé‡å¯ï¼ŒåŸæ¥çš„å®šæ—¶å™¨å°±éšé‡å¯æ¶ˆå¤±äº†ï¼Œé‚£å°±éœ€è¦å†å¯åŠ¨æ—¶å¯¹è¿‡æœŸé”®è¿›è¡Œä¸€äº›æ“ä½œï¼Œå¯èƒ½æ˜¯é‡å»ºå®šæ—¶å™¨ï¼Œè¿™äº›éƒ½æ˜¯é¢å¤–çš„å·¥ä½œï¼Œè€Œä¸”å¼•å…¥äº†å¤šä½™çš„å¤æ‚åº¦ã€‚

ä»å®é™…åŠŸèƒ½è€Œè¨€ï¼Œå…¶å®å¹¶ä¸éœ€è¦é‚£ä¹ˆå®æ—¶ï¼Œæ‰€ä»¥æƒ°æ€§åˆ é™¤æ˜¯å¯ä»¥è€ƒè™‘çš„ï¼Œä½†æ˜¯å‡ºäºåº”åˆ å°½åˆ çš„è€ƒè™‘ï¼Œè¦ä¿è¯æœ€ç»ˆæ²¡æœ‰æ¼ç½‘ä¹‹é±¼ï¼Œé‚£å°±éœ€è¦å‡è®¾å®šæœŸåˆ é™¤å¤šä¸ºå…œåº•ã€‚

æ‰€ä»¥`Redisè¿‡æœŸé‡‡ç”¨çš„æ˜¯æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤äºŒè€…ç»“åˆçš„æ–¹å¼`è¿›è¡Œåˆ é™¤çš„

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/eeb926de7ccc1c8c961ef1bcb882ba57.png)

æƒ°æ€§åˆ é™¤ä¸ç”¨å†å¤šè¯´ï¼ŒRedisæ¯æ¬¡è®¿é—®Keyå‰éƒ½ä¼šè¿›è¡Œæ£€æµ‹ï¼Œå¦‚å·²è¿‡æœŸå°±åˆ é™¤ã€‚

å®šæœŸåˆ é™¤å°±éœ€è¦å…³æ³¨ä¸¤ä¸ªé—®é¢˜ï¼š

1. å®šæœŸåˆ é™¤çš„é¢‘ç‡ï¼›
	- è¿™ä¸ªå…¶å®å–å†³äºRediså‘¨æœŸä»»åŠ¡çš„æ‰§è¡Œé¢‘ç‡ï¼Œå‘¨æœŸä»»åŠ¡é‡Œé¢ä¼šåšå…³é—­è¿‡æœŸå®¢æˆ·ç«¯ã€åˆ é™¤è¿‡æœŸKeyçš„ä¸€ç³»åˆ—ä»»åŠ¡ï¼Œå¯ä»¥ç”¨INFOæŸ¥çœ‹å‘¨æœŸä»»åŠ¡é¢‘ç‡
```shell
127.0.0.1:6379> info
# Server
redis_version:5.0.14.1
redis_git_sha1:ec77f72d
redis_git_dirty:0
redis_build_id:5627b8177c9289c
redis_mode:standalone
os:Windows
arch_bits:64
multiplexing_api:WinSock_IOCP
atomicvar_api:pthread-mutex
process_id:1472
run_id:506646579c2e883911a4282efc9d5b674c96cbf9
tcp_port:6379
uptime_in_seconds:618
uptime_in_days:0
hz:10
configured_hz:10
lru_clock:3293941
executable:g:\redis\redis-x64-5.0.14.1\redis-server.exe
config_file:
```

hzå°±æ˜¯é¢‘ç‡ï¼Œé»˜è®¤æ˜¯10ï¼Œä¹Ÿå°±æ˜¯æ¯ç§’è§¦å‘10æ¬¡å‘¨æœŸä»»åŠ¡

2. æ¯æ¬¡åˆ é™¤çš„æ•°é‡ã€‚
	- æ¯æ¬¡æ£€æµ‹çš„æ•°é‡æ˜¯å†™æ­»åœ¨ä»£ç é‡Œçš„ï¼Œæ¯æ¬¡20ä¸ªï¼Œä½†æ˜¯è¿™é‡Œè¿˜ä¼šæ£€æŸ¥è¿‡æœŸkeyæ•°é‡å æ¯”ï¼Œå¤§äº25%ï¼Œåˆ™å†æŠ½å–20ä¸ªæ¥æ£€æŸ¥ï¼Œé‡å¤æµç¨‹ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªå¾ªç¯
	- Redisä¸ºäº†ä¿è¯å®šæœŸåˆ é™¤ä¸ä¼šå‡ºç°å¾ªç¯è¿‡å»ï¼Œå¯¼è‡´çº¿ç¨‹å¡æ­»ç°è±¡ï¼Œä¸ºæ­¤å¢åŠ äº†å®šæœŸåˆ é™¤å¾ªç¯æµç¨‹çš„æ—¶é—´ä¸Šé™ï¼Œé»˜è®¤ä¸ä¼šè¶…è¿‡25msã€‚
```shell
#define ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP 20
/* Loopups per loop */
```

