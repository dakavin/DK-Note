---
æ–‡ç« æ ‡é¢˜: "[[1_Redisåœ¨å†…å­˜ä¸­æ˜¯æ€ä¹ˆå­˜å‚¨çš„]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  è¯¦ç»†ä»‹ç»Rediså†…å­˜å­˜å‚¨ç»“æ„ï¼Œä»redisDbæ•°æ®åº“ç»“æ„åˆ°dictå­—å…¸çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œä»¥åŠè¿‡æœŸé”®çš„å­˜å‚¨æœºåˆ¶ï¼Œæ­ç¤ºRedisåº•å±‚é”®å€¼å¯¹å­˜å‚¨åŸç†ã€‚
tags:
- "Redis"
- "å†…å­˜å­˜å‚¨"
- "æ•°æ®ç»“æ„"
- "dictå­—å…¸"
- "redisDb"
- "é”®å€¼å¯¹"
- "è¿‡æœŸé”®"
- "åº•å±‚åŸç†"
ç›¸å…³æ–‡ç« :
- "[[1_Rediså†…å­˜é¢è¯•ä¸åˆ†æ]]"
- "[[1_Stringé¢è¯•ä¸åˆ†æ]]"
- "[[2_Listé¢è¯•ä¸åˆ†æ]]"
- "[[2_Rediså•çº¿ç¨‹é¢è¯•ä¸åˆ†æ]]"
- "[[3_å‹ç¼©åˆ—è¡¨é¢è¯•ä¸åˆ†æ]]"
æ–‡ç« åˆ†ç±»: "ğŸ—„ï¸ æ•°æ®åº“æŠ€æœ¯"
æ–‡ç« è·¯å¾„: "04-ğŸ—„ï¸ æ•°æ®åº“æŠ€æœ¯/02-ğŸ”´ Redis/03-ğŸ“ è®­ç»ƒè¥ç¬”è®°/3_Redisæ˜¯æ€ä¹ˆè¿ä½œçš„/1_Redisåœ¨å†…å­˜ä¸­æ˜¯æ€ä¹ˆå­˜å‚¨çš„.md"
æ–‡ç« éš¾åº¦: ä¸­çº§ ğŸŒ³
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­ æ ¸å¿ƒèƒ½åŠ›
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2025-05-27 23:09:58
---

## 1 ä»‹ç»

Redisæ˜¯å†…å­˜å­˜å‚¨ï¼Œå‰é¢æœ‰æåˆ°ï¼Œæˆ‘ä»¬æ”¾åœ¨Redisçš„æ•°æ®ï¼Œéƒ½æ˜¯ä»¥é”®å€¼å¯¹å½¢å¼ï¼Œå­˜åœ¨å†…å­˜ï¼Œæœ¬æ¬¡æˆ‘ä»¬å°†æ·±å…¥å­¦ä¹ Redisçš„åº•å±‚ç»“æ„åˆ°åº•æ˜¯ä»€ä¹ˆæ ·å­

## 2 æ•°æ®åº“ç»“æ„

redisDbä»£è¡¨Redisæ•°æ®åº“ç»“æ„ï¼Œä¸Šä¸€ç« ï¼Œæˆ‘ä»¬è®²åˆ°çš„`å„ç§æ“ä½œå¯¹è±¡ï¼Œå°±æ˜¯å­˜å‚¨åœ¨dictæ•°æ®ç»“æ„é‡Œ`ï¼Œæœ¬èŠ‚åé¢çš„è®²è¿°ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šä»¥ä¸Šä¸€ç« èŠ‚çš„æ“ä½œå¯¹è±¡ä¸ºä¾‹æ¥è¿›è¡Œè®²è§£

```C
// from Redis 5.0.5

/*
Redis database representation. There are multiple databases identified by integers from 0 (the default database) up to the max configured database. The database number is the 'id' field in the structure.
*/
typedef struct redisDb{
	/* The keyspace for this DB */
	dict *dict;
	/* Timeout of keys with a timeout set */
	dict *expires;
	/* Keys with client waiting for dataï¼ˆBLPOPï¼‰ */
	dict *blocking_keys;
	/* Blocked keys that received a PUSH */
	dict *ready_keys;
	/* WATCHED keys for MULTI/EXEC CAS */
	dict *watched_keys;
	/* Database ID */
	int id;
	/* Average TTL, just for stats */
	long long avg_ttl;
	/* List of key names to attempt to defrag one by one ,gradual */
	list *defrag_later;
}redisDb;
```

è¿™é‡Œæˆ‘ä»¬`é‡ç‚¹å…³æ³¨dictç»“æ„ï¼Œå…¶ä»–å­—æ®µå¯ä»¥å…ˆå¿½ç•¥`ï¼Œå®ƒä»£è¡¨äº†æˆ‘ä»¬å­˜å‚¨çš„key-valueå­˜å‚¨ï¼Œæˆ‘ä»¬å¹³å¸¸æ·»åŠ æ•°æ®ï¼Œå°±æ˜¯å¾€dicté‡Œæ·»åŠ ã€‚å¯ä»¥çœ‹åˆ°ï¼Œdictå…¶å®å°±æ˜¯æˆ‘ä»¬å‰é¢ä»‹ç»çš„Hashå¯¹è±¡ç»“æ„ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/14f70e2cad9fc7f02127125aa68d8b1d.png)

ä¸‹å›¾å¯ä»¥æ›´å½¢è±¡çš„è¯´æ˜ï¼š`redisDbå³æ•°æ®åº“å¯¹è±¡ï¼ŒæŒ‡å‘äº†æ•°æ®å­—å…¸ï¼Œå­—å…¸é‡ŒåŒ…å«äº†æˆ‘ä»¬å¹³å¸¸å­˜å‚¨çš„k-væ•°æ®ï¼Œk æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ï¼Œvalueæ”¯æŒä»»æ„Rediså¯¹è±¡`ï¼Œè¿™äº›å¯¹è±¡å‰é¢æˆ‘ä»¬æœ‰æ·±å…¥ä»‹ç»è¿‡ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/bc4e493b10c07eb34236f5d20934a2fe.png)

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å¢åŠ ã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤çš„æ“ä½œï¼Œåˆ†åˆ«åœ¨å†…å­˜å­˜å‚¨æ˜¯ä½œç”¨çš„ä½“ç°ã€‚
## 3 æ·»åŠ æ•°æ®

å³å°†é”®å€¼å¯¹ï¼Œæ·»åŠ åˆ°dictç»“æ„å­—å…¸ä¸­å»ï¼ŒKeyå¿…é¡»æ˜¯Stringå¯¹è±¡ï¼ŒValueä¸ºä»»ä½•ç±»å‹çš„å¯¹è±¡éƒ½å¯ä»¥ã€‚

æ¯”å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨å‘½ä»¤ï¼š`SET hellomsg "hello mart"`ï¼Œé”®ç©ºé—´ä¼šå˜æˆå¦‚ä¸‹ç»“æ„
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/5fbda33063641c7ee52ab334af9aaaae.png)
## 4 æŸ¥è¯¢æ•°æ®

æ•°æ®æŸ¥è¯¢å¾ˆæ¸…æ™°ï¼Œåœ¨dictæ‰¾åˆ°å¯¹åº”çš„keyï¼Œå³å®Œæˆäº†æŸ¥è¯¢ã€‚

## 5 æ›´æ–°æ•°æ®

å¯¹å·²æœ‰çš„Keyå¯¹è±¡çš„ä»»ä½•å˜æ›´æ“ä½œï¼Œéƒ½æ˜¯æ›´æ–°ï¼Œæ¯”å¦‚é’ˆå¯¹Stringå¯¹è±¡èµ‹äºˆæ–°å€¼ï¼Œæ¯”å¦‚ç»™Listå¯¹è±¡å¢å‡å…ƒç´ ï¼›

ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨å‘½ä»¤ `RPUSH animals bird`ï¼ŒæˆåŠŸåå¾—åˆ°çš„ç»“æ„å¦‚ä¸‹ï¼š
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3414334f762e009d9793e305b027b780.png)
## 6 åˆ é™¤æ•°æ®

åˆ é™¤å³æŠŠKeyå’ŒValueéƒ½ä»dictç»“æ„é‡Œåˆ é™¤ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨åŸæœ‰åŸºç¡€ä¸Šï¼Œä½¿ç”¨å‘½ä»¤ï¼š`DEL scoredic`ï¼ŒæˆåŠŸä¹‹åçš„ç»“æ„ä¼šå¦‚ä¸‹ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/2149fd05dcbacd1e122adf3eedba13c7.png)
## 7 è¿‡æœŸé”®

è¿‡æœŸé”®æˆ‘ä»¬æœ‰ä»‹ç»è¿‡ï¼ŒRedisæ•°æ®éƒ½å¯ä»¥è®¾ç½®è¿‡æœŸé”®ï¼Œè¿™æ ·åˆ°äº†ä¸€å®šæ—¶é—´ï¼Œè¿™äº›å¯¹è±¡å°±ä¼šè‡ªåŠ¨è¿‡æœŸå¹¶å›æ”¶ã€‚é‚£ä¹ˆè¿‡æœŸé”®ï¼Œåˆæ˜¯å­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿ

æˆ‘ä»¬å†çœ‹ä¸€ä¸‹redisDbç»“æ„ï¼Œæ˜¯çš„ï¼Œè¿‡æœŸé”®æ˜¯å­˜åœ¨expireså­—å…¸ä¸Šã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/07b7487e7ce1a05af35ee9be8bdf03be.png)

å‡è®¾ä¸Šé¢ä¾‹å­çš„Keyï¼Œéƒ½è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆå…¶ç»“æ„å¦‚ä¸‹ï¼š
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/553ad5ecb0874fc9aaeb15544a244dda.png)

æ³¨æ„ï¼Œè¿™é‡Œçš„dictä¸­å’Œexpiresä¸­çš„Keyå¯¹è±¡ï¼Œ`å®é™…éƒ½æ˜¯å­˜å‚¨çš„Stringå¯¹è±¡çš„æŒ‡é’ˆ`ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯ä¼šé‡å¤å ç”¨å†…å®¹ï¼ŒRediså¯¹å†…å­˜çš„ä½¿ç”¨éƒ½æ˜¯å¾ˆçæƒœçš„ã€‚
## 8 æ€»ç»“

Redisæ ¸å¿ƒæ˜¯å­—å…¸å­˜å‚¨ï¼Œé‡Œé¢åŒ…å«äº†å„ç§key-valueçš„æ˜ å°„ã€‚

æˆ‘ä»¬æœ€å¸¸ç”¨çš„å¯¹è±¡æ“ä½œï¼Œå®é™…ä¹Ÿéƒ½æ˜¯åœ¨å­—å…¸æŸ¥æ‰¾ã€å­—å…¸æ›´æ–°