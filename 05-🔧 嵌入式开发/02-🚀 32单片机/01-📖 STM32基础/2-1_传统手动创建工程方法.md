---
æ–‡ç« æ ‡é¢˜: "[[2-1_ä¼ ç»Ÿæ‰‹åŠ¨åˆ›å»ºå·¥ç¨‹æ–¹æ³•]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  ä»‹ç»STM32 HALåº“å·¥ç¨‹çš„ä¼ ç»Ÿæ‰‹åŠ¨æ­å»ºæ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸‹è½½åº“æ–‡ä»¶ã€åˆ›å»ºæ–‡ä»¶å¤¹ç»“æ„ã€é…ç½®MDKå·¥ç¨‹ã€æ·»åŠ é©±åŠ¨æ–‡ä»¶å’Œå¤´æ–‡ä»¶è·¯å¾„ç­‰è¯¦ç»†æ­¥éª¤
tags:
- "STM32"
- "HALåº“"
- "MDK"
- "Keil"
- "å·¥ç¨‹æ­å»º"
- "åµŒå…¥å¼å¼€å‘"
- "å¾®æ§åˆ¶å™¨"
- "å¯åŠ¨æ–‡ä»¶"
ç›¸å…³æ–‡ç« :
- "[[3_ä¸åŒç¼–ç¨‹æ–¹å¼-å¯„å­˜å™¨ã€æ ‡å‡†åº“ã€HALåº“ã€LLåº“]]"
- "[[0_è¯¾ç¨‹å®Œæ•´å†…å®¹]]"
- "[[5_è®¾ç½®çƒ§å½•å‚æ•°ï¼Œçƒ§å½•å›ºä»¶]]"
- "[[7_GPIOè¾“å…¥æŒ‰é”®]]"
- "[[2-2_STM32CubeMXä»‹ç»]]"
æ–‡ç« åˆ†ç±»: "ğŸ”§ åµŒå…¥å¼å¼€å‘"
æ–‡ç« è·¯å¾„: "05-ğŸ”§ åµŒå…¥å¼å¼€å‘/02-ğŸš€ 32å•ç‰‡æœº/01-ğŸ“– STM32åŸºç¡€/2-1_ä¼ ç»Ÿæ‰‹åŠ¨åˆ›å»ºå·¥ç¨‹æ–¹æ³•.md"
æ–‡ç« éš¾åº¦: åˆçº§ ğŸ’§
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­ åŸºç¡€çŸ¥è¯†
åˆ›å»ºæ—¶é—´: 2025-02-10 02:26:34
ä¿®æ”¹æ—¶é—´: 2025-05-27 23:05:39
---

**ä¼ ç»Ÿæ‰‹åŠ¨åˆ›å»ºå·¥ç¨‹æ–¹æ³•éå¸¸ç¹çï¼Œç°é˜¶æ®µå·²ç»ä¸éœ€è¦ä½¿ç”¨ï¼Œäº†è§£å³å¯ï¼ï¼ï¼**

## 1 HALåº“å·¥ç¨‹æ‰‹å·¥æ­å»º

### 1.1 ä¸‹è½½ STM32 å¯¹åº”ç³»åˆ—çš„HALåº“æ”¯æŒåŒ…

#### 1.1.1 æ‰‹åŠ¨ä¸‹è½½åº“

https://www.st.com/zh/embedded-software/stm32cubef1.html
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/b43c78f4f921d578a5c58fdab18a6944.png)
#### 1.1.2 ä½¿ç”¨ STM32CubeMXå®‰è£…çš„æ”¯æŒåŒ…

STM32CubeMXå®‰è£…å®Œæˆåï¼Œåˆ›å»ºå·¥ç¨‹æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨å®‰è£…å¯¹åº”ç³»åˆ—çš„åº“ï¼Œå®‰è£…è·¯å¾„åœ¨Update Settingsçš„Firmware Repositoryä¸­
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/4eac6d486c6e03f2191a3cf8dfa3f194.png)

æœ€åæ‰€åœ¨çš„è·¯å¾„ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/7c5efceabf535cbb0b20c34322062ea4.png)

### 1.2 æ–°å»ºå·¥ç¨‹æ–‡ä»¶å¤¹

**æ–°å»ºæ–‡ä»¶å¤¹Templateï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹å†…æ–°å»ºCoreã€Driverã€MDK-ARMä¸‰ä¸ªå­æ–‡ä»¶å¤¹**
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/811f218b7bed0eaa24f98e09b9fe982e.png)

**Coreå†…éƒ¨æ–°å»ºIncå’ŒSrcä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾`è‡ªå·±ç¼–å†™çš„ç¨‹åºæ–‡ä»¶`å’Œ`STM32ç›¸å…³çš„å¤´æ–‡ä»¶ã€cæ–‡ä»¶`**
- Core/Inc
```CMake
HALåº“çš„â€œSTM32Cube_FW_F1_Vxxx\Projects\STM32F103RB-Nucleo\Templates\Incâ€ç›®å½•ä¸‹æ–‡ä»¶å¤åˆ¶åˆ°æœ¬æ–‡ä»¶å¤¹ä¸‹ï¼š
main.hï¼Œstm32f1xx_hal_conf.hï¼Œstm32f1xx_it.h
```

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/f7d44cf099520206051f489135912184.png)


- Core/Src
```CMake
HALåº“çš„â€œSTM32Cube_FW_F1_Vxxxx\Projects\STM32F103RB-Nucleo\Templates\Srcâ€ç›®å½•ä¸‹æ–‡ä»¶å¤åˆ¶åˆ°æœ¬æ–‡ä»¶å¤¹ä¸‹ï¼š
main.cï¼Œstm32f1xx_hal_msp.cï¼Œstm32f1xx_it.cï¼Œsystem_stm32f1xx.c
```

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/0e17502f22a946d8f487c45fbf1171a5.png)


**Driverså­˜æ”¾`HALåº“ç›¸å…³å¤–è®¾æ–‡ä»¶`**
```CMake
å¤åˆ¶ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶å¤¹åˆ°Driversä¸­ï¼Œå¯ä»¥å‹ç¼©åå†å¤åˆ¶
HALåº“çš„STM32Cube_FW_F1_Vxxxx\Drivers\CMSISæ–‡ä»¶å¤¹
HALåº“çš„STM32Cube_FW_F1_Vxxxx\Drivers\STM32F1xx_HAL_Driveræ–‡ä»¶å¤¹

STM32Cube_FW_F1_Vxxxx\Drivers\CMSIS
ARM Cortexå¾®æ§åˆ¶å™¨è½¯ä»¶æ¥å£æ ‡å‡†ã€‚
å®ƒåŒ…æ‹¬äº†DSPåº“ã€Cortex-Må†…æ ¸åŠå…¶è®¾å¤‡æ–‡ä»¶ã€å¾®æ§åˆ¶å™¨ä¸“ç”¨å¤´æ–‡ä»¶ã€å¯åŠ¨æ–‡ä»¶ä»¥åŠä¸“ç”¨ç³»ç»Ÿæ–‡ä»¶ã€‚

STM32Cube_FW_F1_Vxxxx\Drivers\BSP
è¿™é€šå¸¸åŒ…å«ä¸ç‰¹å®šå¼€å‘æ¿æˆ–ç¡¬ä»¶å¹³å°ç›¸å…³çš„é©±åŠ¨ç¨‹åºå’Œé…ç½®ã€‚

STM32Cube_FW_F1_Vxxxx\Drivers\STM32F1xx_HAL_Driver
æ–‡ä»¶åŒ…å«äº†ä¸STM32F1ç³»åˆ—å¾®æ§åˆ¶å™¨çš„å„ç§å¤–è®¾ï¼ˆå¦‚GPIOã€UARTã€SPIã€I2Cç­‰ï¼‰ç›¸å…³çš„é©±åŠ¨ç¨‹åºã€‚è¿™äº›é©±åŠ¨ç¨‹åºé€šå¸¸ä»¥æºæ–‡ä»¶å’Œå¤´æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œå¹¶æä¾›äº†ç”¨äºæ§åˆ¶å’Œç®¡ç†è¿™äº›å¤–è®¾çš„APIï¼ˆåº”ç”¨ç¨‹åºæ¥å£ï¼‰ã€‚ä¾‹å¦‚ï¼Œstm32f10x_gpio.cå’Œstm32f10x_gpio.hæ–‡ä»¶åˆ†åˆ«åŒ…å«äº†GPIOå¯„å­˜å™¨çš„æ“ä½œå‡½æ•°å’Œç›¸å…³çš„å®å®šä¹‰ã€‚
```

å†…éƒ¨ä¸€äº›ï¼Œdocsçš„æ— å…³æ–‡æ¡£å¯ä»¥åˆ é™¤

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/1ef7f01c021a31b83336caf545da7762.png)


**MDK-ARMå­˜æ”¾`MDKå·¥ç¨‹ç›¸å…³æ–‡ä»¶`**
```CMake
MDKå·¥ç¨‹æ–‡ä»¶
```
### 1.3 æ–°å»ºMDKå·¥ç¨‹

**æ‰“å¼€Keil-MDKï¼Œæ–°å»ºå·¥ç¨‹(Project-new uVersion Project)ï¼Œä¿å­˜åœ¨â€œTemplate\MDK-ARMâ€ç›®å½•ä¸‹ï¼Œå·¥ç¨‹åç§°å¯ä»¥æ ¹æ®è‡ªå·±çš„é¡¹ç›®å‘½åã€‚**
- ç„¶åæ ¹æ®é¡¹ç›®ä½¿ç”¨çš„CPUå…·ä½“å‹å·æ¥é€‰æ‹©é€‰æ‹©èŠ¯ç‰‡ï¼Œè¿™é‡Œä½¿ç”¨STM32F103RC
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/2ee06af9396d0792b2ad0590f35f5980.png)

**æ‰“å¼€Manage Project Itemsçª—å£ï¼Œè¿›è¡Œå¦‚ä¸‹è®¾ç½®**
- æ·»åŠ MDK-ARMã€Driverã€Core
  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/edc319b82d8ee8956cb7200afbe8849c.png)

**åœ¨Groups MDK-ARMä¸­ï¼Œæ·»åŠ å¯åŠ¨æ–‡ä»¶startup_stm32f103xe.s**
- æ‰“å¼€"`Template\Drivers\CMSIS\Device\ST\STM32F1xx\Source\Templates\arm`"ï¼Œæ·»åŠ `startup_stm32f103xe.s`

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/4e4d6d97d006d73c8548cb6991e54032.png)

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/edc319b82d8ee8956cb7200afbe8849c.png)


- è¿™é‡Œæ ¹æ®ä¸åŒèŠ¯ç‰‡å®¹é‡å¤§å°é€‰æ‹©ï¼ŒSTM32F103RCæ˜¯å¤§å®¹é‡ï¼ˆèŠ¯ç‰‡æ‰‹å†Œï¼‰ï¼Œæ‰€ä»¥é€‰æ‹©hdåç¼€çš„æ–‡ä»¶

```C
è¿™æ˜¯STæä¾›çš„4ä¸ªå¯åŠ¨æ–‡ä»¶ï¼Œåˆ†åˆ«é€‚ç”¨äºä¸åŒå®¹é‡çš„STM32èŠ¯ç‰‡ã€‚
è¿™4ä¸ªæ–‡ä»¶ä¸ºï¼š
startup_stm32f103x6.s
startup_stm32f103xb.s
startup_stm32f103xe.s
startup_stm32f103xg.s
å…¶ä¸­ï¼Œx6.sé€‚ç”¨äºå°å®¹é‡ äº§å“ï¼›xb.sé€‚ç”¨äºä¸­ç­‰å®¹é‡äº§å“ï¼›xeé€‚ç”¨äºå¤§å®¹é‡äº§å“ï¼›xgé€‚ç”¨äºè¶…å¤§å®¹é‡äº§å“
è¿™é‡Œçš„å®¹é‡æ˜¯æŒ‡FLASHçš„å¤§å°.åˆ¤æ–­æ–¹æ³•å¦‚ä¸‹ï¼š
å°å®¹é‡ï¼š16K<=FLASHâ‰¤32K
ä¸­å®¹é‡ï¼š64Kâ‰¤FLASHâ‰¤128K
å¤§å®¹é‡ï¼š256Kâ‰¤FLASH<=512k
è¶…å¤§å®¹é‡ï¼š768Kâ‰¤FLASH<=1024K

startup_stm32f103xe.sæ˜¯é’ˆå¯¹STMicroelectronicsçš„STM32F103ç³»åˆ—å¾®æ§åˆ¶å™¨çš„å¯åŠ¨ä»£ç ã€‚
å®ƒæ˜¯ä¸€ä¸ªæ±‡ç¼–è¯­è¨€æ–‡ä»¶ï¼ŒåŒ…å«äº†å¤„ç†å™¨çš„åˆå§‹åŒ–å’Œå¯åŠ¨ä»£ç ï¼Œä»¥åŠä¸€äº›ä¸­æ–­å¤„ç†ç¨‹åºã€‚
å½“ç³»ç»Ÿä¸Šç”µæˆ–å¤ä½æ—¶ï¼Œå¤„ç†å™¨ä¼šé¦–å…ˆæ‰§è¡Œè¯¥æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæ­£ç¡®åœ°å¯åŠ¨ã€‚
```

**åœ¨Groups Driversä¸­ï¼Œæ·»åŠ Template\Drivers\STM32F1xx_HAL_Driver\Srcä¸­éœ€è¦ç”¨åˆ°çš„å¤–è®¾.cæ–‡ä»¶ï¼Œç”¨åˆ°ä»€ä¹ˆåŠ ä»€ä¹ˆï¼Œè¿™éƒ¨åˆ†æ–‡ä»¶æ˜¯STM32 HALåº“çš„å¤–è®¾é©±åŠ¨æ–‡ä»¶ã€‚**
- æ— éœ€å…¨éƒ¨æ·»åŠ ï¼ˆæ ¹æ®éœ€è¦çš„halåº“è¿›è¡Œæ·»åŠ å³å¯ï¼‰ï¼Œå› ä¸ºæœ‰ä¸€éƒ¨åˆ†æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œæ·»åŠ äº†ä¼šæŠ¥é‡å®šä¹‰é”™è¯¯

  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/2dadb0e4f636450ed87564eccfb4f83c.png)
  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/4dc910d1382a1062f5a43533c0b95215.png)
**åœ¨Groups Coreä¸­ï¼Œæ·»åŠ Template\Core\Srcä¸‹`æ‰€æœ‰`.cæ–‡ä»¶**
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/c2cad0a253e3e4e986f3b28ffbec7388.png)

```CMake
å…¶ä¸­
main.c
æ˜¯ç¨‹åºå…¥å£ã€‚

stm32f1xx_hal_msp.c
MSP(MCU support package)ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¿›è¡Œ MCU çº§åˆ«çš„ç¡¬ä»¶åˆå§‹åŒ–è®¾ç½®ã€‚

stm32f1xx_it.c
ä¸­æ–­ç›¸å…³å¤„ç†å‡½æ•°ã€‚

system_stm32f1xx.c
ç”¨äºå¯åŠ¨å’Œåˆå§‹åŒ–STM32F1xxç³»åˆ—å¾®æ§åˆ¶å™¨ï¼Œåˆå§‹åŒ–ç³»ç»Ÿæ—¶é’Ÿã€ç³»ç»Ÿæ—¶åŸºå’Œå…¶ä»–å¤–è®¾ã€‚å®ƒåŒ…å«äº†ä¸€äº›é‡è¦çš„å‡½æ•°ï¼Œä¾‹å¦‚SystemInit()ã€SystemCoreClockUpdate()å’ŒSysTick_Config()ç­‰ã€‚
```

**æ·»åŠ å®**
- `USE_HAL_DRIVER å®`ï¼šä¸ºäº†è®© stm32f1xx.h åŒ…å« stm32f1xx_hal_conf.h è¿™ä¸ªå¤´æ–‡ä»¶
- `STM32F103xEå®`ï¼šä¸ºäº†å‘Šè¯‰ STM32HAL åº“ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„èŠ¯ç‰‡ç±»å‹æ˜¯ STM32 å‹å·æ˜¯å¤§å®¹é‡çš„ï¼Œä½¿ STM32HAL åº“æ ¹æ®æˆ‘ä»¬é€‰å®šçš„èŠ¯ç‰‡å‹å·æ¥é…ç½®

  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/325b40ebac9d3fd5e4464c027ad99d89.png)

```CMake
USE_HAL_DRIVER,STM32F103xE
```

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/25fd106080d2c850d3eac98abbd7d537.png)

**æ·»åŠ å¤´æ–‡ä»¶è·¯å¾„**
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/62a56b59b8c7903a7f844ca07c36b798.png)

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/1f932fa753453d3c3a394b0bcb6b1804.png)

**è®¾ç½®C99æ ‡å‡†**
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/60c0fecc5181de4077af1f4556d3bb9a.png)

**åˆ é™¤main.hä¸­çš„â€œ#include "stm32f1xx_nucleo.h"â€ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¼•å…¥STå®˜æ–¹å¼€å‘æ¿å¥—ä»¶çš„ç›¸å…³ä»£ç **

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/02/92aa8997c6535f216bc8f26b3824d6e3.png)

æœ€åç¼–è¯‘å³å¯
