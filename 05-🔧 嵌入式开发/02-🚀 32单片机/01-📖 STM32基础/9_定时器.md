---
æ–‡ç« æ ‡é¢˜: "[[9_å®šæ—¶å™¨]]"
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  è¯¦ç»†ä»‹ç»STM32F1å®šæ—¶å™¨é…ç½®å’Œä½¿ç”¨ï¼ŒåŒ…æ‹¬åŸºæœ¬ã€é€šç”¨ã€é«˜çº§ä¸‰ç±»å®šæ—¶å™¨çš„åŠŸèƒ½ç‰¹ç‚¹ï¼Œé‡ç‚¹è®²è§£åŸºæœ¬å®šæ—¶å™¨TIM6çš„å‚æ•°é…ç½®ã€æ—¶é’Ÿè®¡ç®—å’Œä¸­æ–­å¤„ç†å®ç°æ–¹æ³•
tags:
  - STM32F1
  - å®šæ—¶å™¨
  - TIM6
  - ä¸­æ–­é…ç½®
  - æ—¶é’Ÿåˆ†é¢‘
  - CubeMX
  - HALåº“
  - åµŒå…¥å¼
ç›¸å…³æ–‡ç« :
  - "[[../../../06-ğŸ§ Linuxç³»ç»Ÿ/07-ğŸš— Linuxé©±åŠ¨å¼€å‘æ ¸å¿ƒ(é‡è¦!!!)/05-ğŸš— Linuxé©±åŠ¨ç›¸å…³å­ç³»ç»Ÿ (é‡ç‚¹)/3_è®¾å¤‡æ ‘/06_ğŸ“•è®¾å¤‡æ ‘ä¸­æ–­çš„å±æ€§æè¿° (æœ€å¸¸ç”¨)]]"
  - "[[0_è¯¾ç¨‹å®Œæ•´å†…å®¹]]"
æ–‡ç« åˆ†ç±»: ğŸ”§ åµŒå…¥å¼å¼€å‘
æ–‡ç« è·¯å¾„: 05-ğŸ”§ åµŒå…¥å¼å¼€å‘/02-ğŸš€ 32å•ç‰‡æœº/01-ğŸ“– STM32åŸºç¡€/9_å®šæ—¶å™¨.md
æ–‡ç« éš¾åº¦: åˆçº§ ğŸ’§
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­ æ ¸å¿ƒèƒ½åŠ›
åˆ›å»ºæ—¶é—´: 2025-02-10 02:26:34
ä¿®æ”¹æ—¶é—´: 2025-05-27 23:05:39
---

**å¦‚æœéœ€è¦ç›´æ¥ä½¿ç”¨ï¼Œç›´æ¥çœ‹ç¬¬3éƒ¨åˆ†å³å¯**
## 1 å®šä¹‰

SMT32F1å…±æœ‰8ä¸ªå®šæ—¶å™¨ï¼š
- åŸºæœ¬å®šæ—¶å™¨ï¼ˆTIM6ã€TIM7ï¼‰
- é€šç”¨å®šæ—¶å™¨ï¼ˆTIM2ã€TIM3ã€TIM4ã€TIM5ï¼‰
- é«˜çº§å®šæ—¶å™¨ï¼ˆTIM1ã€TIM8ï¼‰
### 1.1 é«˜çº§å®šæ—¶å™¨çš„ä¸»è¦åŠŸèƒ½

**TIM1å’ŒTIM8çš„åŠŸèƒ½åŒ…æ‹¬ï¼š**
- 16ä½å‘ä¸Šã€å‘ä¸‹ã€å‘ä¸Š/ä¸‹è‡ªåŠ¨è£…è½½è®¡æ•°å™¨
- 16ä½å¯ç¼–ç¨‹(å¯ä»¥å®æ—¶ä¿®æ”¹)é¢„åˆ†é¢‘å™¨ï¼Œè®¡æ•°å™¨æ—¶é’Ÿé¢‘ç‡çš„åˆ†é¢‘ç³»æ•°ä¸º1ï½65535ä¹‹é—´çš„ä»»æ„æ•°å€¼
- å¤šè¾¾4ä¸ªç‹¬ç«‹é€šé“ï¼š
	- è¾“å…¥æ•è·
	- è¾“å‡ºæ¯”è¾ƒ
	- PWMç”Ÿæˆï¼ˆè¾¹ç¼˜æˆ–ä¹‹é—´å¯¹é½æ¨¡å¼ï¼‰
	- å•è„‰å†²æ¨¡å¼è¾“å‡º
- æ­»åŒºæ—¶é—´å¯ç¼–ç¨‹çš„äº’è¡¥è¾“å‡º
- ä½¿ç”¨å¤–éƒ¨ä¿¡å·æ§åˆ¶å®šæ—¶å™¨å’Œå®šæ—¶å™¨äº’è”çš„åŒæ­¥ç”µè·¯
- å…è®¸åœ¨æŒ‡å®šæ•°ç›®çš„è®¡æ•°å™¨å‘¨æœŸä¹‹åæ›´æ–°å®šæ—¶å™¨å¯„å­˜å™¨çš„é‡å¤è®¡æ•°å™¨
- åˆ¹è½¦è¾“å…¥ä¿¡å·å¯ä»¥å°†å®šæ—¶å™¨è¾“å‡ºä¿¡å·ç½®äºå¤ä½çŠ¶æ€æˆ–è€…ä¸€ä¸ªå·²çŸ¥çŠ¶æ€
- å¦‚ä¸‹äº‹ä»¶å‘ç”Ÿæ—¶äº§ç”Ÿä¸­æ–­/DMA:
	- æ›´æ–°ï¼šè®¡æ•°å™¨å‘ä¸Šæº¢å‡º/å‘ä¸‹æº¢å‡ºï¼Œè®¡æ•°å™¨åˆå§‹åŒ–(é€šè¿‡è½¯ä»¶æˆ–è€…å†…éƒ¨/å¤–éƒ¨è§¦å‘)
	- è§¦å‘äº‹ä»¶(è®¡æ•°å™¨å¯åŠ¨ã€åœæ­¢ã€åˆå§‹åŒ–æˆ–è€…ç”±å†…éƒ¨/å¤–éƒ¨è§¦å‘è®¡æ•°)
	- è¾“å…¥æ•è·
	- è¾“å‡ºæ¯”è¾ƒ
	- åˆ¹è½¦ä¿¡å·è¾“å…¥
- æ”¯æŒé’ˆå¯¹å®šä½çš„å¢é‡(æ­£äº¤)ç¼–ç å™¨å’Œéœå°”ä¼ æ„Ÿå™¨ç”µè·¯
- è§¦å‘è¾“å…¥ä½œä¸ºå¤–éƒ¨æ—¶é’Ÿæˆ–è€…æŒ‰å‘¨æœŸçš„ç”µæµç®¡ç†

**é«˜çº§å®šæ—¶å™¨æ¡†å›¾**

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/47239cdffde1e72b52d5fe17eabcb93e.png)

### 1.2 é€šç”¨å®šæ—¶å™¨çš„ä¸»è¦åŠŸèƒ½

**é€šç”¨TIMxï¼ˆTIM2ã€TIM3ã€TIM4å’ŒTIM5)å®šæ—¶å™¨åŠŸèƒ½åŒ…æ‹¬ï¼š**
- 16ä½å‘ä¸Šã€å‘ä¸‹ã€å‘ä¸Š/å‘ä¸‹è‡ªåŠ¨è£…è½½è®¡æ•°å™¨
- 16ä½å¯ç¼–ç¨‹(å¯ä»¥å®æ—¶ä¿®æ”¹)é¢„åˆ†é¢‘å™¨ï¼Œè®¡æ•°å™¨æ—¶é’Ÿé¢‘ç‡çš„åˆ†é¢‘ç³»æ•°ä¸º1ï½65536ä¹‹é—´çš„ä»»æ„æ•°å€¼
- 4ä¸ªç‹¬ç«‹é€šé“ï¼š
	- è¾“å…¥æ•è·
	- è¾“å‡ºæ¯”è¾ƒ
	- PWMç”Ÿæˆ(è¾¹ç¼˜æˆ–ä¸­é—´å¯¹é½æ¨¡å¼)
	- å•è„‰å†²æ¨¡å¼è¾“å‡º
- ä½¿ç”¨å¤–éƒ¨ä¿¡å·æ§åˆ¶å®šæ—¶å™¨å’Œå®šæ—¶å™¨äº’è¿çš„åŒæ­¥ç”µè·¯
- å¦‚ä¸‹äº‹ä»¶å‘ç”Ÿæ—¶äº§ç”Ÿä¸­æ–­/DMAï¼š
	- æ›´æ–°ï¼šè®¡æ•°å™¨å‘ä¸Šæº¢å‡º/å‘ä¸‹æº¢å‡ºï¼Œè®¡æ•°å™¨åˆå§‹åŒ–(é€šè¿‡è½¯ä»¶æˆ–è€…å†…éƒ¨/å¤–éƒ¨è§¦å‘)
	- è§¦å‘äº‹ä»¶(è®¡æ•°å™¨å¯åŠ¨ã€åœæ­¢ã€åˆå§‹åŒ–æˆ–è€…ç”±å†…éƒ¨/å¤–éƒ¨è§¦å‘è®¡æ•°)
	- è¾“å…¥æ•è·
	- è¾“å‡ºæ¯”è¾ƒ
- æ”¯æŒé’ˆå¯¹å®šä½çš„å¢é‡(æ­£äº¤)ç¼–ç å™¨å’Œéœå°”ä¼ æ„Ÿå™¨ç”µè·¯
- è§¦å‘è¾“å…¥ä½œä¸ºå¤–éƒ¨æ—¶é’Ÿæˆ–è€…æŒ‰å‘¨æœŸçš„ç”µæµç®¡ç†

**é€šç”¨å®šæ—¶å™¨æ¡†å›¾**

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/b68d5598b57ec73976813aeba35328f5.png)

### 1.3 åŸºæœ¬å®šæ—¶å™¨çš„ä¸»è¦åŠŸèƒ½

**TIM6å’ŒTIM7å®šæ—¶å™¨çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š**
- 16ä½è‡ªåŠ¨é‡è£…è½½ç´¯åŠ è®¡æ•°å™¨
- 16ä½å¯ç¼–ç¨‹(å¯å®æ—¶ä¿®æ”¹)é¢„åˆ†é¢‘å™¨ï¼Œç”¨äºå¯¹è¾“å…¥çš„æ—¶é’ŸæŒ‰ç³»æ•°ä¸º1ï½65536ä¹‹é—´çš„ä»»æ„æ•°å€¼
åˆ†é¢‘
- è§¦å‘DACçš„åŒæ­¥ç”µè·¯
- åœ¨æ›´æ–°äº‹ä»¶(è®¡æ•°å™¨æº¢å‡º)æ—¶äº§ç”Ÿä¸­æ–­/DMAè¯·æ±‚

**åŸºæœ¬å®šæ—¶å™¨æ¡†å›¾**

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/5422acbe48691cdf520e3875a2915658.png)

æ¡†å›¾è¯´æ˜ï¼šåŸºç¡€å®šæ—¶å™¨åªæœ‰å®šæ—¶åŠŸèƒ½ï¼Œå®šæ—¶çš„å·¥ä½œæµç¨‹å¦‚ä¸‹
- æ§åˆ¶å™¨é™¤äº†æ§åˆ¶å®šæ—¶å™¨å¤ä½ã€ä½¿èƒ½ã€è®¡æ•°ç­‰åŠŸèƒ½ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨äºè§¦å‘DACè½¬æ¢
- `å†…éƒ¨æ—¶é’Ÿä¿¡å·CK_INT`ç»è¿‡**æ§åˆ¶å™¨**åç§°ä¸º`CK_PSC`è¿›å…¥**é¢„åˆ†é¢‘å™¨**ï¼ŒCK_INTå’ŒCK_PSCåœ¨é¢‘ç‡ä¸Šç›¸ç­‰
- é¢„åˆ†é¢‘å™¨å¯¹`CK_PSC`æ—¶é’Ÿä¿¡å·è¿›è¡Œ**åˆ†é¢‘**ï¼Œè¾“å‡º`CK_CNT`æ˜¯åˆ†é¢‘åçš„æ—¶é’Ÿ
- è®¡æ•°å™¨å¯¹æ—¶é’Ÿä¿¡å·CK_CNTä»0è®¡æ•°ï¼Œè‡ªåŠ¨é‡è£…è½½å¯„å­˜å™¨å­˜å‚¨ä¸€ä¸ªå€¼ã€‚å½“è®¡æ•°å™¨çš„å€¼è¾¾åˆ°è¯¥å€¼æ—¶å°±äº§ç”ŸUäº‹ä»¶ï¼Œç„¶åè®¡æ•°å™¨å½’é›¶é‡æ–°å¼€å§‹è®¡æ•°
- å¼€å¯å®šæ—¶å™¨å…¨å±€ä¸­æ–­å’ŒUäº‹ä»¶ä¸­æ–­åï¼Œè®¡æ•°æº¢å‡ºæ—¶äº§ç”ŸUäº‹ä»¶ä¸­æ–­ï¼Œåˆ©ç”¨ä¸­æ–­è¿›è¡Œå®šæ—¶å¤„ç†

åŸºæœ¬å®šæ—¶å™¨çš„è¾“å‡ºï¼Œæœ‰3ç§
- åŸºäºç³»ç»Ÿçš„å†…éƒ¨æ—¶é’Ÿï¼ˆAPB1ï¼‰ï¼Œé€šè¿‡è§¦å‘æ§åˆ¶å™¨ï¼Œè¾“å‡ºåˆ°DAC
- åŸºäºåˆ†é¢‘åçš„æ—¶é’Ÿï¼Œåœ¨è®¡æ•°å®Œæˆä¹‹åï¼Œè§¦å‘2ç§è¾“å‡º
	- äº‹ä»¶
	- ä¸­æ–­å’ŒDMAè¾“å‡º

### 1.4 å¯¹æ¯”

|       |     |            |         |      |                                                |
| ----- | --- | ---------- | ------- | ---- | ---------------------------------------------- |
| å®šæ—¶å™¨ç§ç±» | ä½æ•°  | è®¡æ•°å™¨æ¨¡å¼      | æ•è·/æ¯”è¾ƒé€šé“ | äº’è¡¥è¾“å‡º | ç‰¹æ®Šåº”ç”¨åœºæ™¯                                         |
| é«˜çº§å®šæ—¶å™¨ | 16  | å‘ä¸Šï¼Œå‘ä¸‹ï¼Œä¸­å¿ƒå¯¹é½ | 4       | æœ‰    | å®šæ—¶è®¡æ•°ï¼ŒDAC/ADCæ—¶é’Ÿã€PWMè¾“å‡ºï¼Œè¾“å…¥æ•è·ï¼Œè¾“å‡ºæ¯”è¾ƒï¼Œ**å¸¦å¯ç¼–ç¨‹æ­»åŒºçš„äº’è¡¥è¾“å‡º** |
| é€šç”¨å®šæ—¶å™¨ | 16  | å‘ä¸Šï¼Œå‘ä¸‹ï¼Œä¸­å¿ƒå¯¹é½ | 4       | æ—     | å®šæ—¶è®¡æ•°ï¼ŒDAC/ADCæ—¶é’Ÿã€**PWMè¾“å‡º**ï¼Œ**è¾“å…¥æ•è·**ï¼Œ**è¾“å‡ºæ¯”è¾ƒ**     |
| åŸºæœ¬å®šæ—¶å™¨ | 16  | å‘ä¸Š         | 0       | æ—     | å®šæ—¶è®¡æ•°ï¼ŒDACæ—¶é’Ÿ                                     |
## 2 é…ç½®å®šæ—¶å™¨çš„å‚æ•°

è™½ç„¶æœ‰3ç±»å®šæ—¶å™¨ï¼Œä¸è¿‡åªè¦æ˜¯é…ç½®ä½œä¸ºå®šæ—¶å™¨ï¼Œä¾¿æ€»æ˜¯ä¸åŸºæœ¬å®šæ—¶å™¨æ˜¯ç±»ä¼¼çš„

åœ¨ä¸‹æ–‡é…ç½®çš„æ—¶å€™è¦æ³¨æ„ï¼š**é…ç½®çš„æ˜¯è¿›å…¥å®šæ—¶å™¨ä¸­æ–­çš„é¢‘ç‡ï¼Œç„¶åè¦å®šçš„æ—¶é—´è¦æ ¹æ®è¿™ä¸ªé¢‘ç‡æ¥å®šæ—¶**

`Prescaler(PSC)`ï¼š å®šæ—¶å™¨é¢„åˆ†é¢‘è®¾ç½®ï¼Œ16ä½ï¼Œè®¾ç½® 0~65535 ä»¥è¾¾åˆ° 1 è‡³ 65536 çš„åˆ†é¢‘

`Counter Mode` : å®šæ—¶å™¨çš„è®¡æ•°æ–¹å¼ï¼ŒåŸºæœ¬å®šæ—¶å™¨åªèƒ½å‘ä¸Š(UP)è®¡æ•°

> **å®šæ—¶å™¨æœ‰3ç§è®¡æ•°æ¨¡å¼**
> - é€’å¢è®¡æ•°æ¨¡å¼ï¼šè®¡æ•°å™¨`ä» 0 è®¡æ•°åˆ°è‡ªåŠ¨é‡è½½å€¼`ï¼Œç„¶åé‡æ–°ä» 0 å¼€å§‹è®¡æ•°å¹¶ç”Ÿæˆè®¡æ•°å™¨ä¸Šæº¢äº‹ä»¶
> - é€’å‡è®¡æ•°æ¨¡å¼ï¼šè®¡æ•°å™¨`ä»è‡ªåŠ¨é‡è½½å€¼å¼€å§‹é€’å‡åˆ° 0`ï¼Œç„¶åé‡æ–°ä»è‡ªåŠ¨é‡è½½å€¼å¼€å§‹è®¡æ•°å¹¶ç”Ÿæˆè®¡æ•°å™¨ä¸‹æº¢äº‹ä»¶
> - ä¸­å¿ƒå¯¹é½æ¨¡å¼ï¼šä¹Ÿå« å‘ä¸Šå‘ä¸‹è®¡æ•°ï¼Œè®¡æ•°å™¨`ä» 0 å¼€å§‹è®¡æ•°åˆ°è‡ªåŠ¨é‡è½½å€¼â€“1` ï¼Œç”Ÿæˆè®¡æ•°å™¨ä¸Šæº¢äº‹ä»¶ï¼›ç„¶å`ä»è‡ªåŠ¨é‡è½½å€¼å¼€å§‹å‘ä¸‹è®¡æ•°åˆ° 1` å¹¶ç”Ÿæˆè®¡æ•°å™¨ä¸‹æº¢äº‹ä»¶ã€‚ä¹‹åä»0 å¼€å§‹é‡æ–°è®¡æ•°
> ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/cc2efb30cf4f6c69fa755189ff012c85.png)

`Counter Period`ï¼šå®šæ—¶å™¨å‘¨æœŸï¼Œ16ä½ï¼Œè®¾ç½® 0~65535 ä»¥è¾¾åˆ° 1 è‡³ 65536 çš„å‘¨æœŸã€‚æ¯å½“å®šæ—¶å™¨è¾¾åˆ° è®¾å®šå€¼æ—¶ï¼Œç½®ä½

`InternalCLock Division(CKD)`ï¼š å†…éƒ¨æ—¶é’Ÿåˆ†é¢‘å› å­ï¼ŒæŒ‡è®¾ç½®å®šæ—¶å™¨æ—¶é’Ÿé¢‘ç‡ä¸æ•°å­—æ»¤æ³¢å™¨ä½¿ç”¨çš„é‡‡æ ·é¢‘ç‡ä¹‹é—´çš„åˆ†é¢‘æ¯”ä¾‹çš„ï¼ˆä¸è¾“å…¥æ•è·ç›¸å…³ï¼‰

`Auto-reload preload` ï¼šè‡ªåŠ¨é‡è½½ã€‚ä¸€èˆ¬æ¯æ¬¡è§¦å‘ä»¥åéœ€è¦é‡æ–°å¡«å……
- `Disable`ï¼šè‡ªåŠ¨é‡è£…è½½å¯„å­˜å™¨å†™å…¥æ–°å€¼åï¼Œè®¡æ•°å™¨ç«‹å³äº§ç”Ÿè®¡æ•°æº¢å‡ºï¼Œç„¶åå¼€å§‹æ–°çš„è®¡æ•°å‘¨æœŸ
- `Enable`ï¼šè‡ªåŠ¨é‡è£…è½½å¯„å­˜å™¨å†™å…¥æ–°å€¼åï¼Œè®¡æ•°å™¨å®Œæˆå½“å‰æ—§çš„è®¡æ•°åï¼Œå†å¼€å§‹æ–°çš„è®¡æ•°å‘¨æœŸ

`Trigger Output Parameters `ï¼š è§¦å‘è¾“å‡º (TRGO) ï¼Œå½“å®šæ—¶å™¨çš„å®šæ—¶æ—¶é—´åˆ°è¾¾çš„æ—¶å€™è¾“å‡ºä¸€ä¸ªä¿¡å·(å¦‚ï¼šå®šæ—¶å™¨æ›´æ–°äº§ç”ŸTRGOä¿¡å·æ¥è§¦å‘ADCçš„åŒæ­¥è½¬æ¢ï¼‰

`Repetition Counter`ï¼šé‡å¤è®¡æ•°å™¨(RCR -8 bits)ï¼Œå±äºé«˜çº§æ§åˆ¶å¯„å­˜å™¨ä¸“ç”¨å¯„å­˜å™¨ä½ï¼Œåˆ©ç”¨å®ƒå¯ä»¥éå¸¸å®¹æ˜“æ§åˆ¶è¾“å‡º PWM çš„ä¸ªæ•°

**Master/Slave Mode(MSM bit) ï¼šä¸»ä»æ¨¡å¼**
- å®šæ—¶å™¨ä¸€èˆ¬æ˜¯é€šè¿‡è½¯ä»¶è®¾ç½®è€Œå¯åŠ¨ï¼ŒSTM32çš„æ¯ä¸ªå®šæ—¶å™¨ä¹Ÿå¯ä»¥é€šè¿‡`å¤–éƒ¨ä¿¡å·è§¦å‘`è€Œå¯åŠ¨ï¼Œè¿˜å¯ä»¥é€šè¿‡`å¦å¤–ä¸€ä¸ªå®šæ—¶å™¨çš„æŸä¸€ä¸ªæ¡ä»¶è¢«è§¦å‘`è€Œå¯åŠ¨ã€‚è¿™é‡Œæ‰€è°“æŸä¸€ä¸ªæ¡ä»¶å¯ä»¥æ˜¯å®šæ—¶åˆ°æ—¶é—´ã€å®šæ—¶å™¨è¶…æ—¶ã€æ¯”è¾ƒæˆåŠŸç­‰è®¸å¤šæ¡ä»¶ã€‚
- è¿™ç§é€šè¿‡ä¸€ä¸ªå®šæ—¶å™¨è§¦å‘å¦ä¸€ä¸ªå®šæ—¶å™¨çš„å·¥ä½œæ–¹å¼ç§°ä¸ºå®šæ—¶å™¨çš„åŒæ­¥ï¼Œå‘å‡ºè§¦å‘ä¿¡å·çš„å®šæ—¶å™¨å·¥ä½œäºä¸»æ¨¡å¼ï¼Œæ¥å—è§¦å‘ä¿¡å·è€Œå¯åŠ¨çš„å®šæ—¶å™¨å·¥ä½œäºä»æ¨¡å¼ã€‚
- å®šæ—¶å™¨çš„å››ç§ä¸»ä»æœºæ¨¡å¼ï¼šå¤–éƒ¨è§¦å‘æ¨¡å¼1ã€IRCé‡ç½®æ¨¡å¼ã€é—¨æ§æ¨¡å¼ã€è§¦å‘æ¨¡å¼ã€‚
## 3 åŸºæœ¬å®šæ—¶å™¨çš„ä½¿ç”¨

### 3.1 é…ç½®åŸºæœ¬å®šæ—¶å™¨TIM6

åˆ›å»ºå·¥ç¨‹ï¼Œè®¾ç½®SWDè°ƒè¯•ï¼ŒHSEæ—¶é’Ÿï¼Œç³»ç»Ÿæ—¶é’Ÿä¸º72MHz

ç„¶åæ‰“å¼€Timersé…ç½®TIM6ï¼Œè®¾ç½®ä¸ºActivatedæ¿€æ´»å®šæ—¶å™¨
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/f0dbb79f23ac7a8fdafb527a6fcc25e7.png)

- **Activated:** æ¿€æ´»TIM6ï¼ŒæŠŠå‰é¢çš„æ–¹æ¡†é€‰ä¸­å±€è¡¨ç¤ºæ¿€æ´»äº†TIM6
- **One Pulse Modeï¼š** 
	- è®¡æ•°åˆ°é¢„è®¾çš„å€¼æ—¶äº§ç”Ÿä¸€ä¸ªè„‰å†²è¾“å‡ºä¿¡å·ï¼Œè€Œä¸æ˜¯å‘¨æœŸæ€§çš„ä¿¡å·è¾“å‡º
	- `äº§ç”Ÿä¸€ä¸ªè„‰å†²ä¿¡å·åï¼Œç„¶åè®¡æ•°å™¨ä¼šåœæ­¢è®¡æ•°`ã€‚è¿™ç§æ¨¡å¼é€šå¸¸ç”¨äºéœ€è¦ç”Ÿæˆå•ä¸ªè„‰å†²ä¿¡å·çš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚PWMæ§åˆ¶ã€æµ‹é‡è„‰å†²å®½åº¦ç­‰
	- åœ¨STM32F103ç³»åˆ—ä¸­ï¼Œå®šæ—¶å™¨çš„One Pulse Modeå¯ä»¥é€šè¿‡è®¾ç½®TIM_CR1å¯„å­˜å™¨ä¸­çš„OPMä½æ¥å®ç°


![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/b86c6bf5c7814e16ec0c9f5f7140f039.png)

**ä¸‹é¢æ˜¯å‚æ•°è®²è§£ï¼š**
- **Counter Settingï¼š** è®¡æ•°è®¾ç½®
- **Prescaler(PSC** **-16** **bits value)ï¼š** é¢„åˆ†é¢‘å™¨ï¼Œç®€å†™PSCï¼Œ16ä½ï¼Œå¯è®¾ç½®çš„å€¼èŒƒå›´æ˜¯0--65535
	- åœ¨STM32F103ä¸­ï¼Œè®¡æ•°å™¨çš„æ—¶é’Ÿæºå¯ä»¥æ˜¯å†…éƒ¨æ—¶é’Ÿæºæˆ–å¤–éƒ¨æ—¶é’Ÿæº
	- ä½¿ç”¨å†…éƒ¨æ—¶é’Ÿæºæ—¶ï¼Œ`PSCå¯ä»¥å°†æ—¶é’Ÿä¿¡å·é¢‘ç‡é™¤ä»¥ä¸€ä¸ªå›ºå®šçš„åˆ†é¢‘ç³»æ•°ï¼Œä»¥é™ä½è®¡æ•°å™¨çš„æ—¶é’Ÿé¢‘ç‡ï¼Œä»è€Œæ‰©å¤§è®¡æ•°å™¨çš„è®¡æ—¶èŒƒå›´`
	- ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨å†…éƒ¨æ—¶é’Ÿæºï¼Œå¹¶å°†PSCè®¾ç½®ä¸º7199ï¼Œ åˆ™å®šæ—¶å™¨çš„æ—¶é’Ÿé¢‘ç‡å°†ä¸º72 MHz / (7199 + 1) = 10 kHzã€‚ è¿™æ„å‘³ç€è®¡æ•°å™¨1msè®¡æ•°10æ¬¡ã€‚å¦‚æœéœ€è¦æ›´é•¿çš„è®¡æ—¶èŒƒå›´ï¼ˆå¦‚1ms1æ¬¡ï¼‰ï¼Œå¯ä»¥å°†PSCè®¾ç½®ä¸ºæ›´å¤§çš„å€¼
- **Counter Modeï¼š** è®¡æ•°æ¨¡å¼
	- åŸºæœ¬å®šæ—¶å™¨TIM6åªèƒ½å‘ä¸Šè®¡æ•°ï¼ˆUPï¼‰
- **Counter Periodï¼ˆAuto Reload Register-16 bits valueï¼‰ï¼š** è®¡æ•°å‘¨æœŸ
	- Auto Reload å¯„å­˜å™¨ç”¨äºè®¾ç½®å®šæ—¶å™¨çš„è®¡æ•°å‘¨æœŸ
	- å½“å®šæ—¶å™¨çš„è®¡æ•°å™¨è¾¾åˆ°ARRçš„å€¼æ—¶ï¼Œå®šæ—¶å™¨ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½ARRçš„å€¼å¹¶ç»§ç»­è®¡æ•°
	- è¿™æ ·å¯ä»¥å®ç°å®šæ—¶å™¨çš„å‘¨æœŸæ€§è®¡æ•°ï¼Œä»è€Œå®ç°å®šæ—¶å’Œè®¡æ—¶çš„åŠŸèƒ½
- **Auto-Reload Preloadï¼š** è‡ªåŠ¨é‡è½½é¢„è£…è½½ä½¿èƒ½
	- è‡ªåŠ¨é‡è½½é¢„è£…è½½åŠŸèƒ½æ˜¯ç”¨æ¥æ§åˆ¶å®šæ—¶å™¨è®¡æ•°å™¨çš„è‡ªåŠ¨é‡è£…è½½å’Œé¢„è£…è½½çš„
- **Trigger Outputï¼ˆTGGOï¼‰ Parameterï¼š** è§¦å‘å™¨è¾“å‡ºå‚æ•°
	- å½“ä¸€ä¸ªå®šæ—¶å™¨çš„è®¡æ•°å™¨è®¡æ•°åˆ°é¢„è®¾å€¼æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªè§¦å‘è¾“å‡ºï¼Œå¯ä»¥å°†è¯¥è¾“å‡ºä¿¡å·è¿æ¥åˆ°å…¶ä»–å®šæ—¶å™¨æˆ–å¤–è®¾çš„å¯åŠ¨è¾“å…¥ç«¯ï¼Œä»¥å®ç°å¤šä¸ªå®šæ—¶å™¨æˆ–å¤–è®¾åŒæ­¥å·¥ä½œï¼ˆå¦‚ï¼šå®šæ—¶å™¨æ›´æ–°äº§ç”ŸTRGOä¿¡å·æ¥è§¦å‘ADCçš„åŒæ­¥è½¬æ¢ï¼‰
	- æœ‰ä¸‰ç§é€‰é¡¹
		- RESETå¤ä½ï¼šä½¿ç”¨TIMx_EGRå¯„å­˜å™¨çš„UGä½ä½œä¸ºè§¦å‘è¾“å‡ºã€‚å¦‚ï¼šæº¢å‡ºæ—¶ä¼šè®¾ç½®UGä½1ï¼Œè®¡æ•°å™¨é‡æ–°ä»0å¼€å§‹è®¡æ•°
		- ENABLEä½¿èƒ½ï¼šè®¡æ•°å™¨ä½¿èƒ½ä¿¡å·CNT_ENè¢«ç”¨ä½œè§¦å‘è¾“å‡ºã€‚å¦‚ï¼šç”¨äºåŒä¸€æ—¶åˆ»å¯åŠ¨å¤šä¸ªå®šæ—¶å™¨ï¼Œæˆ–æ§åˆ¶ä½¿èƒ½ä»å®šæ—¶å™¨çš„æ—¶æœºï¼ˆä¹Ÿå°±æ˜¯äº‹ä»¶ï¼‰
		- UPDATEæ›´æ–°ï¼šæ›´æ–°äº‹ä»¶è¢«ç”¨ä½œè§¦å‘è¾“å‡ºã€‚å¦‚ï¼šäº‹ä»¶ç”¨äºè§¦å‘ADCï¼ˆDACï¼‰çš„åŒæ­¥è½¬æ¢
		  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/63c7c8bf955bf64a9779681a1f3454ac.png)


### 3.2 è®¾ç½®å®šæ—¶å™¨æ—¶é—´ï¼ˆæ¥æºäºæ—¶é’Ÿï¼‰

ç„¶åå¦‚ä½•è®¾ç½®å®šæ—¶å™¨çš„å®šæ—¶æ—¶é—´å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“å®šæ—¶å™¨çš„æ—¶é’Ÿæ¥è‡ªå“ªé‡Œï¼Ÿ

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/39d817d8ff9f34b70f0213c718d4ff1f.png)

ä»ä¸Šå›¾èŠ¯ç‰‡æ‰‹å†Œçš„æ—¶é’Ÿæ ‘ä¸­å¯ä»¥çŸ¥é“ï¼ŒSTM32F103å®šæ—¶å™¨çš„æ—¶é’Ÿæºï¼š
- TIM1ã€TIM8:**æ¥è‡ªAPB2æ€»çº¿ä¸Šçš„TIMxCLK**
- TIM2åˆ°TIM7:**æ¥è‡ªAPB1æ€»çº¿ä¸Šçš„TIMxCLK**

ç»“åˆæˆ‘ä»¬åœ¨STM32CubeMXä¸­çš„æ—¶é’Ÿé…ç½®
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/b96de2edd06872ba6e19c30198bda835.png)

**æ‰€ä»¥TIM6çš„APB1æ—¶é’Ÿæ˜¯72Mhz**

### 3.3 é…ç½®åŸºæœ¬å®šæ—¶å™¨å‚æ•°

å¦‚æœéœ€è¦50msè§¦å‘ä¸€æ¬¡å®šæ—¶ä¸­æ–­
- æŠŠ72Mhzé€šè¿‡7200åˆ†é¢‘åï¼Œé€Ÿåº¦é™ä¸º10Khzï¼Œå³1msè®¡æ•°10æ¬¡
- é‚£ä¹ˆ50msï¼Œè®¡æ•°500æ¬¡ï¼Œå³è®¡æ•°å‘¨æœŸ
- æ³¨æ„ï¼š**å› ä¸ºè®¡æ•°å™¨æ˜¯ä»0å¼€å§‹è®¡æ•°çš„ï¼Œæ‰€æœ‰å‚æ•°éƒ½éœ€è¦å‡1**

ä¹Ÿå¯ä»¥é€šè¿‡å…¬å¼è®¡ç®—
- `Tout= ((PSC+1)*(Period+1))/Tclk`
	- Toutï¼šTIMçš„æº¢å‡ºæ—¶é—´ï¼ˆå•ä½sï¼‰
	- Tclkï¼šTIMçš„è¾“å…¥æ—¶é’Ÿé¢‘ç‡ï¼ˆå•ä½hzï¼‰
	- PSCï¼šåˆ†é¢‘ 7200 - 1
	- Periodï¼šè®¡æ•°å‘¨æœŸ 500 - 1
- `(7200*500) / 72000000 = 0.05s`

è®¾ç½®å¦‚ä¸‹
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/a0c67b6573448a5299cba7d02c0da51f.png)

### 3.4 è®¾ç½®å®šæ—¶å™¨ä¸­æ–­

> å…³äºä¸­æ–­ä¼˜å…ˆçº§ï¼Œåœ¨å®é™…å·¥ç¨‹é¡¹ç›®ä¸­ï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦
> å½“ä¸­æ–­è¿‡å¤šæ—¶ï¼Œæ‰éœ€è¦è®¾ç½®ä¸­æ–­ä¼˜å…ˆçº§ï¼Œæµ‹è¯•å·¥ç¨‹æ— éœ€è®¾ç½®

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/7d1393189a9af65a7abb4fbdf3fa5003.png)

### 3.5 ç”Ÿæˆä»£ç 

ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ•ˆæœï¼Œæ·»åŠ PA6ä¸ºLED1
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/815ef6f7bc2f8a1035695753c1a3342e.png)

ç‚¹å‡»ç”Ÿæˆä»£ç 
- é€šè¿‡main.cæŸ¥çœ‹TIM6å®šæ—¶å™¨çš„åˆå§‹åŒ–å‡½æ•°åœ¨`tim.c`ä¸­çš„å®šä¹‰ `MX_TIM6_Init()`
  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/dded2a1647f505ba3040baf68e5f6221.png)
- åœ¨stm32f1xx_it.cä¸­ï¼ŒæŸ¥çœ‹TIM6çš„å®šæ—¶ä¸­æ–­æœåŠ¡å‡½æ•°
  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/78bfab4f3515b959f67effcb588d18ce.png)
- è¿›å…¥`HAL_TIM_IRQHandler(&htim6)`å‡½æ•°ï¼Œè¿™é‡Œé¢çš„ä»£ç å¾ˆé•¿ï¼Œå°±æ˜¯ä¸åŒçš„ä¸­æ–­ç±»å‹ï¼Œè¿›å…¥ä¸åŒçš„ä¸­æ–­å›è°ƒå‡½æ•°
- è¿™é‡Œé€šè¿‡TIM Update eventç›¸å…³çš„æ‰¾åˆ°å¼±å‡½æ•°HAL_TIM_PeriodElapsedCallback(htim); è¿›å…¥è¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œæˆ‘ä»¬çœ‹åˆ°æ˜¯ä¸ªè™šå‡½æ•°ï¼Œéœ€è¦æˆ‘ä»¬é‡å†™ï¼Œåœ¨main.cä¸­æ·»åŠ 
  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/03092c82f8004a081f346a315814b3e5.png)
```c
/* USER CODE BEGIN 4 */
void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim){
	if(htim == &htim6){
		// æ¯50msï¼Œç¿»è½¬ä¸€ä¸‹LED1çš„çŠ¶æ€
		HAL_GPIO_TogglePin(LED1_GPIO_Port,LED1_Pin);
	}
}
/* USER CODE END 4 */
```

- æœ€åï¼Œéœ€è¦å¯åŠ¨å®šæ—¶å™¨ï¼Œéœ€è¦åœ¨mainå‡½æ•°é‡Œä½¿èƒ½ä¸­æ–­
```c
  /* USER CODE BEGIN 2 */
  HAL_TIM_Base_Start_IT(&htim6);
  /* USER CODE END 2 */
```

## 4 å…¶ä»–å®šæ—¶å™¨é…ç½®

åŒç†ï¼Œå…¶å®ƒå®šæ—¶å™¨çš„å®šæ—¶å™¨ä¸­æ–­å¯ä»¥é€šè¿‡åŒæ ·çš„æ–¹å¼è®¾ç½®

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/11f8c2efb97e6885273830cf0a2c1e51.png)

**è®°å¾—è®¾ç½®å®Œå‚æ•°åï¼Œæ‰“å¼€ä¸­æ–­å“¦ï¼Œå¦åˆ™å°†ä¸ä¼šäº§ç”Ÿä¸­æ–­**
- åŸºæœ¬å®šæ—¶å™¨
  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/632cecd324c1eef62b76d9c7603ad4c8.png)
- é«˜çº§å®šæ—¶å™¨
  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/03/2d1e6efa8195ee917aab00dc3c1d866e.png)
**æœ€åï¼Œä»£ç ä¸­ä¹Ÿè¦æ‰‹åŠ¨å¯åŠ¨å®šæ—¶å™¨ï¼ï¼ï¼**


