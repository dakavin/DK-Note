我推荐每个开发者都应该学一些 VIM 的原因，主要有两个：
- 独特的命令模式，可以大量减少按键次数，使得编辑更高效；
- 支持跨平台，同时可以在很多其他 IDE、编辑器中作为插件使用，真正做到一次学习，处处使用。

VIM 确实可以帮助我们提高效率，但面对这样一个学习曲线长而且陡的编辑器，我们很容易因为上手太难而放弃。所以，如何性价比高地学习 VIM 的使用技巧非常重要。

我推荐你按照以下三步，来高效地学习如何使用 VIM：
1. 学习 VIM 的命令模式和命令组合方式；
2. 学习 VIM 最常用的命令；
3. 在自己的工作环境中使用 VIM，比如与命令行环境的集成使用。
## 1 VIM的模式机制

VIM 的基本模式是命令模式，在命令模式中，敲击主体键的效果不是直接插入字符，而是执行命令实现对文本的修改。
### 1.1 VIM的最佳工作流

在命令模式下工作，效率高、按键少，所以我推荐你 **尽量让 VIM 处于命令模式，使用各种命令进行工作。进入编辑模式完成编辑工作之后也立即返回命令模式**

事实上，我们从命令模式进入编辑模式修改文件，之后再返回命令模式的全过程，就是一个编辑命令。它跟其他的命令，比如使用 dd 删除一行，并没有本质区别。接下来，我们一起看个具体的例子吧。

比如，我要在一行文字后面加上一个大括号，后面再写一行代码。开始编辑时，光标处于这一行的开头
```Plain
  config = 
^ 
```

修改的目标是这样：
```Plain
  config = {
    timeout: 1000ms,
  }
```

在 VIM 中，我的操作是，首先敲击大写字母 A，将光标移到这一行的末尾，并进入编辑模式：

然后，输入“{ timeout: 1000ms, 回车}”，在文件中插入内容。最后，敲击 Esc 键回到命令模式。编辑完成。
```Plain
  config = {
    timeout: 1000ms,
  }
   ^
```

实际上，整个过程就是执行了一条“在本行末尾插入文字”的命令。整条命令的输入是“A{ timeout: 1000ms, 回车}Esc”。虽然比较长，但仍然是一条文本编辑命令。

所以实际上，**我们在 VIM 中的工作，正是在命令模式里执行一条条的命令完成的**。理解了这一点，你就可以有意识地学习、设计命令来高效地完成工作了。

为了让命令更加高效，VIM 还提供了强大的命令组合功能，使得命令的功能效果呈指数级增长。
### 1.2 命令的组合方式

在 VIM 中，有相当一部分命令可以扩展为 3 部分：
- 开头的部分是一个数字，代表重复次数；
- 中间的部分是命令；
- 最后的部分，代表命令的对象。

比如，命令 3de 中，3 表示执行 3 次，d 是删除命令，e 表示从当前位置到单词的末尾。整条命令的意思就是，从当前位置向后，删除 3 个单词。类似的，命令 3ce 表示从当前位置向后，删除三个单词，然后进入编辑模式。

可以看到，命令组合的前两个部分比较简单，但第三个部分也就是命令对象，技巧就比较多了。所以接下来，我就与你详细介绍下到底有**哪些命令对象可以使用。**

`其实，对命令对象并没有一个完整的分类。但我根据经验，将其总结为光标移动命令和文本对象两种`

**第一种是光标移动命令**。比如，命令是移动光标到本行末尾，那么d命令是移动光标到本行末尾，那么d 就表示删除到本行末尾；再比如，4}表示向下移动 4 个由空行隔开的段落，那么 d4}就是删除这 4 个段落。

这一类命令功能很强大，我们也很熟悉了，但它有一个缺陷，就是选择的出发点始终是当前光标所在位置。而我们在处理文本的过程中，尤其是在编写程序的时候，光标所在位置常常是处于需要修改内容的中间，而不是开头。比如，我们常常在写一个注释字符串的时候，需要修改整个字符串：
```Plain
    comment: "this is standalone mode",
                          ^
```

如果使用上面的光标移动作为命令对象的话，我们需要执行 bbbct" 命令，也就是向左移动三个单词之后，再向右删除到第一个单引号的地方，操作起来很麻烦。

针对这种情况，VIM 提供了第二种命令对象：**文本对象**。具体来说就是，用字符代表一定的文字单位。比如，i"代表两个双引号之间的字符串，aw 表示当前的单词。使用这种文本对象很方便，比如上面的编辑例子，我们只需要命令 ci"就可以实现，比 bbbct’命令方便了很多。

具体来说，文本对象命令由两部分组成：
- 第一部分只能是字符 i 或者 a，表示是否包含对象边界。比如，i"表示不包括两边的引号，而 a"就包括引号；
- 第二部分选择比较多，表示各种不同的文本对象。比如
  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/1ed53d53451524df1e9015627705e859.png)
如果你要查看完整的文本对象，可以使用:help text-objects

这一组文本对象选择功能很强大，而且是 VIM 自带功能，不需要安装任何插件。神奇的是，不知道为什么，很多使用 VIM 很久的人都不知道这个功能。我个人把它叫作 vip 功能，如果你以前没有用过，可以在文件中输入命令 vip 看看效果。相信不会让你失望。

可见，VIM 的命令操作及其组合功能非常强大，要高效使用 VIM，我们就必须使用命令模式以及命令组合。我看到有些开发者使用 VIM 时，一上来就使用 i 命令进入编辑模式，然后在编辑模式中工作。但是，编辑模式的功能很有限，完全发挥不出 VIM 提供的高效文本编辑功能。

接下来，我们进入第二步，也就是学习 VIM 最常用的命令。
## 2 命令模式中的基础命令

VIM 有大量的命令可供我们使用，这里我主要与你介绍针对单个文件编辑的命令，因为这是编辑工作最基础的部分，也是各种跨平台场景，尤其在其他 IDE 中通过插件使用 VIM 的方式的共性部分。
至于更多的命令和细节，你可以参考我的“命令模式中的基础命令”这篇博客，或者自行搜索查询。
接下来，我会按照以下编辑文件的逻辑顺序，来与你介绍关键知识点和技巧：
1. 打开文件，以及进行设置操作；
2. 移动光标；
3. 编辑文本；
4. 查找、替换。
### 2.1 打开文件及对文件设置

这些命令包括打开文件、退出、保存、设置等。关于设置，如果在远端的服务器上，我常常运行一条命令进行基本设置：
```Plain
:set ic hls is hid nu
```

其中，ic 表示搜索时忽略大小写，hls 表示高亮显示搜索结果，is 表示增量搜索，也就是在搜索输入的过程中，在按回车键之前就实时显示当前的匹配结果，hid 表示让 VIM 支持多文件操作，nu 表示显示行号。

如果要关闭其中某一个选项的话，在前面添加一个 no 即可。比如，关闭显示行号，使用
```Plain
:set nonu
```
### 2.2 移动光标

VIM 提供了非常细粒度的光标移动命令，包括水平移动、上下移动、文字段落的移动。这些命令之间的差别很细微。比如，w 和 e 都是向右边移动一个单词，只不过 w 是把光标放到下一个单词开头，而 e 是把光标放到这一个单词结尾。

虽然差别很小，但正是这样的细粒度，才使得 VIM 能够让我们使用最少的按键次数去完成编辑任务。
### 2.3 编辑命令

编辑工作中我们应该大量使用命令组合来提高效率。关于组合命令的威力，我建议你看下“[命令模式中的基础命令](https://jungejason.github.io/vim-commands/)”那篇博客，我与你详细解释了一个 ct"的例子。

这里，**我重点与你分享一个设计命令的技巧**。VIM 的取消命令 u、重复命令.，都是针对上一个完整的编辑命令而言。所以，我们可以设计一个完整的编辑命令，从而可以使用重复命令. 来提高效率。比如，你要把一段文本中的几个时间都修改成 20ms，这段文本原来是

```Plain
    timeout: 1000000ms,
    waiting: 300000ms,
    starting: 40000ms,
```

希望改变成

```Plain
    timeout: 20ms,
    waiting: 20ms,
    starting: 20ms,
```

在 VIM 中有多种实现方法。一种还不错的方法是，使用修改命令 c 和移动命令 l 的组合，在每一行用一个命令搞定。具体操作是，将光标挪到 1000000ms 里数字 1 的地方，用 c7l20 命令对第一行进行修改，然后在第二行、第三行的相同位置分别使用 c6l20 和 c5l20 进行修改。

这个命令可以完成工作，但每条命令都不一样，不能重复。实际上，还有一种更好的方法。

你可以设计一条命令，在每一行重复使用。在这个例子里，这个命令是 ctm20，意思是从当前位置删除到下一个字母 m 的位置，进入编辑模式，插入 20，然后返回命令模式。

使用这条命令对第一行进行修改之后，你可以把光标挪到第二、三行使用重复命令. 来完成编辑任务，如下所示。
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/2ca8e2c066b08b242f38b7805224df05.png)

当然了，你还可以使用正则表达式进行查找替换，但是远比上面这个重复命令要复杂。这个设计命令并重复使用的方法非常好用，建议你上手实践下。

关于重复命令，VIM 另外还有一个录制命令 q 和重复命令 @，功能更强大，但也比较重。如果你想深入了解的话，[可以参考这篇文章](https://xu3352.github.io/linux/2018/11/04/practical-vim-skills-chapter-11)。
### 2.4 查找、替换

这组命令主要有 /、* 和 s 等，很常用，网络上也有很多描述，这里我就不再详细介绍了。比如，我在“[命令模式中的基础命令](https://jungejason.github.io/vim-commands/)”这篇博客中详细介绍了 s 命令，可供你参考。

除了上述 4 种常见命令外，VIM 中还有一种很强大的可视模式（Visual Mode），可以提高编辑体验。接下来，我们再一起看看。
### 2.5 可视模式

可视模式一共有 3 种，包括基于字符的可视模式、基于行的可视模式和基于列的可视模式，详见“[命令模式中的基础命令](https://jungejason.github.io/vim-commands/)”这篇博客中的介绍。

接下来，我以基于列的可视模式为例，带你看看可视模式是如何提高编辑体验的吧。

我们先来看看第一个例子。有一段文本，每一行都用 var 声明变量（比如 var gameMode），现在我希望改成使用 const 来声明。我们来看看具体的实现方式。
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/c6c38a5d5494b0d689af9123effb18b9.png)

第一步，把光标挪到第一行开头的 v 字符处，使用组合键 Ctrl-v 进入列可视模式，然后使用 7j 下移动七行，再用 e 向右移动一个单词，从而选中一个包含所有 var 的矩形区域。
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/d3e2075045b53d35cc14b178fa1d94cf.png)

第二步是开始编辑。输入 c，删除所有的 var，并进入编辑模式。
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/7474155fd2ae9e7cc30e6544d7cc7cb3.png)
第三步是输入 const，并输入 Esc 完成编辑操作，回到命令模式，整个修改完成。
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/1af1d247d1ad562e4e4141ded0d1eba4.png)

我们再来看看第二个例子。我希望在上面这段文字的每一行末尾都添加一个分号。具体的操作步骤如下所示：

首先，用 $ 命令把光标挪到最后一行的末尾，然后 Ctrl-v 进入列模式，再用 7j 命令将光标挪到第一行，这时，每一行的末尾都被包含到了一个方块里。不过因为每一行的长度不同，所以方块没有显示完全。
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/93cd764920ae9d76d1f1a64b4bb4b7fa.png)

然后，输入 A 命令，光标挪到每一行的末尾，并进入编辑模式。
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/fd23cfc5746233d8e19959d703fed7ad.png)
最后，输入要插入的分号，输入 Esc 完成编辑。这样，每一行的末尾都添加了一个分号。
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/a324a7c2880260c41c0418a6d92624e8.png)

最后，关于可视模式我还有三个比较有用的小贴士：

- 第一，在退出了可视模式之后，可以使用 gv 命令重新进入可视模式并选择上一次的选择。这个命令出乎意料得有用，因为我们常常需要对上一次的选择进行进一步的操作。
    
- 第二，进入可视模式之后，可以直接使用 v、V、Ctrl-v 在三种模式之间切换，而不需要退出可视模式再重新进入。比如，你一开始使用 v 进入了字符可视模式，这时发现你需要删除几行，就可以直接输入 V 进入行的可视模式。
    
- 第三，修改选取的区域范围。当你进入可视模式之后，光标默认处于所选区域的结尾处，你可以挪动光标调节选择区域的结尾部分。但，如果你想调节的是所选区域的开头部分，则可以使用命令 o 将光标跳到选择区域的开始部分，再次输入命令 o 光标又会跳到选择区域的末尾。一个更好玩的情况是，在列模式中，你可以使用小写 o 在对角线上跳转，大写 O 在水平方向跳转，从而可以灵活调整所选矩形的四个角。
    

以上就是命令模式中的常用基础命令了。理解了这些命令，再加上命令组合，你就可以比较高效地使用 VIM 进行文本编辑了。但，要更高效地使用 VIM，我们还有一个问题没有解决：VIM 虽然强大，但也只是整个工作环境中的一个工具，怎样才能在整个工作中高效地使用 VIM 技能呢？

所以，接下来我将带你探索如何寻找合适的 VIM 使用场景。