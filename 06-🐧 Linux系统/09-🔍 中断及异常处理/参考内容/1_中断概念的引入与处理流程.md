---
文章标题: "[[1_中断概念的引入与处理流程]]"
文章作者: Dakkk
文章概要: |
  本文深入浅出地介绍了中断概念，通过对比轮询方式突显中断优势。详细阐述了中断分类及ARM架构下中断的硬件触发与软件处理流程，包括异常向量机制，旨在为读者构建中断处理的基础认知。
tags:
  - 中断
  - ARM
  - 异常处理
  - 嵌入式系统
  - 硬件中断
  - 轮询
  - 异常向量
相关文章:
  - "[[../../../08-🏗️ Linux设备模型与设备树(重点)/3_设备树基础/03_图解Kernel Device Tree(设备树)的使用]]"
  - "[[../../../08-🏗️ Linux设备模型与设备树(重点)/3_设备树基础/04_设备树中CPU描述 (不需要改)]]"
  - "[[0_try catch finally原理]]"
  - "[[1_单片机介绍]]"
  - "[[1_驱动关键技术]]"
文章分类: 🐧 Linux系统
文章路径: 06-🐧 Linux系统/07-🚗 Linux驱动开发核心(重要!!!)/01-⚡ 中断及异常/01_基于韦神设备树课程/1_中断概念的引入与处理流程.md
文章难度: 初级 💧
目前阶段: ✅ 已完成
重要性: ⭐⭐⭐⭐⭐ 精通必备
创建时间: 2025-06-10 20:34:00
修改时间: 2025-06-10 21:46:18
---

## 1 参考资料

**中断相关知识参考资料**
基于设备树的TQ2440的中断（1）:
- [https://www.cnblogs.com/pengdonglin137/p/6847685.html](https://www.cnblogs.com/pengdonglin137/p/6847685.html)  
基于设备树的TQ2440的中断（2）: 
- [https://www.cnblogs.com/pengdonglin137/p/6848851.html](https://www.cnblogs.com/pengdonglin137/p/6848851.html)  
基于tiny4412的Linux內核移植实例学习中断背后的知识:
- [http://www.cnblogs.com/pengdonglin137/p/6349209.html](http://www.cnblogs.com/pengdonglin137/p/6349209.html)  
Linux kernel的中断子系统系列文章:
- [http://www.wowotech.net/irq_subsystem/interrupt_subsystem_architecture.html](http://www.wowotech.net/irq_subsystem/interrupt_subsystem_architecture.html)

> [!tip]+ 提示
> 这节内容来自"韦东山第1期裸板视频加强版"，如果已经理解了中断的概念，可以忽略本节

## 2 为什么需要中断？

**传统轮询方式的问题**
```c
// 轮询方式检查设备状态
while(1) {
    if (设备准备好) {
        处理数据();
    }
    // CPU一直在检查，浪费资源
}
```
- CPU资源浪费：需要不断检查设备状态
- 响应延迟：可能错过设备的就绪时机
- 效率低下：CPU无法去做其他重要工作

**中断方式的优势**
- 设备主动通知CPU："我准备好了！"
- CPU可以专心做其他事情，不用一直检查
- 响应更及时，效率更高

## 3 中断的基本概念

**中断就像生活中的"电话铃声"：**
- 你在专心工作（CPU执行程序）
- 电话响了（硬件发出中断信号）
- 你停下手头工作去接电话（保存现场，执行中断处理）
- 通话结束后继续原来的工作（恢复现场，继续执行）

**中断的分类**
1. **硬件中断**：由外部设备产生（键盘、鼠标、网卡等）
2. **软件中断**：由程序指令产生（系统调用）
3. **异常**：程序执行错误时产生（除零错误、页面错误等）

## 4 ARM对异常(中断)处理流程

**【一、硬件部分】**
- **1、初始化**
	- 设置中断源，让它可以产生中断
	- 设置中断控制器（屏蔽、优先级等）
	- 设置CPU总开关（使能中断）
- **2、执行程序**
- **3、产生中断**
	- 按下按键，中断信号发给中断控制器，中断控制器发送信号给CPU
- **4、CPU每执行完一条指令，都会检查有无中断、异常产生**
- **5、发现有异常/中断产生，开始处理！！！**
	- 对不不同的异常，会跳转去不同的地址执行程序（该过程依赖于异常向量）

**补充：异常向量（Exception Vector）**：
- 当异常/中断发生时，CPU会自动跳转到异常向量表的`某个固定地址`去执行
  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/66f2851da56c1aa4105eba6b3caadb18.png)
- 如下图所示，异常向量表里存放的就是一条条的跳转指令，`u-boot/arch/arm/lib/vectors.S`
  ![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/37ae70262239de916b09a9fb618f904e.png)
- 于是CPU就去执行这条跳转指令，从而跳转到真正的异常处理函数入口 ↓↓↓↓

**【软件部分】**
- **6、异常处理函数的通用流程**
	- 保护现场：保存各种寄存器
	- 处理异常/中断：根据具体中断源再调用不同的C函数进行处理
	- 恢复现场

> [!tip]+ 提示
> 下一节，我们将详细描述**真正的异常处理函数**