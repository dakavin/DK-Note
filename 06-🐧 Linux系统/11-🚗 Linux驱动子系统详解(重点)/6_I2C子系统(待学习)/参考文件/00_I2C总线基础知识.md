
## 1 基础知识

### 1.1 总线拓扑结构

I2C 总线采用主从式架构,由一个主设备(Master)和一个或多个从设备(Slave)组成。 主设备负责发起数据传输,从设备则响应主设备的请求。

  

### 1.2 物理层接口

I2C 总线使用两根线路进行通信:

- SCL(Serial Clock Line)时钟线,由主设备提供时钟信号。
    
- SDA(Serial Data Line)数据线,用于双向传输数据。
    

这两根线通常需要上拉电阻来保持信号的高电平状态。

  

### 1.3 通信协议

I2C 采用同步串行通信方式,主设备发起通信并提供时钟。 主设备首先发送一个"启动"信号,然后发送从设备地址和数据传输方向(读或写)。 从设备在收到自己的地址后,会发送应答信号, 表示已准备好接收或发送数据。 之后主设备和从设备就可以开始传输数据。 通信结束时,主设备发送"停止"信号。

  

### 1.4 时钟频率

I2C 总线支持多种通信速率,常见的有:

- 标准模式(Standard mode):100kbps
    
- 快速模式(Fast mode):400kbps
    
- 高速模式(High-speed mode):3.4Mbps （咱们RK3568 最大支持1Mbps）
    

  

### 1.5 寻址机制

I2C 使用 7 位地址空间,最多可寻址 127 个从设备。 地址空间的前 7 位用于指定从设备,最后1 位用于表示读/写方向。

每一个 12C 外设都会对应一个唯一的地址(这个地址可以从 I2C 外设器件的数据手册中得到） ， 主机和从机之间的通信就是通过这个地址来确定主机要和哪个从机进行通信的。

  

### 1.6 多主机支持

I2C 总线支持多个主设备共享同一总线,通过仲裁机制避免冲突。 当多个主设备同时试图占用总线时,优先级最高的主设备将获得总线控制权。

  

### 1.7 其他特点

总线最大电容限制为 400pF。以字节为单位传输数据。

存在硬件 I2C 和软件 I2C 两种实现方式。

  

## 2 资源

在 RK3568 数据手册中可以找到关于 I2C 接口的介绍，具体如下所示：
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/7f7b07f6714cf5d2bb0f3cc77199a4d8.png)


- 支持 6 路 I2C 接口，分别为 I2C0、I2C1、I2C2、I2C3、I2C4、I2C5
    

RK3568 开发板上的 I2C 接口具体使用情况如下表所示：
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/f157414dd673a5d546fec936cfbaf841.png)


- 支持 7 位和 10 位地址模式
    
- 软件可编程时钟频率
    
- I2C 总线上的数据传输速率可达:
    
    - 标准模式最高 100Kbit/s
        
    - 快速模式最高 400Kbit/s
        
    - 快速模式加最高 1Mbit/s
        

## 3 什么是硬件I2C （当前模式：控制器负责拉出对应的波形）

- 实现方式:通过专用的硬件 I2C 接口电路来实现 I2C 总线协议。
    
- 优点:
    
    - CPU 占用低,I2C 总线由硬件电路自动完成。
        
    - 传输速率高,可以达到 400kbit/s 或 3.4Mbit/s。
        
    - 更加可靠和稳定,不易受外部干扰。
        
- 缺点:
    
    - 需要专用的硬件 I2C 接口电路支持,成本相对较高。
        
    - 接口固定,不如软件 I2C 那么灵活。
        
- 适用范围：适用于高速、大量数据传输的场合,如 LCD、EEPROM 等外设的连接。
    

而软件 I2C 指的是通过 GPIO 口模拟 SCL 和 SDA 信号线，在硬件 I2C 不够用的情况下，可以 通过 GPIO 来模拟软件 I2C,关于软件 I2C 的介绍如下所示：

  

## 4 什么是软件I2C（GPIO模拟：代码可以模拟I2C波形）

- 实现方式:通过软件模拟 I2C 总线协议,使用通用 I/O 口来模拟 SCL 和 SDA 信号线。
    
- 优点:
    
    - 灵活性强,可以在任何 I/O 口上实现 I2C 接口。
        
    - 成本低,不需要额外的硬件支持。
        
- 缺点:
    
    - CPU 占用较高,因为需要在软件中模拟 I2C 时序。
        
    - 传输速率较低,受 CPU 性能限制,一般在 100kbit/s 左右。
        
- 适用范围：适用于低速、少量数据传输的场合。
    

  

RK3568 开发板上的 I2C 接口具体使用情况如下表所示：
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/f157414dd673a5d546fec936cfbaf841.png)


I2C0、I2C1 各自只有一组 pinctrl，而 I2C3、I2C4、I2C5 各有两组 pinctrl，但某一个硬件 I2C 只能由一组 GPIO 复用。