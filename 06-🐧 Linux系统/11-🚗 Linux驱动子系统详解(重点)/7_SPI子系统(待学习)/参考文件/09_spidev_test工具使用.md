ğŸ“¢ åœ¨ `Linux` ç³»ç»Ÿä¸Šï¼Œâ€œ`spidev_test`â€ æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•å’Œé…ç½® `SPI`ï¼ˆ`Serial Peripheral Interface`ï¼‰è®¾å¤‡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚`SPI`æ˜¯ä¸€ç§ä¸²è¡Œé€šä¿¡åè®®ï¼Œé€šå¸¸ç”¨äºè¿æ¥å¾®æ§åˆ¶å™¨ã€ä¼ æ„Ÿå™¨å’Œå…¶ä»–å¤–éƒ¨è®¾å¤‡ã€‚â€œ`spidev_test`â€ å·¥å…·é€šå¸¸åœ¨`Linux`ç³»ç»Ÿä¸Šä½¿ç”¨ï¼Œç”¨äºæ£€æŸ¥`SPI`æ¥å£çš„æ­£ç¡®æ€§ä»¥åŠä¸`SPI`è®¾å¤‡çš„é€šä¿¡æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

## ç¯å¢ƒ

1. ç¼–è¯‘å¹¶ä¼ è¾“spidevæµ‹è¯•ç¨‹åºåˆ°ç›®æ ‡æ¿ã€‚
    
2. spidevè®¾å¤‡èŠ‚ç‚¹ã€‚

åˆå§‹åŒ–SDKç¯å¢ƒï¼Œè¿›å…¥å†…æ ¸çš„æºç ç›®å½•ï¼Œç„¶åè¿›å…¥tools/spiç›®å½•ï¼Œmake.

[https://elixir.bootlin.com/linux/latest/source/tools/spi](https://elixir.bootlin.com/linux/latest/source/tools/spi)

å¾—åˆ° spidev_test å’Œ spidev_fdxä¸¤ä¸ªç¨‹åºã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ADB è¿›è¡Œä¸Šä¼ ã€‚

## æ‰§è¡Œæµ‹è¯•

spidev_testçš„å¸®åŠ©ï¼šå‚è€ƒä¸‹å›¾
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/3da5a4c3a1e28fd9b21091bba7b14947.png)


ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ â€œspidev_testâ€ å‘½ä»¤è¡Œé€‰é¡¹å’Œè¯´æ˜ï¼š

- -D æˆ– --deviceï¼šç”¨äºæŒ‡å®šSPIè®¾å¤‡çš„è·¯å¾„ã€‚é€šå¸¸ï¼ŒSPIè®¾å¤‡çš„è·¯å¾„ç±»ä¼¼äº â€œ/dev/spidevX.Yâ€ï¼Œå…¶ä¸­Xæ˜¯SPIæ§åˆ¶å™¨çš„ç¼–å·ï¼ŒYæ˜¯SPIè®¾å¤‡çš„ç¼–å·ã€‚
    
- -s æˆ– --speedï¼šç”¨äºè®¾ç½®SPIé€šä¿¡çš„æ—¶é’Ÿé€Ÿåº¦ï¼Œä»¥Hzä¸ºå•ä½ã€‚ä¾‹å¦‚ï¼Œ-s 1000000 å°†è®¾ç½®SPIæ—¶é’Ÿé€Ÿåº¦ä¸º1 MHzã€‚
    
- -b æˆ– --bitsï¼šç”¨äºè®¾ç½®æ¯ä¸ªå­—èŠ‚çš„ä½æ•°ã€‚SPIé€šä¿¡é€šå¸¸ä½¿ç”¨8ä½ï¼Œä½†å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®ã€‚
    
- -v æˆ– --verboseï¼šç”¨äºå¯ç”¨è¯¦ç»†çš„è¾“å‡ºï¼Œä»¥ä¾¿æŸ¥çœ‹SPIé€šä¿¡çš„ç»†èŠ‚ã€‚
    
- -w æˆ– --writeï¼šç”¨äºå‘é€æ•°æ®åˆ°SPIè®¾å¤‡ã€‚å¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹å°†æ•°æ®å‘é€åˆ°è®¾å¤‡ã€‚
    
- -r æˆ– --readï¼šç”¨äºä»SPIè®¾å¤‡è¯»å–æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹è¯»å–æ¥è‡ªè®¾å¤‡çš„æ•°æ®ã€‚
    
- -p æˆ– --loopï¼šç”¨äºè®¾ç½®å¾ªç¯æ¨¡å¼ã€‚å¦‚æœå¯ç”¨äº†å¾ªç¯æ¨¡å¼ï¼Œâ€œspidev_testâ€ å°†æŒç»­è¿è¡Œï¼Œä¸æ–­å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚
    
- -h æˆ– --helpï¼šç”¨äºæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ï¼Œåˆ—å‡ºå¯ç”¨çš„å‘½ä»¤è¡Œé€‰é¡¹å’Œå…¶è¯´æ˜ã€‚
    

## å›ç¯æµ‹è¯•

- å†…å¾ªç¯ï¼š
```txt
spidev_test -v -l -I 1 -S 256
```
- lï¼šå†…å¾ªç¯æ¨¡å‹
- -I xxï¼šå‘é€æ•°æ®çš„æ¬¡æ•°
- -S xxï¼šæ¯æ¬¡å‘é€çš„å­—èŠ‚æ•°

- å¤–å¾ªç¯ï¼š
	- å°†SPI_DIå’ŒSPI_DOçŸ­æ¥è¿›è¡Œå¤–å¾ªç¯æµ‹è¯•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤
```txt
spidev_test -v -I 1 -S 256
```


## å­—èŠ‚å‘é€æµ‹è¯•

åœ¨/dev/spidev2.0ä¸Šå‘é€0x00 0x47ï¼Œç„¶åè¯»å–ä¸¤ä¸ªå­—èŠ‚ï¼šï¼Œç»“æœå¦‚ä¸‹å›¾
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/b6cf29e6786b186f80560ec042a39bd0.png)


å…¶ä¸­çš„CPHAï¼ŒCPOLé…ç½®è¯·å‚è€ƒä¸‹å›¾ï¼Œæ¥è‡ª [http://www.gammon.com.au/spi](http://www.gammon.com.au/spi)

## 32ä½æ•°æ®å‘é€æµ‹è¯•
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/d1d4f49a77a4842f7cb19d08f77af4b0.png)


```txt
å¦‚æœè¦å‘é€32ä½/16ä½çš„æ•°æ®ï¼Œåˆ™éœ€è¦å…ˆç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¦‚ç”Ÿæˆ32å­—èŠ‚çš„éšæœºæ•°æ®ï¼š

dd if=/dev/urandom of=test_data bs=16 count=2

ç”¨hexdumpæ¥æŸ¥çœ‹è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼š

# hexdump -v test_data -C
00000000  74 6a 59 3e 1e 81 73 fb  5a 3f 94 c7 d8 20 ca e9  |tjY>..s.Z?... ..|
00000010  24 2e a5 68 75 ab f7 12  af e6 c1 3d e2 d8 9a ba  |$..hu......=....|
00000020

å‘é€ï¼š

# ./spidev_test -D /dev/spidev2.0 -b 32 -v -i test_data
spi mode: 0x0
bits per word: 32
max speed: 500000 Hz (500 kHz)
TX | 74 6A 59 3E 1E 81 73 FB 5A 3F 94 C7 D8 20 CA E9 24 2E A5 68 75 AB F7 12 AF E6 C1 3D E2 D8 9A BA | tjY>.s.Z?... .$..hu.....=...|
RX | 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 | ................................|
```