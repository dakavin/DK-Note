
## 什么是输入子系统？

在 Linux 中，input 子系统是专门为处理输入类设备而设计的一个子系统或框架。它提供

了一套通用的接口和机制，用于驱动开发人员编写和管理输入设备的驱动程序。输入设备包括 键盘、鼠标、触摸屏、游戏手柄等，具体示意图如下所示：
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/a08205477535884d99db64b4c40e40d7.png)


使用 input 子系统的主要目的是规范和简化输入设备驱动的开发过程，以提高驱动的通用

性和兼容性。它通过将**输入设备的共同功能和处理逻辑提取出来**，编写成通用的代码，将**差异化的代码**留给具体的**设备驱动开发人员**，这种分工合作的方式使得驱动开发人员可以更专注地处理设备特定的细节，从而**大大降低工程师的开发难度**。

使用输入子系统的另一个好处是驱动开发人员**不需要自己实现文件操作集函数**。输入子系

统已经提供了一套标准的接口和函数，开发人员只需要按照这些接口进行开发，而无需关心底 层的文件操作细节。这样可以大大降低开发的难度和复杂度。

- **（1）兼容性**： 输入子系统提供了一个统一的框架和接口，使得不同厂家的输入设备都可以按照相同的规范进行驱动开发。无论是键盘、鼠标还是其他输入设备，只要符合输入子系统定义的接口和事件格式，都可以在 Linux 系统中正常工作。这样一来，工程师不需要针对每个厂家的设备编写和维护不同的驱动代码，大大提高了设备的兼容性。
    
- **（2）统一的驱动编程方式：** 输入子系统定义了一套通用的驱动编程方式，工程师只需要 按照输入子系统的规范进行开发即可。输入设备的驱动模块需要实现相应的接口函数，如初始 化函数、事件处理函数等。这些接口函数的实现方式是相同的，不论是键盘驱动还是鼠标驱动， 都可以按照统一的方式进行开发。这样一来，工程师可以更加专注于设备特定的细节，而无需关心通用的驱动框架，简化了开发过程。
    
- **（3）统一的应用操作接口：** 输入子系统通过提供一组统一的应用操作接口，如 /dev/input/eventX，使得应用程序可以方便地与输入设备进行交互。应用程序可以通过读取这些设备节点，获取输入事件的信息，并进行相应的处理。无论是哪种类型的输入设备，应用程序都可以使用相同的方式进行访问和操作。这样一来，应用程序的开发人员不需要关心底层输入设备的细节，可以更加专注于应用程序的逻辑开发。
    

## 输入设备和节点的关系

在输入子系统中，输入设备与设备节点之间有一定的对应关系。以下是判断设备节点与输

入设备的方法：

1. **设备名：** 输入子系统的设备节点可以分为通用设备名和专用设备名。专用设备名通常
    

可以从设备名中直接识别出设备类型，例如"keyboard"（键盘）或"mouse"（鼠标）。而通用设 备名则不能直接确定设备类型。如下图所示，event0-event4 属于通用设备名，而 mouse0 和 mouse2 属于专用设备名。

`ls /dev/input`
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/d9bce13d7dec458899cd533f1ae684f9.png)


2. **试探性方法：** 可以使用"cat"命令打开设备节点文件，然后对物理设备进行操作，观察 终 端 是 否 有 输 出 。 例 如 ， 对于键盘设备 ， 你可以运行 "cat /dev/input/eventX" ， 其中 "/dev/input/eventX"是设备节点的路径，然后按下键盘按键，观察终端是否输出相应的字符。通过这种试探性的方法，你可以判断设备节点与具体设备之间的对应关系。
    
3. **查看输入设备信息**：可以使用以下命令查看"/proc/bus/input/devices"文件：
    

**cat /proc/bus/input/devices**
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/674afc22c7a3691160c6db37135dbafe.png)


该文件记录了当前系统的所有输入设备的信息在该文件中，你可以找到与设备节点相关的

信息，例如设备名称、供应商 ID、产品 ID 等。通过对比设备节点的路径和设备信息中的对应字段，你可以确定设备节点与特定输入设备之间的关系，例如可以通过上述打印信息查看到，键盘对应的设备节点为`/dev/input/event1`，如下图所示:
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/fdb740d0eefa94b7669f3bb99180d53e.png)


其他相关内容的解释如下所示：

- I: Bus=0011 Vendor=0001 Product=0001 Version=ab41: 这一行显示了设备的总线类型、供应商 ID、产品 ID 和固件版本。在这个例子中，该设备的总线类型为 0011，供应商 ID 为 0001， 产品 ID 为 0001，固件版本为 ab41。
    
- N: Name="AT Translated Set 2 keyboard": 这一行显示了设备的名称。在这个例子中，该设备的名称为"AT Translated Set 2 keyboard"。
    
- P: Phys=isa0060/serio0/input0: 这一行显示了设备的物理位置。在这个例子中，该设备的物理位置是 isa0060/serio0/input0。
    
- S: Sysfs=/devices/platform/i8042/serio0/input/input1: 这一行显示了设备在 sysfs 文件系统中的路径。在这个例子中，该设备的路径是/devices/platform/i8042/serio0/input/input1。
    
- U: Uniq=: 这一行显示了设备的唯一标识符。在这个例子中，唯一标识符为空。
    
- H: Handlers=sysrq kbd event1 leds: 这一行显示了设备的处理程序。它指示了处理设备输入事件的程序或模块。在这个例子中，设备有 sysrq、kbd、event1 和 leds 这些处理程序，其中 event1 就表示设备节点为/dev/input/event1。
    
- B: PROP=0: 这一行显示了设备的属性。在这个例子中，设备的属性值为 0。
    
- B: EV=120013: 这一行显示了设备支持的事件类型。在这个例子中，设备支持 EV_SYN、 EV_KEY、EV_MSC 和 EV_LED 这些事件类型。
    
- B: KEY=402000000 3803078f800d001 feffffdfffefffff fffffffffffffffe: 这一行显示了设备支持的按键。每个按键对应一个位，1 表示按键被按下，0 表示按键未被按下。该行显示了按键的状态，以 16 进制表示。
    
- B: MSC=10: 这一行显示了设备支持的杂项事件。在这个例子中，设备支持 MSC_SCAN事件。
    
- B: LED=7: 这一行显示了设备支持的 LED 灯。在这个例子中，设备支持 3 个 LED 灯，使用一个 7 位的二进制数表示灯的状态。