---
æ–‡ç« æ ‡é¢˜: "[[06_ğŸ“•è®¾å¤‡æ ‘ä¸­æ–­çš„å±æ€§æè¿° (æœ€å¸¸ç”¨)]]"
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  è¯¦ç»†ä»‹ç»äº†Linuxè®¾å¤‡æ ‘ä¸­æ–­ç³»ç»Ÿçš„å››ä¸ªæ ¸å¿ƒå±æ€§ï¼šinterruptsã€interrupt-controllerã€#interrupt-cellså’Œinterrupt-parentï¼Œé€šè¿‡RK3568å¼€å‘æ¿å®ä¾‹æ·±å…¥è§£æä¸­æ–­é…ç½®åŸç†å’Œå±‚çº§ç»“æ„å…³ç³»ã€‚
tags:
  - è®¾å¤‡æ ‘
  - ä¸­æ–­ç³»ç»Ÿ
  - Linuxå†…æ ¸
  - interruptså±æ€§
  - ä¸­æ–­æ§åˆ¶å™¨
  - GPIOä¸­æ–­
  - åµŒå…¥å¼å¼€å‘
  - ARMæ¶æ„
ç›¸å…³æ–‡ç« :
  - "[[å‚è€ƒå†…å®¹/ä¸­æ–­ç³»ç»Ÿä¸­çš„è®¾å¤‡æ ‘]]"
  - "[[04_è®¾å¤‡æ ‘ä¸­CPUæè¿° (ä¸éœ€è¦æ”¹)]]"
  - "[[05_è®¾å¤‡æ ‘ä¸­æ—¶é’Ÿæè¿° (è¢«ä½¿ç”¨)]]"
  - "[[../../09-ğŸ” ä¸­æ–­åŠå¼‚å¸¸å¤„ç†/å‚è€ƒå†…å®¹/3_ä¸­æ–­å·çš„æ¼”å˜ä¸irq_domain]]"
  - "[[02_è®¾å¤‡æ ‘ï¼ˆdevice Treeï¼‰çš„ç”±æ¥]]"
æ–‡ç« åˆ†ç±»: ğŸ§ Linuxç³»ç»Ÿ
æ–‡ç« è·¯å¾„: 06-ğŸ§ Linuxç³»ç»Ÿ/07-ğŸš— Linuxé©±åŠ¨å¼€å‘æ ¸å¿ƒ(é‡è¦!!!)/05-ğŸš— Linuxé©±åŠ¨ç›¸å…³å­ç³»ç»Ÿ (é‡ç‚¹)/3_è®¾å¤‡æ ‘/1_Linuxä¹‹è®¾å¤‡æ ‘è¯¦è§£ï¼ˆè®­ç»ƒè¥ï¼‰/05_ğŸ“•è®¾å¤‡æ ‘ä¸­æ–­çš„å±æ€§æè¿° (æœ€å¸¸ç”¨).md
æ–‡ç« éš¾åº¦: ä¸­çº§ ğŸŒ³
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­ æ ¸å¿ƒèƒ½åŠ›
åˆ›å»ºæ—¶é—´: 2025-06-10 20:34:00
ä¿®æ”¹æ—¶é—´: 2025-06-11 14:31:59
---

## 1 RK ft5x06è®¾å¤‡æ ‘èŠ‚ç‚¹æ¡ˆä¾‹

åœ¨å­¦ä¹ è®¾å¤‡æ ‘ä¸­æ–­ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªå®é™…çš„ä¾‹å­ã€‚ä¸‹é¢å±•ç¤ºçš„æ˜¯ `RK3568` å¼€å‘æ¿ `SDK` æºç ä¸­çš„ `ft5x06` è®¾å¤‡æ ‘èŠ‚ç‚¹ï¼Œå…¶ä¸­è“è‰²å­—ä½“éƒ¨åˆ†å°±æ˜¯å…³äºä¸­æ–­ç›¸å…³çš„æè¿°ã€‚

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/2a8cc27baeb8f993dc6804a2d0048d4b.png)

> [!info]+ ä¸­æ–­ç›¸å…³çš„å››ä¸ªæ ¸å¿ƒå±æ€§
> 
> - **interrupts**ï¼šè®¾å¤‡ä½¿ç”¨çš„å…·ä½“ä¸­æ–­ä¿¡æ¯
> - **interrupt-controller**ï¼šæ ‡è¯†å½“å‰èŠ‚ç‚¹æ˜¯ä¸­æ–­æ§åˆ¶å™¨
> - **`#interrupt-cells`**ï¼šå®šä¹‰ä¸­æ–­å‚æ•°çš„ä¸ªæ•°
> - **interrupt-parent**ï¼šæŒ‡å‘ä¸­æ–­çš„æ¥æºï¼ˆå¦‚gpio0ã€gpio1ã€gpio2ç­‰ï¼‰

ä¸­æ–­ç›¸å…³å±æ€§å¯ä»¥å‚è€ƒï¼š[2.2 ä½¿ç”¨è®¾å¤‡æ ‘æè¿°ç¡¬ä»¶ä¸­æ–­ä¿¡æ¯](å‚è€ƒå†…å®¹/ä¸­æ–­ç³»ç»Ÿä¸­çš„è®¾å¤‡æ ‘.md#2.2%20ä½¿ç”¨è®¾å¤‡æ ‘æè¿°ç¡¬ä»¶ä¸­æ–­ä¿¡æ¯)

ç®€å•æ¥è¯´ï¼ŒGPIOï¼ˆé€šç”¨è¾“å…¥è¾“å‡ºï¼‰æœ‰å¾ˆå¤šç»„ï¼šgpio0ã€gpio1ã€gpio2ç­‰ï¼Œæ¯ç»„åŒ…å«32ä¸ªgpioå¼•è„šï¼Œåˆ†ä¸ºAã€Bã€Cã€Då››ä¸ªå­ç»„
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/06/cd1c14f8af3a27a8a8744ba589b7968a.png)

> [!tip]+ å®é™…å¼€å‘æµç¨‹ 
> å½“å¤–è®¾éœ€è¦ç»™æ¿å¡å‘é€ä¸­æ–­æ—¶ï¼Œå¼€å‘è€…éœ€è¦ï¼š
> 1. **çœ‹åŸç†å›¾** - ç¡®å®šç¡¬ä»¶è¿æ¥
> 2. **æ”¹è®¾å¤‡æ ‘** - é…ç½®ä¸­æ–­å±æ€§
> 3. **åŠ è½½é©±åŠ¨** - é€šè¿‡deconfigé…ç½®

## 2 interruptså±æ€§ï¼ˆè®¾å¤‡æ‰€ä½¿ç”¨çš„ä¸­æ–­ï¼‰

**interruptså±æ€§**ï¼šç”¨äºæŒ‡å®šè®¾å¤‡çš„ä¸­æ–­ç›¸å…³ä¿¡æ¯ï¼Œæè¿°äº†ä¸­æ–­æ§åˆ¶å™¨çš„ç±»å‹ã€ä¸­æ–­å·ä»¥åŠä¸­æ–­è§¦å‘ç±»å‹ã€‚

åœ¨ç¬¬ä¸€å°èŠ‚çš„è®¾å¤‡æ ‘æºç ä¸­ï¼Œgpio0èŠ‚ç‚¹å’Œft5x06èŠ‚ç‚¹éƒ½æ¶‰åŠåˆ°äº†interruptså±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/2684e77aa4ccd32f505f9292e0613d0e.png)

### 2.1 ä¸­æ–­æ§åˆ¶å™¨ç±»å‹ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰

> [!note]+ å¯é€‰å‚æ•°è¯´æ˜ 
> å¦‚æœè®¾å¤‡èŠ‚ç‚¹ä¸­æœ‰interrupt-parentå±æ€§ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥çœç•¥

- interruptså±æ€§çš„**ç¬¬ä¸€ä¸ªå‚æ•°**ï¼šæŒ‡å®šä¸­æ–­æ§åˆ¶å™¨çš„ç±»å‹
- **å¸¸è§ç±»å‹**ï¼š
    - **GIC (Generic Interrupt Controller)**ï¼šé€šç”¨ä¸­æ–­æ§åˆ¶å™¨
    - **IRQ (Basic Interrupt Handling)**ï¼šåŸºç¡€ä¸­æ–­å¤„ç†
    - ä¾‹å¦‚ï¼š`GIC_SPI`è¡¨ç¤ºä¸­æ–­æ§åˆ¶å™¨ç±»å‹ä¸ºGIC SPIä¸­æ–­

æ¢å¥è¯è¯´ï¼Œä¸­æ–­æ§åˆ¶å™¨å°±åƒä¸€ä¸ª"ä¸­è½¬ç«™"ï¼Œè´Ÿè´£ç®¡ç†ç³»ç»Ÿä¸­çš„æ‰€æœ‰ä¸­æ–­ä¿¡å·ï¼Œå¯ä»¥æ˜¯ç¡¬ä»¶ä¸­çš„ä¸“ç”¨ä¸­æ–­æ§åˆ¶å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤„ç†å™¨å†…éƒ¨çš„ä¸­æ–­æ§åˆ¶å™¨ã€‚

### 2.2 ä¸­æ–­å·ï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰

- interruptså±æ€§çš„**ç¬¬äºŒä¸ªå‚æ•°**ï¼šæŒ‡å®šè®¾å¤‡æ‰€ä½¿ç”¨çš„ä¸­æ–­å·
- **ä¸­æ–­å·**ï¼šæ˜¯ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„ä¸­æ–­ä¿¡å·æº
- ç³»ç»Ÿé€šè¿‡ä¸­æ–­å·æ¥è¯†åˆ«ä¸­æ–­æºå¹¶è¿›è¡Œç›¸åº”çš„ä¸­æ–­å¤„ç†
- ä¸­æ–­å·å¯ä»¥æ˜¯æ•´æ•°å€¼ã€å®å®šä¹‰æˆ–ç¬¦å·å¼•ç”¨

> [!example]+ å®é™…ç¤ºä¾‹ 
> åœ¨ä»£ç ç‰‡æ®µä¸­ï¼Œ`33`è¡¨ç¤ºè¯¥è®¾å¤‡ä½¿ç”¨çš„ä¸­æ–­å·ä¸º33

### 2.3 ä¸­æ–­è§¦å‘ç±»å‹ï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°ï¼‰

- interruptså±æ€§çš„**ç¬¬ä¸‰ä¸ªå‚æ•°**ï¼šæŒ‡å®šä¸­æ–­çš„è§¦å‘ç±»å‹ï¼Œå³ä¸­æ–­ä¿¡å·çš„è§¦å‘æ¡ä»¶

**è§¦å‘ç±»å‹åˆ†ä¸ºä¸¤å¤§ç±»**ï¼š
1. **è¾¹æ²¿è§¦å‘**ï¼šä¸­æ–­ä¿¡å·åœ¨ç”µå¹³å˜åŒ–æ—¶è§¦å‘
    - ä¸Šå‡æ²¿è§¦å‘ï¼šä»ä½ç”µå¹³åˆ°é«˜ç”µå¹³
    - ä¸‹é™æ²¿è§¦å‘ï¼šä»é«˜ç”µå¹³åˆ°ä½ç”µå¹³
    - åŒè¾¹æ²¿è§¦å‘ï¼šä»»ä½•ç”µå¹³å˜åŒ–éƒ½è§¦å‘
2. **ç”µå¹³è§¦å‘**ï¼šä¸­æ–­ä¿¡å·åœ¨ä¿æŒç‰¹å®šç”µå¹³çŠ¶æ€æ—¶è§¦å‘
    - é«˜ç”µå¹³è§¦å‘
    - ä½ç”µå¹³è§¦å‘

> [!example]+ ä»£ç ç¤ºä¾‹è¯´æ˜ 
> `IRQ_TYPE_LEVEL_HIGH`è¡¨ç¤ºä¸­æ–­çš„è§¦å‘ç±»å‹ä¸ºé«˜ç”µå¹³è§¦å‘

è§¦å‘ç±»å‹çš„å®å®šä¹‰ä½äº`å†…æ ¸æºç /include/dt-bindings/interrupt-controller/irq.h`ç›®å½•ä¸‹ï¼š
![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/0b03395996af0e98902f052b9c80f9f9.png)

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/28021b180e50e7b291c9795b60882bd8.png)

> [!question]+ å¸¸è§é—®é¢˜
> ä¸ºä»€ä¹ˆft5x06èŠ‚ç‚¹ä¸­åªæœ‰ä¸­æ–­å·å’Œä¸­æ–­è§¦å‘ç±»å‹ä¸¤ä¸ªå‚æ•°ï¼Ÿ
> è¿™æ˜¯å› ä¸ºft5x06èŠ‚ç‚¹ä½¿ç”¨äº†interrupt-parentå±æ€§æŒ‡å‘äº†gpio0ï¼Œçœç•¥äº†ç¬¬ä¸€ä¸ªå‚æ•°ã€‚

## 3 interrupt-controllerå±æ€§ï¼ˆå½“å‰è®¾å¤‡æ˜¯ä¸­æ–­æ§åˆ¶å™¨ï¼‰

**interrupt-controllerå±æ€§**ï¼šç”¨äºæ ‡è¯†å½“å‰èŠ‚ç‚¹æ‰€æè¿°çš„è®¾å¤‡æ˜¯ä¸€ä¸ªä¸­æ–­æ§åˆ¶å™¨

### 3.1 åŸºæœ¬æ¦‚å¿µ

ç®€å•æ¥è¯´ï¼Œ**ä¸­æ–­æ§åˆ¶å™¨**å°±åƒä¸€ä¸ª"äº¤é€šæŒ‡æŒ¥å‘˜"ï¼Œè´Ÿè´£ç®¡ç†å’Œåˆ†å‘ä¸­æ–­ä¿¡å·ã€‚å®ƒæ¥æ”¶æ¥è‡ªå„ç§è®¾å¤‡çš„ä¸­æ–­è¯·æ±‚ï¼Œå¹¶æ ¹æ®ä¼˜å…ˆçº§å’Œé…ç½®è§„åˆ™åˆ†å‘ä¸­æ–­ç»™ç›¸åº”çš„å¤„ç†å™¨æˆ–è®¾å¤‡

> [!important]+ é‡è¦ç‰¹ç‚¹ 
> interrupt-controllerå±æ€§æœ¬èº«æ²¡æœ‰ç‰¹å®šçš„å±æ€§å€¼ï¼Œåªéœ€å‡ºç°åœ¨èŠ‚ç‚¹çš„å±æ€§åˆ—è¡¨ä¸­å³å¯ã€‚
> è¯¥å±æ€§çš„å­˜åœ¨å³è¡¨ç¤ºè¯¥èŠ‚ç‚¹æè¿°çš„è®¾å¤‡æ˜¯ä¸­æ–­æ§åˆ¶å™¨ã€‚

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/683a2bc7747c5aabf7d5770ae91930f2.png)

### 3.2 å®é™…åº”ç”¨

åœ¨rk3568.dtsiä¸­ï¼Œåœ°å€`fdd60000`æ˜¯ç”±ç‘èŠ¯å¾®å®šä¹‰çš„ï¼Œé€šè¿‡èŠ¯ç‰‡æ‰‹å†Œå¯ä»¥æ‰¾åˆ°è¿™ä¸ªæ§åˆ¶å™¨çš„è¯¦ç»†æè¿°ã€‚

> [!tip]+ å¼€å‘æç¤º 
> åœ¨å®é™…å¼€å‘ä¸­ï¼Œè¿™äº›åœ°å€æ˜ å°„é€šå¸¸ç”±èŠ¯ç‰‡å‚å•†åœ¨BSPï¼ˆæ¿çº§æ”¯æŒåŒ…ï¼‰ä¸­é¢„å…ˆå®šä¹‰å¥½ï¼Œå¼€å‘è€…å¾ˆå°‘éœ€è¦ä¿®æ”¹ã€‚

## 4 interrupt-parentå±æ€§ï¼ˆè®¾å¤‡çš„ä¸­æ–­æ¥æºï¼‰

**interrupt-parentå±æ€§**ï¼šç”¨äºå»ºç«‹ä¸­æ–­ä¿¡å·æºä¸ä¸­æ–­æ§åˆ¶å™¨ä¹‹é—´å…³è”çš„å±æ€§ï¼ŒæŒ‡å®šäº†ä¸­æ–­ä¿¡å·æºæ‰€å±çš„ä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹ã€‚

### 4.1 å·¥ä½œåŸç†

æ¢å¥è¯è¯´ï¼Œinterrupt-parentå°±åƒä¸€ä¸ª"æŒ‡è·¯ç‰Œ"ï¼Œå‘Šè¯‰ç³»ç»Ÿè¿™ä¸ªè®¾å¤‡çš„ä¸­æ–­ä¿¡å·è¦å‘é€ç»™å“ªä¸ªä¸­æ–­æ§åˆ¶å™¨å¤„ç†ã€‚

é€šè¿‡æŒ‡å®šä¸­æ–­æ§åˆ¶å™¨ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æ­£ç¡®åœ°å°†ä¸­æ–­è¯·æ±‚ä¼ é€’ç»™ç›¸åº”çš„ä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹è¿›è¡Œå¤„ç†å’Œåˆ†å‘ã€‚

### 4.2 å±æ€§å€¼æ ¼å¼

interrupt-parentå±æ€§å€¼æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå®ƒæŒ‡å‘ä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹çš„è·¯å¾„æˆ–æ ‡ç­¾ï¼š
- **è·¯å¾„å¼•ç”¨**ï¼šå¦‚`/interrupt-controller-node`
- **æ ‡ç­¾å¼•ç”¨**ï¼šå¦‚`&interrupt-controller-label`

> [!example]+ å®é™…æ¡ˆä¾‹ 
> åœ¨ç¬¬ä¸€å°èŠ‚ä¾‹å­ä¸­çš„ft5x06å°±æ˜¯é€šè¿‡interrupt-parentå±æ€§å’Œgpio0ä¸­æ–­æ§åˆ¶å™¨å»ºç«‹äº†è”ç³»

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/bd392fce892415b757e30d13a68160d4.png)

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/4f217e6d92e1d767b430cf82e7192500.png)

## 5 interrupt-cellså±æ€§

**#interrupt-cellså±æ€§**ï¼šå®šä¹‰æè¿°è¯¥æ§åˆ¶å™¨ç®¡ç†çš„ä¸­æ–­æ‰€éœ€çš„cellæ•°é‡ï¼ˆå³å‚æ•°ä¸ªæ•°ï¼‰ã€‚

### 5.1 åŸºæœ¬ä½œç”¨

- **ä½œç”¨**ï¼šå®šä¹‰æè¿°è¯¥æ§åˆ¶å™¨ç®¡ç†çš„ä¸­æ–­æ‰€éœ€çš„**cellæ•°é‡**ï¼ˆå³å‚æ•°ä¸ªæ•°ï¼‰
- **ä½ç½®**ï¼šä»…å‡ºç°åœ¨ä¸­æ–­æ§åˆ¶å™¨èŠ‚ç‚¹ä¸­
- **ç¤ºä¾‹**ï¼š
  ```dts
  gpio0: gpio-controller {
      interrupt-controller;
      #interrupt-cells = <2>;  // æ¯ä¸ªä¸­æ–­ç”¨2ä¸ªcellæè¿°
  };
  ```

### 5.2 å…¸å‹å€¼è¯´æ˜

- **2 cells**ï¼šä¸­æ–­å· + è§¦å‘ç±»å‹ï¼ˆå¦‚`0x1`è¡¨ç¤ºè¾¹æ²¿è§¦å‘ï¼‰
- **3 cells**ï¼šå¯èƒ½åŒ…å«ä¼˜å…ˆçº§æˆ–é¢å¤–æ ‡å¿—ï¼ˆå¦‚ARM GICï¼‰

### 5.3 æ¿å¡å®ä¾‹åˆ†æ

è®©æˆ‘ä»¬é€šè¿‡å…·ä½“çš„æ¿å¡ä¾‹å­æ¥ç†è§£è¿™ä¸ªæ¦‚å¿µï¼š

![image.png|500|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/3885d4c71526e57eb9f1e6dfa6886b21.png)

![image.png|500|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2025/05/a4cb86151e61d2f2744d744cd5c7d541.png)


> [!abstract]+ å‚æ•°ä¸ªæ•°çš„å†³å®šå› ç´ 
> 
> - gpio0çš„ä¸­æ–­æ§åˆ¶å™¨ä¸ºgicï¼Œåœ¨gicèŠ‚ç‚¹ä¸­#interrupt-cellså±æ€§è¢«è®¾ç½®ä¸º3
> - è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨gpio0èŠ‚ç‚¹ä¸­interruptså±æ€§æœ‰3ä¸ªå€¼
> - è€Œft5x06çš„ä¸­æ–­æ§åˆ¶å™¨ä¸ºgpio0ï¼Œåœ¨gpio0èŠ‚ç‚¹ä¸­#interrupt-cellså±æ€§è¢«è®¾ç½®ä¸º2
> - æ‰€ä»¥ft5x06èŠ‚ç‚¹çš„interruptså±æ€§åªæœ‰2ä¸ªå€¼

ç®€å•æ¥è¯´ï¼Œ**ä¸Šçº§ä¸­æ–­æ§åˆ¶å™¨**çš„`#interrupt-cells`å†³å®šäº†**ä¸‹çº§è®¾å¤‡**çš„`interrupts`å±æ€§éœ€è¦å‡ ä¸ªå‚æ•°

## 6 ä¸­æ–­å±‚çº§ç»“æ„

### 6.1 å±‚çº§å…³ç³»è¯´æ˜

è®¾å¤‡æ ‘ä¸­çš„ä¸­æ–­ç³»ç»Ÿæ˜¯åˆ†å±‚çº§çš„ï¼Œå°±åƒä¸€ä¸ª"ç®¡ç†ä½“ç³»"ï¼š
- **è®¾å¤‡**é€šè¿‡`interrupt-parent`æŒ‡å‘æ§åˆ¶å™¨
- **æ§åˆ¶å™¨**é€šè¿‡`#interrupt-cells`å®šä¹‰å‚æ•°æ ¼å¼
- **è®¾å¤‡**ç”¨`interrupts`æä¾›å…·ä½“å€¼

### 6.2 å®Œæ•´ç¤ºä¾‹

```dts
// é¡¶çº§ä¸­æ–­æ§åˆ¶å™¨ï¼ˆå¦‚GICï¼‰
gic: interrupt-controller {
    interrupt-controller;
    #interrupt-cells = <3>;
};

// æ¬¡çº§ä¸­æ–­æ§åˆ¶å™¨ï¼ˆå¦‚GPIOï¼‰
gpio0: gpio-controller {
    interrupt-controller;
    #interrupt-cells = <2>;
    interrupt-parent = <&gic>;  // è‡ªèº«ä¸­æ–­ä¸ŠæŠ¥è‡³GIC
    interrupts = <0 10 4>;      // å‚æ•°æ ¼å¼ç”±GICçš„3 cellså†³å®š
};

// ç»ˆç«¯è®¾å¤‡
button {
    interrupt-parent = <&gpio0>;  // æŒ‡å‘GPIOæ§åˆ¶å™¨
    interrupts = <3 1>;          // å‚æ•°æ ¼å¼ç”±GPIOçš„2 cellså†³å®š
};
```

> [!note]+ å±‚çº§ç»“æ„ç†è§£ è¿™å°±åƒä¸€ä¸ªå…¬å¸çš„ç®¡ç†ç»“æ„ï¼š
> 
> - **GIC**æ˜¯æ€»ç»ç†ï¼ˆé¡¶çº§ç®¡ç†è€…ï¼‰
> - **GPIO**æ˜¯éƒ¨é—¨ç»ç†ï¼ˆä¸­çº§ç®¡ç†è€…ï¼‰
> - **Button**æ˜¯æ™®é€šå‘˜å·¥ï¼ˆç»ˆç«¯è®¾å¤‡ï¼‰
> 
> å‘˜å·¥çš„é—®é¢˜å…ˆæŠ¥å‘Šç»™éƒ¨é—¨ç»ç†ï¼Œéƒ¨é—¨ç»ç†å†æ ¹æ®éœ€è¦æŠ¥å‘Šç»™æ€»ç»ç†ã€‚

## 7 ä¸­æ–­çš„è§£æ

å†…æ ¸å¯¹ä¸­æ–­èµ„æºçš„è§£æå¯ä»¥å‚è€ƒæ–‡ç« ï¼š[5 ğŸ“•å†…æ ¸å¯¹è®¾å¤‡æ ‘ä¸­æ–­ä¿¡æ¯çš„å¤„ç†è¿‡ç¨‹](15_ğŸ“•ä¸­æ–­ç³»ç»Ÿä¸­çš„è®¾å¤‡æ ‘å’Œå†…æ ¸å¤„ç†è§£æ.md#5%20ğŸ“•å†…æ ¸å¯¹è®¾å¤‡æ ‘ä¸­æ–­ä¿¡æ¯çš„å¤„ç†è¿‡ç¨‹)

é©±åŠ¨ä½¿ç”¨ä¸­æ–­èµ„æºçš„APIï¼ˆofå‡½æ•°ï¼‰å¯ä»¥å‚è€ƒæ–‡ç« [é€šè¿‡OFå‡½æ•°è·å–ä¸­æ–­èµ„æº](å‚è€ƒå†…å®¹/é€šè¿‡OFå‡½æ•°è·å–ä¸­æ–­èµ„æº.md)

### 7.1 è§£ææµç¨‹æ€»ç»“

1. **è®¾å¤‡æ ‘å®šä¹‰**ï¼šåœ¨è®¾å¤‡æ ‘ä¸­å®šä¹‰ä¸­æ–­å±æ€§
2. **å†…æ ¸è§£æ**ï¼šå†…æ ¸å¯åŠ¨æ—¶è§£æè®¾å¤‡æ ‘ä¸­çš„ä¸­æ–­ä¿¡æ¯
3. **èµ„æºè·å–**ï¼šé©±åŠ¨ç¨‹åºé€šè¿‡OFå‡½æ•°è·å–ä¸­æ–­èµ„æº
4. **ä¸­æ–­æ³¨å†Œ**ï¼šå°†ä¸­æ–­å¤„ç†å‡½æ•°æ³¨å†Œåˆ°ç³»ç»Ÿä¸­
5. **ä¸­æ–­å¤„ç†**ï¼šå½“ä¸­æ–­å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿè°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°

> [!success]+ å­¦ä¹ æ€»ç»“ 
> é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œæˆ‘ä»¬æŒæ¡äº†è®¾å¤‡æ ‘ä¸­æ–­ç³»ç»Ÿçš„æ ¸å¿ƒæ¦‚å¿µï¼š
> - **interrupts**ï¼šå®šä¹‰è®¾å¤‡çš„ä¸­æ–­ä¿¡æ¯
> - **interrupt-controller**ï¼šæ ‡è¯†ä¸­æ–­æ§åˆ¶å™¨
> - **`#interrupt-cells`**ï¼šå®šä¹‰å‚æ•°æ ¼å¼
> - **interrupt-parent**ï¼šå»ºç«‹å±‚çº§å…³ç³»
> 
> è¿™å››ä¸ªå±æ€§ç›¸äº’é…åˆï¼Œæ„æˆäº†å®Œæ•´çš„ä¸­æ–­æè¿°ä½“ç³»ã€‚ç†è§£äº†è¿™äº›æ¦‚å¿µï¼Œå°±èƒ½å¤Ÿæ­£ç¡®é…ç½®å’Œè°ƒè¯•è®¾å¤‡æ ‘ä¸­çš„ä¸­æ–­é—®é¢˜ã€‚
