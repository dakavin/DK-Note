---
æ–‡ç« æ ‡é¢˜: "[[2_æ–‡ç« å½’æ¡£åˆ†é¡µæ¥å£å¼€å‘]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æœ¬æ–‡è¯¦è¿°æ–‡ç« å½’æ¡£åˆ†é¡µæ¥å£å¼€å‘ï¼Œæ¶µç›–éœ€æ±‚åˆ†æã€APIå®šä¹‰ã€åå°æœåŠ¡å®ç°ï¼ˆåˆ†é¡µæŸ¥è¯¢ã€æŒ‰æœˆåˆ†ç»„æ’åºã€DOè½¬VOï¼‰ï¼Œä»¥åŠSpring Booté›†æˆMapStructå’ŒJacksonå®šåˆ¶åŒ–åºåˆ—åŒ–ï¼Œç¡®ä¿æ—¥æœŸæ ¼å¼æ­£ç¡®ã€‚
æ–‡ç« æ ‡ç­¾:
- "Java"
- "Spring Boot"
- "RESTful API"
- "åˆ†é¡µ"
- "æ•°æ®å½’æ¡£"
- "MapStruct"
- "Jackson"
- "åç«¯å¼€å‘"
ç›¸å…³æ–‡ç« :
- "[[4_ğŸ“•å…¬å…±éƒ¨åˆ†ï¼šè·å–åšå®¢è®¾ç½®ä¿¡æ¯æ¥å£å¼€å‘]]"
- "[[6_ğŸ“•åšå®¢è®¾ç½®ï¼šè·å–è¯¦æƒ…æ¥å£å¼€å‘]]"
- "[[12_ğŸ“•æ–‡ç« ç®¡ç†ï¼šè·å–æ‰€æœ‰æ ‡ç­¾ Select åˆ—è¡¨æ¥å£å¼€å‘]]"
- "[[16_ğŸ“•è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯æ¥å£å¼€å‘]]"
- "[[3_ğŸ“•ä¾§è¾¹æ ï¼šè·å–åˆ†ç±»ã€æ ‡ç­¾åˆ—è¡¨æ¥å£å¼€å‘]]"
æ–‡ç« åˆ†ç±»: "ğŸš€ é¡¹ç›®å®æˆ˜"
æ–‡ç« è·¯å¾„: "10-ğŸš€ é¡¹ç›®å®æˆ˜/01-ğŸ“ åšå®¢ç³»ç»Ÿ/03-ğŸ“ å¼€å‘æ—¥å¿—/10_åšå®¢å‰å°ï¼šå½’æ¡£ã€åˆ†ç±»åˆ—è¡¨ã€æ ‡ç­¾åˆ—è¡¨é¡µé¢å¼€å‘/2_æ–‡ç« å½’æ¡£åˆ†é¡µæ¥å£å¼€å‘.md"
æ–‡ç« éš¾åº¦: åˆçº§ ğŸ’§
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­ æ ¸å¿ƒèƒ½åŠ›
åˆ›å»ºæ—¶é—´: 2024-05-15 22:36:01
ä¿®æ”¹æ—¶é—´: 2025-05-27 01:01:01
---

æœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å®Œæˆæ–‡ç« å½’æ¡£é¡µä¸­å”¯ä¸€ä¸€ä¸ªæ¥å£çš„å¼€å‘ â€”â€” è·å–å½’æ¡£åˆ†é¡µæ•°æ®æ¥å£ã€‚å…ˆæ¥çœ‹ä¸‹è¯¥é¡µçš„Â `UI`Â åŸå‹å›¾:

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/8eeedb1a3c6898ff9def5d4f7e9d103b.png)

## 1. é€»è¾‘åˆ†æ

åˆ†æä¸€ä¸‹Â `UI`Â åŸå‹å›¾é¡µé¢ä¸­æ‰€éœ€è¦å±•ç¤ºçš„æ•°æ®ï¼Œæ¥æ€è€ƒä¸€ä¸‹åå°è¦å¦‚ä½•ç»„åˆæ•°æ®ï¼Œé€»è¾‘å¦‚ä¸‹ï¼š

1. _åˆ†é¡µæŸ¥è¯¢æ–‡ç« è¡¨ï¼Œå¦‚ä¸€é¡µå±•ç¤º 10 ç¯‡æ–‡ç« ï¼›_
2. _å¯¹è¿™ 10 ç¯‡æ–‡ç« æŒ‰åˆ›å»ºçš„æœˆä»½è¿›è¡Œåˆ†ç±»ï¼Œå°†ä¸åŒæœˆä»½çš„æ–‡ç« ï¼Œåˆ†åˆ«æ”¾ç½®åˆ°ä¸åŒçš„é›†åˆä¸­ï¼Œå¹¶æŒ‰æœˆä»½è¿›è¡Œé™åºæ’åˆ—ï¼Œè¿”å›ç»™å‰ç«¯ï¼›_
## 2. æ¥å£ã€å‡ºå…¥å‚æ ¼å¼å®šä¹‰

### 2.1 æ¥å£è·¯å¾„

```http
POST /archive/list
```

### 2.2 å…¥å‚

```json
{
  "current":1, // å½“å‰é¡µç 
  "size": 10 // æ¯é¡µå±•ç¤ºçš„æ•°æ®é‡
}
```

### 2.3 å‡ºå‚

```json
{
  "success": true,
  "message": null,
  "errorCode": null,
  "data": [
    {
      "month": "2023-10", // å½’æ¡£æœˆä»½
      "articles": [ // è¯¥æœˆä»½ä¸‹çš„æ‰€æœ‰æ–‡ç« 
        {
          "id": 16, // æ–‡ç«  ID
          "cover": "https://img.quanxiaoha.com/quanxiaoha/193dd1504ebb4f138085acb23619e0dd.jpg", // å°é¢
          "title": "test", // æ–‡ç« æ ‡é¢˜
          "createDate": "2023-10-17" // å‘å¸ƒæ—¶é—´
        },
        {
          "id": 12,
          "cover": "https://img.quanxiaoha.com/quanxiaoha/193dd1504ebb4f138085acb23619e0dd.jpg",
          "title": "æµ‹è¯•",
          "createDate": "2023-10-14"
        }
      ]
    }
  ],
  "total": 4,
  "size": 10,
  "current": 1,
  "pages": 1
}
```

## 3. å·¥ç¨‹ç»“æ„

æœ¬å°èŠ‚ä¸­æ¶‰åŠæ–°å¢ã€ä¿®æ”¹çš„ç±»ä¸æ¥å£å¦‚ä¸‹ï¼š

![](https://img.quanxiaoha.com/quanxiaoha/169839040777521)

## 4. æ·»åŠ å‡ºå…¥å‚ VO

### 4.1 å…¥å‚ VO

æ¸…æ¥šäº†è¯¥æ¥å£çš„Â `JSON`Â å‡ºå…¥å‚æ ¼å¼åï¼Œæ‰“å¼€åç«¯å·¥ç¨‹ï¼Œå¹¶åˆ›å»ºå¯¹åº”çš„Â `VO`Â ç±»ã€‚åœ¨Â `weblog-web`Â æ¨¡å—ä¸­çš„Â `/model/vo`Â åŒ…ä¸‹åˆ›å»ºÂ `/archive`Â å½’æ¡£åŠŸèƒ½åŒ…ï¼Œå¹¶åˆ›å»ºå…¥å‚Â `VO`Â ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
@Data
@Builder
@ApiModel(value = "æ–‡ç« å½’æ¡£åˆ†é¡µ VO")
public class FindArchiveArticlePageListReqVO extends BasePageQuery {
}
```

å…¥å‚æ‰€éœ€çš„å½“å‰é¡µç ï¼Œä»¥åŠæ¯é¡µå±•ç¤ºçš„æ•°æ®é‡ï¼Œéƒ½åœ¨Â `BasePageQuery`Â ç±»ä¸­å°è£…å¥½äº†ï¼Œç›´æ¥ç»§æ‰¿å³å¯ï¼Œæ— éœ€é¢å¤–æ·»åŠ å­—æ®µã€‚

### 4.2 å‡ºå‚ VO

æ¥ä¸‹æ¥æ˜¯ä¸¤ä¸ªå…³è”çš„å‡ºå‚Â `VO`Â ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class FindArchiveArticlePageListRspVO {
    /**
     * å½’æ¡£çš„æœˆä»½
     */
    private YearMonth month;

    private List<FindArchiveArticleRspVO> articles;

}
```

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class FindArchiveArticleRspVO {
    private Long id;
    private String cover;
    private String title;
    /**
     * å‘å¸ƒæ—¥æœŸ
     */
    private LocalDate createDate;

    /**
     * å‘å¸ƒçš„æœˆä»½ï¼ˆæ­¤å­—æ®µä¸éœ€è¦å±•ç¤ºåœ¨å‰ç«¯ï¼Œä¸»è¦ç”¨äºæŒ‰æœˆä»½åˆ†ç»„ä½¿ç”¨ï¼‰
     */
    private YearMonth createMonth;
}
```

> æ³¨æ„ï¼Œå› ä¸ºéœ€è¦å±•ç¤ºå½’æ¡£çš„æœˆä»½ï¼Œå¦‚Â _2023-10_ï¼Œé’ˆå¯¹è¯¥ç±»å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Â `YearMonth`Â æ—¥æœŸç±»å‹ã€‚`YearMonth`Â æ˜¯ Java 8 ä¸­å¼•å…¥çš„æ—¥æœŸæ—¶é—´ç±»ï¼Œç”¨äºè¡¨ç¤ºå¹´ä»½å’Œæœˆä»½çš„ç»„åˆã€‚

## 5. æ–°å¢ service ä¸šåŠ¡å±‚

åœ¨Â `/service`Â åŒ…ä¸‹ï¼Œåˆ›å»ºå½’æ¡£ä¸šåŠ¡æ¥å£Â `ArchiveService`Â , å¹¶æ·»åŠ ä¸€ä¸ªè·å–æ–‡ç« å½’æ¡£åˆ†é¡µæ•°æ®çš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
public interface ArchiveService {
    /**
     * è·å–æ–‡ç« å½’æ¡£åˆ†é¡µæ•°æ®
     * @param findArchiveArticlePageListReqVO
     * @return
     */
    Response findArchivePageList(FindArchiveArticlePageListReqVO findArchiveArticlePageListReqVO);
}
```

ç„¶åï¼Œåœ¨Â `/impl`Â åŒ…ä¸‹åˆ›å»ºÂ `ArchiveServiceImpl`Â å®ç°ç±»ï¼Œå¹¶å®ç°ä¸Šè¿°æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
@Service
@Slf4j
public class ArchiveServiceImpl implements ArchiveService {

    @Autowired
    private ArticleMapper articleMapper;

    /**
     * è·å–æ–‡ç« å½’æ¡£åˆ†é¡µæ•°æ®
     *
     * @param findArchiveArticlePageListReqVO
     * @return
     */
    @Override
    public Response findArchivePageList(FindArchiveArticlePageListReqVO findArchiveArticlePageListReqVO) {
        Long current = findArchiveArticlePageListReqVO.getCurrent();
        Long size = findArchiveArticlePageListReqVO.getSize();

        // åˆ†é¡µæŸ¥è¯¢
        IPage<ArticleDO> page = articleMapper.selectPageList(current, size, null, null, null);
        List<ArticleDO> articleDOS = page.getRecords();

        List<FindArchiveArticlePageListRspVO> vos = Lists.newArrayList();
        if (!CollectionUtils.isEmpty(articleDOS)) {
            // DO è½¬ VO
            List<FindArchiveArticleRspVO> archiveArticleRspVOS =  articleDOS.stream()
                    .map(articleDO -> ArticleConvert.INSTANCE.convertDO2ArchiveArticleVO(articleDO))
                    .collect(Collectors.toList());

            // æŒ‰åˆ›å»ºçš„æœˆä»½è¿›è¡Œåˆ†ç»„
            Map<YearMonth, List<FindArchiveArticleRspVO>> map = archiveArticleRspVOS.stream().collect(Collectors.groupingBy(FindArchiveArticleRspVO::getCreateMonth));
            // ä½¿ç”¨ TreeMap æŒ‰æœˆä»½å€’åºæ’åˆ—
            Map<YearMonth, List<FindArchiveArticleRspVO>> sortedMap = new TreeMap<>(Collections.reverseOrder());
            sortedMap.putAll(map);

            // éå†æ’åºåçš„ Mapï¼Œå°†å…¶è½¬æ¢ä¸ºå½’æ¡£ VO
            sortedMap.forEach((k, v) -> vos.add(FindArchiveArticlePageListRspVO.builder().month(k).articles(v).build()));
        }

        return PageResponse.success(page, vos);
    }
}
```

ä¸Šè¿°ä¸šåŠ¡å®ç°ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¹æ–‡ç« è¡¨æ‰§è¡Œäº†åˆ†é¡µæŸ¥è¯¢æ“ä½œï¼Œå¦‚æœæŸ¥è¯¢çš„æ–‡ç« è®°å½•ä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™å°†æ–‡ç« Â `DO`Â ç±»è½¬æ¢ä¸ºÂ `FindArchiveArticlePageListRspVO`Â ç±»ï¼Œç„¶åï¼Œå¯¹å…¶æŒ‰Â `createMonth`Â å‘å¸ƒæœˆä»½è¿›è¡Œåˆ†ç»„ï¼Œå¹¶æ”¾ç½®åˆ°Â `Map`Â é›†åˆä¸­ï¼Œ`key`Â å€¼ä¸ºå‘å¸ƒæœˆä»½ã€‚ç”±äºÂ `Map`Â é›†åˆæ˜¯æ— åºçš„ï¼Œè€Œå‰ç«¯å±•ç¤ºéœ€è¦æŒ‰æœˆä»½å‘å¸ƒæ—¶é—´ï¼Œè¿›è¡Œé™åºæ’åˆ—ï¼Œä¸ºäº†å®ç°è¯¥æ•ˆæœï¼Œæˆ‘ä»¬é€šè¿‡Â `TreeMap`Â æŒ‰æœˆä»½å€’åºæ’åˆ—ã€‚æœ€åï¼Œå†å¯¹æ’åºåçš„Â `Map`Â è¿›è¡Œéå†ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå½’æ¡£Â `VO`Â è¿”å›ç»™å‰ç«¯ã€‚

### 5.1 convert è½¬æ¢æ¥å£

ä¸Šé¢çš„ä¸šåŠ¡æ–¹æ³•ä¸­ï¼Œè¿˜ä½¿ç”¨äº†Â `mapstruct`Â è½¬æ¢ï¼Œç¼–è¾‘Â `ArticleConvert`Â è½¬æ¢æ¥å£ï¼Œæ–°æ·»åŠ ä¸€ä¸ªå°†Â `DO`Â ç±»è½¬æ¢ä¸ºå½’æ¡£æ–‡ç« Â `VO`Â ç±»çš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
@Mapper
public interface ArticleConvert {
	// çœç•¥...

    /**
     * å°† DO è½¬åŒ–ä¸ºå½’æ¡£æ–‡ç«  VO
     * @param bean
     * @return
     */
    @Mapping(target = "createDate", expression = "java(java.time.LocalDate.from(bean.getCreateTime()))")
    @Mapping(target = "createMonth", expression = "java(java.time.YearMonth.from(bean.getCreateTime()))")
    FindArchiveArticleRspVO convertDO2ArchiveArticleVO(ArticleDO bean);

}
```

## 6. æ–°å¢ controller æ¥å£

ä¸šåŠ¡å±‚ä»£ç å¼€å‘å®Œæ¯•åï¼Œæˆ‘ä»¬åœ¨Â `/controller`Â åŒ…ä¸‹æ–°å¢Â `ArchiveController`Â å½’æ¡£æ§åˆ¶å™¨ï¼Œå¹¶æ·»åŠ Â `/archive/list`Â æ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
@RestController
@Api(tags = "æ–‡ç« å½’æ¡£")
public class ArchiveController {

    @Autowired
    private ArchiveService archiveService;

    @PostMapping("/archive/list")
    @ApiOperation(value = "è·å–æ–‡ç« å½’æ¡£åˆ†é¡µæ•°æ®")
    @ApiOperationLog(description = "è·å–æ–‡ç« å½’æ¡£åˆ†é¡µæ•°æ®")
    public Response findArchivePageList(@RequestBody FindArchiveArticlePageListReqVO findArchiveArticlePageListReqVO) {
        return archiveService.findArchivePageList(findArchiveArticlePageListReqVO);
    }

}
```

## 7. æµ‹è¯•çœ‹çœ‹

é‡å¯é¡¹ç›®ï¼Œæµè§ˆå™¨è®¿é—®Â `/doc.html`Â ï¼Œ æµ‹è¯•ä¸€æ³¢è¯¥æ¥å£åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼š

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/59d332bdb49a143f3e1f29824e07a4c5.png)

å¯ä»¥çœ‹åˆ°ï¼Œæ–‡ç« æ•°æ®æŒ‰æœˆä»½åˆ†ç±»è¿”å›æ—¶æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯é’ˆå¯¹Â `YearMonth`Â ç±»å‹çš„æ—¥æœŸå­—æ®µæ ¼å¼ä¸å¤ªå¯¹ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯Â `2023-10`Â è¿™æ ·çš„æ ¼å¼ï¼Œæ–¹ä¾¿å‰ç«¯ç›´æ¥å±•ç¤ºã€‚

## 8. å®šåˆ¶ Jackson åºåˆ—åŒ–

åœ¨å‰é¢çš„Â [3.12 å°èŠ‚](https://www.quanxiaoha.com/column/10016.html)Â ä¸­ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰äº†Â `Jackson`Â åºåˆ—åŒ–ï¼Œæ”¯æŒäº†Â `Java 8`Â æ–°çš„æ—¥æœŸÂ `API`Â , ä½†æ˜¯å¹¶æ²¡æœ‰æ”¯æŒÂ `YearMonth`Â è¿™ä¸ªç±»å‹ï¼Œä¸ºäº†æ”¯æŒè¯¥ç±»å‹ï¼Œéœ€æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

```java
// æ”¯æŒ YearMonth
javaTimeModule.addSerializer(YearMonth.class, new YearMonthSerializer(DateTimeFormatter.ofPattern("yyyy-MM")));
javaTimeModule.addDeserializer(YearMonth.class, new YearMonthDeserializer(DateTimeFormatter.ofPattern("yyyy-MM")));
```

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/4c7d98fb606393767ec345fcf56a68ec.png)


å†æ¬¡é‡å¯é¡¹ç›®æµ‹è¯•ä¸€ä¸‹è¯¥æ¥å£ï¼Œä½ ä¼šçœ‹åˆ°ç°åœ¨Â `YearMonth`Â ç±»å‹çš„å­—æ®µï¼Œ æ ¼å¼å±•ç¤ºå·²ç»æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœäº†ï¼š

![image.png|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/9f954e9d6ef8bf91b6d15b1d2c348115.png)