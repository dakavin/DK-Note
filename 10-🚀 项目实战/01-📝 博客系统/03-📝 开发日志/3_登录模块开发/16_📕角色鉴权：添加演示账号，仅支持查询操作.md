---
æ–‡ç« æ ‡é¢˜: "[[16_ğŸ“•è§’è‰²é‰´æƒï¼šæ·»åŠ æ¼”ç¤ºè´¦å·ï¼Œä»…æ”¯æŒæŸ¥è¯¢æ“ä½œ]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æ–‡ç« è¯¦è¿°åŸºäºSpring Securityå®ç°è§’è‰²é‰´æƒã€‚é€šè¿‡å¼•å…¥æ•°æ®åº“ç®¡ç†ç”¨æˆ·è§’è‰²ï¼ŒåŠ¨æ€åŠ è½½æƒé™ï¼Œå¹¶åˆ©ç”¨æ–¹æ³•çº§æ³¨è§£`@PreAuthorize`ï¼ŒæˆåŠŸä¸ºæ¼”ç¤ºç¯å¢ƒåˆ›å»ºäº†ä»…æ”¯æŒæŸ¥è¯¢çš„æ¸¸å®¢è´¦å·ï¼ŒåŒæ—¶å®šåˆ¶äº†é‰´æƒå¤±è´¥æç¤ºï¼Œæå‡äº†ç³»ç»Ÿå®‰å…¨æ€§ã€‚
æ–‡ç« æ ‡ç­¾:
- "Spring Security"
- "è§’è‰²é‰´æƒ"
- "æƒé™ç®¡ç†"
- "æ–¹æ³•çº§å®‰å…¨"
- "Spring Boot"
- "æ•°æ®åº“è®¾è®¡"
- "RBAC"
ç›¸å…³æ–‡ç« :
- "[[5_ğŸ“•æ•´åˆ Spring Security]]"
- "[[6_ğŸ“•Spring Security æ•´åˆ JWT ï¼šå®ç°èº«ä»½è®¤è¯]]"
- "[[7_ğŸ“•Spring Security æ•´åˆ JWT ï¼šå®ç°æ¥å£é‰´æƒ]]"
- "[[0_å‚è€ƒæ–‡ç« ç´¢å¼•]]"
- "[[0_å¯¼è¯»]]"
æ–‡ç« åˆ†ç±»: "ğŸš€ é¡¹ç›®å®æˆ˜"
æ–‡ç« è·¯å¾„: "10-ğŸš€ é¡¹ç›®å®æˆ˜/01-ğŸ“ åšå®¢ç³»ç»Ÿ/03-ğŸ“ å¼€å‘æ—¥å¿—/3_ç™»å½•æ¨¡å—å¼€å‘/16_ğŸ“•è§’è‰²é‰´æƒï¼šæ·»åŠ æ¼”ç¤ºè´¦å·ï¼Œä»…æ”¯æŒæŸ¥è¯¢æ“ä½œ.md"
æ–‡ç« éš¾åº¦: ä¸­çº§ ğŸŒ³
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­ æ ¸å¿ƒèƒ½åŠ›
åˆ›å»ºæ—¶é—´: 2024-04-25 20:56:44
ä¿®æ”¹æ—¶é—´: 2025-05-27 00:55:09
---

æœ¬å°èŠ‚å±äº_è¡¥å……å†…å®¹_ï¼Œå› ä¸ºæˆ‘æœ¬åœ°å¼€å‘çš„ä»£ç ï¼Œéœ€è¦å…¼é¡¾å‘å¸ƒåˆ°æ¼”ç¤ºç¯å¢ƒ

åœ¨æ¼”ç¤ºç¯å¢ƒä¸­ï¼Œé™¤äº†è¶…çº§ç®¡ç†å‘˜è§’è‰²å¤–ï¼Œä¸ºäº†æ–¹ä¾¿å°ä¼™ä¼´ä»¬ç™»å½•åå°æŸ¥çœ‹æ•ˆæœï¼Œæ‰€ä»¥ï¼Œè¿˜==é¢å¤–æ·»åŠ äº†ä¸€ä¸ªæ¸¸å®¢è´¦å·ï¼Œè¯¥è´¦å·çš„è§’è‰²ä¸ºæ¸¸å®¢ï¼Œä»…èƒ½æ‰§è¡ŒæŸ¥è¯¢ç›¸å…³æ“ä½œ==ï¼Œå¯¹äºæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤æ“ä½œéƒ½æ˜¯ä¸å…è®¸çš„ï¼Œé˜²æ­¢å°†æ¼”ç¤ºç¯å¢ƒçš„æ•°æ®æçš„ä¸€å›¢ç³Ÿã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“æ¸¸å®¢ç™»å½•åå°ç®¡ç†ç³»ç»Ÿåï¼Œå¹¶æ‰§è¡Œåˆ é™¤æ–‡ç« åˆ†ç±»æ“ä½œæ—¶ï¼Œä¼šè¢«åç«¯æœåŠ¡çš„Â `Spring Security`Â å®‰å…¨æ¡†æ¶é‰´æƒä¸é€šè¿‡ï¼Œå¹¶è¿”å›å‰ç«¯é”™è¯¯æç¤ºï¼š_æ¼”ç¤ºè´¦å·ä»…æ”¯æŒæŸ¥è¯¢æ“ä½œï¼_

![](https://img.quanxiaoha.com/quanxiaoha/169700671172110)

> PS : åç»­ä¸Šä¼ çš„å°èŠ‚ä»£ç ä¸­ï¼Œå¯èƒ½ä¼šå¸¦æœ‰è¯¥åŠŸèƒ½ï¼ŒæŸäº›å°ä¼™ä¼´ä¸‹è½½å°èŠ‚æºç åï¼Œåœ¨æœ¬åœ°è¿è¡Œæ—¶ï¼Œä¼šæŠ¥é”™Â `t_user_role`Â è§’è‰²è¡¨ä¸å­˜åœ¨ç­‰é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œå¹²è„†æŠŠè¿™å—çš„åŠŸèƒ½ä¹Ÿè®²è§£ä¸€ä¸‹ï¼Œé˜²æ­¢åç»­ä¸‹è½½å°èŠ‚æºç ï¼Œè·‘èµ·æ¥æŠ¥é”™ï¼Œæå¾—ä¸€å¤´é›¾æ°´ã€‚

OK , äº†è§£è¯¥åŠŸèƒ½çš„èƒŒæ™¯åï¼Œæˆ‘ä»¬å¼€å§‹ç€æ‰‹æ¥å®ç°å®ƒã€‚

## 1 å†™æ­»çš„è§’è‰²

è¿˜è®°å¾—å‰é¢å°èŠ‚å®ç°çš„ç”¨æˆ·è®¤è¯é‰´æƒåŠŸèƒ½å—ï¼Ÿåœ¨Â `UserDetailServiceImpl`Â è¿™ä¸ªç±»ä¸­Â `loadUserByUsername()`Â æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç”¨æˆ·åå»æ•°æ®åº“ä¸­æŸ¥è¯¢å¯¹åº”çš„ç”¨æˆ·è®°å½•ï¼Œå½“ç”¨æˆ·å­˜åœ¨æ—¶ï¼Œåˆ™è¿”å›ç”¨æˆ·è¯¦æƒ…å¯¹è±¡ï¼Œé‡Œé¢åŒ…æ‹¬äº†ç”¨æˆ·åã€å¯†ç ã€è§’è‰²ä¿¡æ¯ã€‚

![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/2b466efe57be6fb1cbb30470e0c2c16e.png)


è¿™é‡Œçš„Â `authorities`Â è§’è‰²ï¼Œæˆ‘ä»¬å†™æ­»çš„å­—ç¬¦ä¸²Â `ADMIN`, ç”¨äºè¡¨ç¤º _ç®¡ç†å‘˜_Â  è§’è‰²ã€‚ è¦æƒ³å®ç°æ¼”ç¤ºç”¨æˆ·åŠŸä»…æ”¯æŒæŸ¥è¯¢åŠŸèƒ½ï¼Œå°±éœ€è¦å›´ç»•å®ƒåšæ–‡ç« ã€‚

## 2 åˆ›å»ºè§’è‰²è¡¨

é¦–å…ˆï¼Œåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¼ è§’è‰²è¡¨ï¼Œ`ddl`Â å»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š

```mysql
CREATE TABLE `t_user_role` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'id',
  `username` varchar(60) NOT NULL COMMENT 'ç”¨æˆ·å',
  `role` varchar(60) NOT NULL COMMENT 'è§’è‰²',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_username` (`username`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=DYNAMIC COMMENT='ç”¨æˆ·è§’è‰²è¡¨';
```

è¯¥è¡¨ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡Â `username`Â ä½œä¸ºå…³è”å­—æ®µï¼Œå’ŒÂ `t_user`Â ç”¨æˆ·è®°å½•å…³è”èµ·æ¥ã€‚`role`Â å­—æ®µç”¨æ¥è¡¨ç¤ºè§’è‰²åç§°ã€‚ç”¨æˆ·è¡¨å’Œè§’è‰²è¡¨çš„å…³ç³»ä¸º _ä¸€å¯¹å¤š_ï¼Œä¸€ä¸ªç”¨æˆ·å¯èƒ½æœ‰å¤šä¸ªè§’è‰²ã€‚

### 2.1 æ–°å¢ä¸¤ä¸ªç”¨æˆ·

![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/9369e465d1909610080c3fa275ea6aef.png)

è¿™é‡Œç»™Â `t_user`Â ç”¨æˆ·è¡¨ä¿ç•™äº†ä¸¤æ¡è®°å½•ï¼Œ`admin`Â è¡¨ç¤ºç®¡ç†å‘˜è´¦å·ï¼Œ`test`Â è¡¨ç¤ºæ¼”ç¤ºè´¦å·ï¼š

> TIP : å¯¹åº”çš„åŠ å¯†å¯†ç ï¼Œå¯ä»¥é€šè¿‡Â `PasswordEncoderConfig`Â é…ç½®ç±»ä¸­çš„Â `main`Â æ–¹æ³•æ¥ç”Ÿæˆã€‚
> ![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/2908e5d85afcc0b92a783ce4b1c91532.png)

### 2.2 æ–°å¢å¯¹åº”çš„è§’è‰²è®°å½•

æ¥ä¸‹æ¥ï¼Œæ–°å¢æ¯ä¸ªè´¦å·å¯¹åº”çš„è§’è‰²è®°å½•ï¼ŒÂ `INSERT`Â è¯­å¥å¦‚ä¸‹ï¼š

```mysql
INSERT INTO `dkblog`.`t_user_role` (`id`, `username`, `role`, `create_time`) VALUES (1, 'admin', 'ROLE_ADMIN', '2023-07-07 01:21:15');
INSERT INTO `weblog`.`t_user_role` (`id`, `username`, `role`, `create_time`) VALUES (2, 'test', 'ROLE_VISITOR', '2023-07-07 01:23:33');
```

è¿™é‡Œï¼Œ`admin`Â è´¦å·å¯¹åº”çš„æ˜¯Â `ROLE_ADMIN`Â ç®¡ç†å‘˜è§’è‰²ï¼Œ`test`Â è´¦å·å¯¹åº”çš„æ˜¯Â `ROLE_VISITOR`Â æ¼”ç¤ºç”¨æˆ·ã€‚

## 3 åˆ›å»º DO ç±»å’Œ Mapper æ¥å£

è¡¨ã€è®°å½•æå®šåï¼Œæˆ‘ä»¬æ¥åˆ›å»ºå¯¹åº”çš„Â `DO`Â ç±»å’ŒÂ `Mapper`Â æ¥å£ï¼š

![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/07ac78bb05cc757da2cb160b098b441c.png)


åœ¨Â `weblog-module-common`Â æ¨¡å—ä¸‹çš„Â `/domain/dos`Â åŒ…ä¸­ï¼Œåˆ›å»ºå¯¹åº”çš„Â `DO`Â ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
@Data
@Builder
@TableName("t_user_role")
public class UserRoleDO {
    @TableId(type = IdType.AUTO)
    private Long id;
    private String username;
    private String role;
    private Date createTime;
}
```

åœ¨Â `/mapper`Â åŒ…ä¸‹ï¼Œåˆ›å»ºæ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
public interface UserRoleMapper extends BaseMapper<UserRoleDO> {
    /**
     * æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢
     * @param username
     * @return
     */
    default List<UserRoleDO> selectByUsername(String username) {
        LambdaQueryWrapper<UserRoleDO> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(UserRoleDO::getUsername, username);

        return selectList(wrapper);
    }
}
```

åœ¨æ¥å£ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªé»˜è®¤æ–¹æ³•Â `selectByUsername()`ï¼Œ é€šè¿‡ç”¨æˆ·åæŸ¥è¯¢è§’è‰²åˆ—è¡¨ã€‚

## 4 æ·»åŠ æŸ¥è¯¢è§’è‰²é€»è¾‘

ä¿®æ”¹Â `UserDetailServiceImpl`Â ç±»ä¸­çš„ä»£ç ï¼Œæ·»åŠ é€šè¿‡ç”¨æˆ·åæŸ¥è¯¢è§’è‰²çš„é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
@Service
@Slf4j
public class UserDetailServiceImpl implements UserDetailsService {

	// çœç•¥...
    @Autowired
    private UserRoleMapper userRoleMapper;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        // çœç•¥...

        // åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        if (Objects.isNull(userDO)) {
            throw new UsernameNotFoundException("è¯¥ç”¨æˆ·ä¸å­˜åœ¨");
        }

        // ç”¨æˆ·è§’è‰²
        List<UserRoleDO> roleDOS = userRoleMapper.selectByUsername(username);

        String[] roleArr = null;

        // è½¬æ•°ç»„
        if (!CollectionUtils.isEmpty(roleDOS)) {
            List<String> roles = roleDOS.stream().map(p -> p.getRole()).collect(Collectors.toList());
            roleArr = roles.toArray(new String[roles.size()]);
        }

        // authorities ç”¨äºæŒ‡å®šè§’è‰²
        return User.withUsername(userDO.getUsername())
                .password(userDO.getPassword())
                .authorities(roleArr)
                .build();
    }
}
```

è¿™é‡Œçš„Â `authorities`Â è§’è‰²å­—æ®µï¼Œæˆ‘ä»¬ä¸å†å†™æ­»ï¼Œè€Œæ˜¯æ”¹ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼Œå½“è§’è‰²ä¸ä¸ºç©ºæ—¶ï¼Œå°†å…¶è½¬æ¢ä¸ºæ•°ç»„ï¼Œå¹¶ä¼ å…¥åˆ°Â `authorities`Â å­—æ®µä¸­ã€‚

## 5 é‰´æƒä¸é€šè¿‡å“å‚æç¤º

`RestAccessDeniedHandler`Â ä¸“é—¨ç”¨äºå¤„ç†ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œä½†æ˜¯è®¿é—®çš„æ˜¯å—ä¿æŠ¤çš„èµ„æºï¼Œä¹‹å‰ï¼Œæˆ‘ä»¬ä»…ä»…æ‰“å°äº†ä¸€è¡Œè­¦å‘Šçº§åˆ«çš„æ—¥å¿—ï¼Œç°åœ¨æˆ‘ä»¬ç»™å®ƒä¸€ä¸ªé”™è¯¯è¿”å‚ï¼Œæç¤ºç”¨æˆ·Â _æ¼”ç¤ºè´¦å·ä»…æ”¯æŒæŸ¥è¯¢æ“ä½œï¼_ï¼Œ ä»£ç å¦‚ä¸‹ï¼š

```
@Slf4j
@Component
public class RestAccessDeniedHandler implements AccessDeniedHandler {

    @Override
    public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) throws IOException, ServletException {
        log.warn("ç™»å½•æˆåŠŸè®¿é—®æ”¶ä¿æŠ¤çš„èµ„æºï¼Œä½†æ˜¯æƒé™ä¸å¤Ÿ: ", accessDeniedException);
        // é¢„ç•™ï¼Œåé¢å¼•å…¥å¤šè§’è‰²æ—¶ä¼šç”¨åˆ°
        ResultUtil.fail(response, Response.fail(ResponseCodeEnum.FORBIDDEN));
    }
}
```

### 5.1 æ·»åŠ  FORBIDDEN æšä¸¾å€¼

è¿˜éœ€è¦åœ¨å…¨å±€æšä¸¾ç±»Â `ResponseCodeEnum`Â ä¸­æ·»åŠ Â `FORBIDDEN`Â æšä¸¾å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
FORBIDDEN("20004", "æ¼”ç¤ºè´¦å·ä»…æ”¯æŒæŸ¥è¯¢æ“ä½œï¼"),
```

## 6 å¯ç”¨ Spring Security æ–¹æ³•çº§æ³¨è§£

ç¼–è¾‘Â `WebSecurityConfig`Â é…ç½®ç±»ï¼Œæ·»åŠ Â `@EnableGlobalMethodSecurity`Â æ³¨è§£ï¼š

```java
// çœç•¥...
@EnableGlobalMethodSecurity(prePostEnabled = true, securedEnabled = true)
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
		// çœç•¥...
}
```

è§£é‡Šä¸€ä¸‹`@EnableGlobalMethodSecurity(prePostEnabled = true, securedEnabled = true)`ï¼šè¿™æ˜¯ä¸€ä¸ª Spring Security æ³¨è§£ï¼Œç”¨äº _å¯ç”¨æ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§è®¾ç½®_ã€‚`prePostEnabled = true`Â è¡¨ç¤ºå¯ç”¨Â `@PreAuthorize`Â å’ŒÂ `@PostAuthorize`Â æ³¨è§£ï¼Œ`securedEnabled = true`Â è¡¨ç¤ºå¯ç”¨Â `@Secured`Â æ³¨è§£ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä½¿ç”¨è¿™äº›æ³¨è§£æ¥å®šä¹‰è®¿é—®æ§åˆ¶è§„åˆ™ã€‚

## 7 å…¨å±€å¼‚å¸¸æ•è·

ä»¥ä¸Šè¿˜æ²¡å®Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨å…¨å±€å¼‚å¸¸æ•è·ç±»ä¸­å°†Â `AccessDeniedException`Â æ‰‹åŠ¨æŠ›å‡ºï¼Œå¦åˆ™å°±è¢«å®ƒç»™åäº†ã€‚è¿™é‡Œéœ€è¦ç»Ÿä¸€äº¤ç»™Â `RestAccessDeniedHandler`Â å»å¤„ç†ï¼š
```java
package com.quanxiaoha.weblog.common.exception;

import com.quanxiaoha.weblog.common.enums.ResponseCodeEnum;
import com.quanxiaoha.weblog.common.utils.Response;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;

import javax.servlet.http.HttpServletRequest;
import java.util.Optional;

@ControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    // çœç•¥...
	
    @ExceptionHandler({ AccessDeniedException.class })
    public void throwAccessDeniedException(AccessDeniedException e) throws AccessDeniedException {
    	// æ•è·åˆ°é‰´æƒå¤±è´¥å¼‚å¸¸ï¼Œä¸»åŠ¨æŠ›å‡ºï¼Œäº¤ç»™ RestAccessDeniedHandler å»å¤„ç†
        log.info("============= æ•è·åˆ° AccessDeniedException");
        throw e;
    }
}
```

> TIP : å¦‚æœÂ `AccessDeniedException.class`Â çˆ†çº¢ï¼Œå› ä¸ºå®ƒå±äºÂ `Spring Security`Â è¿™ä¸ªæ¡†æ¶ï¼Œä½ è¿˜éœ€è¦åœ¨Â `weblog-module-common`Â æ¨¡å—çš„Â `pom.xml`Â æ–‡ä»¶ä¸­ï¼Œæ·»åŠ Â `Spring Security`Â çš„ä¾èµ–ï¼š

```xml
<dependency>
> 	<groupId>org.springframework.boot</groupId>
> 	<artifactId>spring-boot-starter-security</artifactId>
> </dependency>
```

## 8 æ·»åŠ é‰´æƒæ³¨è§£

OK ï¼Œ åˆ°ä¸Šé¢ä¸ºæ­¢æ ¸å¿ƒä»£ç éƒ½æ·»åŠ å®Œæ¯•äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨Â `TestController`Â æ§åˆ¶å™¨ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„æ¥å£Â `/admin/update`Â , å¹¶å¯¹å…¶æ·»åŠ Â `@PreAuthorize("hasRole('ROLE_ADMIN')")`Â æ³¨è§£ï¼Œè¡¨ç¤ºåœ¨è°ƒç”¨æ¥å£ä¹‹å‰è¿›è¡Œé‰´æƒï¼Œå¿…é¡»æ˜¯æ‹¥æœ‰Â `ROLE_ADMIN`Â ç®¡ç†å‘˜è§’è‰²çš„è´¦å·å‘æ¥çš„è¯·æ±‚ï¼Œæ‰å…è®¸æ­£å¸¸æ‰§è¡Œï¼Œå¦åˆ™æç¤ºé‰´æƒä¸é€šè¿‡æç¤ºï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
@RestController
@Slf4j
@Api(tags = "é¦–é¡µæ¨¡å—")
public class TestController {

	// çœç•¥...

    @PostMapping("/admin/update")
    @ApiOperationLog(description = "æµ‹è¯•æ›´æ–°æ¥å£")
    @ApiOperation(value = "æµ‹è¯•æ›´æ–°æ¥å£")
    @PreAuthorize("hasRole('ROLE_ADMIN')")
    public Response testUpdate() {
        log.info("æ›´æ–°æˆåŠŸ...");
        return Response.success();
    }

}
```

## 9 æµ‹è¯•ä¸€ä¸‹

æœ€åï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼Œåˆ†åˆ«ç”¨ä¸¤ç§ä¸åŒè§’è‰²çš„è´¦æˆ·è¿›è¡Œç™»å½•ï¼Œè¯·æ±‚æ¥å£ï¼Œçœ‹çœ‹æ¼”ç¤ºè´¦å·æ˜¯å¦çœŸçš„é‰´æƒä¸é€šè¿‡ï¼Œç®¡ç†å‘˜å…¨éƒ¨æ”¾è¡Œï¼š

### 9.1 ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•æµ‹è¯•

é¦–å…ˆç™»å½•ç®¡ç†å‘˜è´¦å·ï¼Œæ‹¿åˆ°å¯¹åº”çš„Â `Token`Â ä»¤ç‰Œï¼š

![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8e9096c187c1b2b6d18d5177d5faf225.png)

### 9.2 å…¨å±€å‚æ•°è®¾ç½®

`knife4j`Â æä¾›äº†å…¨å±€å‚æ•°è®¾ç½®åŠŸèƒ½ã€‚è®©æˆ‘ä»¬å¯ä»¥å…¨å±€è®¾ç½®Â `Token`Â ä»¤ç‰Œï¼Œè¿™æ ·åç»­æ¯æ¬¡æ¥å£æµ‹è¯•ä¸­ï¼Œéƒ½ä¼šå¸¦ä¸Šå®ƒï¼Œæ— éœ€æ¯æ¬¡å•ç‹¬è®¾ç½®ã€‚æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š

![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8f41d93c1053f5abf4da34200940a192.png)


ç‚¹å‡»Â _æ–‡æ¡£ç®¡ç† | å…¨å±€å‚æ•°è®¾ç½® | æ·»åŠ å‚æ•°_Â ï¼š

![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/74575a25e0c3f262752960da3483d8b8.png)


æŒ‰ç…§åç«¯ç™»å½•æ¥å£çº¦å®šçš„æ ¼å¼ï¼Œæ·»åŠ è¯·æ±‚å¤´ï¼Œå¹¶å°†é€šè¿‡è¯·æ±‚ç™»å½•æ¥å£æ‹¿åˆ°çš„Â `Token`Â ä»¤ç‰Œè®¾ç½®åˆ°å‚æ•°å€¼ä¸­ï¼Œç‚¹å‡» _ç¡®å®š_ã€‚

ç„¶åï¼Œæˆ‘ä»¬ _åˆ·æ–°é¡µé¢ï¼Œåº”ç”¨æ–°çš„ä»¤ç‰Œ_ï¼Œé€šè¿‡è¯¥ä»¤ç‰Œåˆ†åˆ«è®¿é—®Â `/admin/test`Â å’ŒÂ `/admin/update`Â ä¸¤ä¸ªæ¥å£ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è¯·æ±‚ï¼š

![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b2559a673a9240bfdbc26ee042db1851.png)


å¯ä»¥çœ‹åˆ°æœ‰æ ¡éªŒæç¤ºä¿¡æ¯ï¼Œè¯´æ˜é‰´æƒæ˜¯é€šè¿‡çš„ï¼Œæ¥å£èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚å†æ¥æµ‹è¯•ä¸€ä¸‹å¸¦æœ‰é‰´æƒæ³¨è§£çš„Â `/admin/update`Â æ¥å£ï¼Œå›¾ç¤ºå¦‚ä¸‹ï¼š

![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8985513e0bc105cae689a51093cc23a9.png)


è¿”å‚æç¤ºæˆåŠŸï¼Œè¯´æ˜é‰´æƒé€šè¿‡ã€‚

### 9.3 ç”¨æ¸¸å®¢è´¦å·ç™»å½•æµ‹è¯•

å†æ¥ç”¨æ¸¸å®¢è´¦å·ç™»å½•ï¼Œé‡æ–°è·å–Â `Token`Â ä»¤ç‰Œï¼Œå¹¶è®¾ç½®åˆ°å…¨å±€å‚æ•°ä¸­ï¼Œ_è®°å¾—åˆ·æ–°é¡µé¢_ã€‚

![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7b5d7d163465c38119cdc9bef89af97f.png)


åˆ†åˆ«å†æ¬¡è¯·æ±‚ä¸¤ä¸ªæ¥å£ï¼Œçœ‹çœ‹æ•ˆæœï¼š

![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/bbe5bcec4ac93a65d8ca30df3cbb63b3.png)


![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/75fbc10b51aec3efd9374a31edde29df.png)


å½“æˆ‘ä»¬è¯·æ±‚Â `/admin/update`Â æ¥å£æ—¶ï¼Œå› ä¸ºè¯¥æ¥å£å¿…é¡»æ‹¥æœ‰Â `ROLE_ADMIN`Â è§’è‰²çš„ç”¨æˆ·æ‰èƒ½æ­£å¸¸è®¿é—®ï¼Œæ‰€ä»¥ï¼Œåç«¯è¿”å‚æç¤ºÂ _æ¼”ç¤ºè´¦å·ä»…æ”¯æŒæŸ¥è¯¢æ“ä½œï¼_

## 11 ç»“è¯­

æœ¬å°èŠ‚ä¸­ï¼Œå¸¦ç€å¤§å®¶ä¸ºåšå®¢æ·»åŠ äº†ä¸€ä¸ªæ¼”ç¤ºè´¦å·åŠŸèƒ½ï¼Œé€šè¿‡å¯¹ä¸åŒç”¨æˆ·åˆ†é…ä¸åŒçš„è§’è‰²ï¼Œä»¥åŠå¼€å¯Â `Spring Security`Â æ¡†æ¶çš„æ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§è®¾ç½®ï¼Œæ‰‹åŠ¨å¯¹éæŸ¥è¯¢æ¥å£æ·»åŠ Â `@PreAuthorize`Â é‰´æƒæ³¨è§£ï¼ŒæŒ‡å®šå¿…é¡»æ˜¯æ‹¥æœ‰Â `ROLE_ADMIN`Â ç®¡ç†å‘˜è§’è‰²æ‰å…è®¸æ“ä½œã€‚