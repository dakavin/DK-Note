---
æ–‡ç« æ ‡é¢˜: "[[18_Pinia-persist å®ç°Piniaæ•°æ®æŒä¹…åŒ–]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æ–‡ç« åˆ†æPiniaçŠ¶æ€æ•°æ®åˆ·æ–°ä¸¢å¤±é—®é¢˜ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨`pinia-plugin-persistedstate`æ’ä»¶å®ç°æ•°æ®æŒä¹…åŒ–ã€‚é€šè¿‡å…·ä½“å®ä¾‹æ¼”ç¤ºäº†ç®€å•çš„é…ç½®å’Œä»£ç ä¼˜åŒ–ï¼Œä»¥ä¿æŒç”¨æˆ·çŠ¶æ€å’Œè®¾ç½®ï¼Œæå‡åº”ç”¨ç”¨æˆ·ä½“éªŒã€‚
æ–‡ç« æ ‡ç­¾:
- "Pinia"
- "Vue.js"
- "æ•°æ®æŒä¹…åŒ–"
- "çŠ¶æ€ç®¡ç†"
- "Local Storage"
- "pinia-plugin-persistedstate"
- "å‰ç«¯å¼€å‘"
ç›¸å…³æ–‡ç« :
- "[[17_Pinia å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€åŠ¨æ€æ˜¾ç¤ºç™»å½•ç”¨æˆ·å]]"
- "[[4_æ•´åˆå…¨å±€çŠ¶æ€ç®¡ç†åº“ pinia]]"
- "[[16_Vue3 çŠ¶æ€ç®¡ç†pinia]]"
- "[[11_å­˜å‚¨ Token åˆ° Cookie ä¸­]]"
- "[[11_AdminTagListï¼šå…³é—­å…¶ä»–ã€å…¨éƒ¨æ ‡ç­¾é¡µ]]"
æ–‡ç« åˆ†ç±»: "ğŸš€ é¡¹ç›®å®æˆ˜"
æ–‡ç« è·¯å¾„: "10-ğŸš€ é¡¹ç›®å®æˆ˜/01-ğŸ“ åšå®¢ç³»ç»Ÿ/03-ğŸ“ å¼€å‘æ—¥å¿—/4_æ­å»ºç®¡ç†åå°éª¨æ¶/18_Pinia-persist å®ç°Piniaæ•°æ®æŒä¹…åŒ–.md"
æ–‡ç« éš¾åº¦: åˆçº§ ğŸ’§
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­ æ ¸å¿ƒèƒ½åŠ›
åˆ›å»ºæ—¶é—´: 2024-04-25 20:56:58
ä¿®æ”¹æ—¶é—´: 2025-05-27 00:55:39
---

æœ¬å°èŠ‚ä¸­ï¼Œå°å“ˆå°†å¸¦ç€å¤§å®¶å®ç° Pinia æ•°æ®çš„æŒä¹…åŒ–ã€‚åœ¨è¯´æ•°æ®æŒä¹…åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸ªä¸Šå°èŠ‚ä¸­å­˜åœ¨çš„é—®é¢˜ï¼š

## é—®é¢˜åˆ†æ

- 1ã€ä»”ç»†çœ‹ï¼Œå½“ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œ`AdminHeader`Â å¤´ä¸­æˆåŠŸæ¸²æŸ“äº†ç”¨æˆ·åï¼Œä½†æ˜¯ï¼Œ_å³é”®é‡æ–°åŠ è½½_ é¡µé¢åï¼Œ_ç”¨æˆ·åæ¶ˆå¤±äº†_Â ï¼

![](https://img.quanxiaoha.com/quanxiaoha/169493902177266)

2ã€è¿˜æœ‰ï¼Œå½“å·¦è¾¹ä¾§è¾¹æ è¢«æ”¶ç¼©èµ·æ¥åï¼Œ_å³é”®ç‚¹å‡»åŠ è½½_ é¡µé¢åï¼Œ_ä¾§è¾¹æ åˆè¢«å±•å¼€äº†_ï¼

![](https://img.quanxiaoha.com/quanxiaoha/169493914236129)

åŸå› éƒ½æ˜¯ Pinina çš„æ•°æ® _æ²¡æœ‰è¢«æŒä¹…åŒ–_ï¼Œå½“æˆ‘ä»¬é‡æ–°åŠ è½½é¡µé¢åï¼Œæ•°æ®å°±ä¸¢å¤±äº†ï¼Œ_é‡ç½®å›äº†åˆå§‹å€¼_ï¼Œå·¦è¾¹æ å®½åº¦è¢«é‡ç½®åˆ°äº†Â `250px`Â , ç™»å½•ç”¨æˆ·åè¢«é‡ç½®åˆ°äº†ç©ºå­—ç¬¦ä¸²ã€‚

## ä»€ä¹ˆæ˜¯ Pinia æ•°æ®æŒä¹…åŒ–ï¼Ÿ

Pinia æ•°æ®æŒä¹…åŒ–æ˜¯ä¸€ç§åœ¨ Vue 3 åº”ç”¨ç¨‹åºä¸­çš„çŠ¶æ€ç®¡ç†åº“ Pinia ä¸­çš„æ‰©å±•åŠŸèƒ½ã€‚å®ƒå…è®¸ä½ å°†åº”ç”¨ç¨‹åºçš„æŸäº›çŠ¶æ€æ•°æ®ä¿å­˜åˆ°æµè§ˆå™¨çš„æœ¬åœ°å­˜å‚¨ä¸­ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·å…³é—­æµè§ˆå™¨æ ‡ç­¾ã€åˆ·æ–°é¡µé¢æˆ–é‡æ–°è®¿é—®åº”ç”¨ç¨‹åºæ—¶ä»ç„¶å¯ä»¥è®¿é—®åˆ°è¿™äº›æ•°æ®ã€‚

åœ¨ä¸ä½¿ç”¨æ•°æ®æŒä¹…åŒ–çš„æƒ…å†µä¸‹ï¼Œå½“ç”¨æˆ·åˆ·æ–°é¡µé¢æˆ–å…³é—­æµè§ˆå™¨åï¼Œåº”ç”¨ç¨‹åºçš„çŠ¶æ€æ•°æ®é€šå¸¸ä¼šè¢«é‡ç½®ï¼Œç”¨æˆ·éœ€è¦é‡æ–°è¿›è¡Œç™»å½•æˆ–é‡æ–°é…ç½®åº”ç”¨ç¨‹åºçš„è®¾ç½®ã€‚==é€šè¿‡ä½¿ç”¨ Pinia æ•°æ®æŒä¹…åŒ–ï¼Œä½ å¯ä»¥ç¡®ä¿è¿™äº›å…³é”®çš„çŠ¶æ€æ•°æ®åœ¨ç”¨æˆ·ä¼šè¯ä¹‹é—´å¾—ä»¥ä¿ç•™ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ==ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦ Pinia æ•°æ®æŒä¹…åŒ–ï¼Ÿ

1. **ä¿æŒç”¨æˆ·ç™»å½•çŠ¶æ€ï¼š**Â åœ¨è®¸å¤šåº”ç”¨ç¨‹åºä¸­ï¼Œç”¨æˆ·çš„ç™»å½•çŠ¶æ€æ˜¯å…³é”®æ•°æ®ã€‚é€šè¿‡å°†ç”¨æˆ·çš„èº«ä»½éªŒè¯ä»¤ç‰Œæˆ–ç”¨æˆ·åç­‰ä¿¡æ¯ä¿å­˜åœ¨æœ¬åœ°å­˜å‚¨ä¸­ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…³é—­æµè§ˆå™¨æˆ–åˆ·æ–°é¡µé¢åä¿æŒç™»å½•çŠ¶æ€ï¼Œè€Œæ— éœ€é‡æ–°ç™»å½•ã€‚
2. **ä¿å­˜ç”¨æˆ·è®¾ç½®å’Œåå¥½ï¼š**Â ç”¨æˆ·å¯èƒ½ä¼šåœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œå„ç§è®¾ç½®å’Œé…ç½®ï¼Œä¾‹å¦‚é€‰æ‹©åº”ç”¨ç¨‹åºçš„ä¸»é¢˜ã€è¯­è¨€æˆ–å…¶ä»–åå¥½è®¾ç½®ã€‚é€šè¿‡å°†è¿™äº›è®¾ç½®ä¿å­˜åœ¨æœ¬åœ°å­˜å‚¨ä¸­ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä»¥åçš„ä¼šè¯ä¸­ä¿ç•™å…¶ä¸ªæ€§åŒ–è®¾ç½®ã€‚
3. **å‡å°‘æœåŠ¡å™¨è¯·æ±‚ï¼š**Â å¦‚æœæŸäº›æ•°æ®éœ€è¦åœ¨å¤šä¸ªç”¨æˆ·ä¼šè¯ä¹‹é—´å…±äº«ï¼Œå°†è¿™äº›æ•°æ®ä¿å­˜åœ¨æœ¬åœ°å­˜å‚¨ä¸­å¯ä»¥å‡å°‘å¯¹æœåŠ¡å™¨çš„è¯·æ±‚ã€‚è¿™å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼Œå¹¶æä¾›æ›´å¿«çš„ç”¨æˆ·ä½“éªŒã€‚
4. **ç¦»çº¿è®¿é—®ï¼š**Â æ•°æ®æŒä¹…åŒ–è¿˜ä½¿åº”ç”¨ç¨‹åºå…·å¤‡ä¸€å®šç¨‹åº¦çš„ç¦»çº¿è®¿é—®èƒ½åŠ›ã€‚ç”¨æˆ·å¯ä»¥åœ¨æ²¡æœ‰äº’è”ç½‘è¿æ¥çš„æƒ…å†µä¸‹è®¿é—®ä»¥å‰ä¿å­˜çš„æ•°æ®ã€‚

## ä¸‰ã€ä½¿ç”¨ Pinia æ•°æ®æŒä¹…åŒ–æ’ä»¶

æ¥ä¸‹æ¥ï¼Œå°å“ˆå°†ä»‹ç»å¦‚ä½•é€šè¿‡Â `pinia-persist`Â æ’ä»¶æ¥å®ç° Pinia æ•°æ®æŒä¹…åŒ–ã€‚å…³äºæ­¤æ’ä»¶æ›´è¯¦ç»†çš„æ–‡æ¡£ï¼Œå¯è®¿é—®[å®˜ç½‘](https://prazdevs.github.io/pinia-plugin-persistedstate/zh/)Â ã€‚

![](https://img.quanxiaoha.com/quanxiaoha/169494195570061)

### 3.1 å®‰è£…æ’ä»¶

1ã€æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ¥å®‰è£…æ’ä»¶ï¼š

```
npm i pinia-plugin-persistedstate
```

2ã€ç¼–è¾‘Â `main.js`Â æ–‡ä»¶ï¼Œå°†æ’ä»¶æ·»åŠ åˆ° Pinia å®ä¾‹ä¸Š:

```js
// çœç•¥...

// å¼•å…¥å…¨å±€çŠ¶æ€ç®¡ç† Pinia
import { createPinia } from 'pinia'
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'

// çœç•¥...

const pinia = createPinia()
pinia.use(piniaPluginPersistedstate)

// çœç•¥...
```

### 3.2 ç”¨æˆ·ä¿¡æ¯ Store æŒä¹…åŒ–

å®‰è£…å¥½æ’ä»¶åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¦å¦‚ä½•ä½¿ç”¨æŒä¹…åŒ–ã€‚å…ˆç»™Â `/stores/user.js`Â æ·»åŠ æŒä¹…åŒ–åŠŸèƒ½ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š

```js
export const useUserStore = defineStore('user', () => {
  // ç”¨æˆ·ä¿¡æ¯
  const userInfo = ref({})

  // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
  function setUserInfo() {
    // è°ƒç”¨åå¤´è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£
    getUserInfo().then(res => {
      if (res.success == true) {
        userInfo.value = res.data
      }
    })
  }

  return { userInfo, setUserInfo }
}, 
{
  // å¼€å¯æŒä¹…åŒ–
  persist: true,
}
)
```

ä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸ç®€å•ï¼Œæ·»åŠ Â `persist: true`Â å£°æ˜åï¼Œè¿™ä¸ªÂ `store`Â å°±ä¼šæŠŠå¯¹åº”çš„æ•°æ®å­˜å‚¨åˆ°Â `Local Storage`Â ä¸­ã€‚ä½ å¯ä»¥æµ‹è¯•çœ‹çœ‹ï¼Œé‡æ–°ç™»å½•åï¼Œé€šè¿‡Â _F12_Â æ‰“å¼€æ§åˆ¶å°ï¼Œä¾æ¬¡ç‚¹å‡»Â _Application | Storage | Local Storage_Â æ‰¾åˆ°å­˜å‚¨çš„æ•°æ®ï¼š

![](https://img.quanxiaoha.com/quanxiaoha/169494365503226)

å†æ¬¡åˆ·æ–°é¡µé¢ï¼Œä½ ä¼šå‘ç°ç”¨æˆ·åå°±ä¸ä¼šè¢«é‡ç½®å›å»å•¦~

### 3.3 èœå•ä¿¡æ¯ Store æŒä¹…åŒ–

èœå•Â `store`Â åŒæ ·ä»¥ä¸Šè¿°æ–¹å¼ï¼Œæ¥å¼€å¯æŒä¹…åŒ–åŠŸèƒ½ï¼Œç¼–è¾‘Â `menu.js`Â , æ·»åŠ æŒä¹…åŒ–å£°æ˜:

```js
export const useMenuStore = defineStore('menu', () => {
  // å·¦è¾¹æ èœå•é»˜è®¤å®½åº¦
  const menuWidth = ref("250px")
  
  // å±•å¼€æˆ–ä¼¸ç¼©å·¦è¾¹æ èœå•
  function handleMenuWidth() {
      menuWidth.value = menuWidth.value == '250px' ? '64px' : '250px'
  }
  
  return { menuWidth, handleMenuWidth }
}, 
{
  // å¼€å¯æŒä¹…åŒ–
  persist: true,
}
)
```

å¼€å¯å®Œæˆåï¼Œå½“å·¦ä¾§æ è¢«æ”¶ç¼©èµ·æ¥åï¼Œå†æ¬¡é‡æ–°åŠ è½½é¡µé¢ï¼Œä¼šçœ‹åˆ°è¿˜æ˜¯å¤„äºæ”¶ç¼©çŠ¶æ€ã€‚

## å››ã€ä»£ç ä¼˜åŒ–

### 4.1 å°è£… Pinia ç›¸å…³ä»£ç 

è¿™é‡Œæˆ‘ä»¬å¯ä»¥å°† Pinia å®ä¾‹åˆå§‹åŒ–ã€æŒä¹…åŒ–æ’ä»¶æŒ‚è½½ç›¸å…³çš„ä»£ç ç»Ÿä¸€æŠ½å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­æ¥ç®¡ç†ã€‚åœ¨Â `/stores`Â æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºÂ `index.js`Â æ–‡ä»¶ï¼Œå°†Â `main.js`Â ä¸­å’Œ Pinia ç›¸å…³çš„ä»£ç æŠ½å–å‡ºæ¥ï¼š

![](https://img.quanxiaoha.com/quanxiaoha/169494449083854)

```js
// å¼•å…¥å…¨å±€çŠ¶æ€ç®¡ç† Pinia
import { createPinia } from 'pinia'
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'

const pinia = createPinia()
// æŒä¹…åŒ–æ’ä»¶
pinia.use(piniaPluginPersistedstate)

// æš´éœ²å‡ºå»
export default pinia
```

æœ€åï¼Œé€šè¿‡Â `export`Â å…³é”®è¯å°† Pinia å®ä¾‹æš´éœ²å‡ºå»ã€‚

### 4.2 main.js å¼•ç”¨ Pinia å®ä¾‹

ä¿®æ”¹Â `main.js`Â , å¼•å…¥åˆšåˆšåˆ›å»ºçš„ Pinia å®ä¾‹ï¼š

```
// å¼•å…¥å…¨å±€çŠ¶æ€ç®¡ç† Pinia
import pinia from '@/stores'
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™æ · Pinia åˆå§‹åŒ–ï¼Œä»¥åŠæŒ‚è½½æŒä¹…åŒ–æ’ä»¶ç›¸å…³çš„å·¥ä½œå°±ä¸ç”¨å†™åœ¨Â `main.js`Â ä¸­äº†ï¼Œä»£ç çœ‹èµ·æ¥æ›´æ¸…çˆ½ä¸€äº›ï¼š

![](https://img.quanxiaoha.com/quanxiaoha/169494434113761)

## äº”ã€æ€»ç»“

æœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦é€šè¿‡ Pinia æ•°æ®æŒä¹…åŒ–æ’ä»¶Â `pinia-persist`Â å°†å…¨å±€çŠ¶æ€æŒä¹…åŒ–åˆ°äº†Â `Local Storage`Â ä¸­ï¼Œè¿™æ ·æ— è®ºç”¨æˆ·æ˜¯é‡æ–°åŠ è½½é¡µé¢ï¼Œè¿˜æ˜¯å…³é—­æµè§ˆå™¨ï¼Œæ•°æ®éƒ½è¢«ç¼“å­˜èµ·æ¥äº†ï¼Œä¸ä¼šå¯¼è‡´é¡µé¢å†æ¬¡æ‰“å¼€æ—¶ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚