---
æ–‡ç« æ ‡é¢˜: "[[3_å®‰è£…Nginx]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æ–‡ç« è¯¦ç»†æŒ‡å¯¼åˆ©ç”¨Dockerå®‰è£…å’Œé…ç½®Nginxï¼Œæ ¸å¿ƒæ˜¯ä½¿ç”¨æŒä¹…åŒ–æ•°æ®å·å’Œ`conf.d`ç›®å½•å®ç°å¤šé¡¹ç›®ç®¡ç†ã€‚æä¾›äº†ä»æ‹‰å–é•œåƒã€åˆæ¬¡è¿è¡Œã€å¤åˆ¶é…ç½®åˆ°å®¿ä¸»æœºï¼Œåˆ°æœ€ç»ˆå¯åŠ¨å¸¦å®Œæ•´æ•°æ®å·å’Œç«¯å£æ˜ å°„Nginxå®¹å™¨çš„å®Œæ•´æ“ä½œã€‚
tags:
- "Nginx"
- "Docker"
- "å®¹å™¨éƒ¨ç½²"
- "æ•°æ®å·"
- "WebæœåŠ¡å™¨"
- "é…ç½®æ–‡ä»¶"
- "æŒä¹…åŒ–å­˜å‚¨"
ç›¸å…³æ–‡ç« :
- "[[7_Part5ï¼ˆéƒ¨ç½²ï¼‰]]"
- "[[9_æ€»ç»“]]"
- "[[1_å‰è¨€]]"
- "[[2_å…³äºDockeré¡¹ç›®åŸŸåé—®é¢˜]]"
- "[[3_å§¿åŠ¿2ï¼šDockeréƒ¨ç½²é¡¹ç›®]]"
æ–‡ç« åˆ†ç±»: "ğŸ› ï¸ å¼€å‘å·¥å…·å’ŒOSç›¸å…³"
æ–‡ç« è·¯å¾„: "08-ğŸ› ï¸ å¼€å‘å·¥å…·å’ŒOSç›¸å…³/03-ğŸ‹ å®¹å™¨åŒ–/01-ğŸ“š DockeråŸºç¡€/9_å¸¸è§ç¯å¢ƒå®‰è£…/3_å®‰è£…Nginx.md"
æ–‡ç« éš¾åº¦: åˆçº§ ğŸ’§
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­â­ ç²¾é€šå¿…å¤‡
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2025-05-28 01:03:09
---


å› ä¸ºä¸ªäººå¯¹nginxç†è§£æœ‰é™ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºæ–¹æ¡ˆ

ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆä¹‹å‰ï¼Œéœ€è¦åœæ­¢ä¹‹å‰çš„homeé¡¹ç›®ï¼Œå› ä¸ºè¿™ä¸ªhomeé¡¹ç›®æŒ‚è½½äº†nginxé•œåƒï¼Œç«¯å£ä¸º80ï¼Œå ç”¨äº†æˆ‘ä»¬åç»­è¿è¡Œçš„nginxå®¹å™¨
```shell
# æš‚åœhomeå®¹å™¨ï¼ˆäºŒé€‰ä¸€ï¼‰
docker stop home
# åˆ é™¤homeå®¹å™¨ï¼ˆäºŒé€‰ä¸€ï¼Œå»ºè®®ç›´æ¥åˆ é™¤ï¼‰
docker rm -f home
```

åç«¯é¡¹ç›®çš„å®¹å™¨ä¸éœ€è¦åœæ­¢/åˆ é™¤ï¼Œæ”¾ç€å°±å¥½äº†
## 1 æ€è·¯

ç¬¬ä¸€æ­¥ï¼šæˆ‘ä»¬å¯ä»¥ç±»ä¼¼äºå®å¡”éƒ¨ç½²å¤šä¸ªé¡¹ç›®é‚£æ ·ï¼ŒåŸºäºä¸€ä¸ªnginxæœåŠ¡ï¼Œç„¶åæ¯ä¸ªé¡¹ç›®éƒ½æœ‰å…¶ç‹¬ç«‹çš„xxx.confé…ç½®æ–‡ä»¶
- åŸå› è§£é‡Šï¼šåœ¨nginxçš„é…ç½®æ–‡ä»¶ `/etc/nginx/nginx.conf` ä¸­æœ‰ä»¥ä¸‹å­—æ®µï¼Œå¯ä»¥è¯»å– `/etc/nginx/conf.d` ç›®å½•ä¸‹ä»»ä½•ä»¥ `.conf` ä¸ºåç¼€çš„é…ç½®æ–‡ä»¶
  ![image.png|500|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/bfa15e479afc8e943a417a402741e65f.png)
ç¬¬äºŒæ­¥ï¼šåˆ†ænginxéœ€è¦æŒ‚è½½çš„æ•°æ®å·


| æ•°æ®å·åœ¨æœåŠ¡å™¨çš„ä½ç½®                    | æ˜ å°„nginxå®¹å™¨çš„ä½ç½®          |
| ----------------------------- | --------------------- |
| /docker-data/nginx/cert       | /etc/nginx/cert       |
| /docker-data/nginx/conf.d     | /etc/nginx/conf.d     |
| /docker-data/nginx/nginx.conf | /etc/nginx/nginx.conf |
| /docker-data/nginx/html       | /usr/share/nginx/html |
| /docker-data/nginx/logs       | /var/log/nginx        |

- certï¼šå­˜æ”¾å„ä¸ªé¡¹ç›®çš„SSLè¯ä¹¦
- conf.dï¼šå­˜æ”¾å„ä¸ªé¡¹ç›®çš„confé…ç½®æ–‡ä»¶
- nginx.confï¼šé»˜è®¤çš„é…ç½®æ–‡ä»¶
- htmlï¼šå­˜æ”¾å‰ç«¯é¡¹ç›®æ‰“åŒ…å¥½çš„å†…å®¹ï¼ˆå³distç›®å½•ä¸‹çš„å†…å®¹ï¼‰
- logsï¼šnginxå®¹å™¨è¿è¡Œçš„æ—¥å¿—

ç¬¬ä¸‰æ­¥ï¼šé…ç½®æˆ‘ä»¬çš„nginxå®¹å™¨ï¼Œè§ä¸‹é¢è®²è§£
## 2 Dockerå®‰è£…Nginxå®¹å™¨

**ä¸‹è½½ Nginx é•œåƒ**

```shell
docker pull nginx:latest
```

> PSï¼šè¿™é‡Œä¸‹è½½çš„æ˜¯æœ€æ–° ç‰ˆæœ¬ Nginx é•œåƒï¼Œä½ å¯ä»¥åœ¨Â [Docker Hub](https://hub.docker.com/ "Docker Hub")Â ä¸ŠæŸ¥æ‰¾ä½ æƒ³è¦çš„å¯ç”¨ç‰ˆæœ¬é•œåƒã€‚

å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œé€šè¿‡Â `docker images`Â å‘½ä»¤æ£€æŸ¥ä¸€ä¸‹é•œåƒæ˜¯å¦ä¸‹è½½æˆåŠŸï¼š

![image.png|500|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/3c0ba14efd643dd071c081a9abf19d9f.png)

---

**è¿è¡Œ Nginx å®¹å™¨**

```bash
docker run -d -p 80:80 --name nginx nginx:latest
```

å‚æ•°è¯´æ˜ï¼š
- `-p 80:80`: å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ 80 ç«¯å£ä¸Šï¼›
- `-d`: ä»¥åå°æ–¹å¼è¿è¡Œé•œåƒï¼›
- `--name`: æŒ‡å®šå®¹å™¨çš„åç§°ä¸º nginx;

å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œé€šè¿‡Â `docker ps`å‘½ä»¤ç¡®è®¤ä¸€ä¸‹å®¹å™¨æ˜¯å¦å¯åŠ¨æˆåŠŸ

![image.png|500|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/6b5a62276e3f2e8fed43356e6071e207.png)

Nginx å®¹å™¨è¿è¡ŒæˆåŠŸåï¼Œè®¿é—®Â `http://æœåŠ¡å™¨ipåœ°å€`ï¼Œå³å¯çœ‹åˆ° Nginx æ¬¢è¿é¡µé¢ï¼š

> æç¤ºï¼šè®¿é—®Â `http://æœåŠ¡å™¨ipåœ°å€`Â åœ¨ä¸æŒ‡å®šç«¯å£çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ç«¯å£å·ä¸º 80

![image.png|500|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/a65a5bf1270f85b5c53224059eced27e.png)

---

**å¤åˆ¶ Nginx é…ç½®æ–‡ä»¶è‡³å®¿ä¸»æœº**

å› ä¸ºå®¹å™¨é‡å¯ä¼šä¸¢å¤±å†…éƒ¨æ•°æ®ï¼Œå› æ­¤è¦å°†éœ€è¦æŒä¹…åŒ–çš„æ–‡ä»¶æŒ‚è½½åˆ°å®¿ä¸»æœºä¸­ï¼Œä»¥é˜²æ•°æ®ä¸¢å¤±ã€‚

æŒ‚è½½ä¹‹å‰ï¼Œå¤åˆ¶å®¹å™¨ä¸­éœ€è¦æŒä¹…åŒ–çš„ç›¸å…³é…ç½®æ–‡ä»¶åˆ°å®¿ä¸»æœºçš„æŒ‡å®šè·¯å¾„ä¸‹ï¼š

```bash
# å¤åˆ¶åç§°ä¸º nginx å®¹å™¨ä¸­ /etc/nginx/nginx.conf æ–‡ä»¶å¤¹åˆ°å®¿ä¸»æœºçš„ /docker-data/nginx è·¯å¾„ä¸‹ï¼Œå®¿ä¸»æœºçš„æŒä¹…åŒ–ç›®å½•æ ¹æ®ä½ çš„éœ€è¦è‡ªå®šä¹‰è·¯å¾„
docker cp nginx:/etc/nginx/nginx.conf /docker-data/nginx
# å¤åˆ¶åç§°ä¸º nginx å®¹å™¨ä¸­ /etc/nginx/conf.d æ–‡ä»¶åˆ°å®¿ä¸»æœºçš„ /docker-data/nginx è·¯å¾„ä¸‹
docker cp nginx:/etc/nginx/conf.d /docker-data/nginx
```

å¤åˆ¶å®Œæˆåï¼ŒæŸ¥çœ‹æŒ‡å®šè·¯å¾„çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š

![image.png|500|500](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/199edd1c91d1977df9d458fba13a5881.png)

å…¶ä»–æ–‡ä»¶å¤¹å’Œæ–‡ä»¶çš„é…ç½®ï¼Œå¾€ä¸‹çœ‹ï¼

---

**é…ç½® `/docker-data/nginx` ç›®å½•ï¼Œåˆ›å»ºå…¶ä»–æ–‡ä»¶å’Œæ–‡ä»¶å¤¹**

```shell
# åˆ›å»ºcertæ–‡ä»¶å¤¹
mkdir -p /docker-data/nginx/cert

# åˆ›å»ºhtmlæ–‡ä»¶å¤¹
mkdir -p /docker-data/nginx/html

# åˆ›å»ºlogsæ–‡ä»¶å¤¹
mkdir -p /docker-data/nginx/logs
```

---

**åˆ é™¤åˆšåˆšå¯åŠ¨çš„ Nginx å®¹å™¨ï¼Œæ–°å¯åŠ¨ä¸€ä¸ª**

å…ˆåˆ é™¤ä¹‹å‰å¯åŠ¨çš„ nginx å®¹å™¨ï¼š

```bash
docker rm -f nginx
```

å®Œæˆåï¼Œæ‰§è¡Œå¯åŠ¨ Nginx å®¹å™¨å‘½ä»¤ï¼š

```bash
docker run -d \
  --name nginx \
  -p 80:80 \
  -p 443:443 \
  -e TZ=Asia/Shanghai \
  -v /docker-data/nginx/html:/usr/share/nginx/html \
  -v /docker-data/nginx/logs:/var/log/nginx \
  -v /docker-data/nginx/cert:/etc/nginx/cert \
  -v /docker-data/nginx/conf.d:/etc/nginx/conf.d \
  -v /docker-data/nginx/nginx.conf:/etc/nginx/nginx.conf \
  -v /etc/localtime:/etc/localtime:ro \
  --restart no \
  nginx:latest nginx -g "daemon off;"


```

å‚æ•°è¯´æ˜ï¼š
- `-d: `å®¹å™¨å°†åœ¨åå°è¿è¡Œã€‚
- `--name nginx: `å®¹å™¨å°†è¢«å‘½åä¸º `nginx`ã€‚
- `-p 80:80 å’Œ -p 443:443: `æ˜ å°„ç«¯å£ 80 å’Œ 443ï¼Œåˆ†åˆ«ç”¨äº HTTP å’Œ HTTPS é€šä¿¡ã€‚
- `-v: `å°†ä¸»æœºä¸Šçš„ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„æŒ‡å®šè·¯å¾„ã€‚è¿™åŒ…æ‹¬è¯ä¹¦ã€é…ç½®æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶å’Œ HTML æ–‡ä»¶ã€‚
- `--restart no: `å®¹å™¨é€€å‡ºæ—¶ä¸ä¼šè‡ªåŠ¨é‡å¯ã€‚
- `nginx:latest: `ä½¿ç”¨æœ€æ–°çš„å®˜æ–¹ Nginx é•œåƒã€‚
- `nginx -g "daemon off;": `å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œ`nginx -g "daemon off;"` æ˜¯è®© Nginx å‰å°è¿è¡Œï¼Œé˜²æ­¢å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡ºã€‚
- `-e TZ=Asia/Shanghai`ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ `TZ`ï¼ŒæŒ‡å®šæ—¶åŒºä¸º `Asia/Shanghai`ã€‚
- `-v /etc/localtime:/etc/localtime:ro`ï¼šå°†å®¿ä¸»æœºçš„ `/etc/localtime` æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œè®¾ç½®ä¸ºåªè¯»æ¨¡å¼ (`ro`)ï¼Œä»¥ç¡®ä¿å®¹å™¨ä½¿ç”¨æ­£ç¡®çš„æœ¬åœ°æ—¶åŒºã€‚