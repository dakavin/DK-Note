---
æ–‡ç« æ ‡é¢˜: "[[18_æ—¥ç¨‹ç®¡ç†å¼€å‘]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  ä½¿ç”¨HTML/CSS/JSå’ŒServletå¼€å‘æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«å‰åç«¯åˆ†ç¦»æ¶æ„ã€ç”¨æˆ·è®¤è¯ã€è·¨åŸŸå¤„ç†å’ŒCRUDåŠŸèƒ½
tags:
- "JavaWeb"
- "Vue3"
- "å‰åç«¯åˆ†ç¦»"
- "Servlet"
- "MVC"
- "axios"
- "pinia"
- "è·¨åŸŸ"
ç›¸å…³æ–‡ç« :
- "[[8_Vue æ•´åˆ Axios å®ç°ç™»å½•åŠŸèƒ½ï¼ˆè§£å†³è·¨åŸŸé—®é¢˜ï¼‰]]"
- "[[5_JaveWebè½¯ä»¶ç¯å¢ƒéƒ¨ç½²åŠç›¸å…³è®¾ç½®]]"
- "[[8_ä¼šè¯_è¿‡æ»¤å™¨_ç›‘å¬å™¨]]"
- "[[0_é¡¹ç›®ä»‹ç»]]"
- "[[10_åšå®¢è®¾ç½®é¡µï¼šæ›´æ–°è®¾ç½®]]"
æ–‡ç« åˆ†ç±»: "ğŸŒ Webå¼€å‘"
æ–‡ç« è·¯å¾„: "03-ğŸŒ Webå¼€å‘/01-ğŸ”™ åç«¯æŠ€æœ¯/01-ğŸŒ JavaWeb/3_JavaWebï¼ˆå°šç¡…è°·ï¼‰/18_æ—¥ç¨‹ç®¡ç†å¼€å‘.md"
æ–‡ç« éš¾åº¦: ä¸­çº§ ğŸŒ³
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­ æ ¸å¿ƒèƒ½åŠ›
åˆ›å»ºæ—¶é—´: 2024-03-28 10:36:00
ä¿®æ”¹æ—¶é—´: 2025-05-27 23:34:19
---

## 1 ç¬¬ä¸€æœŸ

æ¶‰åŠæŠ€æœ¯ï¼šHTMLã€CSSã€JS

### 1.1 ç™»å½•é¡µé¢

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>

        .ht{
            text-align: center;
            color: cadetblue;
            font-family: å¹¼åœ†;
        }
        .tab{
            width: 500px;
            border: 5px solid cadetblue;
            margin: 0px auto;
            border-radius: 5px;
            font-family: å¹¼åœ†;
        }
        .ltr td{
            border: 1px solid  powderblue;

        }
        .ipt{
            border: 0px;
            width: 50%;

        }
        .btn1{
            border: 2px solid powderblue;
            border-radius: 4px;
            width:60px;
            background-color: antiquewhite;

        }
        #usernameMsg , #userPwdMsg {
            color: rgb(230, 87, 51);
        }

        .buttonContainer{
            text-align: center;
        }
    </style>
    <script>
        // æ£€éªŒç”¨æˆ·åæ ¼å¼æ˜¯å¦åˆæ³•çš„å‡½æ•°
        function checkUsername(){
            // å®šä¹‰æ­£åˆ™è¡¨ç¤ºå­—ç¬¦ä¸²çš„è§„åˆ™
            var  usernameReg= /^[a-zA-Z0-9]{5,10}$/
            // è·å¾—ç”¨æˆ·åœ¨é¡µé¢ä¸Šè¾“å…¥çš„ä¿¡æ¯
            var usernameInput =document.getElementById("usernameInput")
            var username = usernameInput.value
            // è·å¾—æ ¼å¼æç¤ºçš„æ¡†
            var usernameMsg =document.getElementById("usernameMsg")
            // æ ¼å¼æœ‰è¯¯æ—¶,è¿”å›false,åœ¨é¡µé¢ä¸Šæç¤º
            if(!usernameReg.test(username)){ 
                usernameMsg.innerText="ç”¨æˆ·åæ ¼å¼æœ‰è¯¯"
                return false
            }
            // æ ¼å¼OK,è¿”å›true åœ¨é¡µé¢ä¸Šæç¤ºOK
            usernameMsg.innerText="OK"
            return true

        }

        // æ£€éªŒå¯†ç æ ¼å¼æ˜¯å¦åˆæ³•çš„å‡½æ•°
        function checkUserPwd(){
            // å®šä¹‰æ­£åˆ™è¡¨ç¤ºå­—ç¬¦ä¸²çš„è§„åˆ™
            var  userPwdReg= /^[0-9]{6}$/
            // è·å¾—ç”¨æˆ·åœ¨é¡µé¢ä¸Šè¾“å…¥çš„ä¿¡æ¯
            var userPwdInput =document.getElementById("userPwdInput")
            var userPwd = userPwdInput.value
            // è·å¾—æ ¼å¼æç¤ºçš„æ¡†
            var userPwdMsg =document.getElementById("userPwdMsg")
            // æ ¼å¼æœ‰è¯¯æ—¶,è¿”å›false,åœ¨é¡µé¢ä¸Šæç¤º
            if(!userPwdReg.test(userPwd)){ 
                userPwdMsg.innerText="å¯†ç å¿…é¡»æ˜¯6ä½æ•°å­—"
                return false
            }
            // æ ¼å¼OK,è¿”å›true åœ¨é¡µé¢ä¸Šæç¤ºOK
            userPwdMsg.innerText="OK"
            return true

        }

        // è¡¨å•åœ¨æäº¤æ—¶,æ ¡éªŒç”¨æˆ·åå’Œå¯†ç æ ¼å¼,æ ¼å¼OKæ‰ä¼šæäº¤
        function checkForm(){
            var flag1 =checkUsername()
            var flag2 =checkUserPwd()

            return flag1&&flag2
        }


    </script>

    
</head>
<body>
    <h1 class="ht">æ¬¢è¿ä½¿ç”¨æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿ</h1>
    <h3 class="ht">è¯·ç™»å½•</h3>
    <form method="post" action="/user/login" onsubmit="return checkForm()">
        <table class="tab" cellspacing="0px">
            <tr class="ltr">
                <td>è¯·è¾“å…¥è´¦å·</td>
                <td>
                    <input class="ipt" type="text" id="usernameInput" name="username" onblur="checkUsername()">
                    <span id="usernameMsg"></span>
                </td>
            </tr>
            <tr class="ltr">
                <td>è¯·è¾“å…¥å¯†ç </td>
                <td>
                    <input class="ipt" type="password" id="userPwdInput"  name="userPwd" onblur="checkUserPwd()">
                    <span id="userPwdMsg"></span>
                </td>
            </tr>
            <tr class="ltr">
                <td colspan="2" class="buttonContainer">
                    <input class="btn1" type="submit" value="ç™»å½•">
                    <input class="btn1" type="reset" value="é‡ç½®">
                    <button class="btn1"><a href="regist.html">å»æ³¨å†Œ</a></button>
                </td>
            </tr>
        </table>
    </form>
</body>
</html>
```
### 1.2 æ³¨å†Œé¡µé¢

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>

        .ht{
            text-align: center;
            color: cadetblue;
            font-family: å¹¼åœ†;
        }
        .tab{
            width: 500px;
            border: 5px solid cadetblue;
            margin: 0px auto;
            border-radius: 5px;
            font-family: å¹¼åœ†;
        }
        .ltr td{
            border: 1px solid  powderblue;

        }
        .ipt{
            border: 0px;
            width: 50%;

        }
        .btn1{
            border: 2px solid powderblue;
            border-radius: 4px;
            width:60px;
            background-color: antiquewhite;

        }

        .msg {
            color: gold;
        }

        .buttonContainer{
            text-align: center;
        }
    </style>

    <script>
        function checkUsername(){
            var usernameReg = /^[a-zA-Z0-9]{5,10}$/
            var usernameInput = document.getElementById("usernameInput")  
            var username = usernameInput.value  
            var usernameMsg = document.getElementById("usernameMsg")
            if(!usernameReg.test(username)){
                usernameMsg.innerText="æ ¼å¼æœ‰è¯¯"
                return false
            } 
            usernameMsg.innerText="OK"
            return true 
        }


        function checkUserPwd(){
            var userPwdReg = /^\d{6}$/
            var userPwdInput = document.getElementById("userPwdInput")  
            var userPwd = userPwdInput.value  
            var userPwdMsg = document.getElementById("userPwdMsg")
            if(!userPwdReg.test(userPwd)){
                userPwdMsg.innerText="æ ¼å¼æœ‰è¯¯"
                return false
            } 
            userPwdMsg.innerText="OK"
            return true 
        }


        function checkReUserPwd(){
            var userPwdReg = /^\d{6}$/
            // å†æ¬¡è¾“å…¥çš„å¯†ç çš„æ ¼å¼
            var reUserPwdInput = document.getElementById("reUserPwdInput")  
            var reUserPwd = reUserPwdInput.value 
            var reUserPwdMsg = document.getElementById("reUserPwdMsg")
            if(!userPwdReg.test(reUserPwd)){
                reUserPwdMsg.innerText="æ ¼å¼æœ‰è¯¯"
                return false
            } 
            // è·å¾—ä¸Šæ¬¡å¯†ç ,å¯¹æ¯”ä¸¤æ¬¡å¯†ç æ˜¯å¦ä¸€è‡´
            var userPwdInput = document.getElementById("userPwdInput")  
            var userPwd = userPwdInput.value  
            if(reUserPwd != userPwd){
                reUserPwdMsg.innerText="ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´"
                return false
            } 
            reUserPwdMsg.innerText="OK"
            return true 
        }


        function checkForm(){
            var flag1 = checkUsername()
            var flag2 = checkUserPwd()
            var flag3 = checkReUserPwd()

            return flag1 && flag2 && flag3
        }


    </script>


   
</head>
<body>
<h1 class="ht">æ¬¢è¿ä½¿ç”¨æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿ</h1>
<h3 class="ht">è¯·æ³¨å†Œ</h3>
<form method="post" action="/user/regist" onsubmit="return checkForm()">
    <table class="tab" cellspacing="0px">
        <tr class="ltr">
            <td>è¯·è¾“å…¥è´¦å·</td>
            <td>
                <input class="ipt" id="usernameInput" type="text" name="username" onblur="checkUsername()">
                <span id="usernameMsg" class="msg"></span>
            </td>
        </tr>
        <tr class="ltr">
            <td>è¯·è¾“å…¥å¯†ç </td>
            <td>
                <input class="ipt" id="userPwdInput" type="password" name="userPwd" onblur="checkUserPwd()">
                <span id="userPwdMsg" class="msg"></span>
            </td>
        </tr>
        <tr class="ltr">
            <td>ç¡®è®¤å¯†ç </td>
            <td>
                <input class="ipt" id="reUserPwdInput" type="password" onblur="checkReUserPwd()">
                <span id="reUserPwdMsg" class="msg"></span>
            </td>
        </tr>
        <tr class="ltr">
            <td colspan="2" class="buttonContainer">
                <input class="btn1" type="submit" value="æ³¨å†Œ">
                <input class="btn1" type="reset" value="é‡ç½®">
                <button class="btn1"><a  href="login.html">å»ç™»å½•</a></button>
            </td>
        </tr>
    </table>

</form>
</body>
</html>
```

## 2 ç¬¬äºŒæœŸ

æ¶‰åŠæŠ€æœ¯ï¼š
- Tomcatçš„ä½¿ç”¨ï¼Œå¹¶æ¥å…¥IDEA
- IDEAåˆ›å»ºWebApplicaitoné¡¹ç›®
- Servletã€Requestã€Responseçš„ä½¿ç”¨
- MVCå¼€å‘æ¨¡å¼

### 2.1 é¡¹ç›®æ­å»º

#### 2.1.1 æ•°æ®åº“å‡†å¤‡

+ åˆ›å»ºschedule_systemæ•°æ®åº“å¹¶æ‰§è¡Œå¦‚ä¸‹è¯­å¥

``` sql
SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;


-- ----------------------------
-- åˆ›å»ºæ—¥ç¨‹è¡¨
-- ----------------------------
DROP TABLE IF EXISTS `sys_schedule`;
CREATE TABLE `sys_schedule`  (
  `sid` int NOT NULL AUTO_INCREMENT,
  `uid` int NULL DEFAULT NULL,
  `title` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL,
  `completed` int(1) NULL DEFAULT NULL,
  PRIMARY KEY (`sid`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- æ’å…¥æ—¥ç¨‹æ•°æ®
-- ----------------------------

-- ----------------------------
-- åˆ›å»ºç”¨æˆ·è¡¨
-- ----------------------------
DROP TABLE IF EXISTS `sys_user`;
CREATE TABLE `sys_user`  (
  `uid` int NOT NULL AUTO_INCREMENT,
  `username` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL,
  `user_pwd` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL,
  PRIMARY KEY (`uid`) USING BTREE,
  UNIQUE INDEX `username`(`username`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- æ’å…¥ç”¨æˆ·æ•°æ®
-- ----------------------------
INSERT INTO `sys_user` VALUES (1, 'zhangsan', 'e10adc3949ba59abbe56e057f20f883e');
INSERT INTO `sys_user` VALUES (2, 'lisi', 'e10adc3949ba59abbe56e057f20f883e');

SET FOREIGN_KEY_CHECKS = 1;

```

+ è·å¾—å¦‚ä¸‹è¡¨æ ¼![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/e466c003c18c83400f52974631871fdc.png)
#### 2.1.2 é¡¹ç›®ç»“æ„

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/a4328c8796293d783ddc3f08503e8085.png)

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7b67d9ce9f57e3ad1c708ff034ccdfcf.png)

#### 2.1.3 å¯¼å…¥ä¾èµ–

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/82956daf1f8066d3a12160f0de4b0c69.png)
#### 2.1.4 pojoåŒ…å¤„ç†

>  ä½¿ç”¨lombokå¤„ç†getter setter equals hashcode æ„é€ å™¨ 

``` java
//-----------------------------------------------------
@AllArgsConstructor
@NoArgsConstructor
@Data
public class SysUser  implements Serializable {
    private Integer uid;
    private String username;
    private String userPwd;
}
//------------------------------------------------------
@AllArgsConstructor
@NoArgsConstructor
@Data
public class SysSchedule implements Serializable {
    private Integer sid;
    private Integer uid;
    private String title;
    private Integer completed;
}
//------------------------------------------------------
```

#### 2.1.5 daoåŒ…å¤„ç†

å¯¼å…¥JDBCUtilè¿æ¥æ± å·¥å…·ç±»å¹¶å‡†å¤‡jdbc.propertiesé…ç½®æ–‡ä»¶

```java
public class JDBCUtil {  
    //ThreadLocalä¸­å¡«å……çš„å˜é‡å±äºå½“å‰çº¿ç¨‹ï¼Œè¯¥å˜é‡å¯¹å…¶ä»–çº¿ç¨‹è€Œè¨€æ˜¯éš”ç¦»çš„  
    // ä¹Ÿå°±æ˜¯è¯´è¯¥å˜é‡æ˜¯å½“å‰çº¿ç¨‹ç‹¬æœ‰çš„å˜é‡  
    private static ThreadLocal<Connection> threadLocal =  
            new ThreadLocal<>();  
  
    private static DataSource dataSource;  
  
    //åˆå§‹åŒ–è¿æ¥æ±   
    static{  
        //è¯»å–é…ç½®æ–‡ä»¶  
        Properties pro = new Properties();  
        try {  
            pro.load(JDBCUtil.class.getClassLoader().getResourceAsStream("jdbc.properties"));  
        } catch (IOException e) {  
            throw new RuntimeException(e);  
        }  
        //ä½¿ç”¨Druidæ•°æ®åº“è¿æ¥æ± è·å–ï¼Œæ•°æ®æº  
        try {  
            dataSource = DruidDataSourceFactory.createDataSource(pro);  
        } catch (Exception e) {  
            throw new RuntimeException(e);  
        }  
    }  
  
    //å‘å¤–æä¾›è¿æ¥æ±   
    public static DataSource getDataSource(){  
        return dataSource;  
    }  
  
    //å‘å¤–æä¾›è¿æ¥  
    public static Connection getConnection(){  
        Connection con = threadLocal.get();  
        if (null == con){  
            try {  
                con = dataSource.getConnection();  
            } catch (SQLException e) {  
                throw new RuntimeException(e);  
            }  
        }  
        threadLocal.set(con);  
        return con;  
    }  
  
    //å®šä¹‰ä¸€ä¸ªå½’è¿˜è¿æ¥çš„æ–¹æ³•ï¼ˆè§£é™¤å’ŒThreadLocalä¹‹é—´çš„å…³è”ï¼‰  
    public static void releaseConnection(){  
        Connection con = threadLocal.get();  
        if (null != con){  
            //è§£é™¤å…³è”  
            threadLocal.remove();  
            try {  
                //å°†è¿æ¥è®¾ç½®å›è‡ªåŠ¨æäº¤çš„è¿æ¥  
                con.setAutoCommit(true);  
                //å½’è¿˜è¿æ¥åˆ°æ•°æ®æ±   
                con.close();  
            } catch (SQLException e) {  
                throw new RuntimeException(e);  
            }  
        }  
    }  
  
}
```

```properties
driverClassName=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://localhost:3306/schedule_system
username=root
password=root
initialSize=5
maxActive=10
maxWait=1000
```

- åˆ›å»ºBaseDaoå¯¹è±¡å¹¶å¤åˆ¶å¦‚ä¸‹ä»£ç 

```java
public abstract class BaseDao<T> {  
    private QueryRunner qr = new QueryRunner();  
  
    //å®šä¹‰ä¸€ä¸ªç±»å¯¹è±¡ï¼Œç”¨äºæ¥æ”¶å­ç±»çš„æ³›å‹ç±»å‹  
    private Class<T> type;  
  
    public BaseDao(){  
        //è·å–å­ç±»çš„ç±»å‹  
        Class<? extends BaseDao> clazz = this.getClass();  
  
        //å­ç±»è·å–çˆ¶ç±»  
        ParameterizedType parameterizedType = (ParameterizedType) clazz.getGenericSuperclass();  
        //ParameterizedTypeè·å–çš„æ˜¯çˆ¶ç±»ï¼Œä¸”çˆ¶ç±»å¸¦æœ‰æ³›å‹  
        //è·å–çˆ¶ç±»çš„æ³›å‹æ•°ç»„  
        Type[] types = parameterizedType.getActualTypeArguments();  
        //å¾ˆæ˜¾ç„¶ï¼Œç¬¬ä¸€ä¸ªæ³›å‹å°±æ˜¯æ³›å‹çš„å…·ä½“ç±»å‹  
        type = (Class<T>) types[0];  
    }  
  
  
    //é€šç”¨çš„å¢åˆ æ”¹æ“ä½œ  
    public int update(Connection con,String sql,Object ... args){  
        int update = 0;  
        try {  
            update = qr.update(con, sql, args);  
        } catch (SQLException e) {  
            e.printStackTrace();  
        }  
        return update==0?0:update;  
    }  
  
    //è·å–ä¸€ä¸ªå¯¹è±¡  
    public T getBean(Connection con,String sql,Object ... args){  
        T query = null;  
        try {  
            query = qr.query(con, sql, new BeanHandler<>(type),args);  
        } catch (SQLException e) {  
            e.printStackTrace();  
        }  
        return query;  
    }  
  
    //è·å–å¯¹è±¡é›†åˆ  
    public List<T> getBeanList(Connection con,String sql,Object ... args){  
        List<T> query = null;  
        try {  
            query = qr.query(con, sql, new BeanListHandler<>(type),args);  
        } catch (SQLException e) {  
            e.printStackTrace();  
        }  
        return query;  
    }  
  
    //è·å–ä¸€ä¸ªå€¼çš„æ–¹æ³•ï¼Œä¸“é—¨ç”¨æ¥æ‰§è¡Œåƒ select count(*)...è¿™æ ·çš„sqlè¯­å¥  
    public Object getValue(Connection con,String sql,Object ... args){  
        Object query = null;  
        try {  
            query = qr.query(con, sql, new ScalarHandler<>(), args);  
        } catch (SQLException e) {  
            e.printStackTrace();  
        }  
        return query;  
    }  
}
```

#### 2.1.6 serviceåŒ…å¤„ç†

+ æ¥å£

``` java
//-------------------------------------------------------------
public interface SysUserService {
}
//-------------------------------------------------------------
public interface SysScheduleService {
}
```

+ å®ç°ç±»

```java
//-------------------------------------------------------------
public class SysUserServiceImpl implements SysUserService {
}
//-------------------------------------------------------------
public class SysScheduleServiceImpl implements SysScheduleService {
}
```

#### 2.1.7 controlleråŒ…å¤„ç†

+ BaseControllerå¤„ç†è¯·æ±‚è·¯å¾„é—®é¢˜

``` java
public class BaseController extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        

        String requestURI = req.getRequestURI();
        String[] split = requestURI.split("/");
        String methodName =split[split.length-1];
        // é€šè¿‡åå°„è·å–è¦æ‰§è¡Œçš„æ–¹æ³•
        Class clazz = this.getClass();
        try {
            Method method=clazz.getDeclaredMethod(methodName,HttpServletRequest.class,HttpServletResponse.class);
            // è®¾ç½®æ–¹æ³•å¯ä»¥è®¿é—®
            method.setAccessible(true);
            // é€šè¿‡åå°„æ‰§è¡Œä»£ç 
            method.invoke(this,req,resp);
        } catch (Exception e) {
            e.printStackTrace();
           
        }
    }
}
```

+ å¤šä¸ªå¤„ç†å™¨ç»§æ‰¿BaseController

```  java
//-------------------------------------------------------------@WebServlet("/user/*")
public class UserController extends BaseController{
}
//-------------------------------------------------------------@WebServlet("/schedule/*")
public class SysScheduleController  extends BaseController{
}
```
#### 2.1.8 åŠ å¯†å·¥å…·ç±»ä½¿ç”¨

+ å¯¼å…¥MD5Utilå·¥å…·ç±»
``` java
public final class MD5Util {
    public static String encrypt(String strSrc) {
        try {
            char hexChars[] = { '0', '1', '2', '3', '4', '5', '6', '7', '8',
                    '9', 'a', 'b', 'c', 'd', 'e', 'f' };
            byte[] bytes = strSrc.getBytes();
            MessageDigest md = MessageDigest.getInstance("MD5");
            md.update(bytes);
            bytes = md.digest();
            int j = bytes.length;
            char[] chars = new char[j * 2];
            int k = 0;
            for (int i = 0; i < bytes.length; i++) {
                byte b = bytes[i];
                chars[k++] = hexChars[b >>> 4 & 0xf];
                chars[k++] = hexChars[b & 0xf];
            }
            return new String(chars);
        } catch (NoSuchAlgorithmException e) {
            e.printStackTrace();
            throw new RuntimeException("MD5åŠ å¯†å‡ºé”™!!!")
        }
    }
}
```
#### 2.1.9 é¡µé¢æ–‡ä»¶å¯¼å…¥

- å¤åˆ¶èµ„æºä¸‹çš„æ—¥ç¨‹ç®¡ç†ä¸­çš„HTMLåˆ°é¡¹ç›®çš„webç›®å½•ä¸‹å³å¯![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/432c35e36ad7dc7e192fe94703f39a9b.png)
### 2.2 ä¸šåŠ¡ä»£ç 

#### 2.2.1 æ³¨å†Œä¸šåŠ¡å¤„ç†
- controller
```java
@WebServlet("/user/*")  
public class SysUserController Â extends BaseContoller {  
â€‹  
 Â  Â private SysUserService userService =new SysUserServiceImpl();  
â€‹  
 Â  Â /**  
 Â  Â  * æ¥æ”¶ç”¨æˆ·æ³¨å†Œè¯·æ±‚çš„ä¸šåŠ¡å¤„ç†æ–¹æ³•( ä¸šåŠ¡æ¥å£ ä¸æ˜¯javaä¸­çš„interface  )  
 Â  Â  * @param req  
 Â  Â  * @param resp  
 Â  Â  * @throws ServletException  
 Â  Â  * @throws IOException  
 Â  Â  */  
 Â  Â protected void regist(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {  
 Â  Â  Â  Â // 1 æ¥æ”¶å®¢æˆ·ç«¯æäº¤çš„å‚æ•°  
 Â  Â  Â  Â String username = req.getParameter("username");  
 Â  Â  Â  Â String userPwd = req.getParameter("userPwd");  
 Â  Â  Â  Â // 2 è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•,å®Œæˆæ³¨å†ŒåŠŸèƒ½  
 Â  Â  Â  Â  Â  Â //å°†å‚æ•°æ”¾å…¥ä¸€ä¸ªSysUserå¯¹è±¡ä¸­,åœ¨è°ƒç”¨registæ–¹æ³•æ—¶ä¼ å…¥  
 Â  Â  Â  Â SysUser sysUser =new SysUser(null,username,userPwd);  
 Â  Â  Â  Â int rows =userService.regist(sysUser);  
 Â  Â  Â  Â // 3 æ ¹æ®æ³¨å†Œç»“æœ(æˆåŠŸ  å¤±è´¥) åšé¡µé¢è·³è½¬  
 Â  Â  Â  Â if(rows>0){  
 Â  Â  Â  Â  Â  Â resp.sendRedirect("/registSuccess.html");  
 Â  Â  Â   }else{  
 Â  Â  Â  Â  Â  Â resp.sendRedirect("/registFail.html");  
 Â  Â  Â   }  
 Â   }  
} 
``` 
â€‹  
- service
    

```java
public interface SysUserService {  
 Â  Â /**  
 Â  Â  * ç”¨æˆ·å®Œæˆæ³¨å†Œçš„ä¸šåŠ¡æ–¹æ³•  
 Â  Â  * @param registUser ç”¨äºä¿å­˜æ³¨å†Œç”¨æˆ·åå’Œå¯†ç çš„å¯¹è±¡  
 Â  Â  * @return æ³¨å†ŒæˆåŠŸè¿”å›>0çš„æ•´æ•°,å¦åˆ™è¿”å›0  
 Â  Â  */  
 Â  Â int regist(SysUser registUser);  
}


public class SysUserServiceImpl Â implements SysUserService {  
 Â  Â private SysUserDao Â userDao =new SysUserDaoImpl();  
 Â  Â @Override  
 Â  Â public int regist(SysUser sysUser) {  
â€‹  
 Â  Â  Â  Â // å°†ç”¨æˆ·çš„æ˜æ–‡å¯†ç è½¬æ¢ä¸ºå¯†æ–‡å¯†ç   
 Â  Â  Â  Â sysUser.setUserPwd(MD5Util.encrypt(sysUser.getUserPwd()));  
 Â  Â  Â  Â // è°ƒç”¨DAO å±‚çš„æ–¹æ³•  å°†sysUserä¿¡æ¯å­˜å…¥æ•°æ®åº“  
 Â  Â  Â  Â return userDao.addSysUser(sysUser);  
 Â   }  
}
```

- dao
```java
public interface SysUserDao {  
â€‹  
 Â  Â /**  
 Â  Â  * å‘æ•°æ®åº“ä¸­å¢åŠ ä¸€æ¡ç”¨æˆ·è®°å½•çš„æ–¹æ³•  
 Â  Â  * @param sysUser è¦å¢åŠ çš„è®°å½•çš„usernameå’Œuser_pwdå­—æ®µä»¥SysUserå®ä½“ç±»å¯¹è±¡çš„å½¢å¼æ¥æ”¶  
 Â  Â  * @return å¢åŠ æˆåŠŸè¿”å›1 å¢åŠ å¤±è´¥è¿”å›0  
 Â  Â  */  
 Â  Â int addSysUser(SysUser sysUser);  
}  
â€‹
public class SysUserDaoImpl extends BaseDao implements SysUserDao {  
 Â  Â @Override  
 Â  Â public int addSysUser(SysUser sysUser) {  
	    String sql = "INSERT INTO sys_user VALUES(DEFAULT,?,?)";  
	    return update(con, sql, sysUser.getUsername(), sysUser.getUserPwd());  
	}
}
```
#### 2.2.2 ç™»å½•ä¸šåŠ¡å¤„ç†

- controller
```java
@WebServlet("/user/*")  
public class SysUserController Â extends BaseContoller {  
â€‹  
 Â  Â private SysUserService userService =new SysUserServiceImpl();  
 Â  Â /**  
 Â  Â  * æ¥æ”¶ç”¨ç™»å½•è¯·æ±‚,å®Œæˆçš„ç™»å½•ä¸šåŠ¡æ¥å£  
 Â  Â  * @param req  
 Â  Â  * @param resp  
 Â  Â  * @throws ServletException  
 Â  Â  * @throws IOException  
 Â  Â  */  
 Â  Â protected void login(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {  
 Â  Â  Â  Â //1 æ¥æ”¶ç”¨æˆ·åå’Œå¯†ç   
 Â  Â  Â  Â String username = req.getParameter("username");  
 Â  Â  Â  Â String userPwd = req.getParameter("userPwd");  
 Â  Â  Â  Â //2 è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•,æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯  
 Â  Â  Â  Â SysUser loginUser =userService.findByUsername(username);  
 Â  Â  Â  Â if(null == loginUser){  
 Â  Â  Â  Â  Â  Â // è·³è½¬åˆ°ç”¨æˆ·åæœ‰è¯¯æç¤ºé¡µ  
 Â  Â  Â  Â  Â  Â resp.sendRedirect("/loginUsernameError.html");  
 Â  Â  Â   }else if(! MD5Util.encrypt(userPwd).equals(loginUser.getUserPwd())){  
 Â  Â  Â  Â  Â  Â //3 åˆ¤æ–­å¯†ç æ˜¯å¦åŒ¹é…  
 Â  Â  Â  Â  Â  Â // è·³è½¬åˆ°å¯†ç æœ‰è¯¯æç¤ºé¡µ  
 Â  Â  Â  Â  Â  Â resp.sendRedirect("/loginUserPwdError.html");  
 Â  Â  Â   }else{  
 Â  Â  Â  Â  Â  Â //4 è·³è½¬åˆ°é¦–é¡µ  
 Â  Â  Â  Â  Â  Â resp.sendRedirect("/showSchedule.html");  
 Â  Â  Â   }  
â€‹  
 Â   }  
}
```

- service
    

```java
public interface SysUserService {  
 Â  Â  Â  Â /**  
 Â  Â  * æ ¹æ®ç”¨æˆ·åè·å¾—å®Œæ•´ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•  
 Â  Â  * @param username è¦æŸ¥è¯¢çš„ç”¨æˆ·å  
 Â  Â  * @return å¦‚æœæ‰¾åˆ°äº†è¿”å›SysUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null  
 Â  Â  */  
 Â  Â SysUser findByUsername(String username);  
}

public class SysUserServiceImpl implements SysUserService {  
 Â  Â private SysUserDao userDao =new SysUserDaoImpl();  
â€‹  
 Â  Â @Override  
 Â  Â public SysUser findByUsername(String username) {  
 Â  Â  Â  Â // è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•,ç»§ç»­æŸ¥è¯¢  
â€‹  
 Â  Â  Â  Â return userDao.findByUsername(username);  
 Â   }  
} 
```

- dao
â€‹  
```java
public interface SysUserDao {  
 Â  Â  Â  Â /**  
 Â  Â  * æ ¹æ®ç”¨æˆ·åè·å¾—å®Œæ•´ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•  
 Â  Â  * @param username è¦æŸ¥è¯¢çš„ç”¨æˆ·å  
 Â  Â  * @return å¦‚æœæ‰¾åˆ°äº†è¿”å›SysUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null  
 Â  Â  */  
 Â  Â SysUser findByUsername(String username);  
}

public class SysUserDaoImpl extends BaseDao implements SysUserDao {  
	@Override  
	public SysUser findByName(String username) {  
	    String sql = "SELECT uid,username,user_pwd userPwd FROM sys_user WHERE username = ?";  
	    List<SysUser> userList = getBeanList(con, sql, username);  
	    return null!=userList&&userList.size()>0?userList.get(0):null;  
	} 
}
```

## 3 ç¬¬ä¸‰æœŸ

### 3.1 ç™»å½•æƒ…å†µè¿‡æ»¤

æ¶‰åŠæŠ€æœ¯ï¼š
- Filterè¿‡æ»¤å™¨
- session

> éœ€æ±‚è¯´æ˜:æœªç™»å½•çŠ¶æ€ä¸‹ä¸å…è®¸è®¿é—®showShedule.htmlå’ŒSysScheduleControllerç›¸å…³å¢åˆ æ”¹å¤„ç†,é‡å®šå‘åˆ°login.html,ç™»å½•æˆåŠŸåå¯ä»¥è‡ªç”±è®¿é—®

+ å¼€å‘ç™»å½•è¿‡æ»¤å™¨,å¯¹æŒ‡å®šèµ„æºçš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤
```java
@WebFilter(urlPatterns = {"/showSchedule.html","/schedule/*"})
public class LoginFilter  implements Filter {
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletRequest request =(HttpServletRequest) servletRequest;
        HttpServletResponse response =(HttpServletResponse) servletResponse;
        HttpSession session = request.getSession();
        Object sysUser = session.getAttribute("sysUser");
        if(null != sysUser){
            // sessionä¸­å¦‚æœå­˜åœ¨ç™»å½•çš„ç”¨æˆ· ä»£è¡¨ç”¨æˆ·ç™»å½•è¿‡,åˆ™æ”¾è¡Œ
            filterChain.doFilter(servletRequest,servletResponse);

        }else{
            //ç”¨æˆ·æœªç™»å½•,é‡å®šå‘åˆ°ç™»å½•é¡µ
            response.sendRedirect("/login.html");
        }
    }
}
```

- ä¿®æ”¹ç”¨æˆ·ç™»å½•è¯·æ±‚çš„loginæ–¹æ³•,ç™»å½•æˆåŠŸæ—¶,å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥session

``` java
 /**
     * ç”¨æˆ·ç™»å½•çš„ä¸šåŠ¡æ¥å£
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void login(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // æ¥æ”¶ç”¨æˆ·è¯·æ±‚å‚æ•°
        // è·å–è¦æ³¨å†Œçš„ç”¨æˆ·åå¯†ç 
        String username = req.getParameter("username");
        String userPwd = req.getParameter("userPwd");
        // è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•,æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“ä¸­æ˜¯å¦æœ‰ä¸€ä¸ªç”¨æˆ·
        SysUser loginUser =userService.findByUsername(username);
        if(null == loginUser){
            // æ²¡æœ‰æ ¹æ®ç”¨æˆ·åæ‰¾åˆ°ç”¨æˆ·,è¯´æ˜ç”¨æˆ·åæœ‰è¯¯
            resp.sendRedirect("/loginUsernameError.html");
        }else if(! loginUser.getUserPwd().equals(MD5Util.encrypt(userPwd))){
            // ç”¨æˆ·å¯†ç æœ‰è¯¯,
            resp.sendRedirect("/loginUserPwdError.html");
        }else{
            // ç™»å½•æˆåŠŸ,å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥session
            req.getSession().setAttribute("sysUser",loginUser);
            // ç™»å½•æˆåŠŸ,é‡å®šå‘åˆ°æ—¥ç¨‹å±•ç¤ºé¡µ
            resp.sendRedirect("/showSchedule.html");
        }
    }
```

## 4 ç¬¬å››æœŸ

### 4.1 ç”¨æˆ·åå¼‚æ­¥éªŒè¯

æ¶‰åŠæŠ€æœ¯ï¼šajaxæŠ€æœ¯

- æ³¨å†Œæäº¤ä¹‹å‰
- é€šè¿‡ajaxæŠ€æœ¯å…ˆæ ¡éªŒç”¨æˆ·åæ˜¯å¦å·²ç»å ç”¨äº†

- regist.htmlé¡µé¢ä»£ç ï¼Œä¿®æ”¹æ ¡éªŒç”¨æˆ·åçš„æ–¹æ³•
```js
// æ ¡éªŒç”¨æˆ·åçš„æ–¹æ³•
	function checkUsername(){
		// å®šä¹‰æ­£åˆ™
		var usernameReg=/^[a-zA-Z0-9]{5,10}$/
		var username =document.getElementById("usernameInput").value
		var usernameMsgSpan =document.getElementById("usernameMsg")
		if(!usernameReg.test(username)){
			usernameMsgSpan.innerText="ä¸åˆæ³•"
			return false
		}
		
		// ç”¨æˆ·åæ ¼å¼æ­£ç¡®ï¼Œç»§ç»­ä½¿ç”¨ajaxæ ¡éªŒç”¨æˆ·åæ˜¯å¦è¢«å ç”¨
		// 1. è®¾ç½®å›è°ƒå‡½æ•°
		var request;
		if(window.XMLHttpRequest){
			request= new XMLHttpRequest();
		}else{
			request= new ActiveXObject("Microsoft.XMLHTTP");
		}
		
		// 2. è®¾ç½®å“åº”å›æ¥çš„ä¿¡æ¯å¦‚ä½•å¤„ç†
		request.onreadystatechange= function (){
			// request.readyState == 4 ä»£è¡¨è¯·æ±‚ç»“æŸ,å·²ç»æ¥æ”¶åˆ°å“åº”ç»“æœ
			// request.status== 200  è¡¨ç¤ºåç«¯å“åº”çŠ¶æ€ç æ˜¯200
			if(request.readyState == 4  && request.status== 200){
				// å°†åç«¯çš„å“åº”çš„JSONå­—ç¬¦ä¸²è½¬æ¢ä¸ºå‰ç«¯çš„å¯¹è±¡
				var response =JSON.parse(request.responseText)
				console.log(response)
				//  åˆ¤æ–­ä¸šåŠ¡ç æ˜¯å¦æ˜¯200
				if (response.code != 200){
					usernameMsgSpan.innerText="å·²å ç”¨"
					return false
				}
			}
		}
		
		// 3. è®¾ç½®ajaxçš„è¯·æ±‚æ–¹å¼,è¯·æ±‚èµ„æºè·¯å¾„,æ˜¯å¦ä¸ºå¼‚æ­¥è¯·æ±‚
		request.open("GET",'/user/checkUsernameUsed?username='+username,true)
		
		// 4. å‘é€è¯·æ±‚
		request.send();

		// 5. å‰é¢æ ¡éªŒéƒ½é€šè¿‡ï¼ˆæ³¨æ„å’Œå¼‚æ­¥çš„åŒºåˆ«ï¼‰
		usernameMsgSpan.innerText="OK"
		return true
	}
}
```

- æ·»åŠ å…¬å…±çš„JSONæ•°æ®å“åº”æ ¼å¼ç±»
- `æ³¨æ„å’ŒHTTPå“åº”çŠ¶æ€ç åŒºåˆ†ï¼Œè¿™é‡Œæ˜¯å“åº”ä½“ä¸­çš„å†…å®¹`
```java
//ä¸šåŠ¡å«ä¹‰å’ŒçŠ¶æ€ç å¯¹åº”å…³ç³»çš„æšä¸¾
public enum ResultCodeEnum {

    SUCCESS(200,"success"),
    USERNAME_ERROR(501,"usernameError"),
    PASSWORD_ERROR(503,"passwordError"),
    NOTLOGIN(504,"notLogin"),
    USERNAME_USED(505,"userNameUsed")
    ;

    private Integer code;
    private String message;
    // ç§æœ‰æ„é€ å™¨ï¼Œé¿å…å¤–ç•Œåˆ›å»º
    private ResultCodeEnum(Integer code, String message) {
        this.code = code;
        this.message = message;
    }
    public Integer getCode() {
        return code;
    }
    public String getMessage() {
        return message;
    }
}

```

- å…¨å±€ç»Ÿä¸€å“åº”çš„JSONæ ¼å¼å¤„ç†ç±»
```java
public class Result<T> {
    // è¿”å›ç 
    private Integer code;
    // è¿”å›æ¶ˆæ¯
    private String message;
    // è¿”å›æ•°æ®
    private T data;
    
    public Result(){}
    
    // æ„å»ºresultï¼Œåªä¼ å…¥dataä¿¡æ¯
    protected static <T> Result<T> build(T data) {
        Result<T> result = new Result<T>();
        if (data != null)
            result.setData(data);
        return result;
    }
	
    // æ„å»ºresultï¼Œä¼ å…¥dataã€codeã€message
    public static <T> Result<T> build(T body, Integer code, String message) {
        Result<T> result = build(body);
        result.setCode(code);
        result.setMessage(message);
        return result;
    }
    
    // æ„å»ºresultï¼Œä¼ å…¥dataã€resultCodeEnum
    public static <T> Result<T> build(T body, ResultCodeEnum resultCodeEnum) {
        Result<T> result = build(body);
        result.setCode(resultCodeEnum.getCode());
        result.setMessage(resultCodeEnum.getMessage());
        return result;
    }
    
	
    //å¿«é€Ÿæ„å»º æ“ä½œæˆåŠŸçš„ Resultå¯¹è±¡
    public static<T> Result<T> ok(T data){
        Result<T> result = build(data);
        return build(data, ResultCodeEnum.SUCCESS);
    }

    
    public Result<T> message(String msg){
        this.setMessage(msg);
        return this;
    }

    
    public Result<T> code(Integer code){
        this.setCode(code);
        return this;
    }
    
    //ä¸‰ä¸ªå±æ€§çš„getå’Œsetæ–¹æ³•...
}
```

- å¢åŠ Jacksonä¾èµ–
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/54c517a923d660171af8354d8e261060.png)

- æ·»åŠ WEBUtilå·¥å…·ç±»
```java
public class WebUtil {
    private static ObjectMapper objectMapper;
    // åˆå§‹åŒ–objectMapper
    static{
        objectMapper=new ObjectMapper();
        // è®¾ç½®JSONå’ŒObjectè½¬æ¢æ—¶çš„æ—¶é—´æ—¥æœŸæ ¼å¼
        objectMapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));
    }
    // ä»è¯·æ±‚ä¸­è·å–JSONä¸²å¹¶è½¬æ¢ä¸ºObject
    public static <T> T readJson(HttpServletRequest request,Class<T> clazz){
        T t =null;
        BufferedReader reader = null;
        try {
            reader = request.getReader();
            StringBuffer buffer =new StringBuffer();
            String line =null;
            while((line = reader.readLine())!= null){
                buffer.append(line);
            }

            t= objectMapper.readValue(buffer.toString(),clazz);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
        return t;
    }
    // å°†Resultå¯¹è±¡è½¬æ¢æˆJSONä¸²å¹¶æ”¾å…¥å“åº”å¯¹è±¡
    public static void writeJson(HttpServletResponse response, Result result){
        response.setContentType("application/json;charset=UTF-8");
        try {
            String json = objectMapper.writeValueAsString(result);
            response.getWriter().write(json);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
}
```

- ç”¨æˆ·åæ ¡éªŒä¸šåŠ¡æ¥å£ä»£ç 
```java
protected void checkUsernameUsed(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
	String username = req.getParameter("username");
	SysUser registUser = userService.findByUsername(username);

	//å°è£…ç»“æœå¯¹è±¡
	Result result=null;
	if(null ==registUser){
		// æœªå ç”¨,åˆ›å»ºä¸€ä¸ªcodeä¸º200çš„å¯¹è±¡
		result= Result.ok(null);
	}else{
		// å ç”¨, åˆ›å»ºä¸€ä¸ªç»“æœä¸º505çš„å¯¹è±¡
		result= Result.build(null, ResultCodeEnum.USERNAME_USED);

	}
	// å°†resultå¯¹è±¡è½¬æ¢æˆJSONå¹¶å“åº”ç»™å®¢æˆ·ç«¯
	WebUtil.writeJson(resp,result);

}
```

- `æ³¨æ„`ï¼š
	- ç”¨æˆ·åå·²å ç”¨åï¼Œè¡¨å•è¿˜æ˜¯å¯ä»¥æäº¤
	- åç»­æˆ‘ä»¬ä½¿ç”¨Vueçš„axiosè¿›è¡Œå¤„ç†
## 5 ç¬¬äº”æœŸ

### 5.1 é‡æ„é¡¹ç›®å‰ç«¯

æ¶‰åŠæŠ€æœ¯ï¼š
- nodejs + npm
- vue + vite
- vue-router
#### 5.1.1 ç›®æ ‡å±•ç¤º

+ ç™»å½•é¡µ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b10f9ee9e1e0dcbba986c242a74816b9.png)
+ æ³¨å†Œé¡µ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/6b5862f9e9e854a3ce75e5897366959e.png)
+ æ—¥ç¨‹ç®¡ç†é¡µ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/5aa39e236ebcd66caece64535c488e5b.png)
#### 5.1.2 åˆ›å»ºé¡¹ç›®ï¼Œå®‰è£…ä¾èµ–

```shell
npm create vite
cd é¡¹ç›®ç›®å½•
npm  install
npm  install vue-router
```

- é¡¹ç›®ç»“æ„å¦‚ä¸‹![|200|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/1afabdb6818f55455789d3cfe65beb4d.png)
#### 5.1.3 å¼€å‘è§†å›¾

- Header.vue
```vue
<script setup>

</script>

<template>
  <div>
    <h1 class="ht">æ¬¢è¿ä½¿ç”¨æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿ</h1>
    <div>
      <div  class="optionDiv">
        <router-link to="/login">
          <button class="b1s">ç™»å½•</button>
        </router-link>   
        <router-link to="/regist">
          <button class="b1s">æ³¨å†Œ</button>
        </router-link>
      </div>


      <div   class="optionDiv">
        æ¬¢è¿xxx   
        <button class="b1b">é€€å‡ºç™»å½•</button> 
        <router-link to="/showSchedule">
          <button class="b1b">æŸ¥çœ‹æˆ‘çš„æ—¥ç¨‹</button>
        </router-link>
      </div>

      <br>
    </div>
  </div>
</template>

<style scoped>

  .ht{
      text-align: center;
      color: cadetblue;
      font-family: å¹¼åœ†;
  }
  .b1s{
        border: 2px solid powderblue;
        border-radius: 4px;
        width:60px;
        background-color: antiquewhite;

    }

    .b1b{
        border: 2px solid powderblue;
        border-radius: 4px;
        width:100px;
        background-color: antiquewhite;
    }
    .optionDiv{
      width: 300px;
      float: right;
    }
</style>
```

- login.vueè§†å›¾
```java
<script setup>
       import{ ref,reactive} from 'vue'
       // å“åº”å¼æ•°æ®,ä¿å­˜ç”¨æˆ·è¾“å…¥çš„è¡¨å•ä¿¡æ¯
       let loginUser =reactive({
        username:'',
        userPwd:''
       })

       // å“åº”å¼æ•°æ®,ä¿å­˜æ ¡éªŒçš„æç¤ºä¿¡æ¯
       let usernameMsg =ref('')
       let userPwdMsg = ref('')

        // æ ¡éªŒç”¨æˆ·åçš„æ–¹æ³•
        function checkUsername(){
            // å®šä¹‰æ­£åˆ™
            var usernameReg=/^[a-zA-Z0-9]{5,10}$/
            // æ ¡éªŒç”¨æˆ·å
            if(!usernameReg.test(loginUser.username)){
                // æ ¼å¼ä¸åˆæ³•
                usernameMsg.value="æ ¼å¼æœ‰è¯¯"
                return false
            }
            usernameMsg.value="ok"
            return true
        }
        // æ ¡éªŒå¯†ç çš„æ–¹æ³•
        function checkUserPwd(){
            // å®šä¹‰æ­£åˆ™
            var passwordReg=/^[0-9]{6}$/
             // æ ¡éªŒå¯†ç 
             if(!passwordReg.test(loginUser.userPwd)){
                // æ ¼å¼ä¸åˆæ³•
                userPwdMsg.value="æ ¼å¼æœ‰è¯¯"
                return false
            }
            userPwdMsg.value="ok"
            return true
        }
</script>

<template>
  <div>
    <h3 class="ht">è¯·ç™»å½•</h3>
        <table class="tab" cellspacing="0px">
            <tr class="ltr">
                <td>è¯·è¾“å…¥è´¦å·</td>
                <td>
                    <input class="ipt" 
                    type="text" 
                    v-model="loginUser.username"
                    @blur="checkUsername()">
                    <span id="usernameMsg" v-text="usernameMsg"></span>
                </td>
            </tr>
            <tr class="ltr">
                <td>è¯·è¾“å…¥å¯†ç </td>
                <td>
                    <input class="ipt" 
                    type="password" 
                    v-model="loginUser.userPwd"
                    @blur="checkUserPwd()">
                    <span id="userPwdMsg" v-text="userPwdMsg"></span>
                </td>
            </tr>
            <tr class="ltr">
                <td colspan="2" class="buttonContainer">
                    <input class="btn1" type="button" value="ç™»å½•">
                    <input class="btn1" type="button" value="é‡ç½®">
                    <router-link to="/regist">
                      <button class="btn1">å»æ³¨å†Œ</button>
                    </router-link>
                </td>
            </tr>
        </table>
  </div>
</template>

<style scoped>
	.ht{
		text-align: center;
		color: cadetblue;
		font-family: å¹¼åœ†;
	}
	.tab{
		width: 500px;
		border: 5px solid cadetblue;
		margin: 0px auto;
		border-radius: 5px;
		font-family: å¹¼åœ†;
	}
	.ltr td{
		border: 1px solid  powderblue;
	}
	.ipt{
		border: 0px;
		width: 50%;
	}
	.btn1{
		border: 2px solid powderblue;
		border-radius: 4px;
		width:60px;
		background-color: antiquewhite;
	}
	#usernameMsg , #userPwdMsg {
		color: gold;
	}
	.buttonContainer{
		text-align: center;
	}
</style>
```

- Regist.vueè§†å›¾
```vue
<script setup>
      import{ ref,reactive} from 'vue'
       // å“åº”å¼æ•°æ®,ä¿å­˜ç”¨æˆ·è¾“å…¥çš„è¡¨å•ä¿¡æ¯
       let registUser =reactive({
        username:'',
        userPwd:''
       })

       // å“åº”å¼æ•°æ®,ä¿å­˜æ ¡éªŒçš„æç¤ºä¿¡æ¯
       let reUserPwd =ref('')
       let reUserPwdMsg =ref('')
       let usernameMsg =ref('')
       let userPwdMsg = ref('')

          // æ ¡éªŒç”¨æˆ·åçš„æ–¹æ³•
        function checkUsername(){
            // å®šä¹‰æ­£åˆ™
            let usernameReg=/^[a-zA-Z0-9]{5,10}$/
            // æ ¡éªŒ
            if(!usernameReg.test(registUser.username)){
              // æç¤º
              usernameMsg.value = "ä¸åˆæ³•"
              return false
            }
            // é€šè¿‡æ ¡éªŒ
            usernameMsg.value="OK"
            return true
        }
        // æ ¡éªŒå¯†ç çš„æ–¹æ³•
        function checkUserPwd(){
            // å®šä¹‰æ­£åˆ™
            let passwordReg=/^[0-9]{6}$/
             // æ ¡éªŒ
             if(!passwordReg.test(registUser.userPwd)){
              // æç¤º
              userPwdMsg.value = "ä¸åˆæ³•"
              return false
            }
            // é€šè¿‡æ ¡éªŒ
            userPwdMsg.value="OK"
            return true
        }
        // æ ¡éªŒå¯†ç çš„æ–¹æ³•
        function checkReUserPwd(){
            // å®šä¹‰æ­£åˆ™
            let passwordReg=/^[0-9]{6}$/
            // æ ¡éªŒ
            if(!passwordReg.test(reUserPwd.value)){
              // æç¤º
              reUserPwdMsg.value = "ä¸åˆæ³•"
              return false
            }
            console.log(registUser.userPwd,reUserPwd.value)
            // æ ¡éªŒ
            if(!(registUser.userPwd==reUserPwd.value)){
              // æç¤º
              reUserPwdMsg.value = "ä¸ä¸€è‡´"
              return false
            }


            // é€šè¿‡æ ¡éªŒ
            reUserPwdMsg.value="OK"
            return true
        }
</script>

<template>
  <div>
    <h3 class="ht">è¯·æ³¨å†Œ</h3>

    <table class="tab" cellspacing="0px">
        <tr class="ltr">
            <td>è¯·è¾“å…¥è´¦å·</td>
            <td>
                <input class="ipt" 
                  id="usernameInput" 
                  type="text" 
                  name="username" 
                  v-model="registUser.username"
                  @blur="checkUsername()">

                <span id="usernameMsg" class="msg" v-text="usernameMsg"></span>
            </td>
        </tr>
        <tr class="ltr">
            <td>è¯·è¾“å…¥å¯†ç </td>
            <td>
                <input class="ipt" 
                id="userPwdInput" 
                type="password" 
                name="userPwd" 
                v-model="registUser.userPwd"
                @blur="checkUserPwd()">
                <span id="userPwdMsg" class="msg" v-text="userPwdMsg"></span>
            </td>
        </tr>
        <tr class="ltr">
            <td>ç¡®è®¤å¯†ç </td>
            <td>
                <input class="ipt" 
                id="reUserPwdInput" 
                type="password" 
                v-model="reUserPwd"
                @blur="checkReUserPwd()">
                <span id="reUserPwdMsg" class="msg" v-text="reUserPwdMsg"></span>
            </td>
        </tr>
        <tr class="ltr">
            <td colspan="2" class="buttonContainer">
                <input class="btn1" type="button" value="æ³¨å†Œ">
                <input class="btn1" type="button" value="é‡ç½®">
                <router-link to="/login">
                  <button class="btn1">å»ç™»å½•</button>
                </router-link>
            </td>
        </tr>
    </table>


  </div>
</template>

<style scoped>
       .ht{
            text-align: center;
            color: cadetblue;
            font-family: å¹¼åœ†;
        }
        .tab{
            width: 500px;
            border: 5px solid cadetblue;
            margin: 0px auto;
            border-radius: 5px;
            font-family: å¹¼åœ†;
        }
        .ltr td{
            border: 1px solid  powderblue;

        }
        .ipt{
            border: 0px;
            width: 50%;

        }
        .btn1{
            border: 2px solid powderblue;
            border-radius: 4px;
            width:60px;
            background-color: antiquewhite;

        }
        .msg {
            color: gold;
        }
        .buttonContainer{
            text-align: center;
        }
</style>
```

- ShowSchedule.vueè§†å›¾
```vue
<script setup>

</script>

<template>
  <div>
    <h3 class="ht">æ‚¨çš„æ—¥ç¨‹å¦‚ä¸‹</h3>
<table class="tab" cellspacing="0px">
    <tr class="ltr">
        <th>ç¼–å·</th>
        <th>å†…å®¹</th>
        <th>è¿›åº¦</th>
        <th>æ“ä½œ</th>
    </tr>
    <tr class="ltr">
        <td></td>
        <td></td>
        <td></td>
        <td class="buttonContainer">
             <button class="btn1">åˆ é™¤</button>
            <button class="btn1">ä¿å­˜ä¿®æ”¹</button>
        </td>
    </tr>
    <tr class="ltr buttonContainer" >
        <td colspan="4">
            <button class="btn1">æ–°å¢æ—¥ç¨‹</button>
        </td>

    </tr>
</table>
  </div>
</template>

<style scoped>

      .ht{
            text-align: center;
            color: cadetblue;
            font-family: å¹¼åœ†;
        }
        .tab{
            width: 80%;
            border: 5px solid cadetblue;
            margin: 0px auto;
            border-radius: 5px;
            font-family: å¹¼åœ†;
        }
        .ltr td{
            border: 1px solid  powderblue;

        }
        .ipt{
            border: 0px;
            width: 50%;

        }
        .btn1{
            border: 2px solid powderblue;
            border-radius: 4px;
            width:100px;
            background-color: antiquewhite;

        }
        #usernameMsg , #userPwdMsg {
            color: gold;
        }

        .buttonContainer{
            text-align: center;
        }

</style>
```

- App.vueè§†å›¾
```vue
<script setup>

import Header from './components/Header.vue'
</script>

<template>
  <div>
    <Header></Header>
    <hr>
    <!-- ç”¨äºè·¯ç”±åˆ‡æ¢è§†å›¾ä½¿ç”¨ -->
    <router-view></router-view>
  
  </div>
</template>

<style scoped>

</style>
```
#### 5.1.4 é…ç½®jsæ–‡ä»¶

- é…ç½®router.js
```js
import {createRouter,createWebHashHistory} from 'vue-router'

import Login from '../components/Login.vue'
import Regist from '../components/Regist.vue'
import ShowScedule from '../components/ShowSchedule.vue'

let  router = createRouter({
    history:createWebHashHistory(),
    routes:[
        {
            path:"/",
            component:Login
        },
        {
            path:"/login",
            component:Login
        },
        {
            path:"/showSchedule",
            component:ShowScedule
        },
        {
            path:"/regist",
            component:Regist
        }


    ]
})

export default router
```

- é…ç½®main.js
```js
import { createApp } from 'vue'

import App from './App.vue'

// å¯¼å…¥è·¯ç”±
import router from './router/router.js'

let app =createApp(App)

// å…¨å±€ä½¿ç”¨è·¯ç”±
app.use(router)

app.mount('#app')
```

## 6 ç¬¬å…­æœŸ

æ¶‰åŠæŠ€æœ¯ï¼š
- axios
- è·¨åŸŸ

é¡¹ç›®å…ˆå®‰è£…axios
```shell
npm install axios
```
### 6.1 å‰ç«¯ä»£ç å¤„ç†

#### 6.1.1 åˆ›å»ºrequest.jsæ–‡ä»¶

åœ¨srcåˆ›å»ºutilsæ–‡ä»¶å¤¹ï¼Œç„¶ååˆ›å»ºrequest.jsæ–‡ä»¶
```js
import axios from 'axios'

//åˆ›å»ºinstanceå®ä¾‹
const instance = axios.create({baseURL:'http://localhost:8080'})

//æ·»åŠ è¯·æ±‚æ‹¦æˆª
instance.interceptors.request.use(
Â  Â  //è®¾ç½®è¯·æ±‚å¤´æˆåŠŸå¤„ç†å‡½æ•°
Â  Â  config=>{
Â  Â  Â  Â  //å¤„ç†æŒ‡å®šçš„è¯·æ±‚å¤´
Â  Â  Â  Â  return config
Â  Â  },
Â  Â  //è®¾ç½®è¯·æ±‚é”™è¯¯å¤„ç†å‡½æ•°
Â  Â  error=>{
Â  Â  Â  Â  return Promise.reject(error)
Â  Â  }
)

//æ·»åŠ å“åº”æ‹¦æˆª
instance.interceptors.response.use(
Â  Â  // è®¾ç½®å“åº”æ­£ç¡®æ—¶çš„å¤„ç†å‡½æ•°
Â  Â  response=>{return response},
Â  Â  // è®¾ç½®å“åº”å¼‚å¸¸æ—¶çš„å¤„ç†å‡½æ•°
Â  Â  error=>{return Promise.reject(error)}
)

// é»˜è®¤å¯¼å‡ºinstanceå®ä¾‹
export default instance
```

#### 6.1.2 æ³¨å†Œé¡µé¢å®Œæˆæ³¨å†Œ

```js
// æ³¨å†Œçš„æ–¹æ³•
async function regist(){
	// æ ¡éªŒæ‰€æœ‰çš„è¾“å…¥æ¡†æ˜¯å¦åˆæ³•
	let flag1 =await checkUsername()
	let flag2 =await checkUserPwd()
	let flag3 =await checkReUserPwd()
	if(flag1 && flag2 && flag3){
	  let  {data}= await request.post("user/regist",registUser)
	  if(data.code == 200){
		// æ³¨å†ŒæˆåŠŸè·³è½¬ ç™»å½•é¡µ
		alert("æ³¨å†ŒæˆåŠŸ,å¿«å»ç™»å½•å§")
		router.push("/login")
	  }else{
		alert("æŠ±æ­‰,ç”¨æˆ·åè¢«æŠ¢æ³¨äº†")
	  }
	}else{
		alert("æ ¡éªŒä¸é€šè¿‡,è¯·æ±‚å†æ¬¡æ£€æŸ¥æ•°æ®")
	}
}

function clearForm(){
	registUser.username=""
	registUser.userPwd=""
	usernameMsg.value=""
	userPwdMsg.value=""
	reUserPwd.value=""
	reUserPwdMsg.value=""

}
```
#### 6.1.3 ç™»å½•é¡µé¢å®Œæˆç™»å½•

```js
async function login(){
	// è¡¨å•æ•°æ®æ ¼å¼éƒ½æ­£ç¡®å†æäº¤
	let flag1 =checkUsername()
	let flag2 =checkUserPwd()
	if(!(flag1 && flag2)){
		return 
	}
   let {data} = await request.post("user/login",loginUser)
   if(data.code == 200 ){
		alert("ç™»å½•æˆåŠŸ")
		// è·³è½¬åˆ°showSchedule
		router.push("/showSchedule")
   } else if( data.code == 503){
		alert("å¯†ç æœ‰è¯¯")

   }else if (data.code == 501 ){
		alert("ç”¨æˆ·åæœ‰è¯¯")
   }else {
		alert("æœªçŸ¥é”™è¯¯")
   }
   
}
```

### 6.2 åç«¯ä»£ç å¤„ç†

#### 6.2.1 æ·»åŠ è·¨åŸŸå¤„ç†å™¨

##### 6.2.1.1 ä»€ä¹ˆæ˜¯è·¨åŸŸ

åŒæºç­–ç•¥ï¼ˆSameoriginpolicyï¼‰æ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚æœç¼ºå°‘äº†åŒæºç­–ç•¥ï¼Œåˆ™æµè§ˆå™¨çš„æ­£å¸¸åŠŸèƒ½å¯èƒ½éƒ½ä¼šå—åˆ°å½±å“ã€‚å¯ä»¥è¯´Webæ˜¯æ„å»ºåœ¨åŒæºç­–ç•¥åŸºç¡€ä¹‹ä¸Šçš„ï¼Œæµè§ˆå™¨åªæ˜¯é’ˆå¯¹åŒæºç­–ç•¥çš„ä¸€ç§å®ç°ã€‚

`åŒæºç­–ç•¥ä¼šé˜»æ­¢ä¸€ä¸ªåŸŸçš„javascriptè„šæœ¬å’Œå¦å¤–ä¸€ä¸ªåŸŸçš„å†…å®¹è¿›è¡Œäº¤äº’ã€‚æ‰€è°“åŒæºï¼ˆå³æŒ‡åœ¨åŒä¸€ä¸ªåŸŸï¼‰å°±æ˜¯ä¸¤ä¸ªé¡µé¢å…·æœ‰ç›¸åŒçš„åè®®ï¼ˆprotocolï¼‰ï¼Œä¸»æœºï¼ˆhostï¼‰å’Œç«¯å£å·`
##### 6.2.1.2 ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè·¨åŸŸ

å‰åç«¯åˆ†ç¦»æ¨¡å¼ä¸‹,å®¢æˆ·ç«¯è¯·æ±‚å‰ç«¯æœåŠ¡å™¨è·å–è§†å›¾èµ„æº

ç„¶åå®¢æˆ·ç«¯è‡ªè¡Œå‘åç«¯æœåŠ¡å™¨è·å–æ•°æ®èµ„æº

`å‰ç«¯æœåŠ¡å™¨çš„ åè®®,IPå’Œç«¯å£å’Œåç«¯æœåŠ¡å™¨å¾ˆå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„,è¿™æ ·å°±äº§ç”Ÿäº†è·¨åŸŸ`

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7783b393c377f86a6a222492f993d801.png)
##### 6.2.1.3 å¦‚ä½•è§£å†³è·¨åŸŸ

> `æ–¹å¼ä¸€ï¼šå‰ç«¯é¡¹ç›®ä»£ç†æ¨¡å¼å¤„ç†`

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/890c11f42806f3e242858b863e9885e4.png)
![1683365066926](file:///F:/00_Java%E5%AD%A6%E4%B9%A0%E5%BA%93/2_%E5%B0%9A%E7%A1%85%E8%B0%B7%E8%AF%BE%E7%A8%8B/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%85%A8%E6%96%B0JavaWeb%E9%87%8C%E7%A8%8B%E7%A2%91%E7%89%88/%E7%AC%94%E8%AE%B0/images/1683365066926-1690533535580.png?lastModify=1711098435)

> `æ–¹å¼äºŒï¼šåç«¯è·¨åŸŸè¿‡æ»¤å™¨æ–¹å¼å¤„ç†`

![1683364436315](file:///F:/00_Java%E5%AD%A6%E4%B9%A0%E5%BA%93/2_%E5%B0%9A%E7%A1%85%E8%B0%B7%E8%AF%BE%E7%A8%8B/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%85%A8%E6%96%B0JavaWeb%E9%87%8C%E7%A8%8B%E7%A2%91%E7%89%88/%E7%AC%94%E8%AE%B0/images/1683364436315-1690533535580.png?lastModify=1711098435)
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/1632f650272f1bc71cde6a0c65a74de2.png)

- CrosFilterè¿‡æ»¤å™¨
- `å‘Šè¯‰æµè§ˆå™¨ï¼Œåç«¯çš„æ•°æ®ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨`
â€‹  
```java
@WebFilter("/*")  
public class CrosFilter implements Filter {  
 Â  Â @Override  
 Â  Â public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {  
â€‹  
 Â  Â  Â  Â HttpServletRequest request = (HttpServletRequest) servletRequest;  
 Â  Â  Â  Â System.out.println(request.getMethod());  
 Â  Â  Â  Â HttpServletResponse response = (HttpServletResponse) servletResponse;  
 Â  Â  Â  Â response.setHeader("Access-Control-Allow-Origin", "*");  
 Â  Â  Â  Â response.setHeader("Access-Control-Allow-Methods", "POST, GET, PUT,OPTIONS, DELETE, HEAD");  
 Â  Â  Â  Â response.setHeader("Access-Control-Max-Age", "3600");  
 Â  Â  Â  Â response.setHeader("Access-Control-Allow-Headers", "access-control-allow-origin, authority, content-type, version-info, X-Requested-With");  
 Â  Â  Â  Â // å¦‚æœæ˜¯è·¨åŸŸé¢„æ£€è¯·æ±‚,åˆ™ç›´æ¥åœ¨æ­¤å“åº”200ä¸šåŠ¡ç   
 Â  Â  Â  Â if(request.getMethod().equalsIgnoreCase("OPTIONS")){  
 Â  Â  Â  Â  Â  Â WebUtil.writeJson(response, Result.ok(null));  
 Â  Â  Â   }else{  
 Â  Â  Â  Â  Â  Â // éé¢„æ£€è¯·æ±‚,æ”¾è¡Œå³å¯  
 Â  Â  Â  Â  Â  Â filterChain.doFilter(servletRequest, servletResponse);  
 Â  Â  Â   }  
 Â   }  
}  
â€‹
```

- `æœªæ¥æˆ‘ä»¬ä½¿ç”¨æ¡†æ¶,ç›´æ¥ç”¨ä¸€ä¸ª@CrossOrigin å°±å¯ä»¥è§£å†³è·¨åŸŸé—®é¢˜äº†`
#### 6.2.2 é‡æ„UserController

```java
@WebServlet("/user/*")
public class UserController extends BaseController{
    private SysUserService userService =new SysUserServiceImpl();


    /**
     * æ³¨å†Œæ—¶æ ¡éªŒç”¨æˆ·åæ˜¯å¦è¢«å ç”¨çš„ä¸šåŠ¡æ¥å£
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void checkUsernameUsed(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String username = req.getParameter("username");
        SysUser registUser = userService.findByUsername(username);

        //å°è£…ç»“æœå¯¹è±¡
        Result result=null;
        if(null ==registUser){
            // æœªå ç”¨,åˆ›å»ºä¸€ä¸ªcodeä¸º200çš„å¯¹è±¡
            result= Result.ok(null);
        }else{
            // å ç”¨, åˆ›å»ºä¸€ä¸ªç»“æœä¸º505çš„å¯¹è±¡
            result= Result.build(null, ResultCodeEnum.USERNAME_USED);

        }
        // å°†resultå¯¹è±¡è½¬æ¢æˆJSONå¹¶å“åº”ç»™å®¢æˆ·ç«¯
        WebUtil.writeJson(resp,result);

    }

    /**
     * ç”¨æˆ·æ³¨å†Œçš„ä¸šåŠ¡æ¥å£
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void regist(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // æ¥æ”¶è¦æ³¨å†Œçš„ç”¨æˆ·ä¿¡æ¯
        SysUser registUser = WebUtil.readJson(req, SysUser.class);
        // è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•,å°†ç”¨æˆ·æ³¨å†Œè¿›å…¥æ•°æ®åº“
        int rows =userService.regist(registUser);
        Result result =null;
        if(rows>0){
           result=Result.ok(null);
        }else{
           result =Result.build(null,ResultCodeEnum.USERNAME_USED);
        }
        WebUtil.writeJson(resp,result);
    }

    /**
     * ç”¨æˆ·ç™»å½•çš„ä¸šåŠ¡æ¥å£
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void login(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        // æ¥æ”¶ç”¨æˆ·è¯·æ±‚å‚æ•°
        // è·å–è¦ç™»å½•çš„ç”¨æˆ·åå¯†ç 
        SysUser inputUser = WebUtil.readJson(req, SysUser.class);
        // è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•,æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“ä¸­æ˜¯å¦æœ‰ä¸€ä¸ªç”¨æˆ·
        SysUser loginUser =userService.findByUsername(inputUser.getUsername());

        Result result = null;

        if(null == loginUser){
            // æ²¡æœ‰æ ¹æ®ç”¨æˆ·åæ‰¾åˆ°ç”¨æˆ·,è¯´æ˜ç”¨æˆ·åæœ‰è¯¯
            result=Result.build(null,ResultCodeEnum.USERNAME_ERROR);
        }else if(! loginUser.getUserPwd().equals(MD5Util.encrypt(inputUser.getUserPwd()))){
            // ç”¨æˆ·å¯†ç æœ‰è¯¯,
           result=Result.build(null,ResultCodeEnum.PASSWORD_ERROR);
        }else{
            // ç™»å½•æˆåŠŸ
            result=Result.ok(null);
        }

        WebUtil.writeJson(resp,result);

    }
}
```

#### 6.2.3 åˆ é™¤ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨

- è¿™é‡Œä¸ä½¿ç”¨cookieå’Œsessionæ–¹å¼è®°å½•ç”¨æˆ·çŠ¶æ€,æœªæ¥ä½¿ç”¨token,æ‰€ä»¥ç™»å½•è¿‡æ»¤å™¨åˆ é™¤å³å¯

## 7 ç¬¬ä¸ƒæœŸ

æ¶‰åŠæŠ€æœ¯ï¼š
- pinia

### 7.1 å‰ç«¯ä¿å­˜ç”¨æˆ·ä¿¡æ¯

- å®‰è£…piniaä¾èµ–
```shell
npm install pinia
```

- srcä¸‹åˆ›å»ºpinia.jsæ–‡ä»¶
```js
// å¯¼å…¥piniaç»„ä»¶
import {createPinia} from 'pinia'
// åˆ›å»ºpiniaå¯¹è±¡
let pinia = createPinia()
// å¯¼å‡ºé»˜è®¤çš„pinia
export default pinia
```

+ main.jsä¸­ä½¿ç”¨pinia
``` js
import { createApp } from 'vue'
import App from './App.vue'
// å¯¼å…¥è·¯ç”±
import router from './router/router.js'
// å¯¼å…¥piniaå¯¹è±¡
import pinia from './pinia.js'
let app =createApp(App)
// å…¨å±€ä½¿ç”¨è·¯ç”±
app.use(router)
// å…¨å±€ä½¿ç”¨pinia
app.use(pinia)
app.mount('#app')
```

+ src/store/userStore.js ç”¨äºå­˜å‚¨ç”¨æˆ·ä¿¡æ¯
``` javascript
import {defineStore} from 'pinia'

export const defineUser = defineStore('loginUser',{
    state:()=>{
        return {
            uid:0,
            username:''
        }
    },
    getters :{
       
    }

})
```

+ src/store/scheduleStore.js ç”¨äºå­˜å‚¨ç”¨æˆ·çš„æ—¥ç¨‹ä¿¡æ¯
``` javaScript
import {defineStore} from 'pinia'

export const defineSchedule = defineStore('scheduleList',{
    state:()=>{
        return {
            itemList:[
                /*{
                    sid:1,
                    uid:1,
                    title:'å­¦java',
                    completed:1
                },
                {
                    sid:2,
                    uid:1,
                    title:'å­¦å‰ç«¯',
                    completed:0
                }*/
            ]
        }
    },
    getters :{
       
    },
    actions:{

    }

})
```

### 7.2 å‰åç«¯é¡µé¢ä¿®æ”¹

#### 7.2.1 HeadVue

+ Header.vueä¸­,é€šè¿‡piniaçš„æ•°æ®æ¥åˆ¤æ–­å±•ç¤ºä½•ç§æç¤º è§†å›¾
	+ ä½¿ç”¨piniaè·å–å’Œ{{}}è·å–ç”¨æˆ·å
	+ ä½¿ç”¨piniaå®Œæˆé€€å‡ºç™»å½•logoutå‡½æ•°çš„å†…éƒ¨é€»è¾‘

``` html
<script setup>
    /* å¯¼å…¥piniaä¸­çš„useræ•°æ® */
    import {defineUser} from '../store/userStore.js'
    import {defineSchedule} from '../store/scheduleStore.js'
    let sysUser =defineUser()
    let schedule = defineSchedule();

    /* å¯¼å…¥ç¼–ç¨‹å¼è·¯ç”± */
    import {useRouter} from 'vue-router'
    let  router =useRouter()
    /* é€€å‡ºç™»å½•æ¥å£ */
    function logout(){
      // æ¸…é™¤userPina å’Œschedulepinia
      sysUser.$reset()
      schedule.$reset()
      // é€šè¿‡è·¯ç”±å›åˆ°ç™»å½•é¡µ
      router.push("/login")
    }
</script>

<template>
  <div>
    <h1 class="ht">æ¬¢è¿ä½¿ç”¨æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿ</h1>
    <div>
      <div  class="optionDiv" v-if="sysUser.username == ''">
        <router-link to="/login">
          <button class="b1s">ç™»å½•</button>
        </router-link>   
        <router-link to="/regist">
          <button class="b1s">æ³¨å†Œ</button>
        </router-link>
      </div>


      <div   class="optionDiv" v-else>
        æ¬¢è¿{{sysUser.username}}   
        <button class="b1b" @click="logout()">é€€å‡ºç™»å½•</button> 
        <router-link to="/showSchedule">
          <button class="b1b">æŸ¥çœ‹æˆ‘çš„æ—¥ç¨‹</button>
        </router-link>
      </div>

      <br>
    </div>
  </div>
</template>
```

#### 7.2.2 Login.vue

- Login.vueä¸­,ç™»å½•æˆåŠŸå,æ¥æ”¶åç«¯å“åº”å›æ¥çš„ç”¨æˆ·idå’Œç”¨æˆ·å,å­˜å‚¨äºuserStoreä¸­
```vue
<script setup>  
 Â  Â  Â  Â /* å¯¼å…¥piniaä¸­çš„useræ•°æ® */  
 Â  Â  Â  Â import {defineUser} from '../store/userStore.js'  
 Â  Â  Â  Â let sysUser =defineUser()  
 Â  Â  Â  Â /* è·å– ç¼–ç¨‹å¼è·¯ç”±å¯¹è±¡ */  
 Â  Â  Â  Â import {useRouter} from 'vue-router'  
 Â  Â  Â  Â let router =useRouter();  
 Â  Â  Â  Â /* å¯¼å…¥axiosè¯·æ±‚å¯¹è±¡ */  
 Â  Â  Â  Â import request from '../utils/request.js'  
â€‹  
 Â  Â  Â  //   
 Â  Â  Â  import{ ref,reactive} from 'vue'  
 Â  Â  Â  // å“åº”å¼æ•°æ®,ä¿å­˜ç”¨æˆ·è¾“å…¥çš„è¡¨å•ä¿¡æ¯  
 Â  Â  Â  let loginUser =reactive({  
 Â  Â  Â  Â username:'',  
 Â  Â  Â  Â userPwd:''  
 Â  Â  Â  })  
â€‹  
	//..... 
â€‹  
â€‹  
 Â  Â  Â  Â // ç™»å½•çš„å‡½æ•°  
 Â  Â  Â  Â async function Â login(){  
 Â  Â  Â  Â  Â  Â console.log("å‘é€å¼‚æ­¥è¯·æ±‚")  
 Â  Â  Â  Â  Â  Â let {data} = await request.post("/user/login",loginUser)  
 Â  Â  Â  Â  Â  Â if(data.code == 200){  
 Â  Â  Â  Â  Â  Â  Â  Â alert("ç™»å½•æˆåŠŸ")  
 Â  Â  Â  Â  Â  Â  Â  Â // æ›´æ–°piniaæ•°æ®  
 Â  Â  Â  Â  Â  Â  Â  Â sysUser.uid =data.data.loginUser.uid  
 Â  Â  Â  Â  Â  Â  Â  Â sysUser.username =data.data.loginUser.username  
 Â  Â  Â  Â  Â  Â  Â  Â // è·³è½¬åˆ°æ—¥ç¨‹æŸ¥è¯¢é¡µ  
 Â  Â  Â  Â  Â  Â  Â  Â router.push("/showSchedule")  
 Â  Â  Â  Â  Â  Â  Â  Â   
 Â  Â  Â  Â  Â   }else if(data.code == 501){  
 Â  Â  Â  Â  Â  Â  Â  Â alert("ç”¨æˆ·åæœ‰è¯¯,è¯·é‡æ–°è¾“å…¥")  
 Â  Â  Â  Â  Â   }else if(data.code == 503){  
 Â  Â  Â  Â  Â  Â  Â  Â alert("å¯†ç æœ‰è¯¯,è¯·é‡æ–°è¾“å…¥")  
 Â  Â  Â  Â  Â   }else {  
 Â  Â  Â  Â  Â  Â  Â  Â alert("å‡ºç°æœªçŸ¥åé”™è¯¯")  
 Â  Â  Â  Â  Â   }  
 Â  Â  Â   }  
  
</script>  
```


#### 7.2.3 åç«¯ç™»å½•loginä»£ç 

+ æœåŠ¡ç«¯ç™»å½•å¤„ç†æ–¹æ³•,ç™»å½•æˆåŠŸ,è¿”å›ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯

``` java
    protected void login(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
	//......
	if(null == loginUser){
		// æ²¡æœ‰æ ¹æ®ç”¨æˆ·åæ‰¾åˆ°ç”¨æˆ·,è¯´æ˜ç”¨æˆ·åæœ‰è¯¯
		result=Result.build(null,ResultCodeEnum.USERNAME_ERROR);
	}else if(! loginUser.getUserPwd().equals(MD5Util.encrypt(inputUser.getUserPwd()))){
		// ç”¨æˆ·å¯†ç æœ‰è¯¯,
	   result=Result.build(null,ResultCodeEnum.PASSWORD_ERROR);
	}else{
		// ç™»å½•æˆåŠŸ,å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥session
		req.getSession().setAttribute("sysUser",loginUser);
		// ç™»å½•æˆåŠŸ
		// å°†å¯†ç è¯·ç©ºå,å°†ç”¨æˆ·ä¿¡æ¯å“åº”ç»™å®¢æˆ·ç«¯
		loginUser.setUserPwd("");
		Map<String,Object> data =new HashMap<>();
		data.put("loginUser",loginUser);
		result=Result.ok(data);
	}
	WebUtil.writeJson(resp,result);
}
```

#### 7.2.4 router.js

+ router.jsä¸­,é€šè¿‡è·¯ç”±å®ˆå«æ§åˆ¶åªæœ‰ç™»å½•çŠ¶æ€ä¸‹æ‰å¯ä»¥è¿›å…¥showSchedule.vue

``` javascript
//æ³¨æ„ï¼Œå…¶ä»–jsç»„ä»¶å¯¼å…¥piniaç»„ä»¶ï¼Œè¿˜éœ€è¦piniaå¯¹è±¡
import pinia from '../pinia.js'
import {defineUser} from '../store/userStore.js'

let sysUser = defineUser(pinia)

/* é…ç½®è·¯ç”±çš„å‰ç½®å®ˆå«,åœ¨ç™»å½•çŠ¶æ€ä¸‹æ‰å¯ä»¥èŒƒæ–‡showSchedule.vue */
router.beforeEach( (to,from,next) =>{
    // å¦‚æœæ˜¯æŸ¥çœ‹æ—¥ç¨‹
    if(to.path=="/showSchedule"){
        // å¦‚æœå°šæœªçš„ç™»å½•
        if(sysUser.username == ''){
            alert("æ‚¨å°šæœªç™»å½•,è¯·ç™»å½•åå†æŸ¥çœ‹æ—¥ç¨‹")
            next("/login")
        }else{
            // å·²ç»ç™»å½• æ”¾è¡Œ
            next()
        }
        // å…¶ä»–èµ„æº æ”¾è¡Œ
    }else{
        next()
    }
})
export default router
```


### 7.3 æ˜¾ç¤ºæ‰€æœ‰æ—¥ç¨‹æ•°æ®

- ShowSchedule.vueä¸­å‘åç«¯å‘é€å¼‚æ­¥è¯·æ±‚æŸ¥è¯¢æ•°æ®å¹¶å±•ç¤º

```vue
<script setup>  
 Â  Â /* å¼•å…¥axios */  
 Â  Â import request from '../utils/request.js'  
 Â  Â /* å¼•å…¥piniaæ•°æ® */  
 Â  Â import {defineSchedule} from '../store/scheduleStore.js'  
 Â  Â import {defineUser} from '../store/userStore.js'  
 Â  Â let schedule = defineSchedule();  
 Â  Â let sysUser = defineUser()  
 Â  Â /* å¼•å…¥æŒ‚è½½ç”Ÿå‘½å‘¨æœŸ */  
 Â  Â import { onMounted,onUpdated,ref,reactive } from 'vue';  
 Â  Â   
 Â  Â // ç¬¬ä¸€æ¬¡æŒ‚è½½å°±ç«‹åˆ»å‘åç«¯å‘é€è¯·æ±‚,è·å–æœ€æ–°æ•°æ®  
 Â  Â onMounted(async function (){  
 Â  Â  Â  Â showSchedule()  
 Â   })  
 Â  Â async function showSchedule(){  
 Â  Â  Â  Â let {data} = await request.get("/schedule/findAllSchedule",{params:{"uid":sysUser.uid}})  
 Â  Â  Â  Â schedule.itemList =data.data.itemList  
 Â   }  
â€‹  
â€‹  
</script>  
â€‹  
<template>  
 Â <div>  
 Â  Â <h3 class="ht">æ‚¨çš„æ—¥ç¨‹å¦‚ä¸‹</h3>  
<table class="tab" cellspacing="0px">  
 Â  Â <tr class="ltr">  
 Â  Â  Â  Â <th>ç¼–å·</th>  
 Â  Â  Â  Â <th>å†…å®¹</th>  
 Â  Â  Â  Â <th>è¿›åº¦</th>  
 Â  Â  Â  Â <th>æ“ä½œ</th>  
 Â  Â </tr>  
 Â  Â <tr class="ltr" v-for="item,index in schedule.itemList" :key="index">  
 Â  Â  Â  Â <td v-text="index+1">  
 Â  Â  Â  Â </td>  
 Â  Â  Â  Â <td>  
 Â  Â  Â  Â  Â  Â <input type="input" v-model="item.title">  
 Â  Â  Â  Â </td>  
 Â  Â  Â  Â <td>  
 Â  Â  Â  Â  Â  Â <input type="radio" Â  value="1" v-model="item.completed"> å·²å®Œæˆ  
 Â  Â  Â  Â  Â  Â <input type="radio" Â  value="0" v-model="item.completed"> æœªå®Œæˆ  
 Â  Â  Â  Â </td>  
 Â  Â  Â  Â <td class="buttonContainer">  
 Â  Â  Â  Â  Â  Â  <button class="btn1">åˆ é™¤</button>  
 Â  Â  Â  Â  Â  Â <button class="btn1">ä¿å­˜ä¿®æ”¹</button>  
 Â  Â  Â  Â </td>  
 Â  Â </tr>  
 Â  Â <tr class="ltr buttonContainer" >  
 Â  Â  Â  Â <td colspan="4">  
 Â  Â  Â  Â  Â  Â <button class="btn1">æ–°å¢æ—¥ç¨‹</button>  
 Â  Â  Â  Â </td>  
â€‹  
 Â  Â </tr>  
</table>  
{{schedule}}  
 Â </div>  
</template>   
```
â€‹

- SysScheduleControllerä¸­æŸ¥è¯¢æ•°æ®å¹¶å“åº”json
```java
@WebServlet("/schedule/*")
public class SysScheduleController  extends BaseController{
    private SysScheduleService scheduleService =new SysScheduleServiceImpl();
    /**
     * æŸ¥è¯¢æ‰€æœ‰æ—¥ç¨‹æ¥å£
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void findAllSchedule(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        int uid = Integer.parseInt(req.getParameter("uid"));
        //  è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•,æŸ¥è¯¢æ‰€æœ‰æ—¥ç¨‹
        List<SysSchedule> itemList = scheduleService.findItemListByUid(uid);
        // å°†æ—¥ç¨‹ä¿¡æ¯è£…å…¥result,è½¬æ¢JSONç»™å®¢æˆ·ç«¯
        Map<String,Object> data =new HashMap<>();
        data.put("itemList",itemList);
        WebUtil.writeJson(resp,Result.ok(data));
    }
}
```

+ SysScheduleServiceæ¥å£å’Œå®ç°ç±»ä»£ç 
``` java
public interface SysScheduleService {
    List<SysSchedule> findItemListByUid(int uid);
}

// ------------------------------------------------
public class SysScheduleServiceImpl implements SysScheduleService {
    private SysScheduleDao scheduleDao =new SysScheduleDaoImpl();
    @Override
    public List<SysSchedule> findItemListByUid(int uid) {
        return scheduleDao.findItemListByUid(uid);
    }
}
```

- SysScheduleDaoæ¥å£å’Œå®ç°ç±»ä»£ç 
```java
public interface SysScheduleDao {
    List<SysSchedule> findItemListByUid(int uid);
}
//-----------------------------------------------------
public class SysScheduleDaoImpl extends BaseDao implements SysScheduleDao {
    @Override
    public List<SysSchedule> findItemListByUid(int uid) {
        String sql = "SELECT sid,uid,title,completed from sys_schedule where uid = ?";  
		return getBeanList(con,sql,uid);
    }
}
```

### 7.4 å¢åŠ å’Œä¿å­˜æ—¥ç¨‹æ•°æ®

- ShowSchedule.vueä¸­å‘åç«¯å‘é€å¼‚æ­¥è¯·æ±‚æŸ¥è¯¢æ•°æ®å¹¶å±•ç¤º

```vue
<script setup>  
 Â  Â /* å¼•å…¥axios */  
 Â  Â import request from '../utils/request.js'  
 Â  Â /* å¼•å…¥piniaæ•°æ® */  
 Â  Â import {defineSchedule} from '../store/scheduleStore.js'  
 Â  Â import {defineUser} from '../store/userStore.js'  
 Â  Â let schedule = defineSchedule();  
 Â  Â let sysUser = defineUser()  
 Â  Â /* å¼•å…¥æŒ‚è½½ç”Ÿå‘½å‘¨æœŸ */  
 Â  Â import { onMounted,onUpdated,ref,reactive } from 'vue';  
 Â  Â   
    // æ–°å¢æ—¥ç¨‹
    async function addItem(){
        // ç«‹åˆ»å‘åç«¯å‘é€ä¸€ä¸ªè¯·æ±‚,è®©åç«¯å…ˆä¸ºå½“å‰ç”¨æˆ·åœ¨æ•°æ®åº“ä¸­å¢åŠ ä¸€ä¸ªé»˜è®¤æ ¼å¼çš„ç©ºæ•°æ®
        let {data} = await request.get("/schedule/addDefaultSchedule",{params:{"uid":sysUser.uid}})
        if(data.code == 200){
            // ç„¶åè°ƒç”¨åˆ·æ–°é¡µé¢æ•°æ®æ–¹æ³•,ç«‹åˆ»è·å–æœ€æ–°æ•°æ®
            showSchedule()
        }else{
            alert("æ·»åŠ å¼‚å¸¸")
        }
    }

    // æ›´æ–°æ—¥ç¨‹çš„æ–¹æ³•
    async function updateItem(index){
        // æ ¹æ®ç´¢å¼•è·å–å…ƒç´ 
        
        // å°†å…ƒç´ é€šè¿‡ JSONä¸²çš„å½¢å¼ å‘é€ç»™æœåŠ¡ç«¯
        let {data} =await request.post("/schedule/updateSchedule",schedule.itemList[index])
        if(data.code == 200){
            // æœåŠ¡ç«¯ä¿®æ”¹å®Œæ¯•å,åˆ·æ–°é¡µé¢æ•°æ®
            showSchedule()
        }else{
            alert("æ›´æ–°å¼‚å¸¸")
        }
â€‹  
â€‹  
</script>  
â€‹  
<template>  
 Â <div>  
 Â  Â <h3 class="ht">æ‚¨çš„æ—¥ç¨‹å¦‚ä¸‹</h3>  
<table class="tab" cellspacing="0px">  
 Â  Â <tr class="ltr">  
 Â  Â  Â  Â <th>ç¼–å·</th>  
 Â  Â  Â  Â <th>å†…å®¹</th>  
 Â  Â  Â  Â <th>è¿›åº¦</th>  
 Â  Â  Â  Â <th>æ“ä½œ</th>  
 Â  Â </tr>  
 Â  Â <tr class="ltr" v-for="item,index in schedule.itemList" :key="index">  
 Â  Â  Â  Â <td v-text="index+1">  
 Â  Â  Â  Â </td>  
 Â  Â  Â  Â <td>  
 Â  Â  Â  Â  Â  Â <input type="input" v-model="item.title">  
 Â  Â  Â  Â </td>  
 Â  Â  Â  Â <td>  
 Â  Â  Â  Â  Â  Â <input type="radio" Â  value="1" v-model="item.completed"> å·²å®Œæˆ  
 Â  Â  Â  Â  Â  Â <input type="radio" Â  value="0" v-model="item.completed"> æœªå®Œæˆ  
 Â  Â  Â  Â </td>  
 Â  Â  Â  Â <td class="buttonContainer">  
 Â  Â  Â  Â  Â  Â  <button class="btn1">åˆ é™¤</button>  
 Â  Â  Â  Â  Â  Â <button class="btn1" @click="updateItem(index)">ä¿å­˜ä¿®æ”¹</button>  
 Â  Â  Â  Â </td>  
 Â  Â </tr>  
 Â  Â <tr class="ltr buttonContainer" >  
 Â  Â  Â  Â <td colspan="4">  
 Â  Â  Â  Â  Â  Â <button class="btn1" @click="addItem()">æ–°å¢æ—¥ç¨‹</button>  
 Â  Â  Â  Â </td>  
â€‹  
 Â  Â </tr>  
</table>  
{{schedule}}  
 Â </div>  
</template>   
```
â€‹

- SysScheduleControllerä¸­æŸ¥è¯¢æ•°æ®å¹¶å“åº”json
```java
@WebServlet("/schedule/*")
public class SysScheduleController  extends BaseController{
    private SysScheduleService scheduleService =new SysScheduleServiceImpl();
    /**
     * å‘æ•°æ®åº“ä¸­å¢åŠ ä¸€ä¸ªæ–°çš„é»˜è®¤æ•°æ®çš„æ–¹æ³•
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void addDefaultSchedule(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        int uid = Integer.parseInt(req.getParameter("uid"));
        //  è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•,ä¸ºå½“å‰ç”¨æˆ·æ–°å¢ä¸€ä¸ªé»˜è®¤ç©ºæ•°æ®
        scheduleService.addDefault(uid);

        WebUtil.writeJson(resp,Result.ok(null));

    }


    /**
     * æ›´æ–°æ—¥ç¨‹ä¸šåŠ¡æ¥å£
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void updateSchedule(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        SysSchedule sysSchedule = WebUtil.readJson(req, SysSchedule.class);
        // è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•,æ›´æ–°æ•°æ®
        scheduleService.updateSchedule(sysSchedule);

        // å“åº”æˆåŠŸ
        WebUtil.writeJson(resp,Result.ok(null));
    }
}
```

+ SysScheduleServiceæ¥å£å’Œå®ç°ç±»ä»£ç 
``` java
public interface SysScheduleService {
    Integer addDefault(int uid);
    Integer updateSchedule(SysSchedule sysSchedule);
}

// ------------------------------------------------
public class SysScheduleServiceImpl implements SysScheduleService {
    private SysScheduleDao scheduleDao =new SysScheduleDaoImpl();
    @Override
    public Integer addDefault(int uid) {
        return scheduleDao.addDefault(uid);
    }

    @Override
    public Integer updateSchedule(SysSchedule sysSchedule) {
        return scheduleDao.updateSchedule(sysSchedule);
    }
}
```

- SysScheduleDaoæ¥å£å’Œå®ç°ç±»ä»£ç 
```java
public interface SysScheduleDao {
    Integer addDefault(int uid);
    Integer updateSchedule(SysSchedule sysSchedule);
}
//-----------------------------------------------------
public class SysScheduleDaoImpl extends BaseDao implements SysScheduleDao {
	@Override  
	public Integer addDefault(int uid) {  
	    String sql = "insert into sys_schedule value(default,?,'è¯·è¾“å…¥æ—¥ç¨‹',0)";  
	    return update(con,sql,uid);  
	}  
	  
	@Override  
	public Integer updateSchedule(SysSchedule sysSchedule) {  
	    String sql ="update sys_schedule set title = ? ,completed =  ? where sid =?";  
	    return update(con,sql,sysSchedule.getTitle(),sysSchedule.getCompleted(),sysSchedule.getSid());  
	}
}
```
### 7.5 åˆ é™¤æ—¥ç¨‹æ•°æ®

- ShowSchedule.vueä¸­å‘åç«¯å‘é€å¼‚æ­¥è¯·æ±‚æŸ¥è¯¢æ•°æ®å¹¶å±•ç¤º

```vue
<script setup>  
 Â  Â /* å¼•å…¥axios */  
 Â  Â import request from '../utils/request.js'  
 Â  Â /* å¼•å…¥piniaæ•°æ® */  
 Â  Â import {defineSchedule} from '../store/scheduleStore.js'  
 Â  Â import {defineUser} from '../store/userStore.js'  
 Â  Â let schedule = defineSchedule();  
 Â  Â let sysUser = defineUser()  
 Â  Â /* å¼•å…¥æŒ‚è½½ç”Ÿå‘½å‘¨æœŸ */  
 Â  Â import { onMounted,onUpdated,ref,reactive } from 'vue';  
 Â  Â   
    // åˆ é™¤æ—¥ç¨‹çš„æ–¹æ³•
    async function removeItem(index){
        // å¼¹çª—æç¤ºæ˜¯å¦åˆ é™¤
        if(confirm("ç¡®å®šè¦åˆ é™¤è¯¥æ¡æ•°æ®")){
            // æ ¹æ®ç´¢å¼•è·å–è¦åˆ é™¤çš„itemçš„id
            let sid = schedule.itemList[index].sid
            // å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚åˆ é™¤å…ƒç´ 
            let{data} = await request.get("/schedule/removeSchedule",{params:{"sid":sid}})
            //æ ¹æ®ä¸šåŠ¡ç åˆ¤æ–­åˆ é™¤æ˜¯å¦æˆåŠŸ
            if(data.code == 200){
                // åˆ é™¤æˆåŠŸ,æ›´æ–°æ•°æ®
                showSchedule()
            }else{
                // åˆ é™¤å¤±è´¥,æç¤ºå¤±è´¥
                alert("åˆ é™¤å¤±è´¥")
            }
        }
    } 

</script>  
â€‹  
<template>  
 Â <div>  
 Â  Â <h3 class="ht">æ‚¨çš„æ—¥ç¨‹å¦‚ä¸‹</h3>  
<table class="tab" cellspacing="0px">  
 Â  Â <tr class="ltr">  
 Â  Â  Â  Â <th>ç¼–å·</th>  
 Â  Â  Â  Â <th>å†…å®¹</th>  
 Â  Â  Â  Â <th>è¿›åº¦</th>  
 Â  Â  Â  Â <th>æ“ä½œ</th>  
 Â  Â </tr>  
 Â  Â <tr class="ltr" v-for="item,index in schedule.itemList" :key="index">  
 Â  Â  Â  Â <td v-text="index+1">  
 Â  Â  Â  Â </td>  
 Â  Â  Â  Â <td>  
 Â  Â  Â  Â  Â  Â <input type="input" v-model="item.title">  
 Â  Â  Â  Â </td>  
 Â  Â  Â  Â <td>  
 Â  Â  Â  Â  Â  Â <input type="radio" Â  value="1" v-model="item.completed"> å·²å®Œæˆ  
 Â  Â  Â  Â  Â  Â <input type="radio" Â  value="0" v-model="item.completed"> æœªå®Œæˆ  
 Â  Â  Â  Â </td>  
 Â  Â  Â  Â <td class="buttonContainer">  
			<button class="btn1"  @click="removeItem(index)">åˆ é™¤</button>
			<button class="btn1" @click="updateItem(index)">ä¿å­˜ä¿®æ”¹</button> 
 Â  Â  Â  Â </td>  
 Â  Â </tr>  
 Â  Â <tr class="ltr buttonContainer" >  
 Â  Â  Â  Â <td colspan="4">  
 Â  Â  Â  Â  Â  Â <button class="btn1" @click="addItem()">æ–°å¢æ—¥ç¨‹</button>  
 Â  Â  Â  Â </td>  
â€‹  
 Â  Â </tr>  
</table>  
{{schedule}}  
 Â </div>  
</template>   
```
â€‹

- SysScheduleControllerä¸­æŸ¥è¯¢æ•°æ®å¹¶å“åº”json
```java
@WebServlet("/schedule/*")
public class SysScheduleController  extends BaseController{
    private SysScheduleService scheduleService =new SysScheduleServiceImpl();
	/**
     * åˆ é™¤æ—¥ç¨‹ä¸šåŠ¡æ¥å£
     * @param req
     * @param resp
     * @throws ServletException
     * @throws IOException
     */
    protected void removeSchedule(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // è·å–è¦åˆ é™¤çš„æ—¥ç¨‹id
        int sid = Integer.parseInt(req.getParameter("sid"));
        // è°ƒç”¨æœåŠ¡å±‚æ–¹æ³•,åˆ é™¤æ—¥ç¨‹
        scheduleService.removeSchedule(sid);
        // å“åº”200
        WebUtil.writeJson(resp,Result.ok(null));
    }
}
```

+ SysScheduleServiceæ¥å£å’Œå®ç°ç±»ä»£ç 
``` java
public interface SysScheduleService {
    Integer removeSchedule(int sid);
}

// ------------------------------------------------
public class SysScheduleServiceImpl implements SysScheduleService {
    private SysScheduleDao scheduleDao =new SysScheduleDaoImpl();
    @Override
    public Integer removeSchedule(int sid) {
        return scheduleDao.removeBySid(sid);
    }
}
```

- SysScheduleDaoæ¥å£å’Œå®ç°ç±»ä»£ç 
```java
public interface SysScheduleDao {
    Integer removeBySid(int sid);
}
//-----------------------------------------------------
public class SysScheduleDaoImpl extends BaseDao implements SysScheduleDao {
	@Override  
	public Integer removeBySid(int sid) {  
	    String sql ="delete from sys_schedule where sid = ?";  
	    return update(con,sql,sid);  
	}
}
```


