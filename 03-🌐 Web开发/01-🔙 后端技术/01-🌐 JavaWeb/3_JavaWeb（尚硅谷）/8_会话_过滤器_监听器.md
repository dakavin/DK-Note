---
æ–‡ç« æ ‡é¢˜: "[[8_ä¼šè¯_è¿‡æ»¤å™¨_ç›‘å¬å™¨]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æ–‡ç« è¯¦ç»†ä»‹ç»äº†JavaWebä¸­çš„ä¼šè¯ç®¡ç†æœºåˆ¶ï¼ŒåŒ…æ‹¬Cookieå’ŒSessionçš„ä½¿ç”¨ï¼Œè®²è§£äº†è¿‡æ»¤å™¨çš„å·¥ä½œåŸç†ã€ç”Ÿå‘½å‘¨æœŸå’Œé…ç½®æ–¹å¼ï¼Œé˜è¿°äº†å„ç±»ç›‘å¬å™¨çš„ä½¿ç”¨åœºæ™¯ï¼Œä»¥åŠAjaxå¼‚æ­¥è¯·æ±‚çš„åŸºæœ¬æ¦‚å¿µå’Œå®ç°æ–¹æ³•ã€‚
tags:
- "JavaWeb"
- "Cookie"
- "Session"
- "Filter"
- "Listener"
- "Ajax"
- "Servlet"
- "ä¼šè¯ç®¡ç†"
ç›¸å…³æ–‡ç« :
- "[[10_â€»HTTPçŠ¶æ€]]"
- "[[5_JaveWebè½¯ä»¶ç¯å¢ƒéƒ¨ç½²åŠç›¸å…³è®¾ç½®]]"
- "[[1_â€»è®¤è¯†HTTP]]"
- "[[11_å­˜å‚¨ Token åˆ° Cookie ä¸­]]"
- "[[2_Servlet]]"
æ–‡ç« åˆ†ç±»: "ğŸŒ Webå¼€å‘"
æ–‡ç« è·¯å¾„: "03-ğŸŒ Webå¼€å‘/01-ğŸ”™ åç«¯æŠ€æœ¯/01-ğŸŒ JavaWeb/3_JavaWebï¼ˆå°šç¡…è°·ï¼‰/8_ä¼šè¯_è¿‡æ»¤å™¨_ç›‘å¬å™¨.md"
æ–‡ç« éš¾åº¦: ä¸­çº§ ğŸŒ³
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­ æ ¸å¿ƒèƒ½åŠ›
åˆ›å»ºæ—¶é—´: 2024-03-28 10:36:00
ä¿®æ”¹æ—¶é—´: 2025-05-27 23:34:19
---

## 1 ä¼šè¯

### 1.1 .ä¼šè¯ç®¡ç†æ¦‚è¿°

#### 1.1.1 ä¸ºä»€ä¹ˆéœ€è¦ä¼šè¯ç®¡ç†

> HTTPæ˜¯æ— çŠ¶æ€åè®®

+ æ— çŠ¶æ€å°±æ˜¯ä¸ä¿å­˜çŠ¶æ€,å³æ— çŠ¶æ€åè®®(stateless),HTTPåè®®è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜,ä¹Ÿå°±æ˜¯è¯´,åœ¨HTTPåè®®è¿™ä¸ªçº§åˆ«,åè®®å¯¹äºå‘é€è¿‡çš„è¯·æ±‚æˆ–è€…å“åº”éƒ½ä¸åšæŒä¹…åŒ–å¤„ç†
+ ç®€å•ç†è§£:`æµè§ˆå™¨å‘é€è¯·æ±‚,æœåŠ¡å™¨æ¥æ”¶å¹¶å“åº”,ä½†æ˜¯æœåŠ¡å™¨ä¸è®°å½•è¯·æ±‚æ˜¯å¦æ¥è‡ªå“ªä¸ªæµè§ˆå™¨,æœåŠ¡å™¨æ²¡è®°å½•æµè§ˆå™¨çš„ç‰¹å¾,å°±æ˜¯å®¢æˆ·ç«¯çš„çŠ¶æ€`

> ä¸¾ä¾‹: å¼ ä¸‰å»ä¸€å®¶é¥­é¦†ç‚¹äº†å‡ é“èœ,è§‰å¾—å‘³é“ä¸é”™,ç¬¬äºŒå¤©åˆå»äº†,å¯¹è€æ¿è¯´,è¿˜ç‚¹ä¸Šæ¬¡çš„é‚£å‡ é“èœ

+ æ— çŠ¶æ€: è€æ¿æ²¡æœ‰è®°å½•å¼ ä¸‰æ˜¯å¦æ¥è¿‡,æ›´æ²¡æœ‰è®°å½•ä¸Šæ¬¡ä»–ç‚¹äº†é‚£äº›èœ,å¼ ä¸‰åªèƒ½é‡æ–°å†ç‚¹ä¸€é
+ æœ‰çŠ¶æ€: è€æ¿æŠŠæ¯æ¬¡æ¥åƒé¥­çš„ç”¨æˆ·éƒ½åšå¥½è®°å½•,æŸ¥é˜…ä¸€ä¸‹ä¹‹å‰çš„è®°å½•,æŸ¥åˆ°äº†å¼ ä¸‰ä¹‹å‰çš„èœå•,ç›´æ¥ä¸‹å•
#### 1.1.2 ä¼šè¯ç®¡ç†å®ç°æ‰‹æ®µ

> Cookieå’ŒSessioné…åˆè§£å†³

+ `cookieæ˜¯åœ¨å®¢æˆ·ç«¯ä¿ç•™å°‘é‡æ•°æ®çš„æŠ€æœ¯`,ä¸»è¦é€šè¿‡å“åº”å¤´å‘å®¢æˆ·ç«¯å“åº”ä¸€äº›å®¢æˆ·ç«¯è¦ä¿ç•™çš„ä¿¡æ¯
+ `sessionæ˜¯åœ¨æœåŠ¡ç«¯ä¿ç•™æ›´å¤šæ•°æ®çš„æŠ€æœ¯`,ä¸»è¦é€šè¿‡HttpSessionå¯¹è±¡ä¿å­˜ä¸€äº›å’Œå®¢æˆ·ç«¯ç›¸å…³çš„ä¿¡æ¯
+ cookieå’Œsessioné…åˆè®°å½•è¯·æ±‚çŠ¶æ€

> ä¸¾ä¾‹: å¼ ä¸‰å»é“¶è¡ŒåŠä¸šåŠ¡

+ å¼ ä¸‰ç¬¬ä¸€æ¬¡å»æŸä¸ªé“¶è¡ŒåŠä¸šåŠ¡,é“¶è¡Œä¼šä¸ºå¼ ä¸‰å¼€æˆ·(Session),å¹¶å‘å¼ ä¸‰å‘æ”¾ä¸€å¼ é“¶è¡Œå¡(cookie)
+ å¼ ä¸‰åé¢æ¯æ¬¡å»é“¶è¡Œ,å°±å¯ä»¥æºå¸¦ä¹‹é—´çš„é“¶è¡Œå¡(cookie),é“¶è¡Œæ ¹æ®é“¶è¡Œå¡æ‰¾åˆ°ä¹‹å‰å¼ ä¸‰çš„è´¦æˆ·(session)
### 1.2 Cookie

#### 1.2.1 æ¦‚è¿°

> cookieæ˜¯ä¸€ç§å®¢æˆ·ç«¯ä¼šè¯æŠ€æœ¯,cookieç”±æœåŠ¡ç«¯äº§ç”Ÿ,å®ƒæ˜¯æœåŠ¡å™¨å­˜æ”¾åœ¨æµè§ˆå™¨çš„ä¸€å°ä»½æ•°æ®,æµè§ˆå™¨ä»¥åæ¯æ¬¡è®¿é—®è¯¥æœåŠ¡å™¨çš„æ—¶å€™éƒ½ä¼šå°†è¿™å°ä»½æ•°æ®æºå¸¦åˆ°æœåŠ¡å™¨å»ã€‚

+ æœåŠ¡ç«¯åˆ›å»ºcookie,å°†cookieæ”¾å…¥å“åº”å¯¹è±¡ä¸­,Tomcatå®¹å™¨å°†cookieè½¬åŒ–ä¸ºset-cookieå“åº”å¤´,å“åº”ç»™å®¢æˆ·ç«¯
+ å®¢æˆ·ç«¯åœ¨æ”¶åˆ°cookieçš„å“åº”å¤´æ—¶,åœ¨ä¸‹æ¬¡è¯·æ±‚è¯¥æœåŠ¡çš„èµ„æºæ—¶,ä¼šä»¥cookieè¯·æ±‚å¤´çš„å½¢å¼æºå¸¦ä¹‹å‰æ”¶åˆ°çš„Cookie
+ cookieæ˜¯ä¸€ç§é”®å€¼å¯¹æ ¼å¼çš„æ•°æ®,ä»tomcat8.5å¼€å§‹å¯ä»¥ä¿å­˜ä¸­æ–‡,ä½†æ˜¯ä¸æ¨è
+ ç”±äºcookieæ˜¯å­˜å‚¨äºå®¢æˆ·ç«¯çš„æ•°æ®,æ¯”è¾ƒå®¹æ˜“æš´éœ²,ä¸€èˆ¬ä¸å­˜å‚¨ä¸€äº›æ•æ„Ÿæˆ–è€…å½±å“å®‰å…¨çš„æ•°æ®

> åŸç†å›¾

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/eef0319fc5fda9ef2a89e9d12e4b4716.png)

> åº”ç”¨åœºæ™¯ä¸¾ä¾‹

1. è®°å½•ç”¨æˆ·å
   å½“æˆ‘ä»¬åœ¨ç”¨æˆ·åçš„è¾“å…¥æ¡†ä¸­è¾“å…¥å®Œç”¨æˆ·åå,æµè§ˆå™¨è®°å½•ç”¨æˆ·å,ä¸‹ä¸€æ¬¡å†è®¿é—®ç™»å½•é¡µé¢æ—¶,ç”¨æˆ·åè‡ªåŠ¨å¡«å……åˆ°ç”¨æˆ·åçš„è¾“å…¥æ¡†.

2. ä¿å­˜ç”µå½±æ’­æ”¾è¿›åº¦
   åœ¨ç½‘é¡µä¸Šæ’­æ”¾ç”µå½±çš„æ—¶å€™,å¦‚æœä¸­é€”é€€å‡ºæµè§ˆå™¨äº†,ä¸‹è½½å†æ‰“å¼€æµè§ˆå™¨æ’­æ”¾åŒä¸€éƒ¨ç”µå½±çš„æ—¶å€™,ä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸Šæ¬¡é€€å‡ºæ—¶å€™çš„è¿›åº¦,å› ä¸ºåœ¨æ’­æ”¾çš„æ—¶å€™ä¼šå°†æ’­æ”¾è¿›åº¦ä¿å­˜åˆ°cookieä¸­
#### 1.2.2 ä½¿ç”¨

> servletAå‘å“åº”ä¸­å¢åŠ Cookie

```java
@WebServlet("/servletA")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // åˆ›å»ºCookie
        Cookie cookie1 =new Cookie("c1","c1_message");
        Cookie cookie2 =new Cookie("c2","c2_message");
        // å°†cookieæ”¾å…¥å“åº”å¯¹è±¡
        resp.addCookie(cookie1);
        resp.addCookie(cookie2);
    }
}
```

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b3dd512a17390639afdfdd0852dcb13c.png)

> servletBä»è¯·æ±‚ä¸­è¯»å–Cookie

``` java
@WebServlet("/servletB")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //è·å–è¯·æ±‚ä¸­çš„cookie
        Cookie[] cookies = req.getCookies();
        //è¿­ä»£cookiesæ•°ç»„
        if (null != cookies && cookies.length!= 0) {
            for (Cookie cookie : cookies) {
                System.out.println(cookie.getName()+":"+cookie.getValue());
            }
        }
    }
}
```

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/2e3ccd312a41e7429f023d76d2900272.png)
#### 1.2.3 æ—¶æ•ˆæ€§

> é»˜è®¤æƒ…å†µä¸‹Cookieçš„æœ‰æ•ˆæœŸæ˜¯ä¸€æ¬¡ä¼šè¯èŒƒå›´å†…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡cookieçš„setMaxAge()æ–¹æ³•è®©CookieæŒä¹…åŒ–ä¿å­˜åˆ°æµè§ˆå™¨ä¸Š

-   `ä¼šè¯çº§Cookie`
    -   æœåŠ¡å™¨ç«¯å¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šCookieçš„å­˜åœ¨æ—¶é—´
    -   `åœ¨æµè§ˆå™¨ç«¯ï¼ŒCookieæ•°æ®å­˜åœ¨äºå†…å­˜ä¸­`
    -   åªè¦æµè§ˆå™¨è¿˜å¼€ç€ï¼ŒCookieæ•°æ®å°±ä¸€ç›´éƒ½åœ¨
    -   æµè§ˆå™¨å…³é—­ï¼Œå†…å­˜ä¸­çš„Cookieæ•°æ®å°±ä¼šè¢«é‡Šæ”¾
-   `æŒä¹…åŒ–Cookie`
    -   æœåŠ¡å™¨ç«¯æ˜ç¡®è®¾ç½®äº†Cookieçš„å­˜åœ¨æ—¶é—´
    -   `åœ¨æµè§ˆå™¨ç«¯ï¼ŒCookieæ•°æ®ä¼šè¢«ä¿å­˜åˆ°ç¡¬ç›˜ä¸Š`
    -   Cookieåœ¨ç¡¬ç›˜ä¸Šå­˜åœ¨çš„æ—¶é—´æ ¹æ®æœåŠ¡å™¨ç«¯é™å®šçš„æ—¶é—´æ¥ç®¡æ§ï¼Œä¸å—æµè§ˆå™¨å…³é—­çš„å½±å“
    -   æŒä¹…åŒ–Cookieåˆ°è¾¾äº†é¢„è®¾çš„æ—¶é—´ä¼šè¢«é‡Šæ”¾

> cookie.setMaxAge(int expiry)å‚æ•°å•ä½æ˜¯ç§’ï¼Œè¡¨ç¤ºcookieçš„æŒä¹…åŒ–æ—¶é—´ï¼Œå¦‚æœ`è®¾ç½®å‚æ•°ä¸º0ï¼Œè¡¨ç¤ºå°†æµè§ˆå™¨ä¸­ä¿å­˜çš„è¯¥cookieåˆ é™¤`

+ servletAè®¾ç½®ä¸€ä¸ªCookieä¸ºæŒä¹…åŒ–cookie

``` java
@WebServlet("/servletA")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // åˆ›å»ºCookie
        Cookie cookie1 =new Cookie("c1","c1_message");
        cookie1.setMaxAge(60);
        Cookie cookie2 =new Cookie("c2","c2_message");
        // å°†cookieæ”¾å…¥å“åº”å¯¹è±¡
        resp.addCookie(cookie1);
        resp.addCookie(cookie2);
    }
}
```

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/74bdf1dfbf64e77e1964531e4b35ce46.png)

+ servletBæ¥æ”¶Cookie,æµè§ˆå™¨ä¸­é—´å‘ç”Ÿä¸€æ¬¡é‡å¯å†è¯·æ±‚servletBæµ‹è¯•

``` java
@WebServlet("/servletB")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //è·å–è¯·æ±‚ä¸­çš„cookie
        Cookie[] cookies = req.getCookies();
        //è¿­ä»£cookiesæ•°ç»„
        if (null != cookies && cookies.length!= 0) {
            for (Cookie cookie : cookies) {
                System.out.println(cookie.getName()+":"+cookie.getValue());
            }
        }
    }
}
```

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/048d5c20d67518881939f739d71a071f.png)

- æ­¤æ—¶ï¼Œc2çš„Cookieç”±äºæ²¡æœ‰æŒä¹…åŒ–ï¼Œå…³é—­æµè§ˆå™¨ï¼Œè®¿é—®ServletBï¼Œå‘ç°c2çš„Cookieè¢«åˆ é™¤
#### 1.2.4 æäº¤è·¯å¾„

> è®¿é—®äº’è”ç½‘èµ„æºæ—¶ä¸èƒ½æ¯æ¬¡éƒ½éœ€è¦æŠŠæ‰€æœ‰Cookieå¸¦ä¸Šã€‚è®¿é—®ä¸åŒçš„èµ„æºæ—¶,å¯ä»¥æºå¸¦ä¸åŒçš„cookie,æˆ‘ä»¬å¯ä»¥é€šè¿‡cookieçš„setPath(String path) å¯¹cookieçš„è·¯å¾„è¿›è¡Œè®¾ç½®

+ ä»ServletAä¸­è·å–cookie
``` java
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // åˆ›å»ºCookie
        Cookie cookie1 =new Cookie("c1","c1_message");
        // è®¾ç½®cookieçš„æäº¤è·¯å¾„
        cookie1.setPath("/web03_war_exploded/servletB");
        Cookie cookie2 =new Cookie("c2","c2_message");
        // å°†cookieæ”¾å…¥å“åº”å¯¹è±¡
        resp.addCookie(cookie1);
        resp.addCookie(cookie2);
    }
}
```

![|400|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/cf276fd6ba5e1bcf49e1b9cc12f717f8.png)

- å‘ServletBè¯·æ±‚æ—¶æºå¸¦æºå¸¦äº† c1![|400|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/6507779e7b2d7343bc2f83bd2db2442a.png)
- å‘å…¶ä»–èµ„æºè¯·æ±‚æ—¶å°±ä¸æºå¸¦c1äº†![|400|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/585058fe8dae2606425df07585a2bd8d.png)
### 1.3 Session
#### 1.3.1 æ¦‚è¿°

>  HttpSessionæ˜¯ä¸€ç§==ä¿ç•™æ›´å¤šä¿¡æ¯åœ¨æœåŠ¡ç«¯==çš„ä¸€ç§æŠ€æœ¯,æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯å¼€è¾Ÿä¸€å—å†…å­˜ç©ºé—´,å³sessionå¯¹è±¡. å®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚æ—¶,éƒ½å¯ä»¥ä½¿ç”¨è‡ªå·±çš„session. è¿™æ ·æœåŠ¡ç«¯å°±å¯ä»¥é€šè¿‡sessionæ¥è®°å½•æŸä¸ªå®¢æˆ·ç«¯çš„çŠ¶æ€äº†

+ `æœåŠ¡ç«¯åœ¨ä¸ºå®¢æˆ·ç«¯åˆ›å»ºsessionæ—¶,ä¼šåŒæ—¶å°†sessionå¯¹è±¡çš„id,å³JSESSIONIDä»¥cookieçš„å½¢å¼æ”¾å…¥å“åº”å¯¹è±¡`
+ åç«¯åˆ›å»ºå®Œsessionå,å®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¸€ä¸ªç‰¹æ®Šçš„cookie,å«åšJSESSIONID
+ å®¢æˆ·ç«¯ä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶æºå¸¦JSESSIONID,åç«¯æ”¶åˆ°å,æ ¹æ®JSESSIONIDæ‰¾åˆ°å¯¹åº”çš„sessionå¯¹è±¡
+ é€šè¿‡è¯¥æœºåˆ¶,æœåŠ¡ç«¯é€šè¿‡sessionå°±å¯ä»¥å­˜å‚¨ä¸€äº›ä¸“é—¨é’ˆå¯¹æŸä¸ªå®¢æˆ·ç«¯çš„ä¿¡æ¯äº†
+ sessionä¹Ÿæ˜¯åŸŸå¯¹è±¡(åç»­è¯¦ç»†è®²è§£)

> åŸç†å›¾å¦‚ä¸‹

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b6f6d464833102e7418483616d44891c.png)

> åº”ç”¨åœºæ™¯

1. è®°å½•ç”¨æˆ·çš„ç™»å½•çŠ¶æ€
   ç”¨æˆ·ç™»å½•å,å°†ç”¨æˆ·çš„è´¦å·ç­‰æ•æ„Ÿä¿¡æ¯å­˜å…¥session

2. è®°å½•ç”¨æˆ·æ“ä½œçš„å†å²
   ä¾‹å¦‚è®°å½•ç”¨æˆ·çš„è®¿é—®ç—•è¿¹,ç”¨æˆ·çš„è´­ç‰©è½¦ä¿¡æ¯ç­‰ä¸´æ—¶æ€§çš„ä¿¡æ¯
#### 1.3.2 ä½¿ç”¨

> ç”¨æˆ·æäº¤formè¡¨å•åˆ°ServletA,æºå¸¦ç”¨æˆ·å,ServletAè·å–session å°†ç”¨æˆ·åå­˜åˆ°Session,ç”¨æˆ·å†è¯·æ±‚å…¶ä»–ä»»æ„Servlet,è·å–ä¹‹é—´å­˜å‚¨çš„ç”¨æˆ·

+ å®šä¹‰è¡¨å•é¡µ,æäº¤ç”¨æˆ·å,æäº¤å
``` html
    <form action="servletA" method="post">
        ç”¨æˆ·å:
        <input type="text" name="username">
        <input type="submit" value="æäº¤">
    </form>
```

+ å®šä¹‰ServletA,å°†ç”¨æˆ·åå­˜å…¥session
``` java
@WebServlet("/servletA")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // è·å–è¯·æ±‚ä¸­çš„å‚æ•°
        String username = req.getParameter("username");
        // è·å–sessionå¯¹è±¡
        HttpSession session = req.getSession();
         // è·å–Sessionçš„ID
        String jSessionId = session.getId();
        System.out.println(jSessionId);
        // åˆ¤æ–­sessionæ˜¯ä¸æ˜¯æ–°åˆ›å»ºçš„session
        boolean isNew = session.isNew();
        System.out.println(isNew);
        // å‘sessionå¯¹è±¡ä¸­å­˜å…¥æ•°æ®
        session.setAttribute("username",username);
    }
}
```

+ å“åº”ä¸­æ”¶åˆ°äº†ä¸€ä¸ªJSESSIONIDçš„cookie![|400|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/16f55c79f5785db84e0eb3f3bb46c473.png)
+ å®šä¹‰å…¶ä»–Servlet,ä»sessionä¸­è¯»å–ç”¨æˆ·å
``` java
@WebServlet("/servletB")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // è·å–sessionå¯¹è±¡
        HttpSession session = req.getSession();
         // è·å–Sessionçš„ID
        String jSessionId = session.getId();
        System.out.println(jSessionId);
        // åˆ¤æ–­sessionæ˜¯ä¸æ˜¯æ–°åˆ›å»ºçš„session
        boolean isNew = session.isNew();
        System.out.println(isNew);
        // ä»sessionä¸­å–å‡ºæ•°æ®
        String username = (String)session.getAttribute("username");
        System.out.println(username);
    }
}
```

+ è¯·æ±‚ä¸­æºå¸¦äº†ä¸€ä¸ªJSESSIONIDçš„cookie![|400|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fd535c4cc4cc3ddd4b6fa46b32614fe0.png)
> getSessionæ–¹æ³•çš„å¤„ç†é€»è¾‘

![|400|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8c6992ae1ac4da346ff2713880b6b74a.png)
#### 1.3.3 æ—¶æ•ˆæ€§

> ä¸ºä»€ä¹ˆè¦è®¾ç½®sessionçš„æ—¶æ•ˆ

+ ç”¨æˆ·é‡å¾ˆå¤§ä¹‹åï¼ŒSessionå¯¹è±¡ç›¸åº”çš„ä¹Ÿè¦åˆ›å»ºå¾ˆå¤šã€‚å¦‚æœä¸€å‘³åˆ›å»ºä¸é‡Šæ”¾ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«¯çš„å†…å­˜è¿Ÿæ—©è¦è¢«è€—å°½ã€‚
+ å®¢æˆ·ç«¯å…³é—­è¡Œä¸ºæ— æ³•è¢«æœåŠ¡ç«¯ç›´æ¥ä¾¦æµ‹,æˆ–è€…å®¢æˆ·ç«¯è¾ƒé•¿æ—¶é—´ä¸æ“ä½œä¹Ÿç»å¸¸å‡ºç°,ç±»ä¼¼è¿™äº›çš„æƒ…å†µ,å°±éœ€è¦å¯¹sessionçš„æ—¶é™è¿›è¡Œè®¾ç½®äº†

> é»˜è®¤çš„sessionæœ€å¤§é—²ç½®æ—¶é—´(ä¸¤æ¬¡ä½¿ç”¨åŒä¸€ä¸ªsessionä¸­çš„é—´éš”æ—¶é—´) åœ¨tomcat/conf/web.xmlé…ç½®ä¸º30åˆ†é’Ÿ

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/824c1970223c0e4ad3ba9ef42abcf268.png)

> æˆ‘ä»¬å¯ä»¥è‡ªå·±åœ¨å½“å‰é¡¹ç›®çš„web.xmlå¯¹æœ€å¤§é—²ç½®æ—¶é—´è¿›è¡Œé‡æ–°è®¾å®š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/4b904d808592fa5b136500c6d056d223.png)

> ä¹Ÿå¯ä»¥é€šè¿‡HttpSessionçš„API å¯¹æœ€å¤§é—²ç½®æ—¶é—´è¿›è¡Œè®¾å®š
``` java
// è®¾ç½®æœ€å¤§é—²ç½®æ—¶é—´
session.setMaxInactiveInterval(60);
```

> ä¹Ÿå¯ä»¥ç›´æ¥è®©sessionå¤±æ•ˆ
``` java
// ç›´æ¥è®©sessionå¤±æ•ˆ
session.invalidate();
```
### 1.4 ä¸‰å¤§åŸŸå¯¹è±¡

#### 1.4.1 æ¦‚è¿°

> åŸŸå¯¹è±¡: ä¸€äº›ç”¨äºå­˜å‚¨æ•°æ®å’Œä¼ é€’æ•°æ®çš„å¯¹è±¡,ä¼ é€’æ•°æ®ä¸åŒçš„èŒƒå›´,æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸åŒçš„åŸŸ,ä¸åŒçš„åŸŸå¯¹è±¡ä»£è¡¨ä¸åŒçš„åŸŸ,å…±äº«æ•°æ®çš„èŒƒå›´ä¹Ÿä¸åŒ

+ webé¡¹ç›®ä¸­,æˆ‘ä»¬ä¸€å®šè¦ç†Ÿç»ƒä½¿ç”¨çš„åŸŸå¯¹è±¡åˆ†åˆ«æ˜¯ è¯·æ±‚åŸŸ,ä¼šè¯åŸŸ,åº”ç”¨åŸŸ
+ è¯·æ±‚åŸŸå¯¹è±¡æ˜¯HttpServletRequest ,ä¼ é€’æ•°æ®çš„èŒƒå›´æ˜¯ä¸€æ¬¡è¯·æ±‚ä¹‹å†…åŠè¯·æ±‚è½¬å‘
+ ä¼šè¯åŸŸå¯¹è±¡æ˜¯HttpSession,ä¼ é€’æ•°æ®çš„èŒƒå›´æ˜¯ä¸€æ¬¡ä¼šè¯ä¹‹å†…,å¯ä»¥è·¨å¤šä¸ªè¯·æ±‚
+ åº”ç”¨åŸŸå¯¹è±¡æ˜¯ServletContext,ä¼ é€’æ•°æ®çš„èŒƒå›´æ˜¯æœ¬åº”ç”¨ä¹‹å†…,å¯ä»¥è·¨å¤šä¸ªä¼šè¯

> ç”Ÿæ´»ä¸¾ä¾‹: çƒ­æ°´å™¨æ‘†æ”¾ä½ç½®ä¸åŒ,ä½¿ç”¨çš„èŒƒå›´å°±ä¸åŒ

1. æ‘†åœ¨å¼ ä¸‰å·¥ä½ä¸‹,å°±åªæœ‰å¼ ä¸‰ä¸€ä¸ªäººèƒ½ç”¨
2. æ‘†åœ¨åŠå…¬å®¤çš„å…¬å…±åŒº,åŠå…¬å®¤å†…çš„æ‰€æœ‰äººéƒ½å¯ä»¥ç”¨
3. æ‘†åœ¨æ¥¼å±‚çš„èµ°å»ŠåŒº,è¯¥æ¥¼å±‚çš„æ‰€æœ‰äººéƒ½å¯ä»¥ç”¨

> ä¸‰å¤§åŸŸå¯¹è±¡çš„æ•°æ®ä½œç”¨èŒƒå›´å›¾è§£

+ è¯·æ±‚åŸŸ![|400|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/33cb141943dedd518229bdcc6b343b72.png)
- ä¼šè¯åŸŸ![|400|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/9977da2b492395ee44f95c7435c6cb5f.png)
+ åº”ç”¨åŸŸ![|400|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/82429faecd213b60de3429fc05a07e4c.png)
+ æ€»ç»“![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/e4022cf5617d1baf4e0cc3e1c2b77dd4.png)
#### 1.4.2 ä½¿ç”¨

> åŸŸå¯¹è±¡çš„API

| API                                         | åŠŸèƒ½                    |
| ------------------------------------------- | ----------------------- |
| void setAttribute(String name,String value) | å‘åŸŸå¯¹è±¡ä¸­æ·»åŠ /ä¿®æ”¹æ•°æ® |
| Object getAttribute(String name);           | ä»åŸŸå¯¹è±¡ä¸­è·å–æ•°æ®      |
| removeAttribute(String name);               | ç§»é™¤åŸŸå¯¹è±¡ä¸­çš„æ•°æ®      |

> APIæµ‹è¯•

+ ServletAå‘ä¸‰å¤§åŸŸä¸­æ”¾å…¥æ•°æ®
``` java
@WebServlet("/servletA")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // å‘è¯·æ±‚åŸŸä¸­æ”¾å…¥æ•°æ®
        req.setAttribute("request","request-message");
        //req.getRequestDispatcher("servletB").forward(req,resp);
        // å‘ä¼šè¯åŸŸä¸­æ”¾å…¥æ•°æ®
        HttpSession session = req.getSession();
        session.setAttribute("session","session-message");
        // å‘åº”ç”¨åŸŸä¸­æ”¾å…¥æ•°æ®
        ServletContext application = getServletContext();
        application.setAttribute("application","application-message");

    }
}

```

+ ServletBä»ä¸‰å¤§äºä¸­å–å‡ºæ•°æ®
``` java
@WebServlet("/servletB")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // ä»è¯·æ±‚åŸŸä¸­è·å–æ•°æ®
        String reqMessage =(String)req.getAttribute("request");
        System.out.println(reqMessage);
        
        // ä»ä¼šè¯åŸŸä¸­è·å–æ•°æ®
        HttpSession session = req.getSession();
        String sessionMessage =(String)session.getAttribute("session");
        System.out.println(sessionMessage);
        // ä»åº”ç”¨åŸŸä¸­è·å–æ•°æ®
        ServletContext application = getServletContext();
        String applicationMessage =(String)application.getAttribute("application");
        System.out.println(applicationMessage);
    }
}
```

+ è¯·æ±‚è½¬å‘æ—¶,è¯·æ±‚åŸŸå¯ä»¥ä¼ é€’æ•°æ®`è¯·æ±‚åŸŸå†…ä¸€èˆ¬æ”¾æœ¬æ¬¡è¯·æ±‚ä¸šåŠ¡æœ‰å…³çš„æ•°æ®,å¦‚:æŸ¥è¯¢åˆ°çš„æ‰€æœ‰çš„éƒ¨é—¨ä¿¡æ¯`
+ åŒä¸€ä¸ªä¼šè¯å†…,ä¸ç”¨è¯·æ±‚è½¬å‘,ä¼šè¯åŸŸå¯ä»¥ä¼ é€’æ•°æ®`ä¼šè¯åŸŸå†…ä¸€èˆ¬æ”¾æœ¬æ¬¡ä¼šè¯çš„å®¢æˆ·ç«¯æœ‰å…³çš„æ•°æ®,å¦‚:å½“å‰å®¢æˆ·ç«¯ç™»å½•çš„ç”¨æˆ·` 
+ åŒä¸€ä¸ªAPPå†…,ä¸åŒçš„å®¢æˆ·ç«¯,åº”ç”¨åŸŸå¯ä»¥ä¼ é€’æ•°æ®`åº”ç”¨åŸŸå†…ä¸€èˆ¬æ”¾æœ¬ç¨‹åºåº”ç”¨æœ‰å…³çš„æ•°æ® å¦‚:Springæ¡†æ¶çš„IOCå®¹å™¨`
## 2 è¿‡æ»¤å™¨

### 2.1 æ¦‚è¿°

> Filter,å³è¿‡æ»¤å™¨,æ˜¯JAVAEEæŠ€æœ¯è§„èŒƒä¹‹ä¸€,ä½œç”¨ç›®æ ‡èµ„æºçš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤çš„ä¸€å¥—æŠ€æœ¯è§„èŒƒ,æ˜¯Java Webé¡¹ç›®ä¸­`æœ€ä¸ºå®ç”¨çš„æŠ€æœ¯ä¹‹ä¸€`

+ Filteræ¥å£å®šä¹‰äº†è¿‡æ»¤å™¨çš„å¼€å‘è§„èŒƒ,æ‰€æœ‰çš„è¿‡æ»¤å™¨éƒ½è¦å®ç°è¯¥æ¥å£
+ Filterçš„å·¥ä½œä½ç½®æ˜¯é¡¹ç›®ä¸­æ‰€æœ‰ç›®æ ‡èµ„æºä¹‹å‰,å®¹å™¨åœ¨åˆ›å»ºHttpServletRequestå’ŒHttpServletResponseå¯¹è±¡å,ä¼šå…ˆè°ƒç”¨Filterçš„doFilteræ–¹æ³•
+ Filterçš„doFilteræ–¹æ³•å¯ä»¥æ§åˆ¶è¯·æ±‚æ˜¯å¦ç»§ç»­,å¦‚æœæ”¾è¡Œ,åˆ™è¯·æ±‚ç»§ç»­,å¦‚æœæ‹’ç»,åˆ™è¯·æ±‚åˆ°æ­¤ä¸ºæ­¢,ç”±è¿‡æ»¤å™¨æœ¬èº«åšå‡ºå“åº”
+ Filterä¸ä»…å¯ä»¥å¯¹è¯·æ±‚åšå‡ºè¿‡æ»¤,ä¹Ÿå¯ä»¥åœ¨ç›®æ ‡èµ„æºåšå‡ºå“åº”å‰,å¯¹å“åº”å†æ¬¡è¿›è¡Œå¤„ç†
+ Filteræ˜¯GOFä¸­è´£ä»»é“¾æ¨¡å¼çš„å…¸å‹æ¡ˆä¾‹
+ Filterçš„å¸¸ç”¨åº”ç”¨åŒ…æ‹¬ä½†ä¸é™äº: ç™»å½•æƒé™æ£€æŸ¥,è§£å†³ç½‘ç«™ä¹±ç ,è¿‡æ»¤æ•æ„Ÿå­—ç¬¦,æ—¥å¿—è®°å½•,æ€§èƒ½åˆ†æ... ...

> ç”Ÿæ´»ä¸¾ä¾‹: å…¬å¸å‰å°,åœè½¦åœºå®‰ä¿,åœ°é“éªŒç¥¨é—¸æœº

+ å…¬å¸å‰å°å¯¹æ¥è®¿äººå‘˜è¿›è¡Œå®¡æ ¸,å¦‚æœæ˜¯æ¸¸å®¢åˆ™æ‹’ç»è¿›å…¥å…¬å¸,å¦‚æœæ˜¯å®¢æˆ·åˆ™æ”¾è¡Œ . å®¢æˆ·ç¦»å¼€æ—¶æé†’å®¢æˆ·ä¸è¦é—å¿˜ç‰©å“
+ åœè½¦åœºä¿å®‰å¯¹æ¥è®¿è½¦è¾†è¿›è¡Œæ§åˆ¶,å¦‚æœæ²¡æœ‰è½¦ä½æ‹’ç»è¿›å…¥,å¦‚æœæœ‰è½¦ä½,å‘æ”¾åœè½¦å¡å¹¶æ”¾è¡Œ,è½¦è¾†ç¦»å¼€æ—¶æ”¶å–è¯·è½¦è´¹
+ åœ°é“éªŒç¥¨é—¸æœºåœ¨äººå‘˜è¿›å…¥ä¹‹å‰æ£€æŸ¥ç¥¨,æ²¡ç¥¨æ‹’ç»è¿›å…¥,æœ‰ç¥¨éªŒç¥¨åæ”¾è¡Œ,äººå‘˜ç¦»å¼€æ—¶åŒæ ·éªŒç¥¨

> è¿‡æ»¤å™¨å¼€å‘ä¸­åº”ç”¨çš„åœºæ™¯

+ æ—¥å¿—çš„è®°å½•
+ æ€§èƒ½çš„åˆ†æ
+ ä¹±ç çš„å¤„ç†
+ äº‹åŠ¡çš„æ§åˆ¶
+ ç™»å½•çš„æ§åˆ¶
+ è·¨åŸŸçš„å¤„ç†
+ ... ...

> è¿‡æ»¤å™¨å·¥ä½œä½ç½®å›¾è§£

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/195e485d6d6d74f150ae3383e2b20f3f.png)

> `Filteræ¥å£API`

- æ³¨æ„ï¼š`Tomcat8ç‰ˆæœ¬çš„Filteræ¥å£æœ‰ç¼ºé™·ï¼Œå®ç°è¯¥æ¥å£çš„æ—¶å€™éœ€è¦é‡å†™ä¸‰ä¸ªæ–¹æ³•ï¼Œæ— æ³•åªé‡å†™doFilteræ–¹æ³•ï¼Œéœ€è¦æ›´æ¢æ›´é«˜çš„ç‰ˆæœ¬`

+ æºç 

``` java
public interface Filter {
    default public void init(FilterConfig filterConfig) throws ServletException {
    }
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException;
    default public void destroy() {
    }
}

```

+ APIç›®æ ‡

| API                                                                                         | ç›®æ ‡                                     |
| ------------------------------------------------------------------------------------------- | -------------------------------------- |
| default public void` init`(FilterConfig filterConfig)                                       | åˆå§‹åŒ–æ–¹æ³•,ç”±å®¹å™¨è°ƒç”¨å¹¶ä¼ å…¥åˆå§‹é…ç½®ä¿¡æ¯filterConfigå¯¹è±¡     |
| public void `doFilter`(ServletRequest request, ServletResponse response, FilterChain chain) | è¿‡æ»¤æ–¹æ³•,æ ¸å¿ƒæ–¹æ³•,è¿‡æ»¤è¯·æ±‚,å†³å®šæ˜¯å¦æ”¾è¡Œ,å“åº”ä¹‹å‰çš„å…¶ä»–å¤„ç†ç­‰éƒ½åœ¨è¯¥æ–¹æ³•ä¸­ |
| default public void `destroy`()                                                             | é”€æ¯æ–¹æ³•,å®¹å™¨åœ¨å›æ”¶è¿‡æ»¤å™¨å¯¹è±¡ä¹‹å‰è°ƒç”¨çš„æ–¹æ³•                 |
### 2.2 ä½¿ç”¨

> ç›®æ ‡:å¼€å‘ä¸€ä¸ªæ—¥å¿—è®°å½•è¿‡æ»¤å™¨

+ ç”¨æˆ·è¯·æ±‚åˆ°è¾¾ç›®æ ‡èµ„æºä¹‹å‰,è®°å½•ç”¨æˆ·çš„è¯·æ±‚èµ„æºè·¯å¾„
+ å“åº”ä¹‹å‰è®°å½•æœ¬æ¬¡è¯·æ±‚ç›®æ ‡èµ„æºè¿ç®—çš„è€—æ—¶
+ å¯ä»¥é€‰æ‹©å°†æ—¥å¿—è®°å½•è¿›å…¥æ–‡ä»¶,ä¸ºäº†æ–¹ä¾¿æµ‹è¯•,è¿™é‡Œå°†æ—¥å¿—ç›´æ¥åœ¨æ§åˆ¶å°æ‰“å°

>  å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ç±»,ç¼–å†™åŠŸèƒ½ä»£ç 

```java
public class LoggingFilter  implements Filter {

    private SimpleDateFormat dateFormat =new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        // å‚æ•°çˆ¶è½¬å­
        HttpServletRequest request =(HttpServletRequest)  servletRequest;
        HttpServletResponse  response =(HttpServletResponse)  servletResponse;
        // æ‹¼æ¥æ—¥å¿—æ–‡æœ¬
        String requestURI = request.getRequestURI();
        String time = dateFormat.format(new Date());
        String beforeLogging =requestURI+"åœ¨"+time+"è¢«è¯·æ±‚äº†";
        // æ‰“å°æ—¥å¿—
        System.out.println(beforeLogging);
        // è·å–ç³»ç»Ÿæ—¶é—´
        long t1 = System.currentTimeMillis();
        // æ”¾è¡Œè¯·æ±‚
        filterChain.doFilter(request,response);
        // è·å–ç³»ç»Ÿæ—¶é—´
        long t2 = System.currentTimeMillis();
        //  æ‹¼æ¥æ—¥å¿—æ–‡æœ¬
        String afterLogging =requestURI+"åœ¨"+time+"çš„è¯·æ±‚è€—æ—¶:"+(t2-t1)+"æ¯«ç§’";
        // æ‰“å°æ—¥å¿—
        System.out.println(afterLogging);

    }
}
```

- è¯´æ˜
	+ doFilteræ–¹æ³•ä¸­çš„è¯·æ±‚å’Œå“åº”å¯¹è±¡æ˜¯ä»¥çˆ¶æ¥å£çš„å½¢å¼å£°æ˜çš„,å®é™…ä¼ å…¥çš„å®å‚å°±æ˜¯HttpServletRequestå’ŒHttpServletResponseå­æ¥å£çº§åˆ«çš„,å¯ä»¥å®‰å…¨å¼ºè½¬
	+ filterChain.doFilter(request,response); è¿™è¡Œä»£ç çš„åŠŸèƒ½æ˜¯æ”¾è¡Œè¯·æ±‚,å¦‚æœæ²¡æœ‰è¿™ä¸€è¡Œä»£ç ,åˆ™è¯·æ±‚åˆ°æ­¤ä¸ºæ­¢
	+ filterChain.doFilter(request,response);åœ¨æ”¾è¡Œæ—¶éœ€è¦ä¼ å…¥requestå’Œresponse,æ„å‘³ç€è¯·æ±‚å’Œå“åº”å¯¹è±¡è¦ç»§ç»­ä¼ é€’ç»™åç»­çš„èµ„æº,è¿™é‡Œæ²¡æœ‰äº§ç”Ÿæ–°çš„requestå’Œresponseå¯¹è±¡

> å®šä¹‰ä¸¤ä¸ªServletä½œä¸ºç›®æ ‡èµ„æº

- ServletA
```java
@WebServlet(urlPatterns = "/servletA",name = "servletAName")  
public class ServletA extends HttpServlet {  
 Â  Â @Override  
 Â  Â protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {  
 Â  Â  Â  Â // å¤„ç†å™¨è¯·æ±‚  
 Â  Â  Â  Â System.out.println("servletAå¤„ç†è¯·æ±‚çš„æ–¹æ³•,è€—æ—¶10æ¯«ç§’");  
 Â  Â  Â  Â // æ¨¡æ‹Ÿå¤„ç†è¯·æ±‚è€—æ—¶  
 Â  Â  Â  Â try {  
 Â  Â  Â  Â  Â  Â Thread.sleep(10);  
 Â  Â  Â   } catch (InterruptedException e) {  
 Â  Â  Â  Â  Â  Â throw new RuntimeException(e);  
 Â  Â  Â   }  
â€‹  
 Â   }  
}
```

- ServletB

```java
@WebServlet(urlPatterns = "/servletB", name = "servletBName")  
public class ServletB extends HttpServlet {  
 Â  Â @Override  
 Â  Â protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {  
 Â  Â  Â  Â // å¤„ç†å™¨è¯·æ±‚  
 Â  Â  Â  Â System.out.println("servletBå¤„ç†è¯·æ±‚çš„æ–¹æ³•,è€—æ—¶15æ¯«ç§’");  
 Â  Â  Â  Â // æ¨¡æ‹Ÿå¤„ç†è¯·æ±‚è€—æ—¶  
 Â  Â  Â  Â try {  
 Â  Â  Â  Â  Â  Â Thread.sleep(15);  
 Â  Â  Â   } catch (InterruptedException e) {  
 Â  Â  Â  Â  Â  Â throw new RuntimeException(e);  
 Â  Â  Â   }  
 Â   }  
} 
``` 
â€‹

> é…ç½®è¿‡æ»¤å™¨ä»¥åŠè¿‡æ»¤å™¨çš„è¿‡æ»¤èŒƒå›´

- web.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>  
<web-app xmlns="https://jakarta.ee/xml/ns/jakartaee"  
 Â  Â  Â  Â  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
 Â  Â  Â  Â  xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd"  
 Â  Â  Â  Â  version="5.0">  
â€‹  
 Â  Â <!--é…ç½®filter,å¹¶ä¸ºfilterèµ·åˆ«å-->  
 Â  <filter>  
 Â  Â  Â  <filter-name>loggingFilter</filter-name>  
 Â  Â  Â  <filter-class>com.atguigu.filters.LoggingFilter</filter-class>  
 Â  </filter>  
 Â  Â <!--ä¸ºåˆ«åå¯¹åº”çš„filteré…ç½®è¦è¿‡æ»¤çš„ç›®æ ‡èµ„æº-->  
 Â  Â <filter-mapping>  
 Â  Â  Â  Â <filter-name>loggingFilter</filter-name>  
 Â  Â  Â  Â <!--é€šè¿‡æ˜ å°„è·¯å¾„ç¡®å®šè¿‡æ»¤èµ„æº-->  
 Â  Â  Â  Â <url-pattern>/servletA</url-pattern>  
 Â  Â  Â  Â <!--é€šè¿‡åç¼€åç¡®å®šè¿‡æ»¤èµ„æº-->  
 Â  Â  Â  Â <url-pattern>*.html</url-pattern>  
 Â  Â  Â  Â <!--é€šè¿‡servletåˆ«åç¡®å®šè¿‡æ»¤èµ„æº-->  
 Â  Â  Â  Â <servlet-name>servletBName</servlet-name>  
â€‹  
 Â  Â </filter-mapping>  
</web-app>
```
- è¯´æ˜
    
    - filter-mappingæ ‡ç­¾ä¸­å®šä¹‰äº†è¿‡æ»¤å™¨å¯¹é‚£äº›èµ„æºè¿›è¡Œè¿‡æ»¤
        
    - å­æ ‡ç­¾url-patterné€šè¿‡æ˜ å°„è·¯å¾„ç¡®å®šè¿‡æ»¤èŒƒå›´
        - /servletA ç²¾ç¡®åŒ¹é…,è¡¨ç¤ºå¯¹servletAèµ„æºçš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤
        - `*.html` è¡¨ç¤ºå¯¹ä»¥.actionç»“å°¾çš„è·¯å¾„è¿›è¡Œè¿‡æ»¤
        - /* è¡¨ç¤ºå¯¹æ‰€æœ‰èµ„æºè¿›è¡Œè¿‡æ»¤
        - ä¸€ä¸ªfilter-mappingä¸‹å¯ä»¥é…ç½®å¤šä¸ªurl-pattern
            
    - å­æ ‡ç­¾servlet-nameé€šè¿‡servletåˆ«åç¡®å®šå¯¹é‚£äº›servletè¿›è¡Œè¿‡æ»¤
        - ä½¿ç”¨è¯¥æ ‡ç­¾ç¡®å®šç›®æ ‡èµ„æºçš„å‰ææ˜¯servletå·²ç»èµ·äº†åˆ«å
        - ä¸€ä¸ªfilter-mappingä¸‹å¯ä»¥å®šä¹‰å¤šä¸ªservlet-name
        - ä¸€ä¸ªfilter-mappingä¸‹,servlet-nameå’Œurl-patternå­æ ‡ç­¾å¯ä»¥åŒæ—¶å­˜åœ¨

> è¿‡æ»¤è¿‡ç¨‹å›¾è§£

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8b18f6dc305bb3a752dfc74801cf9c09.png)
### 2.3 ç”Ÿå‘½å‘¨æœŸ

> è¿‡æ»¤å™¨ä½œä¸ºwebé¡¹ç›®çš„ç»„ä»¶ä¹‹ä¸€,å’ŒServletçš„ç”Ÿå‘½å‘¨æœŸç±»ä¼¼,ç•¥æœ‰ä¸åŒ,æ²¡æœ‰servletçš„load-on-startupçš„é…ç½®,`é»˜è®¤å°±æ˜¯ç³»ç»Ÿå¯åŠ¨ç«‹åˆ»æ„é€ `

|é˜¶æ®µ|å¯¹åº”æ–¹æ³•|æ‰§è¡Œæ—¶æœº|æ‰§è¡Œæ¬¡æ•°|
|---|---|---|---|
|åˆ›å»ºå¯¹è±¡|æ„é€ å™¨|webåº”ç”¨å¯åŠ¨æ—¶|1|
|åˆå§‹åŒ–æ–¹æ³•|void init(FilterConfig filterConfig)|æ„é€ å®Œæ¯•|1|
|è¿‡æ»¤è¯·æ±‚|void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)|æ¯æ¬¡è¯·æ±‚|å¤šæ¬¡|
|é”€æ¯|default void destroy()|webåº”ç”¨å…³é—­æ—¶|1æ¬¡|

> æµ‹è¯•ä»£ç 

â€‹ 
```java
@WebServlet("/*")  
public class LifeCycleFilter implements Filter {  
 Â  Â public LifeCycleFilter(){  
 Â  Â  Â  Â System.out.println("LifeCycleFilter constructor method invoked");  
 Â   }  
 Â  Â   
 Â  Â @Override  
 Â  Â public void init(FilterConfig filterConfig) throws ServletException {  
 Â  Â  Â  Â System.out.println("LifeCycleFilter init method invoked");  
 Â  Â  Â  Â   
 Â   }  
â€‹  
 Â  Â @Override  
 Â  Â public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {  
 Â  Â  Â  Â System.out.println("LifeCycleFilter doFilter method invoked");  
 Â  Â  Â  Â filterChain.doFilter(servletRequest,servletResponse);  
 Â   }  
â€‹  
 Â  Â @Override  
 Â  Â public void destroy() {  
 Â  Â  Â  Â System.out.println("LifeCycleFilter destory method invoked");  
 Â   }  
}  
```
â€‹
### 2.4 è¿‡æ»¤å™¨é“¾çš„ä½¿ç”¨

> ä¸€ä¸ªwebé¡¹ç›®ä¸­,å¯ä»¥åŒæ—¶å®šä¹‰å¤šä¸ªè¿‡æ»¤å™¨,å¤šä¸ªè¿‡æ»¤å™¨å¯¹åŒä¸€ä¸ªèµ„æºè¿›è¡Œè¿‡æ»¤æ—¶,å·¥ä½œä½ç½®æœ‰å…ˆå,æ•´ä½“å½¢æˆä¸€ä¸ªå·¥ä½œé“¾,ç§°ä¹‹ä¸ºè¿‡æ»¤å™¨é“¾

+ è¿‡æ»¤å™¨é“¾ä¸­çš„è¿‡æ»¤å™¨çš„é¡ºåºç”±filter-mappingé¡ºåºå†³å®š
+ æ¯ä¸ªè¿‡æ»¤å™¨è¿‡æ»¤çš„èŒƒå›´ä¸åŒ,é’ˆå¯¹åŒä¸€ä¸ªèµ„æºæ¥è¯´,è¿‡æ»¤å™¨é“¾ä¸­çš„è¿‡æ»¤å™¨ä¸ªæ•°å¯èƒ½æ˜¯ä¸åŒçš„
+ å¦‚æœæŸä¸ªFilteræ˜¯ä½¿ç”¨ServletNameè¿›è¡ŒåŒ¹é…è§„åˆ™çš„é…ç½®ï¼Œé‚£ä¹ˆè¿™ä¸ªFilteræ‰§è¡Œçš„ä¼˜å…ˆçº§è¦æ›´ä½

> å›¾è§£è¿‡æ»¤å™¨é“¾

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/19c6d66411e8b2c2a2f1cf518993b840.png)

> è¿‡æ»¤å™¨é“¾åŠŸèƒ½æµ‹è¯•

- å®šä¹‰ä¸‰ä¸ªè¿‡æ»¤å™¨,å¯¹ç›®æ ‡èµ„æºServletçš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤
    
- ç›®æ ‡Servletèµ„æºä»£ç 
â€‹  
```java
@WebServlet("/servletC")  
public class ServletC extends HttpServlet {  
 Â  Â @Override  
 Â  Â protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {  
 Â  Â  Â  Â System.out.println("servletC service method  invoked");  
 Â   }  
}  
```
â€‹

- ä¸‰ä¸ªè¿‡æ»¤å™¨ä»£ç 

```java
public class Filter1 Â implements Filter {  
 Â  Â @Override  
 Â  Â public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {  
 Â  Â  Â  Â System.out.println("filter1 before chain.doFilter code invoked");  
â€‹  
 Â  Â  Â  Â filterChain.doFilter(servletRequest,servletResponse);  
â€‹  
 Â  Â  Â  Â System.out.println("filter1 after  chain.doFilter code invoked");  
â€‹  
 Â   }  
}  
â€‹  
â€‹  
public class Filter2 implements Filter {  
 Â  Â @Override  
 Â  Â public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {  
 Â  Â  Â  Â System.out.println("filter2 before chain.doFilter code invoked");  
â€‹  
 Â  Â  Â  Â filterChain.doFilter(servletRequest,servletResponse);  
â€‹  
 Â  Â  Â  Â System.out.println("filter2 after  chain.doFilter code invoked");  
â€‹  
 Â   }  
}  
â€‹  
â€‹  
public class Filter3 implements Filter {  
 Â  Â @Override  
 Â  Â public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {  
 Â  Â  Â  Â System.out.println("filter3 before chain.doFilter code invoked");  
â€‹  
 Â  Â  Â  Â filterChain.doFilter(servletRequest,servletResponse);  
â€‹  
 Â  Â  Â  Â System.out.println("filter3 after  chain.doFilter code invoked");  
â€‹  
 Â   }  
}
```

- è¿‡æ»¤å™¨é…ç½®ä»£ç 

```xml
<?xml version="1.0" encoding="UTF-8"?>  
<web-app xmlns="https://jakarta.ee/xml/ns/jakartaee"  
 Â  Â  Â  Â  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
 Â  Â  Â  Â  xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd"  
 Â  Â  Â  Â  version="5.0">  
 Â  Â <filter>  
 Â  Â  Â  Â <filter-name>filter1</filter-name>  
 Â  Â  Â  Â <filter-class>com.atguigu.filters.Filter1</filter-class>  
 Â  Â </filter>  
â€‹  
 Â  Â <filter>  
 Â  Â  Â  Â <filter-name>filter2</filter-name>  
 Â  Â  Â  Â <filter-class>com.atguigu.filters.Filter2</filter-class>  
 Â  Â </filter>  
â€‹  
 Â  Â <filter>  
 Â  Â  Â  Â <filter-name>filter3</filter-name>  
 Â  Â  Â  Â <filter-class>com.atguigu.filters.Filter3</filter-class>  
 Â  Â </filter>  
â€‹  
 Â  Â <!--filter-mappingçš„é¡ºåºå†³å®šäº†è¿‡æ»¤å™¨çš„å·¥ä½œé¡ºåº-->  
 Â  Â <filter-mapping>  
 Â  Â  Â  Â <filter-name>filter1</filter-name>  
 Â  Â  Â  Â <url-pattern>/servletC</url-pattern>  
 Â  Â </filter-mapping>  
â€‹  
 Â  Â <filter-mapping>  
 Â  Â  Â  Â <filter-name>filter2</filter-name>  
 Â  Â  Â  Â <url-pattern>/servletC</url-pattern>  
 Â  Â </filter-mapping>  
â€‹  
 Â  Â <filter-mapping>  
 Â  Â  Â  Â <filter-name>filter3</filter-name>  
 Â  Â  Â  Â <url-pattern>/servletC</url-pattern>  
 Â  Â </filter-mapping>  
â€‹  
</web-app>
```

> å·¥ä½œæµç¨‹å›¾è§£

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/cdfe0493333c1859e80d287191df904a.png)
### 2.5 æ³¨è§£æ–¹å¼é…ç½®è¿‡æ»¤å™¨

> @WebFilteræ³¨è§£çš„ä½¿ç”¨

+ æºç 

``` java
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface WebFilter {
    String description() default "";

    String displayName() default "";

    WebInitParam[] initParams() default {};

    String filterName() default "";

    String smallIcon() default "";

    String largeIcon() default "";

    String[] servletNames() default {};

    String[] value() default {};

    String[] urlPatterns() default {};

    DispatcherType[] dispatcherTypes() default {DispatcherType.REQUEST};

    boolean asyncSupported() default false;
}

```

+ ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„Filterçš„XMLé…ç½®
```xml
<!--é…ç½®filter,å¹¶ä¸ºfilterèµ·åˆ«å-->
<filter>
    <filter-name>loggingFilter</filter-name>
    <filter-class>com.atguigu.filters.LoggingFilter</filter-class>
    <!--é…ç½®filterçš„åˆå§‹å‚æ•°-->
    <init-param>
        <param-name>dateTimePattern</param-name>
        <param-value>yyyy-MM-dd HH:mm:ss</param-value>
    </init-param>
</filter>
<!--ä¸ºåˆ«åå¯¹åº”çš„filteré…ç½®è¦è¿‡æ»¤çš„ç›®æ ‡èµ„æº-->
<filter-mapping>
    <filter-name>loggingFilter</filter-name>
    <!--é€šè¿‡æ˜ å°„è·¯å¾„ç¡®å®šè¿‡æ»¤èµ„æº-->
    <url-pattern>/servletA</url-pattern>
    <!--é€šè¿‡åç¼€åç¡®å®šè¿‡æ»¤èµ„æº-->
    <url-pattern>*.html</url-pattern>
    <!--é€šè¿‡servletåˆ«åç¡®å®šè¿‡æ»¤èµ„æº-->
    <servlet-name>servletBName</servlet-name>
</filter-mapping>
```

- å°†xmlé…ç½®è½¬æ¢æˆæ³¨è§£æ–¹å¼å®ç°
```java
@WebFilter(
        filterName = "loggingFilter",
        initParams = {@WebInitParam(name="dateTimePattern",value="yyyy-MM-dd HH:mm:ss")},
        urlPatterns = {"/servletA","*.html"},
        servletNames = {"servletBName"}
)
public class LoggingFilter  implements Filter {

    /*initåˆå§‹åŒ–æ–¹æ³•,é€šè¿‡filterConfigè·å–åˆå§‹åŒ–å‚æ•°
    * initæ–¹æ³•ä¸­,å¯ä»¥ç”¨äºå®šä¹‰ä¸€äº›å…¶ä»–åˆå§‹åŒ–åŠŸèƒ½ä»£ç 
    * */
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        //......
    }
}
```
## 3 ç›‘å¬å™¨

### 3.1 æ¦‚è¿°

> ç›‘å¬å™¨ï¼šä¸“é—¨ç”¨äºå¯¹åŸŸå¯¹è±¡å¯¹è±¡èº«ä¸Šå‘ç”Ÿçš„äº‹ä»¶æˆ–çŠ¶æ€æ”¹å˜è¿›è¡Œç›‘å¬å’Œç›¸åº”å¤„ç†çš„å¯¹è±¡

+ ç›‘å¬å™¨æ˜¯GOFè®¾è®¡æ¨¡å¼ä¸­,è§‚å¯Ÿè€…æ¨¡å¼çš„å…¸å‹æ¡ˆä¾‹
+ è§‚å¯Ÿè€…æ¨¡å¼: å½“è¢«è§‚å¯Ÿçš„å¯¹è±¡å‘ç”ŸæŸäº›æ”¹å˜æ—¶, è§‚å¯Ÿè€…è‡ªåŠ¨é‡‡å–å¯¹åº”çš„è¡ŒåŠ¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼

+ ç›‘å¬å™¨ä½¿ç”¨çš„æ„Ÿå—,ç±»ä¼¼JSä¸­çš„äº‹ä»¶,è¢«è§‚å¯Ÿçš„å¯¹è±¡å‘ç”ŸæŸäº›æƒ…å†µæ—¶,è‡ªåŠ¨è§¦å‘ä»£ç çš„æ‰§è¡Œ
+ `ç›‘å¬å™¨å¹¶ä¸ç›‘å¬webé¡¹ç›®ä¸­çš„æ‰€æœ‰ç»„ä»¶,ä»…ä»…æ˜¯å¯¹ä¸‰å¤§åŸŸå¯¹è±¡åšç›¸å…³çš„äº‹ä»¶ç›‘å¬`

> ç›‘å¬å™¨çš„åˆ†ç±»

+ `webä¸­å®šä¹‰å…«ä¸ªç›‘å¬å™¨æ¥å£`ä½œä¸ºç›‘å¬å™¨çš„è§„èŒƒ,è¿™å…«ä¸ªæ¥å£æŒ‰ç…§ä¸åŒçš„æ ‡å‡†å¯ä»¥å½¢æˆä¸åŒçš„åˆ†ç±»

+ æŒ‰`ç›‘å¬çš„å¯¹è±¡åˆ’åˆ†`
	+ applicationåŸŸç›‘å¬å™¨
		+ ServletContextListener  
		+ ServletContextAttributeListener 
	+ sessionåŸŸç›‘å¬å™¨ 
		+ HttpSessionListener
		+ HttpSessionAttributeListener
		+ HttpSessionBindingListener
		+ HttpSessionActivationListener  
	+ requeståŸŸç›‘å¬å™¨
		+ ServletRequestListener
		+ ServletRequestAttributeListener 

+ æŒ‰`ç›‘å¬çš„äº‹ä»¶åˆ’åˆ†`
	+ åŸŸå¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ç›‘å¬å™¨ 
		+ ServletContextListener
		+ HttpSessionListener
		+ ServletRequestListener  
	+ åŸŸå¯¹è±¡æ•°æ®å¢åˆ æ”¹äº‹ä»¶ç›‘å¬å™¨
		+ ServletContextAttributeListener
		+ HttpSessionAttributeListener
		+ ServletRequestAttributeListener 

  + `å…¶ä»–ç›‘å¬å™¨`  
	  + HttpSessionBindingListener  HttpSessionActivationListener  
### 3.2 å…­ä¸ªä¸»è¦æ¥å£

#### 3.2.1 applicationåŸŸç›‘å¬æ¥å£

> ServletContextListener  ç›‘å¬ServletContextå¯¹è±¡çš„åˆ›å»ºä¸é”€æ¯

| æ–¹æ³•å                                      | ä½œç”¨                     |
| ------------------------------------------- | ------------------------ |
| contextInitialized(ServletContextEvent sce) | ServletContextåˆ›å»ºæ—¶è°ƒç”¨ |
| contextDestroyed(ServletContextEvent sce)   | ServletContexté”€æ¯æ—¶è°ƒç”¨ |

+ `ServletContextEventå¯¹è±¡`ä»£è¡¨ä»ServletContextå¯¹è±¡èº«ä¸Šæ•è·åˆ°çš„äº‹ä»¶ï¼Œé€šè¿‡è¿™ä¸ªäº‹ä»¶å¯¹è±¡æˆ‘ä»¬å¯ä»¥è·å–åˆ°ServletContextå¯¹è±¡ã€‚

> ServletContextAttributeListener ç›‘å¬ServletContextä¸­å±æ€§çš„æ·»åŠ ã€ç§»é™¤å’Œä¿®æ”¹

| æ–¹æ³•å                                               | ä½œç”¨                                 |
| ---------------------------------------------------- | ------------------------------------ |
| attributeAdded(ServletContextAttributeEvent scab)    | å‘ServletContextä¸­æ·»åŠ å±æ€§æ—¶è°ƒç”¨     |
| attributeRemoved(ServletContextAttributeEvent scab)  | ä»ServletContextä¸­ç§»é™¤å±æ€§æ—¶è°ƒç”¨     |
| attributeReplaced(ServletContextAttributeEvent scab) | å½“ServletContextä¸­çš„å±æ€§è¢«ä¿®æ”¹æ—¶è°ƒç”¨ |

+ `ServletContextAttributeEventå¯¹è±¡`ä»£è¡¨å±æ€§å˜åŒ–äº‹ä»¶ï¼Œå®ƒåŒ…å«çš„æ–¹æ³•å¦‚ä¸‹ï¼š

| æ–¹æ³•å              | ä½œç”¨                     |
| ------------------- | ------------------------ |
| getName()           | è·å–ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å   |
| getValue()          | è·å–è¢«ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å€¼ |
| getServletContext() | è·å–ServletContextå¯¹è±¡   |

> æµ‹è¯•ä»£ç 

- å®šä¹‰ç›‘å¬å™¨
```java
@WebListener
public class ApplicationListener implements ServletContextListener , ServletContextAttributeListener {
    // ç›‘å¬åˆå§‹åŒ–
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        ServletContext application = sce.getServletContext();
        System.out.println("application"+application.hashCode()+" initialized");
    }
    // ç›‘å¬é”€æ¯
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        ServletContext application = sce.getServletContext();
        System.out.println("application"+application.hashCode()+" destroyed");
    }

    // ç›‘å¬æ•°æ®å¢åŠ 
    @Override
    public void attributeAdded(ServletContextAttributeEvent scae) {
        String name = scae.getName();
        Object value = scae.getValue();
        ServletContext application = scae.getServletContext();
        System.out.println("application"+application.hashCode()+" add:"+name+"="+value);
    }

    // ç›‘å¬æ•°æ®ç§»é™¤
    @Override
    public void attributeRemoved(ServletContextAttributeEvent scae) {
        String name = scae.getName();
        Object value = scae.getValue();
        ServletContext application = scae.getServletContext();
        System.out.println("application"+application.hashCode()+" remove:"+name+"="+value);
    }
    // ç›‘å¬æ•°æ®ä¿®æ”¹
    @Override
    public void attributeReplaced(ServletContextAttributeEvent scae) {
        String name = scae.getName();
        Object value = scae.getValue();
        ServletContext application = scae.getServletContext();
        Object newValue = application.getAttribute(name);
        System.out.println("application"+application.hashCode()+" change:"+name+"="+value+" to "+newValue);
    }
}
```

- å®šä¹‰è§¦å‘ç›‘å¬å™¨çš„ä»£ç 
```java
// ServletAç”¨äºå‘applicationåŸŸä¸­æ”¾å…¥æ•°æ®
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // å‘applicationåŸŸä¸­æ”¾å…¥æ•°æ®
        ServletContext application = this.getServletContext();
        application.setAttribute("k1","v1");
        application.setAttribute("k2","v2");
    }
}


// ServletBç”¨äºå‘applicationåŸŸä¸­ä¿®æ”¹å’Œç§»é™¤æ•°æ®
@WebServlet(urlPatterns = "/servletB", name = "servletBName")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        ServletContext appliation  = getServletContext();
        //  ä¿®æ”¹applicationåŸŸä¸­çš„æ•°æ®
        appliation.setAttribute("k1","value1");
        //  åˆ é™¤applicationåŸŸä¸­çš„æ•°æ®
        appliation.removeAttribute("k2");
    }
}
```
#### 3.2.2 sessionåŸŸç›‘å¬å™¨

> HttpSessionListener  ç›‘å¬HttpSessionå¯¹è±¡çš„åˆ›å»ºä¸é”€æ¯

| æ–¹æ³•å                                 | ä½œç”¨                      |
| -------------------------------------- | ------------------------- |
| sessionCreated(HttpSessionEvent hse)   | HttpSessionå¯¹è±¡åˆ›å»ºæ—¶è°ƒç”¨ |
| sessionDestroyed(HttpSessionEvent hse) | HttpSessionå¯¹è±¡é”€æ¯æ—¶è°ƒç”¨ |

+ HttpSessionEventå¯¹è±¡ä»£è¡¨ä»HttpSessionå¯¹è±¡èº«ä¸Šæ•è·åˆ°çš„äº‹ä»¶ï¼Œé€šè¿‡è¿™ä¸ªäº‹ä»¶å¯¹è±¡æˆ‘ä»¬å¯ä»¥è·å–åˆ°è§¦å‘äº‹ä»¶çš„HttpSessionå¯¹è±¡ã€‚

> HttpSessionAttributeListener ç›‘å¬HttpSessionä¸­å±æ€§çš„æ·»åŠ ã€ç§»é™¤å’Œä¿®æ”¹

| æ–¹æ³•å                                        | ä½œç”¨                              |
| --------------------------------------------- | --------------------------------- |
| attributeAdded(HttpSessionBindingEvent se)    | å‘HttpSessionä¸­æ·»åŠ å±æ€§æ—¶è°ƒç”¨     |
| attributeRemoved(HttpSessionBindingEvent se)  | ä»HttpSessionä¸­ç§»é™¤å±æ€§æ—¶è°ƒç”¨     |
| attributeReplaced(HttpSessionBindingEvent se) | å½“HttpSessionä¸­çš„å±æ€§è¢«ä¿®æ”¹æ—¶è°ƒç”¨ |

+ HttpSessionBindingEventå¯¹è±¡ä»£è¡¨å±æ€§å˜åŒ–äº‹ä»¶ï¼Œå®ƒåŒ…å«çš„æ–¹æ³•å¦‚ä¸‹ï¼š

| æ–¹æ³•å       | ä½œç”¨                          |
| ------------ | ----------------------------- |
| getName()    | è·å–ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å        |
| getValue()   | è·å–è¢«ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å€¼      |
| getSession() | è·å–è§¦å‘äº‹ä»¶çš„HttpSessionå¯¹è±¡ |

> æµ‹è¯•ä»£ç 

- å®šä¹‰ç›‘å¬å™¨
```java
@WebListener
public class SessionListener implements HttpSessionListener, HttpSessionAttributeListener {
    // ç›‘å¬sessionåˆ›å»º
    @Override
    public void sessionCreated(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        System.out.println("session"+session.hashCode()+" created");
    }

    // ç›‘å¬sessioné”€æ¯
    @Override
    public void sessionDestroyed(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        System.out.println("session"+session.hashCode()+" destroyed");
    }
    // ç›‘å¬æ•°æ®å¢åŠ 
    @Override
    public void attributeAdded(HttpSessionBindingEvent se) {
        String name = se.getName();
        Object value = se.getValue();
        HttpSession session = se.getSession();
        System.out.println("session"+session.hashCode()+" add:"+name+"="+value);
    }
    // ç›‘å¬æ•°æ®ç§»é™¤
    @Override
    public void attributeRemoved(HttpSessionBindingEvent se) {
        String name = se.getName();
        Object value = se.getValue();
        HttpSession session = se.getSession();
        System.out.println("session"+session.hashCode()+" remove:"+name+"="+value);
    }
    // ç›‘å¬æ•°æ®ä¿®æ”¹
    @Override
    public void attributeReplaced(HttpSessionBindingEvent se) {
        String name = se.getName();
        Object value = se.getValue();
        HttpSession session = se.getSession();
        Object newValue = session.getAttribute(name);
        System.out.println("session"+session.hashCode()+" change:"+name+"="+value+" to "+newValue);
    }

}
```

- æµ‹è¯•ç›‘å¬å™¨
```java
// servletAç”¨äºåˆ›å»ºsessionå¹¶å‘sessionä¸­æ”¾æ•°æ®
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // åˆ›å»ºsession,å¹¶å‘sessionä¸­æ”¾å…¥æ•°æ®
        HttpSession session = req.getSession();

        session.setAttribute("k1","v1");
        session.setAttribute("k2","v2");
    }
}


// servletBç”¨äºä¿®æ”¹åˆ é™¤sessionä¸­çš„æ•°æ®å¹¶æ‰‹åŠ¨è®©sessionä¸å¯ç”¨
@WebServlet(urlPatterns = "/servletB", name = "servletBName")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession();
        //  ä¿®æ”¹sessionåŸŸä¸­çš„æ•°æ®
        session.setAttribute("k1","value1");
        //  åˆ é™¤sessionåŸŸä¸­çš„æ•°æ®
        session.removeAttribute("k2");
        // æ‰‹åŠ¨è®©sessionä¸å¯ç”¨
        session.invalidate();
    }
}
```
#### 3.2.3 requeståŸŸç›‘å¬å™¨

> ServletRequestListener ç›‘å¬ServletRequestå¯¹è±¡çš„åˆ›å»ºä¸é”€æ¯

| æ–¹æ³•å                                      | ä½œç”¨                         |
| ------------------------------------------- | ---------------------------- |
| requestInitialized(ServletRequestEvent sre) | ServletRequestå¯¹è±¡åˆ›å»ºæ—¶è°ƒç”¨ |
| requestDestroyed(ServletRequestEvent sre)   | ServletRequestå¯¹è±¡é”€æ¯æ—¶è°ƒç”¨ |

+ ServletRequestEventå¯¹è±¡ä»£è¡¨ä»HttpServletRequestå¯¹è±¡èº«ä¸Šæ•è·åˆ°çš„äº‹ä»¶ï¼Œé€šè¿‡è¿™ä¸ªäº‹ä»¶å¯¹è±¡æˆ‘ä»¬å¯ä»¥è·å–åˆ°è§¦å‘äº‹ä»¶çš„HttpServletRequestå¯¹è±¡ã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥è·å–åˆ°å½“å‰Webåº”ç”¨çš„ServletContextå¯¹è±¡ã€‚

> ServletRequestAttributeListener ç›‘å¬ServletRequestä¸­å±æ€§çš„æ·»åŠ ã€ç§»é™¤å’Œä¿®æ”¹

| æ–¹æ³•å                                               | ä½œç”¨                                 |
| ---------------------------------------------------- | ------------------------------------ |
| attributeAdded(ServletRequestAttributeEvent srae)    | å‘ServletRequestä¸­æ·»åŠ å±æ€§æ—¶è°ƒç”¨     |
| attributeRemoved(ServletRequestAttributeEvent srae)  | ä»ServletRequestä¸­ç§»é™¤å±æ€§æ—¶è°ƒç”¨     |
| attributeReplaced(ServletRequestAttributeEvent srae) | å½“ServletRequestä¸­çš„å±æ€§è¢«ä¿®æ”¹æ—¶è°ƒç”¨ |

+ ServletRequestAttributeEventå¯¹è±¡ä»£è¡¨å±æ€§å˜åŒ–äº‹ä»¶ï¼Œå®ƒåŒ…å«çš„æ–¹æ³•å¦‚ä¸‹ï¼š

| æ–¹æ³•å               | ä½œç”¨                             |
| -------------------- | -------------------------------- |
| getName()            | è·å–ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å           |
| getValue()           | è·å–è¢«ä¿®æ”¹æˆ–æ·»åŠ çš„å±æ€§å€¼         |
| getServletRequest () | è·å–è§¦å‘äº‹ä»¶çš„ServletRequestå¯¹è±¡ |

- å®šä¹‰ç›‘å¬å™¨
```java
@WebListener
public class RequestListener implements ServletRequestListener , ServletRequestAttributeListener {
    // ç›‘å¬åˆå§‹åŒ–
    @Override
    public void requestInitialized(ServletRequestEvent sre) {
        ServletRequest request = sre.getServletRequest();
        System.out.println("request"+request.hashCode()+" initialized");
    }

    // ç›‘å¬é”€æ¯
    @Override
    public void requestDestroyed(ServletRequestEvent sre) {
        ServletRequest request = sre.getServletRequest();
        System.out.println("request"+request.hashCode()+" destoryed");
    }


    // ç›‘å¬æ•°æ®å¢åŠ 
    @Override
    public void attributeAdded(ServletRequestAttributeEvent srae) {
        String name = srae.getName();
        Object value = srae.getValue();
        ServletRequest request = srae.getServletRequest();
        System.out.println("request"+request.hashCode()+" add:"+name+"="+value);
    }

    //  ç›‘å¬æ•°æ®ç§»é™¤
    @Override
    public void attributeRemoved(ServletRequestAttributeEvent srae) {
        String name = srae.getName();
        Object value = srae.getValue();
        ServletRequest request = srae.getServletRequest();
        System.out.println("request"+request.hashCode()+" remove:"+name+"="+value);
    }
    // ç›‘å¬æ•°æ®ä¿®æ”¹
    @Override
    public void attributeReplaced(ServletRequestAttributeEvent srae) {
        String name = srae.getName();
        Object value = srae.getValue();
        ServletRequest request = srae.getServletRequest();
        Object newValue = request.getAttribute(name);
        System.out.println("request"+request.hashCode()+" change:"+name+"="+value+" to "+newValue);
    }
}
```

- æµ‹è¯•ç›‘å¬å™¨
```java
//  servletAå‘è¯·æ±‚åŸŸä¸­æ”¾æ•°æ®
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // å‘requestä¸­å¢åŠ æ•°æ®
        req.setAttribute("k1","v1");
        req.setAttribute("k2","v2");
        // è¯·æ±‚è½¬å‘
        req.getRequestDispatcher("servletB").forward(req,resp);
    }
}

// servletBä¿®æ”¹åˆ é™¤åŸŸä¸­çš„æ•°æ®
@WebServlet(urlPatterns = "/servletB", name = "servletBName")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //  ä¿®æ”¹requeståŸŸä¸­çš„æ•°æ®
        req.setAttribute("k1","value1");
        //  åˆ é™¤sessionåŸŸä¸­çš„æ•°æ®
        req.removeAttribute("k2");

    }
}
```
### 3.3 sessionåŸŸä¸¤ä¸ªç‰¹æ®Šç›‘å¬å™¨

#### 3.3.1 sessionç»‘å®šç›‘å¬å™¨

> HttpSessionBindingListener ç›‘å¬å½“å‰ç›‘å¬å™¨å¯¹è±¡åœ¨SessionåŸŸä¸­çš„å¢åŠ ä¸ç§»é™¤

| æ–¹æ³•å                                      | ä½œç”¨                              |
| ------------------------------------------- | --------------------------------- |
| valueBound(HttpSessionBindingEvent event)   | è¯¥ç±»çš„å®ä¾‹è¢«æ”¾åˆ°SessionåŸŸä¸­æ—¶è°ƒç”¨ |
| valueUnbound(HttpSessionBindingEvent event) | è¯¥ç±»çš„å®ä¾‹ä»Sessionä¸­ç§»é™¤æ—¶è°ƒç”¨   |

+ HttpSessionBindingEventå¯¹è±¡ä»£è¡¨å±æ€§å˜åŒ–äº‹ä»¶ï¼Œå®ƒåŒ…å«çš„æ–¹æ³•å¦‚ä¸‹ï¼š

| æ–¹æ³•å       | ä½œç”¨                          |
| ------------ | ----------------------------- |
| getName()    | è·å–å½“å‰äº‹ä»¶æ¶‰åŠçš„å±æ€§å      |
| getValue()   | è·å–å½“å‰äº‹ä»¶æ¶‰åŠçš„å±æ€§å€¼      |
| getSession() | è·å–è§¦å‘äº‹ä»¶çš„HttpSessionå¯¹è±¡ |

> æµ‹è¯•ä»£ç 

+ å®šä¹‰ç›‘å¬å™¨
```java
public class MySessionBindingListener  implements HttpSessionBindingListener {
    //  ç›‘å¬ç»‘å®š
    @Override
    public void valueBound(HttpSessionBindingEvent event) {
        HttpSession session = event.getSession();
        String name = event.getName();
        System.out.println("MySessionBindingListener"+this.hashCode()+" binding into session"+session.hashCode()+" with name "+name);
    }

    // ç›‘å¬è§£é™¤ç»‘å®š
    @Override
    public void valueUnbound(HttpSessionBindingEvent event) {
        HttpSession session = event.getSession();
        String name = event.getName();
        System.out.println("MySessionBindingListener"+this.hashCode()+" unbond outof session"+session.hashCode()+" with name "+name);
    }
}
```

- æµ‹è¯•ç›‘å¬å™¨
```java
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession();
        // ç»‘å®šç›‘å¬å™¨
        session.setAttribute("bindingListener",new MySessionBindingListener());
        // è§£é™¤ç»‘å®šç›‘å¬å™¨
        session.removeAttribute("bindingListener");
    }
}
```

#### 3.3.2 é’åŒ–æ´»åŒ–ç›‘å¬å™¨

> HttpSessionActivationListener  ç›‘å¬æŸä¸ªå¯¹è±¡åœ¨Sessionä¸­çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚

| æ–¹æ³•å                                    | ä½œç”¨                                  |
| ----------------------------------------- | ------------------------------------- |
| sessionWillPassivate(HttpSessionEvent se) | è¯¥ç±»å®ä¾‹å’ŒSessionä¸€èµ·é’åŒ–åˆ°ç¡¬ç›˜æ—¶è°ƒç”¨ |
| sessionDidActivate(HttpSessionEvent se)   | è¯¥ç±»å®ä¾‹å’ŒSessionä¸€èµ·æ´»åŒ–åˆ°å†…å­˜æ—¶è°ƒç”¨ |

+ HttpSessionEventå¯¹è±¡ä»£è¡¨äº‹ä»¶å¯¹è±¡ï¼Œé€šè¿‡getSession()æ–¹æ³•è·å–äº‹ä»¶æ¶‰åŠçš„HttpSessionå¯¹è±¡ã€‚

> ä»€ä¹ˆæ˜¯é’åŒ–æ´»åŒ–

+ sessionå¯¹è±¡åœ¨æœåŠ¡ç«¯æ˜¯ä»¥å¯¹è±¡çš„å½¢å¼å­˜å‚¨äºå†…å­˜çš„,sessionè¿‡å¤š,æœåŠ¡å™¨çš„å†…å­˜ä¹Ÿæ˜¯åƒä¸æ¶ˆçš„
+ è€Œä¸”ä¸€æ—¦æœåŠ¡å™¨å‘ç”Ÿé‡å¯,æ‰€æœ‰çš„sessionå¯¹è±¡éƒ½å°†è¢«æ¸…é™¤,ä¹Ÿå°±æ„å‘³ç€sessionä¸­å­˜å‚¨çš„ä¸åŒå®¢æˆ·ç«¯çš„ç™»å½•çŠ¶æ€ä¸¢å¤±
+ ä¸ºäº†åˆ†æ‘Šå†…å­˜ å‹åŠ›å¹¶ä¸”ä¸ºäº†ä¿è¯sessioné‡å¯ä¸ä¸¢å¤±,æˆ‘ä»¬å¯ä»¥è®¾ç½®å°†sessionè¿›è¡Œé’åŒ–å¤„ç†
+ åœ¨å…³é—­æœåŠ¡å™¨å‰æˆ–è€…åˆ°è¾¾äº†è®¾å®šæ—¶é—´æ—¶,å¯¹sessionè¿›è¡Œåºåˆ—åŒ–åˆ°ç£ç›˜,è¿™ç§æƒ…å†µå«åšsessionçš„é’åŒ–
+ åœ¨æœåŠ¡å™¨å¯åŠ¨åæˆ–è€…å†æ¬¡è·å–æŸä¸ªsessionæ—¶,å°†ç£ç›˜ä¸Šçš„sessionè¿›è¡Œååºåˆ—åŒ–åˆ°å†…å­˜,è¿™ç§æƒ…å†µå«åšsessionçš„æ´»åŒ–


> å¦‚ä½•é…ç½®é’åŒ–æ´»åŒ–

+ åœ¨webç›®å½•ä¸‹,æ·»åŠ  META-INFä¸‹åˆ›å»ºContext.xml![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/cb6ce5002fb69b125e026ea278289a0a.png)
- æ–‡ä»¶ä¸­é…ç½®é’åŒ–
```xml
<?xml version="1.0" encoding="UTF-8"?>
<Context>
    <Manager className="org.apache.catalina.session.PersistentManager" maxIdleSwap="1">
        <Store className="org.apache.catalina.session.FileStore" directory="d:\mysession"></Store>
    </Manager>
</Context>
```

+  è¯·æ±‚servletA,è·å¾—session,å¹¶å­˜å…¥æ•°æ®,ç„¶åé‡å¯æœåŠ¡å™¨

``` java
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession();
        // æ·»åŠ æ•°æ®
        session.setAttribute("k1","v1");
    }
}
```

+ è¯·æ±‚servletBè·å–session,è·å–é‡å¯å‰å­˜å…¥çš„æ•°æ®

``` java
@WebServlet(urlPatterns = "/servletB", name = "servletBName")
public class ServletB extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession();
        Object v1 = session.getAttribute("k1");
        System.out.println(v1);

    }
}
```

> å¦‚ä½•ç›‘å¬é’åŒ–æ´»åŒ–

+ å®šä¹‰ç›‘å¬å™¨
```java
public class ActivationListener  implements HttpSessionActivationListener, Serializable {
    //  ç›‘å¬é’åŒ–
    @Override
    public void sessionWillPassivate(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        System.out.println("session with JSESSIONID "+ session.getId()+" will passivate");
    }

    //  ç›‘å¬æ´»åŒ–
    @Override
    public void sessionDidActivate(HttpSessionEvent se) {
        HttpSession session = se.getSession();
        System.out.println("session with JSESSIONID "+ session.getId()+" did activate");
    }
}

```

- æµ‹è¯•ç›‘å¬å™¨
```java
@WebServlet(urlPatterns = "/servletA",name = "servletAName")
public class ServletA extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession();
        // æ·»åŠ æ•°æ®
        session.setAttribute("k1","v1");
        // æ·»åŠ é’åŒ–æ´»åŒ–ç›‘å¬å™¨
        session.setAttribute("activationListener",new ActivationListener());
    }
}
```
## 4 Ajax

### 4.1 ä»€ä¹ˆæ˜¯ajax

+ AJAX = Asynchronous JavaScript and XMLï¼ˆå¼‚æ­¥çš„ JavaScript å’Œ XMLï¼‰ã€‚

+ AJAX ä¸æ˜¯æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œè€Œæ˜¯ä¸€ç§ä½¿ç”¨ç°æœ‰æ ‡å‡†çš„æ–°æ–¹æ³•ã€‚

+ AJAX æœ€å¤§çš„ä¼˜ç‚¹æ˜¯åœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¸æœåŠ¡å™¨äº¤æ¢æ•°æ®å¹¶æ›´æ–°éƒ¨åˆ†ç½‘é¡µå†…å®¹ã€‚

+ AJAX ä¸éœ€è¦ä»»ä½•æµè§ˆå™¨æ’ä»¶ï¼Œä½†éœ€è¦ç”¨æˆ·å…è®¸ JavaScript åœ¨æµè§ˆå™¨ä¸Šæ‰§è¡Œã€‚

+ XMLHttpRequest åªæ˜¯å®ç° Ajax çš„ä¸€ç§æ–¹å¼ã€‚

**ajaxå·¥ä½œåŸç†ï¼š**![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/2089e8c49dca533fadbc6bba5e8fac4f.png)

+ ç®€å•æ¥è¯´,æˆ‘ä»¬ä¹‹å‰å‘çš„è¯·æ±‚é€šè¿‡ç±»ä¼¼  formè¡¨å•æ ‡ç­¾,aæ ‡ç­¾ è¿™ç§æ–¹å¼,ç°åœ¨`é€šè¿‡ è¿è¡Œjsä»£ç åŠ¨æ€å†³å®šä»€ä¹ˆæ—¶å€™å‘é€ä»€ä¹ˆæ ·çš„è¯·æ±‚`

+ `é€šè¿‡è¿è¡ŒJSä»£ç å‘é€çš„è¯·æ±‚æµè§ˆå™¨å¯ä»¥ä¸ç”¨è·³è½¬é¡µé¢` ,æˆ‘ä»¬`å¯ä»¥åœ¨JSä»£ç ä¸­å†³å®šæ˜¯å¦è¦è·³è½¬é¡µé¢`

+ `é€šè¿‡è¿è¡ŒJSä»£ç å‘é€çš„è¯·æ±‚,æ¥æ”¶åˆ°è¿”å›ç»“æœå,æˆ‘ä»¬å¯ä»¥å°†ç»“æœé€šè¿‡domç¼–ç¨‹æ¸²æŸ“åˆ°é¡µé¢çš„æŸäº›å…ƒç´ ä¸Š,å®ç°å±€éƒ¨æ›´æ–°`
### 4.2 å¦‚ä½•å®ç°ajaxè¯·æ±‚

åŸç”Ÿ**javascriptæ–¹å¼è¿›è¡Œajax(äº†è§£):**

```js
<script>
  function loadXMLDoc(){
    var xmlhttp=new XMLHttpRequest();
      // è®¾ç½®å›è°ƒå‡½æ•°å¤„ç†å“åº”ç»“æœ
    xmlhttp.onreadystatechange=function(){
      if (xmlhttp.readyState==4 && xmlhttp.status==200)
      {
        document.getElementById("myDiv").innerHTML=xmlhttp.responseText;
      }
    }
      // è®¾ç½®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚çš„èµ„æºè·¯å¾„
    xmlhttp.open("GET","/try/ajax/ajax_info.txt",true);
      // å‘é€è¯·æ±‚
    xmlhttp.send();
  }
</script> 
```