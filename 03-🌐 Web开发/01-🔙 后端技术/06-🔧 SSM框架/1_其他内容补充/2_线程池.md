---
æ–‡ç« æ ‡é¢˜: "[[2_çº¿ç¨‹æ± ]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æ·±å…¥è®²è§£Javaçº¿ç¨‹æ± çš„æ ¸å¿ƒæ¦‚å¿µã€åˆ›å»ºæ–¹å¼ã€ä¸ƒå¤§å‚æ•°ã€ä»»åŠ¡æ‰§è¡Œæµç¨‹ã€é˜»å¡é˜Ÿåˆ—ã€æ‹’ç»ç­–ç•¥å’Œçº¿ç¨‹æ•°è®¾ç½®ç­‰å®è·µè¦ç‚¹
tags:
- "Java"
- "çº¿ç¨‹æ± "
- "ThreadPoolExecutor"
- "å¹¶å‘ç¼–ç¨‹"
- "é˜»å¡é˜Ÿåˆ—"
- "Executors"
- "æ‹’ç»ç­–ç•¥"
- "å¤šçº¿ç¨‹"
ç›¸å…³æ–‡ç« :
- "[[1_Javaå¤šçº¿ç¨‹]]"
- "[[9_å¤šçº¿ç¨‹]]"
- "[[0_å‰ç½®çŸ¥è¯†å¿«é€Ÿå›é¡¾]]"
- "[[11_å•ä¾‹æ¨¡å¼çš„6ç§å®ç°æ–¹å¼]]"
- "[[4_.2023-10-13åç»­å­¦ä¹ åˆ†æ]]"
æ–‡ç« åˆ†ç±»: "ğŸŒ Webå¼€å‘"
æ–‡ç« è·¯å¾„: "03-ğŸŒ Webå¼€å‘/01-ğŸ”™ åç«¯æŠ€æœ¯/06-ğŸ”§ SSMæ¡†æ¶/1_å…¶ä»–å†…å®¹è¡¥å……/2_çº¿ç¨‹æ± .md"
æ–‡ç« éš¾åº¦: ä¸­çº§ ğŸŒ³
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­ æ ¸å¿ƒèƒ½åŠ›
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2025-05-27 23:34:19
---

## 1 å›é¡¾ä¸€ä¸‹çº¿ç¨‹å’Œè¿›ç¨‹çš„å…³ç³»

è¿›ç¨‹ï¼šæ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œæ¯”å¦‚ä¸€äº›ç”µè„‘åº”ç”¨ï¼šqqï¼Œæµè§ˆå™¨ï¼Œæ¸¸æˆ

çº¿ç¨‹ï¼šç¨‹åºæ‰§è¡Œæµçš„æœ€å°æ‰§è¡Œå•ä½

ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰1~nä¸ªçº¿ç¨‹
## 2 å›é¡¾ä¸€ä¸‹åˆ›å»ºçº¿ç¨‹çš„ä¸‰ä¸ªæ–¹æ³•

Javaä¸­åˆ›å»ºçº¿ç¨‹ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼š

`1ã€ç»§æ‰¿Threadç±»`

```java
/**
 * Description:åˆ›å»ºçº¿ç¨‹æ–¹å¼ä¸€ï¼Œç»§æ‰¿Threadç±»ï¼Œå¤å†™runæ–¹æ³•  
 */  
public class MyThread extends Thread{  
    @Override  
    public void run() {  
        System.out.println("è‡ªå®šä¹‰çº¿ç¨‹çš„runæ–¹æ³•æ‰§è¡Œäº†");  
    }  
  
    public static void main(String[] args) {  
        new MyThread().start();  
    }  
}
```

åˆ›å»ºspringbooté¡¹ç›®æ—¶å¯ä»¥ä½¿ç”¨ä½¿ç”¨[http://start.aliyun.com](http://start.aliyun.com)æ›¿ä»£é»˜è®¤çš„[https://start.spring.io](https://start.spring.io)

`2ã€é€šè¿‡å®ç°Runnableæ¥å£`

```java
//åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼äºŒï¼Œå®ç°Runnableæ¥å£ï¼Œå¤å†™runæ–¹æ³•  
public class MyRunnableThread implements Runnable{  
    @Override  
    public void run() {  
        System.out.println("è‡ªå®šä¹‰çº¿ç¨‹çš„runæ–¹æ³•æ‰§è¡Œäº†");  
    }  
  
    public static void main(String[] args) {  
        new Thread(new MyRunnableThread(),"æ–°çº¿ç¨‹1ï¼š").start();  
    }  
}
```

3ã€`é€šè¿‡å®ç°Callableæ¥å£`ï¼ˆç›¸è¾ƒäºå®ç° Runnable æ¥å£çš„æ–¹å¼ï¼Œé‡å†™çš„æ–¹æ³•å¯ä»¥æœ‰è¿”å›å€¼ï¼‰
	å‰ä¸¤ç§å¤§å®¶è‚¯å®šå¾ˆç†Ÿæ‚‰äº†ï¼Œè¿™é‡Œé‡ç‚¹ä»‹ç»ç¬¬ä¸‰ç§
æ­¥éª¤ï¼š

ï¼ˆ1ï¼‰è‡ªå®šä¹‰ç±»å®ç° Callable æ¥å£ã€‚ ç›¸è¾ƒäºå®ç° Runnable æ¥å£çš„æ–¹å¼ï¼Œé‡å†™çš„æ–¹æ³•å¯ä»¥æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚

```java
Â public class MyCallable implements Callable<String> {
Â Â Â  @Override
Â Â Â  public String call() throws Exception {  
Â Â Â Â Â Â Â  Thread._sleep_(500);  
Â Â Â Â Â Â Â  return "testCallable";
Â Â Â  }  
}
```

ï¼ˆ2ï¼‰åˆ›å»ºFutureTaskå¯¹è±¡ã€‚

```java
MyCallable myCallable = new MyCallable();  
FutureTask futureTask = new FutureTask(myCallable);
```

FutureTaskæœ‰ä¸¤ä¸ªé‡è¦æ–¹æ³•ï¼š
	isDone() è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤º`callæ–¹æ³•æ˜¯å¦æ‰§è¡Œç»“æŸï¼Œä¸é˜»å¡`
	get() `è¿”å›callæ–¹æ³•çš„è¿”å›å€¼`ï¼Œå¦‚æœ`callæ–¹æ³•æœªæ‰§è¡Œå®Œä¼šé˜»å¡`

ï¼ˆ3ï¼‰ä¸Šè¿°å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥Threadæ„é€ æ–¹æ³•ï¼Œåˆ›å»ºçº¿ç¨‹å¹¶å¯åŠ¨ã€‚

```java
new Thread(futureTask, "callable").start();  
while (!futureTask.isDone()) {  
Â Â Â  System._out_.println("æœªå®Œæˆ");  
}  
System._out_.println(futureTask.get());
```

- å®Œæ•´ä»£ç 
```java
public class MyCallableThread implements Callable<String> {  
  
    @Override  
    public String call() throws Exception {  
        Thread.sleep(100);  
        return "testCallable";  
    }  
  
    public static void main(String[] args) throws ExecutionException, InterruptedException {  
        MyCallableThread callableThread = new MyCallableThread();  
        FutureTask futureTask = new FutureTask(callableThread);  
  
        new Thread(futureTask,"callable").start();  
        while (!futureTask.isDone()){  
            System.out.println("æœªå®Œæˆ");  
        }  
        System.out.println(futureTask.get());  
    }  
}
```

## 3 åˆ›å»ºJDKä¸­çš„çº¿ç¨‹æ± 

### 3.1 çº¿ç¨‹æ± æ¦‚å¿µ

1ã€æä¾›äº†ä¸€ä¸ª`è£…çº¿ç¨‹çš„å®¹å™¨`ï¼Œç°å–ç°ç”¨ï¼Œç”¨å®Œå³è¿˜ã€‚é¿å…äº†åˆ›å»ºä¸é”€æ¯é¢å¤–å¼€é”€ï¼Œæé«˜äº†å“åº”çš„é€Ÿåº¦ã€‚

2ã€æä¾›äº†ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­ä¿å­˜ç€æ‰€æœ‰éœ€è¦çº¿ç¨‹æ¥æ‰§è¡Œçš„ä»»åŠ¡ã€‚

### 3.2 çº¿ç¨‹æ± çš„ä½“ç³»ç»“æ„ï¼š

  java.util.concurrent.`Executor` : è´Ÿè´£çº¿ç¨‹çš„ä½¿ç”¨ä¸è°ƒåº¦çš„æ ¹æ¥å£
	 |--`ExecutorService` å­æ¥å£: çº¿ç¨‹æ± çš„ä¸»è¦æ¥å£
		|--`ThreadPoolExecutor` <font color="#00b050">çº¿ç¨‹æ± çš„å®ç°ç±»</font>

ThreadPoolExecutorçš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/bf5d3dddbce648ec87fb3e2728480d15.png)

### 3.3 çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°

`corePoolSize`Â ï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å°æ•°é‡ã€‚ï¼ˆæ³¨æ„çº¿ç¨‹æ± åˆšåˆ›å»ºå®Œï¼Œçº¿ç¨‹æ•°æ˜¯0ï¼Œæ¥ä»»åŠ¡æ‰ä¼šåˆ›å»ºçº¿ç¨‹ï¼‰

`maximumPoolSize`Â ï¼šçº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å¤§æ•°é‡ ã€‚Â 

`keepAliveTime`Â ï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´ã€‚ä¸€ä¸ªçº¿ç¨‹å¦‚æœ<font color="#00b050">å¤„äºç©ºé—²çŠ¶æ€ï¼Œå¹¶ä¸”å½“å‰çš„çº¿ç¨‹æ•°é‡å¤§äºcorePoolSize</font>ï¼Œé‚£ä¹ˆåœ¨æŒ‡å®šæ—¶é—´åÂ  ï¼Œè¿™ä¸ªç©ºé—²çº¿ç¨‹ä¼šè¢«é”€æ¯ï¼ˆè¡¥å……ï¼šä½†æ˜¯å¦‚æœè°ƒç”¨äº†çº¿ç¨‹æ± çš„allowCoreThreadTimeOut(true)æ–¹æ³•ï¼Œåœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸å¤§äºcorePoolSizeæ—¶ï¼ŒkeepAliveTimeå‚æ•°ä¹Ÿä¼šèµ·ä½œç”¨ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º0ï¼‰

`unit`Â ï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´çš„å•ä½ï¼ŒkeepAliveTimeçš„è®¡é‡å•ä½

`workQueue`Â ï¼š çº¿ç¨‹æ± æ‰€ä½¿ç”¨çš„ç¼“å†²é˜Ÿåˆ—ï¼Œç¼“å†²é˜Ÿåˆ—çš„é•¿åº¦å†³å®šäº†èƒ½å¤Ÿç¼“å†²çš„æœ€å¤§æ•°é‡ã€‚

`ThreadFactory`ï¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ—¶ä½¿ç”¨çš„å·¥å‚ï¼Œå¯ä»¥ç”¨æ¥è®¾å®šçº¿ç¨‹åã€æ˜¯å¦ä¸ºdaemonçº¿ç¨‹

`handler`Â ï¼š çº¿ç¨‹æ± å¯¹æ‹’ç»ä»»åŠ¡çš„å¤„ç†ç­–ç•¥ã€‚

### 3.4 çº¿ç¨‹æ± ä»»åŠ¡æ‰§è¡Œæµç¨‹

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/a174d5087e568eb2ee2c041b9dedc355.png)


æäº¤ä»»åŠ¡åï¼Œçº¿ç¨‹æ± å…ˆåˆ¤æ–­çº¿ç¨‹æ•°æ˜¯å¦è¾¾åˆ°äº†æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆcorePoolSizeï¼‰ã€‚å¦‚æœæœªè¾¾åˆ°çº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹å¤„ç†ä»»åŠ¡ï¼›å¦åˆ™ï¼Œå°±æ‰§è¡Œä¸‹ä¸€æ­¥ï¼›

æ¥ç€çº¿ç¨‹æ± åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦æ»¡äº†ã€‚å¦‚æœæ²¡æ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼›å¦åˆ™ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥ï¼›

æ¥ç€å› ä¸ºä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œçº¿ç¨‹æ± å°±åˆ¤æ–­çº¿ç¨‹æ•°æ˜¯å¦è¾¾åˆ°äº†æœ€å¤§çº¿ç¨‹æ•°ã€‚å¦‚æœæœªè¾¾åˆ°ï¼Œåˆ™åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å¤„ç†ä»»åŠ¡ï¼›å¦åˆ™ï¼Œå°±æ‰§è¡ŒRejectedExecutionHandler

æ³¨æ„ï¼šåœ¨`åˆšåˆšåˆ›å»ºThreadPoolExecutorçš„æ—¶å€™ï¼Œçº¿ç¨‹å¹¶ä¸ä¼šç«‹å³å¯åŠ¨ï¼Œè€Œæ˜¯è¦ç­‰åˆ°æœ‰ä»»åŠ¡æäº¤æ—¶æ‰ä¼šå¯åŠ¨`ï¼Œé™¤éè°ƒç”¨äº†prestartCoreThread/prestartAllCoreThreadsäº‹å…ˆå¯åŠ¨æ ¸å¿ƒçº¿ç¨‹ã€‚å†è€ƒè™‘åˆ°keepAliveTimeå’ŒallowCoreThreadTimeOutè¶…æ—¶å‚æ•°çš„å½±å“ï¼Œæ‰€ä»¥æ²¡æœ‰ä»»åŠ¡éœ€è¦æ‰§è¡Œçš„æ—¶å€™ï¼Œçº¿ç¨‹æ± çš„å¤§å°ä¸ä¸€å®šæ˜¯corePoolSizeã€‚

### 3.5 éé˜»å¡é˜Ÿåˆ—ä¸é˜»å¡é˜Ÿåˆ—

- éé˜»å¡é˜Ÿåˆ—æœ‰å¦‚ä¸‹ï¼š
	- `PriorityQueue`ï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œæ”¯æŒæ’åºï¼‰ConcurrentLinkedQueue, ï¼ˆåŸºäºé“¾è¡¨çš„å¹¶å‘é˜Ÿåˆ—ï¼‰Â 

- é˜»å¡é˜Ÿåˆ—
	- `ArrayBlockingQueue`, ï¼ˆåŸºäºæ•°ç»„çš„å¹¶å‘é˜»å¡é˜Ÿåˆ—ï¼Œéœ€è¦æŒ‡å®šå®¹é‡ï¼‰
	- `LinkedBlockingQeque`, ï¼ˆåŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ï¼Œå®¹é‡æ— é™ï¼‰
	- `SynchronousQueue` ï¼ˆåŒæ­¥é˜»å¡é˜Ÿåˆ—ï¼Œä¸å­˜å‚¨å…ƒç´ ï¼Œæ·»åŠ å…ƒç´ æ“ä½œå’Œè·å–å…ƒç´ å¿…é¡»åŒæ—¶å­˜åœ¨ï¼Œå¦åˆ™ä¼šé˜»å¡ï¼‰
	- `DelayedWorkQueue`ï¼ˆå»¶è¿Ÿé˜Ÿåˆ—ï¼Œå®¹é‡æ— é™åˆ¶ï¼‰

- é˜»å¡é˜Ÿåˆ—å’Œéé˜»å¡é˜Ÿåˆ—çš„åŒºåˆ«ï¼š

	1ã€ å½“é˜Ÿåˆ—æ˜¯ç©ºçš„æ—¶ï¼Œé˜»å¡é˜Ÿåˆ—çš„takeæ–¹æ³•ä»é˜Ÿåˆ—å–å…ƒç´ ä¼šè¢«é˜»å¡

	2ã€ æˆ–è€…å½“é˜Ÿåˆ—æ˜¯æ»¡æ—¶ï¼Œé˜»å¡é˜Ÿåˆ—çš„putæ–¹æ³•å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„æ“ä½œä¼šè¢«é˜»å¡

- é˜»å¡ä¸éé˜»å¡é˜Ÿåˆ—çš„å…±æœ‰æ–¹æ³•ï¼š

	a)Â Â Â  `add(E e)ï¼šå°†å…ƒç´ eæ’å…¥åˆ°é˜Ÿåˆ—æœ«å°¾`ï¼Œå¦‚æœæ’å…¥æˆåŠŸï¼Œåˆ™è¿”å›trueï¼›å¦‚æœæ’å…¥å¤±è´¥ï¼ˆå³é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼›

	b)Â Â  `remove()ï¼šç§»é™¤é˜Ÿé¦–å…ƒç´ `ï¼Œè‹¥ç§»é™¤æˆåŠŸï¼Œåˆ™è¿”å›trueï¼›å¦‚æœç§»é™¤å¤±è´¥ï¼ˆé˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼›

	c)Â Â Â  `offer(E e)ï¼šå°†å…ƒç´ eæ’å…¥åˆ°é˜Ÿåˆ—æœ«å°¾`ï¼Œå¦‚æœæ’å…¥æˆåŠŸï¼Œåˆ™è¿”å›trueï¼›å¦‚æœæ’å…¥å¤±è´¥ï¼ˆå³é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™è¿”å›falseï¼›

	d)Â Â  `poll()ï¼šç§»é™¤å¹¶è·å–é˜Ÿé¦–å…ƒç´ `ï¼Œè‹¥æˆåŠŸï¼Œåˆ™è¿”å›é˜Ÿé¦–å…ƒç´ ï¼›å¦åˆ™è¿”å›nullï¼›

	e)Â Â Â  `peek()ï¼šè·å–é˜Ÿé¦–å…ƒç´ `ï¼Œè‹¥æˆåŠŸï¼Œåˆ™è¿”å›é˜Ÿé¦–å…ƒç´ ï¼›å¦åˆ™è¿”å›null

- é˜»å¡é˜Ÿåˆ—çš„4ä¸ªç‹¬æœ‰æ–¹æ³•ï¼š

	a)Â Â Â Â  `put(E e)ï¼šputæ–¹æ³•ç”¨æ¥å‘é˜Ÿå°¾å­˜å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™ç­‰å¾…ï¼›`

	b)Â Â Â Â  `take()ï¼štakeæ–¹æ³•ç”¨æ¥ä»é˜Ÿé¦–å–å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ç­‰å¾…`

	c)Â Â Â Â  offer(E e,long timeout, TimeUnit unit)ï¼šofferæ–¹æ³•ç”¨æ¥å‘é˜Ÿå°¾å­˜å…¥å…ƒç´ ï¼Œ`å¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™ç­‰å¾…ä¸€å®šçš„æ—¶é—´`ï¼Œå½“æ—¶é—´æœŸé™è¾¾åˆ°æ—¶ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ’å…¥æˆåŠŸï¼Œåˆ™è¿”å›falseï¼›å¦åˆ™è¿”å›trueï¼›

	d)Â Â Â Â  poll(long timeout, TimeUnit unit)ï¼šã€€pollæ–¹æ³•ç”¨æ¥ä»é˜Ÿé¦–å–å…ƒç´ ï¼Œ`å¦‚æœé˜Ÿåˆ—ç©ºï¼Œåˆ™ç­‰å¾…ä¸€å®šçš„æ—¶é—´`ï¼Œå½“æ—¶é—´æœŸé™è¾¾åˆ°æ—¶ï¼Œå¦‚æœå–ä¸åˆ°ï¼Œåˆ™è¿”å›nullï¼›å¦åˆ™è¿”å›å–å¾—çš„å…ƒç´ ï¼›

- ä»£ç æ¼”ç¤ºArrayBlockingQueueçš„æ–¹æ³•ï¼š

```java
public class ArrayBlockingQueueTest {  
    public static void main(String[] args) {  
        ArrayBlockingQueue<String> arrayBlockingQueue = new ArrayBlockingQueue<>(2);  
        arrayBlockingQueue.add("a");  
        arrayBlockingQueue.add("b");  
//        arrayBlockingQueue.add("c");    //Queue full  
        boolean d = arrayBlockingQueue.offer("d");  
        System.out.println(d);  //false  
    }  
}
```

- ä»£ç æ¼”ç¤ºSynchronousQueueçš„æ–¹æ³•ï¼š

```java
public class SynchronousQueueTest {  
    public static void main(String[] args) throws InterruptedException, IOException {  
        final SynchronousQueue<String> queue =  
                new SynchronousQueue<>();  
  
        //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œç”¨äºå…ˆé˜Ÿåˆ—ä¸­putå…ƒç´   
        Thread put = new Thread(()->{  
            System.out.println("put thread start");  
            try {  
                queue.put("put");  
            } catch (Exception e) {  
            }            System.out.println("put thread end");  
        },"put");  
  
        //åœ¨åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œç”¨äºå‘é˜Ÿåˆ—ä¸­takeå…ƒç´   
        Thread take = new Thread(()->{  
            System.out.println("take thread start");  
            try {  
                System.out.println("take1 from putThread: " + queue.take());  
            } catch (Exception e) {  
            }            System.out.println("take thread end");  
        },"take");  
  
        //putå…ƒç´ çº¿ç¨‹å¯åŠ¨  
        put.start();  
        System.out.println("çº¿ç¨‹å¼€å§‹é˜»å¡2s");  
        //çº¿ç¨‹é˜»å¡2s  
        Thread.sleep(2000);  
  
        //takeå…ƒç´ çº¿ç¨‹å¯åŠ¨  
        take.start();  
  
        //é˜»å¡mainçº¿ç¨‹ï¼Œæ¥è§‚çœ‹å­çº¿ç¨‹æ‰“å°çš„å†…å®¹  
        System.in.read();  
    }  
}
```

### 3.6 JDKä¸ºæˆ‘ä»¬æä¾›çš„çº¿ç¨‹æ± å·¥å…·ç±»Executors

- Executorså¸¸è§çš„æœ‰å¦‚ä¸‹å‡ ä¸ªæ–¹æ³•

	- `newFixedThreadPool(int nThreads)Â ` åˆ›å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ç›¸åŒçš„çº¿ç¨‹æ± ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3eaf2f7a7e3d58b509c3539fcc95936d.png)
	- `newSingleThreadExecutor()`Â åˆ›å»ºä¸€ä¸ªå•ä¸€çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä¹Ÿå°±æ˜¯è¯´æ± ä¸­å°±ä¸€ä¸ªçº¿ç¨‹ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/f1a2bbc7360aa404110984245737337c.png)
	- `newCachedThreadPool()` åˆ›å»ºä¸€ä¸ªä¸ç¼“å­˜ä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œæ¥ä¸€ä¸ªä»»åŠ¡ï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªç©ºé—²çº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/465da06df3692c80799de822c560e39d.png)
	- `newScheduledThreadPool(int corePoolSize)`Â åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„å¯è°ƒåº¦çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶æ“ä½œå’Œå‘¨æœŸæ€§æ“ä½œã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/dd9338638c267c5244b332f3f350c894.png)

- ä¸Šè¿°å››ç§å¸¸ç”¨æ–¹æ³•ä¸»è¦ä½¿ç”¨äº†ä»¥ä¸‹ä¸‰ç§å·¥ä½œé˜Ÿåˆ—ï¼š

	a) `LinkedBlockingQuene`

	`åŸºäºé“¾è¡¨çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼ˆå…¶å®æœ€å¤§å®¹é‡ä¸ºInterger.MAXï¼‰ï¼ŒæŒ‰ç…§FIFOæ’åº`ã€‚ç”±äºè¯¥é˜Ÿåˆ—çš„è¿‘ä¼¼æ— ç•Œæ€§ï¼Œå½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡è¾¾åˆ°corePoolSizeåï¼Œå†æœ‰æ–°ä»»åŠ¡è¿›æ¥ï¼Œä¼šä¸€ç›´å­˜å…¥è¯¥é˜Ÿåˆ—ï¼Œè€Œä¸ä¼šå»åˆ›å»ºæ–°çº¿ç¨‹ç›´åˆ°maxPoolSizeï¼Œå› æ­¤ä½¿ç”¨è¯¥å·¥ä½œé˜Ÿåˆ—æ—¶ï¼Œå‚æ•°maxPoolSizeå…¶å®æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚

	b)Â `SynchronousQuene`

	ä¸€ä¸ªä¸ç¼“å­˜ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ï¼Œ`æ·»åŠ ä¸€ä¸ªä»»åŠ¡å¿…é¡»ç­‰åˆ°æœ‰å…ˆçº¿ç¨‹æ¥å–å‡ºè¿™ä¸ªä»»åŠ¡`ã€‚ä¹Ÿå°±æ˜¯è¯´æ–°ä»»åŠ¡è¿›æ¥æ—¶ï¼Œä¸ä¼šç¼“å­˜ï¼Œè€Œæ˜¯ç›´æ¥è¢«è°ƒåº¦æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡è¾¾åˆ°maxPoolSizeï¼Œåˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚

	c)Â `DelayedWorkQueue`

	ä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„å»¶è¿Ÿé˜»å¡é˜Ÿåˆ—ã€‚

æ³¨æ„ï¼š`å¼€å‘å°½é‡ç›´æ¥ä½¿ç”¨ThreadPoolExecutorçš„æ„é€ æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± `ï¼Œä¸ºäº†è®©æˆ‘ä»¬æ›´æ˜ç¡®çº¿ç¨‹æ± çš„å‡ ä¸ªå‚æ•°å¯èƒ½é€ æˆçš„å½±å“ï¼Œæ¯”å¦‚Executors.newFixedThreadPool(3)å®é™…åˆ›å»ºè¿‡ç¨‹æ˜¯è°ƒç”¨ThreadPoolExecutorçš„æ„é€ å‡½æ•°ï¼š

```java
ExecutorService fixedThreadPool =new ThreadPoolExecutor(3, 3,  
        0L, TimeUnit.MILLISECONDS,  
        new LinkedBlockingQueue<Runnable>(), Executors.defaultThreadFactory()  
        , new ThreadPoolExecutor.AbortPolicy());
```

æ— ç•Œçš„å¤„ç†é˜Ÿåˆ—å¯èƒ½ä¼šè€—è´¹éå¸¸å¤§çš„å†…å­˜ï¼Œç”šè‡³ OOMï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŒ‡å®šå®¹é‡çš„`ArrayBlockingQueue`æ¥ä»£æ›¿ã€‚

## 4 ä½¿ç”¨JDKä¸­çš„çº¿ç¨‹æ± 
### 4.1 çº¿ç¨‹æ± çš„ä¸»è¦æ–¹æ³•

`execute(Runnable r)`ï¼šæäº¤ä»»åŠ¡äº¤ç»™çº¿ç¨‹æ± è¿è¡Œ

`submit(Callable r)`ï¼šæäº¤ä»»åŠ¡ï¼Œèƒ½å¤Ÿè¿”å›æ‰§è¡Œç»“æœ

`getQueue()`ï¼šè·å–çº¿ç¨‹æ± çš„é˜»å¡é˜Ÿåˆ—ã€‚

`shutdown()`ï¼šå…³é—­çº¿ç¨‹æ± ï¼Œç­‰å¾…ä»»åŠ¡éƒ½æ‰§è¡Œå®Œ

shutdownNow()ï¼šå…³é—­çº¿ç¨‹æ± ï¼Œä¸ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œ

getPoolSize()ï¼šçº¿ç¨‹æ± å½“å‰çº¿ç¨‹æ•°é‡

getActiveCount()ï¼šå½“å‰çº¿ç¨‹æ± ä¸­æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ•°é‡

### 4.2 ä»£ç æ¼”ç¤ºåˆ›å»ºçº¿ç¨‹æ± 

```java
public class ExecutorsTest {  
    //å› ä¸ºçº¿ç¨‹æ± å¤§å°ä¸º2ï¼Œæ¯ä¸ªä»»åŠ¡è¾“å‡ºindexåsleep 2ç§’ï¼Œæ‰€ä»¥æ¯ä¸¤ç§’æ‰“å°2ä¸ªæ•°å­—ã€‚  
    @Test  
    public void fixedThreadPool() throws InterruptedException {  
        ExecutorService fixedThreadPool =  
                Executors.newFixedThreadPool(2);  
        for (long i = 0; i < 10; i++) {  //æ³¨æ„forå¾ªç¯æ˜¯ä¸é˜»å¡çš„
            final long index = i;  
            fixedThreadPool.execute(()->{  
                try {  
                    System.out.println(Thread.currentThread().getName() + ":" + index);  
                    Thread.sleep(2000);  
                } catch (InterruptedException e) {  
                    System.out.println(e.getMessage());  
                }  
            });  
        }  
        Thread.sleep(30000);  
    }  
  
    //åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œè°å…ˆæ¥è°å…ˆæ‰§è¡Œ  
    @Test  
    public void newSingleThreadExecutor() throws InterruptedException {  
        ExecutorService singleThreadExecutor =  
                Executors.newSingleThreadExecutor();  
        for (long i = 0; i < 10; i++) {  
            final long index = i;  
            singleThreadExecutor.execute(()->{  
                try {  
                    System.out.println(Thread.currentThread().getName() + ":" + index);  
                    Thread.sleep(2000);  
                } catch (InterruptedException e) {  
                    System.out.println(e.getMessage());  
                }  
            });  
        }  
        Thread.sleep(30000);  
    }  
  
    //ä¸ç¼“å­˜ä»»åŠ¡ï¼Œæ¥ä»»åŠ¡æ—¶ï¼Œå¦‚æœæ²¡æœ‰çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚  
    @Test  
    public void cachedThreadPool() throws InterruptedException {  
        ExecutorService cachedThreadPool =  
                Executors.newCachedThreadPool();  
        for (long i = 0; i < 10; i++) {  
            final long index = i;  
            cachedThreadPool.execute(()->{  
                try {  
                    System.out.println(Thread.currentThread().getName() + ":" + index);  
                    Thread.sleep(2000);  
                } catch (InterruptedException e) {  
                    System.out.println(e.getMessage());  
                }  
            });  
        }  
        Thread.sleep(30000);  
    }  
  
    //åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œ  
	@Test  
	public void newScheduledThreadPool() throws InterruptedException {  
	    ScheduledExecutorService scheduledThreadPool =  
	            Executors.newScheduledThreadPool(1);  
	    scheduledThreadPool.schedule(()->{  
	        System.out.println(Thread.currentThread().getName() + ": delay 5 seconds");  
	    },5, TimeUnit.SECONDS);  
	  
	    Thread.sleep(10000);  
	} 

	//æµ‹è¯•submitæ–¹æ³•  
	@Test  
	public void testSubmit() throws ExecutionException, InterruptedException {  
	    ExecutorService singleThreadExecutor = Executors.newSingleThreadExecutor();  
	  
	    Future<String> future = singleThreadExecutor.submit(() -> {  
	        System.out.println(Thread.currentThread().getName() + ":" + 2);  
	        return "test submit success!";  
	    });  
	  
	    while(!future.isDone()){  
	        System.out.println("callable is not done yet ...");  
	    }  
	    String s = future.get();  
	    System.out.println(s);  
	}
	
	//æµ‹è¯•getQueueæ–¹æ³•å’Œshutdownç­‰æ–¹æ³•  
	@Test  
	public void testGetQueue() throws InterruptedException {  
	    ThreadPoolExecutor fixedThreadPool =  
	            (ThreadPoolExecutor) Executors.newFixedThreadPool(1);  
	    for (long i = 0; i < 10; i++) {  
	        final long index = i;  
	        fixedThreadPool.execute(()->{  
	            try {  
	                System.out.println(Thread.currentThread().getName() + ":" + index);  
	                Thread.sleep(2000);  
	            } catch (InterruptedException e) {  
	                System.out.println(e.getMessage());  
	            }  
	        });  
	    }  
	    //è·å–çº¿ç¨‹æ± ä¸­çš„é˜»å¡é˜Ÿåˆ—  
	    System.out.println(fixedThreadPool.getQueue().size());  
	    //è·å–å½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡  
	    System.out.println(fixedThreadPool.getPoolSize());  
	    //å½“å‰çº¿ç¨‹æ± ä¸­æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ•°é‡  
	    System.out.println(fixedThreadPool.getActiveCount());  
	    //å…³é—­çº¿ç¨‹æ± ï¼Œéœ€è¦ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œ  
	    fixedThreadPool.shutdown();  
	}
}
```

### 4.3 çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥

- çº¿ç¨‹æ± å¯¹æ‹’ç»ä»»åŠ¡çš„å¤„ç†ç­–ç•¥ã€‚åœ¨Â ThreadPoolExecutorÂ é‡Œé¢å®šä¹‰äº†Â 4Â ç§Â handlerÂ ç­–ç•¥ï¼Œåˆ†åˆ«æ˜¯

	a)Â `CallerRunsPolicy`Â :åœ¨è°ƒç”¨è€…çº¿ç¨‹ä¸­è¿è¡Œå½“å‰è¢«ä¸¢å¼ƒçš„ä»»åŠ¡ï¼Œå¦‚ç»™ä¸»çº¿ç¨‹è¿è¡Œã€‚

	b)Â `AbortPolicy`Â ï¼šå¯¹æ‹’ç»ä»»åŠ¡æŠ›å¼ƒå¤„ç†ï¼Œå¹¶ä¸”æŠ›å‡ºå¼‚å¸¸ ã€‚

	c)Â `DiscardPolicy`Â ï¼šå¯¹æ‹’ç»ä»»åŠ¡ç›´æ¥æ— å£°æŠ›å¼ƒï¼Œæ²¡æœ‰å¼‚å¸¸ä¿¡æ¯ã€‚

	d)Â `DiscardOldestPolicy`Â ï¼šå¯¹æ‹’ç»ä»»åŠ¡ä¸æŠ›å¼ƒï¼Œè€Œæ˜¯æŠ›å¼ƒé˜Ÿåˆ—é‡Œé¢ç­‰å¾…æœ€ä¹…ï¼ˆæœ€å‰ï¼‰çš„ä¸€ä¸ªä»»åŠ¡ï¼Œç„¶åæŠŠæ‹’ç»ä»»åŠ¡åŠ åˆ°é˜Ÿåˆ—ã€‚

ä»£ç æ¼”ç¤ºä¸Šè¿°å››ç§æ‹’ç»ç­–ç•¥ï¼š

```java
public class MyRunnable implements Runnable {  
    private String name;  
  
    public MyRunnable(String name) {  
        this.name = name;  
    }  
  
    @Override  
    public void run() {  
        try {  
            System.out.println(this.name + " is running.");  
            Thread.sleep(100);  
        } catch (Exception e) {  
            e.printStackTrace();  
        }  
    }  
}
```

```java
public class CallerRunsPolicyDemo {  
    public static void main(String[] args) {  
        //åˆ›å»ºçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„æœ€å¤§æ± å’Œæ ¸å¿ƒæ± æ•°é‡éƒ½ä¸º1ï¼Œçº¿ç¨‹æ± çš„é˜»å¡ç‹¬ç«‹é¢å®¹é‡ä¸º1  
        ThreadPoolExecutor pool = new ThreadPoolExecutor(1, 1  
                ,0, TimeUnit.SECONDS  
                , new ArrayBlockingQueue<Runnable>(1));  
  
        //è®¾ç½®çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä¸º"CallerRunsPolicy",æ‹’ç»çš„ä»»åŠ¡ç»™ä¸»çº¿ç¨‹è¿è¡Œ  
        pool.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());  
  
        //æ–°å»º10ä¸ªä»»åŠ¡ï¼Œå°†TMæ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­  
        for (int i = 0; i < 10; i++) {  
            MyRunnable myRunnable = new MyRunnable("ä»»åŠ¡"+i);  
            pool.execute(myRunnable);  
        }  
  
        //å…³é—­çº¿ç¨‹æ±   
        pool.shutdown();  
    }  
}
```

```java
public class AbortPolicyDemo {  
  
    public static void main(String[] args) throws Exception {  
  
        // åˆ›å»ºçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„"æœ€å¤§æ± å¤§å°"å’Œ"æ ¸å¿ƒæ± å¤§å°"éƒ½ä¸º1ï¼Œ"çº¿ç¨‹æ± "çš„é˜»å¡é˜Ÿåˆ—å®¹é‡ä¸º1  
        ThreadPoolExecutor pool = new ThreadPoolExecutor(1, 1, 0, TimeUnit.SECONDS,  
                new ArrayBlockingQueue<Runnable>(1));  
        // è®¾ç½®çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä¸º"æŠ›å‡ºå¼‚å¸¸"  
        pool.setRejectedExecutionHandler(new ThreadPoolExecutor.AbortPolicy());  
        // æ–°å»º10ä¸ªä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ã€‚  
        for (int i = 0; i < 10; i++) {  
            MyRunnable myRunnable = new MyRunnable("ä»»åŠ¡"+i);  
            pool.execute(myRunnable);  
        }  
        pool.shutdown();  
    }  
}
```

```java
public class DiscardPolicyDemo {  
  
  
    public static void main(String[] args) throws Exception {  
  
        // åˆ›å»ºçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„"æœ€å¤§æ± å¤§å°"å’Œ"æ ¸å¿ƒæ± å¤§å°"éƒ½ä¸º1ï¼Œ"çº¿ç¨‹æ± "çš„é˜»å¡é˜Ÿåˆ—å®¹é‡ä¸º1  
        ThreadPoolExecutor pool = new ThreadPoolExecutor(1, 1, 0, TimeUnit.SECONDS,  
                new ArrayBlockingQueue<Runnable>(1));  
        // è®¾ç½®çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä¸º"ä¸¢å¼ƒ"  
        pool.setRejectedExecutionHandler(new ThreadPoolExecutor.DiscardPolicy());  
  
        // æ–°å»º10ä¸ªä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ã€‚  
        for (int i = 0; i < 10; i++) {  
            MyRunnable myRunnable = new MyRunnable("ä»»åŠ¡"+i);  
            pool.execute(myRunnable);  
        }  
        // å…³é—­çº¿ç¨‹æ±   
        pool.shutdown();  
    }  
}
```

```java
public class DiscardOldestPolicyDemo {  
    public static void main(String[] args) throws Exception {  
  
        // åˆ›å»ºçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„"æœ€å¤§æ± å¤§å°"å’Œ"æ ¸å¿ƒæ± å¤§å°"éƒ½ä¸º1ï¼Œ"çº¿ç¨‹æ± "çš„é˜»å¡é˜Ÿåˆ—å®¹é‡ä¸º1  
        ThreadPoolExecutor pool = new ThreadPoolExecutor(1, 1, 0, TimeUnit.SECONDS,  
                new ArrayBlockingQueue<Runnable>(1));  
        // è®¾ç½®çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä¸º"ä¸¢å¼ƒ"  
        pool.setRejectedExecutionHandler(new ThreadPoolExecutor.DiscardOldestPolicy());  
  
        // æ–°å»º10ä¸ªä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ã€‚  
        for (int i = 0; i < 10; i++) {  
            MyRunnable myRunnable = new MyRunnable("ä»»åŠ¡"+i);  
            pool.execute(myRunnable);  
        }  
        // å…³é—­çº¿ç¨‹æ±   
        pool.shutdown();  
    }  
}
```

é™¤äº†ä¸Šè¿°çš„å››ç§æ‹’ç»ç­–ç•¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥

å¦‚ï¼šè‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼Œå½“è§¦å‘æ‹’ç»ç­–ç•¥æ—¶ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œä¸€ç›´åˆ°é˜Ÿåˆ—æœ‰ç©ºä½™ä½ç½®æ—¶

```java
public class MyRejectionHandler implements RejectedExecutionHandler {  
  
    @Override  
    public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {  
        System.out.println(r.toString() + "è¢«æ‹’ç»äº†ï¼Œé˜»å¡ä¸»çº¿ç¨‹");  
        try {  
            executor.getQueue().put(r);  
        } catch (InterruptedException e) {  
            e.printStackTrace();  
        }  
    }  
}

public class MyRejection {  
    public static void main(String[] args) throws Exception {  
  
        // åˆ›å»ºçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„"æœ€å¤§æ± å¤§å°"å’Œ"æ ¸å¿ƒæ± å¤§å°"éƒ½ä¸º1ï¼Œ"çº¿ç¨‹æ± "çš„é˜»å¡é˜Ÿåˆ—å®¹é‡ä¸º1  
        ThreadPoolExecutor pool = new ThreadPoolExecutor(1, 1, 0, TimeUnit.SECONDS,  
                new ArrayBlockingQueue<Runnable>(1));  
        // è®¾ç½®çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä¸ºè‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥  
        pool.setRejectedExecutionHandler(new MyRejectionHandler());  
  
        // æ–°å»º10ä¸ªä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ã€‚  
        for (int i = 0; i < 10; i++) {  
            MyRunnable myRunnable = new MyRunnable("ä»»åŠ¡"+i);  
            pool.execute(myRunnable);  
        }  
        // å…³é—­çº¿ç¨‹æ±   
        pool.shutdown();  
    }  
}
```

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/4bcf91b5fee99e7a4c81b2d59d92cc2e.png)

è¿™é‡Œæ˜¯åˆ©ç”¨äº†`é˜»å¡é˜Ÿåˆ—çš„putæ“ä½œåœ¨é˜Ÿåˆ—æ»¡æ—¶ä¼šé˜»å¡`ã€‚

### 4.4 è‡ªå®šä¹‰çº¿ç¨‹å·¥å‚

`å®ç°ThreadFactoryæ¥å£ï¼Œé‡å†™newThread()æ–¹æ³•`

Executorså·¥å…·ç±»ï¼Œåˆ›å»ºçº¿ç¨‹æ± çš„æœ¬è´¨æ˜¯å…¶æœ¬èº«çš„DefaultThreadFactoryé™æ€å†…éƒ¨ç±»![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/84e5f3c51b5d6322efb6e6cafcaa345b.png)

æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå’Œä¸€æ ·çš„ç±»å³å¯

æ¡ˆä¾‹ï¼šæ¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œæ§åˆ¶å°æ‰“å°ï¼šæœ‰æ–°çº¿ç¨‹åˆ›å»ºäº†

```java
public class MyThreadFactory implements ThreadFactory {  
  
    private static final AtomicInteger poolNumber = new AtomicInteger(1);  
    private final ThreadGroup group;  
    private final AtomicInteger threadNumber = new AtomicInteger(1);  
    private final String namePrefix;  
  
    MyThreadFactory() {  
        SecurityManager s = System.getSecurityManager();  
        group = (s != null) ? s.getThreadGroup() :  
                Thread.currentThread().getThreadGroup();  
        namePrefix = "pool-" +  
                poolNumber.getAndIncrement() +  
                "-thread-";  
    }  
  
    public Thread newThread(Runnable r) {  
        Thread t = new Thread(group, r,  
                namePrefix + threadNumber.getAndIncrement(),  
                0);  
        System.out.println("æœ‰æ–°çº¿ç¨‹åˆ›å»ºäº†");  
        if (t.isDaemon())  
            t.setDaemon(false);  
        if (t.getPriority() != Thread.NORM_PRIORITY)  
            t.setPriority(Thread.NORM_PRIORITY);  
        return t;  
    }  
}
```

æµ‹è¯•
```java
public class TestMyThreadFactory {  
    public static void main(String[] args) {  
        MyThreadFactory threadFactory = new MyThreadFactory();  
        threadFactory.newThread(()->{  
            System.out.println("runnable is run ...");  
        }).start();  
    }  
}
```

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fbb0755b015d80b9cbb8208fde83d75f.png)

### 4.5 åˆç†è®¾ç½®çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°

æ²¡æœ‰å›ºå®šç­”æ¡ˆï¼

ä¸€èˆ¬æ¥è¯´ï¼š`CPUå¯†é›†å‹ä»»åŠ¡`åº”é…ç½®å°½å¯èƒ½å°çš„çº¿ç¨‹ï¼Œå¦‚é…ç½®`Ncpu+1`ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚ç”±äº`IOå¯†é›†å‹`ä»»åŠ¡çº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™åº”é…ç½®å°½å¯èƒ½å¤šçš„çº¿ç¨‹ï¼Œå¦‚`2*Ncpu`

cpu > å†…å­˜ > ç¡¬ç›˜

IOå¯†é›†å‹ï¼šæ“ä½œç¡¬ç›˜æ¯”è¾ƒå¤š
CPUå¯†é›†å‹ï¼šæ“ä½œCPUæ¯”è¾ƒå¤š

å¯ä¾›å‚è€ƒçš„å…¬å¼å¦‚ä¸‹ï¼š

`Nthreads=Ncpu*Ucpu*(1+WC)`

- ä¸Šå¼å„å˜é‡çš„å«ä¹‰ï¼š

	Nthreadsï¼šçº¿ç¨‹æ•°

	Ncpuï¼šCPUæ ¸å¿ƒæ•°

	`Ucpuï¼šç›®æ ‡CPUåˆ©ç”¨ç‡`

	WCï¼šç­‰å¾…æ—¶é—´å’Œè®¡ç®—æ—¶é—´çš„æ¯”ä¾‹Â Â Â Â Â 

æœ€å¥½ä»¥é¡¹ç›®å®é™…æƒ…å†µä¸ºä¸»ï¼Œ`å…ˆè®¾å®šé¢„æœŸ`ï¼Œæ¯”å¦‚æˆ‘æœŸæœ›çš„CPUåˆ©ç”¨ç‡æ˜¯å¤šå°‘ï¼Œè´Ÿè½½æ˜¯å¤šå°‘ï¼ˆå•ä½æ—¶é—´ç­‰å¾…ä»»åŠ¡çš„æ•°é‡ï¼‰ï¼ŒGCé¢‘ç‡å¤šå°‘ä¹‹ç±»çš„æŒ‡æ ‡åï¼Œå†`é€šè¿‡æµ‹è¯•ä¸æ–­çš„è°ƒæ•´åˆ°ä¸€ä¸ªåˆç†çš„çº¿ç¨‹æ•°`ã€‚