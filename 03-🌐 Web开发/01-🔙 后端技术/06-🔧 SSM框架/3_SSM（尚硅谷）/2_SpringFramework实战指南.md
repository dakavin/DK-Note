---
æ–‡ç« æ ‡é¢˜: "[[2_SpringFrameworkå®æˆ˜æŒ‡å—]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  è¯¦ç»†ä»‹ç»Spring Frameworkæ ¸å¿ƒæŠ€æœ¯ï¼ŒåŒ…æ‹¬IoCå®¹å™¨ç®¡ç†ã€ä¾èµ–æ³¨å…¥ã€AOPé¢å‘åˆ‡é¢ç¼–ç¨‹å’Œå£°æ˜å¼äº‹åŠ¡ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°å®é™…åº”ç”¨éƒ½æœ‰æ·±å…¥è®²è§£ã€‚
tags:
- "Spring Framework"
- "IoCå®¹å™¨"
- "ä¾èµ–æ³¨å…¥"
- "AOP"
- "å£°æ˜å¼äº‹åŠ¡"
- "æ³¨è§£é…ç½®"
- "ä¸‰å±‚æ¶æ„"
- "JdbcTemplate"
- "åŠ¨æ€ä»£ç†"
- "äº‹åŠ¡ç®¡ç†"
ç›¸å…³æ–‡ç« :
- "[[19_å‰©ä½™çŸ¥è¯†ç‚¹è¡¥å……]]"
- "[[1_Spring_é…ç½®å¼€å‘]]"
- "[[1_SpringBootäº‹åŠ¡å’ŒMybatisç¼“å­˜]]"
- "[[1_Javaåå°„]]"
- "[[11_åå°„]]"
æ–‡ç« åˆ†ç±»: "ğŸŒ Webå¼€å‘"
æ–‡ç« è·¯å¾„: "03-ğŸŒ Webå¼€å‘/01-ğŸ”™ åç«¯æŠ€æœ¯/06-ğŸ”§ SSMæ¡†æ¶/3_SSMï¼ˆå°šç¡…è°·ï¼‰/2_SpringFrameworkå®æˆ˜æŒ‡å—.md"
æ–‡ç« éš¾åº¦: ä¸­çº§ ğŸŒ³
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­â­ ç²¾é€šå¿…å¤‡
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2025-05-28 00:15:16
---

## 1 æŠ€æœ¯ä½“ç³»ç»“æ„

### 1.1 æ€»ä½“æŠ€æœ¯ä½“ç³»

-   `å•ä¸€æ¶æ„`
    ä¸€ä¸ªé¡¹ç›®ï¼Œä¸€ä¸ªå·¥ç¨‹ï¼Œå¯¼å‡ºä¸ºä¸€ä¸ªwaråŒ…ï¼Œåœ¨ä¸€ä¸ªTomcatä¸Šè¿è¡Œã€‚ä¹Ÿå«all in oneã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0d29b87869ffe88f930010d47bb8dfb1.png)


    å•ä¸€æ¶æ„ï¼Œé¡¹ç›®ä¸»è¦åº”ç”¨æŠ€æœ¯æ¡†æ¶ä¸ºï¼š`Spring` , `SpringMVC` , `Mybatis`

-   `åˆ†å¸ƒå¼æ¶æ„`
    ä¸€ä¸ªé¡¹ç›®ï¼ˆå¯¹åº” IDEA ä¸­çš„ä¸€ä¸ª projectï¼‰ï¼Œæ‹†åˆ†æˆå¾ˆå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—æ˜¯ä¸€ä¸ª IDEA ä¸­çš„ä¸€ä¸ª moduleã€‚æ¯ä¸€ä¸ªå·¥ç¨‹éƒ½æ˜¯è¿è¡Œåœ¨è‡ªå·±çš„ Tomcat ä¸Šã€‚æ¨¡å—ä¹‹é—´å¯ä»¥äº’ç›¸è°ƒç”¨ã€‚æ¯ä¸€ä¸ªæ¨¡å—å†…éƒ¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå•ä¸€æ¶æ„çš„åº”ç”¨ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fa9048c3bc59727e9f1cf8c931f41962.png)


    åˆ†å¸ƒå¼æ¶æ„ï¼Œé¡¹ç›®ä¸»è¦åº”ç”¨æŠ€æœ¯æ¡†æ¶ï¼š`SpringBoot` (SSM), `SpringCloud` , `ä¸­é—´ä»¶ç­‰`

### 1.2 æ¡†æ¶æ¦‚å¿µå’Œç†è§£

æ¡†æ¶( Framework )æ˜¯ä¸€ä¸ªé›†æˆäº†åŸºæœ¬ç»“æ„ã€è§„èŒƒã€è®¾è®¡æ¨¡å¼ã€ç¼–ç¨‹è¯­è¨€å’Œç¨‹åºåº“ç­‰åŸºç¡€ç»„ä»¶çš„è½¯ä»¶ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨æ¥æ„å»ºæ›´é«˜çº§åˆ«çš„åº”ç”¨ç¨‹åºã€‚æ¡†æ¶çš„è®¾è®¡å’Œå®ç°æ—¨åœ¨è§£å†³ç‰¹å®šé¢†åŸŸä¸­çš„å¸¸è§é—®é¢˜ï¼Œ`å¸®åŠ©å¼€å‘äººå‘˜æ›´é«˜æ•ˆã€æ›´ç¨³å®šåœ°å®ç°è½¯ä»¶å¼€å‘ç›®æ ‡`ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c4139da4a4dbe658400907972c00d9c7.png)



`æ¡†æ¶çš„ä¼˜ç‚¹`åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š

1.  `æé«˜å¼€å‘æ•ˆç‡`ï¼šæ¡†æ¶æä¾›äº†è®¸å¤šé¢„å…ˆè®¾è®¡å¥½äº†çš„ç»„ä»¶å’Œå·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿè¿›è¡Œå¼€å‘ã€‚ç›¸è¾ƒäºä¼ ç»Ÿæ‰‹å†™ä»£ç ï¼Œåœ¨æ¡†æ¶æä¾›çš„è§„èŒƒåŒ–ç¯å¢ƒä¸­ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¿«åœ°å®ç°é¡¹ç›®çš„å„ç§è¦æ±‚ã€‚
2.  `é™ä½å¼€å‘æˆæœ¬`ï¼šæ¡†æ¶çš„æä¾›æ ‡å‡†åŒ–çš„ç¼–ç¨‹è¯­è¨€ã€æ•°æ®æ“ä½œç­‰ä»£ç ç‰‡æ®µï¼Œé¿å…äº†é‡å¤å¼€å‘çš„é—®é¢˜ï¼Œé™ä½äº†å¼€å‘æˆæœ¬ï¼Œæä¾›æ·±åº¦ä¼˜åŒ–çš„ç³»ç»Ÿï¼Œé™ä½äº†ç»´æŠ¤æˆæœ¬ï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„å¯é æ€§ã€‚
3.  `æé«˜åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§`ï¼šæ¡†æ¶é€šå¸¸ç»è¿‡äº†å¾ˆé•¿æ—¶é—´çš„å¼€å‘å’Œæµ‹è¯•ï¼Œå…¶ä¸­çš„è®¸å¤šç»„ä»¶ã€ä»£ç ç‰‡æ®µå’Œè®¾è®¡æ¨¡å¼éƒ½å¾—åˆ°äº†éªŒè¯ã€‚é‡å¤åˆ©ç”¨è¿™äº›ç»„ä»¶æœ‰åŠ©äºå‡å°‘bugçš„å‡ºç°ï¼Œä»è€Œæé«˜äº†åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§ã€‚
4.  `æä¾›æ ‡å‡†åŒ–çš„è§£å†³æ–¹æ¡ˆ`ï¼šæ¡†æ¶é€šå¸¸æ˜¯é’ˆå¯¹æŸä¸ªç‰¹å®šé¢†åŸŸçš„ï¼Œé€šè¿‡æä¾›æ ‡å‡†åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ä¸ºå¼€å‘äººå‘˜æä¾›ä¸€ç§å…±åŒçš„è¯­è¨€å’Œæ€æƒ³åŸºç¡€ï¼Œæœ‰åŠ©äºæ›´å¥½åœ°æ²Ÿé€šå’Œåä½œã€‚

`æ¡†æ¶çš„ç¼ºç‚¹`åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  `å­¦ä¹ æˆæœ¬é«˜`ï¼šæ¡†æ¶é€šå¸¸å…·æœ‰ç‰¹å®šçš„è¯­è¨€å’Œç¼–ç¨‹èŒƒå¼ã€‚å¯¹äºå¼€å‘äººå‘˜è€Œè¨€ï¼Œéœ€è¦èŠ±è´¹æ—¶é—´å­¦ä¹ å…¶èƒŒåçš„æ¶æ„ã€æ¨¡å¼å’Œé€»è¾‘ï¼Œè¿™å¯¹äºæ–°æ‰‹è€Œè¨€å¯èƒ½ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ã€‚
2.  `å¯èƒ½å­˜åœ¨å±€é™æ€§`ï¼šè™½ç„¶æ¡†æ¶æé«˜äº†å¼€å‘æ•ˆç‡å¹¶å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜è§£å†³å¸¸è§é—®é¢˜ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç‰¹å®šçš„åº”ç”¨éœ€æ±‚å¯èƒ½è¶…å‡ºæ¡†æ¶çš„èŒƒå›´ï¼Œä»è€Œå¯¼è‡´åº”ç”¨ç¨‹åºæ— æ³•æ»¡è¶³è¦æ±‚ã€‚å¼€å‘äººå‘˜å¯èƒ½éœ€è¦æ›´å¤šçš„æ§åˆ¶æƒå’Œè‡ªç”±åº¦ï¼ŒåŒæ—¶éœ€è¦åœ¨æ¡†æ¶å’Œåº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œæƒè¡¡å–èˆã€‚
3.  `ç‰ˆæœ¬å˜æ›´å’Œå…¼å®¹æ€§é—®é¢˜`ï¼šæ¡†æ¶çš„ç‰ˆæœ¬å‘å¸ƒå’Œè¿­ä»£é€šå¸¸ä¼šå¯¼è‡´ä»£ç åº“çš„å¤§è§„æ¨¡å˜æ›´ï¼Œè¿›è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå‡ºç°å…¼å®¹æ€§é—®é¢˜å’Œæ¼æ´ã€‚å½“æ¡†æ¶å˜æ›´æ—¶ï¼Œéœ€è¦è€ƒè™‘æ¡†æ¶æ˜¯å¦å‘ä¸‹å…¼å®¹ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œé€‚å½“çš„æµ‹è¯•ã€è¿ç§»å’Œå‡çº§ã€‚
4.  `æ¶æ„é£é™©`ï¼šæ¡†æ¶æ¶‰åŠåˆ°å¾ˆå¤šæŠ½è±¡å’Œæ¦‚å¿µï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰è¶³å¤Ÿçš„ç†è§£å’ŒæŒæ¡å…¶æ¶æ„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå‡ºç°è®¾è®¡å’Œæ¶æ„ç¼ºé™·ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„å¥åº·æ€§å’Œå®‰å…¨æ€§ã€‚

ç«™åœ¨æ–‡ä»¶ç»“æ„çš„è§’åº¦ç†è§£æ¡†æ¶ï¼Œå¯ä»¥å°†æ¡†æ¶æ€»ç»“ï¼š**æ¡†æ¶ = jaråŒ…+é…ç½®æ–‡ä»¶**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/e7c31ed6859b153c099a1ad921074452.png)


èå£«æ¯”äºšè¯´,"ä¸€åƒä¸ªè§‚ä¼—çœ¼ä¸­æœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹" å³ä»è€…è§ä»,æ™ºè€…è§æ™º.è¯´æ¯ä¸ªäººéƒ½ä¼šå¯¹ä½œå“æœ‰ä¸åŒçš„ç†è§£ï¼Œæ¯ä¸ªäººå¯¹å¾…ä»»ä½•äº‹ç‰©éƒ½æœ‰è‡ªå·±çš„çœ‹æ³•ï¼ŒåŒæ ·çš„æŠ€æœ¯è§£å†³åŒæ ·çš„é—®é¢˜ä¼šäº§ç”Ÿä¸åŒæµç¨‹å’Œé£æ ¼çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œé‡‡ç”¨ä¸€ç§æ¡†æ¶å…¶å®å°±æ˜¯é™åˆ¶ç”¨æˆ·å¿…é¡»ä½¿ç”¨å…¶è§„å®šçš„æ–¹æ¡ˆæ¥å®ç°ï¼Œå¯ä»¥é™ä½ç¨‹åºå‘˜ä¹‹é—´æ²Ÿé€šä»¥åŠæ—¥åç»´æŠ¤çš„æˆæœ¬ï¼

å¸¸ç”¨çš„å•ä¸€æ¶æ„JavaEEé¡¹ç›®æ¡†æ¶æ¼”è¿›ï¼Œä»SSHã€SSH2è¿‡æ¸¡åˆ°äº†`SSMï¼šSpringMVCã€Springã€MyBatis`ã€‚

æ€»ä¹‹ï¼Œæ¡†æ¶å·²ç»å¯¹åŸºç¡€çš„ä»£ç è¿›è¡Œäº†å°è£…å¹¶æä¾›ç›¸åº”çš„APIï¼Œå¼€å‘è€…åœ¨ä½¿ç”¨æ¡†æ¶æ˜¯ç›´æ¥è°ƒç”¨å°è£…å¥½çš„APIå¯ä»¥çœå»å¾ˆå¤šä»£ç ç¼–å†™ï¼Œä»è€Œæé«˜å·¥ä½œæ•ˆç‡å’Œå¼€å‘é€Ÿåº¦ã€‚

## 2 SpringFrameworkä»‹ç»

### 2.1 Spring å’Œ SpringFrameworkæ¦‚å¿µ

<https://spring.io/projects>

`å¹¿ä¹‰çš„ Springï¼šSpring æŠ€æœ¯æ ˆ`ï¼ˆå…¨å®¶æ¡¶ï¼‰

å¹¿ä¹‰ä¸Šçš„ Spring `æ³›æŒ‡ä»¥ Spring Framework ä¸ºåŸºç¡€çš„ Spring æŠ€æœ¯æ ˆ`ã€‚

ç»è¿‡åå¤šå¹´çš„å‘å±•ï¼ŒSpring å·²ç»ä¸å†æ˜¯ä¸€ä¸ªå•çº¯çš„åº”ç”¨æ¡†æ¶ï¼Œè€Œæ˜¯é€æ¸å‘å±•æˆä¸ºä¸€ä¸ªç”±å¤šä¸ªä¸åŒå­é¡¹ç›®ï¼ˆæ¨¡å—ï¼‰ç»„æˆçš„æˆç†ŸæŠ€æœ¯ï¼Œä¾‹å¦‚ Spring Frameworkã€Spring MVCã€SpringBootã€Spring Cloudã€Spring Dataã€Spring Security ç­‰ï¼Œå…¶ä¸­ Spring Framework æ˜¯å…¶ä»–å­é¡¹ç›®çš„åŸºç¡€ã€‚

è¿™äº›å­é¡¹ç›®æ¶µç›–äº†ä»ä¼ä¸šçº§åº”ç”¨å¼€å‘åˆ°äº‘è®¡ç®—ç­‰å„æ–¹é¢çš„å†…å®¹ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜è§£å†³è½¯ä»¶å‘å±•è¿‡ç¨‹ä¸­ä¸æ–­äº§ç”Ÿçš„å„ç§å®é™…é—®é¢˜ï¼Œç»™å¼€å‘äººå‘˜å¸¦æ¥äº†æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚

`ç‹­ä¹‰çš„ Springï¼šSpring Framework`ï¼ˆåŸºç¡€æ¡†æ¶ï¼‰

ç‹­ä¹‰çš„ Spring `ç‰¹æŒ‡ Spring Frameworkï¼Œé€šå¸¸æˆ‘ä»¬å°†å®ƒç§°ä¸º Spring æ¡†æ¶`ã€‚

Spring Frameworkï¼ˆSpringæ¡†æ¶ï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œç”±SpringSourceå…¬å¸å¼€å‘ï¼Œæœ€åˆæ˜¯ä¸ºäº†è§£å†³ä¼ä¸šçº§å¼€å‘ä¸­å„ç§å¸¸è§é—®é¢˜è€Œåˆ›å»ºçš„ã€‚å®ƒæä¾›äº†å¾ˆå¤šåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰ã€é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ã€å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼ˆTXï¼‰ç­‰ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯ä½¿ä¼ä¸šçº§åº”ç”¨ç¨‹åºçš„å¼€å‘å˜å¾—æ›´åŠ ç®€å•å’Œå¿«é€Ÿï¼Œå¹¶ä¸”Springæ¡†æ¶è¢«å¹¿æ³›åº”ç”¨äºJavaä¼ä¸šå¼€å‘é¢†åŸŸã€‚

Springå…¨å®¶æ¡¶çš„å…¶ä»–æ¡†æ¶éƒ½æ˜¯ä»¥SpringFrameworkæ¡†æ¶ä¸ºåŸºç¡€ï¼

`å¯¹æ¯”ç†è§£ï¼š`

QQ å’Œ è…¾è®¯

è…¾è®¯ = Spring

QQ = SpringFramework

### 2.2 SpringFrameworkä¸»è¦åŠŸèƒ½æ¨¡å—

SpringFrameworkæ¡†æ¶ç»“æ„å›¾ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fa8026fabc65c03ebb186424fad275b4.png)



| åŠŸèƒ½æ¨¡å—           | åŠŸèƒ½ä»‹ç»                                 |
| -------------- | ------------------------------------ |
| Core Container | æ ¸å¿ƒå®¹å™¨ï¼Œåœ¨ Spring ç¯å¢ƒä¸‹ä½¿ç”¨ä»»ä½•åŠŸèƒ½éƒ½å¿…é¡»åŸºäº IOC å®¹å™¨ã€‚ |
| AOP\&Aspects   | é¢å‘åˆ‡é¢ç¼–ç¨‹                               |
| TX             | å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚                             |
| Spring MVC     | æä¾›äº†é¢å‘Webåº”ç”¨ç¨‹åºçš„é›†æˆåŠŸèƒ½ã€‚                   |

### 2.3 SpringFramework ä¸»è¦ä¼˜åŠ¿

1.  `ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿ`ï¼šSpring ç”Ÿæ€ç³»ç»Ÿéå¸¸ä¸°å¯Œï¼Œæ”¯æŒè®¸å¤šæ¨¡å—å’Œåº“ï¼Œå¦‚ Spring Bootã€Spring Securityã€Spring Cloud ç­‰ç­‰ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿæ„å»ºé«˜å¯é æ€§çš„ä¼ä¸šåº”ç”¨ç¨‹åºã€‚
2.  `æ¨¡å—åŒ–çš„è®¾è®¡`ï¼šæ¡†æ¶ç»„ä»¶ä¹‹é—´çš„æ¾æ•£è€¦åˆå’Œæ¨¡å—åŒ–è®¾è®¡ä½¿å¾— Spring Framework å…·æœ‰è‰¯å¥½çš„å¯é‡ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°é€‰æ‹©è‡ªå·±éœ€è¦çš„æ¨¡å—ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå¼€å‘ã€‚
3.  `ç®€åŒ– Java å¼€å‘`ï¼šSpring Framework ç®€åŒ–äº† Java å¼€å‘ï¼Œæä¾›äº†å„ç§å·¥å…·å’Œ APIï¼Œå¯ä»¥é™ä½å¼€å‘å¤æ‚åº¦å’Œå­¦ä¹ æˆæœ¬ã€‚åŒæ—¶ï¼ŒSpring Framework æ”¯æŒå„ç§åº”ç”¨åœºæ™¯ï¼ŒåŒ…æ‹¬ Web åº”ç”¨ç¨‹åºã€RESTful APIã€æ¶ˆæ¯ä¼ é€’ã€æ‰¹å¤„ç†ç­‰ç­‰ã€‚
4.  `ä¸æ–­åˆ›æ–°å’Œå‘å±•`ï¼šSpring Framework å¼€å‘å›¢é˜Ÿä¸€ç›´åœ¨ä¸æ–­åˆ›æ–°å’Œå‘å±•ï¼Œä¿æŒä¸æœ€æ–°æŠ€æœ¯çš„æ¥è½¨ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›æ›´åŠ å…ˆè¿›å’Œä¼˜ç§€çš„å·¥å…·å’Œæ¡†æ¶ã€‚

å› æ­¤ï¼Œè¿™äº›ä¼˜ç‚¹ä½¿å¾— Spring Framework æˆä¸ºäº†ä¸€ä¸ªç¨³å®šã€å¯é ã€ä¸”åˆ›æ–°çš„æ¡†æ¶ï¼Œä¸ºä¼ä¸šçº§ Java å¼€å‘æä¾›äº†ä¸€ç«™å¼çš„è§£å†³æ–¹æ¡ˆã€‚

Spring ä½¿åˆ›å»º Java ä¼ä¸šåº”ç”¨ç¨‹åºå˜å¾—å®¹æ˜“ã€‚å®ƒæä¾›äº†åœ¨ä¼ä¸šç¯å¢ƒä¸­é‡‡ç”¨ Java è¯­è¨€æ‰€éœ€çš„ä¸€åˆ‡ï¼Œæ”¯æŒ Groovy å’Œ Kotlin ä½œä¸º JVM ä¸Šçš„æ›¿ä»£è¯­è¨€ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€æ±‚çµæ´»åœ°åˆ›å»ºå¤šç§æ¶æ„ã€‚`ä»Spring Framework 6.0.6å¼€å§‹ï¼ŒSpring éœ€è¦ Java 17+`ã€‚

## 3 Spring IoCå®¹å™¨å’Œæ ¸å¿ƒæ¦‚å¿µ

### 3.1 ç»„ä»¶å’Œç»„ä»¶ç®¡ç†æ¦‚å¿µ

#### 3.1.1 ä»€ä¹ˆæ˜¯ç»„ä»¶?

å›é¡¾å¸¸è§„çš„ä¸‰å±‚æ¶æ„å¤„ç†è¯·æ±‚æµç¨‹ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c61820bc90e2c7097ad8c921e3b1dc31.png)


`æ•´ä¸ªé¡¹ç›®å°±æ˜¯ç”±å„ç§ç»„ä»¶æ­å»ºè€Œæˆçš„`ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fbfc73e8e3ff4e57d9f3447295c13c77.png)


#### 3.1.2 æˆ‘ä»¬çš„æœŸå¾…

-   æœ‰äººæ›¿æˆ‘ä»¬åˆ›å»ºç»„ä»¶çš„å¯¹è±¡
-   æœ‰äººå¸®æˆ‘ä»¬ä¿å­˜ç»„ä»¶çš„å¯¹è±¡
-   æœ‰äººå¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ç»„è£…
-   æœ‰äººæ›¿æˆ‘ä»¬ç®¡ç†äº‹åŠ¡
-   æœ‰äººååŠ©æˆ‘ä»¬æ•´åˆå…¶ä»–æ¡†æ¶
-   ......
#### 3.1.3 Springå……å½“ç»„ä»¶ç®¡ç†è§’è‰²ï¼ˆIoCï¼‰

é‚£ä¹ˆè°å¸®æˆ‘ä»¬å®Œæˆæˆ‘ä»¬çš„æœŸå¾…ï¼Œå¸®æˆ‘ä»¬ç®¡ç†ç»„ä»¶å‘¢ï¼Ÿ

å½“ç„¶æ˜¯Spring æ¡†æ¶äº†ï¼

`ç»„ä»¶å¯ä»¥å®Œå…¨äº¤ç»™Spring æ¡†æ¶è¿›è¡Œç®¡ç†`ï¼ŒSpringæ¡†æ¶æ›¿ä»£äº†ç¨‹åºå‘˜åŸæœ‰çš„newå¯¹è±¡å’Œå¯¹è±¡å±æ€§èµ‹å€¼åŠ¨ä½œç­‰ï¼

Springå…·ä½“çš„ç»„ä»¶ç®¡ç†åŠ¨ä½œåŒ…å«ï¼š
-   ç»„ä»¶å¯¹è±¡å®ä¾‹åŒ–
-   ç»„ä»¶å±æ€§å±æ€§èµ‹å€¼
-   ç»„ä»¶å¯¹è±¡ä¹‹é—´å¼•ç”¨
-   ç»„ä»¶å¯¹è±¡å­˜æ´»å‘¨æœŸç®¡ç†
-   ......
	æˆ‘ä»¬åªéœ€è¦ç¼–å†™å…ƒæ•°æ®ï¼ˆé…ç½®æ–‡ä»¶ï¼‰å‘ŠçŸ¥Spring ç®¡ç†å“ªäº›ç±»ç»„ä»¶å’Œä»–ä»¬çš„å…³ç³»å³å¯ï¼
	
æ³¨æ„ï¼šç»„ä»¶æ˜¯æ˜ å°„åˆ°åº”ç”¨ç¨‹åºä¸­æ‰€æœ‰å¯é‡ç”¨ç»„ä»¶çš„Javaå¯¹è±¡ï¼Œåº”è¯¥æ˜¯å¯å¤ç”¨çš„åŠŸèƒ½å¯¹è±¡ï¼
-   `ç»„ä»¶ä¸€å®šæ˜¯å¯¹è±¡`
-   `å¯¹è±¡ä¸ä¸€å®šæ˜¯ç»„ä»¶`
	ç»¼ä¸Šæ‰€è¿°ï¼ŒSpring å……å½“ä¸€ä¸ªç»„ä»¶å®¹å™¨ï¼Œåˆ›å»ºã€ç®¡ç†ã€å­˜å‚¨ç»„ä»¶ï¼Œå‡å°‘äº†æˆ‘ä»¬çš„ç¼–ç å‹åŠ›ï¼Œè®©æˆ‘ä»¬æ›´åŠ ä¸“æ³¨è¿›è¡Œä¸šåŠ¡ç¼–å†™ï¼
#### 3.1.4 ç»„ä»¶äº¤ç»™Springç®¡ç†ä¼˜åŠ¿!

1.  `é™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§`ï¼šSpring IoCå®¹å™¨é€šè¿‡ä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œå°†ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»å‰Šå¼±ï¼Œå‡å°‘äº†ç¨‹åºç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œä½¿å¾—ç»„ä»¶æ›´åŠ æ¾æ•£åœ°è€¦åˆã€‚
2.  `æé«˜äº†ä»£ç çš„å¯é‡ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§`ï¼šå°†ç»„ä»¶çš„å®ä¾‹åŒ–è¿‡ç¨‹ã€ä¾èµ–å…³ç³»çš„ç®¡ç†ç­‰åŠŸèƒ½äº¤ç»™Spring IoCå®¹å™¨å¤„ç†ï¼Œä½¿å¾—ç»„ä»¶ä»£ç æ›´åŠ æ¨¡å—åŒ–ã€å¯é‡ç”¨ã€æ›´æ˜“äºç»´æŠ¤ã€‚
3.  `æ–¹ä¾¿äº†é…ç½®å’Œç®¡ç†`ï¼šSpring IoCå®¹å™¨é€šè¿‡XMLæ–‡ä»¶æˆ–è€…æ³¨è§£ï¼Œè½»æ¾çš„å¯¹ç»„ä»¶è¿›è¡Œé…ç½®å’Œç®¡ç†ï¼Œä½¿å¾—ç»„ä»¶çš„åˆ‡æ¢ã€æ›¿æ¢ç­‰æ“ä½œæ›´åŠ çš„æ–¹ä¾¿å’Œå¿«æ·ã€‚
4.  äº¤ç»™Springç®¡ç†çš„å¯¹è±¡ï¼ˆç»„ä»¶ï¼‰ï¼Œæ–¹å¯äº«å—Springæ¡†æ¶çš„å…¶ä»–åŠŸèƒ½ï¼ˆAOP,å£°æ˜äº‹åŠ¡ç®¡ç†ï¼‰ç­‰

### 3.2 Spring IoCå®¹å™¨å’Œå®¹å™¨å®ç°

#### 3.2.1 æ™®é€šå’Œå¤æ‚å®¹å™¨

**æ™®é€šå®¹å™¨**
ç”Ÿæ´»ä¸­çš„æ™®é€šå®¹å™¨ ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/f0795047f504a159b54c97b9c3704a0b.png)


> æ™®é€šå®¹å™¨åªèƒ½ç”¨æ¥å­˜å‚¨ï¼Œæ²¡æœ‰æ›´å¤šåŠŸèƒ½ã€‚
> ç¨‹åºä¸­çš„æ™®é€šå®¹å™¨
-   æ•°ç»„
-   é›†åˆï¼šList
-   é›†åˆï¼šSet

	**å¤æ‚å®¹å™¨**
ç”Ÿæ´»ä¸­çš„å¤æ‚å®¹å™¨

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/90d659d8e96042e03c749000ac4d87db.png)


> æ”¿åºœç®¡ç†æˆ‘ä»¬çš„ä¸€ç”Ÿï¼Œç”Ÿè€ç—…æ­»éƒ½å’Œæ”¿åºœæœ‰å…³ã€‚
> ç¨‹åºä¸­çš„å¤æ‚å®¹å™¨

- Servlet å®¹å™¨èƒ½å¤Ÿç®¡ç† Servlet(init,service,destroy)ã€Filterã€Listener è¿™æ ·çš„ç»„ä»¶çš„ä¸€ç”Ÿï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªå¤æ‚å®¹å™¨ã€‚

| åç§°                                                                                  | æ—¶æœº                                    | æ¬¡æ•° |
| ----------------------------------------------------------------------------------- | ------------------------------------- | -- |
| åˆ›å»ºå¯¹è±¡                                                                                | é»˜è®¤æƒ…å†µï¼šæ¥æ”¶åˆ°ç¬¬ä¸€æ¬¡è¯·æ±‚ &#xA;ä¿®æ”¹å¯åŠ¨é¡ºåºåï¼šWebåº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­ | ä¸€æ¬¡ |
| åˆå§‹åŒ–æ“ä½œ                                                                               | åˆ›å»ºå¯¹è±¡ä¹‹å                                | ä¸€æ¬¡ |
| å¤„ç†è¯·æ±‚                                                                                | æ¥æ”¶åˆ°è¯·æ±‚                                 | å¤šæ¬¡ |
| é”€æ¯æ“ä½œ                                                                                | Webåº”ç”¨å¸è½½ä¹‹å‰                             | ä¸€æ¬¡ |

æˆ‘ä»¬å³å°†è¦å­¦ä¹ çš„ SpringIoC å®¹å™¨ä¹Ÿæ˜¯ä¸€ä¸ªå¤æ‚å®¹å™¨ã€‚å®ƒä»¬ä¸ä»…è¦è´Ÿè´£åˆ›å»ºç»„ä»¶çš„å¯¹è±¡ã€å­˜å‚¨ç»„ä»¶çš„å¯¹è±¡ï¼Œè¿˜è¦è´Ÿè´£è°ƒç”¨ç»„ä»¶çš„æ–¹æ³•è®©å®ƒä»¬å·¥ä½œï¼Œæœ€ç»ˆåœ¨ç‰¹å®šæƒ…å†µä¸‹é”€æ¯ç»„ä»¶ã€‚

`æ€»ç»“ï¼šSpringç®¡ç†ç»„ä»¶çš„å®¹å™¨ï¼Œå°±æ˜¯ä¸€ä¸ªå¤æ‚å®¹å™¨ï¼Œä¸ä»…å­˜å‚¨ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥ç®¡ç†ç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”åˆ›å»ºå’Œé”€æ¯ç»„ä»¶ç­‰ï¼`

#### 3.2.2 SpringIoCå®¹å™¨ä»‹ç»

Spring IoC å®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£… beanï¼ˆç»„ä»¶ï¼‰ã€‚å®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®æ¥è·å–æœ‰å…³è¦å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…ç»„ä»¶çš„æŒ‡ä»¤ã€‚é…ç½®å…ƒæ•°æ®ä»¥` XML`ã€`Java æ³¨è§£`æˆ– `Java ä»£ç å½¢å¼`è¡¨ç°ã€‚å®ƒå…è®¸è¡¨è¾¾ç»„æˆåº”ç”¨ç¨‹åºçš„ç»„ä»¶ä»¥åŠè¿™äº›ç»„ä»¶ä¹‹é—´ä¸°å¯Œçš„ç›¸äº’ä¾èµ–å…³ç³»ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/91508c6ae5ed25eee740cfc5629a2a76.png)


ä¸Šå›¾æ˜¾ç¤ºäº† Spring å®¹å™¨å·¥ä½œåŸç†çš„é«˜çº§è§†å›¾ã€‚åº”ç”¨ç¨‹åºç±»ä¸é…ç½®å…ƒæ•°æ®ç›¸ç»“åˆï¼Œæ‚¨æ‹¥æœ‰å®Œå…¨é…ç½®ä¸”å¯æ‰§è¡Œçš„ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºã€‚
#### 3.2.3 SpringIoCå®¹å™¨å…·ä½“æ¥å£å’Œå®ç°ç±»

**SpringIocå®¹å™¨æ¥å£**ï¼š

`BeanFactory` æ¥å£æä¾›äº†ä¸€ç§é«˜çº§é…ç½®æœºåˆ¶ï¼Œèƒ½å¤Ÿç®¡ç†ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œå®ƒæ˜¯SpringIoCå®¹å™¨æ ‡å‡†åŒ–è¶…æ¥å£ï¼

`ApplicationContext` æ˜¯ `BeanFactory` çš„å­æ¥å£ã€‚å®ƒæ‰©å±•äº†ä»¥ä¸‹åŠŸèƒ½ï¼š
-   æ›´å®¹æ˜“ä¸ Spring çš„ AOP åŠŸèƒ½é›†æˆ
-   æ¶ˆæ¯èµ„æºå¤„ç†ï¼ˆç”¨äºå›½é™…åŒ–ï¼‰
-   ç‰¹å®šäºåº”ç”¨ç¨‹åºç»™äºˆæ­¤æ¥å£å®ç°ï¼Œä¾‹å¦‚Web åº”ç”¨ç¨‹åºçš„ `WebApplicationContext`
	ç®€è€Œè¨€ä¹‹ï¼Œ `BeanFactory` æä¾›äº†é…ç½®æ¡†æ¶å’ŒåŸºæœ¬åŠŸèƒ½ï¼Œè€Œ `ApplicationContext` æ·»åŠ äº†æ›´å¤šç‰¹å®šäºä¼ä¸šçš„åŠŸèƒ½ã€‚ `ApplicationContext` æ˜¯ `BeanFactory` çš„å®Œæ•´è¶…é›†ï¼
**ApplicationContextå®¹å™¨å®ç°ç±»**ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3ae44c34d001602eb248fc2e65629aa0.png)


| ç±»å‹å                                | ç®€ä»‹                                                            |
| ---------------------------------- | ------------------------------------------------------------- |
| ***ClassPathXmlApplicationContext***     | é€šè¿‡è¯»å–ç±»è·¯å¾„ä¸‹çš„ XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡                              |
| ***FileSystemXmlApplicationContext***    | é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè·¯å¾„è¯»å– XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡                             |
| ***AnnotationConfigApplicationContext*** | é€šè¿‡è¯»å–Javaé…ç½®ç±»åˆ›å»º IOC å®¹å™¨å¯¹è±¡                                        |
| ***WebApplicationContext***              | ä¸“é—¨ä¸º Web åº”ç”¨å‡†å¤‡ï¼ŒåŸºäº Web ç¯å¢ƒåˆ›å»º IOC å®¹å™¨å¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡å¼•å…¥å­˜å…¥ ServletContext åŸŸä¸­ã€‚ |
#### 3.2.4 SpringIoCå®¹å™¨ç®¡ç†é…ç½®æ–¹å¼

Spring IoC å®¹å™¨ä½¿ç”¨å¤šç§å½¢å¼çš„é…ç½®å…ƒæ•°æ®ã€‚æ­¤é…ç½®å…ƒæ•°æ®è¡¨ç¤ºæ‚¨ä½œä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¦‚ä½•å‘Šè¯‰ Spring å®¹å™¨å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/91508c6ae5ed25eee740cfc5629a2a76.png)



Springæ¡†æ¶æä¾›äº†å¤šç§é…ç½®æ–¹å¼ï¼šXMLé…ç½®æ–¹å¼ã€æ³¨è§£æ–¹å¼å’ŒJavaé…ç½®ç±»æ–¹å¼
1.  `XMLé…ç½®æ–¹å¼`ï¼šæ˜¯Springæ¡†æ¶æœ€æ—©çš„é…ç½®æ–¹å¼ä¹‹ä¸€ï¼Œé€šè¿‡åœ¨XMLæ–‡ä»¶ä¸­å®šä¹‰BeanåŠå…¶ä¾èµ–å…³ç³»ã€Beançš„ä½œç”¨åŸŸç­‰ä¿¡æ¯ï¼Œè®©Spring IoCå®¹å™¨æ¥ç®¡ç†Beanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚è¯¥æ–¹å¼ä»Springæ¡†æ¶çš„ç¬¬ä¸€ç‰ˆå¼€å§‹æä¾›æ”¯æŒã€‚
2.  `æ³¨è§£æ–¹å¼`ï¼šä»Spring 2.5ç‰ˆæœ¬å¼€å§‹æä¾›æ”¯æŒï¼Œå¯ä»¥é€šè¿‡åœ¨Beanç±»ä¸Šä½¿ç”¨æ³¨è§£æ¥ä»£æ›¿XMLé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚é€šè¿‡åœ¨Beanç±»ä¸ŠåŠ ä¸Šç›¸åº”çš„æ³¨è§£ï¼ˆå¦‚@Component, @Service, @Autowiredç­‰ï¼‰ï¼Œå°†Beanæ³¨å†Œåˆ°Spring IoCå®¹å™¨ä¸­ï¼Œè¿™æ ·Spring IoCå®¹å™¨å°±å¯ä»¥ç®¡ç†è¿™äº›Beanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚
3.  `Javaé…ç½®ç±»æ–¹å¼`ï¼šä»Spring 3.0ç‰ˆæœ¬å¼€å§‹æä¾›æ”¯æŒï¼Œé€šè¿‡Javaç±»æ¥å®šä¹‰Beanã€Beanä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œé…ç½®ä¿¡æ¯ï¼Œä»è€Œä»£æ›¿XMLé…ç½®æ–‡ä»¶çš„æ–¹å¼ã€‚Javaé…ç½®ç±»æ˜¯ä¸€ç§ä½¿ç”¨Javaç¼–å†™é…ç½®ä¿¡æ¯çš„æ–¹å¼ï¼Œé€šè¿‡@Configurationã€@Beanç­‰æ³¨è§£æ¥å®ç°Beanå’Œä¾èµ–å…³ç³»çš„é…ç½®ã€‚
	ä¸ºäº†è¿åˆå½“ä¸‹å¼€å‘ç¯å¢ƒï¼Œæˆ‘ä»¬å°†ä»¥`é…ç½®ç±»+æ³¨è§£æ–¹å¼`ä¸ºä¸»è¿›è¡Œè®²è§£ï¼

### 3.3 Spring IoC / DIæ¦‚å¿µæ€»ç»“

-   `IoCå®¹å™¨`
    Spring IoC å®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£… beanï¼ˆç»„ä»¶ï¼‰æ ¸å¿ƒå®¹å™¨ã€‚å®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®æ¥è·å–æœ‰å…³è¦å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…ç»„ä»¶çš„æŒ‡ä»¤ã€‚

-   `IoCï¼ˆInversion of Controlï¼‰æ§åˆ¶åè½¬`
    IoC ä¸»è¦æ˜¯é’ˆå¯¹å¯¹è±¡çš„åˆ›å»ºå’Œè°ƒç”¨æ§åˆ¶è€Œè¨€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¸å†æ˜¯åº”ç”¨ç¨‹åºç›´æ¥åˆ›å»ºè¯¥å¯¹è±¡ï¼Œè€Œæ˜¯ç”± IoC å®¹å™¨æ¥åˆ›å»ºå’Œç®¡ç†ï¼Œå³æ§åˆ¶æƒç”±åº”ç”¨ç¨‹åºè½¬ç§»åˆ° IoC å®¹å™¨ä¸­ï¼Œä¹Ÿå°±æ˜¯â€œåè½¬â€äº†æ§åˆ¶æƒã€‚è¿™ç§æ–¹å¼åŸºæœ¬ä¸Šæ˜¯é€šè¿‡ä¾èµ–æŸ¥æ‰¾çš„æ–¹å¼æ¥å®ç°çš„ï¼Œå³ IoC å®¹å™¨ç»´æŠ¤ç€æ„æˆåº”ç”¨ç¨‹åºçš„å¯¹è±¡ï¼Œå¹¶è´Ÿè´£åˆ›å»ºè¿™äº›å¯¹è±¡ã€‚

-   `DI (Dependency Injection) ä¾èµ–æ³¨å…¥`
    DI æ˜¯æŒ‡åœ¨ç»„ä»¶ä¹‹é—´ä¼ é€’ä¾èµ–å…³ç³»çš„è¿‡ç¨‹ä¸­ï¼Œå°†ä¾èµ–å…³ç³»åœ¨å®¹å™¨å†…éƒ¨è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±ä¸å¿…åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ç¡¬ç¼–ç å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå®ç°äº†å¯¹è±¡ä¹‹é—´çš„è§£è€¦åˆã€‚åœ¨ Spring ä¸­ï¼ŒDI æ˜¯é€šè¿‡ XML é…ç½®æ–‡ä»¶æˆ–æ³¨è§£çš„æ–¹å¼å®ç°çš„ã€‚å®ƒæä¾›äº†ä¸‰ç§å½¢å¼çš„ä¾èµ–æ³¨å…¥ï¼šæ„é€ å‡½æ•°æ³¨å…¥ã€Setter æ–¹æ³•æ³¨å…¥å’Œæ¥å£æ³¨å…¥ã€‚

## 4 Spring IoCå®è·µå’Œåº”ç”¨

### 4.1 Spring IoC / DI å®ç°æ­¥éª¤

> æˆ‘ä»¬æ€»ç»“ä¸‹ï¼Œç»„ä»¶äº¤ç»™Spring IoCå®¹å™¨ç®¡ç†ï¼Œå¹¶ä¸”è·å–å’Œä½¿ç”¨çš„åŸºæœ¬æ­¥éª¤ï¼

- `æ­¥éª¤ä¸€ï¼šé…ç½®å…ƒæ•°æ®ï¼ˆé…ç½®ï¼‰`

    é…ç½®å…ƒæ•°æ®ï¼Œæ—¢æ˜¯ç¼–å†™äº¤ç»™SpringIoCå®¹å™¨ç®¡ç†ç»„ä»¶çš„ä¿¡æ¯ï¼Œé…ç½®æ–¹å¼æœ‰ä¸‰ç§ã€‚

    åŸºäº XML çš„é…ç½®å…ƒæ•°æ®çš„åŸºæœ¬ç»“æ„ï¼š

    \<bean id="..." \[1] class="..." \[2]> &#x20;
    &#x20;   \<!-- collaborators and configuration for this bean go here -->
    &#x20; \</bean>
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <!-- æ­¤å¤„è¦æ·»åŠ ä¸€äº›çº¦æŸï¼Œé…ç½®æ–‡ä»¶çš„æ ‡ç­¾å¹¶ä¸æ˜¯éšæ„å‘½å -->
    <beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd">

      <bean id="..." [1] class="..." [2]>  
        <!-- collaborators and configuration for this bean go here -->
      </bean>

      <bean id="..." class="...">
        <!-- collaborators and configuration for this bean go here -->
      </bean>
      <!-- more bean definitions go here -->
    </beans>
    ```
    Spring IoC å®¹å™¨ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªç»„ä»¶ã€‚è¿™äº› ç»„ä»¶æ˜¯ä½¿ç”¨ä½ æä¾›ç»™å®¹å™¨çš„é…ç½®å…ƒæ•°æ®ï¼ˆä¾‹å¦‚ï¼Œä»¥ XML `<bean/>` å®šä¹‰çš„å½¢å¼ï¼‰åˆ›å»ºçš„ã€‚

    \<bean /> æ ‡ç­¾ == ç»„ä»¶ä¿¡æ¯å£°æ˜
    -   `id` å±æ€§æ˜¯æ ‡è¯†å•ä¸ª Bean å®šä¹‰çš„å­—ç¬¦ä¸²ã€‚
    -   `class` å±æ€§å®šä¹‰ Bean çš„ç±»å‹å¹¶ä½¿ç”¨å®Œå…¨é™å®šçš„ç±»åã€‚

- `æ­¥éª¤äºŒï¼šå®ä¾‹åŒ–IoCå®¹å™¨`

    æä¾›ç»™ `ApplicationContext` æ„é€ å‡½æ•°çš„ä½ç½®è·¯å¾„æ˜¯èµ„æºå­—ç¬¦ä¸²åœ°å€ï¼Œå…è®¸å®¹å™¨ä»å„ç§å¤–éƒ¨èµ„æºï¼ˆå¦‚æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€Java `CLASSPATH` ç­‰ï¼‰åŠ è½½é…ç½®å…ƒæ•°æ®ã€‚

    æˆ‘ä»¬åº”è¯¥é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å®¹å™¨å®ç°ç±»ï¼Œè¿›è¡ŒIoCå®¹å™¨çš„å®ä¾‹åŒ–å·¥ä½œï¼š
    ```java
    //å®ä¾‹åŒ–iocå®¹å™¨,è¯»å–å¤–éƒ¨é…ç½®æ–‡ä»¶,æœ€ç»ˆä¼šåœ¨å®¹å™¨å†…è¿›è¡Œiocå’ŒdiåŠ¨ä½œ
    ApplicationContext context = 
               new ClassPathXmlApplicationContext("services.xml", "daos.xml");
    ```

- `æ­¥éª¤ä¸‰ï¼šè·å–Beanï¼ˆç»„ä»¶ï¼‰`

    `ApplicationContext` æ˜¯ä¸€ä¸ªé«˜çº§å·¥å‚çš„æ¥å£ï¼Œèƒ½å¤Ÿç»´æŠ¤ä¸åŒ bean åŠå…¶ä¾èµ–é¡¹çš„æ³¨å†Œè¡¨ã€‚é€šè¿‡ä½¿ç”¨æ–¹æ³• `T getBean(String name, Class<T> requiredType)` ï¼Œæ‚¨å¯ä»¥æ£€ç´¢ bean çš„å®ä¾‹ã€‚

    å…è®¸è¯»å– Bean å®šä¹‰å¹¶è®¿é—®å®ƒä»¬ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š
    ```java
    //åˆ›å»ºiocå®¹å™¨å¯¹è±¡ï¼ŒæŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œiocä¹Ÿå¼€å§‹å®ä¾‹ç»„ä»¶å¯¹è±¡
    ApplicationContext context = new ClassPathXmlApplicationContext("services.xml", "daos.xml");
    //è·å–iocå®¹å™¨çš„ç»„ä»¶å¯¹è±¡
    PetStoreService service = context.getBean("petStore", PetStoreService.class);
    //ä½¿ç”¨ç»„ä»¶å¯¹è±¡
    List<String> userList = service.getUsernameList();
    ```

### 4.2 åŸºäºXMLé…ç½®æ–¹å¼ç»„ä»¶ç®¡ç†

#### 4.2.1 å®éªŒä¸€ï¼š ç»„ä»¶ï¼ˆBeanï¼‰ä¿¡æ¯å£°æ˜é…ç½®ï¼ˆIoCï¼‰

1.  `ç›®æ ‡`

    Spring IoC å®¹å™¨ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ª beanã€‚è¿™äº› Bean æ˜¯ä½¿ç”¨æ‚¨æä¾›ç»™å®¹å™¨çš„é…ç½®å…ƒæ•°æ®åˆ›å»ºçš„ï¼ˆä¾‹å¦‚ï¼Œä»¥ XML `<bean/>` å®šä¹‰çš„å½¢å¼ï¼‰ã€‚

    æˆ‘ä»¬å­¦ä¹ ï¼Œå¦‚ä½•é€šè¿‡å®šä¹‰XMLé…ç½®æ–‡ä»¶ï¼Œå£°æ˜ç»„ä»¶ç±»ä¿¡æ¯ï¼Œäº¤ç»™ Spring çš„ IoC å®¹å™¨è¿›è¡Œç»„ä»¶ç®¡ç†ï¼
    
2.  `æ€è·¯`

	![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/86a110e6a9ad3d503dfd9f9d396d390d.png)


3.  `å‡†å¤‡é¡¹ç›®`
    1.  åˆ›å»ºmavenå·¥ç¨‹ï¼ˆspring-ioc-xml-01ï¼‰
    2.  å¯¼å…¥SpringIoCç›¸å…³ä¾èµ–

        pom.xml
        ```xml
        <dependencies>
            <!--spring contextä¾èµ–-->
            <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-context</artifactId>
                <version>6.0.6</version>
            </dependency>
            <!--junit5æµ‹è¯•-->
            <dependency>
                <groupId>org.junit.jupiter</groupId>
                <artifactId>junit-jupiter-api</artifactId>
                <version>5.3.1</version>
            </dependency>
        </dependencies>
        ```

4.  `åŸºäºæ— å‚æ•°æ„é€ å‡½æ•°`
    > å½“é€šè¿‡æ„é€ å‡½æ•°æ–¹æ³•åˆ›å»ºä¸€ä¸ª beanï¼ˆç»„ä»¶å¯¹è±¡ï¼‰ æ—¶ï¼Œæ‰€æœ‰æ™®é€šç±»éƒ½å¯ä»¥ç”± Spring ä½¿ç”¨å¹¶ä¸ä¹‹å…¼å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­£åœ¨å¼€å‘çš„ç±»ä¸éœ€è¦å®ç°ä»»ä½•ç‰¹å®šçš„æ¥å£æˆ–ä»¥ç‰¹å®šçš„æ–¹å¼è¿›è¡Œç¼–ç ã€‚åªéœ€æŒ‡å®š Bean ç±»ä¿¡æ¯å°±è¶³å¤Ÿäº†ã€‚ä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé»˜è®¤ï¼ˆç©ºï¼‰æ„é€ å‡½æ•°ã€‚

	1.  å‡†å¤‡ç»„ä»¶ç±»
	```java
	package com.atguigu.ioc;
	public class HappyComponent {
		//é»˜è®¤åŒ…å«æ— å‚æ•°æ„é€ å‡½æ•°
		public void doWork() {
			System.out.println("HappyComponent.doWork");
		}
	}
	```
    2.  xmlé…ç½®æ–‡ä»¶ç¼–å†™

        åˆ›å»ºæºå¸¦springçº¦æŸçš„xmlé…ç½®æ–‡ä»¶,ç¼–å†™é…ç½®æ–‡ä»¶ï¼š

        æ–‡ä»¶ï¼šresources/spring-bean-01.xml
        ```xml
        <?xml version="1.0" encoding="UTF-8"?>  
<beans xmlns="http://www.springframework.org/schema/beans"  
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">  
    <bean id="work" class="com.dakkk.HappyComponent"/>  
</beans>
    ```
        -   beanæ ‡ç­¾ï¼šé€šè¿‡é…ç½®beanæ ‡ç­¾å‘Šè¯‰IOCå®¹å™¨éœ€è¦åˆ›å»ºå¯¹è±¡çš„ç»„ä»¶ä¿¡æ¯
        -   idå±æ€§ï¼šbeançš„å”¯ä¸€æ ‡è¯†,æ–¹ä¾¿åæœŸè·å–Beanï¼
        -   classå±æ€§ï¼šç»„ä»¶ç±»çš„å…¨é™å®šç¬¦ï¼
        -   æ³¨æ„ï¼šè¦æ±‚å½“å‰ç»„ä»¶ç±»å¿…é¡»åŒ…å«æ— å‚æ•°æ„é€ å‡½æ•°ï¼

5.  `åŸºäºé™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–`
    > é™¤äº†ä½¿ç”¨æ„é€ å‡½æ•°å®ä¾‹åŒ–å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ç±»æ˜¯é€šè¿‡å·¥å‚æ¨¡å¼å®ä¾‹åŒ–å¯¹è±¡ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è®²è§£å¦‚ä½•å®šä¹‰ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºBeançš„é…ç½® ï¼
    
	1.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public class ClientService {
          private static ClientService clientService = new ClientService();
          private ClientService() {}

          public static ClientService createInstance() {
          
            return clientService;
          }
        }
        ```
    2.  xmlé…ç½®æ–‡ä»¶ç¼–å†™

        æ–‡ä»¶ï¼šresources/spring-bean-01.xml
        ```xml
        <bean id="clientService"
          class="examples.ClientService"
          factory-method="createInstance"/>
        ```
        -   classå±æ€§ï¼šæŒ‡å®šå·¥å‚ç±»çš„å…¨é™å®šç¬¦ï¼
        -   *factory-method: æŒ‡å®šé™æ€å·¥å‚æ–¹æ³•ï¼Œæ³¨æ„ï¼Œè¯¥æ–¹æ³•å¿…é¡»æ˜¯staticæ–¹æ³•*ã€‚

6.  `åŸºäºå®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–`
    > æ¥ä¸‹æ¥æˆ‘ä»¬è®²è§£ä¸‹å¦‚ä½•å®šä¹‰ä½¿ç”¨å®ä¾‹å·¥å‚æ–¹æ³•åˆ›å»ºBeançš„é…ç½® ï¼
    1.  å‡†å¤‡ç»„å»ºç±»
        ```java
        public class DefaultServiceLocator {
          private static ClientServiceImplclientService = new ClientServiceImpl();
          public ClientService createClientServiceInstance() {
            return clientService;
          }
        }
        ```
    2.  xmlé…ç½®æ–‡ä»¶ç¼–å†™

        æ–‡ä»¶ï¼šresources/spring-bean-01.xml
        ```xml
        <!-- å°†å·¥å‚ç±»è¿›è¡Œiocé…ç½® -->
        <bean id="serviceLocator" class="examples.DefaultServiceLocator">
        </bean>

        <!-- æ ¹æ®å·¥å‚å¯¹è±¡çš„å®ä¾‹å·¥å‚æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–ç»„ä»¶å¯¹è±¡ -->
        <bean id="clientService"
          factory-bean="serviceLocator"
          factory-method="createClientServiceInstance"/>
        ```
        -   factory-beanå±æ€§ï¼šæŒ‡å®šå½“å‰å®¹å™¨ä¸­å·¥å‚Bean çš„åç§°ã€‚
        -   factory-method:  æŒ‡å®šå®ä¾‹å·¥å‚æ–¹æ³•åã€‚æ³¨æ„ï¼Œå®ä¾‹æ–¹æ³•å¿…é¡»æ˜¯éstaticçš„ï¼

7.  `å›¾è§£IoCé…ç½®æµç¨‹`![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/9307a10c3e4aa8e88891d4dd4d4395da.png)
#### 4.2.2 å®éªŒäºŒï¼š ç»„ä»¶ï¼ˆBeanï¼‰ä¾èµ–æ³¨å…¥é…ç½®ï¼ˆDIï¼‰

1.  `ç›®æ ‡`

    é€šè¿‡é…ç½®æ–‡ä»¶,å®ç°IoCå®¹å™¨ä¸­Beanä¹‹é—´çš„å¼•ç”¨ï¼ˆä¾èµ–æ³¨å…¥DIé…ç½®ï¼‰ã€‚

    ä¸»è¦æ¶‰åŠæ³¨å…¥åœºæ™¯ï¼šåŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥å’ŒåŸºäº Setter çš„ä¾èµ–æ³¨å…¥ã€‚

2.  `æ€è·¯`
   ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/602b01e55a2635ad7e9dec1545565484.png)


3.  `åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥`ï¼ˆ`å•ä¸ªæ„é€ å‚æ•°`ï¼‰
    1.  ä»‹ç»
        åŸºäºæ„é€ å‡½æ•°çš„ DI æ˜¯é€šè¿‡å®¹å™¨è°ƒç”¨å…·æœ‰å¤šä¸ªå‚æ•°çš„æ„é€ å‡½æ•°æ¥å®Œæˆçš„ï¼Œæ¯ä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªä¾èµ–é¡¹ã€‚
        ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºä¸€ä¸ªåªèƒ½é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥è¿›è¡Œä¾èµ–é¡¹æ³¨å…¥çš„ç±»ï¼

	2.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public class UserDao {
        }

        public class UserService {
            private UserDao userDao;
            public UserService(UserDao userDao) {
                this.userDao = userDao;
            }
        }
        ```

	3.  ç¼–å†™é…ç½®æ–‡ä»¶

        æ–‡ä»¶ï¼šresources/spring-02.xml
        ```xml
        <beans>
          <!-- å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userService" class="x.y.UserService">
           <!-- æ„é€ å‡½æ•°å¼•ç”¨ -->
            <constructor-arg ref="userDao"/>
          </bean>
          <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userDao" class="x.y.UserDao"/>
        </beans>
        ```
        -   constructor-argæ ‡ç­¾ï¼šå¯ä»¥å¼•ç”¨æ„é€ å‚æ•° refå¼•ç”¨å…¶ä»–beançš„æ ‡è¯†ã€‚

4.  `åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥`ï¼ˆ`å¤šæ„é€ å‚æ•°è§£æ`ï¼‰
    1.  ä»‹ç»
        åŸºäºæ„é€ å‡½æ•°çš„ DI æ˜¯é€šè¿‡å®¹å™¨è°ƒç”¨å…·æœ‰å¤šä¸ªå‚æ•°çš„æ„é€ å‡½æ•°æ¥å®Œæˆçš„ï¼Œæ¯ä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªä¾èµ–é¡¹ã€‚
        ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥å¤šä¸ªå‚æ•°ï¼Œå‚æ•°åŒ…å«å…¶ä»–beanå’ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼

	2.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public class UserDao {
        }

        public class UserService {
            private UserDao userDao;
            private int age;
            private String name;
            public UserService(int age , String name ,UserDao userDao) {
                this.userDao = userDao;
                this.age = age;
                this.name = name;
            }
        }
        ```

	3.  ç¼–å†™é…ç½®æ–‡ä»¶`ï¼ˆé¡ºåºã€åç§°ã€ä¸‹æ ‡ï¼‰`
        ```xml
        <!-- åœºæ™¯1: å¤šå‚æ•°ï¼Œå¯ä»¥æŒ‰ç…§ç›¸åº”æ„é€ å‡½æ•°çš„é¡ºåºæ³¨å…¥æ•°æ® -->
        <beans>
          <bean id="userService" class="x.y.UserService">
            <!-- valueç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ -->
            <constructor-arg  value="18"/>
            <constructor-arg  value="èµµä¼Ÿé£"/>
            
            <constructor-arg  ref="userDao"/>
          </bean>
          <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userDao" class="x.y.UserDao"/>

        <!-- åœºæ™¯2: å¤šå‚æ•°ï¼Œå¯ä»¥æŒ‰ç…§ç›¸åº”æ„é€ å‡½æ•°çš„åç§°æ³¨å…¥æ•°æ® -->
        <beans>
          <bean id="userService" class="x.y.UserService">
            <!-- valueç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ -->
            <constructor-arg name="name" value="èµµä¼Ÿé£"/>
            <constructor-arg name="userDao" ref="userDao"/>
            <constructor-arg name="age"  value="18"/>
          </bean>
          <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userDao" class="x.y.UserDao"/>

		 <!-- åœºæ™¯2: å¤šå‚æ•°ï¼Œå¯ä»¥æŒ‰ç…§ç›¸åº”æ„é€ å‡½æ•°çš„è§’æ ‡æ³¨å…¥æ•°æ® 
               indexä»0å¼€å§‹ æ„é€ å‡½æ•°(0,1,2....)
    -->
	    <beans>
	        <bean id="userService" class="x.y.UserService">
	        <!-- valueç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ -->
	        <constructor-arg index="1" value="èµµä¼Ÿé£"/>
	        <constructor-arg index="2" ref="userDao"/>
	        <constructor-arg index="0"  value="18"/>
	      </bean> 
	      <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
	      <bean id="userDao" class="x.y.UserDao"/>
	    </beans>
        ```
        -   constructor-argæ ‡ç­¾ï¼šæŒ‡å®šæ„é€ å‚æ•°å’Œå¯¹åº”çš„å€¼
        -   constructor-argæ ‡ç­¾ï¼šnameå±æ€§æŒ‡å®šå‚æ•°åã€indexå±æ€§æŒ‡å®šå‚æ•°è§’æ ‡ã€valueå±æ€§æŒ‡å®šæ™®é€šå±æ€§å€¼

5.  `åŸºäºSetteræ–¹æ³•ä¾èµ–æ³¨å…¥`

	1.  ä»‹ç»
        å¼€å‘ä¸­ï¼Œé™¤äº†æ„é€ å‡½æ•°æ³¨å…¥ï¼ˆDIï¼‰æ›´å¤šçš„ä½¿ç”¨çš„Setteræ–¹æ³•è¿›è¡Œæ³¨å…¥ï¼
        ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºä¸€ä¸ªåªèƒ½ä½¿ç”¨çº¯ setter æ³¨å…¥è¿›è¡Œä¾èµ–é¡¹æ³¨å…¥çš„ç±»ã€‚

	2.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public Class MovieFinder{

        }

        public class SimpleMovieLister {
          private MovieFinder movieFinder;
          private String movieName;
          public void setMovieFinder(MovieFinder movieFinder) {
            this.movieFinder = movieFinder;
          }
          public void setMovieName(String movieName){
            this.movieName = movieName;
          }

          // business logic that actually uses the injected MovieFinder is omitted...
        }
        ```

	3.  ç¼–å†™é…ç½®æ–‡ä»¶
        ```xml
        <bean id="simpleMovieLister" class="examples.SimpleMovieLister">
          <!-- setteræ–¹æ³•ï¼Œæ³¨å…¥movieFinderå¯¹è±¡çš„æ ‡è¯†id
               name = å±æ€§å  ref = å¼•ç”¨beançš„idå€¼
           -->
          <property name="movieFinder" ref="movieFinder" />

          <!-- setteræ–¹æ³•ï¼Œæ³¨å…¥åŸºæœ¬æ•°æ®ç±»å‹movieName
               name = å±æ€§å value= åŸºæœ¬ç±»å‹å€¼
           -->
          <property name="movieName" value="æ¶ˆå¤±çš„å¥¹"/>
        </bean>

        <bean id="movieFinder" class="examples.MovieFinder"/>

        ```
        -   propertyæ ‡ç­¾ï¼š å¯ä»¥ç»™setteræ–¹æ³•å¯¹åº”çš„å±æ€§èµ‹å€¼
        -   property æ ‡ç­¾ï¼š nameå±æ€§ä»£è¡¨**setæ–¹æ³•æ ‡è¯†**ã€refä»£è¡¨å¼•ç”¨beançš„æ ‡è¯†idã€valueå±æ€§ä»£è¡¨åŸºæœ¬å±æ€§å€¼

**æ€»ç»“ï¼š**

ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰åŒ…å«å¼•ç”¨ç±»å‹å’ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼ŒåŒæ—¶æ³¨å…¥çš„æ–¹å¼ä¹Ÿæœ‰å¤šç§ï¼ä¸»æµçš„æ³¨å…¥æ–¹å¼ä¸ºsetteræ–¹æ³•æ³¨å…¥å’Œæ„é€ å‡½æ•°æ³¨å…¥ï¼Œä¸¤ç§æ³¨å…¥è¯­æ³•éƒ½éœ€è¦æŒæ¡ï¼

éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šå¼•ç”¨å…¶ä»–beanï¼Œä½¿ç”¨refå±æ€§ã€‚ç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ï¼Œä½¿ç”¨valueå±æ€§ã€‚

#### 4.2.3 å®éªŒä¸‰ï¼š IoCå®¹å™¨åˆ›å»ºå’Œä½¿ç”¨

1.  `ä»‹ç»`

    ä¸Šé¢çš„å®éªŒåªæ˜¯è®²è§£äº†å¦‚ä½•åœ¨XMLæ ¼å¼çš„é…ç½®æ–‡ä»¶ç¼–å†™IoCå’ŒDIé…ç½®ï¼

    å¦‚å›¾ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/91508c6ae5ed25eee740cfc5629a2a76.png)



    æƒ³è¦é…ç½®æ–‡ä»¶ä¸­å£°æ˜ç»„ä»¶ç±»ä¿¡æ¯çœŸæ­£çš„è¿›è¡Œå®ä¾‹åŒ–æˆBeanå¯¹è±¡å’Œå½¢æˆBeanä¹‹é—´çš„å¼•ç”¨å…³ç³»ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜IoCå®¹å™¨å¯¹è±¡ï¼Œè¯»å–é…ç½®æ–‡ä»¶ï¼Œå®ä¾‹åŒ–ç»„ä»¶å’Œå…³ç³»ç»´æŠ¤çš„è¿‡ç¨‹éƒ½æ˜¯åœ¨IoCå®¹å™¨ä¸­å®ç°çš„ï¼

2.  `å®¹å™¨å®ä¾‹åŒ–`
    ```java
    //æ–¹å¼1:å®ä¾‹åŒ–å¹¶ä¸”æŒ‡å®šé…ç½®æ–‡ä»¶
    //å‚æ•°ï¼šString...locations ä¼ å…¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªé…ç½®æ–‡ä»¶
    ApplicationContext ctx = 
               new ClassPathXmlApplicationContext("services.xml", "daos.xml");
               
    //æ–¹å¼2:å…ˆå®ä¾‹åŒ–ï¼Œå†æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œæœ€ååˆ·æ–°å®¹å™¨è§¦å‘Beanå®ä¾‹åŒ–åŠ¨ä½œ [springmvcæºç å’ŒcontextLoadListeneræºç æ–¹å¼]  
    ApplicationContext ctx = 
               new ClassPathXmlApplicationContext();   
    //è®¾ç½®é…ç½®é…ç½®æ–‡ä»¶,æ–¹æ³•å‚æ•°ä¸ºå¯å˜å‚æ•°,å¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–è€…å¤šä¸ªé…ç½®
    ctx.setConfigLocations("services.xml", "daos.xml");
    //åé…ç½®çš„æ–‡ä»¶,éœ€è¦è°ƒç”¨refreshæ–¹æ³•,è§¦å‘åˆ·æ–°é…ç½®
    ctx.refresh();           

    ```

3.  `Beanå¯¹è±¡è¯»å–`
    ```java
    //æ–¹å¼1: æ ¹æ®idè·å–
    //æ²¡æœ‰æŒ‡å®šç±»å‹,è¿”å›ä¸ºObject,éœ€è¦ç±»å‹è½¬åŒ–!
    HappyComponent happyComponent = 
            (HappyComponent) iocContainer.getBean("beançš„idæ ‡è¯†");
            
    //ä½¿ç”¨ç»„ä»¶å¯¹è±¡        
    happyComponent.doWork();

    //æ–¹å¼2: æ ¹æ®ç±»å‹è·å–
    //æ ¹æ®ç±»å‹è·å–,ä½†æ˜¯è¦æ±‚,åŒç±»å‹(å½“å‰ç±»,æˆ–è€…ä¹‹ç±»,æˆ–è€…æ¥å£çš„å®ç°ç±»)åªèƒ½æœ‰ä¸€ä¸ªå¯¹è±¡äº¤ç»™IoCå®¹å™¨ç®¡ç†
    //é…ç½®ä¸¤ä¸ªæˆ–è€…ä»¥ä¸Šå‡ºç°: org.springframework.beans.factory.NoUniqueBeanDefinitionException é—®é¢˜
    HappyComponent happyComponent = iocContainer.getBean(HappyComponent.class);
    happyComponent.doWork();

    //æ–¹å¼3: æ ¹æ®idå’Œç±»å‹è·å–
    HappyComponent happyComponent = iocContainer.getBean("beançš„idæ ‡è¯†", HappyComponent.class);
    happyComponent.doWork();
    ```

- æ ¹æ®ç±»å‹æ¥è·å–beanæ—¶ï¼Œåœ¨æ»¡è¶³beanå”¯ä¸€æ€§çš„å‰æä¸‹ï¼Œå…¶å®åªæ˜¯çœ‹ï¼šã€å¯¹è±¡ instanceof æŒ‡å®šçš„ç±»å‹ã€çš„è¿”å›ç»“æœï¼Œ
    åªè¦è¿”å›çš„æ˜¯trueå°±å¯ä»¥è®¤å®šä¸ºå’Œç±»å‹åŒ¹é…ï¼Œèƒ½å¤Ÿè·å–åˆ°ã€‚

#### 4.2.4 å®éªŒå››ï¼š é«˜çº§ç‰¹æ€§ï¼šç»„ä»¶ï¼ˆBeanï¼‰ä½œç”¨åŸŸå’Œå‘¨æœŸæ–¹æ³•é…ç½®

1.  `ç»„ä»¶å‘¨æœŸæ–¹æ³•é…ç½®`

	1.  å‘¨æœŸæ–¹æ³•æ¦‚å¿µ
        æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ç±»ä¸­å®šä¹‰æ–¹æ³•ï¼Œç„¶åå½“IoCå®¹å™¨å®ä¾‹åŒ–å’Œé”€æ¯ç»„ä»¶å¯¹è±¡çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ï¼è¿™ä¸¤ä¸ªæ–¹æ³•æˆ‘ä»¬æˆä¸ºç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼
        ç±»ä¼¼äºServletçš„init/destroyæ–¹æ³•,æˆ‘ä»¬å¯ä»¥åœ¨å‘¨æœŸæ–¹æ³•å®Œæˆåˆå§‹åŒ–å’Œé‡Šæ”¾èµ„æºç­‰å·¥ä½œã€‚

	2.  å‘¨æœŸæ–¹æ³•å£°æ˜
        ```java
        public class BeanOne {
          //å‘¨æœŸæ–¹æ³•è¦æ±‚ï¼š æ–¹æ³•å‘½åéšæ„ï¼Œä½†æ˜¯è¦æ±‚æ–¹æ³•å¿…é¡»æ˜¯ public void æ— å½¢å‚åˆ—è¡¨
          public void init() {
            // åˆå§‹åŒ–é€»è¾‘
          }
        }

        public class BeanTwo {
          public void cleanup() {
            // é‡Šæ”¾èµ„æºé€»è¾‘
          }
        }
        ```

	3.  å‘¨æœŸæ–¹æ³•é…ç½®
        ```xml
        <beans>
          <bean id="beanOne" class="examples.BeanOne" init-method="init" />
          <bean id="beanTwo" class="examples.BeanTwo" destroy-method="cleanup" />
        </beans>
        ```

2.  `ç»„ä»¶ä½œç”¨åŸŸé…ç½®`

	1.  Beanä½œç”¨åŸŸæ¦‚å¿µ

        - `<bean` æ ‡ç­¾å£°æ˜Beanï¼Œåªæ˜¯å°†Beançš„ä¿¡æ¯é…ç½®ç»™SpringIoCå®¹å™¨ï¼
        - åœ¨IoCå®¹å™¨ä¸­ï¼Œè¿™äº›`<bean`æ ‡ç­¾å¯¹åº”çš„ä¿¡æ¯è½¬æˆSpringå†…éƒ¨ `BeanDefinition` å¯¹è±¡ï¼Œ`BeanDefinition` å¯¹è±¡å†…ï¼ŒåŒ…å«å®šä¹‰çš„ä¿¡æ¯ï¼ˆid,class,å±æ€§ç­‰ç­‰ï¼‰ï¼
        - è¿™æ„å‘³ç€ï¼Œ`BeanDefinition`ä¸`ç±»`æ¦‚å¿µä¸€æ ·ï¼ŒSpringIoCå®¹å™¨å¯ä»¥å¯ä»¥æ ¹æ®`BeanDefinition`å¯¹è±¡åå°„åˆ›å»ºå¤šä¸ªBeanå¯¹è±¡å®ä¾‹ã€‚
        - å…·ä½“åˆ›å»ºå¤šå°‘ä¸ªBeançš„å®ä¾‹å¯¹è±¡ï¼Œç”±Beançš„ä½œç”¨åŸŸScopeå±æ€§æŒ‡å®šï¼

	2.  ä½œç”¨åŸŸå¯é€‰å€¼![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/396a7772070dbf647c7d14ca43146aec.png)


    3.  ä½œç”¨åŸŸé…ç½®

        é…ç½®scopeèŒƒå›´
        ```xml
        <!--beançš„ä½œç”¨åŸŸ 
            å‡†å¤‡ä¸¤ä¸ªå¼•ç”¨å…³ç³»çš„ç»„ä»¶ç±»å³å¯ï¼ï¼
        -->
        <!-- scopeå±æ€§ï¼šå–å€¼singletonï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œbeanåœ¨IOCå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ŒIOCå®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»ºå¯¹è±¡ -->
        <!-- scopeå±æ€§ï¼šå–å€¼prototypeï¼Œbeanåœ¨IOCå®¹å™¨ä¸­å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼ŒgetBean()æ—¶åˆ›å»ºå¯¹è±¡ -->
        <bean id="happyMachine8" scope="prototype" class="com.atguigu.ioc.HappyMachine">
            <property name="machineName" value="happyMachine"/>
        </bean>

        <bean id="happyComponent8" scope="singleton" class="com.atguigu.ioc.HappyComponent">
            <property name="componentName" value="happyComponent"/>
        </bean>
        ```
    4.  ä½œç”¨åŸŸæµ‹è¯•
        ```java
        @Test
        public void testExperiment08()  {
            ApplicationContext iocContainer = new ClassPathXmlApplicationContext("é…ç½®æ–‡ä»¶å");

            HappyMachine bean = iocContainer.getBean(HappyMachine.class);
            HappyMachine bean1 = iocContainer.getBean(HappyMachine.class);
            //å¤šä¾‹å¯¹æ¯” false
            System.out.println(bean == bean1);

            HappyComponent bean2 = iocContainer.getBean(HappyComponent.class);
            HappyComponent bean3 = iocContainer.getBean(HappyComponent.class);
            //å•ä¾‹å¯¹æ¯” true
            System.out.println(bean2 == bean3);
        }
        ```

#### 4.2.5 å®éªŒäº”ï¼š é«˜çº§ç‰¹æ€§ï¼šFactoryBeanç‰¹æ€§å’Œä½¿ç”¨

1.  `FactoryBeanç®€ä»‹`

    `FactoryBean` æ¥å£æ˜¯Spring IoCå®¹å™¨å®ä¾‹åŒ–é€»è¾‘çš„å¯æ’æ‹”æ€§ç‚¹ã€‚

    ç”¨äºé…ç½®å¤æ‚çš„Beanå¯¹è±¡ï¼Œå¯ä»¥å°†åˆ›å»ºè¿‡ç¨‹å­˜å‚¨åœ¨`FactoryBean` çš„getObjectæ–¹æ³•ï¼

    `FactoryBean<T>` æ¥å£æä¾›ä¸‰ç§æ–¹æ³•ï¼š
    -   `T getObject()`
        è¿”å›æ­¤å·¥å‚åˆ›å»ºçš„å¯¹è±¡çš„å®ä¾‹ã€‚è¯¥è¿”å›å€¼ä¼šè¢«å­˜å‚¨åˆ°IoCå®¹å™¨ï¼
        
    -   `boolean isSingleton()`
        å¦‚æœæ­¤ `FactoryBean` è¿”å›å•ä¾‹ï¼Œåˆ™è¿”å› `true` ï¼Œå¦åˆ™è¿”å› `false` ã€‚æ­¤æ–¹æ³•çš„é»˜è®¤å®ç°è¿”å› `true` ï¼ˆæ³¨æ„ï¼Œlombokæ’ä»¶ä½¿ç”¨ï¼Œå¯èƒ½å½±å“æ•ˆæœï¼‰ã€‚
        
    -   `Class<?> getObjectType()`: è¿”å› `getObject()` æ–¹æ³•è¿”å›çš„å¯¹è±¡ç±»å‹ï¼Œå¦‚æœäº‹å…ˆä¸çŸ¥é“ç±»å‹ï¼Œåˆ™è¿”å› `null` ã€‚
        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7d9f660b7167211c17c3e63b62beca78.png)


2.  `FactoryBeanä½¿ç”¨åœºæ™¯`
    1.  ä»£ç†ç±»çš„åˆ›å»º
    2.  ç¬¬ä¸‰æ–¹æ¡†æ¶æ•´åˆ
    3.  å¤æ‚å¯¹è±¡å®ä¾‹åŒ–ç­‰

3.  `Factorybeanåº”ç”¨`
    1.  å‡†å¤‡FactoryBeanå®ç°ç±»
        ```java
        // å®ç°FactoryBeanæ¥å£æ—¶éœ€è¦æŒ‡å®šæ³›å‹
        // æ³›å‹ç±»å‹å°±æ˜¯å½“å‰å·¥å‚è¦ç”Ÿäº§çš„å¯¹è±¡çš„ç±»å‹
        public class HappyFactoryBean implements FactoryBean<HappyMachine> {
            
            private String machineName;
            
            public String getMachineName() {
                return machineName;
            }
            
            public void setMachineName(String machineName) {
                this.machineName = machineName;
            }
            
            @Override
            public HappyMachine getObject() throws Exception {
            
                // æ–¹æ³•å†…éƒ¨æ¨¡æ‹Ÿåˆ›å»ºã€è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„å¤æ‚è¿‡ç¨‹
                HappyMachine happyMachine = new HappyMachine();
            
                happyMachine.setMachineName(this.machineName);
            
                return happyMachine;
            }
            
            @Override
            public Class<?> getObjectType() {
            
                // è¿”å›è¦ç”Ÿäº§çš„å¯¹è±¡çš„ç±»å‹
                return HappyMachine.class;
            }
        }
        ```

	2.  é…ç½®FactoryBeanå®ç°ç±»
        ```xml
        <!-- FactoryBeanæœºåˆ¶ -->
        <!-- è¿™ä¸ªbeanæ ‡ç­¾ä¸­classå±æ€§æŒ‡å®šçš„æ˜¯HappyFactoryBeanï¼Œä½†æ˜¯å°†æ¥ä»è¿™é‡Œè·å–çš„beanæ˜¯HappyMachineå¯¹è±¡ -->
        <bean id="happyMachine7" class="com.atguigu.ioc.HappyFactoryBean">
            <!-- propertyæ ‡ç­¾ä»ç„¶å¯ä»¥ç”¨æ¥é€šè¿‡setXxx()æ–¹æ³•ç»™å±æ€§èµ‹å€¼ -->
            <property name="machineName" value="iceCreamMachine"/>
        </bean>
        ```

	3.  æµ‹è¯•è¯»å–FactoryBeanå’ŒFactoryBean.getObjectå¯¹è±¡
        ```java
        @Test
        public void testExperiment07()  {

            ApplicationContext iocContainer = new ClassPathXmlApplicationContext("spring-bean-07.xml");

            //æ³¨æ„: ç›´æ¥æ ¹æ®å£°æ˜FactoryBeançš„id,è·å–çš„æ˜¯getObjectæ–¹æ³•è¿”å›çš„å¯¹è±¡
            HappyMachine happyMachine = iocContainer.getBean("happyMachine7",HappyMachine.class);
            System.out.println("happyMachine = " + happyMachine);

            //å¦‚æœæƒ³è¦è·å–FactoryBeanå¯¹è±¡, ç›´æ¥åœ¨idå‰æ·»åŠ &ç¬¦å·å³å¯!  &happyMachine7 è¿™æ˜¯ä¸€ç§å›ºå®šçš„çº¦æŸ
            Object bean = iocContainer.getBean("&happyMachine7");
            System.out.println("bean = " + bean);
        }
        ```

4.  `FactoryBeanå’ŒBeanFactoryåŒºåˆ«`

    `FactoryBean`æ˜¯ Spring ä¸­ä¸€ç§ç‰¹æ®Šçš„ beanï¼Œå¯ä»¥åœ¨ getObject() å·¥å‚æ–¹æ³•è‡ªå®šä¹‰çš„é€»è¾‘åˆ›å»ºBeanï¼æ˜¯ä¸€ç§èƒ½å¤Ÿç”Ÿäº§å…¶ä»– Bean çš„ Beanã€‚FactoryBean åœ¨å®¹å™¨å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œè€Œåœ¨å®é™…ä½¿ç”¨æ—¶åˆ™æ˜¯é€šè¿‡è°ƒç”¨ getObject() æ–¹æ³•æ¥å¾—åˆ°å…¶æ‰€ç”Ÿäº§çš„ Beanã€‚å› æ­¤ï¼ŒFactoryBean å¯ä»¥è‡ªå®šä¹‰ä»»ä½•æ‰€éœ€çš„åˆå§‹åŒ–é€»è¾‘ï¼Œç”Ÿäº§å‡ºä¸€äº›å®šåˆ¶åŒ–çš„ beanã€‚

    ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ`æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œéƒ½æ˜¯é€šè¿‡å®šä¹‰FactoryBeanå®ç°ï¼ï¼ï¼`

    **BeanFactory** æ˜¯ Spring æ¡†æ¶çš„åŸºç¡€ï¼Œå…¶ä½œä¸ºä¸€ä¸ªé¡¶çº§æ¥å£å®šä¹‰äº†å®¹å™¨çš„åŸºæœ¬è¡Œä¸ºï¼Œä¾‹å¦‚ç®¡ç† bean çš„ç”Ÿå‘½å‘¨æœŸã€é…ç½®æ–‡ä»¶çš„åŠ è½½å’Œè§£æã€bean çš„è£…é…å’Œä¾èµ–æ³¨å…¥ç­‰ã€‚BeanFactory æ¥å£æä¾›äº†è®¿é—® bean çš„æ–¹å¼ï¼Œä¾‹å¦‚ getBean() æ–¹æ³•è·å–æŒ‡å®šçš„ bean å®ä¾‹ã€‚å®ƒå¯ä»¥ä»ä¸åŒçš„æ¥æºï¼ˆä¾‹å¦‚ Mysql æ•°æ®åº“ã€XML æ–‡ä»¶ã€Java é…ç½®ç±»ç­‰ï¼‰è·å– bean å®šä¹‰ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º bean å®ä¾‹ã€‚åŒæ—¶ï¼ŒBeanFactory è¿˜åŒ…å«å¾ˆå¤šå­ç±»ï¼ˆä¾‹å¦‚ï¼ŒApplicationContext æ¥å£ï¼‰æä¾›äº†é¢å¤–çš„å¼ºå¤§åŠŸèƒ½ã€‚

    æ€»çš„æ¥è¯´ï¼ŒFactoryBean å’Œ BeanFactory çš„åŒºåˆ«ä¸»è¦åœ¨äºå‰è€…æ˜¯ç”¨äºåˆ›å»º bean çš„æ¥å£ï¼Œå®ƒæä¾›äº†æ›´åŠ çµæ´»çš„åˆå§‹åŒ–å®šåˆ¶åŠŸèƒ½ï¼Œè€Œåè€…æ˜¯ç”¨äºç®¡ç† bean çš„æ¡†æ¶åŸºç¡€æ¥å£ï¼Œæä¾›äº†åŸºæœ¬çš„å®¹å™¨åŠŸèƒ½å’Œ bean ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

#### 4.2.6 å®éªŒå…­ï¼š åŸºäºXMLæ–¹å¼æ•´åˆä¸‰å±‚æ¶æ„ç»„ä»¶

1.  éœ€æ±‚åˆ†æ

    æ­å»ºä¸€ä¸ªä¸‰å±‚æ¶æ„æ¡ˆä¾‹ï¼Œæ¨¡æ‹ŸæŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿï¼ˆå­¦ç”Ÿè¡¨ï¼‰ä¿¡æ¯ï¼ŒæŒä¹…å±‚ä½¿ç”¨JdbcTemplateå’ŒDruidæŠ€æœ¯ï¼Œä½¿ç”¨XMLæ–¹å¼è¿›è¡Œç»„ä»¶ç®¡ç†ï¼

    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/e24f5d09bc817b9c7a14ffb6a6135390.png)


2.  æ•°æ®åº“å‡†å¤‡
    ```java
    create database studb;

    use studb;

    CREATE TABLE students (
      id INT PRIMARY KEY,
      name VARCHAR(50) NOT NULL,
      gender VARCHAR(10) NOT NULL,
      age INT,
      class VARCHAR(50)
    );

    INSERT INTO students (id, name, gender, age, class)
    VALUES
      (1, 'å¼ ä¸‰', 'ç”·', 20, 'é«˜ä¸­ä¸€ç­'),
      (2, 'æå››', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (3, 'ç‹äº”', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (4, 'èµµå…­', 'å¥³', 20, 'é«˜ä¸­ä¸‰ç­'),
      (5, 'åˆ˜ä¸ƒ', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (6, 'é™ˆå…«', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (7, 'æ¨ä¹', 'ç”·', 20, 'é«˜ä¸­ä¸‰ç­'),
      (8, 'å´å', 'ç”·', 19, 'é«˜ä¸­äºŒç­');

    ```

3.  é¡¹ç›®å‡†å¤‡
    1.  é¡¹ç›®åˆ›å»º

        spring-xml-practice-02
    2.  ä¾èµ–å¯¼å…¥
        ```xml
        <dependencies>
              <!--spring contextä¾èµ–-->
              <!--å½“ä½ å¼•å…¥SpringContextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-context</artifactId>
                  <version>6.0.6</version>
              </dependency>

              <!-- æ•°æ®åº“é©±åŠ¨å’Œè¿æ¥æ± -->
              <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
                  <version>8.0.25</version>
              </dependency>

              <dependency>
                  <groupId>com.alibaba</groupId>
                  <artifactId>druid</artifactId>
                  <version>1.2.8</version>
              </dependency>

              <!-- spring-jdbc -->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-jdbc</artifactId>
                  <version>6.0.6</version>
              </dependency>

        </dependencies> 
        ```

	3.  å®ä½“ç±»å‡†å¤‡
        ```java
        public class Student {

            private Integer id;
            private String name;
            private String gender;
            private Integer age;
            private String classes;

            public Integer getId() {
                return id;
            }

            public void setId(Integer id) {
                this.id = id;
            }

            public String getName() {
                return name;
            }

            public void setName(String name) {
                this.name = name;
            }

            public String getGender() {
                return gender;
            }

            public void setGender(String gender) {
                this.gender = gender;
            }

            public Integer getAge() {
                return age;
            }

            public void setAge(Integer age) {
                this.age = age;
            }

            public String getClasses() {
                return classes;
            }

            public void setClasses(String classes) {
                this.classes = classes;
            }

            @Override
            public String toString() {
                return "Student{" +
                        "id=" + id +
                        ", name='" + name + '\'' +
                        ", gender='" + gender + '\'' +
                        ", age=" + age +
                        ", classes='" + classes + '\'' +
                        '}';
            }
        }

        ```

4.  JdbcTemplateæŠ€æœ¯è®²è§£
    > ä¸ºäº†åœ¨ç‰¹å®šé¢†åŸŸå¸®åŠ©æˆ‘ä»¬ç®€åŒ–ä»£ç ï¼ŒSpring å°è£…äº†å¾ˆå¤š ã€Templateã€å½¢å¼çš„æ¨¡æ¿ç±»ã€‚ä¾‹å¦‚ï¼šRedisTemplateã€RestTemplate ç­‰ç­‰ï¼ŒåŒ…æ‹¬æˆ‘ä»¬ä»Šå¤©è¦å­¦ä¹ çš„ JdbcTemplateã€‚

    > jdbc.properties
    æå–æ•°æ®åº“è¿æ¥ä¿¡æ¯
    ```.properties
    atguigu.url=jdbc:mysql://localhost:3306/studb
    atguigu.driver=com.mysql.cj.jdbc.Driver
    atguigu.username=root
    atguigu.password=root
    ```

	springiocé…ç½®æ–‡ä»¶
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd 
           http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


        <!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
        <context:property-placeholder location="classpath:jdbc.properties" />

        <!-- é…ç½®æ•°æ®æº -->
        <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
            <property name="url" value="${atguigu.url}"/>
            <property name="driverClassName" value="${atguigu.driver}"/>
            <property name="username" value="${atguigu.username}"/>
            <property name="password" value="${atguigu.password}"/>
        </bean>

        <!-- é…ç½® JdbcTemplate -->
        <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
            <!-- è£…é…æ•°æ®æº -->
            <property name="dataSource" ref="druidDataSource"/>
        </bean>
        
    </beans>
    ```

	åŸºäºjdbcTemplateçš„CRUDä½¿ç”¨
    ```java
    public class JdbcTemplateTest {
        /**
         * ä½¿ç”¨jdbcTemplateè¿›è¡ŒDMLåŠ¨ä½œ
         */
        @Test
        public void testDML(){
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            JdbcTemplate jdbcTemplate = applicationContext.getBean(JdbcTemplate.class);
            //TODO æ‰§è¡Œæ’å…¥ä¸€æ¡å­¦å‘˜æ•°æ®
            String sql = "insert into students (id,name,gender,age,class) values (?,?,?,?,?);";
        /*
            å‚æ•°1: sqlè¯­å¥
            å‚æ•°2: å¯å˜å‚æ•°,å ä½ç¬¦çš„å€¼
         */
            int rows = jdbcTemplate.update(sql, 9,"åä¸€", "ç”·", 18, "äºŒå¹´ä¸‰ç­");

            System.out.println("rows = " + rows);

        }

        /**
         * æŸ¥è¯¢å•æ¡å®ä½“å¯¹è±¡
         *   public class Student {
         *     private Integer id;
         *     private String name;
         *     private String gender;
         *     private Integer age;
         *     private String classes;
         */
        @Test
        public void testDQLForPojo(){
            String sql = "select id , name , age , gender , class as classes from students where id = ? ;";
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            JdbcTemplate jdbcTemplate = applicationContext.getBean(JdbcTemplate.class);
            //æ ¹æ®idæŸ¥è¯¢
            Student student = jdbcTemplate.queryForObject(sql,  (rs, rowNum) -> {
                //è‡ªå·±å¤„ç†ç»“æœæ˜ å°„
                Student stu = new Student();
                stu.setId(rs.getInt("id"));
                stu.setName(rs.getString("name"));
                stu.setAge(rs.getInt("age"));
                stu.setGender(rs.getString("gender"));
                stu.setClasses(rs.getString("classes"));
                return stu;
            }, 2);

            System.out.println("student = " + student);
        }



        /**
         * æŸ¥è¯¢å®ä½“ç±»é›†åˆ
         */
        @Test
        public void testDQLForListPojo(){

            String sql = "select id , name , age , gender , class as classes from students  ;";
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            JdbcTemplate jdbcTemplate = applicationContext.getBean(JdbcTemplate.class);
        /*
            queryå¯ä»¥è¿”å›é›†åˆ!
            BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
         */
            List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));
            System.out.println("studentList = " + studentList);
        }
    }

    ```

5.  ä¸‰å±‚æ¶æ„æ­å»ºå’Œå®ç°
    1.  æŒä¹…å±‚
        ```java
        //æ¥å£
        public interface StudentDao {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            List<Student> queryAll();
        }

        //å®ç°ç±»
        public class StudentDaoImpl implements StudentDao {
            private JdbcTemplate jdbcTemplate;
            public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {
                this.jdbcTemplate = jdbcTemplate;
            }

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            @Override
            public List<Student> queryAll() {
                String sql = "select id , name , age , gender , class as classes from students ;";
                /*
                  queryå¯ä»¥è¿”å›é›†åˆ!
                  BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
                 */
                List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));
                return studentList;
           }
        }

        ```
    2.  ä¸šåŠ¡å±‚
        ```java
        //æ¥å£
        public interface StudentService {
            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            List<Student> findAll();
        }

        //å®ç°ç±»
        public class StudentServiceImpl  implements StudentService {

            private StudentDao studentDao;
            public void setStudentDao(StudentDao studentDao) {
                this.studentDao = studentDao;
            }

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            @Override
            public List<Student> findAll() {
                List<Student> studentList =  studentDao.queryAll();
                return studentList;
            }
        }

        ```
    3.  è¡¨è¿°å±‚
        ```java
        public class StudentController {
            
            private StudentService studentService;

            public void setStudentService(StudentService studentService) {
                this.studentService = studentService;
            }
            
            public void  findAll(){
               List<Student> studentList =  studentService.findAll();
                System.out.println("studentList = " + studentList);
            }
        }
        ```
6.  ä¸‰å±‚æ¶æ„IoCé…ç½®
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


        <!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
        <context:property-placeholder location="classpath:jdbc.properties" />

        <!-- é…ç½®æ•°æ®æº -->
        <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
            <property name="url" value="${atguigu.url}"/>
            <property name="driverClassName" value="${atguigu.driver}"/>
            <property name="username" value="${atguigu.username}"/>
            <property name="password" value="${atguigu.password}"/>
        </bean>

        <!-- é…ç½® JdbcTemplate -->
        <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
            <!-- è£…é…æ•°æ®æº -->
            <property name="dataSource" ref="druidDataSource"/>
        </bean>


        <bean id="studentDao" class="com.atguigu.dao.impl.StudentDaoImpl">
            <property name="jdbcTemplate" ref="jdbcTemplate" />
        </bean>

        <bean id="studentService" class="com.atguigu.service.impl.StudentServiceImpl">
            <property name="studentDao" ref="studentDao" />
        </bean>

        <bean id="studentController" class="com.atguigu.controller.StudentController">
            <property name="studentService" ref="studentService" />
        </bean>

    </beans>
    ```
7.  è¿è¡Œæµ‹è¯•
    ```java
    public class ControllerTest {

        @Test
        public  void testRun(){
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            StudentController studentController = applicationContext.getBean(StudentController.class);
            studentController.findAll();
        }
    }
    ```

8.  XMLIoCæ–¹å¼é—®é¢˜æ€»ç»“
    1.  æ³¨å…¥çš„å±æ€§å¿…é¡»æ·»åŠ setteræ–¹æ³•ã€ä»£ç ç»“æ„ä¹±ï¼
    2.  é…ç½®æ–‡ä»¶å’ŒJavaä»£ç åˆ†ç¦»ã€ç¼–å†™ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼
    3.  XMLé…ç½®æ–‡ä»¶è§£ææ•ˆç‡ä½

### 4.3 åŸºäº æ³¨è§£ æ–¹å¼ç®¡ç† Bean

#### 4.3.1 å®éªŒä¸€ï¼š Beanæ³¨è§£æ ‡è®°å’Œæ‰«æ (IoC)

1.  **æ³¨è§£ç†è§£**

    å’Œ XML é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œæ³¨è§£æœ¬èº«å¹¶ä¸èƒ½æ‰§è¡Œï¼Œæ³¨è§£æœ¬èº«ä»…ä»…åªæ˜¯åšä¸€ä¸ªæ ‡è®°ï¼Œå…·ä½“çš„åŠŸèƒ½æ˜¯æ¡†æ¶æ£€æµ‹åˆ°æ³¨è§£æ ‡è®°çš„ä½ç½®ï¼Œç„¶åé’ˆå¯¹è¿™ä¸ªä½ç½®æŒ‰ç…§æ³¨è§£æ ‡è®°çš„åŠŸèƒ½æ¥æ‰§è¡Œå…·ä½“æ“ä½œã€‚

    æœ¬è´¨ä¸Šï¼šæ‰€æœ‰ä¸€åˆ‡çš„æ“ä½œéƒ½æ˜¯ Java ä»£ç æ¥å®Œæˆçš„ï¼ŒXML å’Œæ³¨è§£åªæ˜¯å‘Šè¯‰æ¡†æ¶ä¸­çš„ Java ä»£ç å¦‚ä½•æ‰§è¡Œã€‚

    ä¸¾ä¾‹ï¼šå…ƒæ—¦è”æ¬¢ä¼šè¦å¸ƒç½®æ•™å®¤ï¼Œè“è‰²çš„åœ°æ–¹è´´ä¸Šå…ƒæ—¦å¿«ä¹å››ä¸ªå­—ï¼Œçº¢è‰²çš„åœ°æ–¹è´´ä¸Šæ‹‰èŠ±ï¼Œé»„è‰²çš„åœ°æ–¹è´´ä¸Šæ°”çƒã€‚

    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fff3969c25a6d2600fa10cbbb1966618.png)



    ç­é•¿åšäº†æ‰€æœ‰æ ‡è®°ï¼ŒåŒå­¦ä»¬æ¥å®Œæˆå…·ä½“å·¥ä½œã€‚å¢™ä¸Šçš„æ ‡è®°ç›¸å½“äºæˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨çš„æ³¨è§£ï¼Œåé¢åŒå­¦ä»¬åšçš„å·¥ä½œï¼Œç›¸å½“äºæ¡†æ¶çš„å…·ä½“æ“ä½œã€‚

2.  **æ‰«æç†è§£**

    Spring ä¸ºäº†çŸ¥é“ç¨‹åºå‘˜åœ¨å“ªäº›åœ°æ–¹æ ‡è®°äº†ä»€ä¹ˆæ³¨è§£ï¼Œå°±éœ€è¦é€šè¿‡æ‰«æçš„æ–¹å¼ï¼Œæ¥è¿›è¡Œæ£€æµ‹ã€‚ç„¶åæ ¹æ®æ³¨è§£è¿›è¡Œåç»­æ“ä½œã€‚

3.  **å‡†å¤‡Springé¡¹ç›®å’Œç»„ä»¶**
    1.  å‡†å¤‡é¡¹ç›®pom.xml
        ```xml
        <dependencies>
            <!--spring contextä¾èµ–-->
            <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-context</artifactId>
                <version>6.0.6</version>
            </dependency>

            <!--junit5æµ‹è¯•-->
            <dependency>
                <groupId>org.junit.jupiter</groupId>
                <artifactId>junit-jupiter-api</artifactId>
                <version>5.3.1</version>
            </dependency>
        </dependencies>
        ```
    2.  å‡†å¤‡ç»„ä»¶ç±»

        æ™®é€šç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: æ™®é€šçš„ç»„ä»¶
         */
        public class CommonComponent {
        }

        ```
        Controllerç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: controllerç±»å‹ç»„ä»¶
         */
        public class XxxController {
        }

        ```
        Serviceç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: serviceç±»å‹ç»„ä»¶
         */
        public class XxxService {
        }

        ```
        Daoç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: daoç±»å‹ç»„ä»¶
         */
        public class XxxDao {
        }

        ```

4.  **ç»„ä»¶æ·»åŠ æ ‡è®°æ³¨è§£**
    1.  ç»„ä»¶æ ‡è®°æ³¨è§£å’ŒåŒºåˆ«

        Spring æä¾›äº†ä»¥ä¸‹å¤šä¸ªæ³¨è§£ï¼Œè¿™äº›æ³¨è§£å¯ä»¥ç›´æ¥æ ‡æ³¨åœ¨ Java ç±»ä¸Šï¼Œå°†å®ƒä»¬å®šä¹‰æˆ Spring Beanã€‚
        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/443624052e46b3a5db4d472093c12f53.png)  
        é€šè¿‡æŸ¥çœ‹æºç æˆ‘ä»¬å¾—çŸ¥ï¼Œ@Controllerã€@Serviceã€@Repositoryè¿™ä¸‰ä¸ªæ³¨è§£åªæ˜¯åœ¨@Componentæ³¨è§£çš„åŸºç¡€ä¸Šèµ·äº†ä¸‰ä¸ªæ–°çš„åå­—ã€‚

        å¯¹äºSpringä½¿ç”¨IOCå®¹å™¨ç®¡ç†è¿™äº›ç»„ä»¶æ¥è¯´æ²¡æœ‰åŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯è¯­æ³•å±‚é¢æ²¡æœ‰åŒºåˆ«ã€‚æ‰€ä»¥@Controllerã€@Serviceã€@Repositoryè¿™ä¸‰ä¸ªæ³¨è§£åªæ˜¯ç»™å¼€å‘äººå‘˜çœ‹çš„ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿä¾¿äºåˆ†è¾¨ç»„ä»¶çš„ä½œç”¨ã€‚

        æ³¨æ„ï¼šè™½ç„¶å®ƒä»¬æœ¬è´¨ä¸Šä¸€æ ·ï¼Œä½†æ˜¯ä¸ºäº†ä»£ç çš„å¯è¯»æ€§ã€ç¨‹åºç»“æ„ä¸¥è°¨ï¼æˆ‘ä»¬è‚¯å®šä¸èƒ½éšä¾¿èƒ¡ä¹±æ ‡è®°ã€‚

	2.  ä½¿ç”¨æ³¨è§£æ ‡è®°

        æ™®é€šç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: æ™®é€šçš„ç»„ä»¶
         */
        @Component
        public class CommonComponent {
        }

        ```
        Controllerç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: controllerç±»å‹ç»„ä»¶
         */
        @Controller
        public class XxxController {
        }

        ```
        Serviceç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: serviceç±»å‹ç»„ä»¶
         */
        @Service
        public class XxxService {
        }

        ```
        Daoç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: daoç±»å‹ç»„ä»¶
         */
        @Repository
        public class XxxDao {
        }

        ```

5.  **é…ç½®æ–‡ä»¶ç¡®å®šæ‰«æèŒƒå›´**

    æƒ…å†µ1ï¼šåŸºæœ¬æ‰«æé…ç½®
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">
        <!-- é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ… -->
        <!-- 1.åŒ…è¦ç²¾å‡†,æé«˜æ€§èƒ½!
             2.ä¼šæ‰«ææŒ‡å®šçš„åŒ…å’Œå­åŒ…å†…å®¹
             3.å¤šä¸ªåŒ…å¯ä»¥ä½¿ç”¨,åˆ†å‰² ä¾‹å¦‚: com.atguigu.controller,com.atguigu.serviceç­‰
        -->
        <context:component-scan base-package="com.atguigu.components"/>
      
    </beans>
    ```
    æƒ…å†µ2ï¼šæŒ‡å®šæ’é™¤ç»„ä»¶
    ```xml
    <!-- æƒ…å†µä¸‰ï¼šæŒ‡å®šä¸æ‰«æçš„ç»„ä»¶ -->
    <context:component-scan base-package="com.atguigu.components">
        
        <!-- context:exclude-filteræ ‡ç­¾ï¼šæŒ‡å®šæ’é™¤è§„åˆ™ -->
        <!-- typeå±æ€§ï¼šæŒ‡å®šæ ¹æ®ä»€ä¹ˆæ¥è¿›è¡Œæ’é™¤ï¼Œannotationå–å€¼è¡¨ç¤ºæ ¹æ®æ³¨è§£æ¥æ’é™¤ -->
        <!-- expressionå±æ€§ï¼šæŒ‡å®šæ’é™¤è§„åˆ™çš„è¡¨è¾¾å¼ï¼Œå¯¹äºæ³¨è§£æ¥è¯´æŒ‡å®šå…¨ç±»åå³å¯ -->
        <context:exclude-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
    </context:component-scan>
    ```
    æƒ…å†µ3ï¼šæŒ‡å®šæ‰«æç»„ä»¶
    ```xml
    <!-- æƒ…å†µå››ï¼šä»…æ‰«ææŒ‡å®šçš„ç»„ä»¶ -->
    <!-- ä»…æ‰«æ = å…³é—­é»˜è®¤è§„åˆ™ + è¿½åŠ è§„åˆ™ -->
    <!-- use-default-filterså±æ€§ï¼šå–å€¼falseè¡¨ç¤ºå…³é—­é»˜è®¤æ‰«æè§„åˆ™ -->
    <context:component-scan base-package="com.atguigu.ioc.components" use-default-filters="false">
        
        <!-- context:include-filteræ ‡ç­¾ï¼šæŒ‡å®šåœ¨åŸæœ‰æ‰«æè§„åˆ™çš„åŸºç¡€ä¸Šè¿½åŠ çš„è§„åˆ™ -->
        <context:include-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
    </context:component-scan>
    ```

6.  **ç»„ä»¶BeanNameé—®é¢˜**

    åœ¨æˆ‘ä»¬ä½¿ç”¨ XML æ–¹å¼ç®¡ç† bean çš„æ—¶å€™ï¼Œæ¯ä¸ª bean éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†â€”â€”id å±æ€§çš„å€¼ï¼Œä¾¿äºåœ¨å…¶ä»–åœ°æ–¹å¼•ç”¨ã€‚ç°åœ¨ä½¿ç”¨æ³¨è§£åï¼Œæ¯ä¸ªç»„ä»¶ä»ç„¶åº”è¯¥æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ã€‚

    é»˜è®¤æƒ…å†µï¼š

    ç±»åé¦–å­—æ¯å°å†™å°±æ˜¯ bean çš„ idã€‚ä¾‹å¦‚ï¼šSoldierController ç±»å¯¹åº”çš„ bean çš„ id å°±æ˜¯ soldierControllerã€‚

    ä½¿ç”¨valueå±æ€§æŒ‡å®šï¼š
    ```java
    @Controller(value = "tianDog")
    public class SoldierController {
    }
    ```
    å½“æ³¨è§£ä¸­åªè®¾ç½®ä¸€ä¸ªå±æ€§æ—¶ï¼Œvalueå±æ€§çš„å±æ€§åå¯ä»¥çœç•¥ï¼š
    ```java
    @Service("smallDog")
    public class SoldierService {
    }
    ```

7.  **æ€»ç»“**
    1.  æ³¨è§£æ–¹å¼IoCåªæ˜¯æ ‡è®°å“ªäº›ç±»è¦è¢«Springç®¡ç†
    2.  æœ€ç»ˆï¼Œæˆ‘ä»¬è¿˜éœ€è¦XMLæ–¹å¼æˆ–è€…åé¢è®²è§£Javaé…ç½®ç±»æ–¹å¼æŒ‡å®šæ³¨è§£ç”Ÿæ•ˆçš„åŒ…
    3.  **ç°é˜¶æ®µé…ç½®æ–¹å¼ä¸º æ³¨è§£ ï¼ˆæ ‡è®°ï¼‰+ XMLï¼ˆæ‰«æï¼‰**

#### 4.3.2 å®éªŒäºŒï¼š ç»„ä»¶ï¼ˆBeanï¼‰ä½œç”¨åŸŸå’Œå‘¨æœŸæ–¹æ³•æ³¨è§£;

1.  ç»„ä»¶å‘¨æœŸæ–¹æ³•é…ç½®
    1.  å‘¨æœŸæ–¹æ³•æ¦‚å¿µ

        æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ç±»ä¸­å®šä¹‰æ–¹æ³•ï¼Œç„¶åå½“IoCå®¹å™¨å®ä¾‹åŒ–å’Œé”€æ¯ç»„ä»¶å¯¹è±¡çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ï¼è¿™ä¸¤ä¸ªæ–¹æ³•æˆ‘ä»¬æˆä¸ºç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼

        ç±»ä¼¼äºServletçš„init/destroyæ–¹æ³•,æˆ‘ä»¬å¯ä»¥åœ¨å‘¨æœŸæ–¹æ³•å®Œæˆåˆå§‹åŒ–å’Œé‡Šæ”¾èµ„æºç­‰å·¥ä½œã€‚
    2.  å‘¨æœŸæ–¹æ³•å£°æ˜
        ```java
        public class BeanOne {

          //å‘¨æœŸæ–¹æ³•è¦æ±‚ï¼š æ–¹æ³•å‘½åéšæ„ï¼Œä½†æ˜¯è¦æ±‚æ–¹æ³•å¿…é¡»æ˜¯ public void æ— å½¢å‚åˆ—è¡¨
          @PostConstruct  //æ³¨è§£åˆ¶æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
          public void init() {
            // åˆå§‹åŒ–é€»è¾‘
          }
        }

        public class BeanTwo {
          
          @PreDestroy //æ³¨è§£æŒ‡å®šé”€æ¯æ–¹æ³•
          public void cleanup() {
            // é‡Šæ”¾èµ„æºé€»è¾‘
          }
        }
        ```

2.  ç»„ä»¶ä½œç”¨åŸŸé…ç½®
    1.  Beanä½œç”¨åŸŸæ¦‚å¿µ

        `<bean` æ ‡ç­¾å£°æ˜Beanï¼Œåªæ˜¯å°†Beançš„ä¿¡æ¯é…ç½®ç»™SpringIoCå®¹å™¨ï¼

        åœ¨IoCå®¹å™¨ä¸­ï¼Œè¿™äº›`<bean`æ ‡ç­¾å¯¹åº”çš„ä¿¡æ¯è½¬æˆSpringå†…éƒ¨ `BeanDefinition` å¯¹è±¡ï¼Œ`BeanDefinition` å¯¹è±¡å†…ï¼ŒåŒ…å«å®šä¹‰çš„ä¿¡æ¯ï¼ˆid,class,å±æ€§ç­‰ç­‰ï¼‰ï¼

        è¿™æ„å‘³ç€ï¼Œ`BeanDefinition`ä¸`ç±»`æ¦‚å¿µä¸€æ ·ï¼ŒSpringIoCå®¹å™¨å¯ä»¥å¯ä»¥æ ¹æ®`BeanDefinition`å¯¹è±¡åå°„åˆ›å»ºå¤šä¸ªBeanå¯¹è±¡å®ä¾‹ã€‚

        å…·ä½“åˆ›å»ºå¤šå°‘ä¸ªBeançš„å®ä¾‹å¯¹è±¡ï¼Œç”±Beançš„ä½œç”¨åŸŸScopeå±æ€§æŒ‡å®šï¼

	2.  ä½œç”¨åŸŸå¯é€‰å€¼![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/11efe06e9d6cd29a79d63ae347d5fe2a.png)


        
    3.  ä½œç”¨åŸŸé…ç½®
        ```java
        @Scope(scopeName = ConfigurableBeanFactory.SCOPE_SINGLETON) //å•ä¾‹,é»˜è®¤å€¼
        @Scope(scopeName = ConfigurableBeanFactory.SCOPE_PROTOTYPE) //å¤šä¾‹  äºŒé€‰ä¸€
        public class BeanOne {

          //å‘¨æœŸæ–¹æ³•è¦æ±‚ï¼š æ–¹æ³•å‘½åéšæ„ï¼Œä½†æ˜¯è¦æ±‚æ–¹æ³•å¿…é¡»æ˜¯ public void æ— å½¢å‚åˆ—è¡¨
          @PostConstruct  //æ³¨è§£åˆ¶æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
          public void init() {
            // åˆå§‹åŒ–é€»è¾‘
          }
        }
        ```

#### 4.3.3 å®éªŒä¸‰ï¼š Beanå±æ€§èµ‹å€¼ï¼šå¼•ç”¨ç±»å‹è‡ªåŠ¨è£…é… (DI)

1.  **è®¾å®šåœºæ™¯**
    -   SoldierController éœ€è¦ SoldierService
    -   SoldierService éœ€è¦ SoldierDao
         åŒæ—¶åœ¨å„ä¸ªç»„ä»¶ä¸­å£°æ˜è¦è°ƒç”¨çš„æ–¹æ³•ã€‚
    -   SoldierControllerä¸­å£°æ˜æ–¹æ³•
        ```java
        import org.springframework.stereotype.Controller;

        @Controller(value = "tianDog")
        public class SoldierController {
            private SoldierService soldierService;
            public void getMessage() {
                soldierService.getMessage();
            }
        }
        ```
    -   SoldierServiceä¸­å£°æ˜æ–¹æ³•
        ```java
        @Service("smallDog")
        public class SoldierService {
            private SoldierDao soldierDao;
            public void getMessage() {
                soldierDao.getMessage();
            }
        }
        ```
    -   SoldierDaoä¸­å£°æ˜æ–¹æ³•
        ```java
        @Repository
        public class SoldierDao {
            public void getMessage() {
                System.out.print("I am a soldier");
            }

        }
        ```

2.  **è‡ªåŠ¨è£…é…å®ç°**
    1.  å‰æ

        å‚ä¸è‡ªåŠ¨è£…é…çš„ç»„ä»¶ï¼ˆéœ€è¦è£…é…ã€è¢«è£…é…ï¼‰å…¨éƒ¨éƒ½å¿…é¡»åœ¨IoCå®¹å™¨ä¸­ã€‚

        æ³¨æ„ï¼šä¸åŒºåˆ†IoCçš„æ–¹å¼ï¼XMLå’Œæ³¨è§£éƒ½å¯ä»¥ï¼

	2.  `@Autowiredæ³¨è§£`

        åœ¨æˆå‘˜å˜é‡ä¸Šç›´æ¥æ ‡è®°@Autowiredæ³¨è§£å³å¯ï¼Œä¸éœ€è¦æä¾›setXxx()æ–¹æ³•ã€‚ä»¥åæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­çš„æ­£å¼ç”¨æ³•å°±æ˜¯è¿™æ ·ã€‚

	3.  ç»™Controllerè£…é…Service
        ```java
        @Controller(value = "tianDog")
        public class SoldierController {
            
            @Autowired
            private SoldierService soldierService;
            
            public void getMessage() {
                soldierService.getMessage();
            }
            
        }
        ```
    4.  ç»™Serviceè£…é…Dao
        ```java
        @Service("smallDog")
        public class SoldierService {
            
            @Autowired
            private SoldierDao soldierDao;
            
            public void getMessage() {
                soldierDao.getMessage();
            }
        }
        ```
3.  **@Autowiredæ³¨è§£ç»†èŠ‚**
    1.  æ ‡è®°ä½ç½®
        1.  æˆå‘˜å˜é‡

            è¿™æ˜¯æœ€ä¸»è¦çš„ä½¿ç”¨æ–¹å¼ï¼

            ä¸xmlè¿›è¡Œbean refå¼•ç”¨ä¸åŒï¼Œä»–ä¸éœ€è¦æœ‰setæ–¹æ³•ï¼
            ```java
            @Service("smallDog")
            public class SoldierService {
                
                @Autowired
                private SoldierDao soldierDao;
                
                public void getMessage() {
                    soldierDao.getMessage();
                }
            }
            ```
        2.  æ„é€ å™¨
            ```java
            @Controller(value = "tianDog")
            public class SoldierController {
                
                private SoldierService soldierService;
                
                @Autowired
                public SoldierController(SoldierService soldierService) {
                    this.soldierService = soldierService;
                }
                â€¦â€¦
            ```
        3.  setXxx()æ–¹æ³•
            ```java
            @Controller(value = "tianDog")
            public class SoldierController {

                private SoldierService soldierService;

                @Autowired
                public void setSoldierService(SoldierService soldierService) {
                    this.soldierService = soldierService;
                }
                â€¦â€¦
            ```
    2.  å·¥ä½œæµç¨‹

        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ebb0bb0670238bf1910015870b488027.png)


        -   é¦–å…ˆæ ¹æ®æ‰€éœ€è¦çš„ç»„ä»¶ç±»å‹åˆ° IOC å®¹å™¨ä¸­æŸ¥æ‰¾
            -   èƒ½å¤Ÿæ‰¾åˆ°å”¯ä¸€çš„ beanï¼šç›´æ¥æ‰§è¡Œè£…é…
            -   å¦‚æœå®Œå…¨æ‰¾ä¸åˆ°åŒ¹é…è¿™ä¸ªç±»å‹çš„ beanï¼šè£…é…å¤±è´¥
            -   å’Œæ‰€éœ€ç±»å‹åŒ¹é…çš„ bean ä¸æ­¢ä¸€ä¸ª
                -   æ²¡æœ‰ @Qualifier æ³¨è§£ï¼šæ ¹æ® @Autowired æ ‡è®°ä½ç½®æˆå‘˜å˜é‡çš„å˜é‡åä½œä¸º bean çš„ id è¿›è¡ŒåŒ¹é…
                    -   èƒ½å¤Ÿæ‰¾åˆ°ï¼šæ‰§è¡Œè£…é…
                    -   æ‰¾ä¸åˆ°ï¼šè£…é…å¤±è´¥
                -   ä½¿ç”¨ @Qualifier æ³¨è§£ï¼šæ ¹æ® @Qualifier æ³¨è§£ä¸­æŒ‡å®šçš„åç§°ä½œä¸º bean çš„idè¿›è¡ŒåŒ¹é…
                    -   èƒ½å¤Ÿæ‰¾åˆ°ï¼šæ‰§è¡Œè£…é…
                    -   æ‰¾ä¸åˆ°ï¼šè£…é…å¤±è´¥
        ```java
        @Controller(value = "tianDog")
        public class SoldierController {
            
            @Autowired
            @Qualifier(value = "maomiService222")
            // æ ¹æ®é¢å‘æ¥å£ç¼–ç¨‹æ€æƒ³ï¼Œä½¿ç”¨æ¥å£ç±»å‹å¼•å…¥Serviceç»„ä»¶
            private ISoldierService soldierService;
        ```

4.  **ä½›ç³»è£…é…**

    ç»™ @Autowired æ³¨è§£è®¾ç½® required = false å±æ€§è¡¨ç¤ºï¼šèƒ½è£…å°±è£…ï¼Œè£…ä¸ä¸Šå°±ä¸è£…ã€‚ä½†æ˜¯å®é™…å¼€å‘æ—¶ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰éœ€è¦è£…é…ç»„ä»¶çš„åœ°æ–¹éƒ½æ˜¯å¿…é¡»è£…é…çš„ï¼Œç”¨ä¸ä¸Šè¿™ä¸ªå±æ€§
    ```java
    @Controller(value = "tianDog")
    public class SoldierController {

        // ç»™@Autowiredæ³¨è§£è®¾ç½®required = falseå±æ€§è¡¨ç¤ºï¼šèƒ½è£…å°±è£…ï¼Œè£…ä¸ä¸Šå°±ä¸è£…
        @Autowired(required = false)
        private ISoldierService soldierService;
    ```

5.  **æ‰©å±•JSR-250æ³¨è§£@Resource**
    -   ç†è§£JSRç³»åˆ—æ³¨è§£

        JSRï¼ˆJava Specification Requestsï¼‰æ˜¯Javaå¹³å°æ ‡å‡†åŒ–è¿›ç¨‹ä¸­çš„ä¸€ç§æŠ€æœ¯è§„èŒƒï¼Œè€ŒJSRæ³¨è§£æ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†é‡è¦çš„å†…å®¹ã€‚æŒ‰ç…§JSRçš„åˆ†ç±»ä»¥åŠæ³¨è§£è¯­ä¹‰çš„ä¸åŒï¼Œå¯ä»¥å°†JSRæ³¨è§£åˆ†ä¸ºä¸åŒçš„ç³»åˆ—ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç³»åˆ—ï¼š
        1.  JSR-175: è¿™ä¸ªJSRæ˜¯Java SE 5å¼•å…¥çš„ï¼Œæ˜¯Javaæ³¨è§£æœ€æ—©çš„è§„èŒƒåŒ–ç‰ˆæœ¬ï¼ŒJava SE 5åçš„ç‰ˆæœ¬ä¸­éƒ½åŒ…å«è¯¥JSRä¸­å®šä¹‰çš„æ³¨è§£ã€‚ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§æ ‡å‡†æ³¨è§£ï¼š
        -   `@Deprecated`: æ ‡è¯†ä¸€ä¸ªç¨‹åºå…ƒç´ ï¼ˆå¦‚ç±»ã€æ–¹æ³•æˆ–å­—æ®µï¼‰å·²è¿‡æ—¶ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«åˆ é™¤ã€‚
        -   `@Override`: æ ‡è¯†ä¸€ä¸ªæ–¹æ³•é‡å†™äº†çˆ¶ç±»ä¸­çš„æ–¹æ³•ã€‚
        -   `@SuppressWarnings`: æŠ‘åˆ¶ç¼–è¯‘æ—¶äº§ç”Ÿçš„è­¦å‘Šæ¶ˆæ¯ã€‚
        -   `@SafeVarargs`: æ ‡è¯†ä¸€ä¸ªæœ‰å®‰å…¨æ€§è­¦å‘Šçš„å¯å˜å‚æ•°æ–¹æ³•ã€‚
        -   `@FunctionalInterface`: æ ‡è¯†ä¸€ä¸ªæ¥å£åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¯ä»¥ä½œä¸ºlambdaè¡¨è¾¾å¼çš„ç›®æ ‡ã€‚
        1.  JSR-250: è¿™ä¸ªJSRä¸»è¦ç”¨äºåœ¨Java EE 5ä¸­å®šä¹‰ä¸€äº›æ”¯æŒæ³¨è§£ã€‚è¯¥JSRä¸»è¦å®šä¹‰äº†ä¸€äº›ç”¨äºè¿›è¡Œå¯¹è±¡ç®¡ç†çš„æ³¨è§£ï¼ŒåŒ…æ‹¬ï¼š
        -   `@Resource`: æ ‡è¯†ä¸€ä¸ªéœ€è¦æ³¨å…¥çš„èµ„æºï¼Œæ˜¯å®ç°Java EEç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»çš„ä¸€ç§æ–¹å¼ã€‚
        -   `@PostConstruct`: æ ‡è¯†ä¸€ä¸ªæ–¹æ³•ä½œä¸ºåˆå§‹åŒ–æ–¹æ³•ã€‚
        -   `@PreDestroy`: æ ‡è¯†ä¸€ä¸ªæ–¹æ³•ä½œä¸ºé”€æ¯æ–¹æ³•ã€‚
        -   `@Resource.AuthenticationType`: æ ‡è¯†æ³¨å…¥çš„èµ„æºçš„èº«ä»½éªŒè¯ç±»å‹ã€‚
        -   `@Resource.AuthenticationType`: æ ‡è¯†æ³¨å…¥çš„èµ„æºçš„é»˜è®¤åç§°ã€‚
        1.  JSR-269: è¿™ä¸ªJSRä¸»è¦æ˜¯Java SE 6ä¸­å¼•å…¥çš„ä¸€ç§æ”¯æŒç¼–è¯‘æ—¶å…ƒæ•°æ®å¤„ç†çš„æ¡†æ¶ï¼Œå³ä½¿ç”¨æ³¨è§£æ¥å¤„ç†Javaæºæ–‡ä»¶ã€‚è¯¥JSRå®šä¹‰äº†ä¸€äº›å¯ä»¥ç”¨æ³¨è§£æ ‡è®°çš„æ³¨è§£å¤„ç†å™¨ï¼Œç”¨äºç”Ÿæˆä¸€äº›å…ƒæ•°æ®ï¼Œå¸¸ç”¨çš„æ³¨è§£æœ‰ï¼š
        -   `@SupportedAnnotationTypes`: æ ‡è¯†æ³¨è§£å¤„ç†å™¨æ‰€å¤„ç†çš„æ³¨è§£ç±»å‹ã€‚
        -   `@SupportedSourceVersion`: æ ‡è¯†æ³¨è§£å¤„ç†å™¨æ”¯æŒçš„Javaæºç ç‰ˆæœ¬ã€‚
        1.  JSR-330: è¯¥JSRä¸»è¦ä¸ºJavaåº”ç”¨ç¨‹åºå®šä¹‰äº†ä¸€ä¸ªä¾èµ–æ³¨å…¥çš„æ ‡å‡†ï¼Œå³Javaä¾èµ–æ³¨å…¥æ ‡å‡†ï¼ˆjavax.injectï¼‰ã€‚åœ¨æ­¤è§„èŒƒä¸­å®šä¹‰äº†å¤šç§æ³¨è§£ï¼ŒåŒ…æ‹¬ï¼š
        -   `@Named`: æ ‡è¯†ä¸€ä¸ªè¢«ä¾èµ–æ³¨å…¥çš„ç»„ä»¶çš„åç§°ã€‚
        -   `@Inject`: æ ‡è¯†ä¸€ä¸ªéœ€è¦è¢«æ³¨å…¥çš„ä¾èµ–ç»„ä»¶ã€‚
        -   `@Singleton`: æ ‡è¯†ä¸€ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªæœ‰ä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ã€‚
        1.  JSR-250: è¿™ä¸ªJSRä¸»è¦æ˜¯Java EE 5ä¸­å®šä¹‰ä¸€äº›æ”¯æŒæ³¨è§£ã€‚è¯¥JSRåŒ…å«äº†ä¸€äº›æ”¯æŒæ³¨è§£ï¼Œå¯ä»¥ç”¨äºå¯¹Java EEç»„ä»¶è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬ï¼š
        -   `@RolesAllowed`: æ ‡è¯†æˆæƒè§’è‰²
        -   `@PermitAll`: æ ‡è¯†ä¸€ä¸ªæ´»åŠ¨æ— éœ€è¿›è¡Œèº«ä»½éªŒè¯ã€‚
        -   `@DenyAll`: æ ‡è¯†ä¸æä¾›é’ˆå¯¹è¯¥æ–¹æ³•çš„è®¿é—®æ§åˆ¶ã€‚
        -   `@DeclareRoles`: å£°æ˜å®‰å…¨è§’è‰²ã€‚
            ä½†æ˜¯ä½ è¦ç†è§£JSRæ˜¯Javaæä¾›çš„**æŠ€æœ¯è§„èŒƒ**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–åªæ˜¯è§„å®šäº†æ³¨è§£å’Œæ³¨è§£çš„å«ä¹‰ï¼Œ**JSRå¹¶ä¸æ˜¯ç›´æ¥æä¾›ç‰¹å®šçš„å®ç°**ï¼Œè€Œæ˜¯æä¾›æ ‡å‡†å’ŒæŒ‡å¯¼æ–¹é’ˆï¼Œç”±ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼ˆSpringï¼‰å’Œåº“æ¥å®ç°å’Œæä¾›å¯¹åº”çš„åŠŸèƒ½ã€‚
    -   JSR-250 @Resourceæ³¨è§£

        @Resourceæ³¨è§£ä¹Ÿå¯ä»¥å®Œæˆå±æ€§æ³¨å…¥ã€‚é‚£å®ƒå’Œ@Autowiredæ³¨è§£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
        -   @Resourceæ³¨è§£æ˜¯JDKæ‰©å±•åŒ…ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å±äºJDKçš„ä¸€éƒ¨åˆ†ã€‚æ‰€ä»¥è¯¥æ³¨è§£æ˜¯æ ‡å‡†æ³¨è§£ï¼Œæ›´åŠ å…·æœ‰é€šç”¨æ€§ã€‚(JSR-250æ ‡å‡†ä¸­åˆ¶å®šçš„æ³¨è§£ç±»å‹ã€‚JSRæ˜¯Javaè§„èŒƒææ¡ˆã€‚)
        -   @Autowiredæ³¨è§£æ˜¯Springæ¡†æ¶è‡ªå·±çš„ã€‚
        -   **@Resourceæ³¨è§£é»˜è®¤æ ¹æ®Beanåç§°è£…é…ï¼ŒæœªæŒ‡å®šnameæ—¶ï¼Œä½¿ç”¨å±æ€§åä½œä¸ºnameã€‚é€šè¿‡nameæ‰¾ä¸åˆ°çš„è¯ä¼šè‡ªåŠ¨å¯åŠ¨é€šè¿‡ç±»å‹è£…é…ã€‚**
        -   **@Autowiredæ³¨è§£é»˜è®¤æ ¹æ®ç±»å‹è£…é…ï¼Œå¦‚æœæƒ³æ ¹æ®åç§°è£…é…ï¼Œéœ€è¦é…åˆ@Qualifieræ³¨è§£ä¸€èµ·ç”¨ã€‚**
        -   @Resourceæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€‚
        -   @Autowiredæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•å‚æ•°ä¸Šã€‚
            @Resourceæ³¨è§£å±äºJDKæ‰©å±•åŒ…ï¼Œæ‰€ä»¥ä¸åœ¨JDKå½“ä¸­ï¼Œéœ€è¦é¢å¤–å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼šã€**é«˜äºJDK11æˆ–ä½äºJDK8éœ€è¦å¼•å…¥ä»¥ä¸‹ä¾èµ–**ã€‘
        ```xml
        <dependency>
            <groupId>jakarta.annotation</groupId>
            <artifactId>jakarta.annotation-api</artifactId>
            <version>2.1.1</version>
        </dependency>
        ```
    -   @Resourceä½¿ç”¨
        ```java
        @Controller
        public class XxxController {
            /**
             * 1. å¦‚æœæ²¡æœ‰æŒ‡å®šname,å…ˆæ ¹æ®å±æ€§åæŸ¥æ‰¾IoCä¸­ç»„ä»¶xxxService
             * 2. å¦‚æœæ²¡æœ‰æŒ‡å®šname,å¹¶ä¸”å±æ€§åæ²¡æœ‰å¯¹åº”çš„ç»„ä»¶,ä¼šæ ¹æ®å±æ€§ç±»å‹æŸ¥æ‰¾
             * 3. å¯ä»¥æŒ‡å®šnameåç§°æŸ¥æ‰¾!  @Resource(name='test') == @Autowired + @Qualifier(value='test')
             */
            @Resource
            private XxxService xxxService;

            //@Resource(name = "æŒ‡å®šbeanName")
            //private XxxService xxxService;

            public void show(){
                System.out.println("XxxController.show");
                xxxService.show();
            }
        }
        ```

#### 4.3.4 å®éªŒå››ï¼š Beanå±æ€§èµ‹å€¼ï¼šåŸºæœ¬ç±»å‹å±æ€§èµ‹å€¼ (DI)

`@Value` é€šå¸¸ç”¨äºæ³¨å…¥å¤–éƒ¨åŒ–å±æ€§

**å£°æ˜å¤–éƒ¨é…ç½®**

application.properties

```java
catalog.name=MovieCatalog
```

**xmlå¼•å…¥å¤–éƒ¨é…ç½®**

```java
<!-- å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶-->
<context:property-placeholder location="application.properties" />
```

**@Valueæ³¨è§£è¯»å–é…ç½®**

```java
package com.atguigu.components;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

/**
 * projectName: com.atguigu.components
 *
 * description: æ™®é€šçš„ç»„ä»¶
 */
@Component
public class CommonComponent {

    /**
     * æƒ…å†µ1: ${key} å–å¤–éƒ¨é…ç½®keyå¯¹åº”çš„å€¼!
     * æƒ…å†µ2: ${key:defaultValue} æ²¡æœ‰key,å¯ä»¥ç»™ä¸é»˜è®¤å€¼
     */
    @Value("${catalog:hahaha}")
    private String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}

```
#### 4.3.5 å®éªŒäº”ï¼š åŸºäºæ³¨è§£+XMLæ–¹å¼æ•´åˆä¸‰å±‚æ¶æ„ç»„ä»¶

1.  éœ€æ±‚åˆ†æ

    æ­å»ºä¸€ä¸ªä¸‰å±‚æ¶æ„æ¡ˆä¾‹ï¼Œæ¨¡æ‹ŸæŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿï¼ˆå­¦ç”Ÿè¡¨ï¼‰ä¿¡æ¯ï¼ŒæŒä¹…å±‚ä½¿ç”¨JdbcTemplateå’ŒDruidæŠ€æœ¯ï¼Œä½¿ç”¨XML+æ³¨è§£æ–¹å¼è¿›è¡Œç»„ä»¶ç®¡ç†ï¼
	![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b5a625c5e5513915914a39324e02e07a.png)


2.  æ•°æ®åº“å‡†å¤‡
    ```java
    create database studb;

    use studb;

    CREATE TABLE students (
      id INT PRIMARY KEY,
      name VARCHAR(50) NOT NULL,
      gender VARCHAR(10) NOT NULL,
      age INT,
      class VARCHAR(50)
    );

    INSERT INTO students (id, name, gender, age, class)
    VALUES
      (1, 'å¼ ä¸‰', 'ç”·', 20, 'é«˜ä¸­ä¸€ç­'),
      (2, 'æå››', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (3, 'ç‹äº”', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (4, 'èµµå…­', 'å¥³', 20, 'é«˜ä¸­ä¸‰ç­'),
      (5, 'åˆ˜ä¸ƒ', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (6, 'é™ˆå…«', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (7, 'æ¨ä¹', 'ç”·', 20, 'é«˜ä¸­ä¸‰ç­'),
      (8, 'å´å', 'ç”·', 19, 'é«˜ä¸­äºŒç­');

    ```
3.  é¡¹ç›®å‡†å¤‡
    1.  é¡¹ç›®åˆ›å»º

        spring-annotation-practice-04
    2.  ä¾èµ–å¯¼å…¥
        ```xml
        <dependencies>
              <!--spring contextä¾èµ–-->
              <!--å½“ä½ å¼•å…¥SpringContextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-context</artifactId>
                  <version>6.0.6</version>
              </dependency>

              <!-- æ•°æ®åº“é©±åŠ¨å’Œè¿æ¥æ± -->
              <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
                  <version>8.0.25</version>
              </dependency>

              <dependency>
                  <groupId>com.alibaba</groupId>
                  <artifactId>druid</artifactId>
                  <version>1.2.8</version>
              </dependency>
              
              <dependency>
                    <groupId>jakarta.annotation</groupId>
                    <artifactId>jakarta.annotation-api</artifactId>
                    <version>2.1.1</version>
               </dependency>

              <!-- spring-jdbc -->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-jdbc</artifactId>
                  <version>6.0.6</version>
              </dependency>

        </dependencies> 
        ```
    3.  å®ä½“ç±»å‡†å¤‡
        ```java
        public class Student {

            private Integer id;
            private String name;
            private String gender;
            private Integer age;
            private String classes;

            public Integer getId() {
                return id;
            }

            public void setId(Integer id) {
                this.id = id;
            }

            public String getName() {
                return name;
            }

            public void setName(String name) {
                this.name = name;
            }

            public String getGender() {
                return gender;
            }

            public void setGender(String gender) {
                this.gender = gender;
            }

            public Integer getAge() {
                return age;
            }

            public void setAge(Integer age) {
                this.age = age;
            }

            public String getClasses() {
                return classes;
            }

            public void setClasses(String classes) {
                this.classes = classes;
            }

            @Override
            public String toString() {
                return "Student{" +
                        "id=" + id +
                        ", name='" + name + '\'' +
                        ", gender='" + gender + '\'' +
                        ", age=" + age +
                        ", classes='" + classes + '\'' +
                        '}';
            }
        }

        ```
4.  ä¸‰å±‚æ¶æ„æ­å»ºå’Œå®ç°
    1.  æŒä¹…å±‚
        ```java
        //æ¥å£
        public interface StudentDao {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            List<Student> queryAll();
        }

        //å®ç°ç±»
        @Repository
        public class StudentDaoImpl implements StudentDao {

            @Autowired
            private JdbcTemplate jdbcTemplate;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            @Override
            public List<Student> queryAll() {

                String sql = "select id , name , age , gender , class as classes from students ;";

                /*
                  queryå¯ä»¥è¿”å›é›†åˆ!
                  BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
                 */
                List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));

                return studentList;
            }
        }

        ```
    2.  ä¸šåŠ¡å±‚
        ```java
        //æ¥å£
        public interface StudentService {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            List<Student> findAll();

        }

        //å®ç°ç±»
        @Service
        public class StudentServiceImpl  implements StudentService {

            @Autowired
            private StudentDao studentDao;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            @Override
            public List<Student> findAll() {

                List<Student> studentList =  studentDao.queryAll();

                return studentList;
            }
        }

        ```
    3.  è¡¨è¿°å±‚
        ```java
        @Controller
        public class StudentController {

            @Autowired
            private StudentService studentService;

            public void  findAll(){
               List<Student> studentList =  studentService.findAll();
                System.out.println("studentList = " + studentList);
            }
        }

        ```
5.  ä¸‰å±‚æ¶æ„IoCé…ç½®
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


        <!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
        <context:property-placeholder location="classpath:jdbc.properties" />

        <!-- é…ç½®æ•°æ®æº -->
        <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
            <property name="url" value="${atguigu.url}"/>
            <property name="driverClassName" value="${atguigu.driver}"/>
            <property name="username" value="${atguigu.username}"/>
            <property name="password" value="${atguigu.password}"/>
        </bean>

        <bean class="org.springframework.jdbc.core.JdbcTemplate">
            <property name="dataSource" ref="druidDataSource" />
        </bean>

        <!-- æ‰«æIoc/DIæ³¨è§£ -->
        <context:component-scan base-package="com.atguigu.dao,com.atguigu.service,com.atguigu.controller" />

    </beans>
    ```
6.  è¿è¡Œæµ‹è¯•
    ```java
    public class ControllerTest {

        @Test
        public  void testRun(){
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            StudentController studentController = applicationContext.getBean(StudentController.class);
            studentController.findAll();
        }
    }
    ```
7.  æ³¨è§£+XML IoCæ–¹å¼é—®é¢˜æ€»ç»“
    1.  è‡ªå®šä¹‰ç±»å¯ä»¥ä½¿ç”¨æ³¨è§£æ–¹å¼ï¼Œä½†æ˜¯ç¬¬ä¸‰æ–¹ä¾èµ–çš„ç±»ä¾ç„¶ä½¿ç”¨XMLæ–¹å¼ï¼
    2.  XMLæ ¼å¼è§£ææ•ˆç‡ä½ï¼

### 4.4 åŸºäº é…ç½®ç±» æ–¹å¼ç®¡ç† Bean

#### 4.4.1 å®Œå…¨æ³¨è§£å¼€å‘ç†è§£

Spring å®Œå…¨æ³¨è§£é…ç½®ï¼ˆFully Annotation-based Configurationï¼‰æ˜¯æŒ‡é€šè¿‡ Javaé…ç½®ç±» ä»£ç æ¥é…ç½® Spring åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨æ³¨è§£æ¥æ›¿ä»£åŸæœ¬åœ¨ XML é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ã€‚ç›¸å¯¹äº XML é…ç½®ï¼Œå®Œå…¨æ³¨è§£é…ç½®å…·æœ‰æ›´å¼ºçš„ç±»å‹å®‰å…¨æ€§å’Œæ›´å¥½çš„å¯è¯»æ€§ã€‚

**ä¸¤ç§æ–¹å¼æ€ç»´è½¬åŒ–**ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8d48361bca8ca0627baaa07687caa48e.png)



#### 4.4.2 å®éªŒä¸€ï¼šé…ç½®ç±»å’Œæ‰«ææ³¨è§£

**xml+æ³¨è§£æ–¹å¼**

é…ç½®æ–‡ä»¶application.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


    <!-- é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ… -->
    <!-- 1.åŒ…è¦ç²¾å‡†,æé«˜æ€§èƒ½!
         2.ä¼šæ‰«ææŒ‡å®šçš„åŒ…å’Œå­åŒ…å†…å®¹
         3.å¤šä¸ªåŒ…å¯ä»¥ä½¿ç”¨,åˆ†å‰² ä¾‹å¦‚: com.atguigu.controller,com.atguigu.serviceç­‰
    -->
    <context:component-scan base-package="com.atguigu.components"/>

    <!-- å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶-->
    <context:property-placeholder location="application.properties" />
</beans>
```

æµ‹è¯•åˆ›å»ºIoCå®¹å™¨

```java
 // xmlæ–¹å¼é…ç½®æ–‡ä»¶ä½¿ç”¨ClassPathXmlApplicationContextå®¹å™¨è¯»å–
 ApplicationContext applicationContext =
                new ClassPathXmlApplicationContext("application.xml");
```

**é…ç½®ç±»+æ³¨è§£æ–¹å¼ï¼ˆå®Œå…¨æ³¨è§£æ–¹å¼ï¼‰**

é…ç½®ç±»

ä½¿ç”¨ @Configuration æ³¨è§£å°†ä¸€ä¸ªæ™®é€šçš„ç±»æ ‡è®°ä¸º Spring çš„é…ç½®ç±»ã€‚

```java
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;

//æ ‡æ³¨å½“å‰ç±»æ˜¯é…ç½®ç±»ï¼Œæ›¿ä»£application.xml    
@Configuration
//ä½¿ç”¨æ³¨è§£è¯»å–å¤–éƒ¨é…ç½®ï¼Œæ›¿ä»£ <context:property-placeholderæ ‡ç­¾
@PropertySource("classpath:application.properties")
//ä½¿ç”¨@ComponentScanæ³¨è§£,å¯ä»¥é…ç½®æ‰«æåŒ…,æ›¿ä»£<context:component-scanæ ‡ç­¾
@ComponentScan(basePackages = {"com.atguigu.components"})
public class MyConfiguration {
    
}
```

æµ‹è¯•åˆ›å»ºIoCå®¹å™¨

```java
// AnnotationConfigApplicationContext æ ¹æ®é…ç½®ç±»åˆ›å»º IOC å®¹å™¨å¯¹è±¡
ApplicationContext iocContainerAnnotation = 
new AnnotationConfigApplicationContext(MyConfiguration.class);
```

å¯ä»¥ä½¿ç”¨ no-arg æ„é€ å‡½æ•°å®ä¾‹åŒ– `AnnotationConfigApplicationContext` ï¼Œç„¶åä½¿ç”¨ `register()` æ–¹æ³•å¯¹å…¶è¿›è¡Œé…ç½®ã€‚æ­¤æ–¹æ³•åœ¨ä»¥ç¼–ç¨‹æ–¹å¼ç”Ÿæˆ `AnnotationConfigApplicationContext` æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š

```java
// AnnotationConfigApplicationContext-IOCå®¹å™¨å¯¹è±¡
ApplicationContext iocContainerAnnotation = 
new AnnotationConfigApplicationContext();
//å¤–éƒ¨è®¾ç½®é…ç½®ç±»
iocContainerAnnotation.register(MyConfiguration.class);
//åˆ·æ–°åæ–¹å¯ç”Ÿæ•ˆï¼ï¼
iocContainerAnnotation.refresh();

```

**æ€»ç»“ï¼š**

@ConfigurationæŒ‡å®šä¸€ä¸ªç±»ä¸ºé…ç½®ç±»ï¼Œå¯ä»¥æ·»åŠ é…ç½®æ³¨è§£ï¼Œæ›¿ä»£é…ç½®xmlæ–‡ä»¶

@ComponentScan(basePackages = {"åŒ…","åŒ…"}) æ›¿ä»£\<context:component-scanæ ‡ç­¾å®ç°æ³¨è§£æ‰«æ

@PropertySource("classpath:é…ç½®æ–‡ä»¶åœ°å€") æ›¿ä»£ \<context:property-placeholderæ ‡ç­¾

é…åˆIoC/DIæ³¨è§£ï¼Œå¯ä»¥è¿›è¡Œå®Œæ•´æ³¨è§£å¼€å‘ï¼

#### 4.4.3 å®éªŒäºŒï¼š@Beanå®šä¹‰ç»„ä»¶

**åœºæ™¯éœ€æ±‚**ï¼šå°†Druidè¿æ¥æ± å¯¹è±¡å­˜å‚¨åˆ°IoCå®¹å™¨

**éœ€æ±‚åˆ†æ**ï¼šç¬¬ä¸‰æ–¹jaråŒ…çš„ç±»ï¼Œæ·»åŠ åˆ°iocå®¹å™¨ï¼Œæ— æ³•ä½¿ç”¨@Componentç­‰ç›¸å…³æ³¨è§£ï¼å› ä¸ºæºç jaråŒ…å†…å®¹ä¸ºåªè¯»æ¨¡å¼ï¼

**xmlæ–¹å¼å®ç°**ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


    <!-- å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
    <context:property-placeholder location="classpath:jdbc.properties"/>

    <!-- å®éªŒå…­ [é‡è¦]ç»™beançš„å±æ€§èµ‹å€¼ï¼šå¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
    <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
        <property name="url" value="${jdbc.url}"/>
        <property name="driverClassName" value="${jdbc.driver}"/>
        <property name="username" value="${jdbc.user}"/>
        <property name="password" value="${jdbc.password}"/>
    </bean>

</beans>
```

**é…ç½®ç±»æ–¹å¼å®ç°**ï¼š

`@Bean` æ³¨é‡Šç”¨äºæŒ‡ç¤ºæ–¹æ³•å®ä¾‹åŒ–ã€é…ç½®å’Œåˆå§‹åŒ–è¦ç”± Spring IoC å®¹å™¨ç®¡ç†çš„æ–°å¯¹è±¡ã€‚å¯¹äºé‚£äº›ç†Ÿæ‚‰ Spring çš„ `<beans/>` XML é…ç½®çš„äººæ¥è¯´ï¼Œ `@Bean` æ³¨é‡Šä¸ `<bean/>` å…ƒç´ èµ·ç€ç›¸åŒçš„ä½œç”¨ã€‚

```java
//æ ‡æ³¨å½“å‰ç±»æ˜¯é…ç½®ç±»ï¼Œæ›¿ä»£application.xml    
@Configuration
//å¼•å…¥jdbc.propertiesæ–‡ä»¶
@PropertySource({"classpath:application.properties","classpath:jdbc.properties"})
@ComponentScan(basePackages = {"com.atguigu.components"})
public class MyConfiguration {

    //å¦‚æœç¬¬ä¸‰æ–¹ç±»è¿›è¡ŒIoCç®¡ç†,æ— æ³•ç›´æ¥ä½¿ç”¨@Componentç›¸å…³æ³¨è§£
    //è§£å†³æ–¹æ¡ˆ: xmlæ–¹å¼å¯ä»¥ä½¿ç”¨<beanæ ‡ç­¾
    //è§£å†³æ–¹æ¡ˆ: é…ç½®ç±»æ–¹å¼,å¯ä»¥ä½¿ç”¨æ–¹æ³•è¿”å›å€¼+@Beanæ³¨è§£
    @Bean
    public DataSource createDataSource(@Value("${jdbc.user}") String username,
                                       @Value("${jdbc.password}")String password,
                                       @Value("${jdbc.url}")String url,
                                       @Value("${jdbc.driver}")String driverClassName){
        //ä½¿ç”¨Javaä»£ç å®ä¾‹åŒ–
        DruidDataSource dataSource = new DruidDataSource();
        dataSource.setUsername(username);
        dataSource.setPassword(password);
        dataSource.setUrl(url);
        dataSource.setDriverClassName(driverClassName);
        //è¿”å›ç»“æœå³å¯
        return dataSource;
    }
}
```

#### 4.4.4 å®éªŒä¸‰ï¼šé«˜çº§ç‰¹æ€§ï¼š@Beanæ³¨è§£ç»†èŠ‚

1.  **@Beanç”ŸæˆBeanNameé—®é¢˜**

    @Beanæ³¨è§£æºç ï¼š
    ```java
    public @interface Bean {
        //å‰ä¸¤ä¸ªæ³¨è§£å¯ä»¥æŒ‡å®šBeançš„æ ‡è¯†
        @AliasFor("name")
        String[] value() default {};
        @AliasFor("value")
        String[] name() default {};
      
        //autowireCandidate å±æ€§æ¥æŒ‡ç¤ºè¯¥ Bean æ˜¯å¦å€™é€‰ç”¨äºè‡ªåŠ¨è£…é…ã€‚
        //autowireCandidate å±æ€§é»˜è®¤å€¼ä¸º trueï¼Œè¡¨ç¤ºè¯¥ Bean æ˜¯ä¸€ä¸ªé»˜è®¤çš„è£…é…ç›®æ ‡ï¼Œ
        //å¯è¢«å€™é€‰ç”¨äºè‡ªåŠ¨è£…é…ã€‚å¦‚æœå°† autowireCandidate å±æ€§è®¾ç½®ä¸º falseï¼Œåˆ™è¯´æ˜è¯¥ Bean ä¸æ˜¯é»˜è®¤çš„è£…é…ç›®æ ‡ï¼Œä¸ä¼šè¢«å€™é€‰ç”¨äºè‡ªåŠ¨è£…é…ã€‚
        boolean autowireCandidate() default true;

        //æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
        String initMethod() default "";
        //æŒ‡å®šé”€æ¯æ–¹æ³•
        String destroyMethod() default "(inferred)";
    }

    ```
    æŒ‡å®š@Beançš„åç§°ï¼š
    ```java
    @Configuration
    public class AppConfig {

      @Bean("myThing") //æŒ‡å®šåç§°
      public Thing thing() {
        return new Thing();
      }
    }
    ```
    `@Bean` æ³¨é‡Šæ³¨é‡Šæ–¹æ³•ã€‚ä½¿ç”¨æ­¤æ–¹æ³•åœ¨æŒ‡å®šä¸ºæ–¹æ³•è¿”å›å€¼çš„ç±»å‹çš„ `ApplicationContext` ä¸­æ³¨å†Œ Bean å®šä¹‰ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼ŒBean åç§°ä¸æ–¹æ³•åç§°ç›¸åŒã€‚ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤º `@Bean` æ–¹æ³•å£°æ˜ï¼š
    ```java
    @Configuration
    public class AppConfig {

      @Bean
      public TransferServiceImpl transferService() {
        return new TransferServiceImpl();
      }
    }
    ```
    å‰é¢çš„é…ç½®å®Œå…¨ç­‰åŒäºä¸‹é¢çš„Spring XMLï¼š
    ```java
    <beans>
      <bean id="transferService" class="com.acme.TransferServiceImpl"/>
    </beans>
    ```
2.  **@Bean åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•æŒ‡å®š**

    `@Bean` æ³¨è§£æ”¯æŒæŒ‡å®šä»»æ„åˆå§‹åŒ–å’Œé”€æ¯å›è°ƒæ–¹æ³•ï¼Œéå¸¸ç±»ä¼¼äº Spring XML åœ¨ `bean` å…ƒç´ ä¸Šçš„ `init-method` å’Œ `destroy-method` å±æ€§ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š
    ```java
    public class BeanOne {

      public void init() {
        // initialization logic
      }
    }

    public class BeanTwo {

      public void cleanup() {
        // destruction logic
      }
    }

    @Configuration
    public class AppConfig {

      @Bean(initMethod = "init")
      public BeanOne beanOne() {
        return new BeanOne();
      }

      @Bean(destroyMethod = "cleanup")
      public BeanTwo beanTwo() {
        return new BeanTwo();
      }
    }
    ```
3.  **@Bean Scopeä½œç”¨åŸŸ**

    å¯ä»¥æŒ‡å®šä½¿ç”¨ `@Bean` æ³¨é‡Šå®šä¹‰çš„ bean åº”å…·æœ‰ç‰¹å®šèŒƒå›´ã€‚æ‚¨å¯ä»¥ä½¿ç”¨åœ¨ Bean ä½œç”¨åŸŸéƒ¨åˆ†ä¸­æŒ‡å®šçš„ä»»ä½•æ ‡å‡†ä½œç”¨åŸŸã€‚

    é»˜è®¤ä½œç”¨åŸŸä¸º `singleton` ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ `@Scope` æ³¨é‡Šè¦†ç›–æ­¤èŒƒå›´ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š
    ```java
    @Configuration
    public class MyConfiguration {

      @Bean
      @Scope("prototype")
      public Encryptor encryptor() {
        // ...
      }
    }
    ```
4.  **@Beanæ–¹æ³•ä¹‹é—´ä¾èµ–**

    **å‡†å¤‡ç»„ä»¶**
    ```java
    public class HappyMachine {
        private String machineName;
        public String getMachineName() {
            return machineName;
        }
        
        public void setMachineName(String machineName) {
            this.machineName = machineName;
        }
    }
    ```
    ```java
    public class HappyComponent {
        //å¼•ç”¨æ–°ç»„ä»¶
        private HappyMachine happyMachine;
        public HappyMachine getHappyMachine() {
            return happyMachine;
        }
        public void setHappyMachine(HappyMachine happyMachine) {
            this.happyMachine = happyMachine;
        }
        public void doWork() {
            System.out.println("HappyComponent.doWork");
        }
    }
    ```
    **Javaé…ç½®ç±»å®ç°ï¼š**

    æ–¹æ¡ˆ1ï¼š

    ç›´æ¥è°ƒç”¨æ–¹æ³•è¿”å› Bean å®ä¾‹ï¼šåœ¨ä¸€ä¸ª `@Bean` æ–¹æ³•ä¸­ç›´æ¥è°ƒç”¨å…¶ä»– `@Bean` æ–¹æ³•æ¥è·å– Bean å®ä¾‹ï¼Œè™½ç„¶æ˜¯æ–¹æ³•è°ƒç”¨ï¼Œä¹Ÿæ˜¯é€šè¿‡IoCå®¹å™¨è·å–å¯¹åº”çš„Beanï¼Œä¾‹å¦‚ï¼š
    ```java
    @Configuration
    public class JavaConfig {

        @Bean
        public HappyMachine happyMachine(){
            return new HappyMachine();
        }

        @Bean
        public HappyComponent happyComponent(){
            HappyComponent happyComponent = new HappyComponent();
            //ç›´æ¥è°ƒç”¨æ–¹æ³•å³å¯! 
            happyComponent.setHappyMachine(happyMachine());
            return happyComponent;
        }

    }
    ```
    æ–¹æ¡ˆ2ï¼š

    å‚æ•°å¼•ç”¨æ³•ï¼šé€šè¿‡æ–¹æ³•å‚æ•°ä¼ é€’ Bean å®ä¾‹çš„å¼•ç”¨æ¥è§£å†³ Bean å®ä¾‹ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚ï¼š
    ```java
    package com.atguigu.config;

    import com.atguigu.ioc.HappyComponent;
    import com.atguigu.ioc.HappyMachine;
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;

    /**
     * projectName: com.atguigu.config
     * description: é…ç½®HappyComponentå’ŒHappyMachineå…³ç³»
     */

    @Configuration
    public class JavaConfig {

        @Bean
        public HappyMachine happyMachine(){
            return new HappyMachine();
        }

        /**
         * å¯ä»¥ç›´æ¥åœ¨å½¢å‚åˆ—è¡¨æ¥æ”¶IoCå®¹å™¨ä¸­çš„Bean!
         *    æƒ…å†µ1: ç›´æ¥æŒ‡å®šç±»å‹å³å¯
         *    æƒ…å†µ2: å¦‚æœæœ‰å¤šä¸ªbean,(HappyMachine åç§° ) å½¢å‚åç§°ç­‰äºè¦æŒ‡å®šçš„beanåç§°!
         *           ä¾‹å¦‚:
         *               @Bean
         *               public Foo foo1(){
         *                   return new Foo();
         *               }
         *               @Bean
         *               public Foo foo2(){
         *                   return new Foo()
         *               }
         *               @Bean
         *               public Component component(Foo foo1 / foo2 é€šè¿‡æ­¤å¤„æŒ‡å®šå¼•å…¥çš„bean)
         */
        @Bean
        public HappyComponent happyComponent(HappyMachine happyMachine){
            HappyComponent happyComponent = new HappyComponent();
            //èµ‹å€¼
            happyComponent.setHappyMachine(happyMachine);
            return happyComponent;
        }

    }
    ```

#### 4.4.5 å®éªŒå››ï¼šé«˜çº§ç‰¹æ€§ï¼š@Importæ‰©å±•

`@Import` æ³¨é‡Šå…è®¸ä»å¦ä¸€ä¸ªé…ç½®ç±»åŠ è½½ `@Bean` å®šä¹‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š

```java
@Configuration
public class ConfigA {

  @Bean
  public A a() {
    return new A();
  }
}

@Configuration
@Import(ConfigA.class)
public class ConfigB {

  @Bean
  public B b() {
    return new B();
  }
}
```

ç°åœ¨ï¼Œåœ¨å®ä¾‹åŒ–ä¸Šä¸‹æ–‡æ—¶ä¸éœ€è¦åŒæ—¶æŒ‡å®š `ConfigA.class` å’Œ `ConfigB.class` ï¼Œåªéœ€æ˜¾å¼æä¾› `ConfigB` ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š

```java
public static void main(String[] args) {
  ApplicationContext ctx = new AnnotationConfigApplicationContext(ConfigB.class);

  // now both beans A and B will be available...
  A a = ctx.getBean(A.class);
  B b = ctx.getBean(B.class);
}
```

æ­¤æ–¹æ³•ç®€åŒ–äº†å®¹å™¨å®ä¾‹åŒ–ï¼Œå› ä¸ºåªéœ€è¦å¤„ç†ä¸€ä¸ªç±»ï¼Œè€Œä¸æ˜¯è¦æ±‚æ‚¨åœ¨æ„é€ æœŸé—´è®°ä½å¯èƒ½å¤§é‡çš„ `@Configuration` ç±»ã€‚

#### 4.4.6 å®éªŒäº”ï¼šåŸºäºæ³¨è§£+é…ç½®ç±»æ–¹å¼æ•´åˆä¸‰å±‚æ¶æ„ç»„ä»¶

1.  éœ€æ±‚åˆ†æ

    æ­å»ºä¸€ä¸ªä¸‰å±‚æ¶æ„æ¡ˆä¾‹ï¼Œæ¨¡æ‹ŸæŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿï¼ˆå­¦ç”Ÿè¡¨ï¼‰ä¿¡æ¯ï¼ŒæŒä¹…å±‚ä½¿ç”¨JdbcTemplateå’ŒDruidæŠ€æœ¯ï¼Œä½¿ç”¨æ³¨è§£+é…ç½®ç±»æ–¹å¼è¿›è¡Œç»„ä»¶ç®¡ç†ï¼
   ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ce141379e37460748a14b064aec78bda.png)


2.  æ•°æ®åº“å‡†å¤‡
    ```java
    create database studb;

    use studb;

    CREATE TABLE students (
      id INT PRIMARY KEY,
      name VARCHAR(50) NOT NULL,
      gender VARCHAR(10) NOT NULL,
      age INT,
      class VARCHAR(50)
    );

    INSERT INTO students (id, name, gender, age, class)
    VALUES
      (1, 'å¼ ä¸‰', 'ç”·', 20, 'é«˜ä¸­ä¸€ç­'),
      (2, 'æå››', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (3, 'ç‹äº”', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (4, 'èµµå…­', 'å¥³', 20, 'é«˜ä¸­ä¸‰ç­'),
      (5, 'åˆ˜ä¸ƒ', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (6, 'é™ˆå…«', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (7, 'æ¨ä¹', 'ç”·', 20, 'é«˜ä¸­ä¸‰ç­'),
      (8, 'å´å', 'ç”·', 19, 'é«˜ä¸­äºŒç­');

    ```
3.  é¡¹ç›®å‡†å¤‡
    1.  é¡¹ç›®åˆ›å»º

        spring-java-practice-06
    2.  ä¾èµ–å¯¼å…¥
        ```xml
        <dependencies>
              <!--spring contextä¾èµ–-->
              <!--å½“ä½ å¼•å…¥SpringContextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-context</artifactId>
                  <version>6.0.6</version>
              </dependency>

              <!-- æ•°æ®åº“é©±åŠ¨å’Œè¿æ¥æ± -->
              <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
                  <version>8.0.25</version>
              </dependency>

              <dependency>
                  <groupId>com.alibaba</groupId>
                  <artifactId>druid</artifactId>
                  <version>1.2.8</version>
              </dependency>
              
              <dependency>
                    <groupId>jakarta.annotation</groupId>
                    <artifactId>jakarta.annotation-api</artifactId>
                    <version>2.1.1</version>
               </dependency>

              <!-- spring-jdbc -->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-jdbc</artifactId>
                  <version>6.0.6</version>
              </dependency>

        </dependencies> 
        ```
    3.  å®ä½“ç±»å‡†å¤‡
        ```java
        public class Student {

            private Integer id;
            private String name;
            private String gender;
            private Integer age;
            private String classes;

            public Integer getId() {
                return id;
            }

            public void setId(Integer id) {
                this.id = id;
            }

            public String getName() {
                return name;
            }

            public void setName(String name) {
                this.name = name;
            }

            public String getGender() {
                return gender;
            }

            public void setGender(String gender) {
                this.gender = gender;
            }

            public Integer getAge() {
                return age;
            }

            public void setAge(Integer age) {
                this.age = age;
            }

            public String getClasses() {
                return classes;
            }

            public void setClasses(String classes) {
                this.classes = classes;
            }

            @Override
            public String toString() {
                return "Student{" +
                        "id=" + id +
                        ", name='" + name + '\'' +
                        ", gender='" + gender + '\'' +
                        ", age=" + age +
                        ", classes='" + classes + '\'' +
                        '}';
            }
        }

        ```
4.  ä¸‰å±‚æ¶æ„æ­å»ºå’Œå®ç°
    1.  æŒä¹…å±‚
        ```java
        //æ¥å£
        public interface StudentDao {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            List<Student> queryAll();
        }

        //å®ç°ç±»
        @Repository
        public class StudentDaoImpl implements StudentDao {

            @Autowired
            private JdbcTemplate jdbcTemplate;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            @Override
            public List<Student> queryAll() {

                String sql = "select id , name , age , gender , class as classes from students ;";

                /*
                  queryå¯ä»¥è¿”å›é›†åˆ!
                  BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
                 */
                List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));

                return studentList;
            }
        }

        ```
    2.  ä¸šåŠ¡å±‚
        ```java
        //æ¥å£
        public interface StudentService {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            List<Student> findAll();

        }

        //å®ç°ç±»
        @Service
        public class StudentServiceImpl  implements StudentService {

            @Autowired
            private StudentDao studentDao;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            @Override
            public List<Student> findAll() {

                List<Student> studentList =  studentDao.queryAll();

                return studentList;
            }
        }

        ```
    3.  è¡¨è¿°å±‚
        ```java
        @Controller
        public class StudentController {

            @Autowired
            private StudentService studentService;

            public void  findAll(){
               List<Student> studentList =  studentService.findAll();
                System.out.println("studentList = " + studentList);
            }
        }

        ```
5.  ä¸‰å±‚æ¶æ„IoCé…ç½®ç±»
    ```java
    @Configuration
    @ComponentScan(basePackages = "com.atguigu")
    @PropertySource("classpath:jdbc.properties")
    public class JavaConfig {

        @Value("${atguigu.url}")
        private String url;
        @Value("${atguigu.driver}")
        private String driver;
        @Value("${atguigu.username}")
        private String username;
        @Value("${atguigu.password}")
        private String password;

        @Bean(destroyMethod = "close")
        public DruidDataSource dataSource(){
            DruidDataSource dataSource = new DruidDataSource();
            dataSource.setUrl(url);
            dataSource.setDriverClassName(driver);
            dataSource.setUsername(username);
            dataSource.setPassword(password);
            return dataSource;
        }

        @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)
        @Bean
        public JdbcTemplate jdbcTemplate(DataSource dataSource){
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            jdbcTemplate.setDataSource(dataSource);
            return jdbcTemplate;
        }

    }
    ```
6.  è¿è¡Œæµ‹è¯•
    ```java
    public class ControllerTest {

        @Test
        public  void testRun(){

            AnnotationConfigApplicationContext applicationContext =
                    new AnnotationConfigApplicationContext(JavaConfig.class);

            StudentController studentController = applicationContext.getBean(StudentController.class);

            studentController.findAll();

        }
    }
    ```

7.  æ³¨è§£+é…ç½®ç±» IoCæ–¹å¼æ€»ç»“
    1.  å®Œå…¨æ‘’å¼ƒäº†XMLé…ç½®æ–‡ä»¶
    2.  è‡ªå®šä¹‰ç±»ä½¿ç”¨IoCå’ŒDIæ³¨è§£æ ‡è®°
    3.  ç¬¬ä¸‰æ–¹ç±»ä½¿ç”¨é…ç½®ç±»å£°æ˜æ–¹æ³•+\@Beanæ–¹å¼å¤„ç†
    4.  å®Œå…¨æ³¨è§£æ–¹å¼ï¼ˆé…ç½®ç±»+æ³¨è§£ï¼‰æ˜¯ç°åœ¨ä¸»æµé…ç½®æ–¹å¼

### 4.5 ä¸‰ç§é…ç½®æ–¹å¼æ€»ç»“

#### 4.5.1 XMLæ–¹å¼é…ç½®æ€»ç»“

1.  æ‰€æœ‰å†…å®¹å†™åˆ°xmlæ ¼å¼é…ç½®æ–‡ä»¶ä¸­
2.  å£°æ˜beané€šè¿‡`<bean>`æ ‡ç­¾
3.  \<beanæ ‡ç­¾åŒ…å«åŸºæœ¬ä¿¡æ¯ï¼ˆid,classï¼‰å’Œå±æ€§ä¿¡æ¯ \<property name value / ref
4.  å¼•å…¥å¤–éƒ¨çš„propertiesæ–‡ä»¶å¯ä»¥é€šè¿‡\<context:property-placeholder
5.  IoCå…·ä½“å®¹å™¨å®ç°é€‰æ‹©ClassPathXmlApplicationContextå¯¹è±¡

#### 4.5.2 XML+æ³¨è§£æ–¹å¼é…ç½®æ€»ç»“

1.  æ³¨è§£è´Ÿè´£æ ‡è®°IoCçš„ç±»å’Œè¿›è¡Œå±æ€§è£…é…
2.  xmlæ–‡ä»¶ä¾ç„¶éœ€è¦ï¼Œéœ€è¦é€šè¿‡\<context:component-scanæ ‡ç­¾æŒ‡å®šæ³¨è§£èŒƒå›´
3.  æ ‡è®°IoCæ³¨è§£ï¼š@Component,@Service,@Controller,@Repository&#x20;
4.  æ ‡è®°DIæ³¨è§£ï¼š@Autowired @Qualifier @Resource @Value
5.  IoCå…·ä½“å®¹å™¨å®ç°é€‰æ‹©ClassPathXmlApplicationContextå¯¹è±¡

#### 4.5.3 å®Œå…¨æ³¨è§£æ–¹å¼é…ç½®æ€»ç»“

1.  å®Œå…¨æ³¨è§£æ–¹å¼æŒ‡çš„æ˜¯å»æ‰xmlæ–‡ä»¶ï¼Œä½¿ç”¨é…ç½®ç±» + æ³¨è§£å®ç°
2.  xmlæ–‡ä»¶æ›¿æ¢æˆä½¿ç”¨@Configurationæ³¨è§£æ ‡è®°çš„ç±»
3.  æ ‡è®°IoCæ³¨è§£ï¼š@Component,@Service,@Controller,@Repository&#x20;
4.  æ ‡è®°DIæ³¨è§£ï¼š@Autowired @Qualifier @Resource @Value
5.  \<context:component-scanæ ‡ç­¾æŒ‡å®šæ³¨è§£èŒƒå›´ä½¿ç”¨@ComponentScan(basePackages = {"com.atguigu.components"})æ›¿ä»£
6.  \<context:property-placeholderå¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶ä½¿ç”¨@PropertySource({"classpath:application.properties","classpath:jdbc.properties"})æ›¿ä»£
7.  \<bean æ ‡ç­¾ä½¿ç”¨@Beanæ³¨è§£å’Œæ–¹æ³•å®ç°
8.  IoCå…·ä½“å®¹å™¨å®ç°é€‰æ‹©AnnotationConfigApplicationContextå¯¹è±¡

### 4.6 æ•´åˆSpring5-Test5æ­å»ºæµ‹è¯•ç¯å¢ƒ

1.  æ•´åˆæµ‹è¯•ç¯å¢ƒä½œç”¨

    å¥½å¤„1ï¼šä¸éœ€è¦è‡ªå·±åˆ›å»ºIOCå®¹å™¨å¯¹è±¡äº†

    å¥½å¤„2ï¼šä»»ä½•éœ€è¦çš„beanéƒ½å¯ä»¥åœ¨æµ‹è¯•ç±»ä¸­ç›´æ¥äº«å—è‡ªåŠ¨è£…é…

2.  å¯¼å…¥ç›¸å…³ä¾èµ–
    ```xml
    <!--junit5æµ‹è¯•-->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.3.1</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-test</artifactId>
        <version>6.0.6</version>
        <scope>test</scope>
    </dependency>
    ```
3.  æ•´åˆæµ‹è¯•æ³¨è§£ä½¿ç”¨
    ```java
    //@SpringJUnitConfig(locations = {"classpath:spring-context.xml"})  //æŒ‡å®šé…ç½®æ–‡ä»¶xml
    @SpringJUnitConfig(value = {BeanConfig.class})  //æŒ‡å®šé…ç½®ç±»
    public class Junit5IntegrationTest {
        
        @Autowired
        private User user;
        
        @Test
        public void testJunit5() {
            System.out.println(user);
        }
    }
    ```

## 5 Spring AOPé¢å‘åˆ‡é¢ç¼–ç¨‹

### 5.1 åœºæ™¯è®¾å®šå’Œé—®é¢˜å¤ç°

1.  å‡†å¤‡AOPé¡¹ç›®

    é¡¹ç›®åï¼šspring-aop-annotation

    pom.xml
    ```xml
    <dependencies>
        <!--spring contextä¾èµ–-->
        <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-context</artifactId>
            <version>6.0.6</version>
        </dependency>

        <!--junit5æµ‹è¯•-->
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-api</artifactId>
            <version>5.3.1</version>
        </dependency>


        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-test</artifactId>
            <version>6.0.6</version>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>jakarta.annotation</groupId>
            <artifactId>jakarta.annotation-api</artifactId>
            <version>2.1.1</version>
        </dependency>
    </dependencies>
    ```
2.  å£°æ˜æ¥å£
    ```java
    /**
     *       + - * / è¿ç®—çš„æ ‡å‡†æ¥å£!
     */
    public interface Calculator {
        
        int add(int i, int j);
        
        int sub(int i, int j);
        
        int mul(int i, int j);
        
        int div(int i, int j);
        
    }
    ```
3.  æ¥å£å®ç°
    ```java
    package com.atguigu.proxy;


    /**
     * å®ç°è®¡ç®—æ¥å£,å•çº¯æ·»åŠ  + - * / å®ç°! æºæ‚å…¶ä»–åŠŸèƒ½!
     */
    public class CalculatorPureImpl implements Calculator {
        
        @Override
        public int add(int i, int j) {
        
            int result = i + j;
        
            return result;
        }
        
        @Override
        public int sub(int i, int j) {
        
            int result = i - j;
        
            return result;
        }
        
        @Override
        public int mul(int i, int j) {
        
            int result = i * j;
        
            return result;
        }
        
        @Override
        public int div(int i, int j) {
        
            int result = i / j;
        
            return result;
        }
    }
    ```
4.  å£°æ˜å¸¦æ—¥å¿—æ¥å£å®ç°

    æ–°éœ€æ±‚ï¼š éœ€è¦åœ¨æ¯ä¸ªæ–¹æ³•ä¸­ï¼Œæ·»åŠ æ§åˆ¶å°è¾“å‡ºï¼Œè¾“å‡ºå‚æ•°å’Œè¾“å‡ºè®¡ç®—åçš„è¿”å›å€¼ï¼

    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7f0cb43ae6de39056dae562dcf857106.png)


    ```java
    package com.atguigu.proxy;

    /**
     * åœ¨æ¯ä¸ªæ–¹æ³•ä¸­,è¾“å‡ºä¼ å…¥çš„å‚æ•°å’Œè®¡ç®—åçš„è¿”å›ç»“æœ!
     */
    public class CalculatorLogImpl implements Calculator {
        
        @Override
        public int add(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
            int result = i + j;
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
          
            return result;
        }
        
        @Override
        public int sub(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            int result = i - j;
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
            return result;
        }
        
        @Override
        public int mul(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            int result = i * j;
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
        
            return result;
        }
        
        @Override
        public int div(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            int result = i / j;
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
            
            return result;
        }
    }
    ```
5.  ä»£ç é—®é¢˜åˆ†æ
    1.  ä»£ç ç¼ºé™·
        -   å¯¹æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æœ‰å¹²æ‰°ï¼Œå¯¼è‡´ç¨‹åºå‘˜åœ¨å¼€å‘æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æ—¶åˆ†æ•£äº†ç²¾åŠ›
        -   é™„åŠ åŠŸèƒ½ä»£ç é‡å¤ï¼Œåˆ†æ•£åœ¨å„ä¸ªä¸šåŠ¡åŠŸèƒ½æ–¹æ³•ä¸­ï¼å†—ä½™ï¼Œä¸”ä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤ï¼
    2.  è§£å†³æ€è·¯

        æ ¸å¿ƒå°±æ˜¯ï¼šè§£è€¦ã€‚æˆ‘ä»¬éœ€è¦æŠŠé™„åŠ åŠŸèƒ½ä»ä¸šåŠ¡åŠŸèƒ½ä»£ç ä¸­æŠ½å–å‡ºæ¥ã€‚

        å°†é‡å¤çš„ä»£ç ç»Ÿä¸€æå–ï¼Œå¹¶ä¸”åŠ¨æ€æ’å…¥åˆ°æ¯ä¸ªä¸šåŠ¡æ–¹æ³•ï¼

	3.  æŠ€æœ¯å›°éš¾

        è§£å†³é—®é¢˜çš„å›°éš¾ï¼šæå–é‡å¤é™„åŠ åŠŸèƒ½ä»£ç åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¯ä»¥å®ç°

        ä½†æ˜¯å¦‚ä½•å°†ä»£ç æ’å…¥åˆ°å„ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šï¼Œæˆ‘ä»¬éœ€è¦å¼•ç”¨æ–°æŠ€æœ¯ï¼ï¼ï¼

### 5.2 è§£å†³æŠ€æœ¯ä»£ç†æ¨¡å¼

1.  **ä»£ç†æ¨¡å¼**

    äºŒåä¸‰ç§è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ï¼Œå±äºç»“æ„å‹æ¨¡å¼ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯é€šè¿‡æä¾›ä¸€ä¸ªä»£ç†ç±»ï¼Œè®©æˆ‘ä»¬åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„æ—¶å€™ï¼Œä¸å†æ˜¯ç›´æ¥å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†ç±»é—´æ¥è°ƒç”¨ã€‚è®©ä¸å±äºç›®æ ‡æ–¹æ³•æ ¸å¿ƒé€»è¾‘çš„ä»£ç ä»ç›®æ ‡æ–¹æ³•ä¸­å‰¥ç¦»å‡ºæ¥â€”â€”è§£è€¦ã€‚è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶å…ˆè°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå‡å°‘å¯¹ç›®æ ‡æ–¹æ³•çš„è°ƒç”¨å’Œæ‰“æ‰°ï¼ŒåŒæ—¶è®©é™„åŠ åŠŸèƒ½èƒ½å¤Ÿé›†ä¸­åœ¨ä¸€èµ·ä¹Ÿæœ‰åˆ©äºç»Ÿä¸€ç»´æŠ¤ã€‚

    æ— ä»£ç†åœºæ™¯ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/4a7107b21913dfd91ab3a441bbced5af.png)



    æœ‰ä»£ç†åœºæ™¯ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/77d10947a1bd16c5c8b20cb6fec68175.png)



    ç”Ÿæ´»ä¸­çš„ä»£ç†ï¼š
    -   å¹¿å‘Šå•†æ‰¾å¤§æ˜æ˜Ÿæ‹å¹¿å‘Šéœ€è¦ç»è¿‡ç»çºªäºº
    -   åˆä½œä¼™ä¼´æ‰¾å¤§è€æ¿è°ˆåˆä½œè¦çº¦è§é¢æ—¶é—´éœ€è¦ç»è¿‡ç§˜ä¹¦
    -   æˆ¿äº§ä¸­ä»‹æ˜¯ä¹°å–åŒæ–¹çš„ä»£ç†
    -   å¤ªç›‘æ˜¯å¤§è‡£å’Œçš‡ä¸Šä¹‹é—´çš„ä»£ç†
    ç›¸å…³æœ¯è¯­ï¼š
    -   ä»£ç†ï¼šå°†éæ ¸å¿ƒé€»è¾‘å‰¥ç¦»å‡ºæ¥ä»¥åï¼Œå°è£…è¿™äº›éæ ¸å¿ƒé€»è¾‘çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚(ä¸­ä»‹)
        -   åŠ¨è¯ï¼šæŒ‡åšä»£ç†è¿™ä¸ªåŠ¨ä½œï¼Œæˆ–è¿™é¡¹å·¥ä½œ
        -   åè¯ï¼šæ‰®æ¼”ä»£ç†è¿™ä¸ªè§’è‰²çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•
    -   ç›®æ ‡ï¼š**è¢«ä»£ç†**â€œå¥—ç”¨â€äº†æ ¸å¿ƒé€»è¾‘ä»£ç çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚(æˆ¿ä¸œ)
        ä»£ç†åœ¨å¼€å‘ä¸­å®ç°çš„æ–¹å¼å…·ä½“æœ‰ä¸¤ç§ï¼šé™æ€ä»£ç†ï¼Œ\[åŠ¨æ€ä»£ç†æŠ€æœ¯]

2.  **é™æ€ä»£ç†**

    ä¸»åŠ¨åˆ›å»ºä»£ç†ç±»ï¼š
    ```java
    public class CalculatorStaticProxy implements Calculator {
        
        // å°†è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡å£°æ˜ä¸ºæˆå‘˜å˜é‡
        private Calculator target;
        
        public CalculatorStaticProxy(Calculator target) {
            this.target = target;
        }
        
        @Override
        public int add(int i, int j) {
        
            // é™„åŠ åŠŸèƒ½ç”±ä»£ç†ç±»ä¸­çš„ä»£ç†æ–¹æ³•æ¥å®ç°
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            // é€šè¿‡ç›®æ ‡å¯¹è±¡æ¥å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
            int addResult = target.add(i, j);
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
        
            return addResult;
        }
        â€¦â€¦
    ```
    é™æ€ä»£ç†ç¡®å®å®ç°äº†è§£è€¦ï¼Œä½†æ˜¯ç”±äºä»£ç éƒ½å†™æ­»äº†ï¼Œå®Œå…¨ä¸å…·å¤‡ä»»ä½•çš„çµæ´»æ€§ã€‚å°±æ‹¿æ—¥å¿—åŠŸèƒ½æ¥è¯´ï¼Œå°†æ¥å…¶ä»–åœ°æ–¹ä¹Ÿéœ€è¦é™„åŠ æ—¥å¿—ï¼Œé‚£è¿˜å¾—å†å£°æ˜æ›´å¤šä¸ªé™æ€ä»£ç†ç±»ï¼Œé‚£å°±äº§ç”Ÿäº†å¤§é‡é‡å¤çš„ä»£ç ï¼Œæ—¥å¿—åŠŸèƒ½è¿˜æ˜¯åˆ†æ•£çš„ï¼Œæ²¡æœ‰ç»Ÿä¸€ç®¡ç†ã€‚

    æå‡ºè¿›ä¸€æ­¥çš„éœ€æ±‚ï¼šå°†æ—¥å¿—åŠŸèƒ½é›†ä¸­åˆ°ä¸€ä¸ªä»£ç†ç±»ä¸­ï¼Œå°†æ¥æœ‰ä»»ä½•æ—¥å¿—éœ€æ±‚ï¼Œéƒ½é€šè¿‡è¿™ä¸€ä¸ªä»£ç†ç±»æ¥å®ç°ã€‚è¿™å°±éœ€è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯äº†ã€‚

3.  **åŠ¨æ€ä»£ç†**

    åŠ¨æ€ä»£ç†æŠ€æœ¯åˆ†ç±»
    -   JDKåŠ¨æ€ä»£ç†ï¼šJDKåŸç”Ÿçš„å®ç°æ–¹å¼ï¼Œéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡ç±»å¿…é¡»**å®ç°æ¥å£**ï¼ä»–ä¼šæ ¹æ®ç›®æ ‡ç±»çš„æ¥å£åŠ¨æ€ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡æœ‰ç›¸åŒçš„æ¥å£ï¼ï¼ˆæ‹œæŠŠå­ï¼‰
    -   cglibï¼šé€šè¿‡ç»§æ‰¿è¢«ä»£ç†çš„ç›®æ ‡ç±»å®ç°ä»£ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ï¼ï¼ˆè®¤å¹²çˆ¹ï¼‰
        JDKåŠ¨æ€ä»£ç†æŠ€æœ¯å®ç°ï¼ˆäº†è§£ï¼‰![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/1d03ea9bb9c927d65750bcac856fd205.png)



    ä»£ç†å·¥ç¨‹ï¼šåŸºäºjdkä»£ç†æŠ€æœ¯ï¼Œç”Ÿæˆä»£ç†å¯¹è±¡
    ```java
    public class ProxyFactory {

        private Object target;

        public ProxyFactory(Object target) {
            this.target = target;
        }

        public Object getProxy(){

            /**
             * newProxyInstance()ï¼šåˆ›å»ºä¸€ä¸ªä»£ç†å®ä¾‹
             * å…¶ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼š
             * 1ã€classLoaderï¼šåŠ è½½åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„ç±»åŠ è½½å™¨
             * 2ã€interfacesï¼šç›®æ ‡å¯¹è±¡å®ç°çš„æ‰€æœ‰æ¥å£çš„classå¯¹è±¡æ‰€ç»„æˆçš„æ•°ç»„
             * 3ã€invocationHandlerï¼šè®¾ç½®ä»£ç†å¯¹è±¡å®ç°ç›®æ ‡å¯¹è±¡æ–¹æ³•çš„è¿‡ç¨‹ï¼Œå³ä»£ç†ç±»ä¸­å¦‚ä½•é‡å†™æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•
             */
            ClassLoader classLoader = target.getClass().getClassLoader();
            Class<?>[] interfaces = target.getClass().getInterfaces();
            InvocationHandler invocationHandler = new InvocationHandler() {
                @Override
                public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                    /**
                     * proxyï¼šä»£ç†å¯¹è±¡
                     * methodï¼šä»£ç†å¯¹è±¡éœ€è¦å®ç°çš„æ–¹æ³•ï¼Œå³å…¶ä¸­éœ€è¦é‡å†™çš„æ–¹æ³•
                     * argsï¼šmethodæ‰€å¯¹åº”æ–¹æ³•çš„å‚æ•°
                     */
                    Object result = null;
                    try {
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œå‚æ•°ï¼š"+ Arrays.toString(args));
                        result = method.invoke(target, args);
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œç»“æœï¼š"+ result);
                    } catch (Exception e) {
                        e.printStackTrace();
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œå¼‚å¸¸ï¼š"+e.getMessage());
                    } finally {
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•");
                    }
                    return result;
                }
            };

            return Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);
        }
    }
    ```
    æµ‹è¯•ä»£ç ï¼š
    ```java
    @Test
    public void testDynamicProxy(){
        ProxyFactory factory = new ProxyFactory(new CalculatorLogImpl());
        Calculator proxy = (Calculator) factory.getProxy();
        proxy.div(1,0);
        //proxy.div(1,1);
    }
    ```
4.  **ä»£ç†æ€»ç»“**

    **ä»£ç†æ–¹å¼å¯ä»¥è§£å†³é™„åŠ åŠŸèƒ½ä»£ç å¹²æ‰°æ ¸å¿ƒä»£ç å’Œä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤çš„é—®é¢˜ï¼**

    ä»–ä¸»è¦æ˜¯å°†é™„åŠ åŠŸèƒ½ä»£ç æå–åˆ°ä»£ç†ä¸­æ‰§è¡Œï¼Œä¸å¹²æ‰°ç›®æ ‡æ ¸å¿ƒä»£ç ï¼

    ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå‘ç°ï¼Œæ— è®ºä½¿ç”¨é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†(jdk,cglib)ï¼Œç¨‹åºå‘˜çš„å·¥ä½œéƒ½æ¯”è¾ƒç¹çï¼

    éœ€è¦è‡ªå·±ç¼–å†™ä»£ç†å·¥å‚ç­‰ï¼

    ä½†æ˜¯ï¼Œæå‰å‰§é€ï¼Œæˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸éœ€è¦ç¼–å†™ä»£ç†ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨\[Spring AOP]æ¡†æ¶ï¼Œ

    ä»–ä¼šç®€åŒ–åŠ¨æ€ä»£ç†çš„å®ç°ï¼ï¼ï¼

### 5.3 é¢å‘åˆ‡é¢ç¼–ç¨‹æ€ç»´ï¼ˆAOPï¼‰

1.  **é¢å‘åˆ‡é¢ç¼–ç¨‹æ€æƒ³AOP**

    AOPï¼šAspect Oriented Programmingé¢å‘åˆ‡é¢ç¼–ç¨‹

    AOPå¯ä»¥è¯´æ˜¯OOPï¼ˆObject Oriented Programmingï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰çš„è¡¥å……å’Œå®Œå–„ã€‚OOPå¼•å…¥å°è£…ã€ç»§æ‰¿ã€å¤šæ€ç­‰æ¦‚å¿µæ¥å»ºç«‹ä¸€ç§å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œç”¨äºæ¨¡æ‹Ÿå…¬å…±è¡Œä¸ºçš„ä¸€ä¸ªé›†åˆã€‚ä¸è¿‡OOPå…è®¸å¼€å‘è€…å®šä¹‰çºµå‘çš„å…³ç³»ï¼Œä½†å¹¶ä¸é€‚åˆå®šä¹‰æ¨ªå‘çš„å…³ç³»ï¼Œä¾‹å¦‚æ—¥å¿—åŠŸèƒ½ã€‚æ—¥å¿—ä»£ç å¾€å¾€æ¨ªå‘åœ°æ•£å¸ƒåœ¨æ‰€æœ‰å¯¹è±¡å±‚æ¬¡ä¸­ï¼Œè€Œä¸å®ƒå¯¹åº”çš„å¯¹è±¡çš„æ ¸å¿ƒåŠŸèƒ½æ¯«æ— å…³ç³»å¯¹äºå…¶ä»–ç±»å‹çš„ä»£ç ï¼Œå¦‚å®‰å…¨æ€§ã€å¼‚å¸¸å¤„ç†å’Œé€æ˜çš„æŒç»­æ€§ä¹Ÿéƒ½æ˜¯å¦‚æ­¤ï¼Œè¿™ç§æ•£å¸ƒåœ¨å„å¤„çš„æ— å…³çš„ä»£ç è¢«ç§°ä¸ºæ¨ªåˆ‡ï¼ˆcross cuttingï¼‰ï¼Œåœ¨OOPè®¾è®¡ä¸­ï¼Œå®ƒå¯¼è‡´äº†å¤§é‡ä»£ç çš„é‡å¤ï¼Œè€Œä¸åˆ©äºå„ä¸ªæ¨¡å—çš„é‡ç”¨ã€‚

    AOPæŠ€æœ¯æ°æ°ç›¸åï¼Œå®ƒåˆ©ç”¨ä¸€ç§ç§°ä¸º"æ¨ªåˆ‡"çš„æŠ€æœ¯ï¼Œå‰–è§£å¼€å°è£…çš„å¯¹è±¡å†…éƒ¨ï¼Œå¹¶å°†é‚£äº›å½±å“äº†å¤šä¸ªç±»çš„å…¬å…±è¡Œä¸ºå°è£…åˆ°ä¸€ä¸ªå¯é‡ç”¨æ¨¡å—ï¼Œå¹¶å°†å…¶å‘½åä¸º"Aspect"ï¼Œå³åˆ‡é¢ã€‚æ‰€è°“"åˆ‡é¢"ï¼Œç®€å•è¯´å°±æ˜¯é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—ä¹‹é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ“ä½œæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

    ä½¿ç”¨AOPï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæ¥ä»£ç çš„åŸºç¡€ä¸Šæ·»åŠ æ–°åŠŸèƒ½ã€‚

2.  **AOPæ€æƒ³ä¸»è¦çš„åº”ç”¨åœºæ™¯**

    AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒé€šè¿‡å°†é€šç”¨çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ã€æƒé™æ§åˆ¶ç­‰ï¼‰ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°ã€ç®€æ´ã€æ˜“äºç»´æŠ¤ã€‚AOPå¯ä»¥åº”ç”¨äºå„ç§åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„AOPåº”ç”¨åœºæ™¯ï¼š
    1.  `æ—¥å¿—è®°å½•`ï¼šåœ¨ç³»ç»Ÿä¸­è®°å½•æ—¥å¿—æ˜¯éå¸¸é‡è¦çš„ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°æ—¥å¿—è®°å½•çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰ã€æ‰§è¡Œåæˆ–å¼‚å¸¸æŠ›å‡ºæ—¶è®°å½•æ—¥å¿—ã€‚
    2.  `äº‹åŠ¡å¤„ç†`ï¼šåœ¨æ•°æ®åº“æ“ä½œä¸­ä½¿ç”¨äº‹åŠ¡å¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•å¼€å§‹å‰å¼€å¯äº‹åŠ¡ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åæäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚
    3.  `å®‰å…¨æ§åˆ¶`ï¼šåœ¨ç³»ç»Ÿä¸­åŒ…å«æŸäº›éœ€è¦å®‰å…¨æ§åˆ¶çš„æ“ä½œï¼Œå¦‚ç™»å½•ã€ä¿®æ”¹å¯†ç ã€æˆæƒç­‰ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°å®‰å…¨æ§åˆ¶çš„åŠŸèƒ½ã€‚å¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰è¿›è¡Œæƒé™åˆ¤æ–­ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰æƒé™ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸æˆ–è½¬å‘åˆ°é”™è¯¯é¡µé¢ï¼Œä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ã€‚
    4.  `æ€§èƒ½ç›‘æ§`ï¼šåœ¨ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶éœ€è¦å¯¹æŸäº›æ–¹æ³•çš„æ€§èƒ½è¿›è¡Œç›‘æ§ï¼Œä»¥æ‰¾åˆ°ç³»ç»Ÿçš„ç“¶é¢ˆå¹¶è¿›è¡Œä¼˜åŒ–ã€‚å¯ä»¥ä½¿ç”¨AOPæ¥å®ç°æ€§èƒ½ç›‘æ§çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰è®°å½•æ—¶é—´æˆ³ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åè®¡ç®—æ–¹æ³•æ‰§è¡Œæ—¶é—´å¹¶è¾“å‡ºåˆ°æ—¥å¿—ä¸­ã€‚
    5.  `å¼‚å¸¸å¤„ç†`ï¼šç³»ç»Ÿä¸­å¯èƒ½å‡ºç°å„ç§å¼‚å¸¸æƒ…å†µï¼Œå¦‚ç©ºæŒ‡é’ˆå¼‚å¸¸ã€æ•°æ®åº“è¿æ¥å¼‚å¸¸ç­‰ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°å¼‚å¸¸å¤„ç†çš„åŠŸèƒ½ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼ˆå¦‚è®°å½•æ—¥å¿—ã€å‘é€é‚®ä»¶ç­‰ï¼‰ã€‚
    6.  `ç¼“å­˜æ§åˆ¶`ï¼šåœ¨ç³»ç»Ÿä¸­æœ‰äº›æ•°æ®å¯ä»¥ç¼“å­˜èµ·æ¥ä»¥æé«˜è®¿é—®é€Ÿåº¦ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°ç¼“å­˜æ§åˆ¶çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰æŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰åˆ™è¿”å›ï¼Œå¦åˆ™æ‰§è¡Œæ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼å­˜å…¥ç¼“å­˜ä¸­ã€‚
    7.  `åŠ¨æ€ä»£ç†`ï¼šAOPçš„å®ç°æ–¹å¼ä¹‹ä¸€æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œå¯ä»¥ä»£ç†æŸä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œç”¨äºå®ç°å„ç§åŠŸèƒ½ã€‚
        ç»¼ä¸Šæ‰€è¿°ï¼ŒAOPå¯ä»¥åº”ç”¨äºå„ç§åœºæ™¯ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†é€šç”¨çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°ã€ç®€æ´ã€æ˜“äºç»´æŠ¤ã€‚

3.  **AOPæœ¯è¯­åè¯ä»‹ç»**

    1-æ¨ªåˆ‡å…³æ³¨ç‚¹

    ä»æ¯ä¸ªæ–¹æ³•ä¸­æŠ½å–å‡ºæ¥çš„åŒä¸€ç±»éæ ¸å¿ƒä¸šåŠ¡ã€‚åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹å¯¹ç›¸å…³æ–¹æ³•è¿›è¡Œå¤šä¸ªä¸åŒæ–¹é¢çš„å¢å¼ºã€‚

    è¿™ä¸ªæ¦‚å¿µä¸æ˜¯è¯­æ³•å±‚é¢å¤©ç„¶å­˜åœ¨çš„ï¼Œè€Œæ˜¯æ ¹æ®é™„åŠ åŠŸèƒ½çš„é€»è¾‘ä¸Šçš„éœ€è¦ï¼šæœ‰åä¸ªé™„åŠ åŠŸèƒ½ï¼Œå°±æœ‰åä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/64876b20aa9aa52dbd206e36acd8f1d4.png)



    AOPæŠŠè½¯ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š`æ ¸å¿ƒå…³æ³¨ç‚¹`å’Œ`æ¨ªåˆ‡å…³æ³¨ç‚¹`ã€‚ä¸šåŠ¡å¤„ç†çš„ä¸»è¦æµç¨‹æ˜¯æ ¸å¿ƒå…³æ³¨ç‚¹ï¼Œä¸ä¹‹å…³ç³»ä¸å¤§çš„éƒ¨åˆ†æ˜¯æ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚æ¨ªåˆ‡å…³æ³¨ç‚¹çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œä»–ä»¬ç»å¸¸å‘ç”Ÿåœ¨æ ¸å¿ƒå…³æ³¨ç‚¹çš„å¤šå¤„ï¼Œè€Œå„å¤„åŸºæœ¬ç›¸ä¼¼ï¼Œæ¯”å¦‚æƒé™è®¤è¯ã€æ—¥å¿—ã€äº‹åŠ¡ã€å¼‚å¸¸ç­‰ã€‚AOPçš„ä½œç”¨åœ¨äºåˆ†ç¦»ç³»ç»Ÿä¸­çš„å„ç§å…³æ³¨ç‚¹ï¼Œå°†æ ¸å¿ƒå…³æ³¨ç‚¹å’Œæ¨ªåˆ‡å…³æ³¨ç‚¹åˆ†ç¦»å¼€æ¥ã€‚

    2-é€šçŸ¥(å¢å¼º)

    æ¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ä¸Šè¦åšçš„äº‹æƒ…éƒ½éœ€è¦å†™ä¸€ä¸ªæ–¹æ³•æ¥å®ç°ï¼Œè¿™æ ·çš„æ–¹æ³•å°±å«é€šçŸ¥æ–¹æ³•ã€‚
    -   å‰ç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•å‰æ‰§è¡Œ
    -   è¿”å›é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•æˆåŠŸç»“æŸåæ‰§è¡Œï¼ˆ**å¯¿ç»ˆæ­£å¯**ï¼‰
    -   å¼‚å¸¸é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•å¼‚å¸¸ç»“æŸåæ‰§è¡Œï¼ˆ**æ­»äºéå‘½**ï¼‰
    -   åç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•æœ€ç»ˆç»“æŸåæ‰§è¡Œï¼ˆ**ç›–æ£ºå®šè®º**ï¼‰
    -   ç¯ç»•é€šçŸ¥ï¼šä½¿ç”¨try...catch...finallyç»“æ„å›´ç»•æ•´ä¸ªè¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸Šé¢å››ç§é€šçŸ¥å¯¹åº”çš„æ‰€æœ‰ä½ç½®![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7fb04fe4b1786175790bbfffb1827823.png)


    3-è¿æ¥ç‚¹ joinpoint

    è¿™ä¹Ÿæ˜¯ä¸€ä¸ªçº¯é€»è¾‘æ¦‚å¿µï¼Œä¸æ˜¯è¯­æ³•å®šä¹‰çš„ã€‚

    æŒ‡é‚£äº›è¢«æ‹¦æˆªåˆ°çš„ç‚¹ã€‚åœ¨ Spring ä¸­ï¼Œå¯ä»¥è¢«åŠ¨æ€ä»£ç†æ‹¦æˆªç›®æ ‡ç±»çš„æ–¹æ³•![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/2825496dd4c521e78ff93b34082c8396.png)



    4-åˆ‡å…¥ç‚¹ pointcut

    å®šä½è¿æ¥ç‚¹çš„æ–¹å¼ï¼Œæˆ–è€…å¯ä»¥ç†è§£æˆè¢«é€‰ä¸­çš„è¿æ¥ç‚¹ï¼

    æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæ¯”å¦‚execution(\* com.spring.service.impl.*.*(..))ã€‚ç¬¦åˆæ¡ä»¶çš„æ¯ä¸ªæ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªå…·ä½“çš„è¿æ¥ç‚¹ã€‚

    5-åˆ‡é¢ aspect

    åˆ‡å…¥ç‚¹å’Œé€šçŸ¥çš„ç»“åˆã€‚æ˜¯ä¸€ä¸ªç±»ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ced83016f1570ae6ddd6730331329bb4.png)



    6-ç›®æ ‡ target

    è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ã€‚

    7-ä»£ç† proxy

    å‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„ä»£ç†å¯¹è±¡ã€‚

    8-ç»‡å…¥ weave

    æŒ‡æŠŠé€šçŸ¥åº”ç”¨åˆ°ç›®æ ‡ä¸Šï¼Œç”Ÿæˆä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚å¯ä»¥åœ¨ç¼–è¯‘æœŸç»‡å…¥ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡ŒæœŸç»‡å…¥ï¼ŒSpringé‡‡ç”¨åè€…ã€‚

### 5.4 Spring AOPæ¡†æ¶ä»‹ç»å’Œå…³ç³»æ¢³ç†

1.  AOPä¸€ç§åŒºåˆ«äºOOPçš„ç¼–ç¨‹æ€ç»´ï¼Œç”¨æ¥å®Œå–„å’Œè§£å†³OOPçš„éæ ¸å¿ƒä»£ç å†—ä½™å’Œä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤é—®é¢˜ï¼
2.  ä»£ç†æŠ€æœ¯ï¼ˆåŠ¨æ€ä»£ç†|é™æ€ä»£ç†ï¼‰æ˜¯å®ç°AOPæ€ç»´ç¼–ç¨‹çš„å…·ä½“æŠ€æœ¯ï¼Œä½†æ˜¯è‡ªå·±ä½¿ç”¨åŠ¨æ€ä»£ç†å®ç°ä»£ç æ¯”è¾ƒç¹çï¼
3.  Spring AOPæ¡†æ¶ï¼ŒåŸºäºAOPç¼–ç¨‹æ€ç»´ï¼Œå°è£…åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œç®€åŒ–åŠ¨æ€ä»£ç†æŠ€æœ¯å®ç°çš„æ¡†æ¶ï¼SpringAOPå†…éƒ¨å¸®åŠ©æˆ‘ä»¬å®ç°åŠ¨æ€ä»£ç†ï¼Œæˆ‘ä»¬åªéœ€å†™å°‘é‡çš„é…ç½®ï¼ŒæŒ‡å®šç”Ÿæ•ˆèŒƒå›´å³å¯,å³å¯å®Œæˆé¢å‘åˆ‡é¢æ€ç»´ç¼–ç¨‹çš„å®ç°ï¼
### 5.5 Spring AOPåŸºäºæ³¨è§£æ–¹å¼å®ç°å’Œç»†èŠ‚

#### 5.5.1 Spring AOPåº•å±‚æŠ€æœ¯ç»„æˆ

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/1b5401be5e033cd393f6e3a2a0f0c03b.png)



-   åŠ¨æ€ä»£ç†ï¼ˆInvocationHandlerï¼‰ï¼šJDKåŸç”Ÿçš„å®ç°æ–¹å¼ï¼Œéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£ã€‚å› ä¸ºè¿™ä¸ªæŠ€æœ¯è¦æ±‚ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å®ç°åŒæ ·çš„æ¥å£ï¼ˆå…„å¼Ÿä¸¤ä¸ªæ‹œæŠŠå­æ¨¡å¼ï¼‰ã€‚
-   cglibï¼šé€šè¿‡ç»§æ‰¿è¢«ä»£ç†çš„ç›®æ ‡ç±»ï¼ˆè®¤å¹²çˆ¹æ¨¡å¼ï¼‰å®ç°ä»£ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ã€‚
-   AspectJï¼šæ—©æœŸçš„AOPå®ç°çš„æ¡†æ¶ï¼ŒSpringAOPå€Ÿç”¨äº†AspectJä¸­çš„AOPæ³¨è§£ã€‚

#### 5.5.2 åˆæ­¥å®ç°

1.  åŠ å…¥ä¾èµ–
    ```xml
    <!-- spring-aspectsä¼šå¸®æˆ‘ä»¬ä¼ é€’è¿‡æ¥aspectjweaver -->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-aop</artifactId>
        <version>6.0.6</version>
    </dependency>

    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-aspects</artifactId>
        <version>6.0.6</version>
    </dependency>
    ```

- å…³äºAOPå¯¼åŒ…çš„é—®é¢˜ï¼ˆaspectjweaverå’Œspring-aspectsçš„åŒºåˆ«ï¼‰
	1. `aspectjweaver`æ˜¯AspectJçš„è¿è¡Œæ—¶åº“ï¼Œå®ƒæä¾›äº†å®ç°åˆ‡é¢ç¼–ç¨‹çš„æ ¸å¿ƒåŠŸèƒ½ã€‚AspectJæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åˆ‡é¢ç¼–ç¨‹æ¡†æ¶ï¼Œå®ƒå…è®¸åœ¨Javaåº”ç”¨ç¨‹åºä¸­å®šä¹‰å’Œåº”ç”¨åˆ‡é¢ã€‚`aspectjweaver`åº“åŒ…å«äº†AspectJçš„æ ¸å¿ƒåŠŸèƒ½å’Œè¿è¡Œæ—¶å·¥å…·ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶ç»‡å…¥å’Œæ‰§è¡Œåˆ‡é¢ä»£ç ã€‚ä½¿ç”¨AspectJï¼Œä½ å¯ä»¥å®šä¹‰åˆ‡é¢ã€åˆ‡ç‚¹å’Œé€šçŸ¥ï¼Œæ¥å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹çš„å¤„ç†ã€‚
    
	2. `spring-aspects`æ˜¯Spring Frameworkæä¾›çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒä½¿ç”¨äº†AspectJå’Œ`aspectjweaver`åº“ï¼Œå¹¶æä¾›äº†ä¸Springæ¡†æ¶é›†æˆçš„åˆ‡é¢ç¼–ç¨‹åŠŸèƒ½ã€‚`spring-aspects`æ¨¡å—ä¸ºSpringåº”ç”¨ç¨‹åºæä¾›äº†ä¸€äº›é¢„å®šä¹‰çš„åˆ‡é¢ï¼Œä¾‹å¦‚äº‹åŠ¡ç®¡ç†çš„åˆ‡é¢(`@Transactional`)å’Œå¼‚æ­¥æ‰§è¡Œçš„åˆ‡é¢(`@Async`)ç­‰ã€‚é€šè¿‡ä½¿ç”¨`spring-aspects`ï¼Œä½ å¯ä»¥å°†è¿™äº›é¢„å®šä¹‰çš„åˆ‡é¢ç›´æ¥åº”ç”¨åˆ°ä½ çš„Springåº”ç”¨ç¨‹åºä¸­ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™AspectJåˆ‡é¢ã€‚

- ç®€è€Œè¨€ä¹‹ï¼Œ`aspectjweaver`æä¾›äº†AspectJåˆ‡é¢ç¼–ç¨‹æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½å’Œè¿è¡Œæ—¶æ”¯æŒï¼Œå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ã€‚è€Œ`spring-aspects`æ˜¯Spring Frameworkçš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒé›†æˆäº†AspectJå’Œ`aspectjweaver`ï¼Œæä¾›äº†ä¸€äº›ä¸Springæ¡†æ¶é›†æˆçš„åˆ‡é¢åŠŸèƒ½ã€‚

- å¦‚æœä½ åªéœ€è¦ä½¿ç”¨AspectJçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç‹¬ç«‹äºSpring Frameworkï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨`aspectjweaver`ã€‚å¦‚æœä½ æ­£åœ¨å¼€å‘åŸºäºSpring Frameworkçš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨Springæä¾›çš„åˆ‡é¢åŠŸèƒ½ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©ä½¿ç”¨`spring-aspects`æ¨¡å—ã€‚

2.  å‡†å¤‡æ¥å£
    ```java
    public interface Calculator {
        
        int add(int i, int j);
        
        int sub(int i, int j);
        
        int mul(int i, int j);
        
        int div(int i, int j);
        
    }
    ```
3.  çº¯å‡€å®ç°ç±»
    ```java
    package com.atguigu.proxy;


    /**
     * å®ç°è®¡ç®—æ¥å£,å•çº¯æ·»åŠ  + - * / å®ç°! æºæ‚å…¶ä»–åŠŸèƒ½!
     */
    @Component
    public class CalculatorPureImpl implements Calculator {
        
        @Override
        public int add(int i, int j) {
        
            int result = i + j;
        
            return result;
        }
        
        @Override
        public int sub(int i, int j) {
        
            int result = i - j;
        
            return result;
        }
        
        @Override
        public int mul(int i, int j) {
        
            int result = i * j;
        
            return result;
        }
        
        @Override
        public int div(int i, int j) {
        
            int result = i / j;
        
            return result;
        }
    }
    ```
4.  å£°æ˜åˆ‡é¢ç±»
    ```java
    package com.atguigu.advice;

    import org.aspectj.lang.annotation.*;
    import org.springframework.stereotype.Component;

    // @Aspectè¡¨ç¤ºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»
    @Aspect
    // @Componentæ³¨è§£ä¿è¯è¿™ä¸ªåˆ‡é¢ç±»èƒ½å¤Ÿæ”¾å…¥IOCå®¹å™¨
    @Component
    public class LogAspect {
            
        // @Beforeæ³¨è§£ï¼šå£°æ˜å½“å‰æ–¹æ³•æ˜¯å‰ç½®é€šçŸ¥æ–¹æ³•
        // valueå±æ€§ï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œç”±åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ§åˆ¶å½“å‰é€šçŸ¥æ–¹æ³•è¦ä½œç”¨åœ¨å“ªä¸€ä¸ªç›®æ ‡æ–¹æ³•ä¸Š
        @Before(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogBeforeCore() {
            System.out.println("[AOPå‰ç½®é€šçŸ¥] æ–¹æ³•å¼€å§‹äº†");
        }
        
        @AfterReturning(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogAfterSuccess() {
            System.out.println("[AOPè¿”å›é€šçŸ¥] æ–¹æ³•æˆåŠŸè¿”å›äº†");
        }
        
        @AfterThrowing(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogAfterException() {
            System.out.println("[AOPå¼‚å¸¸é€šçŸ¥] æ–¹æ³•æŠ›å¼‚å¸¸äº†");
        }
        
        @After(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogFinallyEnd() {
            System.out.println("[AOPåç½®é€šçŸ¥] æ–¹æ³•æœ€ç»ˆç»“æŸäº†");
        }
        
    }
    ```
5.  å¼€å¯aspectjæ³¨è§£æ”¯æŒ
    1.  xmlæ–¹å¼
        ```xml
        <?xml version="1.0" encoding="UTF-8"?>
        <beans xmlns="http://www.springframework.org/schema/beans"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns:context="http://www.springframework.org/schema/context"
               xmlns:aop="http://www.springframework.org/schema/aop"
               xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd">

            <!-- è¿›è¡ŒåŒ…æ‰«æ-->
            <context:component-scan base-package="com.atguigu" />
            <!-- å¼€å¯aspectjæ¡†æ¶æ³¨è§£æ”¯æŒ-->
            <aop:aspectj-autoproxy />
        </beans>
        ```
    2.  é…ç½®ç±»æ–¹å¼
        ```java
        @Configuration
        @ComponentScan(basePackages = "com.atguigu")
        //ä½œç”¨ç­‰äº <aop:aspectj-autoproxy /> é…ç½®ç±»ä¸Šå¼€å¯ Aspectjæ³¨è§£æ”¯æŒ!
        @EnableAspectJAutoProxy
        public class MyConfig {
        }

        ```
6.  æµ‹è¯•æ•ˆæœ
    ```java
    //@SpringJUnitConfig(locations = "classpath:spring-aop.xml")
    @SpringJUnitConfig(value = {MyConfig.class})
    public class AopTest {

        @Autowired
        private Calculator calculator;

        @Test
        public void testCalculator(){
            calculator.add(1,1);
        }
    }

    ```
    è¾“å‡ºç»“æœï¼š
    ```java
    [AOPå‰ç½®é€šçŸ¥] æ–¹æ³•å¼€å§‹äº†
    [AOPè¿”å›é€šçŸ¥] æ–¹æ³•æˆåŠŸè¿”å›äº†
    [AOPåç½®é€šçŸ¥] æ–¹æ³•æœ€ç»ˆç»“æŸäº†
    ```

- æ³¨æ„ï¼š`@Autowiredå£°æ˜çš„æ˜¯æ¥å£ï¼Œè€Œä¸æ˜¯å®ç°ç±»`
- å› ä¸ºï¼šAOPä»£ç†æ¨¡å¼ï¼Œä½¿ç”¨jdkè¿›è¡Œæ¥å£çš„ä»£ç†ï¼Œæ‰€ä»¥å…·ä½“çš„å®ç°ç±»ï¼Œå’ŒIOCä¸­çš„ä»£ç†ç±»ä¼šå‘ç”Ÿå†²çªï¼ï¼ï¼

#### 5.5.3 è·å–é€šçŸ¥ç»†èŠ‚ä¿¡æ¯

1.  **JointPointæ¥å£**

    éœ€è¦è·å–æ–¹æ³•ç­¾åã€ä¼ å…¥çš„å®å‚ç­‰ä¿¡æ¯æ—¶ï¼Œå¯ä»¥åœ¨é€šçŸ¥æ–¹æ³•å£°æ˜JoinPointç±»å‹çš„å½¢å‚ã€‚
    -   è¦ç‚¹1ï¼šJoinPoint æ¥å£é€šè¿‡ getSignature() æ–¹æ³•è·å–ç›®æ ‡æ–¹æ³•çš„ç­¾åï¼ˆæ–¹æ³•å£°æ˜æ—¶çš„å®Œæ•´ä¿¡æ¯ï¼‰
    -   è¦ç‚¹2ï¼šé€šè¿‡ç›®æ ‡æ–¹æ³•ç­¾åå¯¹è±¡è·å–æ–¹æ³•å
    -   è¦ç‚¹3ï¼šé€šè¿‡ JoinPoint å¯¹è±¡è·å–å¤–ç•Œè°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ä¼ å…¥çš„å®å‚åˆ—è¡¨ç»„æˆçš„æ•°ç»„![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b21e810f3c9ec7a8bfe98f9dc5f05c29.png)


    ```java
    // @Beforeæ³¨è§£æ ‡è®°å‰ç½®é€šçŸ¥æ–¹æ³•
    // valueå±æ€§ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œå‘Šè¯‰Springå½“å‰é€šçŸ¥æ–¹æ³•è¦å¥—ç”¨åˆ°å“ªä¸ªç›®æ ‡æ–¹æ³•ä¸Š
    // åœ¨å‰ç½®é€šçŸ¥æ–¹æ³•å½¢å‚ä½ç½®å£°æ˜ä¸€ä¸ªJoinPointç±»å‹çš„å‚æ•°ï¼ŒSpringå°±ä¼šå°†è¿™ä¸ªå¯¹è±¡ä¼ å…¥
    // æ ¹æ®JoinPointå¯¹è±¡å°±å¯ä»¥è·å–ç›®æ ‡æ–¹æ³•åç§°ã€å®é™…å‚æ•°åˆ—è¡¨
    @Before(value = "execution(public int com.atguigu.aop.api.Calculator.add(int,int))")
    public void printLogBeforeCore(JoinPoint joinPoint) {
        
        // 1.é€šè¿‡JoinPointå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•ç­¾åå¯¹è±¡
        // æ–¹æ³•çš„ç­¾åï¼šä¸€ä¸ªæ–¹æ³•çš„å…¨éƒ¨å£°æ˜ä¿¡æ¯
        Signature signature = joinPoint.getSignature();
        
        // 2.é€šè¿‡æ–¹æ³•çš„ç­¾åå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯
        String methodName = signature.getName();
        System.out.println("methodName = " + methodName);
        
        int modifiers = signature.getModifiers();
        System.out.println("modifiers = " + modifiers);
        
        String declaringTypeName = signature.getDeclaringTypeName();
        System.out.println("declaringTypeName = " + declaringTypeName);
        
        // 3.é€šè¿‡JoinPointå¯¹è±¡è·å–å¤–ç•Œè°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ä¼ å…¥çš„å®å‚åˆ—è¡¨
        Object[] args = joinPoint.getArgs();
        
        // 4.ç”±äºæ•°ç»„ç›´æ¥æ‰“å°çœ‹ä¸åˆ°å…·ä½“æ•°æ®ï¼Œæ‰€ä»¥è½¬æ¢ä¸ºListé›†åˆ
        List<Object> argList = Arrays.asList(args);
        
        System.out.println("[AOPå‰ç½®é€šçŸ¥] " + methodName + "æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°åˆ—è¡¨ï¼š" + argList);
    }
    ```
2.  **æ–¹æ³•è¿”å›å€¼**

    åœ¨è¿”å›é€šçŸ¥ä¸­ï¼Œé€šè¿‡ **@AfterReturning**æ³¨è§£çš„returningå±æ€§è·å–ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ï¼
    ```java
    // @AfterReturningæ³¨è§£æ ‡è®°è¿”å›é€šçŸ¥æ–¹æ³•
    // åœ¨è¿”å›é€šçŸ¥ä¸­è·å–ç›®æ ‡æ–¹æ³•è¿”å›å€¼åˆ†ä¸¤æ­¥ï¼š
    // ç¬¬ä¸€æ­¥ï¼šåœ¨@AfterReturningæ³¨è§£ä¸­é€šè¿‡returningå±æ€§è®¾ç½®ä¸€ä¸ªåç§°
    // ç¬¬äºŒæ­¥ï¼šä½¿ç”¨returningå±æ€§è®¾ç½®çš„åç§°åœ¨é€šçŸ¥æ–¹æ³•ä¸­å£°æ˜ä¸€ä¸ªå¯¹åº”çš„å½¢å‚
    @AfterReturning(
            value = "execution(public int com.atguigu.aop.api.Calculator.add(int,int))",
            returning = "targetMethodReturnValue"
    )
    public void printLogAfterCoreSuccess(JoinPoint joinPoint, Object targetMethodReturnValue) {
        
        String methodName = joinPoint.getSignature().getName();
        
        System.out.println("[AOPè¿”å›é€šçŸ¥] "+methodName+"æ–¹æ³•æˆåŠŸç»“æŸäº†ï¼Œè¿”å›å€¼æ˜¯ï¼š" + targetMethodReturnValue);
    }
    ```
3.  **å¼‚å¸¸å¯¹è±¡æ•æ‰**

    åœ¨å¼‚å¸¸é€šçŸ¥ä¸­ï¼Œé€šè¿‡@AfterThrowingæ³¨è§£çš„throwingå±æ€§è·å–ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡
    ```java
    // @AfterThrowingæ³¨è§£æ ‡è®°å¼‚å¸¸é€šçŸ¥æ–¹æ³•
    // åœ¨å¼‚å¸¸é€šçŸ¥ä¸­è·å–ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸åˆ†ä¸¤æ­¥ï¼š
    // ç¬¬ä¸€æ­¥ï¼šåœ¨@AfterThrowingæ³¨è§£ä¸­å£°æ˜ä¸€ä¸ªthrowingå±æ€§è®¾å®šå½¢å‚åç§°
    // ç¬¬äºŒæ­¥ï¼šä½¿ç”¨throwingå±æ€§æŒ‡å®šçš„åç§°åœ¨é€šçŸ¥æ–¹æ³•å£°æ˜å½¢å‚ï¼ŒSpringä¼šå°†ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡ä»è¿™é‡Œä¼ ç»™æˆ‘ä»¬
    @AfterThrowing(
            value = "execution(public int com.atguigu.aop.api.Calculator.add(int,int))",
            throwing = "targetMethodException"
    )
    public void printLogAfterCoreException(JoinPoint joinPoint, Throwable targetMethodException) {
        
        String methodName = joinPoint.getSignature().getName();
        
        System.out.println("[AOPå¼‚å¸¸é€šçŸ¥] "+methodName+"æ–¹æ³•æŠ›å¼‚å¸¸äº†ï¼Œå¼‚å¸¸ç±»å‹æ˜¯ï¼š" + targetMethodException.getClass().getName());
    }
    ```

#### 5.5.4 åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•

1.  **åˆ‡ç‚¹è¡¨è¾¾å¼ä½œç”¨**

    AOPåˆ‡ç‚¹è¡¨è¾¾å¼ï¼ˆPointcut Expressionï¼‰æ˜¯ä¸€ç§ç”¨äºæŒ‡å®šåˆ‡ç‚¹çš„è¯­è¨€ï¼Œå®ƒå¯ä»¥é€šè¿‡å®šä¹‰åŒ¹é…è§„åˆ™ï¼Œæ¥é€‰æ‹©éœ€è¦è¢«åˆ‡å…¥çš„ç›®æ ‡å¯¹è±¡ã€‚
    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/dcc7d03cd316a79c950bf2007f92350a.png)


2.  **åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•**

    åˆ‡ç‚¹è¡¨è¾¾å¼æ€»ç»“
    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/77a50f560c8e82530b5f56294469597b.png)



    è¯­æ³•ç»†èŠ‚
    -   ç¬¬ä¸€ä½ï¼šexecution( ) å›ºå®šå¼€å¤´
    -   ç¬¬äºŒä½ï¼šæ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦
        ```java
        public private ç›´æ¥æè¿°å¯¹åº”ä¿®é¥°ç¬¦å³å¯
        ```
    -   ç¬¬ä¸‰ä½ï¼šæ–¹æ³•è¿”å›å€¼
        ```java
        int String void ç›´æ¥æè¿°è¿”å›å€¼ç±»å‹

        ```
        æ³¨æ„ï¼š

        ç‰¹æ®Šæƒ…å†µÂ ä¸è€ƒè™‘Â è®¿é—®ä¿®é¥°ç¬¦å’Œè¿”å›å€¼

        execution(\*Â \*Â )Â è¿™æ˜¯é”™è¯¯è¯­æ³•

        execution( \*) == ä½ åªè¦è€ƒè™‘è¿”å›å€¼ æˆ–è€… ä¸è€ƒè™‘è®¿é—®ä¿®é¥°ç¬¦ ç›¸å½“äºå…¨éƒ¨ä¸è€ƒè™‘äº†
    -   ç¬¬å››ä½ï¼šæŒ‡å®šåŒ…çš„åœ°å€
        ```java
         å›ºå®šçš„åŒ…: com.atguigu.api | service | dao
         å•å±‚çš„ä»»æ„å‘½å: com.atguigu.*  = com.atguigu.api  com.atguigu.dao  * = ä»»æ„ä¸€å±‚çš„ä»»æ„å‘½å
         ä»»æ„å±‚ä»»æ„å‘½å: com.. = com.atguigu.api.erdaye com.a.a.a.a.a.a.a  ..ä»»æ„å±‚,ä»»æ„å‘½å ç”¨åœ¨åŒ…ä¸Š!
         æ³¨æ„: ..ä¸èƒ½ç”¨ä½œåŒ…å¼€å¤´   public int .. é”™è¯¯è¯­æ³•  com..
         æ‰¾åˆ°ä»»ä½•åŒ…ä¸‹: *..
        ```
    -   ç¬¬äº”ä½ï¼šæŒ‡å®šç±»åç§°
        ```java
        å›ºå®šåç§°: UserService
        ä»»æ„ç±»å: *
        éƒ¨åˆ†ä»»æ„: com..service.impl.*Impl
        ä»»æ„åŒ…ä»»æ„ç±»: *..*

        ```
    -   ç¬¬å…­ä½ï¼šæŒ‡å®šæ–¹æ³•åç§°
        ```java
        è¯­æ³•å’Œç±»åä¸€è‡´
        ä»»æ„è®¿é—®ä¿®é¥°ç¬¦,ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•: * *..*.*
        ```
    -   ç¬¬ä¸ƒä½ï¼šæ–¹æ³•å‚æ•°
        ```java
        ç¬¬ä¸ƒä½: æ–¹æ³•çš„å‚æ•°æè¿°
               å…·ä½“å€¼: (String,int) != (int,String) æ²¡æœ‰å‚æ•° ()
               æ¨¡ç³Šå€¼: ä»»æ„å‚æ•° æœ‰ æˆ–è€… æ²¡æœ‰ (..)  ..ä»»æ„å‚æ•°çš„æ„è¯†
               éƒ¨åˆ†å…·ä½“å’Œæ¨¡ç³Š:
                 ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²çš„æ–¹æ³• (String..)
                 æœ€åä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸² (..String)
                 å­—ç¬¦ä¸²å¼€å¤´,intç»“å°¾ (String..int)
                 åŒ…å«intç±»å‹(..int..)
        ```
3.  **åˆ‡ç‚¹è¡¨è¾¾å¼æ¡ˆä¾‹**
    ```java
    1.æŸ¥è¯¢æŸåŒ…æŸç±»ä¸‹ï¼Œè®¿é—®ä¿®é¥°ç¬¦æ˜¯å…¬æœ‰ï¼Œè¿”å›å€¼æ˜¯intçš„å…¨éƒ¨æ–¹æ³•
    public int xx.xx.jj.*(..)
    2.æŸ¥è¯¢æŸåŒ…ä¸‹ç±»ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Stringçš„æ–¹æ³•
    * xx.xx.jj.*(String..)
    3.æŸ¥è¯¢å…¨éƒ¨åŒ…ä¸‹ï¼Œæ— å‚æ•°çš„æ–¹æ³•ï¼
    * *..*()
    4.æŸ¥è¯¢comåŒ…ä¸‹ï¼Œä»¥intå‚æ•°ç±»å‹ç»“å°¾çš„æ–¹æ³•
    * com..*.*(..int)
    5.æŸ¥è¯¢æŒ‡å®šåŒ…ä¸‹ï¼ŒServiceå¼€å¤´ç±»çš„ç§æœ‰è¿”å›å€¼intçš„æ— å‚æ•°æ–¹æ³•
    private int xx.xx.Service*.*()
    ```
#### 5.5.5 é‡ç”¨ï¼ˆæå–ï¼‰åˆ‡ç‚¹è¡¨è¾¾å¼

1.  é‡ç”¨åˆ‡ç‚¹è¡¨è¾¾å¼ä¼˜ç‚¹
    ```java
     // @Beforeæ³¨è§£ï¼šå£°æ˜å½“å‰æ–¹æ³•æ˜¯å‰ç½®é€šçŸ¥æ–¹æ³•
    // valueå±æ€§ï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œç”±åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ§åˆ¶å½“å‰é€šçŸ¥æ–¹æ³•è¦ä½œç”¨åœ¨å“ªä¸€ä¸ªç›®æ ‡æ–¹æ³•ä¸Š
    @Before(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogBeforeCore() {
        System.out.println("[AOPå‰ç½®é€šçŸ¥] æ–¹æ³•å¼€å§‹äº†");
    }

    @AfterReturning(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogAfterSuccess() {
        System.out.println("[AOPè¿”å›é€šçŸ¥] æ–¹æ³•æˆåŠŸè¿”å›äº†");
    }

    @AfterThrowing(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogAfterException() {
        System.out.println("[AOPå¼‚å¸¸é€šçŸ¥] æ–¹æ³•æŠ›å¼‚å¸¸äº†");
    }

    @After(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogFinallyEnd() {
        System.out.println("[AOPåç½®é€šçŸ¥] æ–¹æ³•æœ€ç»ˆç»“æŸäº†");
    }
    ```
    ä¸Šé¢æ¡ˆä¾‹ï¼Œæ˜¯æˆ‘ä»¬ä¹‹å‰ç¼–å†™åˆ‡ç‚¹è¡¨è¾¾å¼çš„æ–¹å¼ï¼Œå‘ç°ï¼Œ æ‰€æœ‰å¢å¼ºæ–¹æ³•çš„åˆ‡ç‚¹è¡¨è¾¾å¼ç›¸åŒï¼

    å‡ºç°äº†å†—ä½™ï¼Œå¦‚æœéœ€è¦åˆ‡æ¢ä¹Ÿä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤ï¼

    æˆ‘ä»¬å¯ä»¥å°†åˆ‡ç‚¹æå–ï¼Œåœ¨å¢å¼ºä¸Šè¿›è¡Œå¼•ç”¨å³å¯ï¼

2.  åŒä¸€ç±»å†…éƒ¨å¼•ç”¨

    æå–
    ```java
    // åˆ‡å…¥ç‚¹è¡¨è¾¾å¼é‡ç”¨
    @Pointcut("execution(public int com.atguigu.aop.api.Calculator.add(int,int)))")
    public void declarPointCut() {}
    ```
    æ³¨æ„ï¼šæå–åˆ‡ç‚¹æ³¨è§£ä½¿ç”¨@Pointcut(åˆ‡ç‚¹è¡¨è¾¾å¼) ï¼Œ éœ€è¦æ·»åŠ åˆ°ä¸€ä¸ªæ— å‚æ•°æ— è¿”å›å€¼æ–¹æ³•ä¸Šå³å¯ï¼

    å¼•ç”¨
    ```java
    @Before(value = "declarPointCut()")
    public void printLogBeforeCoreOperation(JoinPoint joinPoint) {
    ```
3.  ä¸åŒç±»ä¸­å¼•ç”¨

    ä¸åŒç±»åœ¨å¼•ç”¨åˆ‡ç‚¹ï¼Œåªéœ€è¦æ·»åŠ ç±»çš„å…¨é™å®šç¬¦+æ–¹æ³•åå³å¯ï¼
    ```java
    @Before(value = "com.atguigu.spring.aop.aspect.LogAspect.declarPointCut()")
    public Object roundAdvice(ProceedingJoinPoint joinPoint) {
    ```
4.  åˆ‡ç‚¹ç»Ÿä¸€ç®¡ç†

    å»ºè®®ï¼šå°†åˆ‡ç‚¹è¡¨è¾¾å¼ç»Ÿä¸€å­˜å‚¨åˆ°ä¸€ä¸ªç±»ä¸­è¿›è¡Œé›†ä¸­ç®¡ç†å’Œç»´æŠ¤ï¼
    è¿™æ ·çš„è¯ï¼Œåœ¨å…¶ä»–é€šçŸ¥ç±»ï¼Œéœ€è¦å¼•ç”¨åˆ‡å…¥ç‚¹çš„æ—¶å€™ï¼Œéœ€è¦å†™å‡ºåˆ‡å…¥ç‚¹çš„å…¨ç±»å
    ```java
    @Component
    public class AtguiguPointCut {
        
        @Pointcut(value = "execution(public int *..Calculator.sub(int,int))")
        public void atguiguGlobalPointCut(){}
        
        @Pointcut(value = "execution(public int *..Calculator.add(int,int))")
        public void atguiguSecondPointCut(){}
        
        @Pointcut(value = "execution(* *..*Service.*(..))")
        public void transactionPointCut(){}
    }
    ```

#### 5.5.6 ç¯ç»•é€šçŸ¥

ç¯ç»•é€šçŸ¥å¯¹åº”æ•´ä¸ª try...catch...finally ç»“æ„ï¼ŒåŒ…æ‹¬å‰é¢å››ç§é€šçŸ¥çš„æ‰€æœ‰åŠŸèƒ½ã€‚

```java
// ä½¿ç”¨@Aroundæ³¨è§£æ ‡æ˜ç¯ç»•é€šçŸ¥æ–¹æ³•
@Around(value = "com.atguigu.aop.aspect.AtguiguPointCut.transactionPointCut()")
public Object manageTransaction(
    
        // é€šè¿‡åœ¨é€šçŸ¥æ–¹æ³•å½¢å‚ä½ç½®å£°æ˜ProceedingJoinPointç±»å‹çš„å½¢å‚ï¼Œ
        // Springä¼šå°†è¿™ä¸ªç±»å‹çš„å¯¹è±¡ä¼ ç»™æˆ‘ä»¬
        ProceedingJoinPoint joinPoint) {
    
    // é€šè¿‡ProceedingJoinPointå¯¹è±¡è·å–å¤–ç•Œè°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ä¼ å…¥çš„å®å‚æ•°ç»„
    Object[] args = joinPoint.getArgs();
    
    // é€šè¿‡ProceedingJoinPointå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•çš„ç­¾åå¯¹è±¡
    Signature signature = joinPoint.getSignature();
    
    // é€šè¿‡ç­¾åå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•çš„æ–¹æ³•å
    String methodName = signature.getName();
    
    // å£°æ˜å˜é‡ç”¨æ¥å­˜å‚¨ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼
    Object targetMethodReturnValue = null;
    
    try {
    
        // åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰ï¼šå¼€å¯äº‹åŠ¡ï¼ˆæ¨¡æ‹Ÿï¼‰
        log.debug("[AOP ç¯ç»•é€šçŸ¥] å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•åï¼š" + methodName + "ï¼Œå‚æ•°åˆ—è¡¨ï¼š" + Arrays.asList(args));
    
        // è¿‡ProceedingJoinPointå¯¹è±¡è°ƒç”¨ç›®æ ‡æ–¹æ³•
        // ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ä¸€å®šè¦è¿”å›ç»™å¤–ç•Œè°ƒç”¨è€…
        targetMethodReturnValue = joinPoint.proceed(args);
    
        // åœ¨ç›®æ ‡æ–¹æ³•æˆåŠŸè¿”å›åï¼šæäº¤äº‹åŠ¡ï¼ˆæ¨¡æ‹Ÿï¼‰
        log.debug("[AOP ç¯ç»•é€šçŸ¥] æäº¤äº‹åŠ¡ï¼Œæ–¹æ³•åï¼š" + methodName + "ï¼Œæ–¹æ³•è¿”å›å€¼ï¼š" + targetMethodReturnValue);
    
    }catch (Throwable e){
    
        // åœ¨ç›®æ ‡æ–¹æ³•æŠ›å¼‚å¸¸åï¼šå›æ»šäº‹åŠ¡ï¼ˆæ¨¡æ‹Ÿï¼‰
        log.debug("[AOP ç¯ç»•é€šçŸ¥] å›æ»šäº‹åŠ¡ï¼Œæ–¹æ³•åï¼š" + methodName + "ï¼Œå¼‚å¸¸ï¼š" + e.getClass().getName());
    
    }finally {
    
        // åœ¨ç›®æ ‡æ–¹æ³•æœ€ç»ˆç»“æŸåï¼šé‡Šæ”¾æ•°æ®åº“è¿æ¥
        log.debug("[AOP ç¯ç»•é€šçŸ¥] é‡Šæ”¾æ•°æ®åº“è¿æ¥ï¼Œæ–¹æ³•åï¼š" + methodName);
    
    }
    
    return targetMethodReturnValue;
}
```

#### 5.5.7 åˆ‡é¢ä¼˜å…ˆçº§è®¾ç½®

ç›¸åŒç›®æ ‡æ–¹æ³•ä¸ŠåŒæ—¶å­˜åœ¨å¤šä¸ªåˆ‡é¢æ—¶ï¼Œåˆ‡é¢çš„ä¼˜å…ˆçº§æ§åˆ¶åˆ‡é¢çš„å†…å¤–åµŒå¥—é¡ºåºã€‚

-   ä¼˜å…ˆçº§é«˜çš„åˆ‡é¢ï¼šå¤–é¢
-   ä¼˜å…ˆçº§ä½çš„åˆ‡é¢ï¼šé‡Œé¢

`ä½¿ç”¨ @Order æ³¨è§£å¯ä»¥æ§åˆ¶åˆ‡é¢çš„ä¼˜å…ˆçº§ï¼š`
`orderæ³¨è§£ä½œç”¨äºé€šçŸ¥ç±»ä¸Š`
-   @Order(è¾ƒå°çš„æ•°)ï¼šä¼˜å…ˆçº§é«˜
-   @Order(è¾ƒå¤§çš„æ•°)ï¼šä¼˜å…ˆçº§ä½

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/04a2e03c2c3a070e1000c3ef23c82771.png)



å®é™…æ„ä¹‰

`å®é™…å¼€å‘æ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªåˆ‡é¢åµŒå¥—çš„æƒ…å†µï¼Œè¦æ…é‡è€ƒè™‘`ã€‚ä¾‹å¦‚ï¼šå¦‚æœäº‹åŠ¡åˆ‡é¢ä¼˜å…ˆçº§é«˜ï¼Œé‚£ä¹ˆåœ¨ç¼“å­˜ä¸­å‘½ä¸­æ•°æ®çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åˆ‡é¢çš„æ“ä½œéƒ½æµªè´¹äº†ã€‚
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/9ecdc5970d0e1f646d51a08a0bed27a4.png)



æ­¤æ—¶åº”è¯¥å°†ç¼“å­˜åˆ‡é¢çš„ä¼˜å…ˆçº§æé«˜ï¼Œåœ¨äº‹åŠ¡æ“ä½œä¹‹å‰å…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç›®æ ‡æ•°æ®ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/015d67186cedc60c94dbd62b598e3d6e.png)



#### 5.5.8 CGLibåŠ¨æ€ä»£ç†ç”Ÿæ•ˆ

åœ¨ç›®æ ‡ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£çš„æƒ…å†µä¸‹ï¼ŒSpringä¼šè‡ªåŠ¨ä½¿ç”¨cglibæŠ€æœ¯å®ç°ä»£ç†ã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åšä¸‹é¢çš„æµ‹è¯•ï¼š

```java
@Service
public class EmployeeService {
    
    public void getEmpList() {
       System.out.print("æ–¹æ³•å†…éƒ¨ com.atguigu.aop.imp.EmployeeService.getEmpList");
    }
}
```

æµ‹è¯•ï¼š

```java
  @Autowired
  private EmployeeService employeeService;
  
  @Test
  public void testNoInterfaceProxy() {
      employeeService.getEmpList();
  }
```

æ²¡æœ‰æ¥å£ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3a2916c0106b3664169acdf6ebf4c596.png)



æœ‰æ¥å£ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/519f273ff88bee5bb7fece281db2b570.png)



ä½¿ç”¨æ€»ç»“ï¼š

a.  å¦‚æœç›®æ ‡ç±»æœ‰æ¥å£,é€‰æ‹©ä½¿ç”¨jdkåŠ¨æ€ä»£ç†
b.  å¦‚æœç›®æ ‡ç±»æ²¡æœ‰æ¥å£,é€‰æ‹©cglibåŠ¨æ€ä»£ç†
c.  å¦‚æœæœ‰æ¥å£,æ¥å£æ¥å€¼
d.  å¦‚æœæ²¡æœ‰æ¥å£,ç±»è¿›è¡Œæ¥å€¼

#### 5.5.9 æ³¨è§£å®ç°å°ç»“

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/f2cdd3ac4e6ab93b0e9f3fb6b7c2271f.png)

### 5.6 Spring AOPåŸºäºXMLæ–¹å¼å®ç°(äº†è§£)

1.  å‡†å¤‡å·¥ä½œ
    åŠ å…¥ä¾èµ–
    å’ŒåŸºäºæ³¨è§£çš„ AOP æ—¶ä¸€æ ·ã€‚
    å‡†å¤‡ä»£ç 
    æŠŠæµ‹è¯•åŸºäºæ³¨è§£åŠŸèƒ½æ—¶çš„Javaç±»å¤åˆ¶åˆ°æ–°moduleä¸­ï¼Œå»é™¤æ‰€æœ‰æ³¨è§£ã€‚
2.  é…ç½®Springé…ç½®æ–‡ä»¶
    ```xml
    <!-- é…ç½®ç›®æ ‡ç±»çš„bean -->
    <bean id="calculatorPure" class="com.atguigu.aop.imp.CalculatorPureImpl"/>
        
    <!-- é…ç½®åˆ‡é¢ç±»çš„bean -->
    <bean id="logAspect" class="com.atguigu.aop.aspect.LogAspect"/>
        
    <!-- é…ç½®AOP -->
    <aop:config>
        
        <!-- é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ -->
        <aop:pointcut id="logPointCut" expression="execution(* *..*.*(..))"/>
        
        <!-- aop:aspectæ ‡ç­¾ï¼šé…ç½®åˆ‡é¢ -->
        <!-- refå±æ€§ï¼šå…³è”åˆ‡é¢ç±»çš„bean -->
        <aop:aspect ref="logAspect">
            <!-- aop:beforeæ ‡ç­¾ï¼šé…ç½®å‰ç½®é€šçŸ¥ -->
            <!-- methodå±æ€§ï¼šæŒ‡å®šå‰ç½®é€šçŸ¥çš„æ–¹æ³•å -->
            <!-- pointcut-refå±æ€§ï¼šå¼•ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ -->
            <aop:before method="printLogBeforeCore" pointcut-ref="logPointCut"/>
        
            <!-- aop:after-returningæ ‡ç­¾ï¼šé…ç½®è¿”å›é€šçŸ¥ -->
            <!-- returningå±æ€§ï¼šæŒ‡å®šé€šçŸ¥æ–¹æ³•ä¸­ç”¨æ¥æ¥æ”¶ç›®æ ‡æ–¹æ³•è¿”å›å€¼çš„å‚æ•°å -->
            <aop:after-returning
                    method="printLogAfterCoreSuccess"
                    pointcut-ref="logPointCut"
                    returning="targetMethodReturnValue"/>
        
            <!-- aop:after-throwingæ ‡ç­¾ï¼šé…ç½®å¼‚å¸¸é€šçŸ¥ -->
            <!-- throwingå±æ€§ï¼šæŒ‡å®šé€šçŸ¥æ–¹æ³•ä¸­ç”¨æ¥æ¥æ”¶ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„å¼‚å¸¸å¯¹è±¡çš„å‚æ•°å -->
            <aop:after-throwing
                    method="printLogAfterCoreException"
                    pointcut-ref="logPointCut"
                    throwing="targetMethodException"/>
        
            <!-- aop:afteræ ‡ç­¾ï¼šé…ç½®åç½®é€šçŸ¥ -->
            <aop:after method="printLogCoreFinallyEnd" pointcut-ref="logPointCut"/>
        
            <!-- aop:aroundæ ‡ç­¾ï¼šé…ç½®ç¯ç»•é€šçŸ¥ -->
            <!--<aop:around method="â€¦â€¦" pointcut-ref="logPointCut"/>-->
        </aop:aspect>
        
    </aop:config>

    ```
3.  æµ‹è¯•
    ```java
    @SpringJUnitConfig(locations = "classpath:spring-aop.xml")
    public class AopTest {

        @Autowired
        private Calculator calculator;

        @Test
        public void testCalculator(){
            System.out.println(calculator);
            calculator.add(1,1);
        }
    }
    ```

### 5.7 Spring AOPå¯¹è·å–Beançš„å½±å“ç†è§£

#### 5.7.1 æ ¹æ®ç±»å‹è£…é… bean

1.  æƒ…æ™¯ä¸€
    -   bean å¯¹åº”çš„ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£
    -   æ ¹æ® bean æœ¬èº«çš„ç±»å‹è·å– bean
        -   æµ‹è¯•ï¼šIOCå®¹å™¨ä¸­åŒç±»å‹çš„ bean åªæœ‰ä¸€ä¸ª
	            æ­£å¸¸è·å–åˆ° IOC å®¹å™¨ä¸­çš„é‚£ä¸ª bean å¯¹è±¡
        -   æµ‹è¯•ï¼šIOC å®¹å™¨ä¸­åŒç±»å‹çš„ bean æœ‰å¤šä¸ª
	            ä¼šæŠ›å‡º NoUniqueBeanDefinitionException å¼‚å¸¸ï¼Œè¡¨ç¤º IOC å®¹å™¨ä¸­è¿™ä¸ªç±»å‹çš„ bean æœ‰å¤šä¸ª

2.  æƒ…æ™¯äºŒ
    -   bean å¯¹åº”çš„ç±»å®ç°äº†æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¹Ÿåªæœ‰è¿™ä¸€ä¸ªå®ç°ç±»
        -   æµ‹è¯•ï¼šæ ¹æ®æ¥å£ç±»å‹è·å– bean
        -   æµ‹è¯•ï¼šæ ¹æ®ç±»è·å– bean
        -   ç»“è®ºï¼šä¸Šé¢ä¸¤ç§æƒ…å†µå…¶å®éƒ½èƒ½å¤Ÿæ­£å¸¸è·å–åˆ° beanï¼Œè€Œä¸”æ˜¯åŒä¸€ä¸ªå¯¹è±¡

3.  æƒ…æ™¯ä¸‰
    -   å£°æ˜ä¸€ä¸ªæ¥å£
    -   æ¥å£æœ‰å¤šä¸ªå®ç°ç±»
    -   æ¥å£æ‰€æœ‰å®ç°ç±»éƒ½æ”¾å…¥ IOC å®¹å™¨
        -   æµ‹è¯•ï¼šæ ¹æ®æ¥å£ç±»å‹è·å– bean
	            ä¼šæŠ›å‡º NoUniqueBeanDefinitionException å¼‚å¸¸ï¼Œè¡¨ç¤º IOC å®¹å™¨ä¸­è¿™ä¸ªç±»å‹çš„ bean æœ‰å¤šä¸ª
        -   æµ‹è¯•ï¼šæ ¹æ®ç±»è·å–bean
	            æ­£å¸¸

4.  æƒ…æ™¯å››
    -   å£°æ˜ä¸€ä¸ªæ¥å£
    -   æ¥å£æœ‰ä¸€ä¸ªå®ç°ç±»
    -   åˆ›å»ºä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå¯¹ä¸Šé¢æ¥å£çš„å®ç°ç±»åº”ç”¨é€šçŸ¥
        -   æµ‹è¯•ï¼šæ ¹æ®æ¥å£ç±»å‹è·å–bean
	            æ­£å¸¸
        -   æµ‹è¯•ï¼šæ ¹æ®å®ç°ç±»è·å–bean
	            æ— æ³•è·å–
	            åŸå› åˆ†æï¼š
		    -   åº”ç”¨äº†åˆ‡é¢åï¼ŒçœŸæ­£æ”¾åœ¨IOCå®¹å™¨ä¸­çš„æ˜¯ä»£ç†ç±»çš„å¯¹è±¡
		    -   ç›®æ ‡ç±»å¹¶æ²¡æœ‰è¢«æ”¾åˆ°IOCå®¹å™¨ä¸­ï¼Œæ‰€ä»¥æ ¹æ®ç›®æ ‡ç±»çš„ç±»å‹ä»IOCå®¹å™¨ä¸­æ˜¯æ‰¾ä¸åˆ°çš„

        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/030dd650475cb3c80042ec171684c3f5.png)


5.  æƒ…æ™¯äº”
    -   å£°æ˜ä¸€ä¸ªç±»
    -   åˆ›å»ºä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå¯¹ä¸Šé¢çš„ç±»åº”ç”¨é€šçŸ¥
        -   æµ‹è¯•ï¼šæ ¹æ®ç±»è·å– beanï¼Œèƒ½è·å–åˆ°
            ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0018e1e556ceecc8e00c71a3ddd680a8.png)


        debugæŸ¥çœ‹å®é™…ç±»å‹ï¼š

        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8b8e6f2627bcab0eefc8a83c813f247b.png)



#### 5.7.2 ä½¿ç”¨æ€»ç»“

å¯¹å®ç°äº†æ¥å£çš„ç±»åº”ç”¨åˆ‡é¢![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7cdc0cdbbe9552e825a4c984a4a681bc.png)

å¯¹æ²¡å®ç°æ¥å£çš„ç±»åº”ç”¨åˆ‡é¢new![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b0a966e9c142c014379e426db5f1ee7b.png)



**å¦‚æœä½¿ç”¨AOPæŠ€æœ¯ï¼Œç›®æ ‡ç±»æœ‰æ¥å£ï¼Œå¿…é¡»ä½¿ç”¨æ¥å£ç±»å‹æ¥æ”¶IoCå®¹å™¨ä¸­ä»£ç†ç»„ä»¶ï¼**

## 6 Spring å£°æ˜å¼äº‹åŠ¡

### 6.1 å£°æ˜å¼äº‹åŠ¡æ¦‚å¿µ

#### 6.1.1 ç¼–ç¨‹å¼äº‹åŠ¡

ç¼–ç¨‹å¼äº‹åŠ¡æ˜¯æŒ‡æ‰‹åŠ¨ç¼–å†™ç¨‹åºæ¥ç®¡ç†äº‹åŠ¡ï¼Œå³é€šè¿‡ç¼–å†™ä»£ç çš„æ–¹å¼ç›´æ¥æ§åˆ¶äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚åœ¨ Java ä¸­ï¼Œé€šå¸¸ä½¿ç”¨äº‹åŠ¡ç®¡ç†å™¨(å¦‚ Spring ä¸­çš„`PlatformTransactionManager`)æ¥å®ç°ç¼–ç¨‹å¼äº‹åŠ¡ã€‚

ç¼–ç¨‹å¼äº‹åŠ¡çš„ä¸»è¦ä¼˜ç‚¹æ˜¯çµæ´»æ€§é«˜ï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚æ¥æ§åˆ¶äº‹åŠ¡çš„ç²’åº¦ã€æ¨¡å¼ç­‰ç­‰ã€‚ä½†æ˜¯ï¼Œç¼–å†™å¤§é‡çš„äº‹åŠ¡æ§åˆ¶ä»£ç å®¹æ˜“å‡ºç°é—®é¢˜ï¼Œå¯¹ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æœ‰ä¸€å®šå½±å“ã€‚

```java
Connection conn = ...;
  
try {
    // å¼€å¯äº‹åŠ¡ï¼šå…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤
    conn.setAutoCommit(false);
    // æ ¸å¿ƒæ“ä½œ
    // ä¸šåŠ¡ä»£ç 
    // æäº¤äº‹åŠ¡
    conn.commit();
  
}catch(Exception e){
  
    // å›æ»šäº‹åŠ¡
    conn.rollBack();
  
}finally{
  
    // é‡Šæ”¾æ•°æ®åº“è¿æ¥
    conn.close();
  
}
```

`ç¼–ç¨‹å¼çš„å®ç°æ–¹å¼å­˜åœ¨ç¼ºé™·`ï¼š

-   `ç»†èŠ‚æ²¡æœ‰è¢«å±è”½`ï¼šå…·ä½“æ“ä½œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰ç»†èŠ‚éƒ½éœ€è¦ç¨‹åºå‘˜è‡ªå·±æ¥å®Œæˆï¼Œæ¯”è¾ƒç¹çã€‚
-   `ä»£ç å¤ç”¨æ€§ä¸é«˜`ï¼šå¦‚æœæ²¡æœ‰æœ‰æ•ˆæŠ½å–å‡ºæ¥ï¼Œæ¯æ¬¡å®ç°åŠŸèƒ½éƒ½éœ€è¦è‡ªå·±ç¼–å†™ä»£ç ï¼Œä»£ç å°±æ²¡æœ‰å¾—åˆ°å¤ç”¨ã€‚

#### 6.1.2 å£°æ˜å¼äº‹åŠ¡

å£°æ˜å¼äº‹åŠ¡æ˜¯æŒ‡ä½¿ç”¨æ³¨è§£æˆ– XML é…ç½®çš„æ–¹å¼æ¥æ§åˆ¶äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚

å¼€å‘è€…åªéœ€è¦æ·»åŠ é…ç½®å³å¯ï¼Œ å…·ä½“äº‹åŠ¡çš„å®ç°ç”±ç¬¬ä¸‰æ–¹æ¡†æ¶å®ç°ï¼Œé¿å…æˆ‘ä»¬ç›´æ¥è¿›è¡Œäº‹åŠ¡æ“ä½œï¼

`ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡å¯ä»¥å°†äº‹åŠ¡çš„æ§åˆ¶å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»å¼€æ¥ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§`

åŒºåˆ«ï¼š

-   ç¼–ç¨‹å¼äº‹åŠ¡éœ€è¦`æ‰‹åŠ¨ç¼–å†™ä»£ç æ¥ç®¡ç†äº‹åŠ¡`
-   è€Œå£°æ˜å¼äº‹åŠ¡å¯ä»¥`é€šè¿‡é…ç½®æ–‡ä»¶æˆ–æ³¨è§£æ¥æ§åˆ¶äº‹åŠ¡`

#### 6.1.3 Springäº‹åŠ¡ç®¡ç†å™¨

1.  Springå£°æ˜å¼äº‹åŠ¡å¯¹åº”ä¾èµ–
    -   spring-tx: åŒ…å«å£°æ˜å¼äº‹åŠ¡å®ç°çš„åŸºæœ¬è§„èŒƒï¼ˆäº‹åŠ¡ç®¡ç†å™¨è§„èŒƒæ¥å£å’Œäº‹åŠ¡å¢å¼ºç­‰ç­‰ï¼‰
    -   spring-jdbc: åŒ…å«DataSourceæ–¹å¼äº‹åŠ¡ç®¡ç†å™¨å®ç°ç±»DataSourceTransactionManager
    -   spring-orm: åŒ…å«å…¶ä»–æŒä¹…å±‚æ¡†æ¶çš„äº‹åŠ¡ç®¡ç†å™¨å®ç°ç±»ä¾‹å¦‚ï¼šHibernate/Jpaç­‰

2.  Springå£°æ˜å¼äº‹åŠ¡å¯¹åº”äº‹åŠ¡ç®¡ç†å™¨æ¥å£![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/639cbece8808e89c32ff60ffd02ade83.png)



    æˆ‘ä»¬ç°åœ¨è¦ä½¿ç”¨çš„äº‹åŠ¡ç®¡ç†å™¨æ˜¯org.springframework.jdbc.datasource.DataSourceTransactionManagerï¼Œå°†æ¥æ•´åˆ JDBCæ–¹å¼ã€JdbcTemplateæ–¹å¼ã€Mybatisæ–¹å¼çš„äº‹åŠ¡å®ç°ï¼

    DataSourceTransactionManagerç±»ä¸­çš„ä¸»è¦æ–¹æ³•ï¼š
    -   `doBegin()`ï¼šå¼€å¯äº‹åŠ¡
    -   `doSuspend()`ï¼šæŒ‚èµ·äº‹åŠ¡
    -   `doResume()`ï¼šæ¢å¤æŒ‚èµ·çš„äº‹åŠ¡
    -   `doCommit()`ï¼šæäº¤äº‹åŠ¡
    -   `doRollback()`ï¼šå›æ»šäº‹åŠ¡

### 6.2 åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡

#### 6.2.1 å‡†å¤‡å·¥ä½œ

1.  å‡†å¤‡é¡¹ç›®
    ```xml
    <dependencies>
      <!--spring contextä¾èµ–-->
      <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-context</artifactId>
          <version>6.0.6</version>
      </dependency>

      <!--junit5æµ‹è¯•-->
      <dependency>
          <groupId>org.junit.jupiter</groupId>
          <artifactId>junit-jupiter-api</artifactId>
          <version>5.3.1</version>
      </dependency>


      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-test</artifactId>
          <version>6.0.6</version>
          <scope>test</scope>
      </dependency>

      <dependency>
          <groupId>jakarta.annotation</groupId>
          <artifactId>jakarta.annotation-api</artifactId>
          <version>2.1.1</version>
      </dependency>

      <!-- æ•°æ®åº“é©±åŠ¨ å’Œ è¿æ¥æ± -->
      <dependency>
          <groupId>mysql</groupId>
          <artifactId>mysql-connector-java</artifactId>
          <version>8.0.25</version>
      </dependency>

      <dependency>
          <groupId>com.alibaba</groupId>
          <artifactId>druid</artifactId>
          <version>1.2.8</version>
      </dependency>

      <!-- spring-jdbc -->
      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-jdbc</artifactId>
          <version>6.0.6</version>
      </dependency>

      <!-- å£°æ˜å¼äº‹åŠ¡ä¾èµ–-->
      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-tx</artifactId>
          <version>6.0.6</version>
      </dependency>


      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-aop</artifactId>
          <version>6.0.6</version>
      </dependency>

      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-aspects</artifactId>
          <version>6.0.6</version>
      </dependency>
    </dependencies>
    ```

2.  å¤–éƒ¨é…ç½®æ–‡ä»¶

    jdbc.properties
    ```.properties
    atguigu.url=jdbc:mysql://localhost:3306/studb
    atguigu.driver=com.mysql.cj.jdbc.Driver
    atguigu.username=root
    atguigu.password=root
    ```

3.  springé…ç½®æ–‡ä»¶
    ```java
    @Configuration
    @ComponentScan("com.atguigu")
    @PropertySource("classpath:jdbc.properties")
    public class JavaConfig {

        @Value("${atguigu.driver}")
        private String driver;
        @Value("${atguigu.url}")
        private String url;
        @Value("${atguigu.username}")
        private String username;
        @Value("${atguigu.password}")
        private String password;



        //druidè¿æ¥æ± 
        @Bean
        public DataSource dataSource(){
            DruidDataSource dataSource = new DruidDataSource();
            dataSource.setDriverClassName(driver);
            dataSource.setUrl(url);
            dataSource.setUsername(username);
            dataSource.setPassword(password);
            return dataSource;
        }


        @Bean
        //jdbcTemplate
        public JdbcTemplate jdbcTemplate(DataSource dataSource){
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            jdbcTemplate.setDataSource(dataSource);
            return jdbcTemplate;
        }

    }

    ```

4.  å‡†å¤‡dao/serviceå±‚

    dao
    ```java
    @Repository
    public class StudentDao {
        
        @Autowired
        private JdbcTemplate jdbcTemplate;
        
        public void updateNameById(String name,Integer id){
            String sql = "update students set name = ? where id = ? ;";
            int rows = jdbcTemplate.update(sql, name, id);
        }

        public void updateAgeById(Integer age,Integer id){
            String sql = "update students set age = ? where id = ? ;";
            jdbcTemplate.update(sql,age,id);
        }
    }

    ```
    service
    ```java
    @Service
    public class StudentService {
        
        @Autowired
        private StudentDao studentDao;
        
        public void changeInfo(){
            studentDao.updateAgeById(100,1);
            System.out.println("-----------");
            studentDao.updateNameById("test1",1);
        }
    }

    ```
5.  æµ‹è¯•ç¯å¢ƒæ­å»º
    ```java
    /**
     * projectName: com.atguigu.test
     *
     * description:
     */
    @SpringJUnitConfig(JavaConfig.class)
    public class TxTest {

        @Autowired
        private StudentService studentService;

        @Test
        public void  testTx(){
            studentService.changeInfo();
        }
    }

    ```

#### 6.2.2 åŸºæœ¬äº‹åŠ¡æ§åˆ¶

1.  é…ç½®äº‹åŠ¡ç®¡ç†å™¨

    æ•°æ®åº“ç›¸å…³çš„é…ç½®
    ```java
    /**
     * projectName: com.atguigu.config
     *
     * description: æ•°æ®åº“å’Œè¿æ¥æ± é…ç½®ç±»
     */

    @Configuration
    @ComponenScan("com.atguigu")
    @PropertySource(value = "classpath:jdbc.properties")
    @EnableTransactionManagement
    public class DataSourceConfig {

        /**
         * å®ä¾‹åŒ–dataSourceåŠ å…¥åˆ°iocå®¹å™¨
         * @param url
         * @param driver
         * @param username
         * @param password
         * @return
         */
        @Bean
        public DataSource dataSource(@Value("${atguigu.url}")String url,
                                     @Value("${atguigu.driver}")String driver,
                                     @Value("${atguigu.username}")String username,
                                     @Value("${atguigu.password}")String password){
            DruidDataSource dataSource = new DruidDataSource();
            dataSource.setDriverClassName(driver);
            dataSource.setUrl(url);
            dataSource.setUsername(username);
            dataSource.setPassword(password);

            return dataSource;
        }

        /**
         * å®ä¾‹åŒ–JdbcTemplateå¯¹è±¡,éœ€è¦ä½¿ç”¨iocä¸­çš„DataSource
         * @param dataSource
         * @return
         */
        @Bean
        public JdbcTemplate jdbcTemplate(DataSource dataSource){
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            jdbcTemplate.setDataSource(dataSource);
            return jdbcTemplate;
        }
        
        /**
         * è£…é…äº‹åŠ¡ç®¡ç†å®ç°å¯¹è±¡
         * @param dataSource
         * @return
         */
        @Bean
        public TransactionManager transactionManager(DataSource dataSource){
            return new DataSourceTransactionManager(dataSource);
        }

    }

    ```

2.  ä½¿ç”¨å£°æ˜äº‹åŠ¡æ³¨è§£@Transactional
    ```java
    /**
     * projectName: com.atguigu.service
     *
     */
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        @Transactional
        public void changeInfo(){
            studentDao.updateAgeById(100,1);
            System.out.println("-----------");
            int i = 1/0;
            studentDao.updateNameById("test1",1);
        }
    }

    ```

3.  æµ‹è¯•äº‹åŠ¡æ•ˆæœ
    ```java
    /**
     * projectName: com.atguigu.test
     *
     * description:
     */
    //@SpringJUnitConfig(locations = "classpath:application.xml")
    @SpringJUnitConfig(classes = DataSourceConfig.class)
    public class TxTest {

        @Autowired
        private StudentService studentService;

        @Test
        public void  testTx(){
            studentService.changeInfo();
        }
    }

    ```

#### 6.2.3 äº‹åŠ¡å±æ€§ï¼šåªè¯»

1.  åªè¯»ä»‹ç»

    å¯¹ä¸€ä¸ªæŸ¥è¯¢æ“ä½œæ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå®ƒè®¾ç½®æˆåªè¯»ï¼Œå°±èƒ½å¤Ÿæ˜ç¡®å‘Šè¯‰æ•°æ®åº“ï¼Œè¿™ä¸ªæ“ä½œä¸æ¶‰åŠå†™æ“ä½œã€‚è¿™æ ·æ•°æ®åº“å°±èƒ½å¤Ÿé’ˆå¯¹æŸ¥è¯¢æ“ä½œæ¥è¿›è¡Œä¼˜åŒ–ã€‚

2.  è®¾ç½®æ–¹å¼
    ```java
    // readOnly = trueæŠŠå½“å‰äº‹åŠ¡è®¾ç½®ä¸ºåªè¯» é»˜è®¤æ˜¯false!
    @Transactional(readOnly = true)
    ```

3.  é’ˆå¯¹DMLåŠ¨ä½œè®¾ç½®åªè¯»æ¨¡å¼

    ä¼šæŠ›å‡ºä¸‹é¢å¼‚å¸¸ï¼š

    Caused by: java.sql.SQLException: Connection is read-only. Queries leading to data modification are not allowed

4.  @Transactionalæ³¨è§£æ”¾åœ¨ç±»ä¸Š
    1.  ç”Ÿæ•ˆåŸåˆ™

        `å¦‚æœä¸€ä¸ªç±»ä¸­æ¯ä¸€ä¸ªæ–¹æ³•ä¸Šéƒ½ä½¿ç”¨äº† @Transactional æ³¨è§£ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°† @Transactional æ³¨è§£æå–åˆ°ç±»ä¸Š`ã€‚åè¿‡æ¥è¯´ï¼š@Transactional æ³¨è§£åœ¨ç±»çº§åˆ«æ ‡è®°ï¼Œä¼šå½±å“åˆ°ç±»ä¸­çš„æ¯ä¸€ä¸ªæ–¹æ³•ã€‚åŒæ—¶ï¼Œç±»çº§åˆ«æ ‡è®°çš„ @Transactional æ³¨è§£ä¸­è®¾ç½®çš„äº‹åŠ¡å±æ€§ä¹Ÿä¼šå»¶ç»­å½±å“åˆ°æ–¹æ³•æ‰§è¡Œæ—¶çš„äº‹åŠ¡å±æ€§ã€‚é™¤éåœ¨æ–¹æ³•ä¸Šåˆè®¾ç½®äº† @Transactional æ³¨è§£ã€‚

        å¯¹ä¸€ä¸ªæ–¹æ³•æ¥è¯´ï¼Œç¦»å®ƒæœ€è¿‘çš„ @Transactional æ³¨è§£ä¸­çš„äº‹åŠ¡å±æ€§è®¾ç½®ç”Ÿæ•ˆã€‚

	2.  ç”¨æ³•ä¸¾ä¾‹

        åœ¨ç±»çº§åˆ«@Transactionalæ³¨è§£ä¸­è®¾ç½®åªè¯»ï¼Œè¿™æ ·ç±»ä¸­æ‰€æœ‰çš„æŸ¥è¯¢æ–¹æ³•éƒ½ä¸éœ€è¦è®¾ç½®@Transactionalæ³¨è§£äº†ã€‚å› ä¸ºå¯¹æŸ¥è¯¢æ“ä½œæ¥è¯´ï¼Œå…¶ä»–å±æ€§é€šå¸¸ä¸éœ€è¦è®¾ç½®ï¼Œæ‰€ä»¥ä½¿ç”¨å…¬å…±è®¾ç½®å³å¯ã€‚

        ç„¶ååœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå¯¹å¢åˆ æ”¹æ–¹æ³•è®¾ç½®@Transactionalæ³¨è§£ readOnly å±æ€§ä¸º falseã€‚
    ```java
    @Service
    @Transactional(readOnly = true)
    public class EmpService {
        
        // ä¸ºäº†ä¾¿äºæ ¸å¯¹æ•°æ®åº“æ“ä½œç»“æœï¼Œä¸è¦ä¿®æ”¹åŒä¸€æ¡è®°å½•
        @Transactional(readOnly = false)
        public void updateTwice(â€¦â€¦) {
        â€¦â€¦
        }
        
        // readOnly = trueæŠŠå½“å‰äº‹åŠ¡è®¾ç½®ä¸ºåªè¯»
        // @Transactional(readOnly = true)
        public String getEmpName(Integer empId) {
        â€¦â€¦
        }
        
    }
    ```

#### 6.2.4 äº‹åŠ¡å±æ€§ï¼šè¶…æ—¶æ—¶é—´

1.  éœ€æ±‚

    äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½å› ä¸ºé‡åˆ°æŸäº›é—®é¢˜ï¼Œå¯¼è‡´ç¨‹åºå¡ä½ï¼Œä»è€Œé•¿æ—¶é—´å ç”¨æ•°æ®åº“èµ„æºã€‚è€Œé•¿æ—¶é—´å ç”¨èµ„æºï¼Œå¤§æ¦‚ç‡æ˜¯å› ä¸ºç¨‹åºè¿è¡Œå‡ºç°äº†é—®é¢˜ï¼ˆå¯èƒ½æ˜¯Javaç¨‹åºæˆ–MySQLæ•°æ®åº“æˆ–ç½‘ç»œè¿æ¥ç­‰ç­‰ï¼‰ã€‚

    æ­¤æ—¶è¿™ä¸ªå¾ˆå¯èƒ½å‡ºé—®é¢˜çš„ç¨‹åºåº”è¯¥è¢«å›æ»šï¼Œæ’¤é”€å®ƒå·²åšçš„æ“ä½œï¼Œäº‹åŠ¡ç»“æŸï¼ŒæŠŠèµ„æºè®©å‡ºæ¥ï¼Œè®©å…¶ä»–æ­£å¸¸ç¨‹åºå¯ä»¥æ‰§è¡Œã€‚

    æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ä¸€å¥è¯ï¼š`è¶…æ—¶å›æ»šï¼Œé‡Šæ”¾èµ„æº`ã€‚

2.  è®¾ç½®è¶…æ—¶æ—¶é—´
    ```java
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         */
        @Transactional(readOnly = false,timeout = 3)
        public void changeInfo(){
            studentDao.updateAgeById(100,1);
            //ä¼‘çœ 4ç§’,ç­‰å¾…æ–¹æ³•è¶…æ—¶!
            try {
                Thread.sleep(4000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            studentDao.updateNameById("test1",1);
        }
    }

    ```

3.  æµ‹è¯•è¶…æ—¶æ•ˆæœ

    æ‰§è¡ŒæŠ›å‡ºäº‹åŠ¡è¶…æ—¶å¼‚å¸¸
    ```java
    org.springframework.transaction.TransactionTimedOutException: Transaction timed out: deadline was Wed May 24 09:10:43 IRKT 2023

      at org.springframework.transaction.support.ResourceHolderSupport.checkTransactionTimeout(ResourceHolderSupport.java:155)
      at org.springframework.transaction.support.ResourceHolderSupport.getTimeToLiveInMillis(ResourceHolderSupport.java:144)
      at org.springframework.transaction.support.ResourceHolderSupport.getTimeToLiveInSeconds(ResourceHolderSupport.java:128)
      at org.springframework.jdbc.datasource.DataSourceUtils.applyTimeout(DataSourceUtils.java:341)
      at org.springframework.jdbc.core.JdbcTemplate.applyStatementSettings(JdbcTemplate.java:1467)

    ```

#### 6.2.5 äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡å¼‚å¸¸

1.  é»˜è®¤æƒ…å†µ

    `é»˜è®¤åªé’ˆå¯¹è¿è¡Œæ—¶å¼‚å¸¸å›æ»š`ï¼Œç¼–è¯‘æ—¶å¼‚å¸¸ä¸å›æ»šã€‚æƒ…æ™¯æ¨¡æ‹Ÿä»£ç å¦‚ä¸‹ï¼š
    ```java
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
         * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
         */
        @Transactional(readOnly = false,timeout = 3)
        public void changeInfo() throws FileNotFoundException {
            studentDao.updateAgeById(100,1);
            //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…! 
            new FileInputStream("xxxx");
            studentDao.updateNameById("test1",1);
        }
    }
    ```

2.  è®¾ç½®å›æ»šå¼‚å¸¸

    `rollbackForå±æ€§ï¼šæŒ‡å®šå“ªäº›å¼‚å¸¸ç±»æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š`!
    ```java
    /**
     * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
     * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
     * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
     */
    @Transactional(readOnly = false,timeout = 3,rollbackFor = Exception.class)
    public void changeInfo() throws FileNotFoundException {
        studentDao.updateAgeById(100,1);
        //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…! 
        new FileInputStream("xxxx");
        studentDao.updateNameById("test1",1);
    }
    ```

3.  è®¾ç½®ä¸å›æ»šçš„å¼‚å¸¸

    åœ¨é»˜è®¤è®¾ç½®å’Œå·²æœ‰è®¾ç½®çš„åŸºç¡€ä¸Šï¼Œå†æŒ‡å®šä¸€ä¸ªå¼‚å¸¸ç±»å‹ï¼Œç¢°åˆ°å®ƒä¸å›æ»šã€‚

    `noRollbackForå±æ€§ï¼šæŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…`!
    ```java
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
         * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
         */
        @Transactional(readOnly = false,timeout = 3,rollbackFor = Exception.class,noRollbackFor = FileNotFoundException.class)
        public void changeInfo() throws FileNotFoundException {
            studentDao.updateAgeById(100,1);
            //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…!
            new FileInputStream("xxxx");
            studentDao.updateNameById("test1",1);
        }
    }

    ```

#### 6.2.6 äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«

1.  äº‹åŠ¡éš”ç¦»çº§åˆ«

    æ•°æ®åº“äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æ˜¯æŒ‡åœ¨å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œæ•°æ®åº“ç³»ç»Ÿä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§æ‰€éµå¾ªçš„è§„å®šã€‚å¸¸è§çš„éš”ç¦»çº§åˆ«åŒ…æ‹¬ï¼š
    1.  è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰ï¼šäº‹åŠ¡å¯ä»¥è¯»å–æœªè¢«æäº¤çš„æ•°æ®ï¼Œå®¹æ˜“äº§ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ç­‰é—®é¢˜ã€‚å®ç°ç®€å•ä½†ä¸å¤ªå®‰å…¨ï¼Œä¸€èˆ¬ä¸ç”¨ã€‚
    2.  è¯»å·²æäº¤ï¼ˆRead Committedï¼‰ï¼šäº‹åŠ¡åªèƒ½è¯»å–å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é¿å…è„è¯»é—®é¢˜ï¼Œä½†å¯èƒ½å¼•å‘ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚
    3.  å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç›¸åŒçš„æŸ¥è¯¢å°†è¿”å›ç›¸åŒçš„ç»“æœé›†ï¼Œä¸ç®¡å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®åšäº†ä»€ä¹ˆä¿®æ”¹ã€‚å¯ä»¥é¿å…è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†ä»æœ‰å¹»è¯»çš„é—®é¢˜ã€‚
    4.  ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨ç¦æ­¢äº†å¹¶å‘ï¼Œåªå…è®¸ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½æ‰§è¡Œå¦ä¸€ä¸ªäº‹åŠ¡ã€‚å¯ä»¥é¿å…ä»¥ä¸Šæ‰€æœ‰é—®é¢˜ï¼Œä½†æ•ˆç‡è¾ƒä½ï¼Œä¸é€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ã€‚
        ä¸åŒçš„éš”ç¦»çº§åˆ«é€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼Œéœ€è¦æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚è¿›è¡Œé€‰æ‹©å’Œè°ƒæ•´ã€‚

2.  äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®
    ```java
    package com.atguigu.service;

    import com.atguigu.dao.StudentDao;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Service;
    import org.springframework.transaction.annotation.Isolation;
    import org.springframework.transaction.annotation.Transactional;

    import java.io.FileInputStream;
    import java.io.FileNotFoundException;

    /**
     * projectName: com.atguigu.service
     */
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
         * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
         * isolation = è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«,mysqlé»˜è®¤æ˜¯repeatable read!
         */
        @Transactional(readOnly = false,
                       timeout = 3,
                       rollbackFor = Exception.class,
                       noRollbackFor = FileNotFoundException.class,
                       isolation = Isolation.REPEATABLE_READ)
        public void changeInfo() throws FileNotFoundException {
            studentDao.updateAgeById(100,1);
            //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…!
            new FileInputStream("xxxx");
            studentDao.updateNameById("test1",1);
        }
    }

    ```

#### 6.2.7 äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡ä¼ æ’­è¡Œä¸º

1.  äº‹åŠ¡ä¼ æ’­è¡Œä¸ºè¦ç ”ç©¶çš„é—®é¢˜
    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0e644245b9e1ef88c501ca3b5e82c916.png)
    ä¸¾ä¾‹ä»£ç ï¼š
    ```java
    @Transactional
    public void MethodA(){
        // ...
        MethodB();
        // ...
    }

    //åœ¨è¢«è°ƒç”¨çš„å­æ–¹æ³•ä¸­è®¾ç½®ä¼ æ’­è¡Œä¸ºï¼Œä»£è¡¨å¦‚ä½•å¤„ç†è°ƒç”¨çš„äº‹åŠ¡ï¼ æ˜¯åŠ å…¥ï¼Œè¿˜æ˜¯æ–°äº‹åŠ¡ç­‰ï¼
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void MethodB(){
        // ...
    }

    ```

2.  propagationå±æ€§

    @Transactional æ³¨è§£é€šè¿‡ propagation å±æ€§è®¾ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯ï¼š
    ```java
    Propagation propagation() default Propagation.REQUIRED;

    ```
    propagation å±æ€§çš„å¯é€‰å€¼ç”± org.springframework.transaction.annotation.Propagation æšä¸¾ç±»æä¾›ï¼š
	 ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/bad87ddca6c2ccac14d7a97a8dea3975.png)


    
1.  æµ‹è¯•
    1.  å£°æ˜ä¸¤ä¸ªä¸šåŠ¡æ–¹æ³•
        ```java
        @Service
        public class StudentService {

            @Autowired
            private StudentDao studentDao;

            /**
             * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
             * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
             * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
             * isolation = è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«,mysqlé»˜è®¤æ˜¯repeatable read!
             */
            @Transactional(readOnly = false,
                           timeout = 3,
                           rollbackFor = Exception.class,
                           noRollbackFor = FileNotFoundException.class,
                           isolation = Isolation.REPEATABLE_READ)
            public void changeInfo() throws FileNotFoundException {
                studentDao.updateAgeById(100,1);
                //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…!
                new FileInputStream("xxxx");
                studentDao.updateNameById("test1",1);
            }
            

            /**
             * å£°æ˜ä¸¤ä¸ªç‹¬ç«‹ä¿®æ”¹æ•°æ®åº“çš„äº‹åŠ¡ä¸šåŠ¡æ–¹æ³•
             */
            @Transactional(propagation = Propagation.REQUIRED)
            public void changeAge(){
                studentDao.updateAgeById(99,1);
            }

            @Transactional(propagation = Propagation.REQUIRED)
            public void changeName(){
                studentDao.updateNameById("test2",1);
                int i = 1/0;
            }

        }
        ```

	2.  å£°æ˜ä¸€ä¸ªæ•´åˆä¸šåŠ¡æ–¹æ³•
        ```java
        @Service
        public class TopService {

            @Autowired
            private StudentService studentService;

            @Transactional
            public void  topService(){
                studentService.changeAge();
                studentService.changeName();
            }
        }

        ```

	3.  æ·»åŠ ä¼ æ’­è¡Œä¸ºæµ‹è¯•
        ```java
        @SpringJUnitConfig(classes = AppConfig.class)
        public class TxTest {

            @Autowired
            private StudentService studentService;

            @Autowired
            private TopService topService;

            @Test
            public void  testTx() throws FileNotFoundException {
                topService.topService();
            }
        }

        ```
    **æ³¨æ„ï¼š**

    `åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œå¯¹äº@Transactionalæ³¨è§£çš„æ–¹æ³•è°ƒç”¨ï¼Œäº‹åŠ¡ä¼ æ’­è¡Œä¸ºä¸ä¼šç”Ÿæ•ˆ`ã€‚è¿™æ˜¯å› ä¸ºSpringæ¡†æ¶ä¸­ä½¿ç”¨ä»£ç†æ¨¡å¼å®ç°äº†äº‹åŠ¡æœºåˆ¶ï¼Œåœ¨åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•è°ƒç”¨å¹¶ä¸ç»è¿‡ä»£ç†ï¼Œè€Œæ˜¯é€šè¿‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤@Transactionalæ³¨è§£çš„è®¾ç½®ä¸ä¼šè¢«ä»£ç†æ•è·ï¼Œä¹Ÿå°±ä¸ä¼šäº§ç”Ÿä»»ä½•äº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„æ•ˆæœã€‚
2.  å…¶ä»–ä¼ æ’­è¡Œä¸ºå€¼ï¼ˆäº†è§£ï¼‰
    1.  `Propagation.REQUIRED`ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥å½“å‰äº‹åŠ¡ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚
    2.  `Propagation.REQUIRES_NEW`ï¼šåˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨æ–°äº‹åŠ¡ä¸­æ‰§è¡Œã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œå³ä½¿æ–°äº‹åŠ¡æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šå½±å“å½“å‰äº‹åŠ¡ã€‚
    3.  `Propagation.NESTED`ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨è¯¥äº‹åŠ¡ä¸­åµŒå¥—ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä¸Propagation.REQUIREDä¸€æ ·ã€‚
    4.  `Propagation.SUPPORTS`ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦åˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚
    5.  `Propagation.NOT\_SUPPORTED`ï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŒ‚èµ·è¯¥äº‹åŠ¡ã€‚
    6.  `Propagation.MANDATORY`ï¼šå¿…é¡»åœ¨ä¸€ä¸ªå·²æœ‰çš„äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
    7.  P`ropagation.NEVER`ï¼šå¿…é¡»åœ¨æ²¡æœ‰äº‹åŠ¡çš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

## 7 Springæ ¸å¿ƒæŒæ¡æ€»ç»“

| æ ¸å¿ƒç‚¹             | æŒæ¡ç›®æ ‡                        |
| --------------- | --------------------------- |
| springæ¡†æ¶ç†è§£      | springå®¶æ—å’Œspring frameworkæ¡†æ¶ |
| springæ ¸å¿ƒåŠŸèƒ½      | ioc/di , aop , tx           |
| spring ioc / di | ç»„ä»¶ç®¡ç†ã€iocå®¹å™¨ã€ioc/di , ä¸‰ç§é…ç½®æ–¹å¼  |
| spring aop      | aopå’Œaopæ¡†æ¶å’Œä»£ç†æŠ€æœ¯ã€åŸºäºæ³¨è§£çš„aopé…ç½®   |
| spring tx       | å£°æ˜å¼å’Œç¼–ç¨‹å¼äº‹åŠ¡ã€åŠ¨æ€äº‹åŠ¡ç®¡ç†å™¨ã€äº‹åŠ¡æ³¨è§£ã€å±æ€§   |

## 1 æŠ€æœ¯ä½“ç³»ç»“æ„

### 1.1 æ€»ä½“æŠ€æœ¯ä½“ç³»

-   `å•ä¸€æ¶æ„`
    ä¸€ä¸ªé¡¹ç›®ï¼Œä¸€ä¸ªå·¥ç¨‹ï¼Œå¯¼å‡ºä¸ºä¸€ä¸ªwaråŒ…ï¼Œåœ¨ä¸€ä¸ªTomcatä¸Šè¿è¡Œã€‚ä¹Ÿå«all in oneã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0d29b87869ffe88f930010d47bb8dfb1.png)


    å•ä¸€æ¶æ„ï¼Œé¡¹ç›®ä¸»è¦åº”ç”¨æŠ€æœ¯æ¡†æ¶ä¸ºï¼š`Spring` , `SpringMVC` , `Mybatis`

-   `åˆ†å¸ƒå¼æ¶æ„`
    ä¸€ä¸ªé¡¹ç›®ï¼ˆå¯¹åº” IDEA ä¸­çš„ä¸€ä¸ª projectï¼‰ï¼Œæ‹†åˆ†æˆå¾ˆå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—æ˜¯ä¸€ä¸ª IDEA ä¸­çš„ä¸€ä¸ª moduleã€‚æ¯ä¸€ä¸ªå·¥ç¨‹éƒ½æ˜¯è¿è¡Œåœ¨è‡ªå·±çš„ Tomcat ä¸Šã€‚æ¨¡å—ä¹‹é—´å¯ä»¥äº’ç›¸è°ƒç”¨ã€‚æ¯ä¸€ä¸ªæ¨¡å—å†…éƒ¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå•ä¸€æ¶æ„çš„åº”ç”¨ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fa9048c3bc59727e9f1cf8c931f41962.png)


    åˆ†å¸ƒå¼æ¶æ„ï¼Œé¡¹ç›®ä¸»è¦åº”ç”¨æŠ€æœ¯æ¡†æ¶ï¼š`SpringBoot` (SSM), `SpringCloud` , `ä¸­é—´ä»¶ç­‰`

### 1.2 æ¡†æ¶æ¦‚å¿µå’Œç†è§£

æ¡†æ¶( Framework )æ˜¯ä¸€ä¸ªé›†æˆäº†åŸºæœ¬ç»“æ„ã€è§„èŒƒã€è®¾è®¡æ¨¡å¼ã€ç¼–ç¨‹è¯­è¨€å’Œç¨‹åºåº“ç­‰åŸºç¡€ç»„ä»¶çš„è½¯ä»¶ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨æ¥æ„å»ºæ›´é«˜çº§åˆ«çš„åº”ç”¨ç¨‹åºã€‚æ¡†æ¶çš„è®¾è®¡å’Œå®ç°æ—¨åœ¨è§£å†³ç‰¹å®šé¢†åŸŸä¸­çš„å¸¸è§é—®é¢˜ï¼Œ`å¸®åŠ©å¼€å‘äººå‘˜æ›´é«˜æ•ˆã€æ›´ç¨³å®šåœ°å®ç°è½¯ä»¶å¼€å‘ç›®æ ‡`ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c4139da4a4dbe658400907972c00d9c7.png)



`æ¡†æ¶çš„ä¼˜ç‚¹`åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š

1.  `æé«˜å¼€å‘æ•ˆç‡`ï¼šæ¡†æ¶æä¾›äº†è®¸å¤šé¢„å…ˆè®¾è®¡å¥½äº†çš„ç»„ä»¶å’Œå·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿè¿›è¡Œå¼€å‘ã€‚ç›¸è¾ƒäºä¼ ç»Ÿæ‰‹å†™ä»£ç ï¼Œåœ¨æ¡†æ¶æä¾›çš„è§„èŒƒåŒ–ç¯å¢ƒä¸­ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¿«åœ°å®ç°é¡¹ç›®çš„å„ç§è¦æ±‚ã€‚
2.  `é™ä½å¼€å‘æˆæœ¬`ï¼šæ¡†æ¶çš„æä¾›æ ‡å‡†åŒ–çš„ç¼–ç¨‹è¯­è¨€ã€æ•°æ®æ“ä½œç­‰ä»£ç ç‰‡æ®µï¼Œé¿å…äº†é‡å¤å¼€å‘çš„é—®é¢˜ï¼Œé™ä½äº†å¼€å‘æˆæœ¬ï¼Œæä¾›æ·±åº¦ä¼˜åŒ–çš„ç³»ç»Ÿï¼Œé™ä½äº†ç»´æŠ¤æˆæœ¬ï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„å¯é æ€§ã€‚
3.  `æé«˜åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§`ï¼šæ¡†æ¶é€šå¸¸ç»è¿‡äº†å¾ˆé•¿æ—¶é—´çš„å¼€å‘å’Œæµ‹è¯•ï¼Œå…¶ä¸­çš„è®¸å¤šç»„ä»¶ã€ä»£ç ç‰‡æ®µå’Œè®¾è®¡æ¨¡å¼éƒ½å¾—åˆ°äº†éªŒè¯ã€‚é‡å¤åˆ©ç”¨è¿™äº›ç»„ä»¶æœ‰åŠ©äºå‡å°‘bugçš„å‡ºç°ï¼Œä»è€Œæé«˜äº†åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§ã€‚
4.  `æä¾›æ ‡å‡†åŒ–çš„è§£å†³æ–¹æ¡ˆ`ï¼šæ¡†æ¶é€šå¸¸æ˜¯é’ˆå¯¹æŸä¸ªç‰¹å®šé¢†åŸŸçš„ï¼Œé€šè¿‡æä¾›æ ‡å‡†åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ä¸ºå¼€å‘äººå‘˜æä¾›ä¸€ç§å…±åŒçš„è¯­è¨€å’Œæ€æƒ³åŸºç¡€ï¼Œæœ‰åŠ©äºæ›´å¥½åœ°æ²Ÿé€šå’Œåä½œã€‚

`æ¡†æ¶çš„ç¼ºç‚¹`åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  `å­¦ä¹ æˆæœ¬é«˜`ï¼šæ¡†æ¶é€šå¸¸å…·æœ‰ç‰¹å®šçš„è¯­è¨€å’Œç¼–ç¨‹èŒƒå¼ã€‚å¯¹äºå¼€å‘äººå‘˜è€Œè¨€ï¼Œéœ€è¦èŠ±è´¹æ—¶é—´å­¦ä¹ å…¶èƒŒåçš„æ¶æ„ã€æ¨¡å¼å’Œé€»è¾‘ï¼Œè¿™å¯¹äºæ–°æ‰‹è€Œè¨€å¯èƒ½ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ã€‚
2.  `å¯èƒ½å­˜åœ¨å±€é™æ€§`ï¼šè™½ç„¶æ¡†æ¶æé«˜äº†å¼€å‘æ•ˆç‡å¹¶å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜è§£å†³å¸¸è§é—®é¢˜ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç‰¹å®šçš„åº”ç”¨éœ€æ±‚å¯èƒ½è¶…å‡ºæ¡†æ¶çš„èŒƒå›´ï¼Œä»è€Œå¯¼è‡´åº”ç”¨ç¨‹åºæ— æ³•æ»¡è¶³è¦æ±‚ã€‚å¼€å‘äººå‘˜å¯èƒ½éœ€è¦æ›´å¤šçš„æ§åˆ¶æƒå’Œè‡ªç”±åº¦ï¼ŒåŒæ—¶éœ€è¦åœ¨æ¡†æ¶å’Œåº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œæƒè¡¡å–èˆã€‚
3.  `ç‰ˆæœ¬å˜æ›´å’Œå…¼å®¹æ€§é—®é¢˜`ï¼šæ¡†æ¶çš„ç‰ˆæœ¬å‘å¸ƒå’Œè¿­ä»£é€šå¸¸ä¼šå¯¼è‡´ä»£ç åº“çš„å¤§è§„æ¨¡å˜æ›´ï¼Œè¿›è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå‡ºç°å…¼å®¹æ€§é—®é¢˜å’Œæ¼æ´ã€‚å½“æ¡†æ¶å˜æ›´æ—¶ï¼Œéœ€è¦è€ƒè™‘æ¡†æ¶æ˜¯å¦å‘ä¸‹å…¼å®¹ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œé€‚å½“çš„æµ‹è¯•ã€è¿ç§»å’Œå‡çº§ã€‚
4.  `æ¶æ„é£é™©`ï¼šæ¡†æ¶æ¶‰åŠåˆ°å¾ˆå¤šæŠ½è±¡å’Œæ¦‚å¿µï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰è¶³å¤Ÿçš„ç†è§£å’ŒæŒæ¡å…¶æ¶æ„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå‡ºç°è®¾è®¡å’Œæ¶æ„ç¼ºé™·ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„å¥åº·æ€§å’Œå®‰å…¨æ€§ã€‚

ç«™åœ¨æ–‡ä»¶ç»“æ„çš„è§’åº¦ç†è§£æ¡†æ¶ï¼Œå¯ä»¥å°†æ¡†æ¶æ€»ç»“ï¼š**æ¡†æ¶ = jaråŒ…+é…ç½®æ–‡ä»¶**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/e7c31ed6859b153c099a1ad921074452.png)


èå£«æ¯”äºšè¯´,"ä¸€åƒä¸ªè§‚ä¼—çœ¼ä¸­æœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹" å³ä»è€…è§ä»,æ™ºè€…è§æ™º.è¯´æ¯ä¸ªäººéƒ½ä¼šå¯¹ä½œå“æœ‰ä¸åŒçš„ç†è§£ï¼Œæ¯ä¸ªäººå¯¹å¾…ä»»ä½•äº‹ç‰©éƒ½æœ‰è‡ªå·±çš„çœ‹æ³•ï¼ŒåŒæ ·çš„æŠ€æœ¯è§£å†³åŒæ ·çš„é—®é¢˜ä¼šäº§ç”Ÿä¸åŒæµç¨‹å’Œé£æ ¼çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œé‡‡ç”¨ä¸€ç§æ¡†æ¶å…¶å®å°±æ˜¯é™åˆ¶ç”¨æˆ·å¿…é¡»ä½¿ç”¨å…¶è§„å®šçš„æ–¹æ¡ˆæ¥å®ç°ï¼Œå¯ä»¥é™ä½ç¨‹åºå‘˜ä¹‹é—´æ²Ÿé€šä»¥åŠæ—¥åç»´æŠ¤çš„æˆæœ¬ï¼

å¸¸ç”¨çš„å•ä¸€æ¶æ„JavaEEé¡¹ç›®æ¡†æ¶æ¼”è¿›ï¼Œä»SSHã€SSH2è¿‡æ¸¡åˆ°äº†`SSMï¼šSpringMVCã€Springã€MyBatis`ã€‚

æ€»ä¹‹ï¼Œæ¡†æ¶å·²ç»å¯¹åŸºç¡€çš„ä»£ç è¿›è¡Œäº†å°è£…å¹¶æä¾›ç›¸åº”çš„APIï¼Œå¼€å‘è€…åœ¨ä½¿ç”¨æ¡†æ¶æ˜¯ç›´æ¥è°ƒç”¨å°è£…å¥½çš„APIå¯ä»¥çœå»å¾ˆå¤šä»£ç ç¼–å†™ï¼Œä»è€Œæé«˜å·¥ä½œæ•ˆç‡å’Œå¼€å‘é€Ÿåº¦ã€‚

## 2 SpringFrameworkä»‹ç»

### 2.1 Spring å’Œ SpringFrameworkæ¦‚å¿µ

<https://spring.io/projects>

`å¹¿ä¹‰çš„ Springï¼šSpring æŠ€æœ¯æ ˆ`ï¼ˆå…¨å®¶æ¡¶ï¼‰

å¹¿ä¹‰ä¸Šçš„ Spring `æ³›æŒ‡ä»¥ Spring Framework ä¸ºåŸºç¡€çš„ Spring æŠ€æœ¯æ ˆ`ã€‚

ç»è¿‡åå¤šå¹´çš„å‘å±•ï¼ŒSpring å·²ç»ä¸å†æ˜¯ä¸€ä¸ªå•çº¯çš„åº”ç”¨æ¡†æ¶ï¼Œè€Œæ˜¯é€æ¸å‘å±•æˆä¸ºä¸€ä¸ªç”±å¤šä¸ªä¸åŒå­é¡¹ç›®ï¼ˆæ¨¡å—ï¼‰ç»„æˆçš„æˆç†ŸæŠ€æœ¯ï¼Œä¾‹å¦‚ Spring Frameworkã€Spring MVCã€SpringBootã€Spring Cloudã€Spring Dataã€Spring Security ç­‰ï¼Œå…¶ä¸­ Spring Framework æ˜¯å…¶ä»–å­é¡¹ç›®çš„åŸºç¡€ã€‚

è¿™äº›å­é¡¹ç›®æ¶µç›–äº†ä»ä¼ä¸šçº§åº”ç”¨å¼€å‘åˆ°äº‘è®¡ç®—ç­‰å„æ–¹é¢çš„å†…å®¹ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜è§£å†³è½¯ä»¶å‘å±•è¿‡ç¨‹ä¸­ä¸æ–­äº§ç”Ÿçš„å„ç§å®é™…é—®é¢˜ï¼Œç»™å¼€å‘äººå‘˜å¸¦æ¥äº†æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚

`ç‹­ä¹‰çš„ Springï¼šSpring Framework`ï¼ˆåŸºç¡€æ¡†æ¶ï¼‰

ç‹­ä¹‰çš„ Spring `ç‰¹æŒ‡ Spring Frameworkï¼Œé€šå¸¸æˆ‘ä»¬å°†å®ƒç§°ä¸º Spring æ¡†æ¶`ã€‚

Spring Frameworkï¼ˆSpringæ¡†æ¶ï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œç”±SpringSourceå…¬å¸å¼€å‘ï¼Œæœ€åˆæ˜¯ä¸ºäº†è§£å†³ä¼ä¸šçº§å¼€å‘ä¸­å„ç§å¸¸è§é—®é¢˜è€Œåˆ›å»ºçš„ã€‚å®ƒæä¾›äº†å¾ˆå¤šåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰ã€é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ã€å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼ˆTXï¼‰ç­‰ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯ä½¿ä¼ä¸šçº§åº”ç”¨ç¨‹åºçš„å¼€å‘å˜å¾—æ›´åŠ ç®€å•å’Œå¿«é€Ÿï¼Œå¹¶ä¸”Springæ¡†æ¶è¢«å¹¿æ³›åº”ç”¨äºJavaä¼ä¸šå¼€å‘é¢†åŸŸã€‚

Springå…¨å®¶æ¡¶çš„å…¶ä»–æ¡†æ¶éƒ½æ˜¯ä»¥SpringFrameworkæ¡†æ¶ä¸ºåŸºç¡€ï¼

`å¯¹æ¯”ç†è§£ï¼š`

QQ å’Œ è…¾è®¯

è…¾è®¯ = Spring

QQ = SpringFramework

### 2.2 SpringFrameworkä¸»è¦åŠŸèƒ½æ¨¡å—

SpringFrameworkæ¡†æ¶ç»“æ„å›¾ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fa8026fabc65c03ebb186424fad275b4.png)



| åŠŸèƒ½æ¨¡å—           | åŠŸèƒ½ä»‹ç»                                 |
| -------------- | ------------------------------------ |
| Core Container | æ ¸å¿ƒå®¹å™¨ï¼Œåœ¨ Spring ç¯å¢ƒä¸‹ä½¿ç”¨ä»»ä½•åŠŸèƒ½éƒ½å¿…é¡»åŸºäº IOC å®¹å™¨ã€‚ |
| AOP\&Aspects   | é¢å‘åˆ‡é¢ç¼–ç¨‹                               |
| TX             | å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚                             |
| Spring MVC     | æä¾›äº†é¢å‘Webåº”ç”¨ç¨‹åºçš„é›†æˆåŠŸèƒ½ã€‚                   |

### 2.3 SpringFramework ä¸»è¦ä¼˜åŠ¿

1.  `ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿ`ï¼šSpring ç”Ÿæ€ç³»ç»Ÿéå¸¸ä¸°å¯Œï¼Œæ”¯æŒè®¸å¤šæ¨¡å—å’Œåº“ï¼Œå¦‚ Spring Bootã€Spring Securityã€Spring Cloud ç­‰ç­‰ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿæ„å»ºé«˜å¯é æ€§çš„ä¼ä¸šåº”ç”¨ç¨‹åºã€‚
2.  `æ¨¡å—åŒ–çš„è®¾è®¡`ï¼šæ¡†æ¶ç»„ä»¶ä¹‹é—´çš„æ¾æ•£è€¦åˆå’Œæ¨¡å—åŒ–è®¾è®¡ä½¿å¾— Spring Framework å…·æœ‰è‰¯å¥½çš„å¯é‡ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°é€‰æ‹©è‡ªå·±éœ€è¦çš„æ¨¡å—ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå¼€å‘ã€‚
3.  `ç®€åŒ– Java å¼€å‘`ï¼šSpring Framework ç®€åŒ–äº† Java å¼€å‘ï¼Œæä¾›äº†å„ç§å·¥å…·å’Œ APIï¼Œå¯ä»¥é™ä½å¼€å‘å¤æ‚åº¦å’Œå­¦ä¹ æˆæœ¬ã€‚åŒæ—¶ï¼ŒSpring Framework æ”¯æŒå„ç§åº”ç”¨åœºæ™¯ï¼ŒåŒ…æ‹¬ Web åº”ç”¨ç¨‹åºã€RESTful APIã€æ¶ˆæ¯ä¼ é€’ã€æ‰¹å¤„ç†ç­‰ç­‰ã€‚
4.  `ä¸æ–­åˆ›æ–°å’Œå‘å±•`ï¼šSpring Framework å¼€å‘å›¢é˜Ÿä¸€ç›´åœ¨ä¸æ–­åˆ›æ–°å’Œå‘å±•ï¼Œä¿æŒä¸æœ€æ–°æŠ€æœ¯çš„æ¥è½¨ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›æ›´åŠ å…ˆè¿›å’Œä¼˜ç§€çš„å·¥å…·å’Œæ¡†æ¶ã€‚

å› æ­¤ï¼Œè¿™äº›ä¼˜ç‚¹ä½¿å¾— Spring Framework æˆä¸ºäº†ä¸€ä¸ªç¨³å®šã€å¯é ã€ä¸”åˆ›æ–°çš„æ¡†æ¶ï¼Œä¸ºä¼ä¸šçº§ Java å¼€å‘æä¾›äº†ä¸€ç«™å¼çš„è§£å†³æ–¹æ¡ˆã€‚

Spring ä½¿åˆ›å»º Java ä¼ä¸šåº”ç”¨ç¨‹åºå˜å¾—å®¹æ˜“ã€‚å®ƒæä¾›äº†åœ¨ä¼ä¸šç¯å¢ƒä¸­é‡‡ç”¨ Java è¯­è¨€æ‰€éœ€çš„ä¸€åˆ‡ï¼Œæ”¯æŒ Groovy å’Œ Kotlin ä½œä¸º JVM ä¸Šçš„æ›¿ä»£è¯­è¨€ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€æ±‚çµæ´»åœ°åˆ›å»ºå¤šç§æ¶æ„ã€‚`ä»Spring Framework 6.0.6å¼€å§‹ï¼ŒSpring éœ€è¦ Java 17+`ã€‚

## 3 Spring IoCå®¹å™¨å’Œæ ¸å¿ƒæ¦‚å¿µ

### 3.1 ç»„ä»¶å’Œç»„ä»¶ç®¡ç†æ¦‚å¿µ

#### 3.1.1 ä»€ä¹ˆæ˜¯ç»„ä»¶?

å›é¡¾å¸¸è§„çš„ä¸‰å±‚æ¶æ„å¤„ç†è¯·æ±‚æµç¨‹ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c61820bc90e2c7097ad8c921e3b1dc31.png)


`æ•´ä¸ªé¡¹ç›®å°±æ˜¯ç”±å„ç§ç»„ä»¶æ­å»ºè€Œæˆçš„`ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fbfc73e8e3ff4e57d9f3447295c13c77.png)


#### 3.1.2 æˆ‘ä»¬çš„æœŸå¾…

-   æœ‰äººæ›¿æˆ‘ä»¬åˆ›å»ºç»„ä»¶çš„å¯¹è±¡
-   æœ‰äººå¸®æˆ‘ä»¬ä¿å­˜ç»„ä»¶çš„å¯¹è±¡
-   æœ‰äººå¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ç»„è£…
-   æœ‰äººæ›¿æˆ‘ä»¬ç®¡ç†äº‹åŠ¡
-   æœ‰äººååŠ©æˆ‘ä»¬æ•´åˆå…¶ä»–æ¡†æ¶
-   ......
#### 3.1.3 Springå……å½“ç»„ä»¶ç®¡ç†è§’è‰²ï¼ˆIoCï¼‰

é‚£ä¹ˆè°å¸®æˆ‘ä»¬å®Œæˆæˆ‘ä»¬çš„æœŸå¾…ï¼Œå¸®æˆ‘ä»¬ç®¡ç†ç»„ä»¶å‘¢ï¼Ÿ

å½“ç„¶æ˜¯Spring æ¡†æ¶äº†ï¼

`ç»„ä»¶å¯ä»¥å®Œå…¨äº¤ç»™Spring æ¡†æ¶è¿›è¡Œç®¡ç†`ï¼ŒSpringæ¡†æ¶æ›¿ä»£äº†ç¨‹åºå‘˜åŸæœ‰çš„newå¯¹è±¡å’Œå¯¹è±¡å±æ€§èµ‹å€¼åŠ¨ä½œç­‰ï¼

Springå…·ä½“çš„ç»„ä»¶ç®¡ç†åŠ¨ä½œåŒ…å«ï¼š
-   ç»„ä»¶å¯¹è±¡å®ä¾‹åŒ–
-   ç»„ä»¶å±æ€§å±æ€§èµ‹å€¼
-   ç»„ä»¶å¯¹è±¡ä¹‹é—´å¼•ç”¨
-   ç»„ä»¶å¯¹è±¡å­˜æ´»å‘¨æœŸç®¡ç†
-   ......
	æˆ‘ä»¬åªéœ€è¦ç¼–å†™å…ƒæ•°æ®ï¼ˆé…ç½®æ–‡ä»¶ï¼‰å‘ŠçŸ¥Spring ç®¡ç†å“ªäº›ç±»ç»„ä»¶å’Œä»–ä»¬çš„å…³ç³»å³å¯ï¼
	
æ³¨æ„ï¼šç»„ä»¶æ˜¯æ˜ å°„åˆ°åº”ç”¨ç¨‹åºä¸­æ‰€æœ‰å¯é‡ç”¨ç»„ä»¶çš„Javaå¯¹è±¡ï¼Œåº”è¯¥æ˜¯å¯å¤ç”¨çš„åŠŸèƒ½å¯¹è±¡ï¼
-   `ç»„ä»¶ä¸€å®šæ˜¯å¯¹è±¡`
-   `å¯¹è±¡ä¸ä¸€å®šæ˜¯ç»„ä»¶`
	ç»¼ä¸Šæ‰€è¿°ï¼ŒSpring å……å½“ä¸€ä¸ªç»„ä»¶å®¹å™¨ï¼Œåˆ›å»ºã€ç®¡ç†ã€å­˜å‚¨ç»„ä»¶ï¼Œå‡å°‘äº†æˆ‘ä»¬çš„ç¼–ç å‹åŠ›ï¼Œè®©æˆ‘ä»¬æ›´åŠ ä¸“æ³¨è¿›è¡Œä¸šåŠ¡ç¼–å†™ï¼
#### 3.1.4 ç»„ä»¶äº¤ç»™Springç®¡ç†ä¼˜åŠ¿!

1.  `é™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§`ï¼šSpring IoCå®¹å™¨é€šè¿‡ä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œå°†ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»å‰Šå¼±ï¼Œå‡å°‘äº†ç¨‹åºç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œä½¿å¾—ç»„ä»¶æ›´åŠ æ¾æ•£åœ°è€¦åˆã€‚
2.  `æé«˜äº†ä»£ç çš„å¯é‡ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§`ï¼šå°†ç»„ä»¶çš„å®ä¾‹åŒ–è¿‡ç¨‹ã€ä¾èµ–å…³ç³»çš„ç®¡ç†ç­‰åŠŸèƒ½äº¤ç»™Spring IoCå®¹å™¨å¤„ç†ï¼Œä½¿å¾—ç»„ä»¶ä»£ç æ›´åŠ æ¨¡å—åŒ–ã€å¯é‡ç”¨ã€æ›´æ˜“äºç»´æŠ¤ã€‚
3.  `æ–¹ä¾¿äº†é…ç½®å’Œç®¡ç†`ï¼šSpring IoCå®¹å™¨é€šè¿‡XMLæ–‡ä»¶æˆ–è€…æ³¨è§£ï¼Œè½»æ¾çš„å¯¹ç»„ä»¶è¿›è¡Œé…ç½®å’Œç®¡ç†ï¼Œä½¿å¾—ç»„ä»¶çš„åˆ‡æ¢ã€æ›¿æ¢ç­‰æ“ä½œæ›´åŠ çš„æ–¹ä¾¿å’Œå¿«æ·ã€‚
4.  äº¤ç»™Springç®¡ç†çš„å¯¹è±¡ï¼ˆç»„ä»¶ï¼‰ï¼Œæ–¹å¯äº«å—Springæ¡†æ¶çš„å…¶ä»–åŠŸèƒ½ï¼ˆAOP,å£°æ˜äº‹åŠ¡ç®¡ç†ï¼‰ç­‰

### 3.2 Spring IoCå®¹å™¨å’Œå®¹å™¨å®ç°

#### 3.2.1 æ™®é€šå’Œå¤æ‚å®¹å™¨

**æ™®é€šå®¹å™¨**
ç”Ÿæ´»ä¸­çš„æ™®é€šå®¹å™¨ ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/f0795047f504a159b54c97b9c3704a0b.png)


> æ™®é€šå®¹å™¨åªèƒ½ç”¨æ¥å­˜å‚¨ï¼Œæ²¡æœ‰æ›´å¤šåŠŸèƒ½ã€‚
> ç¨‹åºä¸­çš„æ™®é€šå®¹å™¨
-   æ•°ç»„
-   é›†åˆï¼šList
-   é›†åˆï¼šSet

	**å¤æ‚å®¹å™¨**
ç”Ÿæ´»ä¸­çš„å¤æ‚å®¹å™¨

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/90d659d8e96042e03c749000ac4d87db.png)


> æ”¿åºœç®¡ç†æˆ‘ä»¬çš„ä¸€ç”Ÿï¼Œç”Ÿè€ç—…æ­»éƒ½å’Œæ”¿åºœæœ‰å…³ã€‚
> ç¨‹åºä¸­çš„å¤æ‚å®¹å™¨

- Servlet å®¹å™¨èƒ½å¤Ÿç®¡ç† Servlet(init,service,destroy)ã€Filterã€Listener è¿™æ ·çš„ç»„ä»¶çš„ä¸€ç”Ÿï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªå¤æ‚å®¹å™¨ã€‚

| åç§°                                                                                  | æ—¶æœº                                    | æ¬¡æ•° |
| ----------------------------------------------------------------------------------- | ------------------------------------- | -- |
| åˆ›å»ºå¯¹è±¡                                                                                | é»˜è®¤æƒ…å†µï¼šæ¥æ”¶åˆ°ç¬¬ä¸€æ¬¡è¯·æ±‚ &#xA;ä¿®æ”¹å¯åŠ¨é¡ºåºåï¼šWebåº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­ | ä¸€æ¬¡ |
| åˆå§‹åŒ–æ“ä½œ                                                                               | åˆ›å»ºå¯¹è±¡ä¹‹å                                | ä¸€æ¬¡ |
| å¤„ç†è¯·æ±‚                                                                                | æ¥æ”¶åˆ°è¯·æ±‚                                 | å¤šæ¬¡ |
| é”€æ¯æ“ä½œ                                                                                | Webåº”ç”¨å¸è½½ä¹‹å‰                             | ä¸€æ¬¡ |

æˆ‘ä»¬å³å°†è¦å­¦ä¹ çš„ SpringIoC å®¹å™¨ä¹Ÿæ˜¯ä¸€ä¸ªå¤æ‚å®¹å™¨ã€‚å®ƒä»¬ä¸ä»…è¦è´Ÿè´£åˆ›å»ºç»„ä»¶çš„å¯¹è±¡ã€å­˜å‚¨ç»„ä»¶çš„å¯¹è±¡ï¼Œè¿˜è¦è´Ÿè´£è°ƒç”¨ç»„ä»¶çš„æ–¹æ³•è®©å®ƒä»¬å·¥ä½œï¼Œæœ€ç»ˆåœ¨ç‰¹å®šæƒ…å†µä¸‹é”€æ¯ç»„ä»¶ã€‚

`æ€»ç»“ï¼šSpringç®¡ç†ç»„ä»¶çš„å®¹å™¨ï¼Œå°±æ˜¯ä¸€ä¸ªå¤æ‚å®¹å™¨ï¼Œä¸ä»…å­˜å‚¨ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥ç®¡ç†ç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”åˆ›å»ºå’Œé”€æ¯ç»„ä»¶ç­‰ï¼`

#### 3.2.2 SpringIoCå®¹å™¨ä»‹ç»

Spring IoC å®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£… beanï¼ˆç»„ä»¶ï¼‰ã€‚å®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®æ¥è·å–æœ‰å…³è¦å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…ç»„ä»¶çš„æŒ‡ä»¤ã€‚é…ç½®å…ƒæ•°æ®ä»¥` XML`ã€`Java æ³¨è§£`æˆ– `Java ä»£ç å½¢å¼`è¡¨ç°ã€‚å®ƒå…è®¸è¡¨è¾¾ç»„æˆåº”ç”¨ç¨‹åºçš„ç»„ä»¶ä»¥åŠè¿™äº›ç»„ä»¶ä¹‹é—´ä¸°å¯Œçš„ç›¸äº’ä¾èµ–å…³ç³»ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/91508c6ae5ed25eee740cfc5629a2a76.png)


ä¸Šå›¾æ˜¾ç¤ºäº† Spring å®¹å™¨å·¥ä½œåŸç†çš„é«˜çº§è§†å›¾ã€‚åº”ç”¨ç¨‹åºç±»ä¸é…ç½®å…ƒæ•°æ®ç›¸ç»“åˆï¼Œæ‚¨æ‹¥æœ‰å®Œå…¨é…ç½®ä¸”å¯æ‰§è¡Œçš„ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºã€‚
#### 3.2.3 SpringIoCå®¹å™¨å…·ä½“æ¥å£å’Œå®ç°ç±»

**SpringIocå®¹å™¨æ¥å£**ï¼š

`BeanFactory` æ¥å£æä¾›äº†ä¸€ç§é«˜çº§é…ç½®æœºåˆ¶ï¼Œèƒ½å¤Ÿç®¡ç†ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œå®ƒæ˜¯SpringIoCå®¹å™¨æ ‡å‡†åŒ–è¶…æ¥å£ï¼

`ApplicationContext` æ˜¯ `BeanFactory` çš„å­æ¥å£ã€‚å®ƒæ‰©å±•äº†ä»¥ä¸‹åŠŸèƒ½ï¼š
-   æ›´å®¹æ˜“ä¸ Spring çš„ AOP åŠŸèƒ½é›†æˆ
-   æ¶ˆæ¯èµ„æºå¤„ç†ï¼ˆç”¨äºå›½é™…åŒ–ï¼‰
-   ç‰¹å®šäºåº”ç”¨ç¨‹åºç»™äºˆæ­¤æ¥å£å®ç°ï¼Œä¾‹å¦‚Web åº”ç”¨ç¨‹åºçš„ `WebApplicationContext`
	ç®€è€Œè¨€ä¹‹ï¼Œ `BeanFactory` æä¾›äº†é…ç½®æ¡†æ¶å’ŒåŸºæœ¬åŠŸèƒ½ï¼Œè€Œ `ApplicationContext` æ·»åŠ äº†æ›´å¤šç‰¹å®šäºä¼ä¸šçš„åŠŸèƒ½ã€‚ `ApplicationContext` æ˜¯ `BeanFactory` çš„å®Œæ•´è¶…é›†ï¼
**ApplicationContextå®¹å™¨å®ç°ç±»**ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3ae44c34d001602eb248fc2e65629aa0.png)


| ç±»å‹å                                | ç®€ä»‹                                                            |
| ---------------------------------- | ------------------------------------------------------------- |
| ***ClassPathXmlApplicationContext***     | é€šè¿‡è¯»å–ç±»è·¯å¾„ä¸‹çš„ XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡                              |
| ***FileSystemXmlApplicationContext***    | é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè·¯å¾„è¯»å– XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡                             |
| ***AnnotationConfigApplicationContext*** | é€šè¿‡è¯»å–Javaé…ç½®ç±»åˆ›å»º IOC å®¹å™¨å¯¹è±¡                                        |
| ***WebApplicationContext***              | ä¸“é—¨ä¸º Web åº”ç”¨å‡†å¤‡ï¼ŒåŸºäº Web ç¯å¢ƒåˆ›å»º IOC å®¹å™¨å¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡å¼•å…¥å­˜å…¥ ServletContext åŸŸä¸­ã€‚ |
#### 3.2.4 SpringIoCå®¹å™¨ç®¡ç†é…ç½®æ–¹å¼

Spring IoC å®¹å™¨ä½¿ç”¨å¤šç§å½¢å¼çš„é…ç½®å…ƒæ•°æ®ã€‚æ­¤é…ç½®å…ƒæ•°æ®è¡¨ç¤ºæ‚¨ä½œä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¦‚ä½•å‘Šè¯‰ Spring å®¹å™¨å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/91508c6ae5ed25eee740cfc5629a2a76.png)



Springæ¡†æ¶æä¾›äº†å¤šç§é…ç½®æ–¹å¼ï¼šXMLé…ç½®æ–¹å¼ã€æ³¨è§£æ–¹å¼å’ŒJavaé…ç½®ç±»æ–¹å¼
1.  `XMLé…ç½®æ–¹å¼`ï¼šæ˜¯Springæ¡†æ¶æœ€æ—©çš„é…ç½®æ–¹å¼ä¹‹ä¸€ï¼Œé€šè¿‡åœ¨XMLæ–‡ä»¶ä¸­å®šä¹‰BeanåŠå…¶ä¾èµ–å…³ç³»ã€Beançš„ä½œç”¨åŸŸç­‰ä¿¡æ¯ï¼Œè®©Spring IoCå®¹å™¨æ¥ç®¡ç†Beanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚è¯¥æ–¹å¼ä»Springæ¡†æ¶çš„ç¬¬ä¸€ç‰ˆå¼€å§‹æä¾›æ”¯æŒã€‚
2.  `æ³¨è§£æ–¹å¼`ï¼šä»Spring 2.5ç‰ˆæœ¬å¼€å§‹æä¾›æ”¯æŒï¼Œå¯ä»¥é€šè¿‡åœ¨Beanç±»ä¸Šä½¿ç”¨æ³¨è§£æ¥ä»£æ›¿XMLé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚é€šè¿‡åœ¨Beanç±»ä¸ŠåŠ ä¸Šç›¸åº”çš„æ³¨è§£ï¼ˆå¦‚@Component, @Service, @Autowiredç­‰ï¼‰ï¼Œå°†Beanæ³¨å†Œåˆ°Spring IoCå®¹å™¨ä¸­ï¼Œè¿™æ ·Spring IoCå®¹å™¨å°±å¯ä»¥ç®¡ç†è¿™äº›Beanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚
3.  `Javaé…ç½®ç±»æ–¹å¼`ï¼šä»Spring 3.0ç‰ˆæœ¬å¼€å§‹æä¾›æ”¯æŒï¼Œé€šè¿‡Javaç±»æ¥å®šä¹‰Beanã€Beanä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œé…ç½®ä¿¡æ¯ï¼Œä»è€Œä»£æ›¿XMLé…ç½®æ–‡ä»¶çš„æ–¹å¼ã€‚Javaé…ç½®ç±»æ˜¯ä¸€ç§ä½¿ç”¨Javaç¼–å†™é…ç½®ä¿¡æ¯çš„æ–¹å¼ï¼Œé€šè¿‡@Configurationã€@Beanç­‰æ³¨è§£æ¥å®ç°Beanå’Œä¾èµ–å…³ç³»çš„é…ç½®ã€‚
	ä¸ºäº†è¿åˆå½“ä¸‹å¼€å‘ç¯å¢ƒï¼Œæˆ‘ä»¬å°†ä»¥`é…ç½®ç±»+æ³¨è§£æ–¹å¼`ä¸ºä¸»è¿›è¡Œè®²è§£ï¼

### 3.3 Spring IoC / DIæ¦‚å¿µæ€»ç»“

-   `IoCå®¹å™¨`
    Spring IoC å®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£… beanï¼ˆç»„ä»¶ï¼‰æ ¸å¿ƒå®¹å™¨ã€‚å®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®æ¥è·å–æœ‰å…³è¦å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…ç»„ä»¶çš„æŒ‡ä»¤ã€‚

-   `IoCï¼ˆInversion of Controlï¼‰æ§åˆ¶åè½¬`
    IoC ä¸»è¦æ˜¯é’ˆå¯¹å¯¹è±¡çš„åˆ›å»ºå’Œè°ƒç”¨æ§åˆ¶è€Œè¨€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¸å†æ˜¯åº”ç”¨ç¨‹åºç›´æ¥åˆ›å»ºè¯¥å¯¹è±¡ï¼Œè€Œæ˜¯ç”± IoC å®¹å™¨æ¥åˆ›å»ºå’Œç®¡ç†ï¼Œå³æ§åˆ¶æƒç”±åº”ç”¨ç¨‹åºè½¬ç§»åˆ° IoC å®¹å™¨ä¸­ï¼Œä¹Ÿå°±æ˜¯â€œåè½¬â€äº†æ§åˆ¶æƒã€‚è¿™ç§æ–¹å¼åŸºæœ¬ä¸Šæ˜¯é€šè¿‡ä¾èµ–æŸ¥æ‰¾çš„æ–¹å¼æ¥å®ç°çš„ï¼Œå³ IoC å®¹å™¨ç»´æŠ¤ç€æ„æˆåº”ç”¨ç¨‹åºçš„å¯¹è±¡ï¼Œå¹¶è´Ÿè´£åˆ›å»ºè¿™äº›å¯¹è±¡ã€‚

-   `DI (Dependency Injection) ä¾èµ–æ³¨å…¥`
    DI æ˜¯æŒ‡åœ¨ç»„ä»¶ä¹‹é—´ä¼ é€’ä¾èµ–å…³ç³»çš„è¿‡ç¨‹ä¸­ï¼Œå°†ä¾èµ–å…³ç³»åœ¨å®¹å™¨å†…éƒ¨è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±ä¸å¿…åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ç¡¬ç¼–ç å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå®ç°äº†å¯¹è±¡ä¹‹é—´çš„è§£è€¦åˆã€‚åœ¨ Spring ä¸­ï¼ŒDI æ˜¯é€šè¿‡ XML é…ç½®æ–‡ä»¶æˆ–æ³¨è§£çš„æ–¹å¼å®ç°çš„ã€‚å®ƒæä¾›äº†ä¸‰ç§å½¢å¼çš„ä¾èµ–æ³¨å…¥ï¼šæ„é€ å‡½æ•°æ³¨å…¥ã€Setter æ–¹æ³•æ³¨å…¥å’Œæ¥å£æ³¨å…¥ã€‚

## 4 Spring IoCå®è·µå’Œåº”ç”¨

### 4.1 Spring IoC / DI å®ç°æ­¥éª¤

> æˆ‘ä»¬æ€»ç»“ä¸‹ï¼Œç»„ä»¶äº¤ç»™Spring IoCå®¹å™¨ç®¡ç†ï¼Œå¹¶ä¸”è·å–å’Œä½¿ç”¨çš„åŸºæœ¬æ­¥éª¤ï¼

- `æ­¥éª¤ä¸€ï¼šé…ç½®å…ƒæ•°æ®ï¼ˆé…ç½®ï¼‰`

    é…ç½®å…ƒæ•°æ®ï¼Œæ—¢æ˜¯ç¼–å†™äº¤ç»™SpringIoCå®¹å™¨ç®¡ç†ç»„ä»¶çš„ä¿¡æ¯ï¼Œé…ç½®æ–¹å¼æœ‰ä¸‰ç§ã€‚

    åŸºäº XML çš„é…ç½®å…ƒæ•°æ®çš„åŸºæœ¬ç»“æ„ï¼š

    \<bean id="..." \[1] class="..." \[2]> &#x20;
    &#x20;   \<!-- collaborators and configuration for this bean go here -->
    &#x20; \</bean>
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <!-- æ­¤å¤„è¦æ·»åŠ ä¸€äº›çº¦æŸï¼Œé…ç½®æ–‡ä»¶çš„æ ‡ç­¾å¹¶ä¸æ˜¯éšæ„å‘½å -->
    <beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd">

      <bean id="..." [1] class="..." [2]>  
        <!-- collaborators and configuration for this bean go here -->
      </bean>

      <bean id="..." class="...">
        <!-- collaborators and configuration for this bean go here -->
      </bean>
      <!-- more bean definitions go here -->
    </beans>
    ```
    Spring IoC å®¹å™¨ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªç»„ä»¶ã€‚è¿™äº› ç»„ä»¶æ˜¯ä½¿ç”¨ä½ æä¾›ç»™å®¹å™¨çš„é…ç½®å…ƒæ•°æ®ï¼ˆä¾‹å¦‚ï¼Œä»¥ XML `<bean/>` å®šä¹‰çš„å½¢å¼ï¼‰åˆ›å»ºçš„ã€‚

    \<bean /> æ ‡ç­¾ == ç»„ä»¶ä¿¡æ¯å£°æ˜
    -   `id` å±æ€§æ˜¯æ ‡è¯†å•ä¸ª Bean å®šä¹‰çš„å­—ç¬¦ä¸²ã€‚
    -   `class` å±æ€§å®šä¹‰ Bean çš„ç±»å‹å¹¶ä½¿ç”¨å®Œå…¨é™å®šçš„ç±»åã€‚

- `æ­¥éª¤äºŒï¼šå®ä¾‹åŒ–IoCå®¹å™¨`

    æä¾›ç»™ `ApplicationContext` æ„é€ å‡½æ•°çš„ä½ç½®è·¯å¾„æ˜¯èµ„æºå­—ç¬¦ä¸²åœ°å€ï¼Œå…è®¸å®¹å™¨ä»å„ç§å¤–éƒ¨èµ„æºï¼ˆå¦‚æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€Java `CLASSPATH` ç­‰ï¼‰åŠ è½½é…ç½®å…ƒæ•°æ®ã€‚

    æˆ‘ä»¬åº”è¯¥é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å®¹å™¨å®ç°ç±»ï¼Œè¿›è¡ŒIoCå®¹å™¨çš„å®ä¾‹åŒ–å·¥ä½œï¼š
    ```java
    //å®ä¾‹åŒ–iocå®¹å™¨,è¯»å–å¤–éƒ¨é…ç½®æ–‡ä»¶,æœ€ç»ˆä¼šåœ¨å®¹å™¨å†…è¿›è¡Œiocå’ŒdiåŠ¨ä½œ
    ApplicationContext context = 
               new ClassPathXmlApplicationContext("services.xml", "daos.xml");
    ```

- `æ­¥éª¤ä¸‰ï¼šè·å–Beanï¼ˆç»„ä»¶ï¼‰`

    `ApplicationContext` æ˜¯ä¸€ä¸ªé«˜çº§å·¥å‚çš„æ¥å£ï¼Œèƒ½å¤Ÿç»´æŠ¤ä¸åŒ bean åŠå…¶ä¾èµ–é¡¹çš„æ³¨å†Œè¡¨ã€‚é€šè¿‡ä½¿ç”¨æ–¹æ³• `T getBean(String name, Class<T> requiredType)` ï¼Œæ‚¨å¯ä»¥æ£€ç´¢ bean çš„å®ä¾‹ã€‚

    å…è®¸è¯»å– Bean å®šä¹‰å¹¶è®¿é—®å®ƒä»¬ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š
    ```java
    //åˆ›å»ºiocå®¹å™¨å¯¹è±¡ï¼ŒæŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œiocä¹Ÿå¼€å§‹å®ä¾‹ç»„ä»¶å¯¹è±¡
    ApplicationContext context = new ClassPathXmlApplicationContext("services.xml", "daos.xml");
    //è·å–iocå®¹å™¨çš„ç»„ä»¶å¯¹è±¡
    PetStoreService service = context.getBean("petStore", PetStoreService.class);
    //ä½¿ç”¨ç»„ä»¶å¯¹è±¡
    List<String> userList = service.getUsernameList();
    ```

### 4.2 åŸºäºXMLé…ç½®æ–¹å¼ç»„ä»¶ç®¡ç†

#### 4.2.1 å®éªŒä¸€ï¼š ç»„ä»¶ï¼ˆBeanï¼‰ä¿¡æ¯å£°æ˜é…ç½®ï¼ˆIoCï¼‰

1.  `ç›®æ ‡`

    Spring IoC å®¹å™¨ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ª beanã€‚è¿™äº› Bean æ˜¯ä½¿ç”¨æ‚¨æä¾›ç»™å®¹å™¨çš„é…ç½®å…ƒæ•°æ®åˆ›å»ºçš„ï¼ˆä¾‹å¦‚ï¼Œä»¥ XML `<bean/>` å®šä¹‰çš„å½¢å¼ï¼‰ã€‚

    æˆ‘ä»¬å­¦ä¹ ï¼Œå¦‚ä½•é€šè¿‡å®šä¹‰XMLé…ç½®æ–‡ä»¶ï¼Œå£°æ˜ç»„ä»¶ç±»ä¿¡æ¯ï¼Œäº¤ç»™ Spring çš„ IoC å®¹å™¨è¿›è¡Œç»„ä»¶ç®¡ç†ï¼
    
2.  `æ€è·¯`

	![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/86a110e6a9ad3d503dfd9f9d396d390d.png)


3.  `å‡†å¤‡é¡¹ç›®`
    1.  åˆ›å»ºmavenå·¥ç¨‹ï¼ˆspring-ioc-xml-01ï¼‰
    2.  å¯¼å…¥SpringIoCç›¸å…³ä¾èµ–

        pom.xml
        ```xml
        <dependencies>
            <!--spring contextä¾èµ–-->
            <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-context</artifactId>
                <version>6.0.6</version>
            </dependency>
            <!--junit5æµ‹è¯•-->
            <dependency>
                <groupId>org.junit.jupiter</groupId>
                <artifactId>junit-jupiter-api</artifactId>
                <version>5.3.1</version>
            </dependency>
        </dependencies>
        ```

4.  `åŸºäºæ— å‚æ•°æ„é€ å‡½æ•°`
    > å½“é€šè¿‡æ„é€ å‡½æ•°æ–¹æ³•åˆ›å»ºä¸€ä¸ª beanï¼ˆç»„ä»¶å¯¹è±¡ï¼‰ æ—¶ï¼Œæ‰€æœ‰æ™®é€šç±»éƒ½å¯ä»¥ç”± Spring ä½¿ç”¨å¹¶ä¸ä¹‹å…¼å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­£åœ¨å¼€å‘çš„ç±»ä¸éœ€è¦å®ç°ä»»ä½•ç‰¹å®šçš„æ¥å£æˆ–ä»¥ç‰¹å®šçš„æ–¹å¼è¿›è¡Œç¼–ç ã€‚åªéœ€æŒ‡å®š Bean ç±»ä¿¡æ¯å°±è¶³å¤Ÿäº†ã€‚ä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé»˜è®¤ï¼ˆç©ºï¼‰æ„é€ å‡½æ•°ã€‚

	1.  å‡†å¤‡ç»„ä»¶ç±»
	```java
	package com.atguigu.ioc;
	public class HappyComponent {
		//é»˜è®¤åŒ…å«æ— å‚æ•°æ„é€ å‡½æ•°
		public void doWork() {
			System.out.println("HappyComponent.doWork");
		}
	}
	```
    2.  xmlé…ç½®æ–‡ä»¶ç¼–å†™

        åˆ›å»ºæºå¸¦springçº¦æŸçš„xmlé…ç½®æ–‡ä»¶,ç¼–å†™é…ç½®æ–‡ä»¶ï¼š

        æ–‡ä»¶ï¼šresources/spring-bean-01.xml
        ```xml
        <?xml version="1.0" encoding="UTF-8"?>  
<beans xmlns="http://www.springframework.org/schema/beans"  
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">  
    <bean id="work" class="com.dakkk.HappyComponent"/>  
</beans>
    ```
        -   beanæ ‡ç­¾ï¼šé€šè¿‡é…ç½®beanæ ‡ç­¾å‘Šè¯‰IOCå®¹å™¨éœ€è¦åˆ›å»ºå¯¹è±¡çš„ç»„ä»¶ä¿¡æ¯
        -   idå±æ€§ï¼šbeançš„å”¯ä¸€æ ‡è¯†,æ–¹ä¾¿åæœŸè·å–Beanï¼
        -   classå±æ€§ï¼šç»„ä»¶ç±»çš„å…¨é™å®šç¬¦ï¼
        -   æ³¨æ„ï¼šè¦æ±‚å½“å‰ç»„ä»¶ç±»å¿…é¡»åŒ…å«æ— å‚æ•°æ„é€ å‡½æ•°ï¼

5.  `åŸºäºé™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–`
    > é™¤äº†ä½¿ç”¨æ„é€ å‡½æ•°å®ä¾‹åŒ–å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ç±»æ˜¯é€šè¿‡å·¥å‚æ¨¡å¼å®ä¾‹åŒ–å¯¹è±¡ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è®²è§£å¦‚ä½•å®šä¹‰ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºBeançš„é…ç½® ï¼
    
	1.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public class ClientService {
          private static ClientService clientService = new ClientService();
          private ClientService() {}

          public static ClientService createInstance() {
          
            return clientService;
          }
        }
        ```
    2.  xmlé…ç½®æ–‡ä»¶ç¼–å†™

        æ–‡ä»¶ï¼šresources/spring-bean-01.xml
        ```xml
        <bean id="clientService"
          class="examples.ClientService"
          factory-method="createInstance"/>
        ```
        -   classå±æ€§ï¼šæŒ‡å®šå·¥å‚ç±»çš„å…¨é™å®šç¬¦ï¼
        -   *factory-method: æŒ‡å®šé™æ€å·¥å‚æ–¹æ³•ï¼Œæ³¨æ„ï¼Œè¯¥æ–¹æ³•å¿…é¡»æ˜¯staticæ–¹æ³•*ã€‚

6.  `åŸºäºå®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–`
    > æ¥ä¸‹æ¥æˆ‘ä»¬è®²è§£ä¸‹å¦‚ä½•å®šä¹‰ä½¿ç”¨å®ä¾‹å·¥å‚æ–¹æ³•åˆ›å»ºBeançš„é…ç½® ï¼
    1.  å‡†å¤‡ç»„å»ºç±»
        ```java
        public class DefaultServiceLocator {
          private static ClientServiceImplclientService = new ClientServiceImpl();
          public ClientService createClientServiceInstance() {
            return clientService;
          }
        }
        ```
    2.  xmlé…ç½®æ–‡ä»¶ç¼–å†™

        æ–‡ä»¶ï¼šresources/spring-bean-01.xml
        ```xml
        <!-- å°†å·¥å‚ç±»è¿›è¡Œiocé…ç½® -->
        <bean id="serviceLocator" class="examples.DefaultServiceLocator">
        </bean>

        <!-- æ ¹æ®å·¥å‚å¯¹è±¡çš„å®ä¾‹å·¥å‚æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–ç»„ä»¶å¯¹è±¡ -->
        <bean id="clientService"
          factory-bean="serviceLocator"
          factory-method="createClientServiceInstance"/>
        ```
        -   factory-beanå±æ€§ï¼šæŒ‡å®šå½“å‰å®¹å™¨ä¸­å·¥å‚Bean çš„åç§°ã€‚
        -   factory-method:  æŒ‡å®šå®ä¾‹å·¥å‚æ–¹æ³•åã€‚æ³¨æ„ï¼Œå®ä¾‹æ–¹æ³•å¿…é¡»æ˜¯éstaticçš„ï¼

7.  `å›¾è§£IoCé…ç½®æµç¨‹`![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/9307a10c3e4aa8e88891d4dd4d4395da.png)
#### 4.2.2 å®éªŒäºŒï¼š ç»„ä»¶ï¼ˆBeanï¼‰ä¾èµ–æ³¨å…¥é…ç½®ï¼ˆDIï¼‰

1.  `ç›®æ ‡`

    é€šè¿‡é…ç½®æ–‡ä»¶,å®ç°IoCå®¹å™¨ä¸­Beanä¹‹é—´çš„å¼•ç”¨ï¼ˆä¾èµ–æ³¨å…¥DIé…ç½®ï¼‰ã€‚

    ä¸»è¦æ¶‰åŠæ³¨å…¥åœºæ™¯ï¼šåŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥å’ŒåŸºäº Setter çš„ä¾èµ–æ³¨å…¥ã€‚

2.  `æ€è·¯`
   ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/602b01e55a2635ad7e9dec1545565484.png)


3.  `åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥`ï¼ˆ`å•ä¸ªæ„é€ å‚æ•°`ï¼‰
    1.  ä»‹ç»
        åŸºäºæ„é€ å‡½æ•°çš„ DI æ˜¯é€šè¿‡å®¹å™¨è°ƒç”¨å…·æœ‰å¤šä¸ªå‚æ•°çš„æ„é€ å‡½æ•°æ¥å®Œæˆçš„ï¼Œæ¯ä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªä¾èµ–é¡¹ã€‚
        ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºä¸€ä¸ªåªèƒ½é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥è¿›è¡Œä¾èµ–é¡¹æ³¨å…¥çš„ç±»ï¼

	2.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public class UserDao {
        }

        public class UserService {
            private UserDao userDao;
            public UserService(UserDao userDao) {
                this.userDao = userDao;
            }
        }
        ```

	3.  ç¼–å†™é…ç½®æ–‡ä»¶

        æ–‡ä»¶ï¼šresources/spring-02.xml
        ```xml
        <beans>
          <!-- å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userService" class="x.y.UserService">
           <!-- æ„é€ å‡½æ•°å¼•ç”¨ -->
            <constructor-arg ref="userDao"/>
          </bean>
          <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userDao" class="x.y.UserDao"/>
        </beans>
        ```
        -   constructor-argæ ‡ç­¾ï¼šå¯ä»¥å¼•ç”¨æ„é€ å‚æ•° refå¼•ç”¨å…¶ä»–beançš„æ ‡è¯†ã€‚

4.  `åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥`ï¼ˆ`å¤šæ„é€ å‚æ•°è§£æ`ï¼‰
    1.  ä»‹ç»
        åŸºäºæ„é€ å‡½æ•°çš„ DI æ˜¯é€šè¿‡å®¹å™¨è°ƒç”¨å…·æœ‰å¤šä¸ªå‚æ•°çš„æ„é€ å‡½æ•°æ¥å®Œæˆçš„ï¼Œæ¯ä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªä¾èµ–é¡¹ã€‚
        ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥å¤šä¸ªå‚æ•°ï¼Œå‚æ•°åŒ…å«å…¶ä»–beanå’ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼

	2.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public class UserDao {
        }

        public class UserService {
            private UserDao userDao;
            private int age;
            private String name;
            public UserService(int age , String name ,UserDao userDao) {
                this.userDao = userDao;
                this.age = age;
                this.name = name;
            }
        }
        ```

	3.  ç¼–å†™é…ç½®æ–‡ä»¶`ï¼ˆé¡ºåºã€åç§°ã€ä¸‹æ ‡ï¼‰`
        ```xml
        <!-- åœºæ™¯1: å¤šå‚æ•°ï¼Œå¯ä»¥æŒ‰ç…§ç›¸åº”æ„é€ å‡½æ•°çš„é¡ºåºæ³¨å…¥æ•°æ® -->
        <beans>
          <bean id="userService" class="x.y.UserService">
            <!-- valueç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ -->
            <constructor-arg  value="18"/>
            <constructor-arg  value="èµµä¼Ÿé£"/>
            
            <constructor-arg  ref="userDao"/>
          </bean>
          <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userDao" class="x.y.UserDao"/>

        <!-- åœºæ™¯2: å¤šå‚æ•°ï¼Œå¯ä»¥æŒ‰ç…§ç›¸åº”æ„é€ å‡½æ•°çš„åç§°æ³¨å…¥æ•°æ® -->
        <beans>
          <bean id="userService" class="x.y.UserService">
            <!-- valueç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ -->
            <constructor-arg name="name" value="èµµä¼Ÿé£"/>
            <constructor-arg name="userDao" ref="userDao"/>
            <constructor-arg name="age"  value="18"/>
          </bean>
          <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userDao" class="x.y.UserDao"/>

		 <!-- åœºæ™¯2: å¤šå‚æ•°ï¼Œå¯ä»¥æŒ‰ç…§ç›¸åº”æ„é€ å‡½æ•°çš„è§’æ ‡æ³¨å…¥æ•°æ® 
               indexä»0å¼€å§‹ æ„é€ å‡½æ•°(0,1,2....)
    -->
	    <beans>
	        <bean id="userService" class="x.y.UserService">
	        <!-- valueç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ -->
	        <constructor-arg index="1" value="èµµä¼Ÿé£"/>
	        <constructor-arg index="2" ref="userDao"/>
	        <constructor-arg index="0"  value="18"/>
	      </bean> 
	      <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
	      <bean id="userDao" class="x.y.UserDao"/>
	    </beans>
        ```
        -   constructor-argæ ‡ç­¾ï¼šæŒ‡å®šæ„é€ å‚æ•°å’Œå¯¹åº”çš„å€¼
        -   constructor-argæ ‡ç­¾ï¼šnameå±æ€§æŒ‡å®šå‚æ•°åã€indexå±æ€§æŒ‡å®šå‚æ•°è§’æ ‡ã€valueå±æ€§æŒ‡å®šæ™®é€šå±æ€§å€¼

5.  `åŸºäºSetteræ–¹æ³•ä¾èµ–æ³¨å…¥`

	1.  ä»‹ç»
        å¼€å‘ä¸­ï¼Œé™¤äº†æ„é€ å‡½æ•°æ³¨å…¥ï¼ˆDIï¼‰æ›´å¤šçš„ä½¿ç”¨çš„Setteræ–¹æ³•è¿›è¡Œæ³¨å…¥ï¼
        ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºä¸€ä¸ªåªèƒ½ä½¿ç”¨çº¯ setter æ³¨å…¥è¿›è¡Œä¾èµ–é¡¹æ³¨å…¥çš„ç±»ã€‚

	2.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public Class MovieFinder{

        }

        public class SimpleMovieLister {
          private MovieFinder movieFinder;
          private String movieName;
          public void setMovieFinder(MovieFinder movieFinder) {
            this.movieFinder = movieFinder;
          }
          public void setMovieName(String movieName){
            this.movieName = movieName;
          }

          // business logic that actually uses the injected MovieFinder is omitted...
        }
        ```

	3.  ç¼–å†™é…ç½®æ–‡ä»¶
        ```xml
        <bean id="simpleMovieLister" class="examples.SimpleMovieLister">
          <!-- setteræ–¹æ³•ï¼Œæ³¨å…¥movieFinderå¯¹è±¡çš„æ ‡è¯†id
               name = å±æ€§å  ref = å¼•ç”¨beançš„idå€¼
           -->
          <property name="movieFinder" ref="movieFinder" />

          <!-- setteræ–¹æ³•ï¼Œæ³¨å…¥åŸºæœ¬æ•°æ®ç±»å‹movieName
               name = å±æ€§å value= åŸºæœ¬ç±»å‹å€¼
           -->
          <property name="movieName" value="æ¶ˆå¤±çš„å¥¹"/>
        </bean>

        <bean id="movieFinder" class="examples.MovieFinder"/>

        ```
        -   propertyæ ‡ç­¾ï¼š å¯ä»¥ç»™setteræ–¹æ³•å¯¹åº”çš„å±æ€§èµ‹å€¼
        -   property æ ‡ç­¾ï¼š nameå±æ€§ä»£è¡¨**setæ–¹æ³•æ ‡è¯†**ã€refä»£è¡¨å¼•ç”¨beançš„æ ‡è¯†idã€valueå±æ€§ä»£è¡¨åŸºæœ¬å±æ€§å€¼

**æ€»ç»“ï¼š**

ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰åŒ…å«å¼•ç”¨ç±»å‹å’ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼ŒåŒæ—¶æ³¨å…¥çš„æ–¹å¼ä¹Ÿæœ‰å¤šç§ï¼ä¸»æµçš„æ³¨å…¥æ–¹å¼ä¸ºsetteræ–¹æ³•æ³¨å…¥å’Œæ„é€ å‡½æ•°æ³¨å…¥ï¼Œä¸¤ç§æ³¨å…¥è¯­æ³•éƒ½éœ€è¦æŒæ¡ï¼

éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šå¼•ç”¨å…¶ä»–beanï¼Œä½¿ç”¨refå±æ€§ã€‚ç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ï¼Œä½¿ç”¨valueå±æ€§ã€‚

#### 4.2.3 å®éªŒä¸‰ï¼š IoCå®¹å™¨åˆ›å»ºå’Œä½¿ç”¨

1.  `ä»‹ç»`

    ä¸Šé¢çš„å®éªŒåªæ˜¯è®²è§£äº†å¦‚ä½•åœ¨XMLæ ¼å¼çš„é…ç½®æ–‡ä»¶ç¼–å†™IoCå’ŒDIé…ç½®ï¼

    å¦‚å›¾ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/91508c6ae5ed25eee740cfc5629a2a76.png)



    æƒ³è¦é…ç½®æ–‡ä»¶ä¸­å£°æ˜ç»„ä»¶ç±»ä¿¡æ¯çœŸæ­£çš„è¿›è¡Œå®ä¾‹åŒ–æˆBeanå¯¹è±¡å’Œå½¢æˆBeanä¹‹é—´çš„å¼•ç”¨å…³ç³»ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜IoCå®¹å™¨å¯¹è±¡ï¼Œè¯»å–é…ç½®æ–‡ä»¶ï¼Œå®ä¾‹åŒ–ç»„ä»¶å’Œå…³ç³»ç»´æŠ¤çš„è¿‡ç¨‹éƒ½æ˜¯åœ¨IoCå®¹å™¨ä¸­å®ç°çš„ï¼

2.  `å®¹å™¨å®ä¾‹åŒ–`
    ```java
    //æ–¹å¼1:å®ä¾‹åŒ–å¹¶ä¸”æŒ‡å®šé…ç½®æ–‡ä»¶
    //å‚æ•°ï¼šString...locations ä¼ å…¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªé…ç½®æ–‡ä»¶
    ApplicationContext ctx = 
               new ClassPathXmlApplicationContext("services.xml", "daos.xml");
               
    //æ–¹å¼2:å…ˆå®ä¾‹åŒ–ï¼Œå†æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œæœ€ååˆ·æ–°å®¹å™¨è§¦å‘Beanå®ä¾‹åŒ–åŠ¨ä½œ [springmvcæºç å’ŒcontextLoadListeneræºç æ–¹å¼]  
    ApplicationContext ctx = 
               new ClassPathXmlApplicationContext();   
    //è®¾ç½®é…ç½®é…ç½®æ–‡ä»¶,æ–¹æ³•å‚æ•°ä¸ºå¯å˜å‚æ•°,å¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–è€…å¤šä¸ªé…ç½®
    ctx.setConfigLocations("services.xml", "daos.xml");
    //åé…ç½®çš„æ–‡ä»¶,éœ€è¦è°ƒç”¨refreshæ–¹æ³•,è§¦å‘åˆ·æ–°é…ç½®
    ctx.refresh();           

    ```

3.  `Beanå¯¹è±¡è¯»å–`
    ```java
    //æ–¹å¼1: æ ¹æ®idè·å–
    //æ²¡æœ‰æŒ‡å®šç±»å‹,è¿”å›ä¸ºObject,éœ€è¦ç±»å‹è½¬åŒ–!
    HappyComponent happyComponent = 
            (HappyComponent) iocContainer.getBean("beançš„idæ ‡è¯†");
            
    //ä½¿ç”¨ç»„ä»¶å¯¹è±¡        
    happyComponent.doWork();

    //æ–¹å¼2: æ ¹æ®ç±»å‹è·å–
    //æ ¹æ®ç±»å‹è·å–,ä½†æ˜¯è¦æ±‚,åŒç±»å‹(å½“å‰ç±»,æˆ–è€…ä¹‹ç±»,æˆ–è€…æ¥å£çš„å®ç°ç±»)åªèƒ½æœ‰ä¸€ä¸ªå¯¹è±¡äº¤ç»™IoCå®¹å™¨ç®¡ç†
    //é…ç½®ä¸¤ä¸ªæˆ–è€…ä»¥ä¸Šå‡ºç°: org.springframework.beans.factory.NoUniqueBeanDefinitionException é—®é¢˜
    HappyComponent happyComponent = iocContainer.getBean(HappyComponent.class);
    happyComponent.doWork();

    //æ–¹å¼3: æ ¹æ®idå’Œç±»å‹è·å–
    HappyComponent happyComponent = iocContainer.getBean("beançš„idæ ‡è¯†", HappyComponent.class);
    happyComponent.doWork();
    ```

- æ ¹æ®ç±»å‹æ¥è·å–beanæ—¶ï¼Œåœ¨æ»¡è¶³beanå”¯ä¸€æ€§çš„å‰æä¸‹ï¼Œå…¶å®åªæ˜¯çœ‹ï¼šã€å¯¹è±¡ instanceof æŒ‡å®šçš„ç±»å‹ã€çš„è¿”å›ç»“æœï¼Œ
    åªè¦è¿”å›çš„æ˜¯trueå°±å¯ä»¥è®¤å®šä¸ºå’Œç±»å‹åŒ¹é…ï¼Œèƒ½å¤Ÿè·å–åˆ°ã€‚

#### 4.2.4 å®éªŒå››ï¼š é«˜çº§ç‰¹æ€§ï¼šç»„ä»¶ï¼ˆBeanï¼‰ä½œç”¨åŸŸå’Œå‘¨æœŸæ–¹æ³•é…ç½®

1.  `ç»„ä»¶å‘¨æœŸæ–¹æ³•é…ç½®`

	1.  å‘¨æœŸæ–¹æ³•æ¦‚å¿µ
        æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ç±»ä¸­å®šä¹‰æ–¹æ³•ï¼Œç„¶åå½“IoCå®¹å™¨å®ä¾‹åŒ–å’Œé”€æ¯ç»„ä»¶å¯¹è±¡çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ï¼è¿™ä¸¤ä¸ªæ–¹æ³•æˆ‘ä»¬æˆä¸ºç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼
        ç±»ä¼¼äºServletçš„init/destroyæ–¹æ³•,æˆ‘ä»¬å¯ä»¥åœ¨å‘¨æœŸæ–¹æ³•å®Œæˆåˆå§‹åŒ–å’Œé‡Šæ”¾èµ„æºç­‰å·¥ä½œã€‚

	2.  å‘¨æœŸæ–¹æ³•å£°æ˜
        ```java
        public class BeanOne {
          //å‘¨æœŸæ–¹æ³•è¦æ±‚ï¼š æ–¹æ³•å‘½åéšæ„ï¼Œä½†æ˜¯è¦æ±‚æ–¹æ³•å¿…é¡»æ˜¯ public void æ— å½¢å‚åˆ—è¡¨
          public void init() {
            // åˆå§‹åŒ–é€»è¾‘
          }
        }

        public class BeanTwo {
          public void cleanup() {
            // é‡Šæ”¾èµ„æºé€»è¾‘
          }
        }
        ```

	3.  å‘¨æœŸæ–¹æ³•é…ç½®
        ```xml
        <beans>
          <bean id="beanOne" class="examples.BeanOne" init-method="init" />
          <bean id="beanTwo" class="examples.BeanTwo" destroy-method="cleanup" />
        </beans>
        ```

2.  `ç»„ä»¶ä½œç”¨åŸŸé…ç½®`

	1.  Beanä½œç”¨åŸŸæ¦‚å¿µ

        - `<bean` æ ‡ç­¾å£°æ˜Beanï¼Œåªæ˜¯å°†Beançš„ä¿¡æ¯é…ç½®ç»™SpringIoCå®¹å™¨ï¼
        - åœ¨IoCå®¹å™¨ä¸­ï¼Œè¿™äº›`<bean`æ ‡ç­¾å¯¹åº”çš„ä¿¡æ¯è½¬æˆSpringå†…éƒ¨ `BeanDefinition` å¯¹è±¡ï¼Œ`BeanDefinition` å¯¹è±¡å†…ï¼ŒåŒ…å«å®šä¹‰çš„ä¿¡æ¯ï¼ˆid,class,å±æ€§ç­‰ç­‰ï¼‰ï¼
        - è¿™æ„å‘³ç€ï¼Œ`BeanDefinition`ä¸`ç±»`æ¦‚å¿µä¸€æ ·ï¼ŒSpringIoCå®¹å™¨å¯ä»¥å¯ä»¥æ ¹æ®`BeanDefinition`å¯¹è±¡åå°„åˆ›å»ºå¤šä¸ªBeanå¯¹è±¡å®ä¾‹ã€‚
        - å…·ä½“åˆ›å»ºå¤šå°‘ä¸ªBeançš„å®ä¾‹å¯¹è±¡ï¼Œç”±Beançš„ä½œç”¨åŸŸScopeå±æ€§æŒ‡å®šï¼

	2.  ä½œç”¨åŸŸå¯é€‰å€¼![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/396a7772070dbf647c7d14ca43146aec.png)


    3.  ä½œç”¨åŸŸé…ç½®

        é…ç½®scopeèŒƒå›´
        ```xml
        <!--beançš„ä½œç”¨åŸŸ 
            å‡†å¤‡ä¸¤ä¸ªå¼•ç”¨å…³ç³»çš„ç»„ä»¶ç±»å³å¯ï¼ï¼
        -->
        <!-- scopeå±æ€§ï¼šå–å€¼singletonï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œbeanåœ¨IOCå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ŒIOCå®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»ºå¯¹è±¡ -->
        <!-- scopeå±æ€§ï¼šå–å€¼prototypeï¼Œbeanåœ¨IOCå®¹å™¨ä¸­å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼ŒgetBean()æ—¶åˆ›å»ºå¯¹è±¡ -->
        <bean id="happyMachine8" scope="prototype" class="com.atguigu.ioc.HappyMachine">
            <property name="machineName" value="happyMachine"/>
        </bean>

        <bean id="happyComponent8" scope="singleton" class="com.atguigu.ioc.HappyComponent">
            <property name="componentName" value="happyComponent"/>
        </bean>
        ```
    4.  ä½œç”¨åŸŸæµ‹è¯•
        ```java
        @Test
        public void testExperiment08()  {
            ApplicationContext iocContainer = new ClassPathXmlApplicationContext("é…ç½®æ–‡ä»¶å");

            HappyMachine bean = iocContainer.getBean(HappyMachine.class);
            HappyMachine bean1 = iocContainer.getBean(HappyMachine.class);
            //å¤šä¾‹å¯¹æ¯” false
            System.out.println(bean == bean1);

            HappyComponent bean2 = iocContainer.getBean(HappyComponent.class);
            HappyComponent bean3 = iocContainer.getBean(HappyComponent.class);
            //å•ä¾‹å¯¹æ¯” true
            System.out.println(bean2 == bean3);
        }
        ```

#### 4.2.5 å®éªŒäº”ï¼š é«˜çº§ç‰¹æ€§ï¼šFactoryBeanç‰¹æ€§å’Œä½¿ç”¨

1.  `FactoryBeanç®€ä»‹`

    `FactoryBean` æ¥å£æ˜¯Spring IoCå®¹å™¨å®ä¾‹åŒ–é€»è¾‘çš„å¯æ’æ‹”æ€§ç‚¹ã€‚

    ç”¨äºé…ç½®å¤æ‚çš„Beanå¯¹è±¡ï¼Œå¯ä»¥å°†åˆ›å»ºè¿‡ç¨‹å­˜å‚¨åœ¨`FactoryBean` çš„getObjectæ–¹æ³•ï¼

    `FactoryBean<T>` æ¥å£æä¾›ä¸‰ç§æ–¹æ³•ï¼š
    -   `T getObject()`
        è¿”å›æ­¤å·¥å‚åˆ›å»ºçš„å¯¹è±¡çš„å®ä¾‹ã€‚è¯¥è¿”å›å€¼ä¼šè¢«å­˜å‚¨åˆ°IoCå®¹å™¨ï¼
        
    -   `boolean isSingleton()`
        å¦‚æœæ­¤ `FactoryBean` è¿”å›å•ä¾‹ï¼Œåˆ™è¿”å› `true` ï¼Œå¦åˆ™è¿”å› `false` ã€‚æ­¤æ–¹æ³•çš„é»˜è®¤å®ç°è¿”å› `true` ï¼ˆæ³¨æ„ï¼Œlombokæ’ä»¶ä½¿ç”¨ï¼Œå¯èƒ½å½±å“æ•ˆæœï¼‰ã€‚
        
    -   `Class<?> getObjectType()`: è¿”å› `getObject()` æ–¹æ³•è¿”å›çš„å¯¹è±¡ç±»å‹ï¼Œå¦‚æœäº‹å…ˆä¸çŸ¥é“ç±»å‹ï¼Œåˆ™è¿”å› `null` ã€‚
        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7d9f660b7167211c17c3e63b62beca78.png)


2.  `FactoryBeanä½¿ç”¨åœºæ™¯`
    1.  ä»£ç†ç±»çš„åˆ›å»º
    2.  ç¬¬ä¸‰æ–¹æ¡†æ¶æ•´åˆ
    3.  å¤æ‚å¯¹è±¡å®ä¾‹åŒ–ç­‰

3.  `Factorybeanåº”ç”¨`
    1.  å‡†å¤‡FactoryBeanå®ç°ç±»
        ```java
        // å®ç°FactoryBeanæ¥å£æ—¶éœ€è¦æŒ‡å®šæ³›å‹
        // æ³›å‹ç±»å‹å°±æ˜¯å½“å‰å·¥å‚è¦ç”Ÿäº§çš„å¯¹è±¡çš„ç±»å‹
        public class HappyFactoryBean implements FactoryBean<HappyMachine> {
            
            private String machineName;
            
            public String getMachineName() {
                return machineName;
            }
            
            public void setMachineName(String machineName) {
                this.machineName = machineName;
            }
            
            @Override
            public HappyMachine getObject() throws Exception {
            
                // æ–¹æ³•å†…éƒ¨æ¨¡æ‹Ÿåˆ›å»ºã€è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„å¤æ‚è¿‡ç¨‹
                HappyMachine happyMachine = new HappyMachine();
            
                happyMachine.setMachineName(this.machineName);
            
                return happyMachine;
            }
            
            @Override
            public Class<?> getObjectType() {
            
                // è¿”å›è¦ç”Ÿäº§çš„å¯¹è±¡çš„ç±»å‹
                return HappyMachine.class;
            }
        }
        ```

	2.  é…ç½®FactoryBeanå®ç°ç±»
        ```xml
        <!-- FactoryBeanæœºåˆ¶ -->
        <!-- è¿™ä¸ªbeanæ ‡ç­¾ä¸­classå±æ€§æŒ‡å®šçš„æ˜¯HappyFactoryBeanï¼Œä½†æ˜¯å°†æ¥ä»è¿™é‡Œè·å–çš„beanæ˜¯HappyMachineå¯¹è±¡ -->
        <bean id="happyMachine7" class="com.atguigu.ioc.HappyFactoryBean">
            <!-- propertyæ ‡ç­¾ä»ç„¶å¯ä»¥ç”¨æ¥é€šè¿‡setXxx()æ–¹æ³•ç»™å±æ€§èµ‹å€¼ -->
            <property name="machineName" value="iceCreamMachine"/>
        </bean>
        ```

	3.  æµ‹è¯•è¯»å–FactoryBeanå’ŒFactoryBean.getObjectå¯¹è±¡
        ```java
        @Test
        public void testExperiment07()  {

            ApplicationContext iocContainer = new ClassPathXmlApplicationContext("spring-bean-07.xml");

            //æ³¨æ„: ç›´æ¥æ ¹æ®å£°æ˜FactoryBeançš„id,è·å–çš„æ˜¯getObjectæ–¹æ³•è¿”å›çš„å¯¹è±¡
            HappyMachine happyMachine = iocContainer.getBean("happyMachine7",HappyMachine.class);
            System.out.println("happyMachine = " + happyMachine);

            //å¦‚æœæƒ³è¦è·å–FactoryBeanå¯¹è±¡, ç›´æ¥åœ¨idå‰æ·»åŠ &ç¬¦å·å³å¯!  &happyMachine7 è¿™æ˜¯ä¸€ç§å›ºå®šçš„çº¦æŸ
            Object bean = iocContainer.getBean("&happyMachine7");
            System.out.println("bean = " + bean);
        }
        ```

4.  `FactoryBeanå’ŒBeanFactoryåŒºåˆ«`

    `FactoryBean`æ˜¯ Spring ä¸­ä¸€ç§ç‰¹æ®Šçš„ beanï¼Œå¯ä»¥åœ¨ getObject() å·¥å‚æ–¹æ³•è‡ªå®šä¹‰çš„é€»è¾‘åˆ›å»ºBeanï¼æ˜¯ä¸€ç§èƒ½å¤Ÿç”Ÿäº§å…¶ä»– Bean çš„ Beanã€‚FactoryBean åœ¨å®¹å™¨å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œè€Œåœ¨å®é™…ä½¿ç”¨æ—¶åˆ™æ˜¯é€šè¿‡è°ƒç”¨ getObject() æ–¹æ³•æ¥å¾—åˆ°å…¶æ‰€ç”Ÿäº§çš„ Beanã€‚å› æ­¤ï¼ŒFactoryBean å¯ä»¥è‡ªå®šä¹‰ä»»ä½•æ‰€éœ€çš„åˆå§‹åŒ–é€»è¾‘ï¼Œç”Ÿäº§å‡ºä¸€äº›å®šåˆ¶åŒ–çš„ beanã€‚

    ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ`æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œéƒ½æ˜¯é€šè¿‡å®šä¹‰FactoryBeanå®ç°ï¼ï¼ï¼`

    **BeanFactory** æ˜¯ Spring æ¡†æ¶çš„åŸºç¡€ï¼Œå…¶ä½œä¸ºä¸€ä¸ªé¡¶çº§æ¥å£å®šä¹‰äº†å®¹å™¨çš„åŸºæœ¬è¡Œä¸ºï¼Œä¾‹å¦‚ç®¡ç† bean çš„ç”Ÿå‘½å‘¨æœŸã€é…ç½®æ–‡ä»¶çš„åŠ è½½å’Œè§£æã€bean çš„è£…é…å’Œä¾èµ–æ³¨å…¥ç­‰ã€‚BeanFactory æ¥å£æä¾›äº†è®¿é—® bean çš„æ–¹å¼ï¼Œä¾‹å¦‚ getBean() æ–¹æ³•è·å–æŒ‡å®šçš„ bean å®ä¾‹ã€‚å®ƒå¯ä»¥ä»ä¸åŒçš„æ¥æºï¼ˆä¾‹å¦‚ Mysql æ•°æ®åº“ã€XML æ–‡ä»¶ã€Java é…ç½®ç±»ç­‰ï¼‰è·å– bean å®šä¹‰ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º bean å®ä¾‹ã€‚åŒæ—¶ï¼ŒBeanFactory è¿˜åŒ…å«å¾ˆå¤šå­ç±»ï¼ˆä¾‹å¦‚ï¼ŒApplicationContext æ¥å£ï¼‰æä¾›äº†é¢å¤–çš„å¼ºå¤§åŠŸèƒ½ã€‚

    æ€»çš„æ¥è¯´ï¼ŒFactoryBean å’Œ BeanFactory çš„åŒºåˆ«ä¸»è¦åœ¨äºå‰è€…æ˜¯ç”¨äºåˆ›å»º bean çš„æ¥å£ï¼Œå®ƒæä¾›äº†æ›´åŠ çµæ´»çš„åˆå§‹åŒ–å®šåˆ¶åŠŸèƒ½ï¼Œè€Œåè€…æ˜¯ç”¨äºç®¡ç† bean çš„æ¡†æ¶åŸºç¡€æ¥å£ï¼Œæä¾›äº†åŸºæœ¬çš„å®¹å™¨åŠŸèƒ½å’Œ bean ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

#### 4.2.6 å®éªŒå…­ï¼š åŸºäºXMLæ–¹å¼æ•´åˆä¸‰å±‚æ¶æ„ç»„ä»¶

1.  éœ€æ±‚åˆ†æ

    æ­å»ºä¸€ä¸ªä¸‰å±‚æ¶æ„æ¡ˆä¾‹ï¼Œæ¨¡æ‹ŸæŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿï¼ˆå­¦ç”Ÿè¡¨ï¼‰ä¿¡æ¯ï¼ŒæŒä¹…å±‚ä½¿ç”¨JdbcTemplateå’ŒDruidæŠ€æœ¯ï¼Œä½¿ç”¨XMLæ–¹å¼è¿›è¡Œç»„ä»¶ç®¡ç†ï¼

    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/e24f5d09bc817b9c7a14ffb6a6135390.png)


2.  æ•°æ®åº“å‡†å¤‡
    ```java
    create database studb;

    use studb;

    CREATE TABLE students (
      id INT PRIMARY KEY,
      name VARCHAR(50) NOT NULL,
      gender VARCHAR(10) NOT NULL,
      age INT,
      class VARCHAR(50)
    );

    INSERT INTO students (id, name, gender, age, class)
    VALUES
      (1, 'å¼ ä¸‰', 'ç”·', 20, 'é«˜ä¸­ä¸€ç­'),
      (2, 'æå››', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (3, 'ç‹äº”', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (4, 'èµµå…­', 'å¥³', 20, 'é«˜ä¸­ä¸‰ç­'),
      (5, 'åˆ˜ä¸ƒ', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (6, 'é™ˆå…«', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (7, 'æ¨ä¹', 'ç”·', 20, 'é«˜ä¸­ä¸‰ç­'),
      (8, 'å´å', 'ç”·', 19, 'é«˜ä¸­äºŒç­');

    ```

3.  é¡¹ç›®å‡†å¤‡
    1.  é¡¹ç›®åˆ›å»º

        spring-xml-practice-02
    2.  ä¾èµ–å¯¼å…¥
        ```xml
        <dependencies>
              <!--spring contextä¾èµ–-->
              <!--å½“ä½ å¼•å…¥SpringContextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-context</artifactId>
                  <version>6.0.6</version>
              </dependency>

              <!-- æ•°æ®åº“é©±åŠ¨å’Œè¿æ¥æ± -->
              <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
                  <version>8.0.25</version>
              </dependency>

              <dependency>
                  <groupId>com.alibaba</groupId>
                  <artifactId>druid</artifactId>
                  <version>1.2.8</version>
              </dependency>

              <!-- spring-jdbc -->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-jdbc</artifactId>
                  <version>6.0.6</version>
              </dependency>

        </dependencies> 
        ```

	3.  å®ä½“ç±»å‡†å¤‡
        ```java
        public class Student {

            private Integer id;
            private String name;
            private String gender;
            private Integer age;
            private String classes;

            public Integer getId() {
                return id;
            }

            public void setId(Integer id) {
                this.id = id;
            }

            public String getName() {
                return name;
            }

            public void setName(String name) {
                this.name = name;
            }

            public String getGender() {
                return gender;
            }

            public void setGender(String gender) {
                this.gender = gender;
            }

            public Integer getAge() {
                return age;
            }

            public void setAge(Integer age) {
                this.age = age;
            }

            public String getClasses() {
                return classes;
            }

            public void setClasses(String classes) {
                this.classes = classes;
            }

            @Override
            public String toString() {
                return "Student{" +
                        "id=" + id +
                        ", name='" + name + '\'' +
                        ", gender='" + gender + '\'' +
                        ", age=" + age +
                        ", classes='" + classes + '\'' +
                        '}';
            }
        }

        ```

4.  JdbcTemplateæŠ€æœ¯è®²è§£
    > ä¸ºäº†åœ¨ç‰¹å®šé¢†åŸŸå¸®åŠ©æˆ‘ä»¬ç®€åŒ–ä»£ç ï¼ŒSpring å°è£…äº†å¾ˆå¤š ã€Templateã€å½¢å¼çš„æ¨¡æ¿ç±»ã€‚ä¾‹å¦‚ï¼šRedisTemplateã€RestTemplate ç­‰ç­‰ï¼ŒåŒ…æ‹¬æˆ‘ä»¬ä»Šå¤©è¦å­¦ä¹ çš„ JdbcTemplateã€‚

    > jdbc.properties
    æå–æ•°æ®åº“è¿æ¥ä¿¡æ¯
    ```.properties
    atguigu.url=jdbc:mysql://localhost:3306/studb
    atguigu.driver=com.mysql.cj.jdbc.Driver
    atguigu.username=root
    atguigu.password=root
    ```

	springiocé…ç½®æ–‡ä»¶
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd 
           http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


        <!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
        <context:property-placeholder location="classpath:jdbc.properties" />

        <!-- é…ç½®æ•°æ®æº -->
        <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
            <property name="url" value="${atguigu.url}"/>
            <property name="driverClassName" value="${atguigu.driver}"/>
            <property name="username" value="${atguigu.username}"/>
            <property name="password" value="${atguigu.password}"/>
        </bean>

        <!-- é…ç½® JdbcTemplate -->
        <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
            <!-- è£…é…æ•°æ®æº -->
            <property name="dataSource" ref="druidDataSource"/>
        </bean>
        
    </beans>
    ```

	åŸºäºjdbcTemplateçš„CRUDä½¿ç”¨
    ```java
    public class JdbcTemplateTest {
        /**
         * ä½¿ç”¨jdbcTemplateè¿›è¡ŒDMLåŠ¨ä½œ
         */
        @Test
        public void testDML(){
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            JdbcTemplate jdbcTemplate = applicationContext.getBean(JdbcTemplate.class);
            //TODO æ‰§è¡Œæ’å…¥ä¸€æ¡å­¦å‘˜æ•°æ®
            String sql = "insert into students (id,name,gender,age,class) values (?,?,?,?,?);";
        /*
            å‚æ•°1: sqlè¯­å¥
            å‚æ•°2: å¯å˜å‚æ•°,å ä½ç¬¦çš„å€¼
         */
            int rows = jdbcTemplate.update(sql, 9,"åä¸€", "ç”·", 18, "äºŒå¹´ä¸‰ç­");

            System.out.println("rows = " + rows);

        }

        /**
         * æŸ¥è¯¢å•æ¡å®ä½“å¯¹è±¡
         *   public class Student {
         *     private Integer id;
         *     private String name;
         *     private String gender;
         *     private Integer age;
         *     private String classes;
         */
        @Test
        public void testDQLForPojo(){
            String sql = "select id , name , age , gender , class as classes from students where id = ? ;";
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            JdbcTemplate jdbcTemplate = applicationContext.getBean(JdbcTemplate.class);
            //æ ¹æ®idæŸ¥è¯¢
            Student student = jdbcTemplate.queryForObject(sql,  (rs, rowNum) -> {
                //è‡ªå·±å¤„ç†ç»“æœæ˜ å°„
                Student stu = new Student();
                stu.setId(rs.getInt("id"));
                stu.setName(rs.getString("name"));
                stu.setAge(rs.getInt("age"));
                stu.setGender(rs.getString("gender"));
                stu.setClasses(rs.getString("classes"));
                return stu;
            }, 2);

            System.out.println("student = " + student);
        }



        /**
         * æŸ¥è¯¢å®ä½“ç±»é›†åˆ
         */
        @Test
        public void testDQLForListPojo(){

            String sql = "select id , name , age , gender , class as classes from students  ;";
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            JdbcTemplate jdbcTemplate = applicationContext.getBean(JdbcTemplate.class);
        /*
            queryå¯ä»¥è¿”å›é›†åˆ!
            BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
         */
            List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));
            System.out.println("studentList = " + studentList);
        }
    }

    ```

5.  ä¸‰å±‚æ¶æ„æ­å»ºå’Œå®ç°
    1.  æŒä¹…å±‚
        ```java
        //æ¥å£
        public interface StudentDao {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            List<Student> queryAll();
        }

        //å®ç°ç±»
        public class StudentDaoImpl implements StudentDao {
            private JdbcTemplate jdbcTemplate;
            public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {
                this.jdbcTemplate = jdbcTemplate;
            }

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            @Override
            public List<Student> queryAll() {
                String sql = "select id , name , age , gender , class as classes from students ;";
                /*
                  queryå¯ä»¥è¿”å›é›†åˆ!
                  BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
                 */
                List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));
                return studentList;
           }
        }

        ```
    2.  ä¸šåŠ¡å±‚
        ```java
        //æ¥å£
        public interface StudentService {
            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            List<Student> findAll();
        }

        //å®ç°ç±»
        public class StudentServiceImpl  implements StudentService {

            private StudentDao studentDao;
            public void setStudentDao(StudentDao studentDao) {
                this.studentDao = studentDao;
            }

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            @Override
            public List<Student> findAll() {
                List<Student> studentList =  studentDao.queryAll();
                return studentList;
            }
        }

        ```
    3.  è¡¨è¿°å±‚
        ```java
        public class StudentController {
            
            private StudentService studentService;

            public void setStudentService(StudentService studentService) {
                this.studentService = studentService;
            }
            
            public void  findAll(){
               List<Student> studentList =  studentService.findAll();
                System.out.println("studentList = " + studentList);
            }
        }
        ```
6.  ä¸‰å±‚æ¶æ„IoCé…ç½®
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


        <!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
        <context:property-placeholder location="classpath:jdbc.properties" />

        <!-- é…ç½®æ•°æ®æº -->
        <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
            <property name="url" value="${atguigu.url}"/>
            <property name="driverClassName" value="${atguigu.driver}"/>
            <property name="username" value="${atguigu.username}"/>
            <property name="password" value="${atguigu.password}"/>
        </bean>

        <!-- é…ç½® JdbcTemplate -->
        <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
            <!-- è£…é…æ•°æ®æº -->
            <property name="dataSource" ref="druidDataSource"/>
        </bean>


        <bean id="studentDao" class="com.atguigu.dao.impl.StudentDaoImpl">
            <property name="jdbcTemplate" ref="jdbcTemplate" />
        </bean>

        <bean id="studentService" class="com.atguigu.service.impl.StudentServiceImpl">
            <property name="studentDao" ref="studentDao" />
        </bean>

        <bean id="studentController" class="com.atguigu.controller.StudentController">
            <property name="studentService" ref="studentService" />
        </bean>

    </beans>
    ```
7.  è¿è¡Œæµ‹è¯•
    ```java
    public class ControllerTest {

        @Test
        public  void testRun(){
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            StudentController studentController = applicationContext.getBean(StudentController.class);
            studentController.findAll();
        }
    }
    ```

8.  XMLIoCæ–¹å¼é—®é¢˜æ€»ç»“
    1.  æ³¨å…¥çš„å±æ€§å¿…é¡»æ·»åŠ setteræ–¹æ³•ã€ä»£ç ç»“æ„ä¹±ï¼
    2.  é…ç½®æ–‡ä»¶å’ŒJavaä»£ç åˆ†ç¦»ã€ç¼–å†™ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼
    3.  XMLé…ç½®æ–‡ä»¶è§£ææ•ˆç‡ä½

### 4.3 åŸºäº æ³¨è§£ æ–¹å¼ç®¡ç† Bean

#### 4.3.1 å®éªŒä¸€ï¼š Beanæ³¨è§£æ ‡è®°å’Œæ‰«æ (IoC)

1.  **æ³¨è§£ç†è§£**

    å’Œ XML é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œæ³¨è§£æœ¬èº«å¹¶ä¸èƒ½æ‰§è¡Œï¼Œæ³¨è§£æœ¬èº«ä»…ä»…åªæ˜¯åšä¸€ä¸ªæ ‡è®°ï¼Œå…·ä½“çš„åŠŸèƒ½æ˜¯æ¡†æ¶æ£€æµ‹åˆ°æ³¨è§£æ ‡è®°çš„ä½ç½®ï¼Œç„¶åé’ˆå¯¹è¿™ä¸ªä½ç½®æŒ‰ç…§æ³¨è§£æ ‡è®°çš„åŠŸèƒ½æ¥æ‰§è¡Œå…·ä½“æ“ä½œã€‚

    æœ¬è´¨ä¸Šï¼šæ‰€æœ‰ä¸€åˆ‡çš„æ“ä½œéƒ½æ˜¯ Java ä»£ç æ¥å®Œæˆçš„ï¼ŒXML å’Œæ³¨è§£åªæ˜¯å‘Šè¯‰æ¡†æ¶ä¸­çš„ Java ä»£ç å¦‚ä½•æ‰§è¡Œã€‚

    ä¸¾ä¾‹ï¼šå…ƒæ—¦è”æ¬¢ä¼šè¦å¸ƒç½®æ•™å®¤ï¼Œè“è‰²çš„åœ°æ–¹è´´ä¸Šå…ƒæ—¦å¿«ä¹å››ä¸ªå­—ï¼Œçº¢è‰²çš„åœ°æ–¹è´´ä¸Šæ‹‰èŠ±ï¼Œé»„è‰²çš„åœ°æ–¹è´´ä¸Šæ°”çƒã€‚

    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fff3969c25a6d2600fa10cbbb1966618.png)



    ç­é•¿åšäº†æ‰€æœ‰æ ‡è®°ï¼ŒåŒå­¦ä»¬æ¥å®Œæˆå…·ä½“å·¥ä½œã€‚å¢™ä¸Šçš„æ ‡è®°ç›¸å½“äºæˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨çš„æ³¨è§£ï¼Œåé¢åŒå­¦ä»¬åšçš„å·¥ä½œï¼Œç›¸å½“äºæ¡†æ¶çš„å…·ä½“æ“ä½œã€‚

2.  **æ‰«æç†è§£**

    Spring ä¸ºäº†çŸ¥é“ç¨‹åºå‘˜åœ¨å“ªäº›åœ°æ–¹æ ‡è®°äº†ä»€ä¹ˆæ³¨è§£ï¼Œå°±éœ€è¦é€šè¿‡æ‰«æçš„æ–¹å¼ï¼Œæ¥è¿›è¡Œæ£€æµ‹ã€‚ç„¶åæ ¹æ®æ³¨è§£è¿›è¡Œåç»­æ“ä½œã€‚

3.  **å‡†å¤‡Springé¡¹ç›®å’Œç»„ä»¶**
    1.  å‡†å¤‡é¡¹ç›®pom.xml
        ```xml
        <dependencies>
            <!--spring contextä¾èµ–-->
            <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-context</artifactId>
                <version>6.0.6</version>
            </dependency>

            <!--junit5æµ‹è¯•-->
            <dependency>
                <groupId>org.junit.jupiter</groupId>
                <artifactId>junit-jupiter-api</artifactId>
                <version>5.3.1</version>
            </dependency>
        </dependencies>
        ```
    2.  å‡†å¤‡ç»„ä»¶ç±»

        æ™®é€šç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: æ™®é€šçš„ç»„ä»¶
         */
        public class CommonComponent {
        }

        ```
        Controllerç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: controllerç±»å‹ç»„ä»¶
         */
        public class XxxController {
        }

        ```
        Serviceç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: serviceç±»å‹ç»„ä»¶
         */
        public class XxxService {
        }

        ```
        Daoç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: daoç±»å‹ç»„ä»¶
         */
        public class XxxDao {
        }

        ```

4.  **ç»„ä»¶æ·»åŠ æ ‡è®°æ³¨è§£**
    1.  ç»„ä»¶æ ‡è®°æ³¨è§£å’ŒåŒºåˆ«

        Spring æä¾›äº†ä»¥ä¸‹å¤šä¸ªæ³¨è§£ï¼Œè¿™äº›æ³¨è§£å¯ä»¥ç›´æ¥æ ‡æ³¨åœ¨ Java ç±»ä¸Šï¼Œå°†å®ƒä»¬å®šä¹‰æˆ Spring Beanã€‚
        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/443624052e46b3a5db4d472093c12f53.png)  
        é€šè¿‡æŸ¥çœ‹æºç æˆ‘ä»¬å¾—çŸ¥ï¼Œ@Controllerã€@Serviceã€@Repositoryè¿™ä¸‰ä¸ªæ³¨è§£åªæ˜¯åœ¨@Componentæ³¨è§£çš„åŸºç¡€ä¸Šèµ·äº†ä¸‰ä¸ªæ–°çš„åå­—ã€‚

        å¯¹äºSpringä½¿ç”¨IOCå®¹å™¨ç®¡ç†è¿™äº›ç»„ä»¶æ¥è¯´æ²¡æœ‰åŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯è¯­æ³•å±‚é¢æ²¡æœ‰åŒºåˆ«ã€‚æ‰€ä»¥@Controllerã€@Serviceã€@Repositoryè¿™ä¸‰ä¸ªæ³¨è§£åªæ˜¯ç»™å¼€å‘äººå‘˜çœ‹çš„ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿä¾¿äºåˆ†è¾¨ç»„ä»¶çš„ä½œç”¨ã€‚

        æ³¨æ„ï¼šè™½ç„¶å®ƒä»¬æœ¬è´¨ä¸Šä¸€æ ·ï¼Œä½†æ˜¯ä¸ºäº†ä»£ç çš„å¯è¯»æ€§ã€ç¨‹åºç»“æ„ä¸¥è°¨ï¼æˆ‘ä»¬è‚¯å®šä¸èƒ½éšä¾¿èƒ¡ä¹±æ ‡è®°ã€‚

	2.  ä½¿ç”¨æ³¨è§£æ ‡è®°

        æ™®é€šç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: æ™®é€šçš„ç»„ä»¶
         */
        @Component
        public class CommonComponent {
        }

        ```
        Controllerç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: controllerç±»å‹ç»„ä»¶
         */
        @Controller
        public class XxxController {
        }

        ```
        Serviceç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: serviceç±»å‹ç»„ä»¶
         */
        @Service
        public class XxxService {
        }

        ```
        Daoç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: daoç±»å‹ç»„ä»¶
         */
        @Repository
        public class XxxDao {
        }

        ```

5.  **é…ç½®æ–‡ä»¶ç¡®å®šæ‰«æèŒƒå›´**

    æƒ…å†µ1ï¼šåŸºæœ¬æ‰«æé…ç½®
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">
        <!-- é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ… -->
        <!-- 1.åŒ…è¦ç²¾å‡†,æé«˜æ€§èƒ½!
             2.ä¼šæ‰«ææŒ‡å®šçš„åŒ…å’Œå­åŒ…å†…å®¹
             3.å¤šä¸ªåŒ…å¯ä»¥ä½¿ç”¨,åˆ†å‰² ä¾‹å¦‚: com.atguigu.controller,com.atguigu.serviceç­‰
        -->
        <context:component-scan base-package="com.atguigu.components"/>
      
    </beans>
    ```
    æƒ…å†µ2ï¼šæŒ‡å®šæ’é™¤ç»„ä»¶
    ```xml
    <!-- æƒ…å†µä¸‰ï¼šæŒ‡å®šä¸æ‰«æçš„ç»„ä»¶ -->
    <context:component-scan base-package="com.atguigu.components">
        
        <!-- context:exclude-filteræ ‡ç­¾ï¼šæŒ‡å®šæ’é™¤è§„åˆ™ -->
        <!-- typeå±æ€§ï¼šæŒ‡å®šæ ¹æ®ä»€ä¹ˆæ¥è¿›è¡Œæ’é™¤ï¼Œannotationå–å€¼è¡¨ç¤ºæ ¹æ®æ³¨è§£æ¥æ’é™¤ -->
        <!-- expressionå±æ€§ï¼šæŒ‡å®šæ’é™¤è§„åˆ™çš„è¡¨è¾¾å¼ï¼Œå¯¹äºæ³¨è§£æ¥è¯´æŒ‡å®šå…¨ç±»åå³å¯ -->
        <context:exclude-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
    </context:component-scan>
    ```
    æƒ…å†µ3ï¼šæŒ‡å®šæ‰«æç»„ä»¶
    ```xml
    <!-- æƒ…å†µå››ï¼šä»…æ‰«ææŒ‡å®šçš„ç»„ä»¶ -->
    <!-- ä»…æ‰«æ = å…³é—­é»˜è®¤è§„åˆ™ + è¿½åŠ è§„åˆ™ -->
    <!-- use-default-filterså±æ€§ï¼šå–å€¼falseè¡¨ç¤ºå…³é—­é»˜è®¤æ‰«æè§„åˆ™ -->
    <context:component-scan base-package="com.atguigu.ioc.components" use-default-filters="false">
        
        <!-- context:include-filteræ ‡ç­¾ï¼šæŒ‡å®šåœ¨åŸæœ‰æ‰«æè§„åˆ™çš„åŸºç¡€ä¸Šè¿½åŠ çš„è§„åˆ™ -->
        <context:include-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
    </context:component-scan>
    ```

6.  **ç»„ä»¶BeanNameé—®é¢˜**

    åœ¨æˆ‘ä»¬ä½¿ç”¨ XML æ–¹å¼ç®¡ç† bean çš„æ—¶å€™ï¼Œæ¯ä¸ª bean éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†â€”â€”id å±æ€§çš„å€¼ï¼Œä¾¿äºåœ¨å…¶ä»–åœ°æ–¹å¼•ç”¨ã€‚ç°åœ¨ä½¿ç”¨æ³¨è§£åï¼Œæ¯ä¸ªç»„ä»¶ä»ç„¶åº”è¯¥æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ã€‚

    é»˜è®¤æƒ…å†µï¼š

    ç±»åé¦–å­—æ¯å°å†™å°±æ˜¯ bean çš„ idã€‚ä¾‹å¦‚ï¼šSoldierController ç±»å¯¹åº”çš„ bean çš„ id å°±æ˜¯ soldierControllerã€‚

    ä½¿ç”¨valueå±æ€§æŒ‡å®šï¼š
    ```java
    @Controller(value = "tianDog")
    public class SoldierController {
    }
    ```
    å½“æ³¨è§£ä¸­åªè®¾ç½®ä¸€ä¸ªå±æ€§æ—¶ï¼Œvalueå±æ€§çš„å±æ€§åå¯ä»¥çœç•¥ï¼š
    ```java
    @Service("smallDog")
    public class SoldierService {
    }
    ```

7.  **æ€»ç»“**
    1.  æ³¨è§£æ–¹å¼IoCåªæ˜¯æ ‡è®°å“ªäº›ç±»è¦è¢«Springç®¡ç†
    2.  æœ€ç»ˆï¼Œæˆ‘ä»¬è¿˜éœ€è¦XMLæ–¹å¼æˆ–è€…åé¢è®²è§£Javaé…ç½®ç±»æ–¹å¼æŒ‡å®šæ³¨è§£ç”Ÿæ•ˆçš„åŒ…
    3.  **ç°é˜¶æ®µé…ç½®æ–¹å¼ä¸º æ³¨è§£ ï¼ˆæ ‡è®°ï¼‰+ XMLï¼ˆæ‰«æï¼‰**

#### 4.3.2 å®éªŒäºŒï¼š ç»„ä»¶ï¼ˆBeanï¼‰ä½œç”¨åŸŸå’Œå‘¨æœŸæ–¹æ³•æ³¨è§£;

1.  ç»„ä»¶å‘¨æœŸæ–¹æ³•é…ç½®
    1.  å‘¨æœŸæ–¹æ³•æ¦‚å¿µ

        æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ç±»ä¸­å®šä¹‰æ–¹æ³•ï¼Œç„¶åå½“IoCå®¹å™¨å®ä¾‹åŒ–å’Œé”€æ¯ç»„ä»¶å¯¹è±¡çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ï¼è¿™ä¸¤ä¸ªæ–¹æ³•æˆ‘ä»¬æˆä¸ºç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼

        ç±»ä¼¼äºServletçš„init/destroyæ–¹æ³•,æˆ‘ä»¬å¯ä»¥åœ¨å‘¨æœŸæ–¹æ³•å®Œæˆåˆå§‹åŒ–å’Œé‡Šæ”¾èµ„æºç­‰å·¥ä½œã€‚
    2.  å‘¨æœŸæ–¹æ³•å£°æ˜
        ```java
        public class BeanOne {

          //å‘¨æœŸæ–¹æ³•è¦æ±‚ï¼š æ–¹æ³•å‘½åéšæ„ï¼Œä½†æ˜¯è¦æ±‚æ–¹æ³•å¿…é¡»æ˜¯ public void æ— å½¢å‚åˆ—è¡¨
          @PostConstruct  //æ³¨è§£åˆ¶æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
          public void init() {
            // åˆå§‹åŒ–é€»è¾‘
          }
        }

        public class BeanTwo {
          
          @PreDestroy //æ³¨è§£æŒ‡å®šé”€æ¯æ–¹æ³•
          public void cleanup() {
            // é‡Šæ”¾èµ„æºé€»è¾‘
          }
        }
        ```

2.  ç»„ä»¶ä½œç”¨åŸŸé…ç½®
    1.  Beanä½œç”¨åŸŸæ¦‚å¿µ

        `<bean` æ ‡ç­¾å£°æ˜Beanï¼Œåªæ˜¯å°†Beançš„ä¿¡æ¯é…ç½®ç»™SpringIoCå®¹å™¨ï¼

        åœ¨IoCå®¹å™¨ä¸­ï¼Œè¿™äº›`<bean`æ ‡ç­¾å¯¹åº”çš„ä¿¡æ¯è½¬æˆSpringå†…éƒ¨ `BeanDefinition` å¯¹è±¡ï¼Œ`BeanDefinition` å¯¹è±¡å†…ï¼ŒåŒ…å«å®šä¹‰çš„ä¿¡æ¯ï¼ˆid,class,å±æ€§ç­‰ç­‰ï¼‰ï¼

        è¿™æ„å‘³ç€ï¼Œ`BeanDefinition`ä¸`ç±»`æ¦‚å¿µä¸€æ ·ï¼ŒSpringIoCå®¹å™¨å¯ä»¥å¯ä»¥æ ¹æ®`BeanDefinition`å¯¹è±¡åå°„åˆ›å»ºå¤šä¸ªBeanå¯¹è±¡å®ä¾‹ã€‚

        å…·ä½“åˆ›å»ºå¤šå°‘ä¸ªBeançš„å®ä¾‹å¯¹è±¡ï¼Œç”±Beançš„ä½œç”¨åŸŸScopeå±æ€§æŒ‡å®šï¼

	2.  ä½œç”¨åŸŸå¯é€‰å€¼![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/11efe06e9d6cd29a79d63ae347d5fe2a.png)


        
    3.  ä½œç”¨åŸŸé…ç½®
        ```java
        @Scope(scopeName = ConfigurableBeanFactory.SCOPE_SINGLETON) //å•ä¾‹,é»˜è®¤å€¼
        @Scope(scopeName = ConfigurableBeanFactory.SCOPE_PROTOTYPE) //å¤šä¾‹  äºŒé€‰ä¸€
        public class BeanOne {

          //å‘¨æœŸæ–¹æ³•è¦æ±‚ï¼š æ–¹æ³•å‘½åéšæ„ï¼Œä½†æ˜¯è¦æ±‚æ–¹æ³•å¿…é¡»æ˜¯ public void æ— å½¢å‚åˆ—è¡¨
          @PostConstruct  //æ³¨è§£åˆ¶æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
          public void init() {
            // åˆå§‹åŒ–é€»è¾‘
          }
        }
        ```

#### 4.3.3 å®éªŒä¸‰ï¼š Beanå±æ€§èµ‹å€¼ï¼šå¼•ç”¨ç±»å‹è‡ªåŠ¨è£…é… (DI)

1.  **è®¾å®šåœºæ™¯**
    -   SoldierController éœ€è¦ SoldierService
    -   SoldierService éœ€è¦ SoldierDao
         åŒæ—¶åœ¨å„ä¸ªç»„ä»¶ä¸­å£°æ˜è¦è°ƒç”¨çš„æ–¹æ³•ã€‚
    -   SoldierControllerä¸­å£°æ˜æ–¹æ³•
        ```java
        import org.springframework.stereotype.Controller;

        @Controller(value = "tianDog")
        public class SoldierController {
            private SoldierService soldierService;
            public void getMessage() {
                soldierService.getMessage();
            }
        }
        ```
    -   SoldierServiceä¸­å£°æ˜æ–¹æ³•
        ```java
        @Service("smallDog")
        public class SoldierService {
            private SoldierDao soldierDao;
            public void getMessage() {
                soldierDao.getMessage();
            }
        }
        ```
    -   SoldierDaoä¸­å£°æ˜æ–¹æ³•
        ```java
        @Repository
        public class SoldierDao {
            public void getMessage() {
                System.out.print("I am a soldier");
            }

        }
        ```

2.  **è‡ªåŠ¨è£…é…å®ç°**
    1.  å‰æ

        å‚ä¸è‡ªåŠ¨è£…é…çš„ç»„ä»¶ï¼ˆéœ€è¦è£…é…ã€è¢«è£…é…ï¼‰å…¨éƒ¨éƒ½å¿…é¡»åœ¨IoCå®¹å™¨ä¸­ã€‚

        æ³¨æ„ï¼šä¸åŒºåˆ†IoCçš„æ–¹å¼ï¼XMLå’Œæ³¨è§£éƒ½å¯ä»¥ï¼

	2.  `@Autowiredæ³¨è§£`

        åœ¨æˆå‘˜å˜é‡ä¸Šç›´æ¥æ ‡è®°@Autowiredæ³¨è§£å³å¯ï¼Œä¸éœ€è¦æä¾›setXxx()æ–¹æ³•ã€‚ä»¥åæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­çš„æ­£å¼ç”¨æ³•å°±æ˜¯è¿™æ ·ã€‚

	3.  ç»™Controllerè£…é…Service
        ```java
        @Controller(value = "tianDog")
        public class SoldierController {
            
            @Autowired
            private SoldierService soldierService;
            
            public void getMessage() {
                soldierService.getMessage();
            }
            
        }
        ```
    4.  ç»™Serviceè£…é…Dao
        ```java
        @Service("smallDog")
        public class SoldierService {
            
            @Autowired
            private SoldierDao soldierDao;
            
            public void getMessage() {
                soldierDao.getMessage();
            }
        }
        ```
3.  **@Autowiredæ³¨è§£ç»†èŠ‚**
    1.  æ ‡è®°ä½ç½®
        1.  æˆå‘˜å˜é‡

            è¿™æ˜¯æœ€ä¸»è¦çš„ä½¿ç”¨æ–¹å¼ï¼

            ä¸xmlè¿›è¡Œbean refå¼•ç”¨ä¸åŒï¼Œä»–ä¸éœ€è¦æœ‰setæ–¹æ³•ï¼
            ```java
            @Service("smallDog")
            public class SoldierService {
                
                @Autowired
                private SoldierDao soldierDao;
                
                public void getMessage() {
                    soldierDao.getMessage();
                }
            }
            ```
        2.  æ„é€ å™¨
            ```java
            @Controller(value = "tianDog")
            public class SoldierController {
                
                private SoldierService soldierService;
                
                @Autowired
                public SoldierController(SoldierService soldierService) {
                    this.soldierService = soldierService;
                }
                â€¦â€¦
            ```
        3.  setXxx()æ–¹æ³•
            ```java
            @Controller(value = "tianDog")
            public class SoldierController {

                private SoldierService soldierService;

                @Autowired
                public void setSoldierService(SoldierService soldierService) {
                    this.soldierService = soldierService;
                }
                â€¦â€¦
            ```
    2.  å·¥ä½œæµç¨‹

        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ebb0bb0670238bf1910015870b488027.png)


        -   é¦–å…ˆæ ¹æ®æ‰€éœ€è¦çš„ç»„ä»¶ç±»å‹åˆ° IOC å®¹å™¨ä¸­æŸ¥æ‰¾
            -   èƒ½å¤Ÿæ‰¾åˆ°å”¯ä¸€çš„ beanï¼šç›´æ¥æ‰§è¡Œè£…é…
            -   å¦‚æœå®Œå…¨æ‰¾ä¸åˆ°åŒ¹é…è¿™ä¸ªç±»å‹çš„ beanï¼šè£…é…å¤±è´¥
            -   å’Œæ‰€éœ€ç±»å‹åŒ¹é…çš„ bean ä¸æ­¢ä¸€ä¸ª
                -   æ²¡æœ‰ @Qualifier æ³¨è§£ï¼šæ ¹æ® @Autowired æ ‡è®°ä½ç½®æˆå‘˜å˜é‡çš„å˜é‡åä½œä¸º bean çš„ id è¿›è¡ŒåŒ¹é…
                    -   èƒ½å¤Ÿæ‰¾åˆ°ï¼šæ‰§è¡Œè£…é…
                    -   æ‰¾ä¸åˆ°ï¼šè£…é…å¤±è´¥
                -   ä½¿ç”¨ @Qualifier æ³¨è§£ï¼šæ ¹æ® @Qualifier æ³¨è§£ä¸­æŒ‡å®šçš„åç§°ä½œä¸º bean çš„idè¿›è¡ŒåŒ¹é…
                    -   èƒ½å¤Ÿæ‰¾åˆ°ï¼šæ‰§è¡Œè£…é…
                    -   æ‰¾ä¸åˆ°ï¼šè£…é…å¤±è´¥
        ```java
        @Controller(value = "tianDog")
        public class SoldierController {
            
            @Autowired
            @Qualifier(value = "maomiService222")
            // æ ¹æ®é¢å‘æ¥å£ç¼–ç¨‹æ€æƒ³ï¼Œä½¿ç”¨æ¥å£ç±»å‹å¼•å…¥Serviceç»„ä»¶
            private ISoldierService soldierService;
        ```

4.  **ä½›ç³»è£…é…**

    ç»™ @Autowired æ³¨è§£è®¾ç½® required = false å±æ€§è¡¨ç¤ºï¼šèƒ½è£…å°±è£…ï¼Œè£…ä¸ä¸Šå°±ä¸è£…ã€‚ä½†æ˜¯å®é™…å¼€å‘æ—¶ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰éœ€è¦è£…é…ç»„ä»¶çš„åœ°æ–¹éƒ½æ˜¯å¿…é¡»è£…é…çš„ï¼Œç”¨ä¸ä¸Šè¿™ä¸ªå±æ€§
    ```java
    @Controller(value = "tianDog")
    public class SoldierController {

        // ç»™@Autowiredæ³¨è§£è®¾ç½®required = falseå±æ€§è¡¨ç¤ºï¼šèƒ½è£…å°±è£…ï¼Œè£…ä¸ä¸Šå°±ä¸è£…
        @Autowired(required = false)
        private ISoldierService soldierService;
    ```

5.  **æ‰©å±•JSR-250æ³¨è§£@Resource**
    -   ç†è§£JSRç³»åˆ—æ³¨è§£

        JSRï¼ˆJava Specification Requestsï¼‰æ˜¯Javaå¹³å°æ ‡å‡†åŒ–è¿›ç¨‹ä¸­çš„ä¸€ç§æŠ€æœ¯è§„èŒƒï¼Œè€ŒJSRæ³¨è§£æ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†é‡è¦çš„å†…å®¹ã€‚æŒ‰ç…§JSRçš„åˆ†ç±»ä»¥åŠæ³¨è§£è¯­ä¹‰çš„ä¸åŒï¼Œå¯ä»¥å°†JSRæ³¨è§£åˆ†ä¸ºä¸åŒçš„ç³»åˆ—ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç³»åˆ—ï¼š
        1.  JSR-175: è¿™ä¸ªJSRæ˜¯Java SE 5å¼•å…¥çš„ï¼Œæ˜¯Javaæ³¨è§£æœ€æ—©çš„è§„èŒƒåŒ–ç‰ˆæœ¬ï¼ŒJava SE 5åçš„ç‰ˆæœ¬ä¸­éƒ½åŒ…å«è¯¥JSRä¸­å®šä¹‰çš„æ³¨è§£ã€‚ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§æ ‡å‡†æ³¨è§£ï¼š
        -   `@Deprecated`: æ ‡è¯†ä¸€ä¸ªç¨‹åºå…ƒç´ ï¼ˆå¦‚ç±»ã€æ–¹æ³•æˆ–å­—æ®µï¼‰å·²è¿‡æ—¶ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«åˆ é™¤ã€‚
        -   `@Override`: æ ‡è¯†ä¸€ä¸ªæ–¹æ³•é‡å†™äº†çˆ¶ç±»ä¸­çš„æ–¹æ³•ã€‚
        -   `@SuppressWarnings`: æŠ‘åˆ¶ç¼–è¯‘æ—¶äº§ç”Ÿçš„è­¦å‘Šæ¶ˆæ¯ã€‚
        -   `@SafeVarargs`: æ ‡è¯†ä¸€ä¸ªæœ‰å®‰å…¨æ€§è­¦å‘Šçš„å¯å˜å‚æ•°æ–¹æ³•ã€‚
        -   `@FunctionalInterface`: æ ‡è¯†ä¸€ä¸ªæ¥å£åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¯ä»¥ä½œä¸ºlambdaè¡¨è¾¾å¼çš„ç›®æ ‡ã€‚
        1.  JSR-250: è¿™ä¸ªJSRä¸»è¦ç”¨äºåœ¨Java EE 5ä¸­å®šä¹‰ä¸€äº›æ”¯æŒæ³¨è§£ã€‚è¯¥JSRä¸»è¦å®šä¹‰äº†ä¸€äº›ç”¨äºè¿›è¡Œå¯¹è±¡ç®¡ç†çš„æ³¨è§£ï¼ŒåŒ…æ‹¬ï¼š
        -   `@Resource`: æ ‡è¯†ä¸€ä¸ªéœ€è¦æ³¨å…¥çš„èµ„æºï¼Œæ˜¯å®ç°Java EEç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»çš„ä¸€ç§æ–¹å¼ã€‚
        -   `@PostConstruct`: æ ‡è¯†ä¸€ä¸ªæ–¹æ³•ä½œä¸ºåˆå§‹åŒ–æ–¹æ³•ã€‚
        -   `@PreDestroy`: æ ‡è¯†ä¸€ä¸ªæ–¹æ³•ä½œä¸ºé”€æ¯æ–¹æ³•ã€‚
        -   `@Resource.AuthenticationType`: æ ‡è¯†æ³¨å…¥çš„èµ„æºçš„èº«ä»½éªŒè¯ç±»å‹ã€‚
        -   `@Resource.AuthenticationType`: æ ‡è¯†æ³¨å…¥çš„èµ„æºçš„é»˜è®¤åç§°ã€‚
        1.  JSR-269: è¿™ä¸ªJSRä¸»è¦æ˜¯Java SE 6ä¸­å¼•å…¥çš„ä¸€ç§æ”¯æŒç¼–è¯‘æ—¶å…ƒæ•°æ®å¤„ç†çš„æ¡†æ¶ï¼Œå³ä½¿ç”¨æ³¨è§£æ¥å¤„ç†Javaæºæ–‡ä»¶ã€‚è¯¥JSRå®šä¹‰äº†ä¸€äº›å¯ä»¥ç”¨æ³¨è§£æ ‡è®°çš„æ³¨è§£å¤„ç†å™¨ï¼Œç”¨äºç”Ÿæˆä¸€äº›å…ƒæ•°æ®ï¼Œå¸¸ç”¨çš„æ³¨è§£æœ‰ï¼š
        -   `@SupportedAnnotationTypes`: æ ‡è¯†æ³¨è§£å¤„ç†å™¨æ‰€å¤„ç†çš„æ³¨è§£ç±»å‹ã€‚
        -   `@SupportedSourceVersion`: æ ‡è¯†æ³¨è§£å¤„ç†å™¨æ”¯æŒçš„Javaæºç ç‰ˆæœ¬ã€‚
        1.  JSR-330: è¯¥JSRä¸»è¦ä¸ºJavaåº”ç”¨ç¨‹åºå®šä¹‰äº†ä¸€ä¸ªä¾èµ–æ³¨å…¥çš„æ ‡å‡†ï¼Œå³Javaä¾èµ–æ³¨å…¥æ ‡å‡†ï¼ˆjavax.injectï¼‰ã€‚åœ¨æ­¤è§„èŒƒä¸­å®šä¹‰äº†å¤šç§æ³¨è§£ï¼ŒåŒ…æ‹¬ï¼š
        -   `@Named`: æ ‡è¯†ä¸€ä¸ªè¢«ä¾èµ–æ³¨å…¥çš„ç»„ä»¶çš„åç§°ã€‚
        -   `@Inject`: æ ‡è¯†ä¸€ä¸ªéœ€è¦è¢«æ³¨å…¥çš„ä¾èµ–ç»„ä»¶ã€‚
        -   `@Singleton`: æ ‡è¯†ä¸€ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªæœ‰ä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ã€‚
        1.  JSR-250: è¿™ä¸ªJSRä¸»è¦æ˜¯Java EE 5ä¸­å®šä¹‰ä¸€äº›æ”¯æŒæ³¨è§£ã€‚è¯¥JSRåŒ…å«äº†ä¸€äº›æ”¯æŒæ³¨è§£ï¼Œå¯ä»¥ç”¨äºå¯¹Java EEç»„ä»¶è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬ï¼š
        -   `@RolesAllowed`: æ ‡è¯†æˆæƒè§’è‰²
        -   `@PermitAll`: æ ‡è¯†ä¸€ä¸ªæ´»åŠ¨æ— éœ€è¿›è¡Œèº«ä»½éªŒè¯ã€‚
        -   `@DenyAll`: æ ‡è¯†ä¸æä¾›é’ˆå¯¹è¯¥æ–¹æ³•çš„è®¿é—®æ§åˆ¶ã€‚
        -   `@DeclareRoles`: å£°æ˜å®‰å…¨è§’è‰²ã€‚
            ä½†æ˜¯ä½ è¦ç†è§£JSRæ˜¯Javaæä¾›çš„**æŠ€æœ¯è§„èŒƒ**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–åªæ˜¯è§„å®šäº†æ³¨è§£å’Œæ³¨è§£çš„å«ä¹‰ï¼Œ**JSRå¹¶ä¸æ˜¯ç›´æ¥æä¾›ç‰¹å®šçš„å®ç°**ï¼Œè€Œæ˜¯æä¾›æ ‡å‡†å’ŒæŒ‡å¯¼æ–¹é’ˆï¼Œç”±ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼ˆSpringï¼‰å’Œåº“æ¥å®ç°å’Œæä¾›å¯¹åº”çš„åŠŸèƒ½ã€‚
    -   JSR-250 @Resourceæ³¨è§£

        @Resourceæ³¨è§£ä¹Ÿå¯ä»¥å®Œæˆå±æ€§æ³¨å…¥ã€‚é‚£å®ƒå’Œ@Autowiredæ³¨è§£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
        -   @Resourceæ³¨è§£æ˜¯JDKæ‰©å±•åŒ…ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å±äºJDKçš„ä¸€éƒ¨åˆ†ã€‚æ‰€ä»¥è¯¥æ³¨è§£æ˜¯æ ‡å‡†æ³¨è§£ï¼Œæ›´åŠ å…·æœ‰é€šç”¨æ€§ã€‚(JSR-250æ ‡å‡†ä¸­åˆ¶å®šçš„æ³¨è§£ç±»å‹ã€‚JSRæ˜¯Javaè§„èŒƒææ¡ˆã€‚)
        -   @Autowiredæ³¨è§£æ˜¯Springæ¡†æ¶è‡ªå·±çš„ã€‚
        -   **@Resourceæ³¨è§£é»˜è®¤æ ¹æ®Beanåç§°è£…é…ï¼ŒæœªæŒ‡å®šnameæ—¶ï¼Œä½¿ç”¨å±æ€§åä½œä¸ºnameã€‚é€šè¿‡nameæ‰¾ä¸åˆ°çš„è¯ä¼šè‡ªåŠ¨å¯åŠ¨é€šè¿‡ç±»å‹è£…é…ã€‚**
        -   **@Autowiredæ³¨è§£é»˜è®¤æ ¹æ®ç±»å‹è£…é…ï¼Œå¦‚æœæƒ³æ ¹æ®åç§°è£…é…ï¼Œéœ€è¦é…åˆ@Qualifieræ³¨è§£ä¸€èµ·ç”¨ã€‚**
        -   @Resourceæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€‚
        -   @Autowiredæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•å‚æ•°ä¸Šã€‚
            @Resourceæ³¨è§£å±äºJDKæ‰©å±•åŒ…ï¼Œæ‰€ä»¥ä¸åœ¨JDKå½“ä¸­ï¼Œéœ€è¦é¢å¤–å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼šã€**é«˜äºJDK11æˆ–ä½äºJDK8éœ€è¦å¼•å…¥ä»¥ä¸‹ä¾èµ–**ã€‘
        ```xml
        <dependency>
            <groupId>jakarta.annotation</groupId>
            <artifactId>jakarta.annotation-api</artifactId>
            <version>2.1.1</version>
        </dependency>
        ```
    -   @Resourceä½¿ç”¨
        ```java
        @Controller
        public class XxxController {
            /**
             * 1. å¦‚æœæ²¡æœ‰æŒ‡å®šname,å…ˆæ ¹æ®å±æ€§åæŸ¥æ‰¾IoCä¸­ç»„ä»¶xxxService
             * 2. å¦‚æœæ²¡æœ‰æŒ‡å®šname,å¹¶ä¸”å±æ€§åæ²¡æœ‰å¯¹åº”çš„ç»„ä»¶,ä¼šæ ¹æ®å±æ€§ç±»å‹æŸ¥æ‰¾
             * 3. å¯ä»¥æŒ‡å®šnameåç§°æŸ¥æ‰¾!  @Resource(name='test') == @Autowired + @Qualifier(value='test')
             */
            @Resource
            private XxxService xxxService;

            //@Resource(name = "æŒ‡å®šbeanName")
            //private XxxService xxxService;

            public void show(){
                System.out.println("XxxController.show");
                xxxService.show();
            }
        }
        ```

#### 4.3.4 å®éªŒå››ï¼š Beanå±æ€§èµ‹å€¼ï¼šåŸºæœ¬ç±»å‹å±æ€§èµ‹å€¼ (DI)

`@Value` é€šå¸¸ç”¨äºæ³¨å…¥å¤–éƒ¨åŒ–å±æ€§

**å£°æ˜å¤–éƒ¨é…ç½®**

application.properties

```java
catalog.name=MovieCatalog
```

**xmlå¼•å…¥å¤–éƒ¨é…ç½®**

```java
<!-- å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶-->
<context:property-placeholder location="application.properties" />
```

**@Valueæ³¨è§£è¯»å–é…ç½®**

```java
package com.atguigu.components;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

/**
 * projectName: com.atguigu.components
 *
 * description: æ™®é€šçš„ç»„ä»¶
 */
@Component
public class CommonComponent {

    /**
     * æƒ…å†µ1: ${key} å–å¤–éƒ¨é…ç½®keyå¯¹åº”çš„å€¼!
     * æƒ…å†µ2: ${key:defaultValue} æ²¡æœ‰key,å¯ä»¥ç»™ä¸é»˜è®¤å€¼
     */
    @Value("${catalog:hahaha}")
    private String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}

```
#### 4.3.5 å®éªŒäº”ï¼š åŸºäºæ³¨è§£+XMLæ–¹å¼æ•´åˆä¸‰å±‚æ¶æ„ç»„ä»¶

1.  éœ€æ±‚åˆ†æ

    æ­å»ºä¸€ä¸ªä¸‰å±‚æ¶æ„æ¡ˆä¾‹ï¼Œæ¨¡æ‹ŸæŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿï¼ˆå­¦ç”Ÿè¡¨ï¼‰ä¿¡æ¯ï¼ŒæŒä¹…å±‚ä½¿ç”¨JdbcTemplateå’ŒDruidæŠ€æœ¯ï¼Œä½¿ç”¨XML+æ³¨è§£æ–¹å¼è¿›è¡Œç»„ä»¶ç®¡ç†ï¼
	![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b5a625c5e5513915914a39324e02e07a.png)


2.  æ•°æ®åº“å‡†å¤‡
    ```java
    create database studb;

    use studb;

    CREATE TABLE students (
      id INT PRIMARY KEY,
      name VARCHAR(50) NOT NULL,
      gender VARCHAR(10) NOT NULL,
      age INT,
      class VARCHAR(50)
    );

    INSERT INTO students (id, name, gender, age, class)
    VALUES
      (1, 'å¼ ä¸‰', 'ç”·', 20, 'é«˜ä¸­ä¸€ç­'),
      (2, 'æå››', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (3, 'ç‹äº”', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (4, 'èµµå…­', 'å¥³', 20, 'é«˜ä¸­ä¸‰ç­'),
      (5, 'åˆ˜ä¸ƒ', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (6, 'é™ˆå…«', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (7, 'æ¨ä¹', 'ç”·', 20, 'é«˜ä¸­ä¸‰ç­'),
      (8, 'å´å', 'ç”·', 19, 'é«˜ä¸­äºŒç­');

    ```
3.  é¡¹ç›®å‡†å¤‡
    1.  é¡¹ç›®åˆ›å»º

        spring-annotation-practice-04
    2.  ä¾èµ–å¯¼å…¥
        ```xml
        <dependencies>
              <!--spring contextä¾èµ–-->
              <!--å½“ä½ å¼•å…¥SpringContextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-context</artifactId>
                  <version>6.0.6</version>
              </dependency>

              <!-- æ•°æ®åº“é©±åŠ¨å’Œè¿æ¥æ± -->
              <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
                  <version>8.0.25</version>
              </dependency>

              <dependency>
                  <groupId>com.alibaba</groupId>
                  <artifactId>druid</artifactId>
                  <version>1.2.8</version>
              </dependency>
              
              <dependency>
                    <groupId>jakarta.annotation</groupId>
                    <artifactId>jakarta.annotation-api</artifactId>
                    <version>2.1.1</version>
               </dependency>

              <!-- spring-jdbc -->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-jdbc</artifactId>
                  <version>6.0.6</version>
              </dependency>

        </dependencies> 
        ```
    3.  å®ä½“ç±»å‡†å¤‡
        ```java
        public class Student {

            private Integer id;
            private String name;
            private String gender;
            private Integer age;
            private String classes;

            public Integer getId() {
                return id;
            }

            public void setId(Integer id) {
                this.id = id;
            }

            public String getName() {
                return name;
            }

            public void setName(String name) {
                this.name = name;
            }

            public String getGender() {
                return gender;
            }

            public void setGender(String gender) {
                this.gender = gender;
            }

            public Integer getAge() {
                return age;
            }

            public void setAge(Integer age) {
                this.age = age;
            }

            public String getClasses() {
                return classes;
            }

            public void setClasses(String classes) {
                this.classes = classes;
            }

            @Override
            public String toString() {
                return "Student{" +
                        "id=" + id +
                        ", name='" + name + '\'' +
                        ", gender='" + gender + '\'' +
                        ", age=" + age +
                        ", classes='" + classes + '\'' +
                        '}';
            }
        }

        ```
4.  ä¸‰å±‚æ¶æ„æ­å»ºå’Œå®ç°
    1.  æŒä¹…å±‚
        ```java
        //æ¥å£
        public interface StudentDao {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            List<Student> queryAll();
        }

        //å®ç°ç±»
        @Repository
        public class StudentDaoImpl implements StudentDao {

            @Autowired
            private JdbcTemplate jdbcTemplate;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            @Override
            public List<Student> queryAll() {

                String sql = "select id , name , age , gender , class as classes from students ;";

                /*
                  queryå¯ä»¥è¿”å›é›†åˆ!
                  BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
                 */
                List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));

                return studentList;
            }
        }

        ```
    2.  ä¸šåŠ¡å±‚
        ```java
        //æ¥å£
        public interface StudentService {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            List<Student> findAll();

        }

        //å®ç°ç±»
        @Service
        public class StudentServiceImpl  implements StudentService {

            @Autowired
            private StudentDao studentDao;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            @Override
            public List<Student> findAll() {

                List<Student> studentList =  studentDao.queryAll();

                return studentList;
            }
        }

        ```
    3.  è¡¨è¿°å±‚
        ```java
        @Controller
        public class StudentController {

            @Autowired
            private StudentService studentService;

            public void  findAll(){
               List<Student> studentList =  studentService.findAll();
                System.out.println("studentList = " + studentList);
            }
        }

        ```
5.  ä¸‰å±‚æ¶æ„IoCé…ç½®
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


        <!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
        <context:property-placeholder location="classpath:jdbc.properties" />

        <!-- é…ç½®æ•°æ®æº -->
        <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
            <property name="url" value="${atguigu.url}"/>
            <property name="driverClassName" value="${atguigu.driver}"/>
            <property name="username" value="${atguigu.username}"/>
            <property name="password" value="${atguigu.password}"/>
        </bean>

        <bean class="org.springframework.jdbc.core.JdbcTemplate">
            <property name="dataSource" ref="druidDataSource" />
        </bean>

        <!-- æ‰«æIoc/DIæ³¨è§£ -->
        <context:component-scan base-package="com.atguigu.dao,com.atguigu.service,com.atguigu.controller" />

    </beans>
    ```
6.  è¿è¡Œæµ‹è¯•
    ```java
    public class ControllerTest {

        @Test
        public  void testRun(){
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            StudentController studentController = applicationContext.getBean(StudentController.class);
            studentController.findAll();
        }
    }
    ```
7.  æ³¨è§£+XML IoCæ–¹å¼é—®é¢˜æ€»ç»“
    1.  è‡ªå®šä¹‰ç±»å¯ä»¥ä½¿ç”¨æ³¨è§£æ–¹å¼ï¼Œä½†æ˜¯ç¬¬ä¸‰æ–¹ä¾èµ–çš„ç±»ä¾ç„¶ä½¿ç”¨XMLæ–¹å¼ï¼
    2.  XMLæ ¼å¼è§£ææ•ˆç‡ä½ï¼

### 4.4 åŸºäº é…ç½®ç±» æ–¹å¼ç®¡ç† Bean

#### 4.4.1 å®Œå…¨æ³¨è§£å¼€å‘ç†è§£

Spring å®Œå…¨æ³¨è§£é…ç½®ï¼ˆFully Annotation-based Configurationï¼‰æ˜¯æŒ‡é€šè¿‡ Javaé…ç½®ç±» ä»£ç æ¥é…ç½® Spring åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨æ³¨è§£æ¥æ›¿ä»£åŸæœ¬åœ¨ XML é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ã€‚ç›¸å¯¹äº XML é…ç½®ï¼Œå®Œå…¨æ³¨è§£é…ç½®å…·æœ‰æ›´å¼ºçš„ç±»å‹å®‰å…¨æ€§å’Œæ›´å¥½çš„å¯è¯»æ€§ã€‚

**ä¸¤ç§æ–¹å¼æ€ç»´è½¬åŒ–**ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8d48361bca8ca0627baaa07687caa48e.png)



#### 4.4.2 å®éªŒä¸€ï¼šé…ç½®ç±»å’Œæ‰«ææ³¨è§£

**xml+æ³¨è§£æ–¹å¼**

é…ç½®æ–‡ä»¶application.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


    <!-- é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ… -->
    <!-- 1.åŒ…è¦ç²¾å‡†,æé«˜æ€§èƒ½!
         2.ä¼šæ‰«ææŒ‡å®šçš„åŒ…å’Œå­åŒ…å†…å®¹
         3.å¤šä¸ªåŒ…å¯ä»¥ä½¿ç”¨,åˆ†å‰² ä¾‹å¦‚: com.atguigu.controller,com.atguigu.serviceç­‰
    -->
    <context:component-scan base-package="com.atguigu.components"/>

    <!-- å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶-->
    <context:property-placeholder location="application.properties" />
</beans>
```

æµ‹è¯•åˆ›å»ºIoCå®¹å™¨

```java
 // xmlæ–¹å¼é…ç½®æ–‡ä»¶ä½¿ç”¨ClassPathXmlApplicationContextå®¹å™¨è¯»å–
 ApplicationContext applicationContext =
                new ClassPathXmlApplicationContext("application.xml");
```

**é…ç½®ç±»+æ³¨è§£æ–¹å¼ï¼ˆå®Œå…¨æ³¨è§£æ–¹å¼ï¼‰**

é…ç½®ç±»

ä½¿ç”¨ @Configuration æ³¨è§£å°†ä¸€ä¸ªæ™®é€šçš„ç±»æ ‡è®°ä¸º Spring çš„é…ç½®ç±»ã€‚

```java
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;

//æ ‡æ³¨å½“å‰ç±»æ˜¯é…ç½®ç±»ï¼Œæ›¿ä»£application.xml    
@Configuration
//ä½¿ç”¨æ³¨è§£è¯»å–å¤–éƒ¨é…ç½®ï¼Œæ›¿ä»£ <context:property-placeholderæ ‡ç­¾
@PropertySource("classpath:application.properties")
//ä½¿ç”¨@ComponentScanæ³¨è§£,å¯ä»¥é…ç½®æ‰«æåŒ…,æ›¿ä»£<context:component-scanæ ‡ç­¾
@ComponentScan(basePackages = {"com.atguigu.components"})
public class MyConfiguration {
    
}
```

æµ‹è¯•åˆ›å»ºIoCå®¹å™¨

```java
// AnnotationConfigApplicationContext æ ¹æ®é…ç½®ç±»åˆ›å»º IOC å®¹å™¨å¯¹è±¡
ApplicationContext iocContainerAnnotation = 
new AnnotationConfigApplicationContext(MyConfiguration.class);
```

å¯ä»¥ä½¿ç”¨ no-arg æ„é€ å‡½æ•°å®ä¾‹åŒ– `AnnotationConfigApplicationContext` ï¼Œç„¶åä½¿ç”¨ `register()` æ–¹æ³•å¯¹å…¶è¿›è¡Œé…ç½®ã€‚æ­¤æ–¹æ³•åœ¨ä»¥ç¼–ç¨‹æ–¹å¼ç”Ÿæˆ `AnnotationConfigApplicationContext` æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š

```java
// AnnotationConfigApplicationContext-IOCå®¹å™¨å¯¹è±¡
ApplicationContext iocContainerAnnotation = 
new AnnotationConfigApplicationContext();
//å¤–éƒ¨è®¾ç½®é…ç½®ç±»
iocContainerAnnotation.register(MyConfiguration.class);
//åˆ·æ–°åæ–¹å¯ç”Ÿæ•ˆï¼ï¼
iocContainerAnnotation.refresh();

```

**æ€»ç»“ï¼š**

@ConfigurationæŒ‡å®šä¸€ä¸ªç±»ä¸ºé…ç½®ç±»ï¼Œå¯ä»¥æ·»åŠ é…ç½®æ³¨è§£ï¼Œæ›¿ä»£é…ç½®xmlæ–‡ä»¶

@ComponentScan(basePackages = {"åŒ…","åŒ…"}) æ›¿ä»£\<context:component-scanæ ‡ç­¾å®ç°æ³¨è§£æ‰«æ

@PropertySource("classpath:é…ç½®æ–‡ä»¶åœ°å€") æ›¿ä»£ \<context:property-placeholderæ ‡ç­¾

é…åˆIoC/DIæ³¨è§£ï¼Œå¯ä»¥è¿›è¡Œå®Œæ•´æ³¨è§£å¼€å‘ï¼

#### 4.4.3 å®éªŒäºŒï¼š@Beanå®šä¹‰ç»„ä»¶

**åœºæ™¯éœ€æ±‚**ï¼šå°†Druidè¿æ¥æ± å¯¹è±¡å­˜å‚¨åˆ°IoCå®¹å™¨

**éœ€æ±‚åˆ†æ**ï¼šç¬¬ä¸‰æ–¹jaråŒ…çš„ç±»ï¼Œæ·»åŠ åˆ°iocå®¹å™¨ï¼Œæ— æ³•ä½¿ç”¨@Componentç­‰ç›¸å…³æ³¨è§£ï¼å› ä¸ºæºç jaråŒ…å†…å®¹ä¸ºåªè¯»æ¨¡å¼ï¼

**xmlæ–¹å¼å®ç°**ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


    <!-- å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
    <context:property-placeholder location="classpath:jdbc.properties"/>

    <!-- å®éªŒå…­ [é‡è¦]ç»™beançš„å±æ€§èµ‹å€¼ï¼šå¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
    <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
        <property name="url" value="${jdbc.url}"/>
        <property name="driverClassName" value="${jdbc.driver}"/>
        <property name="username" value="${jdbc.user}"/>
        <property name="password" value="${jdbc.password}"/>
    </bean>

</beans>
```

**é…ç½®ç±»æ–¹å¼å®ç°**ï¼š

`@Bean` æ³¨é‡Šç”¨äºæŒ‡ç¤ºæ–¹æ³•å®ä¾‹åŒ–ã€é…ç½®å’Œåˆå§‹åŒ–è¦ç”± Spring IoC å®¹å™¨ç®¡ç†çš„æ–°å¯¹è±¡ã€‚å¯¹äºé‚£äº›ç†Ÿæ‚‰ Spring çš„ `<beans/>` XML é…ç½®çš„äººæ¥è¯´ï¼Œ `@Bean` æ³¨é‡Šä¸ `<bean/>` å…ƒç´ èµ·ç€ç›¸åŒçš„ä½œç”¨ã€‚

```java
//æ ‡æ³¨å½“å‰ç±»æ˜¯é…ç½®ç±»ï¼Œæ›¿ä»£application.xml    
@Configuration
//å¼•å…¥jdbc.propertiesæ–‡ä»¶
@PropertySource({"classpath:application.properties","classpath:jdbc.properties"})
@ComponentScan(basePackages = {"com.atguigu.components"})
public class MyConfiguration {

    //å¦‚æœç¬¬ä¸‰æ–¹ç±»è¿›è¡ŒIoCç®¡ç†,æ— æ³•ç›´æ¥ä½¿ç”¨@Componentç›¸å…³æ³¨è§£
    //è§£å†³æ–¹æ¡ˆ: xmlæ–¹å¼å¯ä»¥ä½¿ç”¨<beanæ ‡ç­¾
    //è§£å†³æ–¹æ¡ˆ: é…ç½®ç±»æ–¹å¼,å¯ä»¥ä½¿ç”¨æ–¹æ³•è¿”å›å€¼+@Beanæ³¨è§£
    @Bean
    public DataSource createDataSource(@Value("${jdbc.user}") String username,
                                       @Value("${jdbc.password}")String password,
                                       @Value("${jdbc.url}")String url,
                                       @Value("${jdbc.driver}")String driverClassName){
        //ä½¿ç”¨Javaä»£ç å®ä¾‹åŒ–
        DruidDataSource dataSource = new DruidDataSource();
        dataSource.setUsername(username);
        dataSource.setPassword(password);
        dataSource.setUrl(url);
        dataSource.setDriverClassName(driverClassName);
        //è¿”å›ç»“æœå³å¯
        return dataSource;
    }
}
```

#### 4.4.4 å®éªŒä¸‰ï¼šé«˜çº§ç‰¹æ€§ï¼š@Beanæ³¨è§£ç»†èŠ‚

1.  **@Beanç”ŸæˆBeanNameé—®é¢˜**

    @Beanæ³¨è§£æºç ï¼š
    ```java
    public @interface Bean {
        //å‰ä¸¤ä¸ªæ³¨è§£å¯ä»¥æŒ‡å®šBeançš„æ ‡è¯†
        @AliasFor("name")
        String[] value() default {};
        @AliasFor("value")
        String[] name() default {};
      
        //autowireCandidate å±æ€§æ¥æŒ‡ç¤ºè¯¥ Bean æ˜¯å¦å€™é€‰ç”¨äºè‡ªåŠ¨è£…é…ã€‚
        //autowireCandidate å±æ€§é»˜è®¤å€¼ä¸º trueï¼Œè¡¨ç¤ºè¯¥ Bean æ˜¯ä¸€ä¸ªé»˜è®¤çš„è£…é…ç›®æ ‡ï¼Œ
        //å¯è¢«å€™é€‰ç”¨äºè‡ªåŠ¨è£…é…ã€‚å¦‚æœå°† autowireCandidate å±æ€§è®¾ç½®ä¸º falseï¼Œåˆ™è¯´æ˜è¯¥ Bean ä¸æ˜¯é»˜è®¤çš„è£…é…ç›®æ ‡ï¼Œä¸ä¼šè¢«å€™é€‰ç”¨äºè‡ªåŠ¨è£…é…ã€‚
        boolean autowireCandidate() default true;

        //æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
        String initMethod() default "";
        //æŒ‡å®šé”€æ¯æ–¹æ³•
        String destroyMethod() default "(inferred)";
    }

    ```
    æŒ‡å®š@Beançš„åç§°ï¼š
    ```java
    @Configuration
    public class AppConfig {

      @Bean("myThing") //æŒ‡å®šåç§°
      public Thing thing() {
        return new Thing();
      }
    }
    ```
    `@Bean` æ³¨é‡Šæ³¨é‡Šæ–¹æ³•ã€‚ä½¿ç”¨æ­¤æ–¹æ³•åœ¨æŒ‡å®šä¸ºæ–¹æ³•è¿”å›å€¼çš„ç±»å‹çš„ `ApplicationContext` ä¸­æ³¨å†Œ Bean å®šä¹‰ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼ŒBean åç§°ä¸æ–¹æ³•åç§°ç›¸åŒã€‚ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤º `@Bean` æ–¹æ³•å£°æ˜ï¼š
    ```java
    @Configuration
    public class AppConfig {

      @Bean
      public TransferServiceImpl transferService() {
        return new TransferServiceImpl();
      }
    }
    ```
    å‰é¢çš„é…ç½®å®Œå…¨ç­‰åŒäºä¸‹é¢çš„Spring XMLï¼š
    ```java
    <beans>
      <bean id="transferService" class="com.acme.TransferServiceImpl"/>
    </beans>
    ```
2.  **@Bean åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•æŒ‡å®š**

    `@Bean` æ³¨è§£æ”¯æŒæŒ‡å®šä»»æ„åˆå§‹åŒ–å’Œé”€æ¯å›è°ƒæ–¹æ³•ï¼Œéå¸¸ç±»ä¼¼äº Spring XML åœ¨ `bean` å…ƒç´ ä¸Šçš„ `init-method` å’Œ `destroy-method` å±æ€§ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š
    ```java
    public class BeanOne {

      public void init() {
        // initialization logic
      }
    }

    public class BeanTwo {

      public void cleanup() {
        // destruction logic
      }
    }

    @Configuration
    public class AppConfig {

      @Bean(initMethod = "init")
      public BeanOne beanOne() {
        return new BeanOne();
      }

      @Bean(destroyMethod = "cleanup")
      public BeanTwo beanTwo() {
        return new BeanTwo();
      }
    }
    ```
3.  **@Bean Scopeä½œç”¨åŸŸ**

    å¯ä»¥æŒ‡å®šä½¿ç”¨ `@Bean` æ³¨é‡Šå®šä¹‰çš„ bean åº”å…·æœ‰ç‰¹å®šèŒƒå›´ã€‚æ‚¨å¯ä»¥ä½¿ç”¨åœ¨ Bean ä½œç”¨åŸŸéƒ¨åˆ†ä¸­æŒ‡å®šçš„ä»»ä½•æ ‡å‡†ä½œç”¨åŸŸã€‚

    é»˜è®¤ä½œç”¨åŸŸä¸º `singleton` ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ `@Scope` æ³¨é‡Šè¦†ç›–æ­¤èŒƒå›´ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š
    ```java
    @Configuration
    public class MyConfiguration {

      @Bean
      @Scope("prototype")
      public Encryptor encryptor() {
        // ...
      }
    }
    ```
4.  **@Beanæ–¹æ³•ä¹‹é—´ä¾èµ–**

    **å‡†å¤‡ç»„ä»¶**
    ```java
    public class HappyMachine {
        private String machineName;
        public String getMachineName() {
            return machineName;
        }
        
        public void setMachineName(String machineName) {
            this.machineName = machineName;
        }
    }
    ```
    ```java
    public class HappyComponent {
        //å¼•ç”¨æ–°ç»„ä»¶
        private HappyMachine happyMachine;
        public HappyMachine getHappyMachine() {
            return happyMachine;
        }
        public void setHappyMachine(HappyMachine happyMachine) {
            this.happyMachine = happyMachine;
        }
        public void doWork() {
            System.out.println("HappyComponent.doWork");
        }
    }
    ```
    **Javaé…ç½®ç±»å®ç°ï¼š**

    æ–¹æ¡ˆ1ï¼š

    ç›´æ¥è°ƒç”¨æ–¹æ³•è¿”å› Bean å®ä¾‹ï¼šåœ¨ä¸€ä¸ª `@Bean` æ–¹æ³•ä¸­ç›´æ¥è°ƒç”¨å…¶ä»– `@Bean` æ–¹æ³•æ¥è·å– Bean å®ä¾‹ï¼Œè™½ç„¶æ˜¯æ–¹æ³•è°ƒç”¨ï¼Œä¹Ÿæ˜¯é€šè¿‡IoCå®¹å™¨è·å–å¯¹åº”çš„Beanï¼Œä¾‹å¦‚ï¼š
    ```java
    @Configuration
    public class JavaConfig {

        @Bean
        public HappyMachine happyMachine(){
            return new HappyMachine();
        }

        @Bean
        public HappyComponent happyComponent(){
            HappyComponent happyComponent = new HappyComponent();
            //ç›´æ¥è°ƒç”¨æ–¹æ³•å³å¯! 
            happyComponent.setHappyMachine(happyMachine());
            return happyComponent;
        }

    }
    ```
    æ–¹æ¡ˆ2ï¼š

    å‚æ•°å¼•ç”¨æ³•ï¼šé€šè¿‡æ–¹æ³•å‚æ•°ä¼ é€’ Bean å®ä¾‹çš„å¼•ç”¨æ¥è§£å†³ Bean å®ä¾‹ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚ï¼š
    ```java
    package com.atguigu.config;

    import com.atguigu.ioc.HappyComponent;
    import com.atguigu.ioc.HappyMachine;
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;

    /**
     * projectName: com.atguigu.config
     * description: é…ç½®HappyComponentå’ŒHappyMachineå…³ç³»
     */

    @Configuration
    public class JavaConfig {

        @Bean
        public HappyMachine happyMachine(){
            return new HappyMachine();
        }

        /**
         * å¯ä»¥ç›´æ¥åœ¨å½¢å‚åˆ—è¡¨æ¥æ”¶IoCå®¹å™¨ä¸­çš„Bean!
         *    æƒ…å†µ1: ç›´æ¥æŒ‡å®šç±»å‹å³å¯
         *    æƒ…å†µ2: å¦‚æœæœ‰å¤šä¸ªbean,(HappyMachine åç§° ) å½¢å‚åç§°ç­‰äºè¦æŒ‡å®šçš„beanåç§°!
         *           ä¾‹å¦‚:
         *               @Bean
         *               public Foo foo1(){
         *                   return new Foo();
         *               }
         *               @Bean
         *               public Foo foo2(){
         *                   return new Foo()
         *               }
         *               @Bean
         *               public Component component(Foo foo1 / foo2 é€šè¿‡æ­¤å¤„æŒ‡å®šå¼•å…¥çš„bean)
         */
        @Bean
        public HappyComponent happyComponent(HappyMachine happyMachine){
            HappyComponent happyComponent = new HappyComponent();
            //èµ‹å€¼
            happyComponent.setHappyMachine(happyMachine);
            return happyComponent;
        }

    }
    ```

#### 4.4.5 å®éªŒå››ï¼šé«˜çº§ç‰¹æ€§ï¼š@Importæ‰©å±•

`@Import` æ³¨é‡Šå…è®¸ä»å¦ä¸€ä¸ªé…ç½®ç±»åŠ è½½ `@Bean` å®šä¹‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š

```java
@Configuration
public class ConfigA {

  @Bean
  public A a() {
    return new A();
  }
}

@Configuration
@Import(ConfigA.class)
public class ConfigB {

  @Bean
  public B b() {
    return new B();
  }
}
```

ç°åœ¨ï¼Œåœ¨å®ä¾‹åŒ–ä¸Šä¸‹æ–‡æ—¶ä¸éœ€è¦åŒæ—¶æŒ‡å®š `ConfigA.class` å’Œ `ConfigB.class` ï¼Œåªéœ€æ˜¾å¼æä¾› `ConfigB` ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š

```java
public static void main(String[] args) {
  ApplicationContext ctx = new AnnotationConfigApplicationContext(ConfigB.class);

  // now both beans A and B will be available...
  A a = ctx.getBean(A.class);
  B b = ctx.getBean(B.class);
}
```

æ­¤æ–¹æ³•ç®€åŒ–äº†å®¹å™¨å®ä¾‹åŒ–ï¼Œå› ä¸ºåªéœ€è¦å¤„ç†ä¸€ä¸ªç±»ï¼Œè€Œä¸æ˜¯è¦æ±‚æ‚¨åœ¨æ„é€ æœŸé—´è®°ä½å¯èƒ½å¤§é‡çš„ `@Configuration` ç±»ã€‚

#### 4.4.6 å®éªŒäº”ï¼šåŸºäºæ³¨è§£+é…ç½®ç±»æ–¹å¼æ•´åˆä¸‰å±‚æ¶æ„ç»„ä»¶

1.  éœ€æ±‚åˆ†æ

    æ­å»ºä¸€ä¸ªä¸‰å±‚æ¶æ„æ¡ˆä¾‹ï¼Œæ¨¡æ‹ŸæŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿï¼ˆå­¦ç”Ÿè¡¨ï¼‰ä¿¡æ¯ï¼ŒæŒä¹…å±‚ä½¿ç”¨JdbcTemplateå’ŒDruidæŠ€æœ¯ï¼Œä½¿ç”¨æ³¨è§£+é…ç½®ç±»æ–¹å¼è¿›è¡Œç»„ä»¶ç®¡ç†ï¼
   ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ce141379e37460748a14b064aec78bda.png)


2.  æ•°æ®åº“å‡†å¤‡
    ```java
    create database studb;

    use studb;

    CREATE TABLE students (
      id INT PRIMARY KEY,
      name VARCHAR(50) NOT NULL,
      gender VARCHAR(10) NOT NULL,
      age INT,
      class VARCHAR(50)
    );

    INSERT INTO students (id, name, gender, age, class)
    VALUES
      (1, 'å¼ ä¸‰', 'ç”·', 20, 'é«˜ä¸­ä¸€ç­'),
      (2, 'æå››', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (3, 'ç‹äº”', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (4, 'èµµå…­', 'å¥³', 20, 'é«˜ä¸­ä¸‰ç­'),
      (5, 'åˆ˜ä¸ƒ', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (6, 'é™ˆå…«', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (7, 'æ¨ä¹', 'ç”·', 20, 'é«˜ä¸­ä¸‰ç­'),
      (8, 'å´å', 'ç”·', 19, 'é«˜ä¸­äºŒç­');

    ```
3.  é¡¹ç›®å‡†å¤‡
    1.  é¡¹ç›®åˆ›å»º

        spring-java-practice-06
    2.  ä¾èµ–å¯¼å…¥
        ```xml
        <dependencies>
              <!--spring contextä¾èµ–-->
              <!--å½“ä½ å¼•å…¥SpringContextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-context</artifactId>
                  <version>6.0.6</version>
              </dependency>

              <!-- æ•°æ®åº“é©±åŠ¨å’Œè¿æ¥æ± -->
              <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
                  <version>8.0.25</version>
              </dependency>

              <dependency>
                  <groupId>com.alibaba</groupId>
                  <artifactId>druid</artifactId>
                  <version>1.2.8</version>
              </dependency>
              
              <dependency>
                    <groupId>jakarta.annotation</groupId>
                    <artifactId>jakarta.annotation-api</artifactId>
                    <version>2.1.1</version>
               </dependency>

              <!-- spring-jdbc -->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-jdbc</artifactId>
                  <version>6.0.6</version>
              </dependency>

        </dependencies> 
        ```
    3.  å®ä½“ç±»å‡†å¤‡
        ```java
        public class Student {

            private Integer id;
            private String name;
            private String gender;
            private Integer age;
            private String classes;

            public Integer getId() {
                return id;
            }

            public void setId(Integer id) {
                this.id = id;
            }

            public String getName() {
                return name;
            }

            public void setName(String name) {
                this.name = name;
            }

            public String getGender() {
                return gender;
            }

            public void setGender(String gender) {
                this.gender = gender;
            }

            public Integer getAge() {
                return age;
            }

            public void setAge(Integer age) {
                this.age = age;
            }

            public String getClasses() {
                return classes;
            }

            public void setClasses(String classes) {
                this.classes = classes;
            }

            @Override
            public String toString() {
                return "Student{" +
                        "id=" + id +
                        ", name='" + name + '\'' +
                        ", gender='" + gender + '\'' +
                        ", age=" + age +
                        ", classes='" + classes + '\'' +
                        '}';
            }
        }

        ```
4.  ä¸‰å±‚æ¶æ„æ­å»ºå’Œå®ç°
    1.  æŒä¹…å±‚
        ```java
        //æ¥å£
        public interface StudentDao {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            List<Student> queryAll();
        }

        //å®ç°ç±»
        @Repository
        public class StudentDaoImpl implements StudentDao {

            @Autowired
            private JdbcTemplate jdbcTemplate;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            @Override
            public List<Student> queryAll() {

                String sql = "select id , name , age , gender , class as classes from students ;";

                /*
                  queryå¯ä»¥è¿”å›é›†åˆ!
                  BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
                 */
                List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));

                return studentList;
            }
        }

        ```
    2.  ä¸šåŠ¡å±‚
        ```java
        //æ¥å£
        public interface StudentService {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            List<Student> findAll();

        }

        //å®ç°ç±»
        @Service
        public class StudentServiceImpl  implements StudentService {

            @Autowired
            private StudentDao studentDao;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            @Override
            public List<Student> findAll() {

                List<Student> studentList =  studentDao.queryAll();

                return studentList;
            }
        }

        ```
    3.  è¡¨è¿°å±‚
        ```java
        @Controller
        public class StudentController {

            @Autowired
            private StudentService studentService;

            public void  findAll(){
               List<Student> studentList =  studentService.findAll();
                System.out.println("studentList = " + studentList);
            }
        }

        ```
5.  ä¸‰å±‚æ¶æ„IoCé…ç½®ç±»
    ```java
    @Configuration
    @ComponentScan(basePackages = "com.atguigu")
    @PropertySource("classpath:jdbc.properties")
    public class JavaConfig {

        @Value("${atguigu.url}")
        private String url;
        @Value("${atguigu.driver}")
        private String driver;
        @Value("${atguigu.username}")
        private String username;
        @Value("${atguigu.password}")
        private String password;

        @Bean(destroyMethod = "close")
        public DruidDataSource dataSource(){
            DruidDataSource dataSource = new DruidDataSource();
            dataSource.setUrl(url);
            dataSource.setDriverClassName(driver);
            dataSource.setUsername(username);
            dataSource.setPassword(password);
            return dataSource;
        }

        @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)
        @Bean
        public JdbcTemplate jdbcTemplate(DataSource dataSource){
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            jdbcTemplate.setDataSource(dataSource);
            return jdbcTemplate;
        }

    }
    ```
6.  è¿è¡Œæµ‹è¯•
    ```java
    public class ControllerTest {

        @Test
        public  void testRun(){

            AnnotationConfigApplicationContext applicationContext =
                    new AnnotationConfigApplicationContext(JavaConfig.class);

            StudentController studentController = applicationContext.getBean(StudentController.class);

            studentController.findAll();

        }
    }
    ```

7.  æ³¨è§£+é…ç½®ç±» IoCæ–¹å¼æ€»ç»“
    1.  å®Œå…¨æ‘’å¼ƒäº†XMLé…ç½®æ–‡ä»¶
    2.  è‡ªå®šä¹‰ç±»ä½¿ç”¨IoCå’ŒDIæ³¨è§£æ ‡è®°
    3.  ç¬¬ä¸‰æ–¹ç±»ä½¿ç”¨é…ç½®ç±»å£°æ˜æ–¹æ³•+\@Beanæ–¹å¼å¤„ç†
    4.  å®Œå…¨æ³¨è§£æ–¹å¼ï¼ˆé…ç½®ç±»+æ³¨è§£ï¼‰æ˜¯ç°åœ¨ä¸»æµé…ç½®æ–¹å¼

### 4.5 ä¸‰ç§é…ç½®æ–¹å¼æ€»ç»“

#### 4.5.1 XMLæ–¹å¼é…ç½®æ€»ç»“

1.  æ‰€æœ‰å†…å®¹å†™åˆ°xmlæ ¼å¼é…ç½®æ–‡ä»¶ä¸­
2.  å£°æ˜beané€šè¿‡`<bean>`æ ‡ç­¾
3.  \<beanæ ‡ç­¾åŒ…å«åŸºæœ¬ä¿¡æ¯ï¼ˆid,classï¼‰å’Œå±æ€§ä¿¡æ¯ \<property name value / ref
4.  å¼•å…¥å¤–éƒ¨çš„propertiesæ–‡ä»¶å¯ä»¥é€šè¿‡\<context:property-placeholder
5.  IoCå…·ä½“å®¹å™¨å®ç°é€‰æ‹©ClassPathXmlApplicationContextå¯¹è±¡

#### 4.5.2 XML+æ³¨è§£æ–¹å¼é…ç½®æ€»ç»“

1.  æ³¨è§£è´Ÿè´£æ ‡è®°IoCçš„ç±»å’Œè¿›è¡Œå±æ€§è£…é…
2.  xmlæ–‡ä»¶ä¾ç„¶éœ€è¦ï¼Œéœ€è¦é€šè¿‡\<context:component-scanæ ‡ç­¾æŒ‡å®šæ³¨è§£èŒƒå›´
3.  æ ‡è®°IoCæ³¨è§£ï¼š@Component,@Service,@Controller,@Repository&#x20;
4.  æ ‡è®°DIæ³¨è§£ï¼š@Autowired @Qualifier @Resource @Value
5.  IoCå…·ä½“å®¹å™¨å®ç°é€‰æ‹©ClassPathXmlApplicationContextå¯¹è±¡

#### 4.5.3 å®Œå…¨æ³¨è§£æ–¹å¼é…ç½®æ€»ç»“

1.  å®Œå…¨æ³¨è§£æ–¹å¼æŒ‡çš„æ˜¯å»æ‰xmlæ–‡ä»¶ï¼Œä½¿ç”¨é…ç½®ç±» + æ³¨è§£å®ç°
2.  xmlæ–‡ä»¶æ›¿æ¢æˆä½¿ç”¨@Configurationæ³¨è§£æ ‡è®°çš„ç±»
3.  æ ‡è®°IoCæ³¨è§£ï¼š@Component,@Service,@Controller,@Repository&#x20;
4.  æ ‡è®°DIæ³¨è§£ï¼š@Autowired @Qualifier @Resource @Value
5.  \<context:component-scanæ ‡ç­¾æŒ‡å®šæ³¨è§£èŒƒå›´ä½¿ç”¨@ComponentScan(basePackages = {"com.atguigu.components"})æ›¿ä»£
6.  \<context:property-placeholderå¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶ä½¿ç”¨@PropertySource({"classpath:application.properties","classpath:jdbc.properties"})æ›¿ä»£
7.  \<bean æ ‡ç­¾ä½¿ç”¨@Beanæ³¨è§£å’Œæ–¹æ³•å®ç°
8.  IoCå…·ä½“å®¹å™¨å®ç°é€‰æ‹©AnnotationConfigApplicationContextå¯¹è±¡

### 4.6 æ•´åˆSpring5-Test5æ­å»ºæµ‹è¯•ç¯å¢ƒ

1.  æ•´åˆæµ‹è¯•ç¯å¢ƒä½œç”¨

    å¥½å¤„1ï¼šä¸éœ€è¦è‡ªå·±åˆ›å»ºIOCå®¹å™¨å¯¹è±¡äº†

    å¥½å¤„2ï¼šä»»ä½•éœ€è¦çš„beanéƒ½å¯ä»¥åœ¨æµ‹è¯•ç±»ä¸­ç›´æ¥äº«å—è‡ªåŠ¨è£…é…

2.  å¯¼å…¥ç›¸å…³ä¾èµ–
    ```xml
    <!--junit5æµ‹è¯•-->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.3.1</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-test</artifactId>
        <version>6.0.6</version>
        <scope>test</scope>
    </dependency>
    ```
3.  æ•´åˆæµ‹è¯•æ³¨è§£ä½¿ç”¨
    ```java
    //@SpringJUnitConfig(locations = {"classpath:spring-context.xml"})  //æŒ‡å®šé…ç½®æ–‡ä»¶xml
    @SpringJUnitConfig(value = {BeanConfig.class})  //æŒ‡å®šé…ç½®ç±»
    public class Junit5IntegrationTest {
        
        @Autowired
        private User user;
        
        @Test
        public void testJunit5() {
            System.out.println(user);
        }
    }
    ```

## 5 Spring AOPé¢å‘åˆ‡é¢ç¼–ç¨‹

### 5.1 åœºæ™¯è®¾å®šå’Œé—®é¢˜å¤ç°

1.  å‡†å¤‡AOPé¡¹ç›®

    é¡¹ç›®åï¼šspring-aop-annotation

    pom.xml
    ```xml
    <dependencies>
        <!--spring contextä¾èµ–-->
        <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-context</artifactId>
            <version>6.0.6</version>
        </dependency>

        <!--junit5æµ‹è¯•-->
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-api</artifactId>
            <version>5.3.1</version>
        </dependency>


        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-test</artifactId>
            <version>6.0.6</version>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>jakarta.annotation</groupId>
            <artifactId>jakarta.annotation-api</artifactId>
            <version>2.1.1</version>
        </dependency>
    </dependencies>
    ```
2.  å£°æ˜æ¥å£
    ```java
    /**
     *       + - * / è¿ç®—çš„æ ‡å‡†æ¥å£!
     */
    public interface Calculator {
        
        int add(int i, int j);
        
        int sub(int i, int j);
        
        int mul(int i, int j);
        
        int div(int i, int j);
        
    }
    ```
3.  æ¥å£å®ç°
    ```java
    package com.atguigu.proxy;


    /**
     * å®ç°è®¡ç®—æ¥å£,å•çº¯æ·»åŠ  + - * / å®ç°! æºæ‚å…¶ä»–åŠŸèƒ½!
     */
    public class CalculatorPureImpl implements Calculator {
        
        @Override
        public int add(int i, int j) {
        
            int result = i + j;
        
            return result;
        }
        
        @Override
        public int sub(int i, int j) {
        
            int result = i - j;
        
            return result;
        }
        
        @Override
        public int mul(int i, int j) {
        
            int result = i * j;
        
            return result;
        }
        
        @Override
        public int div(int i, int j) {
        
            int result = i / j;
        
            return result;
        }
    }
    ```
4.  å£°æ˜å¸¦æ—¥å¿—æ¥å£å®ç°

    æ–°éœ€æ±‚ï¼š éœ€è¦åœ¨æ¯ä¸ªæ–¹æ³•ä¸­ï¼Œæ·»åŠ æ§åˆ¶å°è¾“å‡ºï¼Œè¾“å‡ºå‚æ•°å’Œè¾“å‡ºè®¡ç®—åçš„è¿”å›å€¼ï¼

    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7f0cb43ae6de39056dae562dcf857106.png)


    ```java
    package com.atguigu.proxy;

    /**
     * åœ¨æ¯ä¸ªæ–¹æ³•ä¸­,è¾“å‡ºä¼ å…¥çš„å‚æ•°å’Œè®¡ç®—åçš„è¿”å›ç»“æœ!
     */
    public class CalculatorLogImpl implements Calculator {
        
        @Override
        public int add(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
            int result = i + j;
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
          
            return result;
        }
        
        @Override
        public int sub(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            int result = i - j;
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
            return result;
        }
        
        @Override
        public int mul(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            int result = i * j;
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
        
            return result;
        }
        
        @Override
        public int div(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            int result = i / j;
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
            
            return result;
        }
    }
    ```
5.  ä»£ç é—®é¢˜åˆ†æ
    1.  ä»£ç ç¼ºé™·
        -   å¯¹æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æœ‰å¹²æ‰°ï¼Œå¯¼è‡´ç¨‹åºå‘˜åœ¨å¼€å‘æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æ—¶åˆ†æ•£äº†ç²¾åŠ›
        -   é™„åŠ åŠŸèƒ½ä»£ç é‡å¤ï¼Œåˆ†æ•£åœ¨å„ä¸ªä¸šåŠ¡åŠŸèƒ½æ–¹æ³•ä¸­ï¼å†—ä½™ï¼Œä¸”ä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤ï¼
    2.  è§£å†³æ€è·¯

        æ ¸å¿ƒå°±æ˜¯ï¼šè§£è€¦ã€‚æˆ‘ä»¬éœ€è¦æŠŠé™„åŠ åŠŸèƒ½ä»ä¸šåŠ¡åŠŸèƒ½ä»£ç ä¸­æŠ½å–å‡ºæ¥ã€‚

        å°†é‡å¤çš„ä»£ç ç»Ÿä¸€æå–ï¼Œå¹¶ä¸”åŠ¨æ€æ’å…¥åˆ°æ¯ä¸ªä¸šåŠ¡æ–¹æ³•ï¼

	3.  æŠ€æœ¯å›°éš¾

        è§£å†³é—®é¢˜çš„å›°éš¾ï¼šæå–é‡å¤é™„åŠ åŠŸèƒ½ä»£ç åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¯ä»¥å®ç°

        ä½†æ˜¯å¦‚ä½•å°†ä»£ç æ’å…¥åˆ°å„ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šï¼Œæˆ‘ä»¬éœ€è¦å¼•ç”¨æ–°æŠ€æœ¯ï¼ï¼ï¼

### 5.2 è§£å†³æŠ€æœ¯ä»£ç†æ¨¡å¼

1.  **ä»£ç†æ¨¡å¼**

    äºŒåä¸‰ç§è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ï¼Œå±äºç»“æ„å‹æ¨¡å¼ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯é€šè¿‡æä¾›ä¸€ä¸ªä»£ç†ç±»ï¼Œè®©æˆ‘ä»¬åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„æ—¶å€™ï¼Œä¸å†æ˜¯ç›´æ¥å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†ç±»é—´æ¥è°ƒç”¨ã€‚è®©ä¸å±äºç›®æ ‡æ–¹æ³•æ ¸å¿ƒé€»è¾‘çš„ä»£ç ä»ç›®æ ‡æ–¹æ³•ä¸­å‰¥ç¦»å‡ºæ¥â€”â€”è§£è€¦ã€‚è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶å…ˆè°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå‡å°‘å¯¹ç›®æ ‡æ–¹æ³•çš„è°ƒç”¨å’Œæ‰“æ‰°ï¼ŒåŒæ—¶è®©é™„åŠ åŠŸèƒ½èƒ½å¤Ÿé›†ä¸­åœ¨ä¸€èµ·ä¹Ÿæœ‰åˆ©äºç»Ÿä¸€ç»´æŠ¤ã€‚

    æ— ä»£ç†åœºæ™¯ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/4a7107b21913dfd91ab3a441bbced5af.png)



    æœ‰ä»£ç†åœºæ™¯ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/77d10947a1bd16c5c8b20cb6fec68175.png)



    ç”Ÿæ´»ä¸­çš„ä»£ç†ï¼š
    -   å¹¿å‘Šå•†æ‰¾å¤§æ˜æ˜Ÿæ‹å¹¿å‘Šéœ€è¦ç»è¿‡ç»çºªäºº
    -   åˆä½œä¼™ä¼´æ‰¾å¤§è€æ¿è°ˆåˆä½œè¦çº¦è§é¢æ—¶é—´éœ€è¦ç»è¿‡ç§˜ä¹¦
    -   æˆ¿äº§ä¸­ä»‹æ˜¯ä¹°å–åŒæ–¹çš„ä»£ç†
    -   å¤ªç›‘æ˜¯å¤§è‡£å’Œçš‡ä¸Šä¹‹é—´çš„ä»£ç†
    ç›¸å…³æœ¯è¯­ï¼š
    -   ä»£ç†ï¼šå°†éæ ¸å¿ƒé€»è¾‘å‰¥ç¦»å‡ºæ¥ä»¥åï¼Œå°è£…è¿™äº›éæ ¸å¿ƒé€»è¾‘çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚(ä¸­ä»‹)
        -   åŠ¨è¯ï¼šæŒ‡åšä»£ç†è¿™ä¸ªåŠ¨ä½œï¼Œæˆ–è¿™é¡¹å·¥ä½œ
        -   åè¯ï¼šæ‰®æ¼”ä»£ç†è¿™ä¸ªè§’è‰²çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•
    -   ç›®æ ‡ï¼š**è¢«ä»£ç†**â€œå¥—ç”¨â€äº†æ ¸å¿ƒé€»è¾‘ä»£ç çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚(æˆ¿ä¸œ)
        ä»£ç†åœ¨å¼€å‘ä¸­å®ç°çš„æ–¹å¼å…·ä½“æœ‰ä¸¤ç§ï¼šé™æ€ä»£ç†ï¼Œ\[åŠ¨æ€ä»£ç†æŠ€æœ¯]

2.  **é™æ€ä»£ç†**

    ä¸»åŠ¨åˆ›å»ºä»£ç†ç±»ï¼š
    ```java
    public class CalculatorStaticProxy implements Calculator {
        
        // å°†è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡å£°æ˜ä¸ºæˆå‘˜å˜é‡
        private Calculator target;
        
        public CalculatorStaticProxy(Calculator target) {
            this.target = target;
        }
        
        @Override
        public int add(int i, int j) {
        
            // é™„åŠ åŠŸèƒ½ç”±ä»£ç†ç±»ä¸­çš„ä»£ç†æ–¹æ³•æ¥å®ç°
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            // é€šè¿‡ç›®æ ‡å¯¹è±¡æ¥å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
            int addResult = target.add(i, j);
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
        
            return addResult;
        }
        â€¦â€¦
    ```
    é™æ€ä»£ç†ç¡®å®å®ç°äº†è§£è€¦ï¼Œä½†æ˜¯ç”±äºä»£ç éƒ½å†™æ­»äº†ï¼Œå®Œå…¨ä¸å…·å¤‡ä»»ä½•çš„çµæ´»æ€§ã€‚å°±æ‹¿æ—¥å¿—åŠŸèƒ½æ¥è¯´ï¼Œå°†æ¥å…¶ä»–åœ°æ–¹ä¹Ÿéœ€è¦é™„åŠ æ—¥å¿—ï¼Œé‚£è¿˜å¾—å†å£°æ˜æ›´å¤šä¸ªé™æ€ä»£ç†ç±»ï¼Œé‚£å°±äº§ç”Ÿäº†å¤§é‡é‡å¤çš„ä»£ç ï¼Œæ—¥å¿—åŠŸèƒ½è¿˜æ˜¯åˆ†æ•£çš„ï¼Œæ²¡æœ‰ç»Ÿä¸€ç®¡ç†ã€‚

    æå‡ºè¿›ä¸€æ­¥çš„éœ€æ±‚ï¼šå°†æ—¥å¿—åŠŸèƒ½é›†ä¸­åˆ°ä¸€ä¸ªä»£ç†ç±»ä¸­ï¼Œå°†æ¥æœ‰ä»»ä½•æ—¥å¿—éœ€æ±‚ï¼Œéƒ½é€šè¿‡è¿™ä¸€ä¸ªä»£ç†ç±»æ¥å®ç°ã€‚è¿™å°±éœ€è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯äº†ã€‚

3.  **åŠ¨æ€ä»£ç†**

    åŠ¨æ€ä»£ç†æŠ€æœ¯åˆ†ç±»
    -   JDKåŠ¨æ€ä»£ç†ï¼šJDKåŸç”Ÿçš„å®ç°æ–¹å¼ï¼Œéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡ç±»å¿…é¡»**å®ç°æ¥å£**ï¼ä»–ä¼šæ ¹æ®ç›®æ ‡ç±»çš„æ¥å£åŠ¨æ€ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡æœ‰ç›¸åŒçš„æ¥å£ï¼ï¼ˆæ‹œæŠŠå­ï¼‰
    -   cglibï¼šé€šè¿‡ç»§æ‰¿è¢«ä»£ç†çš„ç›®æ ‡ç±»å®ç°ä»£ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ï¼ï¼ˆè®¤å¹²çˆ¹ï¼‰
        JDKåŠ¨æ€ä»£ç†æŠ€æœ¯å®ç°ï¼ˆäº†è§£ï¼‰![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/1d03ea9bb9c927d65750bcac856fd205.png)



    ä»£ç†å·¥ç¨‹ï¼šåŸºäºjdkä»£ç†æŠ€æœ¯ï¼Œç”Ÿæˆä»£ç†å¯¹è±¡
    ```java
    public class ProxyFactory {

        private Object target;

        public ProxyFactory(Object target) {
            this.target = target;
        }

        public Object getProxy(){

            /**
             * newProxyInstance()ï¼šåˆ›å»ºä¸€ä¸ªä»£ç†å®ä¾‹
             * å…¶ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼š
             * 1ã€classLoaderï¼šåŠ è½½åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„ç±»åŠ è½½å™¨
             * 2ã€interfacesï¼šç›®æ ‡å¯¹è±¡å®ç°çš„æ‰€æœ‰æ¥å£çš„classå¯¹è±¡æ‰€ç»„æˆçš„æ•°ç»„
             * 3ã€invocationHandlerï¼šè®¾ç½®ä»£ç†å¯¹è±¡å®ç°ç›®æ ‡å¯¹è±¡æ–¹æ³•çš„è¿‡ç¨‹ï¼Œå³ä»£ç†ç±»ä¸­å¦‚ä½•é‡å†™æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•
             */
            ClassLoader classLoader = target.getClass().getClassLoader();
            Class<?>[] interfaces = target.getClass().getInterfaces();
            InvocationHandler invocationHandler = new InvocationHandler() {
                @Override
                public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                    /**
                     * proxyï¼šä»£ç†å¯¹è±¡
                     * methodï¼šä»£ç†å¯¹è±¡éœ€è¦å®ç°çš„æ–¹æ³•ï¼Œå³å…¶ä¸­éœ€è¦é‡å†™çš„æ–¹æ³•
                     * argsï¼šmethodæ‰€å¯¹åº”æ–¹æ³•çš„å‚æ•°
                     */
                    Object result = null;
                    try {
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œå‚æ•°ï¼š"+ Arrays.toString(args));
                        result = method.invoke(target, args);
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œç»“æœï¼š"+ result);
                    } catch (Exception e) {
                        e.printStackTrace();
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œå¼‚å¸¸ï¼š"+e.getMessage());
                    } finally {
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•");
                    }
                    return result;
                }
            };

            return Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);
        }
    }
    ```
    æµ‹è¯•ä»£ç ï¼š
    ```java
    @Test
    public void testDynamicProxy(){
        ProxyFactory factory = new ProxyFactory(new CalculatorLogImpl());
        Calculator proxy = (Calculator) factory.getProxy();
        proxy.div(1,0);
        //proxy.div(1,1);
    }
    ```
4.  **ä»£ç†æ€»ç»“**

    **ä»£ç†æ–¹å¼å¯ä»¥è§£å†³é™„åŠ åŠŸèƒ½ä»£ç å¹²æ‰°æ ¸å¿ƒä»£ç å’Œä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤çš„é—®é¢˜ï¼**

    ä»–ä¸»è¦æ˜¯å°†é™„åŠ åŠŸèƒ½ä»£ç æå–åˆ°ä»£ç†ä¸­æ‰§è¡Œï¼Œä¸å¹²æ‰°ç›®æ ‡æ ¸å¿ƒä»£ç ï¼

    ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå‘ç°ï¼Œæ— è®ºä½¿ç”¨é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†(jdk,cglib)ï¼Œç¨‹åºå‘˜çš„å·¥ä½œéƒ½æ¯”è¾ƒç¹çï¼

    éœ€è¦è‡ªå·±ç¼–å†™ä»£ç†å·¥å‚ç­‰ï¼

    ä½†æ˜¯ï¼Œæå‰å‰§é€ï¼Œæˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸éœ€è¦ç¼–å†™ä»£ç†ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨\[Spring AOP]æ¡†æ¶ï¼Œ

    ä»–ä¼šç®€åŒ–åŠ¨æ€ä»£ç†çš„å®ç°ï¼ï¼ï¼

### 5.3 é¢å‘åˆ‡é¢ç¼–ç¨‹æ€ç»´ï¼ˆAOPï¼‰

1.  **é¢å‘åˆ‡é¢ç¼–ç¨‹æ€æƒ³AOP**

    AOPï¼šAspect Oriented Programmingé¢å‘åˆ‡é¢ç¼–ç¨‹

    AOPå¯ä»¥è¯´æ˜¯OOPï¼ˆObject Oriented Programmingï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰çš„è¡¥å……å’Œå®Œå–„ã€‚OOPå¼•å…¥å°è£…ã€ç»§æ‰¿ã€å¤šæ€ç­‰æ¦‚å¿µæ¥å»ºç«‹ä¸€ç§å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œç”¨äºæ¨¡æ‹Ÿå…¬å…±è¡Œä¸ºçš„ä¸€ä¸ªé›†åˆã€‚ä¸è¿‡OOPå…è®¸å¼€å‘è€…å®šä¹‰çºµå‘çš„å…³ç³»ï¼Œä½†å¹¶ä¸é€‚åˆå®šä¹‰æ¨ªå‘çš„å…³ç³»ï¼Œä¾‹å¦‚æ—¥å¿—åŠŸèƒ½ã€‚æ—¥å¿—ä»£ç å¾€å¾€æ¨ªå‘åœ°æ•£å¸ƒåœ¨æ‰€æœ‰å¯¹è±¡å±‚æ¬¡ä¸­ï¼Œè€Œä¸å®ƒå¯¹åº”çš„å¯¹è±¡çš„æ ¸å¿ƒåŠŸèƒ½æ¯«æ— å…³ç³»å¯¹äºå…¶ä»–ç±»å‹çš„ä»£ç ï¼Œå¦‚å®‰å…¨æ€§ã€å¼‚å¸¸å¤„ç†å’Œé€æ˜çš„æŒç»­æ€§ä¹Ÿéƒ½æ˜¯å¦‚æ­¤ï¼Œè¿™ç§æ•£å¸ƒåœ¨å„å¤„çš„æ— å…³çš„ä»£ç è¢«ç§°ä¸ºæ¨ªåˆ‡ï¼ˆcross cuttingï¼‰ï¼Œåœ¨OOPè®¾è®¡ä¸­ï¼Œå®ƒå¯¼è‡´äº†å¤§é‡ä»£ç çš„é‡å¤ï¼Œè€Œä¸åˆ©äºå„ä¸ªæ¨¡å—çš„é‡ç”¨ã€‚

    AOPæŠ€æœ¯æ°æ°ç›¸åï¼Œå®ƒåˆ©ç”¨ä¸€ç§ç§°ä¸º"æ¨ªåˆ‡"çš„æŠ€æœ¯ï¼Œå‰–è§£å¼€å°è£…çš„å¯¹è±¡å†…éƒ¨ï¼Œå¹¶å°†é‚£äº›å½±å“äº†å¤šä¸ªç±»çš„å…¬å…±è¡Œä¸ºå°è£…åˆ°ä¸€ä¸ªå¯é‡ç”¨æ¨¡å—ï¼Œå¹¶å°†å…¶å‘½åä¸º"Aspect"ï¼Œå³åˆ‡é¢ã€‚æ‰€è°“"åˆ‡é¢"ï¼Œç®€å•è¯´å°±æ˜¯é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—ä¹‹é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ“ä½œæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

    ä½¿ç”¨AOPï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæ¥ä»£ç çš„åŸºç¡€ä¸Šæ·»åŠ æ–°åŠŸèƒ½ã€‚

2.  **AOPæ€æƒ³ä¸»è¦çš„åº”ç”¨åœºæ™¯**

    AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒé€šè¿‡å°†é€šç”¨çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ã€æƒé™æ§åˆ¶ç­‰ï¼‰ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°ã€ç®€æ´ã€æ˜“äºç»´æŠ¤ã€‚AOPå¯ä»¥åº”ç”¨äºå„ç§åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„AOPåº”ç”¨åœºæ™¯ï¼š
    1.  `æ—¥å¿—è®°å½•`ï¼šåœ¨ç³»ç»Ÿä¸­è®°å½•æ—¥å¿—æ˜¯éå¸¸é‡è¦çš„ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°æ—¥å¿—è®°å½•çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰ã€æ‰§è¡Œåæˆ–å¼‚å¸¸æŠ›å‡ºæ—¶è®°å½•æ—¥å¿—ã€‚
    2.  `äº‹åŠ¡å¤„ç†`ï¼šåœ¨æ•°æ®åº“æ“ä½œä¸­ä½¿ç”¨äº‹åŠ¡å¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•å¼€å§‹å‰å¼€å¯äº‹åŠ¡ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åæäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚
    3.  `å®‰å…¨æ§åˆ¶`ï¼šåœ¨ç³»ç»Ÿä¸­åŒ…å«æŸäº›éœ€è¦å®‰å…¨æ§åˆ¶çš„æ“ä½œï¼Œå¦‚ç™»å½•ã€ä¿®æ”¹å¯†ç ã€æˆæƒç­‰ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°å®‰å…¨æ§åˆ¶çš„åŠŸèƒ½ã€‚å¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰è¿›è¡Œæƒé™åˆ¤æ–­ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰æƒé™ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸æˆ–è½¬å‘åˆ°é”™è¯¯é¡µé¢ï¼Œä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ã€‚
    4.  `æ€§èƒ½ç›‘æ§`ï¼šåœ¨ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶éœ€è¦å¯¹æŸäº›æ–¹æ³•çš„æ€§èƒ½è¿›è¡Œç›‘æ§ï¼Œä»¥æ‰¾åˆ°ç³»ç»Ÿçš„ç“¶é¢ˆå¹¶è¿›è¡Œä¼˜åŒ–ã€‚å¯ä»¥ä½¿ç”¨AOPæ¥å®ç°æ€§èƒ½ç›‘æ§çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰è®°å½•æ—¶é—´æˆ³ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åè®¡ç®—æ–¹æ³•æ‰§è¡Œæ—¶é—´å¹¶è¾“å‡ºåˆ°æ—¥å¿—ä¸­ã€‚
    5.  `å¼‚å¸¸å¤„ç†`ï¼šç³»ç»Ÿä¸­å¯èƒ½å‡ºç°å„ç§å¼‚å¸¸æƒ…å†µï¼Œå¦‚ç©ºæŒ‡é’ˆå¼‚å¸¸ã€æ•°æ®åº“è¿æ¥å¼‚å¸¸ç­‰ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°å¼‚å¸¸å¤„ç†çš„åŠŸèƒ½ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼ˆå¦‚è®°å½•æ—¥å¿—ã€å‘é€é‚®ä»¶ç­‰ï¼‰ã€‚
    6.  `ç¼“å­˜æ§åˆ¶`ï¼šåœ¨ç³»ç»Ÿä¸­æœ‰äº›æ•°æ®å¯ä»¥ç¼“å­˜èµ·æ¥ä»¥æé«˜è®¿é—®é€Ÿåº¦ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°ç¼“å­˜æ§åˆ¶çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰æŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰åˆ™è¿”å›ï¼Œå¦åˆ™æ‰§è¡Œæ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼å­˜å…¥ç¼“å­˜ä¸­ã€‚
    7.  `åŠ¨æ€ä»£ç†`ï¼šAOPçš„å®ç°æ–¹å¼ä¹‹ä¸€æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œå¯ä»¥ä»£ç†æŸä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œç”¨äºå®ç°å„ç§åŠŸèƒ½ã€‚
        ç»¼ä¸Šæ‰€è¿°ï¼ŒAOPå¯ä»¥åº”ç”¨äºå„ç§åœºæ™¯ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†é€šç”¨çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°ã€ç®€æ´ã€æ˜“äºç»´æŠ¤ã€‚

3.  **AOPæœ¯è¯­åè¯ä»‹ç»**

    1-æ¨ªåˆ‡å…³æ³¨ç‚¹

    ä»æ¯ä¸ªæ–¹æ³•ä¸­æŠ½å–å‡ºæ¥çš„åŒä¸€ç±»éæ ¸å¿ƒä¸šåŠ¡ã€‚åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹å¯¹ç›¸å…³æ–¹æ³•è¿›è¡Œå¤šä¸ªä¸åŒæ–¹é¢çš„å¢å¼ºã€‚

    è¿™ä¸ªæ¦‚å¿µä¸æ˜¯è¯­æ³•å±‚é¢å¤©ç„¶å­˜åœ¨çš„ï¼Œè€Œæ˜¯æ ¹æ®é™„åŠ åŠŸèƒ½çš„é€»è¾‘ä¸Šçš„éœ€è¦ï¼šæœ‰åä¸ªé™„åŠ åŠŸèƒ½ï¼Œå°±æœ‰åä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/64876b20aa9aa52dbd206e36acd8f1d4.png)



    AOPæŠŠè½¯ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š`æ ¸å¿ƒå…³æ³¨ç‚¹`å’Œ`æ¨ªåˆ‡å…³æ³¨ç‚¹`ã€‚ä¸šåŠ¡å¤„ç†çš„ä¸»è¦æµç¨‹æ˜¯æ ¸å¿ƒå…³æ³¨ç‚¹ï¼Œä¸ä¹‹å…³ç³»ä¸å¤§çš„éƒ¨åˆ†æ˜¯æ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚æ¨ªåˆ‡å…³æ³¨ç‚¹çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œä»–ä»¬ç»å¸¸å‘ç”Ÿåœ¨æ ¸å¿ƒå…³æ³¨ç‚¹çš„å¤šå¤„ï¼Œè€Œå„å¤„åŸºæœ¬ç›¸ä¼¼ï¼Œæ¯”å¦‚æƒé™è®¤è¯ã€æ—¥å¿—ã€äº‹åŠ¡ã€å¼‚å¸¸ç­‰ã€‚AOPçš„ä½œç”¨åœ¨äºåˆ†ç¦»ç³»ç»Ÿä¸­çš„å„ç§å…³æ³¨ç‚¹ï¼Œå°†æ ¸å¿ƒå…³æ³¨ç‚¹å’Œæ¨ªåˆ‡å…³æ³¨ç‚¹åˆ†ç¦»å¼€æ¥ã€‚

    2-é€šçŸ¥(å¢å¼º)

    æ¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ä¸Šè¦åšçš„äº‹æƒ…éƒ½éœ€è¦å†™ä¸€ä¸ªæ–¹æ³•æ¥å®ç°ï¼Œè¿™æ ·çš„æ–¹æ³•å°±å«é€šçŸ¥æ–¹æ³•ã€‚
    -   å‰ç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•å‰æ‰§è¡Œ
    -   è¿”å›é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•æˆåŠŸç»“æŸåæ‰§è¡Œï¼ˆ**å¯¿ç»ˆæ­£å¯**ï¼‰
    -   å¼‚å¸¸é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•å¼‚å¸¸ç»“æŸåæ‰§è¡Œï¼ˆ**æ­»äºéå‘½**ï¼‰
    -   åç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•æœ€ç»ˆç»“æŸåæ‰§è¡Œï¼ˆ**ç›–æ£ºå®šè®º**ï¼‰
    -   ç¯ç»•é€šçŸ¥ï¼šä½¿ç”¨try...catch...finallyç»“æ„å›´ç»•æ•´ä¸ªè¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸Šé¢å››ç§é€šçŸ¥å¯¹åº”çš„æ‰€æœ‰ä½ç½®![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7fb04fe4b1786175790bbfffb1827823.png)


    3-è¿æ¥ç‚¹ joinpoint

    è¿™ä¹Ÿæ˜¯ä¸€ä¸ªçº¯é€»è¾‘æ¦‚å¿µï¼Œä¸æ˜¯è¯­æ³•å®šä¹‰çš„ã€‚

    æŒ‡é‚£äº›è¢«æ‹¦æˆªåˆ°çš„ç‚¹ã€‚åœ¨ Spring ä¸­ï¼Œå¯ä»¥è¢«åŠ¨æ€ä»£ç†æ‹¦æˆªç›®æ ‡ç±»çš„æ–¹æ³•![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/2825496dd4c521e78ff93b34082c8396.png)



    4-åˆ‡å…¥ç‚¹ pointcut

    å®šä½è¿æ¥ç‚¹çš„æ–¹å¼ï¼Œæˆ–è€…å¯ä»¥ç†è§£æˆè¢«é€‰ä¸­çš„è¿æ¥ç‚¹ï¼

    æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæ¯”å¦‚execution(\* com.spring.service.impl.*.*(..))ã€‚ç¬¦åˆæ¡ä»¶çš„æ¯ä¸ªæ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªå…·ä½“çš„è¿æ¥ç‚¹ã€‚

    5-åˆ‡é¢ aspect

    åˆ‡å…¥ç‚¹å’Œé€šçŸ¥çš„ç»“åˆã€‚æ˜¯ä¸€ä¸ªç±»ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ced83016f1570ae6ddd6730331329bb4.png)



    6-ç›®æ ‡ target

    è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ã€‚

    7-ä»£ç† proxy

    å‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„ä»£ç†å¯¹è±¡ã€‚

    8-ç»‡å…¥ weave

    æŒ‡æŠŠé€šçŸ¥åº”ç”¨åˆ°ç›®æ ‡ä¸Šï¼Œç”Ÿæˆä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚å¯ä»¥åœ¨ç¼–è¯‘æœŸç»‡å…¥ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡ŒæœŸç»‡å…¥ï¼ŒSpringé‡‡ç”¨åè€…ã€‚

### 5.4 Spring AOPæ¡†æ¶ä»‹ç»å’Œå…³ç³»æ¢³ç†

1.  AOPä¸€ç§åŒºåˆ«äºOOPçš„ç¼–ç¨‹æ€ç»´ï¼Œç”¨æ¥å®Œå–„å’Œè§£å†³OOPçš„éæ ¸å¿ƒä»£ç å†—ä½™å’Œä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤é—®é¢˜ï¼
2.  ä»£ç†æŠ€æœ¯ï¼ˆåŠ¨æ€ä»£ç†|é™æ€ä»£ç†ï¼‰æ˜¯å®ç°AOPæ€ç»´ç¼–ç¨‹çš„å…·ä½“æŠ€æœ¯ï¼Œä½†æ˜¯è‡ªå·±ä½¿ç”¨åŠ¨æ€ä»£ç†å®ç°ä»£ç æ¯”è¾ƒç¹çï¼
3.  Spring AOPæ¡†æ¶ï¼ŒåŸºäºAOPç¼–ç¨‹æ€ç»´ï¼Œå°è£…åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œç®€åŒ–åŠ¨æ€ä»£ç†æŠ€æœ¯å®ç°çš„æ¡†æ¶ï¼SpringAOPå†…éƒ¨å¸®åŠ©æˆ‘ä»¬å®ç°åŠ¨æ€ä»£ç†ï¼Œæˆ‘ä»¬åªéœ€å†™å°‘é‡çš„é…ç½®ï¼ŒæŒ‡å®šç”Ÿæ•ˆèŒƒå›´å³å¯,å³å¯å®Œæˆé¢å‘åˆ‡é¢æ€ç»´ç¼–ç¨‹çš„å®ç°ï¼
### 5.5 Spring AOPåŸºäºæ³¨è§£æ–¹å¼å®ç°å’Œç»†èŠ‚

#### 5.5.1 Spring AOPåº•å±‚æŠ€æœ¯ç»„æˆ

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/1b5401be5e033cd393f6e3a2a0f0c03b.png)



-   åŠ¨æ€ä»£ç†ï¼ˆInvocationHandlerï¼‰ï¼šJDKåŸç”Ÿçš„å®ç°æ–¹å¼ï¼Œéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£ã€‚å› ä¸ºè¿™ä¸ªæŠ€æœ¯è¦æ±‚ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å®ç°åŒæ ·çš„æ¥å£ï¼ˆå…„å¼Ÿä¸¤ä¸ªæ‹œæŠŠå­æ¨¡å¼ï¼‰ã€‚
-   cglibï¼šé€šè¿‡ç»§æ‰¿è¢«ä»£ç†çš„ç›®æ ‡ç±»ï¼ˆè®¤å¹²çˆ¹æ¨¡å¼ï¼‰å®ç°ä»£ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ã€‚
-   AspectJï¼šæ—©æœŸçš„AOPå®ç°çš„æ¡†æ¶ï¼ŒSpringAOPå€Ÿç”¨äº†AspectJä¸­çš„AOPæ³¨è§£ã€‚

#### 5.5.2 åˆæ­¥å®ç°

1.  åŠ å…¥ä¾èµ–
    ```xml
    <!-- spring-aspectsä¼šå¸®æˆ‘ä»¬ä¼ é€’è¿‡æ¥aspectjweaver -->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-aop</artifactId>
        <version>6.0.6</version>
    </dependency>

    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-aspects</artifactId>
        <version>6.0.6</version>
    </dependency>
    ```

- å…³äºAOPå¯¼åŒ…çš„é—®é¢˜ï¼ˆaspectjweaverå’Œspring-aspectsçš„åŒºåˆ«ï¼‰
	1. `aspectjweaver`æ˜¯AspectJçš„è¿è¡Œæ—¶åº“ï¼Œå®ƒæä¾›äº†å®ç°åˆ‡é¢ç¼–ç¨‹çš„æ ¸å¿ƒåŠŸèƒ½ã€‚AspectJæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åˆ‡é¢ç¼–ç¨‹æ¡†æ¶ï¼Œå®ƒå…è®¸åœ¨Javaåº”ç”¨ç¨‹åºä¸­å®šä¹‰å’Œåº”ç”¨åˆ‡é¢ã€‚`aspectjweaver`åº“åŒ…å«äº†AspectJçš„æ ¸å¿ƒåŠŸèƒ½å’Œè¿è¡Œæ—¶å·¥å…·ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶ç»‡å…¥å’Œæ‰§è¡Œåˆ‡é¢ä»£ç ã€‚ä½¿ç”¨AspectJï¼Œä½ å¯ä»¥å®šä¹‰åˆ‡é¢ã€åˆ‡ç‚¹å’Œé€šçŸ¥ï¼Œæ¥å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹çš„å¤„ç†ã€‚
    
	2. `spring-aspects`æ˜¯Spring Frameworkæä¾›çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒä½¿ç”¨äº†AspectJå’Œ`aspectjweaver`åº“ï¼Œå¹¶æä¾›äº†ä¸Springæ¡†æ¶é›†æˆçš„åˆ‡é¢ç¼–ç¨‹åŠŸèƒ½ã€‚`spring-aspects`æ¨¡å—ä¸ºSpringåº”ç”¨ç¨‹åºæä¾›äº†ä¸€äº›é¢„å®šä¹‰çš„åˆ‡é¢ï¼Œä¾‹å¦‚äº‹åŠ¡ç®¡ç†çš„åˆ‡é¢(`@Transactional`)å’Œå¼‚æ­¥æ‰§è¡Œçš„åˆ‡é¢(`@Async`)ç­‰ã€‚é€šè¿‡ä½¿ç”¨`spring-aspects`ï¼Œä½ å¯ä»¥å°†è¿™äº›é¢„å®šä¹‰çš„åˆ‡é¢ç›´æ¥åº”ç”¨åˆ°ä½ çš„Springåº”ç”¨ç¨‹åºä¸­ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™AspectJåˆ‡é¢ã€‚

- ç®€è€Œè¨€ä¹‹ï¼Œ`aspectjweaver`æä¾›äº†AspectJåˆ‡é¢ç¼–ç¨‹æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½å’Œè¿è¡Œæ—¶æ”¯æŒï¼Œå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ã€‚è€Œ`spring-aspects`æ˜¯Spring Frameworkçš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒé›†æˆäº†AspectJå’Œ`aspectjweaver`ï¼Œæä¾›äº†ä¸€äº›ä¸Springæ¡†æ¶é›†æˆçš„åˆ‡é¢åŠŸèƒ½ã€‚

- å¦‚æœä½ åªéœ€è¦ä½¿ç”¨AspectJçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç‹¬ç«‹äºSpring Frameworkï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨`aspectjweaver`ã€‚å¦‚æœä½ æ­£åœ¨å¼€å‘åŸºäºSpring Frameworkçš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨Springæä¾›çš„åˆ‡é¢åŠŸèƒ½ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©ä½¿ç”¨`spring-aspects`æ¨¡å—ã€‚

2.  å‡†å¤‡æ¥å£
    ```java
    public interface Calculator {
        
        int add(int i, int j);
        
        int sub(int i, int j);
        
        int mul(int i, int j);
        
        int div(int i, int j);
        
    }
    ```
3.  çº¯å‡€å®ç°ç±»
    ```java
    package com.atguigu.proxy;


    /**
     * å®ç°è®¡ç®—æ¥å£,å•çº¯æ·»åŠ  + - * / å®ç°! æºæ‚å…¶ä»–åŠŸèƒ½!
     */
    @Component
    public class CalculatorPureImpl implements Calculator {
        
        @Override
        public int add(int i, int j) {
        
            int result = i + j;
        
            return result;
        }
        
        @Override
        public int sub(int i, int j) {
        
            int result = i - j;
        
            return result;
        }
        
        @Override
        public int mul(int i, int j) {
        
            int result = i * j;
        
            return result;
        }
        
        @Override
        public int div(int i, int j) {
        
            int result = i / j;
        
            return result;
        }
    }
    ```
4.  å£°æ˜åˆ‡é¢ç±»
    ```java
    package com.atguigu.advice;

    import org.aspectj.lang.annotation.*;
    import org.springframework.stereotype.Component;

    // @Aspectè¡¨ç¤ºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»
    @Aspect
    // @Componentæ³¨è§£ä¿è¯è¿™ä¸ªåˆ‡é¢ç±»èƒ½å¤Ÿæ”¾å…¥IOCå®¹å™¨
    @Component
    public class LogAspect {
            
        // @Beforeæ³¨è§£ï¼šå£°æ˜å½“å‰æ–¹æ³•æ˜¯å‰ç½®é€šçŸ¥æ–¹æ³•
        // valueå±æ€§ï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œç”±åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ§åˆ¶å½“å‰é€šçŸ¥æ–¹æ³•è¦ä½œç”¨åœ¨å“ªä¸€ä¸ªç›®æ ‡æ–¹æ³•ä¸Š
        @Before(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogBeforeCore() {
            System.out.println("[AOPå‰ç½®é€šçŸ¥] æ–¹æ³•å¼€å§‹äº†");
        }
        
        @AfterReturning(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogAfterSuccess() {
            System.out.println("[AOPè¿”å›é€šçŸ¥] æ–¹æ³•æˆåŠŸè¿”å›äº†");
        }
        
        @AfterThrowing(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogAfterException() {
            System.out.println("[AOPå¼‚å¸¸é€šçŸ¥] æ–¹æ³•æŠ›å¼‚å¸¸äº†");
        }
        
        @After(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogFinallyEnd() {
            System.out.println("[AOPåç½®é€šçŸ¥] æ–¹æ³•æœ€ç»ˆç»“æŸäº†");
        }
        
    }
    ```
5.  å¼€å¯aspectjæ³¨è§£æ”¯æŒ
    1.  xmlæ–¹å¼
        ```xml
        <?xml version="1.0" encoding="UTF-8"?>
        <beans xmlns="http://www.springframework.org/schema/beans"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns:context="http://www.springframework.org/schema/context"
               xmlns:aop="http://www.springframework.org/schema/aop"
               xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd">

            <!-- è¿›è¡ŒåŒ…æ‰«æ-->
            <context:component-scan base-package="com.atguigu" />
            <!-- å¼€å¯aspectjæ¡†æ¶æ³¨è§£æ”¯æŒ-->
            <aop:aspectj-autoproxy />
        </beans>
        ```
    2.  é…ç½®ç±»æ–¹å¼
        ```java
        @Configuration
        @ComponentScan(basePackages = "com.atguigu")
        //ä½œç”¨ç­‰äº <aop:aspectj-autoproxy /> é…ç½®ç±»ä¸Šå¼€å¯ Aspectjæ³¨è§£æ”¯æŒ!
        @EnableAspectJAutoProxy
        public class MyConfig {
        }

        ```
6.  æµ‹è¯•æ•ˆæœ
    ```java
    //@SpringJUnitConfig(locations = "classpath:spring-aop.xml")
    @SpringJUnitConfig(value = {MyConfig.class})
    public class AopTest {

        @Autowired
        private Calculator calculator;

        @Test
        public void testCalculator(){
            calculator.add(1,1);
        }
    }

    ```
    è¾“å‡ºç»“æœï¼š
    ```java
    [AOPå‰ç½®é€šçŸ¥] æ–¹æ³•å¼€å§‹äº†
    [AOPè¿”å›é€šçŸ¥] æ–¹æ³•æˆåŠŸè¿”å›äº†
    [AOPåç½®é€šçŸ¥] æ–¹æ³•æœ€ç»ˆç»“æŸäº†
    ```

- æ³¨æ„ï¼š`@Autowiredå£°æ˜çš„æ˜¯æ¥å£ï¼Œè€Œä¸æ˜¯å®ç°ç±»`
- å› ä¸ºï¼šAOPä»£ç†æ¨¡å¼ï¼Œä½¿ç”¨jdkè¿›è¡Œæ¥å£çš„ä»£ç†ï¼Œæ‰€ä»¥å…·ä½“çš„å®ç°ç±»ï¼Œå’ŒIOCä¸­çš„ä»£ç†ç±»ä¼šå‘ç”Ÿå†²çªï¼ï¼ï¼

#### 5.5.3 è·å–é€šçŸ¥ç»†èŠ‚ä¿¡æ¯

1.  **JointPointæ¥å£**

    éœ€è¦è·å–æ–¹æ³•ç­¾åã€ä¼ å…¥çš„å®å‚ç­‰ä¿¡æ¯æ—¶ï¼Œå¯ä»¥åœ¨é€šçŸ¥æ–¹æ³•å£°æ˜JoinPointç±»å‹çš„å½¢å‚ã€‚
    -   è¦ç‚¹1ï¼šJoinPoint æ¥å£é€šè¿‡ getSignature() æ–¹æ³•è·å–ç›®æ ‡æ–¹æ³•çš„ç­¾åï¼ˆæ–¹æ³•å£°æ˜æ—¶çš„å®Œæ•´ä¿¡æ¯ï¼‰
    -   è¦ç‚¹2ï¼šé€šè¿‡ç›®æ ‡æ–¹æ³•ç­¾åå¯¹è±¡è·å–æ–¹æ³•å
    -   è¦ç‚¹3ï¼šé€šè¿‡ JoinPoint å¯¹è±¡è·å–å¤–ç•Œè°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ä¼ å…¥çš„å®å‚åˆ—è¡¨ç»„æˆçš„æ•°ç»„![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b21e810f3c9ec7a8bfe98f9dc5f05c29.png)


    ```java
    // @Beforeæ³¨è§£æ ‡è®°å‰ç½®é€šçŸ¥æ–¹æ³•
    // valueå±æ€§ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œå‘Šè¯‰Springå½“å‰é€šçŸ¥æ–¹æ³•è¦å¥—ç”¨åˆ°å“ªä¸ªç›®æ ‡æ–¹æ³•ä¸Š
    // åœ¨å‰ç½®é€šçŸ¥æ–¹æ³•å½¢å‚ä½ç½®å£°æ˜ä¸€ä¸ªJoinPointç±»å‹çš„å‚æ•°ï¼ŒSpringå°±ä¼šå°†è¿™ä¸ªå¯¹è±¡ä¼ å…¥
    // æ ¹æ®JoinPointå¯¹è±¡å°±å¯ä»¥è·å–ç›®æ ‡æ–¹æ³•åç§°ã€å®é™…å‚æ•°åˆ—è¡¨
    @Before(value = "execution(public int com.atguigu.aop.api.Calculator.add(int,int))")
    public void printLogBeforeCore(JoinPoint joinPoint) {
        
        // 1.é€šè¿‡JoinPointå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•ç­¾åå¯¹è±¡
        // æ–¹æ³•çš„ç­¾åï¼šä¸€ä¸ªæ–¹æ³•çš„å…¨éƒ¨å£°æ˜ä¿¡æ¯
        Signature signature = joinPoint.getSignature();
        
        // 2.é€šè¿‡æ–¹æ³•çš„ç­¾åå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯
        String methodName = signature.getName();
        System.out.println("methodName = " + methodName);
        
        int modifiers = signature.getModifiers();
        System.out.println("modifiers = " + modifiers);
        
        String declaringTypeName = signature.getDeclaringTypeName();
        System.out.println("declaringTypeName = " + declaringTypeName);
        
        // 3.é€šè¿‡JoinPointå¯¹è±¡è·å–å¤–ç•Œè°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ä¼ å…¥çš„å®å‚åˆ—è¡¨
        Object[] args = joinPoint.getArgs();
        
        // 4.ç”±äºæ•°ç»„ç›´æ¥æ‰“å°çœ‹ä¸åˆ°å…·ä½“æ•°æ®ï¼Œæ‰€ä»¥è½¬æ¢ä¸ºListé›†åˆ
        List<Object> argList = Arrays.asList(args);
        
        System.out.println("[AOPå‰ç½®é€šçŸ¥] " + methodName + "æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°åˆ—è¡¨ï¼š" + argList);
    }
    ```
2.  **æ–¹æ³•è¿”å›å€¼**

    åœ¨è¿”å›é€šçŸ¥ä¸­ï¼Œé€šè¿‡ **@AfterReturning**æ³¨è§£çš„returningå±æ€§è·å–ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ï¼
    ```java
    // @AfterReturningæ³¨è§£æ ‡è®°è¿”å›é€šçŸ¥æ–¹æ³•
    // åœ¨è¿”å›é€šçŸ¥ä¸­è·å–ç›®æ ‡æ–¹æ³•è¿”å›å€¼åˆ†ä¸¤æ­¥ï¼š
    // ç¬¬ä¸€æ­¥ï¼šåœ¨@AfterReturningæ³¨è§£ä¸­é€šè¿‡returningå±æ€§è®¾ç½®ä¸€ä¸ªåç§°
    // ç¬¬äºŒæ­¥ï¼šä½¿ç”¨returningå±æ€§è®¾ç½®çš„åç§°åœ¨é€šçŸ¥æ–¹æ³•ä¸­å£°æ˜ä¸€ä¸ªå¯¹åº”çš„å½¢å‚
    @AfterReturning(
            value = "execution(public int com.atguigu.aop.api.Calculator.add(int,int))",
            returning = "targetMethodReturnValue"
    )
    public void printLogAfterCoreSuccess(JoinPoint joinPoint, Object targetMethodReturnValue) {
        
        String methodName = joinPoint.getSignature().getName();
        
        System.out.println("[AOPè¿”å›é€šçŸ¥] "+methodName+"æ–¹æ³•æˆåŠŸç»“æŸäº†ï¼Œè¿”å›å€¼æ˜¯ï¼š" + targetMethodReturnValue);
    }
    ```
3.  **å¼‚å¸¸å¯¹è±¡æ•æ‰**

    åœ¨å¼‚å¸¸é€šçŸ¥ä¸­ï¼Œé€šè¿‡@AfterThrowingæ³¨è§£çš„throwingå±æ€§è·å–ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡
    ```java
    // @AfterThrowingæ³¨è§£æ ‡è®°å¼‚å¸¸é€šçŸ¥æ–¹æ³•
    // åœ¨å¼‚å¸¸é€šçŸ¥ä¸­è·å–ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸åˆ†ä¸¤æ­¥ï¼š
    // ç¬¬ä¸€æ­¥ï¼šåœ¨@AfterThrowingæ³¨è§£ä¸­å£°æ˜ä¸€ä¸ªthrowingå±æ€§è®¾å®šå½¢å‚åç§°
    // ç¬¬äºŒæ­¥ï¼šä½¿ç”¨throwingå±æ€§æŒ‡å®šçš„åç§°åœ¨é€šçŸ¥æ–¹æ³•å£°æ˜å½¢å‚ï¼ŒSpringä¼šå°†ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡ä»è¿™é‡Œä¼ ç»™æˆ‘ä»¬
    @AfterThrowing(
            value = "execution(public int com.atguigu.aop.api.Calculator.add(int,int))",
            throwing = "targetMethodException"
    )
    public void printLogAfterCoreException(JoinPoint joinPoint, Throwable targetMethodException) {
        
        String methodName = joinPoint.getSignature().getName();
        
        System.out.println("[AOPå¼‚å¸¸é€šçŸ¥] "+methodName+"æ–¹æ³•æŠ›å¼‚å¸¸äº†ï¼Œå¼‚å¸¸ç±»å‹æ˜¯ï¼š" + targetMethodException.getClass().getName());
    }
    ```

#### 5.5.4 åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•

1.  **åˆ‡ç‚¹è¡¨è¾¾å¼ä½œç”¨**

    AOPåˆ‡ç‚¹è¡¨è¾¾å¼ï¼ˆPointcut Expressionï¼‰æ˜¯ä¸€ç§ç”¨äºæŒ‡å®šåˆ‡ç‚¹çš„è¯­è¨€ï¼Œå®ƒå¯ä»¥é€šè¿‡å®šä¹‰åŒ¹é…è§„åˆ™ï¼Œæ¥é€‰æ‹©éœ€è¦è¢«åˆ‡å…¥çš„ç›®æ ‡å¯¹è±¡ã€‚
    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/dcc7d03cd316a79c950bf2007f92350a.png)


2.  **åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•**

    åˆ‡ç‚¹è¡¨è¾¾å¼æ€»ç»“
    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/77a50f560c8e82530b5f56294469597b.png)



    è¯­æ³•ç»†èŠ‚
    -   ç¬¬ä¸€ä½ï¼šexecution( ) å›ºå®šå¼€å¤´
    -   ç¬¬äºŒä½ï¼šæ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦
        ```java
        public private ç›´æ¥æè¿°å¯¹åº”ä¿®é¥°ç¬¦å³å¯
        ```
    -   ç¬¬ä¸‰ä½ï¼šæ–¹æ³•è¿”å›å€¼
        ```java
        int String void ç›´æ¥æè¿°è¿”å›å€¼ç±»å‹

        ```
        æ³¨æ„ï¼š

        ç‰¹æ®Šæƒ…å†µÂ ä¸è€ƒè™‘Â è®¿é—®ä¿®é¥°ç¬¦å’Œè¿”å›å€¼

        execution(\*Â \*Â )Â è¿™æ˜¯é”™è¯¯è¯­æ³•

        execution( \*) == ä½ åªè¦è€ƒè™‘è¿”å›å€¼ æˆ–è€… ä¸è€ƒè™‘è®¿é—®ä¿®é¥°ç¬¦ ç›¸å½“äºå…¨éƒ¨ä¸è€ƒè™‘äº†
    -   ç¬¬å››ä½ï¼šæŒ‡å®šåŒ…çš„åœ°å€
        ```java
         å›ºå®šçš„åŒ…: com.atguigu.api | service | dao
         å•å±‚çš„ä»»æ„å‘½å: com.atguigu.*  = com.atguigu.api  com.atguigu.dao  * = ä»»æ„ä¸€å±‚çš„ä»»æ„å‘½å
         ä»»æ„å±‚ä»»æ„å‘½å: com.. = com.atguigu.api.erdaye com.a.a.a.a.a.a.a  ..ä»»æ„å±‚,ä»»æ„å‘½å ç”¨åœ¨åŒ…ä¸Š!
         æ³¨æ„: ..ä¸èƒ½ç”¨ä½œåŒ…å¼€å¤´   public int .. é”™è¯¯è¯­æ³•  com..
         æ‰¾åˆ°ä»»ä½•åŒ…ä¸‹: *..
        ```
    -   ç¬¬äº”ä½ï¼šæŒ‡å®šç±»åç§°
        ```java
        å›ºå®šåç§°: UserService
        ä»»æ„ç±»å: *
        éƒ¨åˆ†ä»»æ„: com..service.impl.*Impl
        ä»»æ„åŒ…ä»»æ„ç±»: *..*

        ```
    -   ç¬¬å…­ä½ï¼šæŒ‡å®šæ–¹æ³•åç§°
        ```java
        è¯­æ³•å’Œç±»åä¸€è‡´
        ä»»æ„è®¿é—®ä¿®é¥°ç¬¦,ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•: * *..*.*
        ```
    -   ç¬¬ä¸ƒä½ï¼šæ–¹æ³•å‚æ•°
        ```java
        ç¬¬ä¸ƒä½: æ–¹æ³•çš„å‚æ•°æè¿°
               å…·ä½“å€¼: (String,int) != (int,String) æ²¡æœ‰å‚æ•° ()
               æ¨¡ç³Šå€¼: ä»»æ„å‚æ•° æœ‰ æˆ–è€… æ²¡æœ‰ (..)  ..ä»»æ„å‚æ•°çš„æ„è¯†
               éƒ¨åˆ†å…·ä½“å’Œæ¨¡ç³Š:
                 ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²çš„æ–¹æ³• (String..)
                 æœ€åä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸² (..String)
                 å­—ç¬¦ä¸²å¼€å¤´,intç»“å°¾ (String..int)
                 åŒ…å«intç±»å‹(..int..)
        ```
3.  **åˆ‡ç‚¹è¡¨è¾¾å¼æ¡ˆä¾‹**
    ```java
    1.æŸ¥è¯¢æŸåŒ…æŸç±»ä¸‹ï¼Œè®¿é—®ä¿®é¥°ç¬¦æ˜¯å…¬æœ‰ï¼Œè¿”å›å€¼æ˜¯intçš„å…¨éƒ¨æ–¹æ³•
    public int xx.xx.jj.*(..)
    2.æŸ¥è¯¢æŸåŒ…ä¸‹ç±»ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Stringçš„æ–¹æ³•
    * xx.xx.jj.*(String..)
    3.æŸ¥è¯¢å…¨éƒ¨åŒ…ä¸‹ï¼Œæ— å‚æ•°çš„æ–¹æ³•ï¼
    * *..*()
    4.æŸ¥è¯¢comåŒ…ä¸‹ï¼Œä»¥intå‚æ•°ç±»å‹ç»“å°¾çš„æ–¹æ³•
    * com..*.*(..int)
    5.æŸ¥è¯¢æŒ‡å®šåŒ…ä¸‹ï¼ŒServiceå¼€å¤´ç±»çš„ç§æœ‰è¿”å›å€¼intçš„æ— å‚æ•°æ–¹æ³•
    private int xx.xx.Service*.*()
    ```
#### 5.5.5 é‡ç”¨ï¼ˆæå–ï¼‰åˆ‡ç‚¹è¡¨è¾¾å¼

1.  é‡ç”¨åˆ‡ç‚¹è¡¨è¾¾å¼ä¼˜ç‚¹
    ```java
     // @Beforeæ³¨è§£ï¼šå£°æ˜å½“å‰æ–¹æ³•æ˜¯å‰ç½®é€šçŸ¥æ–¹æ³•
    // valueå±æ€§ï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œç”±åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ§åˆ¶å½“å‰é€šçŸ¥æ–¹æ³•è¦ä½œç”¨åœ¨å“ªä¸€ä¸ªç›®æ ‡æ–¹æ³•ä¸Š
    @Before(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogBeforeCore() {
        System.out.println("[AOPå‰ç½®é€šçŸ¥] æ–¹æ³•å¼€å§‹äº†");
    }

    @AfterReturning(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogAfterSuccess() {
        System.out.println("[AOPè¿”å›é€šçŸ¥] æ–¹æ³•æˆåŠŸè¿”å›äº†");
    }

    @AfterThrowing(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogAfterException() {
        System.out.println("[AOPå¼‚å¸¸é€šçŸ¥] æ–¹æ³•æŠ›å¼‚å¸¸äº†");
    }

    @After(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogFinallyEnd() {
        System.out.println("[AOPåç½®é€šçŸ¥] æ–¹æ³•æœ€ç»ˆç»“æŸäº†");
    }
    ```
    ä¸Šé¢æ¡ˆä¾‹ï¼Œæ˜¯æˆ‘ä»¬ä¹‹å‰ç¼–å†™åˆ‡ç‚¹è¡¨è¾¾å¼çš„æ–¹å¼ï¼Œå‘ç°ï¼Œ æ‰€æœ‰å¢å¼ºæ–¹æ³•çš„åˆ‡ç‚¹è¡¨è¾¾å¼ç›¸åŒï¼

    å‡ºç°äº†å†—ä½™ï¼Œå¦‚æœéœ€è¦åˆ‡æ¢ä¹Ÿä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤ï¼

    æˆ‘ä»¬å¯ä»¥å°†åˆ‡ç‚¹æå–ï¼Œåœ¨å¢å¼ºä¸Šè¿›è¡Œå¼•ç”¨å³å¯ï¼

2.  åŒä¸€ç±»å†…éƒ¨å¼•ç”¨

    æå–
    ```java
    // åˆ‡å…¥ç‚¹è¡¨è¾¾å¼é‡ç”¨
    @Pointcut("execution(public int com.atguigu.aop.api.Calculator.add(int,int)))")
    public void declarPointCut() {}
    ```
    æ³¨æ„ï¼šæå–åˆ‡ç‚¹æ³¨è§£ä½¿ç”¨@Pointcut(åˆ‡ç‚¹è¡¨è¾¾å¼) ï¼Œ éœ€è¦æ·»åŠ åˆ°ä¸€ä¸ªæ— å‚æ•°æ— è¿”å›å€¼æ–¹æ³•ä¸Šå³å¯ï¼

    å¼•ç”¨
    ```java
    @Before(value = "declarPointCut()")
    public void printLogBeforeCoreOperation(JoinPoint joinPoint) {
    ```
3.  ä¸åŒç±»ä¸­å¼•ç”¨

    ä¸åŒç±»åœ¨å¼•ç”¨åˆ‡ç‚¹ï¼Œåªéœ€è¦æ·»åŠ ç±»çš„å…¨é™å®šç¬¦+æ–¹æ³•åå³å¯ï¼
    ```java
    @Before(value = "com.atguigu.spring.aop.aspect.LogAspect.declarPointCut()")
    public Object roundAdvice(ProceedingJoinPoint joinPoint) {
    ```
4.  åˆ‡ç‚¹ç»Ÿä¸€ç®¡ç†

    å»ºè®®ï¼šå°†åˆ‡ç‚¹è¡¨è¾¾å¼ç»Ÿä¸€å­˜å‚¨åˆ°ä¸€ä¸ªç±»ä¸­è¿›è¡Œé›†ä¸­ç®¡ç†å’Œç»´æŠ¤ï¼
    è¿™æ ·çš„è¯ï¼Œåœ¨å…¶ä»–é€šçŸ¥ç±»ï¼Œéœ€è¦å¼•ç”¨åˆ‡å…¥ç‚¹çš„æ—¶å€™ï¼Œéœ€è¦å†™å‡ºåˆ‡å…¥ç‚¹çš„å…¨ç±»å
    ```java
    @Component
    public class AtguiguPointCut {
        
        @Pointcut(value = "execution(public int *..Calculator.sub(int,int))")
        public void atguiguGlobalPointCut(){}
        
        @Pointcut(value = "execution(public int *..Calculator.add(int,int))")
        public void atguiguSecondPointCut(){}
        
        @Pointcut(value = "execution(* *..*Service.*(..))")
        public void transactionPointCut(){}
    }
    ```

#### 5.5.6 ç¯ç»•é€šçŸ¥

ç¯ç»•é€šçŸ¥å¯¹åº”æ•´ä¸ª try...catch...finally ç»“æ„ï¼ŒåŒ…æ‹¬å‰é¢å››ç§é€šçŸ¥çš„æ‰€æœ‰åŠŸèƒ½ã€‚

```java
// ä½¿ç”¨@Aroundæ³¨è§£æ ‡æ˜ç¯ç»•é€šçŸ¥æ–¹æ³•
@Around(value = "com.atguigu.aop.aspect.AtguiguPointCut.transactionPointCut()")
public Object manageTransaction(
    
        // é€šè¿‡åœ¨é€šçŸ¥æ–¹æ³•å½¢å‚ä½ç½®å£°æ˜ProceedingJoinPointç±»å‹çš„å½¢å‚ï¼Œ
        // Springä¼šå°†è¿™ä¸ªç±»å‹çš„å¯¹è±¡ä¼ ç»™æˆ‘ä»¬
        ProceedingJoinPoint joinPoint) {
    
    // é€šè¿‡ProceedingJoinPointå¯¹è±¡è·å–å¤–ç•Œè°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ä¼ å…¥çš„å®å‚æ•°ç»„
    Object[] args = joinPoint.getArgs();
    
    // é€šè¿‡ProceedingJoinPointå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•çš„ç­¾åå¯¹è±¡
    Signature signature = joinPoint.getSignature();
    
    // é€šè¿‡ç­¾åå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•çš„æ–¹æ³•å
    String methodName = signature.getName();
    
    // å£°æ˜å˜é‡ç”¨æ¥å­˜å‚¨ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼
    Object targetMethodReturnValue = null;
    
    try {
    
        // åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰ï¼šå¼€å¯äº‹åŠ¡ï¼ˆæ¨¡æ‹Ÿï¼‰
        log.debug("[AOP ç¯ç»•é€šçŸ¥] å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•åï¼š" + methodName + "ï¼Œå‚æ•°åˆ—è¡¨ï¼š" + Arrays.asList(args));
    
        // è¿‡ProceedingJoinPointå¯¹è±¡è°ƒç”¨ç›®æ ‡æ–¹æ³•
        // ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ä¸€å®šè¦è¿”å›ç»™å¤–ç•Œè°ƒç”¨è€…
        targetMethodReturnValue = joinPoint.proceed(args);
    
        // åœ¨ç›®æ ‡æ–¹æ³•æˆåŠŸè¿”å›åï¼šæäº¤äº‹åŠ¡ï¼ˆæ¨¡æ‹Ÿï¼‰
        log.debug("[AOP ç¯ç»•é€šçŸ¥] æäº¤äº‹åŠ¡ï¼Œæ–¹æ³•åï¼š" + methodName + "ï¼Œæ–¹æ³•è¿”å›å€¼ï¼š" + targetMethodReturnValue);
    
    }catch (Throwable e){
    
        // åœ¨ç›®æ ‡æ–¹æ³•æŠ›å¼‚å¸¸åï¼šå›æ»šäº‹åŠ¡ï¼ˆæ¨¡æ‹Ÿï¼‰
        log.debug("[AOP ç¯ç»•é€šçŸ¥] å›æ»šäº‹åŠ¡ï¼Œæ–¹æ³•åï¼š" + methodName + "ï¼Œå¼‚å¸¸ï¼š" + e.getClass().getName());
    
    }finally {
    
        // åœ¨ç›®æ ‡æ–¹æ³•æœ€ç»ˆç»“æŸåï¼šé‡Šæ”¾æ•°æ®åº“è¿æ¥
        log.debug("[AOP ç¯ç»•é€šçŸ¥] é‡Šæ”¾æ•°æ®åº“è¿æ¥ï¼Œæ–¹æ³•åï¼š" + methodName);
    
    }
    
    return targetMethodReturnValue;
}
```

#### 5.5.7 åˆ‡é¢ä¼˜å…ˆçº§è®¾ç½®

ç›¸åŒç›®æ ‡æ–¹æ³•ä¸ŠåŒæ—¶å­˜åœ¨å¤šä¸ªåˆ‡é¢æ—¶ï¼Œåˆ‡é¢çš„ä¼˜å…ˆçº§æ§åˆ¶åˆ‡é¢çš„å†…å¤–åµŒå¥—é¡ºåºã€‚

-   ä¼˜å…ˆçº§é«˜çš„åˆ‡é¢ï¼šå¤–é¢
-   ä¼˜å…ˆçº§ä½çš„åˆ‡é¢ï¼šé‡Œé¢

`ä½¿ç”¨ @Order æ³¨è§£å¯ä»¥æ§åˆ¶åˆ‡é¢çš„ä¼˜å…ˆçº§ï¼š`
`orderæ³¨è§£ä½œç”¨äºé€šçŸ¥ç±»ä¸Š`
-   @Order(è¾ƒå°çš„æ•°)ï¼šä¼˜å…ˆçº§é«˜
-   @Order(è¾ƒå¤§çš„æ•°)ï¼šä¼˜å…ˆçº§ä½

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/04a2e03c2c3a070e1000c3ef23c82771.png)



å®é™…æ„ä¹‰

`å®é™…å¼€å‘æ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªåˆ‡é¢åµŒå¥—çš„æƒ…å†µï¼Œè¦æ…é‡è€ƒè™‘`ã€‚ä¾‹å¦‚ï¼šå¦‚æœäº‹åŠ¡åˆ‡é¢ä¼˜å…ˆçº§é«˜ï¼Œé‚£ä¹ˆåœ¨ç¼“å­˜ä¸­å‘½ä¸­æ•°æ®çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åˆ‡é¢çš„æ“ä½œéƒ½æµªè´¹äº†ã€‚
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/9ecdc5970d0e1f646d51a08a0bed27a4.png)



æ­¤æ—¶åº”è¯¥å°†ç¼“å­˜åˆ‡é¢çš„ä¼˜å…ˆçº§æé«˜ï¼Œåœ¨äº‹åŠ¡æ“ä½œä¹‹å‰å…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç›®æ ‡æ•°æ®ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/015d67186cedc60c94dbd62b598e3d6e.png)



#### 5.5.8 CGLibåŠ¨æ€ä»£ç†ç”Ÿæ•ˆ

åœ¨ç›®æ ‡ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£çš„æƒ…å†µä¸‹ï¼ŒSpringä¼šè‡ªåŠ¨ä½¿ç”¨cglibæŠ€æœ¯å®ç°ä»£ç†ã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åšä¸‹é¢çš„æµ‹è¯•ï¼š

```java
@Service
public class EmployeeService {
    
    public void getEmpList() {
       System.out.print("æ–¹æ³•å†…éƒ¨ com.atguigu.aop.imp.EmployeeService.getEmpList");
    }
}
```

æµ‹è¯•ï¼š

```java
  @Autowired
  private EmployeeService employeeService;
  
  @Test
  public void testNoInterfaceProxy() {
      employeeService.getEmpList();
  }
```

æ²¡æœ‰æ¥å£ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3a2916c0106b3664169acdf6ebf4c596.png)



æœ‰æ¥å£ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/519f273ff88bee5bb7fece281db2b570.png)



ä½¿ç”¨æ€»ç»“ï¼š

a.  å¦‚æœç›®æ ‡ç±»æœ‰æ¥å£,é€‰æ‹©ä½¿ç”¨jdkåŠ¨æ€ä»£ç†
b.  å¦‚æœç›®æ ‡ç±»æ²¡æœ‰æ¥å£,é€‰æ‹©cglibåŠ¨æ€ä»£ç†
c.  å¦‚æœæœ‰æ¥å£,æ¥å£æ¥å€¼
d.  å¦‚æœæ²¡æœ‰æ¥å£,ç±»è¿›è¡Œæ¥å€¼

#### 5.5.9 æ³¨è§£å®ç°å°ç»“

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/f2cdd3ac4e6ab93b0e9f3fb6b7c2271f.png)

### 5.6 Spring AOPåŸºäºXMLæ–¹å¼å®ç°(äº†è§£)

1.  å‡†å¤‡å·¥ä½œ
    åŠ å…¥ä¾èµ–
    å’ŒåŸºäºæ³¨è§£çš„ AOP æ—¶ä¸€æ ·ã€‚
    å‡†å¤‡ä»£ç 
    æŠŠæµ‹è¯•åŸºäºæ³¨è§£åŠŸèƒ½æ—¶çš„Javaç±»å¤åˆ¶åˆ°æ–°moduleä¸­ï¼Œå»é™¤æ‰€æœ‰æ³¨è§£ã€‚
2.  é…ç½®Springé…ç½®æ–‡ä»¶
    ```xml
    <!-- é…ç½®ç›®æ ‡ç±»çš„bean -->
    <bean id="calculatorPure" class="com.atguigu.aop.imp.CalculatorPureImpl"/>
        
    <!-- é…ç½®åˆ‡é¢ç±»çš„bean -->
    <bean id="logAspect" class="com.atguigu.aop.aspect.LogAspect"/>
        
    <!-- é…ç½®AOP -->
    <aop:config>
        
        <!-- é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ -->
        <aop:pointcut id="logPointCut" expression="execution(* *..*.*(..))"/>
        
        <!-- aop:aspectæ ‡ç­¾ï¼šé…ç½®åˆ‡é¢ -->
        <!-- refå±æ€§ï¼šå…³è”åˆ‡é¢ç±»çš„bean -->
        <aop:aspect ref="logAspect">
            <!-- aop:beforeæ ‡ç­¾ï¼šé…ç½®å‰ç½®é€šçŸ¥ -->
            <!-- methodå±æ€§ï¼šæŒ‡å®šå‰ç½®é€šçŸ¥çš„æ–¹æ³•å -->
            <!-- pointcut-refå±æ€§ï¼šå¼•ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ -->
            <aop:before method="printLogBeforeCore" pointcut-ref="logPointCut"/>
        
            <!-- aop:after-returningæ ‡ç­¾ï¼šé…ç½®è¿”å›é€šçŸ¥ -->
            <!-- returningå±æ€§ï¼šæŒ‡å®šé€šçŸ¥æ–¹æ³•ä¸­ç”¨æ¥æ¥æ”¶ç›®æ ‡æ–¹æ³•è¿”å›å€¼çš„å‚æ•°å -->
            <aop:after-returning
                    method="printLogAfterCoreSuccess"
                    pointcut-ref="logPointCut"
                    returning="targetMethodReturnValue"/>
        
            <!-- aop:after-throwingæ ‡ç­¾ï¼šé…ç½®å¼‚å¸¸é€šçŸ¥ -->
            <!-- throwingå±æ€§ï¼šæŒ‡å®šé€šçŸ¥æ–¹æ³•ä¸­ç”¨æ¥æ¥æ”¶ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„å¼‚å¸¸å¯¹è±¡çš„å‚æ•°å -->
            <aop:after-throwing
                    method="printLogAfterCoreException"
                    pointcut-ref="logPointCut"
                    throwing="targetMethodException"/>
        
            <!-- aop:afteræ ‡ç­¾ï¼šé…ç½®åç½®é€šçŸ¥ -->
            <aop:after method="printLogCoreFinallyEnd" pointcut-ref="logPointCut"/>
        
            <!-- aop:aroundæ ‡ç­¾ï¼šé…ç½®ç¯ç»•é€šçŸ¥ -->
            <!--<aop:around method="â€¦â€¦" pointcut-ref="logPointCut"/>-->
        </aop:aspect>
        
    </aop:config>

    ```
3.  æµ‹è¯•
    ```java
    @SpringJUnitConfig(locations = "classpath:spring-aop.xml")
    public class AopTest {

        @Autowired
        private Calculator calculator;

        @Test
        public void testCalculator(){
            System.out.println(calculator);
            calculator.add(1,1);
        }
    }
    ```

### 5.7 Spring AOPå¯¹è·å–Beançš„å½±å“ç†è§£

#### 5.7.1 æ ¹æ®ç±»å‹è£…é… bean

1.  æƒ…æ™¯ä¸€
    -   bean å¯¹åº”çš„ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£
    -   æ ¹æ® bean æœ¬èº«çš„ç±»å‹è·å– bean
        -   æµ‹è¯•ï¼šIOCå®¹å™¨ä¸­åŒç±»å‹çš„ bean åªæœ‰ä¸€ä¸ª
	            æ­£å¸¸è·å–åˆ° IOC å®¹å™¨ä¸­çš„é‚£ä¸ª bean å¯¹è±¡
        -   æµ‹è¯•ï¼šIOC å®¹å™¨ä¸­åŒç±»å‹çš„ bean æœ‰å¤šä¸ª
	            ä¼šæŠ›å‡º NoUniqueBeanDefinitionException å¼‚å¸¸ï¼Œè¡¨ç¤º IOC å®¹å™¨ä¸­è¿™ä¸ªç±»å‹çš„ bean æœ‰å¤šä¸ª

2.  æƒ…æ™¯äºŒ
    -   bean å¯¹åº”çš„ç±»å®ç°äº†æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¹Ÿåªæœ‰è¿™ä¸€ä¸ªå®ç°ç±»
        -   æµ‹è¯•ï¼šæ ¹æ®æ¥å£ç±»å‹è·å– bean
        -   æµ‹è¯•ï¼šæ ¹æ®ç±»è·å– bean
        -   ç»“è®ºï¼šä¸Šé¢ä¸¤ç§æƒ…å†µå…¶å®éƒ½èƒ½å¤Ÿæ­£å¸¸è·å–åˆ° beanï¼Œè€Œä¸”æ˜¯åŒä¸€ä¸ªå¯¹è±¡

3.  æƒ…æ™¯ä¸‰
    -   å£°æ˜ä¸€ä¸ªæ¥å£
    -   æ¥å£æœ‰å¤šä¸ªå®ç°ç±»
    -   æ¥å£æ‰€æœ‰å®ç°ç±»éƒ½æ”¾å…¥ IOC å®¹å™¨
        -   æµ‹è¯•ï¼šæ ¹æ®æ¥å£ç±»å‹è·å– bean
	            ä¼šæŠ›å‡º NoUniqueBeanDefinitionException å¼‚å¸¸ï¼Œè¡¨ç¤º IOC å®¹å™¨ä¸­è¿™ä¸ªç±»å‹çš„ bean æœ‰å¤šä¸ª
        -   æµ‹è¯•ï¼šæ ¹æ®ç±»è·å–bean
	            æ­£å¸¸

4.  æƒ…æ™¯å››
    -   å£°æ˜ä¸€ä¸ªæ¥å£
    -   æ¥å£æœ‰ä¸€ä¸ªå®ç°ç±»
    -   åˆ›å»ºä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå¯¹ä¸Šé¢æ¥å£çš„å®ç°ç±»åº”ç”¨é€šçŸ¥
        -   æµ‹è¯•ï¼šæ ¹æ®æ¥å£ç±»å‹è·å–bean
	            æ­£å¸¸
        -   æµ‹è¯•ï¼šæ ¹æ®å®ç°ç±»è·å–bean
	            æ— æ³•è·å–
	            åŸå› åˆ†æï¼š
		    -   åº”ç”¨äº†åˆ‡é¢åï¼ŒçœŸæ­£æ”¾åœ¨IOCå®¹å™¨ä¸­çš„æ˜¯ä»£ç†ç±»çš„å¯¹è±¡
		    -   ç›®æ ‡ç±»å¹¶æ²¡æœ‰è¢«æ”¾åˆ°IOCå®¹å™¨ä¸­ï¼Œæ‰€ä»¥æ ¹æ®ç›®æ ‡ç±»çš„ç±»å‹ä»IOCå®¹å™¨ä¸­æ˜¯æ‰¾ä¸åˆ°çš„

        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/030dd650475cb3c80042ec171684c3f5.png)


5.  æƒ…æ™¯äº”
    -   å£°æ˜ä¸€ä¸ªç±»
    -   åˆ›å»ºä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå¯¹ä¸Šé¢çš„ç±»åº”ç”¨é€šçŸ¥
        -   æµ‹è¯•ï¼šæ ¹æ®ç±»è·å– beanï¼Œèƒ½è·å–åˆ°
            ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0018e1e556ceecc8e00c71a3ddd680a8.png)


        debugæŸ¥çœ‹å®é™…ç±»å‹ï¼š

        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8b8e6f2627bcab0eefc8a83c813f247b.png)



#### 5.7.2 ä½¿ç”¨æ€»ç»“

å¯¹å®ç°äº†æ¥å£çš„ç±»åº”ç”¨åˆ‡é¢![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7cdc0cdbbe9552e825a4c984a4a681bc.png)

å¯¹æ²¡å®ç°æ¥å£çš„ç±»åº”ç”¨åˆ‡é¢new![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b0a966e9c142c014379e426db5f1ee7b.png)



**å¦‚æœä½¿ç”¨AOPæŠ€æœ¯ï¼Œç›®æ ‡ç±»æœ‰æ¥å£ï¼Œå¿…é¡»ä½¿ç”¨æ¥å£ç±»å‹æ¥æ”¶IoCå®¹å™¨ä¸­ä»£ç†ç»„ä»¶ï¼**

## 6 Spring å£°æ˜å¼äº‹åŠ¡

### 6.1 å£°æ˜å¼äº‹åŠ¡æ¦‚å¿µ

#### 6.1.1 ç¼–ç¨‹å¼äº‹åŠ¡

ç¼–ç¨‹å¼äº‹åŠ¡æ˜¯æŒ‡æ‰‹åŠ¨ç¼–å†™ç¨‹åºæ¥ç®¡ç†äº‹åŠ¡ï¼Œå³é€šè¿‡ç¼–å†™ä»£ç çš„æ–¹å¼ç›´æ¥æ§åˆ¶äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚åœ¨ Java ä¸­ï¼Œé€šå¸¸ä½¿ç”¨äº‹åŠ¡ç®¡ç†å™¨(å¦‚ Spring ä¸­çš„`PlatformTransactionManager`)æ¥å®ç°ç¼–ç¨‹å¼äº‹åŠ¡ã€‚

ç¼–ç¨‹å¼äº‹åŠ¡çš„ä¸»è¦ä¼˜ç‚¹æ˜¯çµæ´»æ€§é«˜ï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚æ¥æ§åˆ¶äº‹åŠ¡çš„ç²’åº¦ã€æ¨¡å¼ç­‰ç­‰ã€‚ä½†æ˜¯ï¼Œç¼–å†™å¤§é‡çš„äº‹åŠ¡æ§åˆ¶ä»£ç å®¹æ˜“å‡ºç°é—®é¢˜ï¼Œå¯¹ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æœ‰ä¸€å®šå½±å“ã€‚

```java
Connection conn = ...;
  
try {
    // å¼€å¯äº‹åŠ¡ï¼šå…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤
    conn.setAutoCommit(false);
    // æ ¸å¿ƒæ“ä½œ
    // ä¸šåŠ¡ä»£ç 
    // æäº¤äº‹åŠ¡
    conn.commit();
  
}catch(Exception e){
  
    // å›æ»šäº‹åŠ¡
    conn.rollBack();
  
}finally{
  
    // é‡Šæ”¾æ•°æ®åº“è¿æ¥
    conn.close();
  
}
```

`ç¼–ç¨‹å¼çš„å®ç°æ–¹å¼å­˜åœ¨ç¼ºé™·`ï¼š

-   `ç»†èŠ‚æ²¡æœ‰è¢«å±è”½`ï¼šå…·ä½“æ“ä½œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰ç»†èŠ‚éƒ½éœ€è¦ç¨‹åºå‘˜è‡ªå·±æ¥å®Œæˆï¼Œæ¯”è¾ƒç¹çã€‚
-   `ä»£ç å¤ç”¨æ€§ä¸é«˜`ï¼šå¦‚æœæ²¡æœ‰æœ‰æ•ˆæŠ½å–å‡ºæ¥ï¼Œæ¯æ¬¡å®ç°åŠŸèƒ½éƒ½éœ€è¦è‡ªå·±ç¼–å†™ä»£ç ï¼Œä»£ç å°±æ²¡æœ‰å¾—åˆ°å¤ç”¨ã€‚

#### 6.1.2 å£°æ˜å¼äº‹åŠ¡

å£°æ˜å¼äº‹åŠ¡æ˜¯æŒ‡ä½¿ç”¨æ³¨è§£æˆ– XML é…ç½®çš„æ–¹å¼æ¥æ§åˆ¶äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚

å¼€å‘è€…åªéœ€è¦æ·»åŠ é…ç½®å³å¯ï¼Œ å…·ä½“äº‹åŠ¡çš„å®ç°ç”±ç¬¬ä¸‰æ–¹æ¡†æ¶å®ç°ï¼Œé¿å…æˆ‘ä»¬ç›´æ¥è¿›è¡Œäº‹åŠ¡æ“ä½œï¼

`ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡å¯ä»¥å°†äº‹åŠ¡çš„æ§åˆ¶å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»å¼€æ¥ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§`

åŒºåˆ«ï¼š

-   ç¼–ç¨‹å¼äº‹åŠ¡éœ€è¦`æ‰‹åŠ¨ç¼–å†™ä»£ç æ¥ç®¡ç†äº‹åŠ¡`
-   è€Œå£°æ˜å¼äº‹åŠ¡å¯ä»¥`é€šè¿‡é…ç½®æ–‡ä»¶æˆ–æ³¨è§£æ¥æ§åˆ¶äº‹åŠ¡`

#### 6.1.3 Springäº‹åŠ¡ç®¡ç†å™¨

1.  Springå£°æ˜å¼äº‹åŠ¡å¯¹åº”ä¾èµ–
    -   spring-tx: åŒ…å«å£°æ˜å¼äº‹åŠ¡å®ç°çš„åŸºæœ¬è§„èŒƒï¼ˆäº‹åŠ¡ç®¡ç†å™¨è§„èŒƒæ¥å£å’Œäº‹åŠ¡å¢å¼ºç­‰ç­‰ï¼‰
    -   spring-jdbc: åŒ…å«DataSourceæ–¹å¼äº‹åŠ¡ç®¡ç†å™¨å®ç°ç±»DataSourceTransactionManager
    -   spring-orm: åŒ…å«å…¶ä»–æŒä¹…å±‚æ¡†æ¶çš„äº‹åŠ¡ç®¡ç†å™¨å®ç°ç±»ä¾‹å¦‚ï¼šHibernate/Jpaç­‰

2.  Springå£°æ˜å¼äº‹åŠ¡å¯¹åº”äº‹åŠ¡ç®¡ç†å™¨æ¥å£![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/639cbece8808e89c32ff60ffd02ade83.png)



    æˆ‘ä»¬ç°åœ¨è¦ä½¿ç”¨çš„äº‹åŠ¡ç®¡ç†å™¨æ˜¯org.springframework.jdbc.datasource.DataSourceTransactionManagerï¼Œå°†æ¥æ•´åˆ JDBCæ–¹å¼ã€JdbcTemplateæ–¹å¼ã€Mybatisæ–¹å¼çš„äº‹åŠ¡å®ç°ï¼

    DataSourceTransactionManagerç±»ä¸­çš„ä¸»è¦æ–¹æ³•ï¼š
    -   `doBegin()`ï¼šå¼€å¯äº‹åŠ¡
    -   `doSuspend()`ï¼šæŒ‚èµ·äº‹åŠ¡
    -   `doResume()`ï¼šæ¢å¤æŒ‚èµ·çš„äº‹åŠ¡
    -   `doCommit()`ï¼šæäº¤äº‹åŠ¡
    -   `doRollback()`ï¼šå›æ»šäº‹åŠ¡

### 6.2 åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡

#### 6.2.1 å‡†å¤‡å·¥ä½œ

1.  å‡†å¤‡é¡¹ç›®
    ```xml
    <dependencies>
      <!--spring contextä¾èµ–-->
      <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-context</artifactId>
          <version>6.0.6</version>
      </dependency>

      <!--junit5æµ‹è¯•-->
      <dependency>
          <groupId>org.junit.jupiter</groupId>
          <artifactId>junit-jupiter-api</artifactId>
          <version>5.3.1</version>
      </dependency>


      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-test</artifactId>
          <version>6.0.6</version>
          <scope>test</scope>
      </dependency>

      <dependency>
          <groupId>jakarta.annotation</groupId>
          <artifactId>jakarta.annotation-api</artifactId>
          <version>2.1.1</version>
      </dependency>

      <!-- æ•°æ®åº“é©±åŠ¨ å’Œ è¿æ¥æ± -->
      <dependency>
          <groupId>mysql</groupId>
          <artifactId>mysql-connector-java</artifactId>
          <version>8.0.25</version>
      </dependency>

      <dependency>
          <groupId>com.alibaba</groupId>
          <artifactId>druid</artifactId>
          <version>1.2.8</version>
      </dependency>

      <!-- spring-jdbc -->
      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-jdbc</artifactId>
          <version>6.0.6</version>
      </dependency>

      <!-- å£°æ˜å¼äº‹åŠ¡ä¾èµ–-->
      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-tx</artifactId>
          <version>6.0.6</version>
      </dependency>


      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-aop</artifactId>
          <version>6.0.6</version>
      </dependency>

      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-aspects</artifactId>
          <version>6.0.6</version>
      </dependency>
    </dependencies>
    ```

2.  å¤–éƒ¨é…ç½®æ–‡ä»¶

    jdbc.properties
    ```.properties
    atguigu.url=jdbc:mysql://localhost:3306/studb
    atguigu.driver=com.mysql.cj.jdbc.Driver
    atguigu.username=root
    atguigu.password=root
    ```

3.  springé…ç½®æ–‡ä»¶
    ```java
    @Configuration
    @ComponentScan("com.atguigu")
    @PropertySource("classpath:jdbc.properties")
    public class JavaConfig {

        @Value("${atguigu.driver}")
        private String driver;
        @Value("${atguigu.url}")
        private String url;
        @Value("${atguigu.username}")
        private String username;
        @Value("${atguigu.password}")
        private String password;



        //druidè¿æ¥æ± 
        @Bean
        public DataSource dataSource(){
            DruidDataSource dataSource = new DruidDataSource();
            dataSource.setDriverClassName(driver);
            dataSource.setUrl(url);
            dataSource.setUsername(username);
            dataSource.setPassword(password);
            return dataSource;
        }


        @Bean
        //jdbcTemplate
        public JdbcTemplate jdbcTemplate(DataSource dataSource){
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            jdbcTemplate.setDataSource(dataSource);
            return jdbcTemplate;
        }

    }

    ```

4.  å‡†å¤‡dao/serviceå±‚

    dao
    ```java
    @Repository
    public class StudentDao {
        
        @Autowired
        private JdbcTemplate jdbcTemplate;
        
        public void updateNameById(String name,Integer id){
            String sql = "update students set name = ? where id = ? ;";
            int rows = jdbcTemplate.update(sql, name, id);
        }

        public void updateAgeById(Integer age,Integer id){
            String sql = "update students set age = ? where id = ? ;";
            jdbcTemplate.update(sql,age,id);
        }
    }

    ```
    service
    ```java
    @Service
    public class StudentService {
        
        @Autowired
        private StudentDao studentDao;
        
        public void changeInfo(){
            studentDao.updateAgeById(100,1);
            System.out.println("-----------");
            studentDao.updateNameById("test1",1);
        }
    }

    ```
5.  æµ‹è¯•ç¯å¢ƒæ­å»º
    ```java
    /**
     * projectName: com.atguigu.test
     *
     * description:
     */
    @SpringJUnitConfig(JavaConfig.class)
    public class TxTest {

        @Autowired
        private StudentService studentService;

        @Test
        public void  testTx(){
            studentService.changeInfo();
        }
    }

    ```

#### 6.2.2 åŸºæœ¬äº‹åŠ¡æ§åˆ¶

1.  é…ç½®äº‹åŠ¡ç®¡ç†å™¨

    æ•°æ®åº“ç›¸å…³çš„é…ç½®
    ```java
    /**
     * projectName: com.atguigu.config
     *
     * description: æ•°æ®åº“å’Œè¿æ¥æ± é…ç½®ç±»
     */

    @Configuration
    @ComponenScan("com.atguigu")
    @PropertySource(value = "classpath:jdbc.properties")
    @EnableTransactionManagement
    public class DataSourceConfig {

        /**
         * å®ä¾‹åŒ–dataSourceåŠ å…¥åˆ°iocå®¹å™¨
         * @param url
         * @param driver
         * @param username
         * @param password
         * @return
         */
        @Bean
        public DataSource dataSource(@Value("${atguigu.url}")String url,
                                     @Value("${atguigu.driver}")String driver,
                                     @Value("${atguigu.username}")String username,
                                     @Value("${atguigu.password}")String password){
            DruidDataSource dataSource = new DruidDataSource();
            dataSource.setDriverClassName(driver);
            dataSource.setUrl(url);
            dataSource.setUsername(username);
            dataSource.setPassword(password);

            return dataSource;
        }

        /**
         * å®ä¾‹åŒ–JdbcTemplateå¯¹è±¡,éœ€è¦ä½¿ç”¨iocä¸­çš„DataSource
         * @param dataSource
         * @return
         */
        @Bean
        public JdbcTemplate jdbcTemplate(DataSource dataSource){
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            jdbcTemplate.setDataSource(dataSource);
            return jdbcTemplate;
        }
        
        /**
         * è£…é…äº‹åŠ¡ç®¡ç†å®ç°å¯¹è±¡
         * @param dataSource
         * @return
         */
        @Bean
        public TransactionManager transactionManager(DataSource dataSource){
            return new DataSourceTransactionManager(dataSource);
        }

    }

    ```

2.  ä½¿ç”¨å£°æ˜äº‹åŠ¡æ³¨è§£@Transactional
    ```java
    /**
     * projectName: com.atguigu.service
     *
     */
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        @Transactional
        public void changeInfo(){
            studentDao.updateAgeById(100,1);
            System.out.println("-----------");
            int i = 1/0;
            studentDao.updateNameById("test1",1);
        }
    }

    ```

3.  æµ‹è¯•äº‹åŠ¡æ•ˆæœ
    ```java
    /**
     * projectName: com.atguigu.test
     *
     * description:
     */
    //@SpringJUnitConfig(locations = "classpath:application.xml")
    @SpringJUnitConfig(classes = DataSourceConfig.class)
    public class TxTest {

        @Autowired
        private StudentService studentService;

        @Test
        public void  testTx(){
            studentService.changeInfo();
        }
    }

    ```

#### 6.2.3 äº‹åŠ¡å±æ€§ï¼šåªè¯»

1.  åªè¯»ä»‹ç»

    å¯¹ä¸€ä¸ªæŸ¥è¯¢æ“ä½œæ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå®ƒè®¾ç½®æˆåªè¯»ï¼Œå°±èƒ½å¤Ÿæ˜ç¡®å‘Šè¯‰æ•°æ®åº“ï¼Œè¿™ä¸ªæ“ä½œä¸æ¶‰åŠå†™æ“ä½œã€‚è¿™æ ·æ•°æ®åº“å°±èƒ½å¤Ÿé’ˆå¯¹æŸ¥è¯¢æ“ä½œæ¥è¿›è¡Œä¼˜åŒ–ã€‚

2.  è®¾ç½®æ–¹å¼
    ```java
    // readOnly = trueæŠŠå½“å‰äº‹åŠ¡è®¾ç½®ä¸ºåªè¯» é»˜è®¤æ˜¯false!
    @Transactional(readOnly = true)
    ```

3.  é’ˆå¯¹DMLåŠ¨ä½œè®¾ç½®åªè¯»æ¨¡å¼

    ä¼šæŠ›å‡ºä¸‹é¢å¼‚å¸¸ï¼š

    Caused by: java.sql.SQLException: Connection is read-only. Queries leading to data modification are not allowed

4.  @Transactionalæ³¨è§£æ”¾åœ¨ç±»ä¸Š
    1.  ç”Ÿæ•ˆåŸåˆ™

        `å¦‚æœä¸€ä¸ªç±»ä¸­æ¯ä¸€ä¸ªæ–¹æ³•ä¸Šéƒ½ä½¿ç”¨äº† @Transactional æ³¨è§£ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°† @Transactional æ³¨è§£æå–åˆ°ç±»ä¸Š`ã€‚åè¿‡æ¥è¯´ï¼š@Transactional æ³¨è§£åœ¨ç±»çº§åˆ«æ ‡è®°ï¼Œä¼šå½±å“åˆ°ç±»ä¸­çš„æ¯ä¸€ä¸ªæ–¹æ³•ã€‚åŒæ—¶ï¼Œç±»çº§åˆ«æ ‡è®°çš„ @Transactional æ³¨è§£ä¸­è®¾ç½®çš„äº‹åŠ¡å±æ€§ä¹Ÿä¼šå»¶ç»­å½±å“åˆ°æ–¹æ³•æ‰§è¡Œæ—¶çš„äº‹åŠ¡å±æ€§ã€‚é™¤éåœ¨æ–¹æ³•ä¸Šåˆè®¾ç½®äº† @Transactional æ³¨è§£ã€‚

        å¯¹ä¸€ä¸ªæ–¹æ³•æ¥è¯´ï¼Œç¦»å®ƒæœ€è¿‘çš„ @Transactional æ³¨è§£ä¸­çš„äº‹åŠ¡å±æ€§è®¾ç½®ç”Ÿæ•ˆã€‚

	2.  ç”¨æ³•ä¸¾ä¾‹

        åœ¨ç±»çº§åˆ«@Transactionalæ³¨è§£ä¸­è®¾ç½®åªè¯»ï¼Œè¿™æ ·ç±»ä¸­æ‰€æœ‰çš„æŸ¥è¯¢æ–¹æ³•éƒ½ä¸éœ€è¦è®¾ç½®@Transactionalæ³¨è§£äº†ã€‚å› ä¸ºå¯¹æŸ¥è¯¢æ“ä½œæ¥è¯´ï¼Œå…¶ä»–å±æ€§é€šå¸¸ä¸éœ€è¦è®¾ç½®ï¼Œæ‰€ä»¥ä½¿ç”¨å…¬å…±è®¾ç½®å³å¯ã€‚

        ç„¶ååœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå¯¹å¢åˆ æ”¹æ–¹æ³•è®¾ç½®@Transactionalæ³¨è§£ readOnly å±æ€§ä¸º falseã€‚
    ```java
    @Service
    @Transactional(readOnly = true)
    public class EmpService {
        
        // ä¸ºäº†ä¾¿äºæ ¸å¯¹æ•°æ®åº“æ“ä½œç»“æœï¼Œä¸è¦ä¿®æ”¹åŒä¸€æ¡è®°å½•
        @Transactional(readOnly = false)
        public void updateTwice(â€¦â€¦) {
        â€¦â€¦
        }
        
        // readOnly = trueæŠŠå½“å‰äº‹åŠ¡è®¾ç½®ä¸ºåªè¯»
        // @Transactional(readOnly = true)
        public String getEmpName(Integer empId) {
        â€¦â€¦
        }
        
    }
    ```

#### 6.2.4 äº‹åŠ¡å±æ€§ï¼šè¶…æ—¶æ—¶é—´

1.  éœ€æ±‚

    äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½å› ä¸ºé‡åˆ°æŸäº›é—®é¢˜ï¼Œå¯¼è‡´ç¨‹åºå¡ä½ï¼Œä»è€Œé•¿æ—¶é—´å ç”¨æ•°æ®åº“èµ„æºã€‚è€Œé•¿æ—¶é—´å ç”¨èµ„æºï¼Œå¤§æ¦‚ç‡æ˜¯å› ä¸ºç¨‹åºè¿è¡Œå‡ºç°äº†é—®é¢˜ï¼ˆå¯èƒ½æ˜¯Javaç¨‹åºæˆ–MySQLæ•°æ®åº“æˆ–ç½‘ç»œè¿æ¥ç­‰ç­‰ï¼‰ã€‚

    æ­¤æ—¶è¿™ä¸ªå¾ˆå¯èƒ½å‡ºé—®é¢˜çš„ç¨‹åºåº”è¯¥è¢«å›æ»šï¼Œæ’¤é”€å®ƒå·²åšçš„æ“ä½œï¼Œäº‹åŠ¡ç»“æŸï¼ŒæŠŠèµ„æºè®©å‡ºæ¥ï¼Œè®©å…¶ä»–æ­£å¸¸ç¨‹åºå¯ä»¥æ‰§è¡Œã€‚

    æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ä¸€å¥è¯ï¼š`è¶…æ—¶å›æ»šï¼Œé‡Šæ”¾èµ„æº`ã€‚

2.  è®¾ç½®è¶…æ—¶æ—¶é—´
    ```java
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         */
        @Transactional(readOnly = false,timeout = 3)
        public void changeInfo(){
            studentDao.updateAgeById(100,1);
            //ä¼‘çœ 4ç§’,ç­‰å¾…æ–¹æ³•è¶…æ—¶!
            try {
                Thread.sleep(4000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            studentDao.updateNameById("test1",1);
        }
    }

    ```

3.  æµ‹è¯•è¶…æ—¶æ•ˆæœ

    æ‰§è¡ŒæŠ›å‡ºäº‹åŠ¡è¶…æ—¶å¼‚å¸¸
    ```java
    org.springframework.transaction.TransactionTimedOutException: Transaction timed out: deadline was Wed May 24 09:10:43 IRKT 2023

      at org.springframework.transaction.support.ResourceHolderSupport.checkTransactionTimeout(ResourceHolderSupport.java:155)
      at org.springframework.transaction.support.ResourceHolderSupport.getTimeToLiveInMillis(ResourceHolderSupport.java:144)
      at org.springframework.transaction.support.ResourceHolderSupport.getTimeToLiveInSeconds(ResourceHolderSupport.java:128)
      at org.springframework.jdbc.datasource.DataSourceUtils.applyTimeout(DataSourceUtils.java:341)
      at org.springframework.jdbc.core.JdbcTemplate.applyStatementSettings(JdbcTemplate.java:1467)

    ```

#### 6.2.5 äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡å¼‚å¸¸

1.  é»˜è®¤æƒ…å†µ

    `é»˜è®¤åªé’ˆå¯¹è¿è¡Œæ—¶å¼‚å¸¸å›æ»š`ï¼Œç¼–è¯‘æ—¶å¼‚å¸¸ä¸å›æ»šã€‚æƒ…æ™¯æ¨¡æ‹Ÿä»£ç å¦‚ä¸‹ï¼š
    ```java
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
         * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
         */
        @Transactional(readOnly = false,timeout = 3)
        public void changeInfo() throws FileNotFoundException {
            studentDao.updateAgeById(100,1);
            //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…! 
            new FileInputStream("xxxx");
            studentDao.updateNameById("test1",1);
        }
    }
    ```

2.  è®¾ç½®å›æ»šå¼‚å¸¸

    `rollbackForå±æ€§ï¼šæŒ‡å®šå“ªäº›å¼‚å¸¸ç±»æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š`!
    ```java
    /**
     * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
     * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
     * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
     */
    @Transactional(readOnly = false,timeout = 3,rollbackFor = Exception.class)
    public void changeInfo() throws FileNotFoundException {
        studentDao.updateAgeById(100,1);
        //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…! 
        new FileInputStream("xxxx");
        studentDao.updateNameById("test1",1);
    }
    ```

3.  è®¾ç½®ä¸å›æ»šçš„å¼‚å¸¸

    åœ¨é»˜è®¤è®¾ç½®å’Œå·²æœ‰è®¾ç½®çš„åŸºç¡€ä¸Šï¼Œå†æŒ‡å®šä¸€ä¸ªå¼‚å¸¸ç±»å‹ï¼Œç¢°åˆ°å®ƒä¸å›æ»šã€‚

    `noRollbackForå±æ€§ï¼šæŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…`!
    ```java
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
         * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
         */
        @Transactional(readOnly = false,timeout = 3,rollbackFor = Exception.class,noRollbackFor = FileNotFoundException.class)
        public void changeInfo() throws FileNotFoundException {
            studentDao.updateAgeById(100,1);
            //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…!
            new FileInputStream("xxxx");
            studentDao.updateNameById("test1",1);
        }
    }

    ```

#### 6.2.6 äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«

1.  äº‹åŠ¡éš”ç¦»çº§åˆ«

    æ•°æ®åº“äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æ˜¯æŒ‡åœ¨å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œæ•°æ®åº“ç³»ç»Ÿä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§æ‰€éµå¾ªçš„è§„å®šã€‚å¸¸è§çš„éš”ç¦»çº§åˆ«åŒ…æ‹¬ï¼š
    1.  è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰ï¼šäº‹åŠ¡å¯ä»¥è¯»å–æœªè¢«æäº¤çš„æ•°æ®ï¼Œå®¹æ˜“äº§ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ç­‰é—®é¢˜ã€‚å®ç°ç®€å•ä½†ä¸å¤ªå®‰å…¨ï¼Œä¸€èˆ¬ä¸ç”¨ã€‚
    2.  è¯»å·²æäº¤ï¼ˆRead Committedï¼‰ï¼šäº‹åŠ¡åªèƒ½è¯»å–å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é¿å…è„è¯»é—®é¢˜ï¼Œä½†å¯èƒ½å¼•å‘ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚
    3.  å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç›¸åŒçš„æŸ¥è¯¢å°†è¿”å›ç›¸åŒçš„ç»“æœé›†ï¼Œä¸ç®¡å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®åšäº†ä»€ä¹ˆä¿®æ”¹ã€‚å¯ä»¥é¿å…è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†ä»æœ‰å¹»è¯»çš„é—®é¢˜ã€‚
    4.  ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨ç¦æ­¢äº†å¹¶å‘ï¼Œåªå…è®¸ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½æ‰§è¡Œå¦ä¸€ä¸ªäº‹åŠ¡ã€‚å¯ä»¥é¿å…ä»¥ä¸Šæ‰€æœ‰é—®é¢˜ï¼Œä½†æ•ˆç‡è¾ƒä½ï¼Œä¸é€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ã€‚
        ä¸åŒçš„éš”ç¦»çº§åˆ«é€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼Œéœ€è¦æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚è¿›è¡Œé€‰æ‹©å’Œè°ƒæ•´ã€‚

2.  äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®
    ```java
    package com.atguigu.service;

    import com.atguigu.dao.StudentDao;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Service;
    import org.springframework.transaction.annotation.Isolation;
    import org.springframework.transaction.annotation.Transactional;

    import java.io.FileInputStream;
    import java.io.FileNotFoundException;

    /**
     * projectName: com.atguigu.service
     */
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
         * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
         * isolation = è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«,mysqlé»˜è®¤æ˜¯repeatable read!
         */
        @Transactional(readOnly = false,
                       timeout = 3,
                       rollbackFor = Exception.class,
                       noRollbackFor = FileNotFoundException.class,
                       isolation = Isolation.REPEATABLE_READ)
        public void changeInfo() throws FileNotFoundException {
            studentDao.updateAgeById(100,1);
            //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…!
            new FileInputStream("xxxx");
            studentDao.updateNameById("test1",1);
        }
    }

    ```

#### 6.2.7 äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡ä¼ æ’­è¡Œä¸º

1.  äº‹åŠ¡ä¼ æ’­è¡Œä¸ºè¦ç ”ç©¶çš„é—®é¢˜
    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0e644245b9e1ef88c501ca3b5e82c916.png)
    ä¸¾ä¾‹ä»£ç ï¼š
    ```java
    @Transactional
    public void MethodA(){
        // ...
        MethodB();
        // ...
    }

    //åœ¨è¢«è°ƒç”¨çš„å­æ–¹æ³•ä¸­è®¾ç½®ä¼ æ’­è¡Œä¸ºï¼Œä»£è¡¨å¦‚ä½•å¤„ç†è°ƒç”¨çš„äº‹åŠ¡ï¼ æ˜¯åŠ å…¥ï¼Œè¿˜æ˜¯æ–°äº‹åŠ¡ç­‰ï¼
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void MethodB(){
        // ...
    }

    ```

2.  propagationå±æ€§

    @Transactional æ³¨è§£é€šè¿‡ propagation å±æ€§è®¾ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯ï¼š
    ```java
    Propagation propagation() default Propagation.REQUIRED;

    ```
    propagation å±æ€§çš„å¯é€‰å€¼ç”± org.springframework.transaction.annotation.Propagation æšä¸¾ç±»æä¾›ï¼š
	 ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/bad87ddca6c2ccac14d7a97a8dea3975.png)


    
1.  æµ‹è¯•
    1.  å£°æ˜ä¸¤ä¸ªä¸šåŠ¡æ–¹æ³•
        ```java
        @Service
        public class StudentService {

            @Autowired
            private StudentDao studentDao;

            /**
             * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
             * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
             * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
             * isolation = è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«,mysqlé»˜è®¤æ˜¯repeatable read!
             */
            @Transactional(readOnly = false,
                           timeout = 3,
                           rollbackFor = Exception.class,
                           noRollbackFor = FileNotFoundException.class,
                           isolation = Isolation.REPEATABLE_READ)
            public void changeInfo() throws FileNotFoundException {
                studentDao.updateAgeById(100,1);
                //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…!
                new FileInputStream("xxxx");
                studentDao.updateNameById("test1",1);
            }
            

            /**
             * å£°æ˜ä¸¤ä¸ªç‹¬ç«‹ä¿®æ”¹æ•°æ®åº“çš„äº‹åŠ¡ä¸šåŠ¡æ–¹æ³•
             */
            @Transactional(propagation = Propagation.REQUIRED)
            public void changeAge(){
                studentDao.updateAgeById(99,1);
            }

            @Transactional(propagation = Propagation.REQUIRED)
            public void changeName(){
                studentDao.updateNameById("test2",1);
                int i = 1/0;
            }

        }
        ```

	2.  å£°æ˜ä¸€ä¸ªæ•´åˆä¸šåŠ¡æ–¹æ³•
        ```java
        @Service
        public class TopService {

            @Autowired
            private StudentService studentService;

            @Transactional
            public void  topService(){
                studentService.changeAge();
                studentService.changeName();
            }
        }

        ```

	3.  æ·»åŠ ä¼ æ’­è¡Œä¸ºæµ‹è¯•
        ```java
        @SpringJUnitConfig(classes = AppConfig.class)
        public class TxTest {

            @Autowired
            private StudentService studentService;

            @Autowired
            private TopService topService;

            @Test
            public void  testTx() throws FileNotFoundException {
                topService.topService();
            }
        }

        ```
    **æ³¨æ„ï¼š**

    `åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œå¯¹äº@Transactionalæ³¨è§£çš„æ–¹æ³•è°ƒç”¨ï¼Œäº‹åŠ¡ä¼ æ’­è¡Œä¸ºä¸ä¼šç”Ÿæ•ˆ`ã€‚è¿™æ˜¯å› ä¸ºSpringæ¡†æ¶ä¸­ä½¿ç”¨ä»£ç†æ¨¡å¼å®ç°äº†äº‹åŠ¡æœºåˆ¶ï¼Œåœ¨åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•è°ƒç”¨å¹¶ä¸ç»è¿‡ä»£ç†ï¼Œè€Œæ˜¯é€šè¿‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤@Transactionalæ³¨è§£çš„è®¾ç½®ä¸ä¼šè¢«ä»£ç†æ•è·ï¼Œä¹Ÿå°±ä¸ä¼šäº§ç”Ÿä»»ä½•äº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„æ•ˆæœã€‚
2.  å…¶ä»–ä¼ æ’­è¡Œä¸ºå€¼ï¼ˆäº†è§£ï¼‰
    1.  `Propagation.REQUIRED`ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥å½“å‰äº‹åŠ¡ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚
    2.  `Propagation.REQUIRES_NEW`ï¼šåˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨æ–°äº‹åŠ¡ä¸­æ‰§è¡Œã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œå³ä½¿æ–°äº‹åŠ¡æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šå½±å“å½“å‰äº‹åŠ¡ã€‚
    3.  `Propagation.NESTED`ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨è¯¥äº‹åŠ¡ä¸­åµŒå¥—ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä¸Propagation.REQUIREDä¸€æ ·ã€‚
    4.  `Propagation.SUPPORTS`ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦åˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚
    5.  `Propagation.NOT\_SUPPORTED`ï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŒ‚èµ·è¯¥äº‹åŠ¡ã€‚
    6.  `Propagation.MANDATORY`ï¼šå¿…é¡»åœ¨ä¸€ä¸ªå·²æœ‰çš„äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
    7.  P`ropagation.NEVER`ï¼šå¿…é¡»åœ¨æ²¡æœ‰äº‹åŠ¡çš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

## 7 Springæ ¸å¿ƒæŒæ¡æ€»ç»“

| æ ¸å¿ƒç‚¹             | æŒæ¡ç›®æ ‡                        |
| --------------- | --------------------------- |
| springæ¡†æ¶ç†è§£      | springå®¶æ—å’Œspring frameworkæ¡†æ¶ |
| springæ ¸å¿ƒåŠŸèƒ½      | ioc/di , aop , tx           |
| spring ioc / di | ç»„ä»¶ç®¡ç†ã€iocå®¹å™¨ã€ioc/di , ä¸‰ç§é…ç½®æ–¹å¼  |
| spring aop      | aopå’Œaopæ¡†æ¶å’Œä»£ç†æŠ€æœ¯ã€åŸºäºæ³¨è§£çš„aopé…ç½®   |
| spring tx       | å£°æ˜å¼å’Œç¼–ç¨‹å¼äº‹åŠ¡ã€åŠ¨æ€äº‹åŠ¡ç®¡ç†å™¨ã€äº‹åŠ¡æ³¨è§£ã€å±æ€§   |

## 1 æŠ€æœ¯ä½“ç³»ç»“æ„

### 1.1 æ€»ä½“æŠ€æœ¯ä½“ç³»

-   `å•ä¸€æ¶æ„`
    ä¸€ä¸ªé¡¹ç›®ï¼Œä¸€ä¸ªå·¥ç¨‹ï¼Œå¯¼å‡ºä¸ºä¸€ä¸ªwaråŒ…ï¼Œåœ¨ä¸€ä¸ªTomcatä¸Šè¿è¡Œã€‚ä¹Ÿå«all in oneã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0d29b87869ffe88f930010d47bb8dfb1.png)


    å•ä¸€æ¶æ„ï¼Œé¡¹ç›®ä¸»è¦åº”ç”¨æŠ€æœ¯æ¡†æ¶ä¸ºï¼š`Spring` , `SpringMVC` , `Mybatis`

-   `åˆ†å¸ƒå¼æ¶æ„`
    ä¸€ä¸ªé¡¹ç›®ï¼ˆå¯¹åº” IDEA ä¸­çš„ä¸€ä¸ª projectï¼‰ï¼Œæ‹†åˆ†æˆå¾ˆå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—æ˜¯ä¸€ä¸ª IDEA ä¸­çš„ä¸€ä¸ª moduleã€‚æ¯ä¸€ä¸ªå·¥ç¨‹éƒ½æ˜¯è¿è¡Œåœ¨è‡ªå·±çš„ Tomcat ä¸Šã€‚æ¨¡å—ä¹‹é—´å¯ä»¥äº’ç›¸è°ƒç”¨ã€‚æ¯ä¸€ä¸ªæ¨¡å—å†…éƒ¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå•ä¸€æ¶æ„çš„åº”ç”¨ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fa9048c3bc59727e9f1cf8c931f41962.png)


    åˆ†å¸ƒå¼æ¶æ„ï¼Œé¡¹ç›®ä¸»è¦åº”ç”¨æŠ€æœ¯æ¡†æ¶ï¼š`SpringBoot` (SSM), `SpringCloud` , `ä¸­é—´ä»¶ç­‰`

### 1.2 æ¡†æ¶æ¦‚å¿µå’Œç†è§£

æ¡†æ¶( Framework )æ˜¯ä¸€ä¸ªé›†æˆäº†åŸºæœ¬ç»“æ„ã€è§„èŒƒã€è®¾è®¡æ¨¡å¼ã€ç¼–ç¨‹è¯­è¨€å’Œç¨‹åºåº“ç­‰åŸºç¡€ç»„ä»¶çš„è½¯ä»¶ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨æ¥æ„å»ºæ›´é«˜çº§åˆ«çš„åº”ç”¨ç¨‹åºã€‚æ¡†æ¶çš„è®¾è®¡å’Œå®ç°æ—¨åœ¨è§£å†³ç‰¹å®šé¢†åŸŸä¸­çš„å¸¸è§é—®é¢˜ï¼Œ`å¸®åŠ©å¼€å‘äººå‘˜æ›´é«˜æ•ˆã€æ›´ç¨³å®šåœ°å®ç°è½¯ä»¶å¼€å‘ç›®æ ‡`ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c4139da4a4dbe658400907972c00d9c7.png)



`æ¡†æ¶çš„ä¼˜ç‚¹`åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š

1.  `æé«˜å¼€å‘æ•ˆç‡`ï¼šæ¡†æ¶æä¾›äº†è®¸å¤šé¢„å…ˆè®¾è®¡å¥½äº†çš„ç»„ä»¶å’Œå·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿè¿›è¡Œå¼€å‘ã€‚ç›¸è¾ƒäºä¼ ç»Ÿæ‰‹å†™ä»£ç ï¼Œåœ¨æ¡†æ¶æä¾›çš„è§„èŒƒåŒ–ç¯å¢ƒä¸­ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¿«åœ°å®ç°é¡¹ç›®çš„å„ç§è¦æ±‚ã€‚
2.  `é™ä½å¼€å‘æˆæœ¬`ï¼šæ¡†æ¶çš„æä¾›æ ‡å‡†åŒ–çš„ç¼–ç¨‹è¯­è¨€ã€æ•°æ®æ“ä½œç­‰ä»£ç ç‰‡æ®µï¼Œé¿å…äº†é‡å¤å¼€å‘çš„é—®é¢˜ï¼Œé™ä½äº†å¼€å‘æˆæœ¬ï¼Œæä¾›æ·±åº¦ä¼˜åŒ–çš„ç³»ç»Ÿï¼Œé™ä½äº†ç»´æŠ¤æˆæœ¬ï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„å¯é æ€§ã€‚
3.  `æé«˜åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§`ï¼šæ¡†æ¶é€šå¸¸ç»è¿‡äº†å¾ˆé•¿æ—¶é—´çš„å¼€å‘å’Œæµ‹è¯•ï¼Œå…¶ä¸­çš„è®¸å¤šç»„ä»¶ã€ä»£ç ç‰‡æ®µå’Œè®¾è®¡æ¨¡å¼éƒ½å¾—åˆ°äº†éªŒè¯ã€‚é‡å¤åˆ©ç”¨è¿™äº›ç»„ä»¶æœ‰åŠ©äºå‡å°‘bugçš„å‡ºç°ï¼Œä»è€Œæé«˜äº†åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§ã€‚
4.  `æä¾›æ ‡å‡†åŒ–çš„è§£å†³æ–¹æ¡ˆ`ï¼šæ¡†æ¶é€šå¸¸æ˜¯é’ˆå¯¹æŸä¸ªç‰¹å®šé¢†åŸŸçš„ï¼Œé€šè¿‡æä¾›æ ‡å‡†åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ä¸ºå¼€å‘äººå‘˜æä¾›ä¸€ç§å…±åŒçš„è¯­è¨€å’Œæ€æƒ³åŸºç¡€ï¼Œæœ‰åŠ©äºæ›´å¥½åœ°æ²Ÿé€šå’Œåä½œã€‚

`æ¡†æ¶çš„ç¼ºç‚¹`åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1.  `å­¦ä¹ æˆæœ¬é«˜`ï¼šæ¡†æ¶é€šå¸¸å…·æœ‰ç‰¹å®šçš„è¯­è¨€å’Œç¼–ç¨‹èŒƒå¼ã€‚å¯¹äºå¼€å‘äººå‘˜è€Œè¨€ï¼Œéœ€è¦èŠ±è´¹æ—¶é—´å­¦ä¹ å…¶èƒŒåçš„æ¶æ„ã€æ¨¡å¼å’Œé€»è¾‘ï¼Œè¿™å¯¹äºæ–°æ‰‹è€Œè¨€å¯èƒ½ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ã€‚
2.  `å¯èƒ½å­˜åœ¨å±€é™æ€§`ï¼šè™½ç„¶æ¡†æ¶æé«˜äº†å¼€å‘æ•ˆç‡å¹¶å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜è§£å†³å¸¸è§é—®é¢˜ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç‰¹å®šçš„åº”ç”¨éœ€æ±‚å¯èƒ½è¶…å‡ºæ¡†æ¶çš„èŒƒå›´ï¼Œä»è€Œå¯¼è‡´åº”ç”¨ç¨‹åºæ— æ³•æ»¡è¶³è¦æ±‚ã€‚å¼€å‘äººå‘˜å¯èƒ½éœ€è¦æ›´å¤šçš„æ§åˆ¶æƒå’Œè‡ªç”±åº¦ï¼ŒåŒæ—¶éœ€è¦åœ¨æ¡†æ¶å’Œåº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œæƒè¡¡å–èˆã€‚
3.  `ç‰ˆæœ¬å˜æ›´å’Œå…¼å®¹æ€§é—®é¢˜`ï¼šæ¡†æ¶çš„ç‰ˆæœ¬å‘å¸ƒå’Œè¿­ä»£é€šå¸¸ä¼šå¯¼è‡´ä»£ç åº“çš„å¤§è§„æ¨¡å˜æ›´ï¼Œè¿›è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå‡ºç°å…¼å®¹æ€§é—®é¢˜å’Œæ¼æ´ã€‚å½“æ¡†æ¶å˜æ›´æ—¶ï¼Œéœ€è¦è€ƒè™‘æ¡†æ¶æ˜¯å¦å‘ä¸‹å…¼å®¹ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œé€‚å½“çš„æµ‹è¯•ã€è¿ç§»å’Œå‡çº§ã€‚
4.  `æ¶æ„é£é™©`ï¼šæ¡†æ¶æ¶‰åŠåˆ°å¾ˆå¤šæŠ½è±¡å’Œæ¦‚å¿µï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰è¶³å¤Ÿçš„ç†è§£å’ŒæŒæ¡å…¶æ¶æ„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå‡ºç°è®¾è®¡å’Œæ¶æ„ç¼ºé™·ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„å¥åº·æ€§å’Œå®‰å…¨æ€§ã€‚

ç«™åœ¨æ–‡ä»¶ç»“æ„çš„è§’åº¦ç†è§£æ¡†æ¶ï¼Œå¯ä»¥å°†æ¡†æ¶æ€»ç»“ï¼š**æ¡†æ¶ = jaråŒ…+é…ç½®æ–‡ä»¶**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/e7c31ed6859b153c099a1ad921074452.png)


èå£«æ¯”äºšè¯´,"ä¸€åƒä¸ªè§‚ä¼—çœ¼ä¸­æœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹" å³ä»è€…è§ä»,æ™ºè€…è§æ™º.è¯´æ¯ä¸ªäººéƒ½ä¼šå¯¹ä½œå“æœ‰ä¸åŒçš„ç†è§£ï¼Œæ¯ä¸ªäººå¯¹å¾…ä»»ä½•äº‹ç‰©éƒ½æœ‰è‡ªå·±çš„çœ‹æ³•ï¼ŒåŒæ ·çš„æŠ€æœ¯è§£å†³åŒæ ·çš„é—®é¢˜ä¼šäº§ç”Ÿä¸åŒæµç¨‹å’Œé£æ ¼çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œé‡‡ç”¨ä¸€ç§æ¡†æ¶å…¶å®å°±æ˜¯é™åˆ¶ç”¨æˆ·å¿…é¡»ä½¿ç”¨å…¶è§„å®šçš„æ–¹æ¡ˆæ¥å®ç°ï¼Œå¯ä»¥é™ä½ç¨‹åºå‘˜ä¹‹é—´æ²Ÿé€šä»¥åŠæ—¥åç»´æŠ¤çš„æˆæœ¬ï¼

å¸¸ç”¨çš„å•ä¸€æ¶æ„JavaEEé¡¹ç›®æ¡†æ¶æ¼”è¿›ï¼Œä»SSHã€SSH2è¿‡æ¸¡åˆ°äº†`SSMï¼šSpringMVCã€Springã€MyBatis`ã€‚

æ€»ä¹‹ï¼Œæ¡†æ¶å·²ç»å¯¹åŸºç¡€çš„ä»£ç è¿›è¡Œäº†å°è£…å¹¶æä¾›ç›¸åº”çš„APIï¼Œå¼€å‘è€…åœ¨ä½¿ç”¨æ¡†æ¶æ˜¯ç›´æ¥è°ƒç”¨å°è£…å¥½çš„APIå¯ä»¥çœå»å¾ˆå¤šä»£ç ç¼–å†™ï¼Œä»è€Œæé«˜å·¥ä½œæ•ˆç‡å’Œå¼€å‘é€Ÿåº¦ã€‚

## 2 SpringFrameworkä»‹ç»

### 2.1 Spring å’Œ SpringFrameworkæ¦‚å¿µ

<https://spring.io/projects>

`å¹¿ä¹‰çš„ Springï¼šSpring æŠ€æœ¯æ ˆ`ï¼ˆå…¨å®¶æ¡¶ï¼‰

å¹¿ä¹‰ä¸Šçš„ Spring `æ³›æŒ‡ä»¥ Spring Framework ä¸ºåŸºç¡€çš„ Spring æŠ€æœ¯æ ˆ`ã€‚

ç»è¿‡åå¤šå¹´çš„å‘å±•ï¼ŒSpring å·²ç»ä¸å†æ˜¯ä¸€ä¸ªå•çº¯çš„åº”ç”¨æ¡†æ¶ï¼Œè€Œæ˜¯é€æ¸å‘å±•æˆä¸ºä¸€ä¸ªç”±å¤šä¸ªä¸åŒå­é¡¹ç›®ï¼ˆæ¨¡å—ï¼‰ç»„æˆçš„æˆç†ŸæŠ€æœ¯ï¼Œä¾‹å¦‚ Spring Frameworkã€Spring MVCã€SpringBootã€Spring Cloudã€Spring Dataã€Spring Security ç­‰ï¼Œå…¶ä¸­ Spring Framework æ˜¯å…¶ä»–å­é¡¹ç›®çš„åŸºç¡€ã€‚

è¿™äº›å­é¡¹ç›®æ¶µç›–äº†ä»ä¼ä¸šçº§åº”ç”¨å¼€å‘åˆ°äº‘è®¡ç®—ç­‰å„æ–¹é¢çš„å†…å®¹ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜è§£å†³è½¯ä»¶å‘å±•è¿‡ç¨‹ä¸­ä¸æ–­äº§ç”Ÿçš„å„ç§å®é™…é—®é¢˜ï¼Œç»™å¼€å‘äººå‘˜å¸¦æ¥äº†æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚

`ç‹­ä¹‰çš„ Springï¼šSpring Framework`ï¼ˆåŸºç¡€æ¡†æ¶ï¼‰

ç‹­ä¹‰çš„ Spring `ç‰¹æŒ‡ Spring Frameworkï¼Œé€šå¸¸æˆ‘ä»¬å°†å®ƒç§°ä¸º Spring æ¡†æ¶`ã€‚

Spring Frameworkï¼ˆSpringæ¡†æ¶ï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œç”±SpringSourceå…¬å¸å¼€å‘ï¼Œæœ€åˆæ˜¯ä¸ºäº†è§£å†³ä¼ä¸šçº§å¼€å‘ä¸­å„ç§å¸¸è§é—®é¢˜è€Œåˆ›å»ºçš„ã€‚å®ƒæä¾›äº†å¾ˆå¤šåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰ã€é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ã€å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼ˆTXï¼‰ç­‰ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯ä½¿ä¼ä¸šçº§åº”ç”¨ç¨‹åºçš„å¼€å‘å˜å¾—æ›´åŠ ç®€å•å’Œå¿«é€Ÿï¼Œå¹¶ä¸”Springæ¡†æ¶è¢«å¹¿æ³›åº”ç”¨äºJavaä¼ä¸šå¼€å‘é¢†åŸŸã€‚

Springå…¨å®¶æ¡¶çš„å…¶ä»–æ¡†æ¶éƒ½æ˜¯ä»¥SpringFrameworkæ¡†æ¶ä¸ºåŸºç¡€ï¼

`å¯¹æ¯”ç†è§£ï¼š`

QQ å’Œ è…¾è®¯

è…¾è®¯ = Spring

QQ = SpringFramework

### 2.2 SpringFrameworkä¸»è¦åŠŸèƒ½æ¨¡å—

SpringFrameworkæ¡†æ¶ç»“æ„å›¾ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fa8026fabc65c03ebb186424fad275b4.png)



| åŠŸèƒ½æ¨¡å—           | åŠŸèƒ½ä»‹ç»                                 |
| -------------- | ------------------------------------ |
| Core Container | æ ¸å¿ƒå®¹å™¨ï¼Œåœ¨ Spring ç¯å¢ƒä¸‹ä½¿ç”¨ä»»ä½•åŠŸèƒ½éƒ½å¿…é¡»åŸºäº IOC å®¹å™¨ã€‚ |
| AOP\&Aspects   | é¢å‘åˆ‡é¢ç¼–ç¨‹                               |
| TX             | å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚                             |
| Spring MVC     | æä¾›äº†é¢å‘Webåº”ç”¨ç¨‹åºçš„é›†æˆåŠŸèƒ½ã€‚                   |

### 2.3 SpringFramework ä¸»è¦ä¼˜åŠ¿

1.  `ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿ`ï¼šSpring ç”Ÿæ€ç³»ç»Ÿéå¸¸ä¸°å¯Œï¼Œæ”¯æŒè®¸å¤šæ¨¡å—å’Œåº“ï¼Œå¦‚ Spring Bootã€Spring Securityã€Spring Cloud ç­‰ç­‰ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿæ„å»ºé«˜å¯é æ€§çš„ä¼ä¸šåº”ç”¨ç¨‹åºã€‚
2.  `æ¨¡å—åŒ–çš„è®¾è®¡`ï¼šæ¡†æ¶ç»„ä»¶ä¹‹é—´çš„æ¾æ•£è€¦åˆå’Œæ¨¡å—åŒ–è®¾è®¡ä½¿å¾— Spring Framework å…·æœ‰è‰¯å¥½çš„å¯é‡ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°é€‰æ‹©è‡ªå·±éœ€è¦çš„æ¨¡å—ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå¼€å‘ã€‚
3.  `ç®€åŒ– Java å¼€å‘`ï¼šSpring Framework ç®€åŒ–äº† Java å¼€å‘ï¼Œæä¾›äº†å„ç§å·¥å…·å’Œ APIï¼Œå¯ä»¥é™ä½å¼€å‘å¤æ‚åº¦å’Œå­¦ä¹ æˆæœ¬ã€‚åŒæ—¶ï¼ŒSpring Framework æ”¯æŒå„ç§åº”ç”¨åœºæ™¯ï¼ŒåŒ…æ‹¬ Web åº”ç”¨ç¨‹åºã€RESTful APIã€æ¶ˆæ¯ä¼ é€’ã€æ‰¹å¤„ç†ç­‰ç­‰ã€‚
4.  `ä¸æ–­åˆ›æ–°å’Œå‘å±•`ï¼šSpring Framework å¼€å‘å›¢é˜Ÿä¸€ç›´åœ¨ä¸æ–­åˆ›æ–°å’Œå‘å±•ï¼Œä¿æŒä¸æœ€æ–°æŠ€æœ¯çš„æ¥è½¨ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›æ›´åŠ å…ˆè¿›å’Œä¼˜ç§€çš„å·¥å…·å’Œæ¡†æ¶ã€‚

å› æ­¤ï¼Œè¿™äº›ä¼˜ç‚¹ä½¿å¾— Spring Framework æˆä¸ºäº†ä¸€ä¸ªç¨³å®šã€å¯é ã€ä¸”åˆ›æ–°çš„æ¡†æ¶ï¼Œä¸ºä¼ä¸šçº§ Java å¼€å‘æä¾›äº†ä¸€ç«™å¼çš„è§£å†³æ–¹æ¡ˆã€‚

Spring ä½¿åˆ›å»º Java ä¼ä¸šåº”ç”¨ç¨‹åºå˜å¾—å®¹æ˜“ã€‚å®ƒæä¾›äº†åœ¨ä¼ä¸šç¯å¢ƒä¸­é‡‡ç”¨ Java è¯­è¨€æ‰€éœ€çš„ä¸€åˆ‡ï¼Œæ”¯æŒ Groovy å’Œ Kotlin ä½œä¸º JVM ä¸Šçš„æ›¿ä»£è¯­è¨€ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€æ±‚çµæ´»åœ°åˆ›å»ºå¤šç§æ¶æ„ã€‚`ä»Spring Framework 6.0.6å¼€å§‹ï¼ŒSpring éœ€è¦ Java 17+`ã€‚

## 3 Spring IoCå®¹å™¨å’Œæ ¸å¿ƒæ¦‚å¿µ

### 3.1 ç»„ä»¶å’Œç»„ä»¶ç®¡ç†æ¦‚å¿µ

#### 3.1.1 ä»€ä¹ˆæ˜¯ç»„ä»¶?

å›é¡¾å¸¸è§„çš„ä¸‰å±‚æ¶æ„å¤„ç†è¯·æ±‚æµç¨‹ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c61820bc90e2c7097ad8c921e3b1dc31.png)


`æ•´ä¸ªé¡¹ç›®å°±æ˜¯ç”±å„ç§ç»„ä»¶æ­å»ºè€Œæˆçš„`ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fbfc73e8e3ff4e57d9f3447295c13c77.png)


#### 3.1.2 æˆ‘ä»¬çš„æœŸå¾…

-   æœ‰äººæ›¿æˆ‘ä»¬åˆ›å»ºç»„ä»¶çš„å¯¹è±¡
-   æœ‰äººå¸®æˆ‘ä»¬ä¿å­˜ç»„ä»¶çš„å¯¹è±¡
-   æœ‰äººå¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ç»„è£…
-   æœ‰äººæ›¿æˆ‘ä»¬ç®¡ç†äº‹åŠ¡
-   æœ‰äººååŠ©æˆ‘ä»¬æ•´åˆå…¶ä»–æ¡†æ¶
-   ......
#### 3.1.3 Springå……å½“ç»„ä»¶ç®¡ç†è§’è‰²ï¼ˆIoCï¼‰

é‚£ä¹ˆè°å¸®æˆ‘ä»¬å®Œæˆæˆ‘ä»¬çš„æœŸå¾…ï¼Œå¸®æˆ‘ä»¬ç®¡ç†ç»„ä»¶å‘¢ï¼Ÿ

å½“ç„¶æ˜¯Spring æ¡†æ¶äº†ï¼

`ç»„ä»¶å¯ä»¥å®Œå…¨äº¤ç»™Spring æ¡†æ¶è¿›è¡Œç®¡ç†`ï¼ŒSpringæ¡†æ¶æ›¿ä»£äº†ç¨‹åºå‘˜åŸæœ‰çš„newå¯¹è±¡å’Œå¯¹è±¡å±æ€§èµ‹å€¼åŠ¨ä½œç­‰ï¼

Springå…·ä½“çš„ç»„ä»¶ç®¡ç†åŠ¨ä½œåŒ…å«ï¼š
-   ç»„ä»¶å¯¹è±¡å®ä¾‹åŒ–
-   ç»„ä»¶å±æ€§å±æ€§èµ‹å€¼
-   ç»„ä»¶å¯¹è±¡ä¹‹é—´å¼•ç”¨
-   ç»„ä»¶å¯¹è±¡å­˜æ´»å‘¨æœŸç®¡ç†
-   ......
	æˆ‘ä»¬åªéœ€è¦ç¼–å†™å…ƒæ•°æ®ï¼ˆé…ç½®æ–‡ä»¶ï¼‰å‘ŠçŸ¥Spring ç®¡ç†å“ªäº›ç±»ç»„ä»¶å’Œä»–ä»¬çš„å…³ç³»å³å¯ï¼
	
æ³¨æ„ï¼šç»„ä»¶æ˜¯æ˜ å°„åˆ°åº”ç”¨ç¨‹åºä¸­æ‰€æœ‰å¯é‡ç”¨ç»„ä»¶çš„Javaå¯¹è±¡ï¼Œåº”è¯¥æ˜¯å¯å¤ç”¨çš„åŠŸèƒ½å¯¹è±¡ï¼
-   `ç»„ä»¶ä¸€å®šæ˜¯å¯¹è±¡`
-   `å¯¹è±¡ä¸ä¸€å®šæ˜¯ç»„ä»¶`
	ç»¼ä¸Šæ‰€è¿°ï¼ŒSpring å……å½“ä¸€ä¸ªç»„ä»¶å®¹å™¨ï¼Œåˆ›å»ºã€ç®¡ç†ã€å­˜å‚¨ç»„ä»¶ï¼Œå‡å°‘äº†æˆ‘ä»¬çš„ç¼–ç å‹åŠ›ï¼Œè®©æˆ‘ä»¬æ›´åŠ ä¸“æ³¨è¿›è¡Œä¸šåŠ¡ç¼–å†™ï¼
#### 3.1.4 ç»„ä»¶äº¤ç»™Springç®¡ç†ä¼˜åŠ¿!

1.  `é™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§`ï¼šSpring IoCå®¹å™¨é€šè¿‡ä¾èµ–æ³¨å…¥æœºåˆ¶ï¼Œå°†ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»å‰Šå¼±ï¼Œå‡å°‘äº†ç¨‹åºç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œä½¿å¾—ç»„ä»¶æ›´åŠ æ¾æ•£åœ°è€¦åˆã€‚
2.  `æé«˜äº†ä»£ç çš„å¯é‡ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§`ï¼šå°†ç»„ä»¶çš„å®ä¾‹åŒ–è¿‡ç¨‹ã€ä¾èµ–å…³ç³»çš„ç®¡ç†ç­‰åŠŸèƒ½äº¤ç»™Spring IoCå®¹å™¨å¤„ç†ï¼Œä½¿å¾—ç»„ä»¶ä»£ç æ›´åŠ æ¨¡å—åŒ–ã€å¯é‡ç”¨ã€æ›´æ˜“äºç»´æŠ¤ã€‚
3.  `æ–¹ä¾¿äº†é…ç½®å’Œç®¡ç†`ï¼šSpring IoCå®¹å™¨é€šè¿‡XMLæ–‡ä»¶æˆ–è€…æ³¨è§£ï¼Œè½»æ¾çš„å¯¹ç»„ä»¶è¿›è¡Œé…ç½®å’Œç®¡ç†ï¼Œä½¿å¾—ç»„ä»¶çš„åˆ‡æ¢ã€æ›¿æ¢ç­‰æ“ä½œæ›´åŠ çš„æ–¹ä¾¿å’Œå¿«æ·ã€‚
4.  äº¤ç»™Springç®¡ç†çš„å¯¹è±¡ï¼ˆç»„ä»¶ï¼‰ï¼Œæ–¹å¯äº«å—Springæ¡†æ¶çš„å…¶ä»–åŠŸèƒ½ï¼ˆAOP,å£°æ˜äº‹åŠ¡ç®¡ç†ï¼‰ç­‰

### 3.2 Spring IoCå®¹å™¨å’Œå®¹å™¨å®ç°

#### 3.2.1 æ™®é€šå’Œå¤æ‚å®¹å™¨

**æ™®é€šå®¹å™¨**
ç”Ÿæ´»ä¸­çš„æ™®é€šå®¹å™¨ ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/f0795047f504a159b54c97b9c3704a0b.png)


> æ™®é€šå®¹å™¨åªèƒ½ç”¨æ¥å­˜å‚¨ï¼Œæ²¡æœ‰æ›´å¤šåŠŸèƒ½ã€‚
> ç¨‹åºä¸­çš„æ™®é€šå®¹å™¨
-   æ•°ç»„
-   é›†åˆï¼šList
-   é›†åˆï¼šSet

	**å¤æ‚å®¹å™¨**
ç”Ÿæ´»ä¸­çš„å¤æ‚å®¹å™¨

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/90d659d8e96042e03c749000ac4d87db.png)


> æ”¿åºœç®¡ç†æˆ‘ä»¬çš„ä¸€ç”Ÿï¼Œç”Ÿè€ç—…æ­»éƒ½å’Œæ”¿åºœæœ‰å…³ã€‚
> ç¨‹åºä¸­çš„å¤æ‚å®¹å™¨

- Servlet å®¹å™¨èƒ½å¤Ÿç®¡ç† Servlet(init,service,destroy)ã€Filterã€Listener è¿™æ ·çš„ç»„ä»¶çš„ä¸€ç”Ÿï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªå¤æ‚å®¹å™¨ã€‚

| åç§°                                                                                  | æ—¶æœº                                    | æ¬¡æ•° |
| ----------------------------------------------------------------------------------- | ------------------------------------- | -- |
| åˆ›å»ºå¯¹è±¡                                                                                | é»˜è®¤æƒ…å†µï¼šæ¥æ”¶åˆ°ç¬¬ä¸€æ¬¡è¯·æ±‚ &#xA;ä¿®æ”¹å¯åŠ¨é¡ºåºåï¼šWebåº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­ | ä¸€æ¬¡ |
| åˆå§‹åŒ–æ“ä½œ                                                                               | åˆ›å»ºå¯¹è±¡ä¹‹å                                | ä¸€æ¬¡ |
| å¤„ç†è¯·æ±‚                                                                                | æ¥æ”¶åˆ°è¯·æ±‚                                 | å¤šæ¬¡ |
| é”€æ¯æ“ä½œ                                                                                | Webåº”ç”¨å¸è½½ä¹‹å‰                             | ä¸€æ¬¡ |

æˆ‘ä»¬å³å°†è¦å­¦ä¹ çš„ SpringIoC å®¹å™¨ä¹Ÿæ˜¯ä¸€ä¸ªå¤æ‚å®¹å™¨ã€‚å®ƒä»¬ä¸ä»…è¦è´Ÿè´£åˆ›å»ºç»„ä»¶çš„å¯¹è±¡ã€å­˜å‚¨ç»„ä»¶çš„å¯¹è±¡ï¼Œè¿˜è¦è´Ÿè´£è°ƒç”¨ç»„ä»¶çš„æ–¹æ³•è®©å®ƒä»¬å·¥ä½œï¼Œæœ€ç»ˆåœ¨ç‰¹å®šæƒ…å†µä¸‹é”€æ¯ç»„ä»¶ã€‚

`æ€»ç»“ï¼šSpringç®¡ç†ç»„ä»¶çš„å®¹å™¨ï¼Œå°±æ˜¯ä¸€ä¸ªå¤æ‚å®¹å™¨ï¼Œä¸ä»…å­˜å‚¨ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥ç®¡ç†ç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”åˆ›å»ºå’Œé”€æ¯ç»„ä»¶ç­‰ï¼`

#### 3.2.2 SpringIoCå®¹å™¨ä»‹ç»

Spring IoC å®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£… beanï¼ˆç»„ä»¶ï¼‰ã€‚å®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®æ¥è·å–æœ‰å…³è¦å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…ç»„ä»¶çš„æŒ‡ä»¤ã€‚é…ç½®å…ƒæ•°æ®ä»¥` XML`ã€`Java æ³¨è§£`æˆ– `Java ä»£ç å½¢å¼`è¡¨ç°ã€‚å®ƒå…è®¸è¡¨è¾¾ç»„æˆåº”ç”¨ç¨‹åºçš„ç»„ä»¶ä»¥åŠè¿™äº›ç»„ä»¶ä¹‹é—´ä¸°å¯Œçš„ç›¸äº’ä¾èµ–å…³ç³»ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/91508c6ae5ed25eee740cfc5629a2a76.png)


ä¸Šå›¾æ˜¾ç¤ºäº† Spring å®¹å™¨å·¥ä½œåŸç†çš„é«˜çº§è§†å›¾ã€‚åº”ç”¨ç¨‹åºç±»ä¸é…ç½®å…ƒæ•°æ®ç›¸ç»“åˆï¼Œæ‚¨æ‹¥æœ‰å®Œå…¨é…ç½®ä¸”å¯æ‰§è¡Œçš„ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºã€‚
#### 3.2.3 SpringIoCå®¹å™¨å…·ä½“æ¥å£å’Œå®ç°ç±»

**SpringIocå®¹å™¨æ¥å£**ï¼š

`BeanFactory` æ¥å£æä¾›äº†ä¸€ç§é«˜çº§é…ç½®æœºåˆ¶ï¼Œèƒ½å¤Ÿç®¡ç†ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œå®ƒæ˜¯SpringIoCå®¹å™¨æ ‡å‡†åŒ–è¶…æ¥å£ï¼

`ApplicationContext` æ˜¯ `BeanFactory` çš„å­æ¥å£ã€‚å®ƒæ‰©å±•äº†ä»¥ä¸‹åŠŸèƒ½ï¼š
-   æ›´å®¹æ˜“ä¸ Spring çš„ AOP åŠŸèƒ½é›†æˆ
-   æ¶ˆæ¯èµ„æºå¤„ç†ï¼ˆç”¨äºå›½é™…åŒ–ï¼‰
-   ç‰¹å®šäºåº”ç”¨ç¨‹åºç»™äºˆæ­¤æ¥å£å®ç°ï¼Œä¾‹å¦‚Web åº”ç”¨ç¨‹åºçš„ `WebApplicationContext`
	ç®€è€Œè¨€ä¹‹ï¼Œ `BeanFactory` æä¾›äº†é…ç½®æ¡†æ¶å’ŒåŸºæœ¬åŠŸèƒ½ï¼Œè€Œ `ApplicationContext` æ·»åŠ äº†æ›´å¤šç‰¹å®šäºä¼ä¸šçš„åŠŸèƒ½ã€‚ `ApplicationContext` æ˜¯ `BeanFactory` çš„å®Œæ•´è¶…é›†ï¼
**ApplicationContextå®¹å™¨å®ç°ç±»**ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3ae44c34d001602eb248fc2e65629aa0.png)


| ç±»å‹å                                | ç®€ä»‹                                                            |
| ---------------------------------- | ------------------------------------------------------------- |
| ***ClassPathXmlApplicationContext***     | é€šè¿‡è¯»å–ç±»è·¯å¾„ä¸‹çš„ XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡                              |
| ***FileSystemXmlApplicationContext***    | é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè·¯å¾„è¯»å– XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡                             |
| ***AnnotationConfigApplicationContext*** | é€šè¿‡è¯»å–Javaé…ç½®ç±»åˆ›å»º IOC å®¹å™¨å¯¹è±¡                                        |
| ***WebApplicationContext***              | ä¸“é—¨ä¸º Web åº”ç”¨å‡†å¤‡ï¼ŒåŸºäº Web ç¯å¢ƒåˆ›å»º IOC å®¹å™¨å¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡å¼•å…¥å­˜å…¥ ServletContext åŸŸä¸­ã€‚ |
#### 3.2.4 SpringIoCå®¹å™¨ç®¡ç†é…ç½®æ–¹å¼

Spring IoC å®¹å™¨ä½¿ç”¨å¤šç§å½¢å¼çš„é…ç½®å…ƒæ•°æ®ã€‚æ­¤é…ç½®å…ƒæ•°æ®è¡¨ç¤ºæ‚¨ä½œä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¦‚ä½•å‘Šè¯‰ Spring å®¹å™¨å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/91508c6ae5ed25eee740cfc5629a2a76.png)



Springæ¡†æ¶æä¾›äº†å¤šç§é…ç½®æ–¹å¼ï¼šXMLé…ç½®æ–¹å¼ã€æ³¨è§£æ–¹å¼å’ŒJavaé…ç½®ç±»æ–¹å¼
1.  `XMLé…ç½®æ–¹å¼`ï¼šæ˜¯Springæ¡†æ¶æœ€æ—©çš„é…ç½®æ–¹å¼ä¹‹ä¸€ï¼Œé€šè¿‡åœ¨XMLæ–‡ä»¶ä¸­å®šä¹‰BeanåŠå…¶ä¾èµ–å…³ç³»ã€Beançš„ä½œç”¨åŸŸç­‰ä¿¡æ¯ï¼Œè®©Spring IoCå®¹å™¨æ¥ç®¡ç†Beanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚è¯¥æ–¹å¼ä»Springæ¡†æ¶çš„ç¬¬ä¸€ç‰ˆå¼€å§‹æä¾›æ”¯æŒã€‚
2.  `æ³¨è§£æ–¹å¼`ï¼šä»Spring 2.5ç‰ˆæœ¬å¼€å§‹æä¾›æ”¯æŒï¼Œå¯ä»¥é€šè¿‡åœ¨Beanç±»ä¸Šä½¿ç”¨æ³¨è§£æ¥ä»£æ›¿XMLé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚é€šè¿‡åœ¨Beanç±»ä¸ŠåŠ ä¸Šç›¸åº”çš„æ³¨è§£ï¼ˆå¦‚@Component, @Service, @Autowiredç­‰ï¼‰ï¼Œå°†Beanæ³¨å†Œåˆ°Spring IoCå®¹å™¨ä¸­ï¼Œè¿™æ ·Spring IoCå®¹å™¨å°±å¯ä»¥ç®¡ç†è¿™äº›Beanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚
3.  `Javaé…ç½®ç±»æ–¹å¼`ï¼šä»Spring 3.0ç‰ˆæœ¬å¼€å§‹æä¾›æ”¯æŒï¼Œé€šè¿‡Javaç±»æ¥å®šä¹‰Beanã€Beanä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œé…ç½®ä¿¡æ¯ï¼Œä»è€Œä»£æ›¿XMLé…ç½®æ–‡ä»¶çš„æ–¹å¼ã€‚Javaé…ç½®ç±»æ˜¯ä¸€ç§ä½¿ç”¨Javaç¼–å†™é…ç½®ä¿¡æ¯çš„æ–¹å¼ï¼Œé€šè¿‡@Configurationã€@Beanç­‰æ³¨è§£æ¥å®ç°Beanå’Œä¾èµ–å…³ç³»çš„é…ç½®ã€‚
	ä¸ºäº†è¿åˆå½“ä¸‹å¼€å‘ç¯å¢ƒï¼Œæˆ‘ä»¬å°†ä»¥`é…ç½®ç±»+æ³¨è§£æ–¹å¼`ä¸ºä¸»è¿›è¡Œè®²è§£ï¼

### 3.3 Spring IoC / DIæ¦‚å¿µæ€»ç»“

-   `IoCå®¹å™¨`
    Spring IoC å®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£… beanï¼ˆç»„ä»¶ï¼‰æ ¸å¿ƒå®¹å™¨ã€‚å®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®æ¥è·å–æœ‰å…³è¦å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…ç»„ä»¶çš„æŒ‡ä»¤ã€‚

-   `IoCï¼ˆInversion of Controlï¼‰æ§åˆ¶åè½¬`
    IoC ä¸»è¦æ˜¯é’ˆå¯¹å¯¹è±¡çš„åˆ›å»ºå’Œè°ƒç”¨æ§åˆ¶è€Œè¨€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¸å†æ˜¯åº”ç”¨ç¨‹åºç›´æ¥åˆ›å»ºè¯¥å¯¹è±¡ï¼Œè€Œæ˜¯ç”± IoC å®¹å™¨æ¥åˆ›å»ºå’Œç®¡ç†ï¼Œå³æ§åˆ¶æƒç”±åº”ç”¨ç¨‹åºè½¬ç§»åˆ° IoC å®¹å™¨ä¸­ï¼Œä¹Ÿå°±æ˜¯â€œåè½¬â€äº†æ§åˆ¶æƒã€‚è¿™ç§æ–¹å¼åŸºæœ¬ä¸Šæ˜¯é€šè¿‡ä¾èµ–æŸ¥æ‰¾çš„æ–¹å¼æ¥å®ç°çš„ï¼Œå³ IoC å®¹å™¨ç»´æŠ¤ç€æ„æˆåº”ç”¨ç¨‹åºçš„å¯¹è±¡ï¼Œå¹¶è´Ÿè´£åˆ›å»ºè¿™äº›å¯¹è±¡ã€‚

-   `DI (Dependency Injection) ä¾èµ–æ³¨å…¥`
    DI æ˜¯æŒ‡åœ¨ç»„ä»¶ä¹‹é—´ä¼ é€’ä¾èµ–å…³ç³»çš„è¿‡ç¨‹ä¸­ï¼Œå°†ä¾èµ–å…³ç³»åœ¨å®¹å™¨å†…éƒ¨è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±ä¸å¿…åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ç¡¬ç¼–ç å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå®ç°äº†å¯¹è±¡ä¹‹é—´çš„è§£è€¦åˆã€‚åœ¨ Spring ä¸­ï¼ŒDI æ˜¯é€šè¿‡ XML é…ç½®æ–‡ä»¶æˆ–æ³¨è§£çš„æ–¹å¼å®ç°çš„ã€‚å®ƒæä¾›äº†ä¸‰ç§å½¢å¼çš„ä¾èµ–æ³¨å…¥ï¼šæ„é€ å‡½æ•°æ³¨å…¥ã€Setter æ–¹æ³•æ³¨å…¥å’Œæ¥å£æ³¨å…¥ã€‚

## 4 Spring IoCå®è·µå’Œåº”ç”¨

### 4.1 Spring IoC / DI å®ç°æ­¥éª¤

> æˆ‘ä»¬æ€»ç»“ä¸‹ï¼Œç»„ä»¶äº¤ç»™Spring IoCå®¹å™¨ç®¡ç†ï¼Œå¹¶ä¸”è·å–å’Œä½¿ç”¨çš„åŸºæœ¬æ­¥éª¤ï¼

- `æ­¥éª¤ä¸€ï¼šé…ç½®å…ƒæ•°æ®ï¼ˆé…ç½®ï¼‰`

    é…ç½®å…ƒæ•°æ®ï¼Œæ—¢æ˜¯ç¼–å†™äº¤ç»™SpringIoCå®¹å™¨ç®¡ç†ç»„ä»¶çš„ä¿¡æ¯ï¼Œé…ç½®æ–¹å¼æœ‰ä¸‰ç§ã€‚

    åŸºäº XML çš„é…ç½®å…ƒæ•°æ®çš„åŸºæœ¬ç»“æ„ï¼š

    \<bean id="..." \[1] class="..." \[2]> &#x20;
    &#x20;   \<!-- collaborators and configuration for this bean go here -->
    &#x20; \</bean>
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <!-- æ­¤å¤„è¦æ·»åŠ ä¸€äº›çº¦æŸï¼Œé…ç½®æ–‡ä»¶çš„æ ‡ç­¾å¹¶ä¸æ˜¯éšæ„å‘½å -->
    <beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd">

      <bean id="..." [1] class="..." [2]>  
        <!-- collaborators and configuration for this bean go here -->
      </bean>

      <bean id="..." class="...">
        <!-- collaborators and configuration for this bean go here -->
      </bean>
      <!-- more bean definitions go here -->
    </beans>
    ```
    Spring IoC å®¹å™¨ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªç»„ä»¶ã€‚è¿™äº› ç»„ä»¶æ˜¯ä½¿ç”¨ä½ æä¾›ç»™å®¹å™¨çš„é…ç½®å…ƒæ•°æ®ï¼ˆä¾‹å¦‚ï¼Œä»¥ XML `<bean/>` å®šä¹‰çš„å½¢å¼ï¼‰åˆ›å»ºçš„ã€‚

    \<bean /> æ ‡ç­¾ == ç»„ä»¶ä¿¡æ¯å£°æ˜
    -   `id` å±æ€§æ˜¯æ ‡è¯†å•ä¸ª Bean å®šä¹‰çš„å­—ç¬¦ä¸²ã€‚
    -   `class` å±æ€§å®šä¹‰ Bean çš„ç±»å‹å¹¶ä½¿ç”¨å®Œå…¨é™å®šçš„ç±»åã€‚

- `æ­¥éª¤äºŒï¼šå®ä¾‹åŒ–IoCå®¹å™¨`

    æä¾›ç»™ `ApplicationContext` æ„é€ å‡½æ•°çš„ä½ç½®è·¯å¾„æ˜¯èµ„æºå­—ç¬¦ä¸²åœ°å€ï¼Œå…è®¸å®¹å™¨ä»å„ç§å¤–éƒ¨èµ„æºï¼ˆå¦‚æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€Java `CLASSPATH` ç­‰ï¼‰åŠ è½½é…ç½®å…ƒæ•°æ®ã€‚

    æˆ‘ä»¬åº”è¯¥é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å®¹å™¨å®ç°ç±»ï¼Œè¿›è¡ŒIoCå®¹å™¨çš„å®ä¾‹åŒ–å·¥ä½œï¼š
    ```java
    //å®ä¾‹åŒ–iocå®¹å™¨,è¯»å–å¤–éƒ¨é…ç½®æ–‡ä»¶,æœ€ç»ˆä¼šåœ¨å®¹å™¨å†…è¿›è¡Œiocå’ŒdiåŠ¨ä½œ
    ApplicationContext context = 
               new ClassPathXmlApplicationContext("services.xml", "daos.xml");
    ```

- `æ­¥éª¤ä¸‰ï¼šè·å–Beanï¼ˆç»„ä»¶ï¼‰`

    `ApplicationContext` æ˜¯ä¸€ä¸ªé«˜çº§å·¥å‚çš„æ¥å£ï¼Œèƒ½å¤Ÿç»´æŠ¤ä¸åŒ bean åŠå…¶ä¾èµ–é¡¹çš„æ³¨å†Œè¡¨ã€‚é€šè¿‡ä½¿ç”¨æ–¹æ³• `T getBean(String name, Class<T> requiredType)` ï¼Œæ‚¨å¯ä»¥æ£€ç´¢ bean çš„å®ä¾‹ã€‚

    å…è®¸è¯»å– Bean å®šä¹‰å¹¶è®¿é—®å®ƒä»¬ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š
    ```java
    //åˆ›å»ºiocå®¹å™¨å¯¹è±¡ï¼ŒæŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œiocä¹Ÿå¼€å§‹å®ä¾‹ç»„ä»¶å¯¹è±¡
    ApplicationContext context = new ClassPathXmlApplicationContext("services.xml", "daos.xml");
    //è·å–iocå®¹å™¨çš„ç»„ä»¶å¯¹è±¡
    PetStoreService service = context.getBean("petStore", PetStoreService.class);
    //ä½¿ç”¨ç»„ä»¶å¯¹è±¡
    List<String> userList = service.getUsernameList();
    ```

### 4.2 åŸºäºXMLé…ç½®æ–¹å¼ç»„ä»¶ç®¡ç†

#### 4.2.1 å®éªŒä¸€ï¼š ç»„ä»¶ï¼ˆBeanï¼‰ä¿¡æ¯å£°æ˜é…ç½®ï¼ˆIoCï¼‰

1.  `ç›®æ ‡`

    Spring IoC å®¹å™¨ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ª beanã€‚è¿™äº› Bean æ˜¯ä½¿ç”¨æ‚¨æä¾›ç»™å®¹å™¨çš„é…ç½®å…ƒæ•°æ®åˆ›å»ºçš„ï¼ˆä¾‹å¦‚ï¼Œä»¥ XML `<bean/>` å®šä¹‰çš„å½¢å¼ï¼‰ã€‚

    æˆ‘ä»¬å­¦ä¹ ï¼Œå¦‚ä½•é€šè¿‡å®šä¹‰XMLé…ç½®æ–‡ä»¶ï¼Œå£°æ˜ç»„ä»¶ç±»ä¿¡æ¯ï¼Œäº¤ç»™ Spring çš„ IoC å®¹å™¨è¿›è¡Œç»„ä»¶ç®¡ç†ï¼
    
2.  `æ€è·¯`

	![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/86a110e6a9ad3d503dfd9f9d396d390d.png)


3.  `å‡†å¤‡é¡¹ç›®`
    1.  åˆ›å»ºmavenå·¥ç¨‹ï¼ˆspring-ioc-xml-01ï¼‰
    2.  å¯¼å…¥SpringIoCç›¸å…³ä¾èµ–

        pom.xml
        ```xml
        <dependencies>
            <!--spring contextä¾èµ–-->
            <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-context</artifactId>
                <version>6.0.6</version>
            </dependency>
            <!--junit5æµ‹è¯•-->
            <dependency>
                <groupId>org.junit.jupiter</groupId>
                <artifactId>junit-jupiter-api</artifactId>
                <version>5.3.1</version>
            </dependency>
        </dependencies>
        ```

4.  `åŸºäºæ— å‚æ•°æ„é€ å‡½æ•°`
    > å½“é€šè¿‡æ„é€ å‡½æ•°æ–¹æ³•åˆ›å»ºä¸€ä¸ª beanï¼ˆç»„ä»¶å¯¹è±¡ï¼‰ æ—¶ï¼Œæ‰€æœ‰æ™®é€šç±»éƒ½å¯ä»¥ç”± Spring ä½¿ç”¨å¹¶ä¸ä¹‹å…¼å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­£åœ¨å¼€å‘çš„ç±»ä¸éœ€è¦å®ç°ä»»ä½•ç‰¹å®šçš„æ¥å£æˆ–ä»¥ç‰¹å®šçš„æ–¹å¼è¿›è¡Œç¼–ç ã€‚åªéœ€æŒ‡å®š Bean ç±»ä¿¡æ¯å°±è¶³å¤Ÿäº†ã€‚ä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé»˜è®¤ï¼ˆç©ºï¼‰æ„é€ å‡½æ•°ã€‚

	1.  å‡†å¤‡ç»„ä»¶ç±»
	```java
	package com.atguigu.ioc;
	public class HappyComponent {
		//é»˜è®¤åŒ…å«æ— å‚æ•°æ„é€ å‡½æ•°
		public void doWork() {
			System.out.println("HappyComponent.doWork");
		}
	}
	```
    2.  xmlé…ç½®æ–‡ä»¶ç¼–å†™

        åˆ›å»ºæºå¸¦springçº¦æŸçš„xmlé…ç½®æ–‡ä»¶,ç¼–å†™é…ç½®æ–‡ä»¶ï¼š

        æ–‡ä»¶ï¼šresources/spring-bean-01.xml
        ```xml
        <?xml version="1.0" encoding="UTF-8"?>  
<beans xmlns="http://www.springframework.org/schema/beans"  
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">  
    <bean id="work" class="com.dakkk.HappyComponent"/>  
</beans>
    ```
        -   beanæ ‡ç­¾ï¼šé€šè¿‡é…ç½®beanæ ‡ç­¾å‘Šè¯‰IOCå®¹å™¨éœ€è¦åˆ›å»ºå¯¹è±¡çš„ç»„ä»¶ä¿¡æ¯
        -   idå±æ€§ï¼šbeançš„å”¯ä¸€æ ‡è¯†,æ–¹ä¾¿åæœŸè·å–Beanï¼
        -   classå±æ€§ï¼šç»„ä»¶ç±»çš„å…¨é™å®šç¬¦ï¼
        -   æ³¨æ„ï¼šè¦æ±‚å½“å‰ç»„ä»¶ç±»å¿…é¡»åŒ…å«æ— å‚æ•°æ„é€ å‡½æ•°ï¼

5.  `åŸºäºé™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–`
    > é™¤äº†ä½¿ç”¨æ„é€ å‡½æ•°å®ä¾‹åŒ–å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ç±»æ˜¯é€šè¿‡å·¥å‚æ¨¡å¼å®ä¾‹åŒ–å¯¹è±¡ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è®²è§£å¦‚ä½•å®šä¹‰ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºBeançš„é…ç½® ï¼
    
	1.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public class ClientService {
          private static ClientService clientService = new ClientService();
          private ClientService() {}

          public static ClientService createInstance() {
          
            return clientService;
          }
        }
        ```
    2.  xmlé…ç½®æ–‡ä»¶ç¼–å†™

        æ–‡ä»¶ï¼šresources/spring-bean-01.xml
        ```xml
        <bean id="clientService"
          class="examples.ClientService"
          factory-method="createInstance"/>
        ```
        -   classå±æ€§ï¼šæŒ‡å®šå·¥å‚ç±»çš„å…¨é™å®šç¬¦ï¼
        -   *factory-method: æŒ‡å®šé™æ€å·¥å‚æ–¹æ³•ï¼Œæ³¨æ„ï¼Œè¯¥æ–¹æ³•å¿…é¡»æ˜¯staticæ–¹æ³•*ã€‚

6.  `åŸºäºå®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–`
    > æ¥ä¸‹æ¥æˆ‘ä»¬è®²è§£ä¸‹å¦‚ä½•å®šä¹‰ä½¿ç”¨å®ä¾‹å·¥å‚æ–¹æ³•åˆ›å»ºBeançš„é…ç½® ï¼
    1.  å‡†å¤‡ç»„å»ºç±»
        ```java
        public class DefaultServiceLocator {
          private static ClientServiceImplclientService = new ClientServiceImpl();
          public ClientService createClientServiceInstance() {
            return clientService;
          }
        }
        ```
    2.  xmlé…ç½®æ–‡ä»¶ç¼–å†™

        æ–‡ä»¶ï¼šresources/spring-bean-01.xml
        ```xml
        <!-- å°†å·¥å‚ç±»è¿›è¡Œiocé…ç½® -->
        <bean id="serviceLocator" class="examples.DefaultServiceLocator">
        </bean>

        <!-- æ ¹æ®å·¥å‚å¯¹è±¡çš„å®ä¾‹å·¥å‚æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–ç»„ä»¶å¯¹è±¡ -->
        <bean id="clientService"
          factory-bean="serviceLocator"
          factory-method="createClientServiceInstance"/>
        ```
        -   factory-beanå±æ€§ï¼šæŒ‡å®šå½“å‰å®¹å™¨ä¸­å·¥å‚Bean çš„åç§°ã€‚
        -   factory-method:  æŒ‡å®šå®ä¾‹å·¥å‚æ–¹æ³•åã€‚æ³¨æ„ï¼Œå®ä¾‹æ–¹æ³•å¿…é¡»æ˜¯éstaticçš„ï¼

7.  `å›¾è§£IoCé…ç½®æµç¨‹`![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/9307a10c3e4aa8e88891d4dd4d4395da.png)
#### 4.2.2 å®éªŒäºŒï¼š ç»„ä»¶ï¼ˆBeanï¼‰ä¾èµ–æ³¨å…¥é…ç½®ï¼ˆDIï¼‰

1.  `ç›®æ ‡`

    é€šè¿‡é…ç½®æ–‡ä»¶,å®ç°IoCå®¹å™¨ä¸­Beanä¹‹é—´çš„å¼•ç”¨ï¼ˆä¾èµ–æ³¨å…¥DIé…ç½®ï¼‰ã€‚

    ä¸»è¦æ¶‰åŠæ³¨å…¥åœºæ™¯ï¼šåŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥å’ŒåŸºäº Setter çš„ä¾èµ–æ³¨å…¥ã€‚

2.  `æ€è·¯`
   ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/602b01e55a2635ad7e9dec1545565484.png)


3.  `åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥`ï¼ˆ`å•ä¸ªæ„é€ å‚æ•°`ï¼‰
    1.  ä»‹ç»
        åŸºäºæ„é€ å‡½æ•°çš„ DI æ˜¯é€šè¿‡å®¹å™¨è°ƒç”¨å…·æœ‰å¤šä¸ªå‚æ•°çš„æ„é€ å‡½æ•°æ¥å®Œæˆçš„ï¼Œæ¯ä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªä¾èµ–é¡¹ã€‚
        ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºä¸€ä¸ªåªèƒ½é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥è¿›è¡Œä¾èµ–é¡¹æ³¨å…¥çš„ç±»ï¼

	2.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public class UserDao {
        }

        public class UserService {
            private UserDao userDao;
            public UserService(UserDao userDao) {
                this.userDao = userDao;
            }
        }
        ```

	3.  ç¼–å†™é…ç½®æ–‡ä»¶

        æ–‡ä»¶ï¼šresources/spring-02.xml
        ```xml
        <beans>
          <!-- å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userService" class="x.y.UserService">
           <!-- æ„é€ å‡½æ•°å¼•ç”¨ -->
            <constructor-arg ref="userDao"/>
          </bean>
          <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userDao" class="x.y.UserDao"/>
        </beans>
        ```
        -   constructor-argæ ‡ç­¾ï¼šå¯ä»¥å¼•ç”¨æ„é€ å‚æ•° refå¼•ç”¨å…¶ä»–beançš„æ ‡è¯†ã€‚

4.  `åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥`ï¼ˆ`å¤šæ„é€ å‚æ•°è§£æ`ï¼‰
    1.  ä»‹ç»
        åŸºäºæ„é€ å‡½æ•°çš„ DI æ˜¯é€šè¿‡å®¹å™¨è°ƒç”¨å…·æœ‰å¤šä¸ªå‚æ•°çš„æ„é€ å‡½æ•°æ¥å®Œæˆçš„ï¼Œæ¯ä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªä¾èµ–é¡¹ã€‚
        ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥å¤šä¸ªå‚æ•°ï¼Œå‚æ•°åŒ…å«å…¶ä»–beanå’ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼

	2.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public class UserDao {
        }

        public class UserService {
            private UserDao userDao;
            private int age;
            private String name;
            public UserService(int age , String name ,UserDao userDao) {
                this.userDao = userDao;
                this.age = age;
                this.name = name;
            }
        }
        ```

	3.  ç¼–å†™é…ç½®æ–‡ä»¶`ï¼ˆé¡ºåºã€åç§°ã€ä¸‹æ ‡ï¼‰`
        ```xml
        <!-- åœºæ™¯1: å¤šå‚æ•°ï¼Œå¯ä»¥æŒ‰ç…§ç›¸åº”æ„é€ å‡½æ•°çš„é¡ºåºæ³¨å…¥æ•°æ® -->
        <beans>
          <bean id="userService" class="x.y.UserService">
            <!-- valueç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ -->
            <constructor-arg  value="18"/>
            <constructor-arg  value="èµµä¼Ÿé£"/>
            
            <constructor-arg  ref="userDao"/>
          </bean>
          <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userDao" class="x.y.UserDao"/>

        <!-- åœºæ™¯2: å¤šå‚æ•°ï¼Œå¯ä»¥æŒ‰ç…§ç›¸åº”æ„é€ å‡½æ•°çš„åç§°æ³¨å…¥æ•°æ® -->
        <beans>
          <bean id="userService" class="x.y.UserService">
            <!-- valueç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ -->
            <constructor-arg name="name" value="èµµä¼Ÿé£"/>
            <constructor-arg name="userDao" ref="userDao"/>
            <constructor-arg name="age"  value="18"/>
          </bean>
          <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
          <bean id="userDao" class="x.y.UserDao"/>

		 <!-- åœºæ™¯2: å¤šå‚æ•°ï¼Œå¯ä»¥æŒ‰ç…§ç›¸åº”æ„é€ å‡½æ•°çš„è§’æ ‡æ³¨å…¥æ•°æ® 
               indexä»0å¼€å§‹ æ„é€ å‡½æ•°(0,1,2....)
    -->
	    <beans>
	        <bean id="userService" class="x.y.UserService">
	        <!-- valueç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ -->
	        <constructor-arg index="1" value="èµµä¼Ÿé£"/>
	        <constructor-arg index="2" ref="userDao"/>
	        <constructor-arg index="0"  value="18"/>
	      </bean> 
	      <!-- è¢«å¼•ç”¨ç±»beanå£°æ˜ -->
	      <bean id="userDao" class="x.y.UserDao"/>
	    </beans>
        ```
        -   constructor-argæ ‡ç­¾ï¼šæŒ‡å®šæ„é€ å‚æ•°å’Œå¯¹åº”çš„å€¼
        -   constructor-argæ ‡ç­¾ï¼šnameå±æ€§æŒ‡å®šå‚æ•°åã€indexå±æ€§æŒ‡å®šå‚æ•°è§’æ ‡ã€valueå±æ€§æŒ‡å®šæ™®é€šå±æ€§å€¼

5.  `åŸºäºSetteræ–¹æ³•ä¾èµ–æ³¨å…¥`

	1.  ä»‹ç»
        å¼€å‘ä¸­ï¼Œé™¤äº†æ„é€ å‡½æ•°æ³¨å…¥ï¼ˆDIï¼‰æ›´å¤šçš„ä½¿ç”¨çš„Setteræ–¹æ³•è¿›è¡Œæ³¨å…¥ï¼
        ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºä¸€ä¸ªåªèƒ½ä½¿ç”¨çº¯ setter æ³¨å…¥è¿›è¡Œä¾èµ–é¡¹æ³¨å…¥çš„ç±»ã€‚

	2.  å‡†å¤‡ç»„ä»¶ç±»
        ```java
        public Class MovieFinder{

        }

        public class SimpleMovieLister {
          private MovieFinder movieFinder;
          private String movieName;
          public void setMovieFinder(MovieFinder movieFinder) {
            this.movieFinder = movieFinder;
          }
          public void setMovieName(String movieName){
            this.movieName = movieName;
          }

          // business logic that actually uses the injected MovieFinder is omitted...
        }
        ```

	3.  ç¼–å†™é…ç½®æ–‡ä»¶
        ```xml
        <bean id="simpleMovieLister" class="examples.SimpleMovieLister">
          <!-- setteræ–¹æ³•ï¼Œæ³¨å…¥movieFinderå¯¹è±¡çš„æ ‡è¯†id
               name = å±æ€§å  ref = å¼•ç”¨beançš„idå€¼
           -->
          <property name="movieFinder" ref="movieFinder" />

          <!-- setteræ–¹æ³•ï¼Œæ³¨å…¥åŸºæœ¬æ•°æ®ç±»å‹movieName
               name = å±æ€§å value= åŸºæœ¬ç±»å‹å€¼
           -->
          <property name="movieName" value="æ¶ˆå¤±çš„å¥¹"/>
        </bean>

        <bean id="movieFinder" class="examples.MovieFinder"/>

        ```
        -   propertyæ ‡ç­¾ï¼š å¯ä»¥ç»™setteræ–¹æ³•å¯¹åº”çš„å±æ€§èµ‹å€¼
        -   property æ ‡ç­¾ï¼š nameå±æ€§ä»£è¡¨**setæ–¹æ³•æ ‡è¯†**ã€refä»£è¡¨å¼•ç”¨beançš„æ ‡è¯†idã€valueå±æ€§ä»£è¡¨åŸºæœ¬å±æ€§å€¼

**æ€»ç»“ï¼š**

ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰åŒ…å«å¼•ç”¨ç±»å‹å’ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼ŒåŒæ—¶æ³¨å…¥çš„æ–¹å¼ä¹Ÿæœ‰å¤šç§ï¼ä¸»æµçš„æ³¨å…¥æ–¹å¼ä¸ºsetteræ–¹æ³•æ³¨å…¥å’Œæ„é€ å‡½æ•°æ³¨å…¥ï¼Œä¸¤ç§æ³¨å…¥è¯­æ³•éƒ½éœ€è¦æŒæ¡ï¼

éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šå¼•ç”¨å…¶ä»–beanï¼Œä½¿ç”¨refå±æ€§ã€‚ç›´æ¥æ³¨å…¥åŸºæœ¬ç±»å‹å€¼ï¼Œä½¿ç”¨valueå±æ€§ã€‚

#### 4.2.3 å®éªŒä¸‰ï¼š IoCå®¹å™¨åˆ›å»ºå’Œä½¿ç”¨

1.  `ä»‹ç»`

    ä¸Šé¢çš„å®éªŒåªæ˜¯è®²è§£äº†å¦‚ä½•åœ¨XMLæ ¼å¼çš„é…ç½®æ–‡ä»¶ç¼–å†™IoCå’ŒDIé…ç½®ï¼

    å¦‚å›¾ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/91508c6ae5ed25eee740cfc5629a2a76.png)



    æƒ³è¦é…ç½®æ–‡ä»¶ä¸­å£°æ˜ç»„ä»¶ç±»ä¿¡æ¯çœŸæ­£çš„è¿›è¡Œå®ä¾‹åŒ–æˆBeanå¯¹è±¡å’Œå½¢æˆBeanä¹‹é—´çš„å¼•ç”¨å…³ç³»ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜IoCå®¹å™¨å¯¹è±¡ï¼Œè¯»å–é…ç½®æ–‡ä»¶ï¼Œå®ä¾‹åŒ–ç»„ä»¶å’Œå…³ç³»ç»´æŠ¤çš„è¿‡ç¨‹éƒ½æ˜¯åœ¨IoCå®¹å™¨ä¸­å®ç°çš„ï¼

2.  `å®¹å™¨å®ä¾‹åŒ–`
    ```java
    //æ–¹å¼1:å®ä¾‹åŒ–å¹¶ä¸”æŒ‡å®šé…ç½®æ–‡ä»¶
    //å‚æ•°ï¼šString...locations ä¼ å…¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªé…ç½®æ–‡ä»¶
    ApplicationContext ctx = 
               new ClassPathXmlApplicationContext("services.xml", "daos.xml");
               
    //æ–¹å¼2:å…ˆå®ä¾‹åŒ–ï¼Œå†æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œæœ€ååˆ·æ–°å®¹å™¨è§¦å‘Beanå®ä¾‹åŒ–åŠ¨ä½œ [springmvcæºç å’ŒcontextLoadListeneræºç æ–¹å¼]  
    ApplicationContext ctx = 
               new ClassPathXmlApplicationContext();   
    //è®¾ç½®é…ç½®é…ç½®æ–‡ä»¶,æ–¹æ³•å‚æ•°ä¸ºå¯å˜å‚æ•°,å¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–è€…å¤šä¸ªé…ç½®
    ctx.setConfigLocations("services.xml", "daos.xml");
    //åé…ç½®çš„æ–‡ä»¶,éœ€è¦è°ƒç”¨refreshæ–¹æ³•,è§¦å‘åˆ·æ–°é…ç½®
    ctx.refresh();           

    ```

3.  `Beanå¯¹è±¡è¯»å–`
    ```java
    //æ–¹å¼1: æ ¹æ®idè·å–
    //æ²¡æœ‰æŒ‡å®šç±»å‹,è¿”å›ä¸ºObject,éœ€è¦ç±»å‹è½¬åŒ–!
    HappyComponent happyComponent = 
            (HappyComponent) iocContainer.getBean("beançš„idæ ‡è¯†");
            
    //ä½¿ç”¨ç»„ä»¶å¯¹è±¡        
    happyComponent.doWork();

    //æ–¹å¼2: æ ¹æ®ç±»å‹è·å–
    //æ ¹æ®ç±»å‹è·å–,ä½†æ˜¯è¦æ±‚,åŒç±»å‹(å½“å‰ç±»,æˆ–è€…ä¹‹ç±»,æˆ–è€…æ¥å£çš„å®ç°ç±»)åªèƒ½æœ‰ä¸€ä¸ªå¯¹è±¡äº¤ç»™IoCå®¹å™¨ç®¡ç†
    //é…ç½®ä¸¤ä¸ªæˆ–è€…ä»¥ä¸Šå‡ºç°: org.springframework.beans.factory.NoUniqueBeanDefinitionException é—®é¢˜
    HappyComponent happyComponent = iocContainer.getBean(HappyComponent.class);
    happyComponent.doWork();

    //æ–¹å¼3: æ ¹æ®idå’Œç±»å‹è·å–
    HappyComponent happyComponent = iocContainer.getBean("beançš„idæ ‡è¯†", HappyComponent.class);
    happyComponent.doWork();
    ```

- æ ¹æ®ç±»å‹æ¥è·å–beanæ—¶ï¼Œåœ¨æ»¡è¶³beanå”¯ä¸€æ€§çš„å‰æä¸‹ï¼Œå…¶å®åªæ˜¯çœ‹ï¼šã€å¯¹è±¡ instanceof æŒ‡å®šçš„ç±»å‹ã€çš„è¿”å›ç»“æœï¼Œ
    åªè¦è¿”å›çš„æ˜¯trueå°±å¯ä»¥è®¤å®šä¸ºå’Œç±»å‹åŒ¹é…ï¼Œèƒ½å¤Ÿè·å–åˆ°ã€‚

#### 4.2.4 å®éªŒå››ï¼š é«˜çº§ç‰¹æ€§ï¼šç»„ä»¶ï¼ˆBeanï¼‰ä½œç”¨åŸŸå’Œå‘¨æœŸæ–¹æ³•é…ç½®

1.  `ç»„ä»¶å‘¨æœŸæ–¹æ³•é…ç½®`

	1.  å‘¨æœŸæ–¹æ³•æ¦‚å¿µ
        æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ç±»ä¸­å®šä¹‰æ–¹æ³•ï¼Œç„¶åå½“IoCå®¹å™¨å®ä¾‹åŒ–å’Œé”€æ¯ç»„ä»¶å¯¹è±¡çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ï¼è¿™ä¸¤ä¸ªæ–¹æ³•æˆ‘ä»¬æˆä¸ºç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼
        ç±»ä¼¼äºServletçš„init/destroyæ–¹æ³•,æˆ‘ä»¬å¯ä»¥åœ¨å‘¨æœŸæ–¹æ³•å®Œæˆåˆå§‹åŒ–å’Œé‡Šæ”¾èµ„æºç­‰å·¥ä½œã€‚

	2.  å‘¨æœŸæ–¹æ³•å£°æ˜
        ```java
        public class BeanOne {
          //å‘¨æœŸæ–¹æ³•è¦æ±‚ï¼š æ–¹æ³•å‘½åéšæ„ï¼Œä½†æ˜¯è¦æ±‚æ–¹æ³•å¿…é¡»æ˜¯ public void æ— å½¢å‚åˆ—è¡¨
          public void init() {
            // åˆå§‹åŒ–é€»è¾‘
          }
        }

        public class BeanTwo {
          public void cleanup() {
            // é‡Šæ”¾èµ„æºé€»è¾‘
          }
        }
        ```

	3.  å‘¨æœŸæ–¹æ³•é…ç½®
        ```xml
        <beans>
          <bean id="beanOne" class="examples.BeanOne" init-method="init" />
          <bean id="beanTwo" class="examples.BeanTwo" destroy-method="cleanup" />
        </beans>
        ```

2.  `ç»„ä»¶ä½œç”¨åŸŸé…ç½®`

	1.  Beanä½œç”¨åŸŸæ¦‚å¿µ

        - `<bean` æ ‡ç­¾å£°æ˜Beanï¼Œåªæ˜¯å°†Beançš„ä¿¡æ¯é…ç½®ç»™SpringIoCå®¹å™¨ï¼
        - åœ¨IoCå®¹å™¨ä¸­ï¼Œè¿™äº›`<bean`æ ‡ç­¾å¯¹åº”çš„ä¿¡æ¯è½¬æˆSpringå†…éƒ¨ `BeanDefinition` å¯¹è±¡ï¼Œ`BeanDefinition` å¯¹è±¡å†…ï¼ŒåŒ…å«å®šä¹‰çš„ä¿¡æ¯ï¼ˆid,class,å±æ€§ç­‰ç­‰ï¼‰ï¼
        - è¿™æ„å‘³ç€ï¼Œ`BeanDefinition`ä¸`ç±»`æ¦‚å¿µä¸€æ ·ï¼ŒSpringIoCå®¹å™¨å¯ä»¥å¯ä»¥æ ¹æ®`BeanDefinition`å¯¹è±¡åå°„åˆ›å»ºå¤šä¸ªBeanå¯¹è±¡å®ä¾‹ã€‚
        - å…·ä½“åˆ›å»ºå¤šå°‘ä¸ªBeançš„å®ä¾‹å¯¹è±¡ï¼Œç”±Beançš„ä½œç”¨åŸŸScopeå±æ€§æŒ‡å®šï¼

	2.  ä½œç”¨åŸŸå¯é€‰å€¼![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/396a7772070dbf647c7d14ca43146aec.png)


    3.  ä½œç”¨åŸŸé…ç½®

        é…ç½®scopeèŒƒå›´
        ```xml
        <!--beançš„ä½œç”¨åŸŸ 
            å‡†å¤‡ä¸¤ä¸ªå¼•ç”¨å…³ç³»çš„ç»„ä»¶ç±»å³å¯ï¼ï¼
        -->
        <!-- scopeå±æ€§ï¼šå–å€¼singletonï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œbeanåœ¨IOCå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ŒIOCå®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»ºå¯¹è±¡ -->
        <!-- scopeå±æ€§ï¼šå–å€¼prototypeï¼Œbeanåœ¨IOCå®¹å™¨ä¸­å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼ŒgetBean()æ—¶åˆ›å»ºå¯¹è±¡ -->
        <bean id="happyMachine8" scope="prototype" class="com.atguigu.ioc.HappyMachine">
            <property name="machineName" value="happyMachine"/>
        </bean>

        <bean id="happyComponent8" scope="singleton" class="com.atguigu.ioc.HappyComponent">
            <property name="componentName" value="happyComponent"/>
        </bean>
        ```
    4.  ä½œç”¨åŸŸæµ‹è¯•
        ```java
        @Test
        public void testExperiment08()  {
            ApplicationContext iocContainer = new ClassPathXmlApplicationContext("é…ç½®æ–‡ä»¶å");

            HappyMachine bean = iocContainer.getBean(HappyMachine.class);
            HappyMachine bean1 = iocContainer.getBean(HappyMachine.class);
            //å¤šä¾‹å¯¹æ¯” false
            System.out.println(bean == bean1);

            HappyComponent bean2 = iocContainer.getBean(HappyComponent.class);
            HappyComponent bean3 = iocContainer.getBean(HappyComponent.class);
            //å•ä¾‹å¯¹æ¯” true
            System.out.println(bean2 == bean3);
        }
        ```

#### 4.2.5 å®éªŒäº”ï¼š é«˜çº§ç‰¹æ€§ï¼šFactoryBeanç‰¹æ€§å’Œä½¿ç”¨

1.  `FactoryBeanç®€ä»‹`

    `FactoryBean` æ¥å£æ˜¯Spring IoCå®¹å™¨å®ä¾‹åŒ–é€»è¾‘çš„å¯æ’æ‹”æ€§ç‚¹ã€‚

    ç”¨äºé…ç½®å¤æ‚çš„Beanå¯¹è±¡ï¼Œå¯ä»¥å°†åˆ›å»ºè¿‡ç¨‹å­˜å‚¨åœ¨`FactoryBean` çš„getObjectæ–¹æ³•ï¼

    `FactoryBean<T>` æ¥å£æä¾›ä¸‰ç§æ–¹æ³•ï¼š
    -   `T getObject()`
        è¿”å›æ­¤å·¥å‚åˆ›å»ºçš„å¯¹è±¡çš„å®ä¾‹ã€‚è¯¥è¿”å›å€¼ä¼šè¢«å­˜å‚¨åˆ°IoCå®¹å™¨ï¼
        
    -   `boolean isSingleton()`
        å¦‚æœæ­¤ `FactoryBean` è¿”å›å•ä¾‹ï¼Œåˆ™è¿”å› `true` ï¼Œå¦åˆ™è¿”å› `false` ã€‚æ­¤æ–¹æ³•çš„é»˜è®¤å®ç°è¿”å› `true` ï¼ˆæ³¨æ„ï¼Œlombokæ’ä»¶ä½¿ç”¨ï¼Œå¯èƒ½å½±å“æ•ˆæœï¼‰ã€‚
        
    -   `Class<?> getObjectType()`: è¿”å› `getObject()` æ–¹æ³•è¿”å›çš„å¯¹è±¡ç±»å‹ï¼Œå¦‚æœäº‹å…ˆä¸çŸ¥é“ç±»å‹ï¼Œåˆ™è¿”å› `null` ã€‚
        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7d9f660b7167211c17c3e63b62beca78.png)


2.  `FactoryBeanä½¿ç”¨åœºæ™¯`
    1.  ä»£ç†ç±»çš„åˆ›å»º
    2.  ç¬¬ä¸‰æ–¹æ¡†æ¶æ•´åˆ
    3.  å¤æ‚å¯¹è±¡å®ä¾‹åŒ–ç­‰

3.  `Factorybeanåº”ç”¨`
    1.  å‡†å¤‡FactoryBeanå®ç°ç±»
        ```java
        // å®ç°FactoryBeanæ¥å£æ—¶éœ€è¦æŒ‡å®šæ³›å‹
        // æ³›å‹ç±»å‹å°±æ˜¯å½“å‰å·¥å‚è¦ç”Ÿäº§çš„å¯¹è±¡çš„ç±»å‹
        public class HappyFactoryBean implements FactoryBean<HappyMachine> {
            
            private String machineName;
            
            public String getMachineName() {
                return machineName;
            }
            
            public void setMachineName(String machineName) {
                this.machineName = machineName;
            }
            
            @Override
            public HappyMachine getObject() throws Exception {
            
                // æ–¹æ³•å†…éƒ¨æ¨¡æ‹Ÿåˆ›å»ºã€è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„å¤æ‚è¿‡ç¨‹
                HappyMachine happyMachine = new HappyMachine();
            
                happyMachine.setMachineName(this.machineName);
            
                return happyMachine;
            }
            
            @Override
            public Class<?> getObjectType() {
            
                // è¿”å›è¦ç”Ÿäº§çš„å¯¹è±¡çš„ç±»å‹
                return HappyMachine.class;
            }
        }
        ```

	2.  é…ç½®FactoryBeanå®ç°ç±»
        ```xml
        <!-- FactoryBeanæœºåˆ¶ -->
        <!-- è¿™ä¸ªbeanæ ‡ç­¾ä¸­classå±æ€§æŒ‡å®šçš„æ˜¯HappyFactoryBeanï¼Œä½†æ˜¯å°†æ¥ä»è¿™é‡Œè·å–çš„beanæ˜¯HappyMachineå¯¹è±¡ -->
        <bean id="happyMachine7" class="com.atguigu.ioc.HappyFactoryBean">
            <!-- propertyæ ‡ç­¾ä»ç„¶å¯ä»¥ç”¨æ¥é€šè¿‡setXxx()æ–¹æ³•ç»™å±æ€§èµ‹å€¼ -->
            <property name="machineName" value="iceCreamMachine"/>
        </bean>
        ```

	3.  æµ‹è¯•è¯»å–FactoryBeanå’ŒFactoryBean.getObjectå¯¹è±¡
        ```java
        @Test
        public void testExperiment07()  {

            ApplicationContext iocContainer = new ClassPathXmlApplicationContext("spring-bean-07.xml");

            //æ³¨æ„: ç›´æ¥æ ¹æ®å£°æ˜FactoryBeançš„id,è·å–çš„æ˜¯getObjectæ–¹æ³•è¿”å›çš„å¯¹è±¡
            HappyMachine happyMachine = iocContainer.getBean("happyMachine7",HappyMachine.class);
            System.out.println("happyMachine = " + happyMachine);

            //å¦‚æœæƒ³è¦è·å–FactoryBeanå¯¹è±¡, ç›´æ¥åœ¨idå‰æ·»åŠ &ç¬¦å·å³å¯!  &happyMachine7 è¿™æ˜¯ä¸€ç§å›ºå®šçš„çº¦æŸ
            Object bean = iocContainer.getBean("&happyMachine7");
            System.out.println("bean = " + bean);
        }
        ```

4.  `FactoryBeanå’ŒBeanFactoryåŒºåˆ«`

    `FactoryBean`æ˜¯ Spring ä¸­ä¸€ç§ç‰¹æ®Šçš„ beanï¼Œå¯ä»¥åœ¨ getObject() å·¥å‚æ–¹æ³•è‡ªå®šä¹‰çš„é€»è¾‘åˆ›å»ºBeanï¼æ˜¯ä¸€ç§èƒ½å¤Ÿç”Ÿäº§å…¶ä»– Bean çš„ Beanã€‚FactoryBean åœ¨å®¹å™¨å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œè€Œåœ¨å®é™…ä½¿ç”¨æ—¶åˆ™æ˜¯é€šè¿‡è°ƒç”¨ getObject() æ–¹æ³•æ¥å¾—åˆ°å…¶æ‰€ç”Ÿäº§çš„ Beanã€‚å› æ­¤ï¼ŒFactoryBean å¯ä»¥è‡ªå®šä¹‰ä»»ä½•æ‰€éœ€çš„åˆå§‹åŒ–é€»è¾‘ï¼Œç”Ÿäº§å‡ºä¸€äº›å®šåˆ¶åŒ–çš„ beanã€‚

    ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ`æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œéƒ½æ˜¯é€šè¿‡å®šä¹‰FactoryBeanå®ç°ï¼ï¼ï¼`

    **BeanFactory** æ˜¯ Spring æ¡†æ¶çš„åŸºç¡€ï¼Œå…¶ä½œä¸ºä¸€ä¸ªé¡¶çº§æ¥å£å®šä¹‰äº†å®¹å™¨çš„åŸºæœ¬è¡Œä¸ºï¼Œä¾‹å¦‚ç®¡ç† bean çš„ç”Ÿå‘½å‘¨æœŸã€é…ç½®æ–‡ä»¶çš„åŠ è½½å’Œè§£æã€bean çš„è£…é…å’Œä¾èµ–æ³¨å…¥ç­‰ã€‚BeanFactory æ¥å£æä¾›äº†è®¿é—® bean çš„æ–¹å¼ï¼Œä¾‹å¦‚ getBean() æ–¹æ³•è·å–æŒ‡å®šçš„ bean å®ä¾‹ã€‚å®ƒå¯ä»¥ä»ä¸åŒçš„æ¥æºï¼ˆä¾‹å¦‚ Mysql æ•°æ®åº“ã€XML æ–‡ä»¶ã€Java é…ç½®ç±»ç­‰ï¼‰è·å– bean å®šä¹‰ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º bean å®ä¾‹ã€‚åŒæ—¶ï¼ŒBeanFactory è¿˜åŒ…å«å¾ˆå¤šå­ç±»ï¼ˆä¾‹å¦‚ï¼ŒApplicationContext æ¥å£ï¼‰æä¾›äº†é¢å¤–çš„å¼ºå¤§åŠŸèƒ½ã€‚

    æ€»çš„æ¥è¯´ï¼ŒFactoryBean å’Œ BeanFactory çš„åŒºåˆ«ä¸»è¦åœ¨äºå‰è€…æ˜¯ç”¨äºåˆ›å»º bean çš„æ¥å£ï¼Œå®ƒæä¾›äº†æ›´åŠ çµæ´»çš„åˆå§‹åŒ–å®šåˆ¶åŠŸèƒ½ï¼Œè€Œåè€…æ˜¯ç”¨äºç®¡ç† bean çš„æ¡†æ¶åŸºç¡€æ¥å£ï¼Œæä¾›äº†åŸºæœ¬çš„å®¹å™¨åŠŸèƒ½å’Œ bean ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

#### 4.2.6 å®éªŒå…­ï¼š åŸºäºXMLæ–¹å¼æ•´åˆä¸‰å±‚æ¶æ„ç»„ä»¶

1.  éœ€æ±‚åˆ†æ

    æ­å»ºä¸€ä¸ªä¸‰å±‚æ¶æ„æ¡ˆä¾‹ï¼Œæ¨¡æ‹ŸæŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿï¼ˆå­¦ç”Ÿè¡¨ï¼‰ä¿¡æ¯ï¼ŒæŒä¹…å±‚ä½¿ç”¨JdbcTemplateå’ŒDruidæŠ€æœ¯ï¼Œä½¿ç”¨XMLæ–¹å¼è¿›è¡Œç»„ä»¶ç®¡ç†ï¼

    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/e24f5d09bc817b9c7a14ffb6a6135390.png)


2.  æ•°æ®åº“å‡†å¤‡
    ```java
    create database studb;

    use studb;

    CREATE TABLE students (
      id INT PRIMARY KEY,
      name VARCHAR(50) NOT NULL,
      gender VARCHAR(10) NOT NULL,
      age INT,
      class VARCHAR(50)
    );

    INSERT INTO students (id, name, gender, age, class)
    VALUES
      (1, 'å¼ ä¸‰', 'ç”·', 20, 'é«˜ä¸­ä¸€ç­'),
      (2, 'æå››', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (3, 'ç‹äº”', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (4, 'èµµå…­', 'å¥³', 20, 'é«˜ä¸­ä¸‰ç­'),
      (5, 'åˆ˜ä¸ƒ', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (6, 'é™ˆå…«', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (7, 'æ¨ä¹', 'ç”·', 20, 'é«˜ä¸­ä¸‰ç­'),
      (8, 'å´å', 'ç”·', 19, 'é«˜ä¸­äºŒç­');

    ```

3.  é¡¹ç›®å‡†å¤‡
    1.  é¡¹ç›®åˆ›å»º

        spring-xml-practice-02
    2.  ä¾èµ–å¯¼å…¥
        ```xml
        <dependencies>
              <!--spring contextä¾èµ–-->
              <!--å½“ä½ å¼•å…¥SpringContextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-context</artifactId>
                  <version>6.0.6</version>
              </dependency>

              <!-- æ•°æ®åº“é©±åŠ¨å’Œè¿æ¥æ± -->
              <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
                  <version>8.0.25</version>
              </dependency>

              <dependency>
                  <groupId>com.alibaba</groupId>
                  <artifactId>druid</artifactId>
                  <version>1.2.8</version>
              </dependency>

              <!-- spring-jdbc -->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-jdbc</artifactId>
                  <version>6.0.6</version>
              </dependency>

        </dependencies> 
        ```

	3.  å®ä½“ç±»å‡†å¤‡
        ```java
        public class Student {

            private Integer id;
            private String name;
            private String gender;
            private Integer age;
            private String classes;

            public Integer getId() {
                return id;
            }

            public void setId(Integer id) {
                this.id = id;
            }

            public String getName() {
                return name;
            }

            public void setName(String name) {
                this.name = name;
            }

            public String getGender() {
                return gender;
            }

            public void setGender(String gender) {
                this.gender = gender;
            }

            public Integer getAge() {
                return age;
            }

            public void setAge(Integer age) {
                this.age = age;
            }

            public String getClasses() {
                return classes;
            }

            public void setClasses(String classes) {
                this.classes = classes;
            }

            @Override
            public String toString() {
                return "Student{" +
                        "id=" + id +
                        ", name='" + name + '\'' +
                        ", gender='" + gender + '\'' +
                        ", age=" + age +
                        ", classes='" + classes + '\'' +
                        '}';
            }
        }

        ```

4.  JdbcTemplateæŠ€æœ¯è®²è§£
    > ä¸ºäº†åœ¨ç‰¹å®šé¢†åŸŸå¸®åŠ©æˆ‘ä»¬ç®€åŒ–ä»£ç ï¼ŒSpring å°è£…äº†å¾ˆå¤š ã€Templateã€å½¢å¼çš„æ¨¡æ¿ç±»ã€‚ä¾‹å¦‚ï¼šRedisTemplateã€RestTemplate ç­‰ç­‰ï¼ŒåŒ…æ‹¬æˆ‘ä»¬ä»Šå¤©è¦å­¦ä¹ çš„ JdbcTemplateã€‚

    > jdbc.properties
    æå–æ•°æ®åº“è¿æ¥ä¿¡æ¯
    ```.properties
    atguigu.url=jdbc:mysql://localhost:3306/studb
    atguigu.driver=com.mysql.cj.jdbc.Driver
    atguigu.username=root
    atguigu.password=root
    ```

	springiocé…ç½®æ–‡ä»¶
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd 
           http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


        <!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
        <context:property-placeholder location="classpath:jdbc.properties" />

        <!-- é…ç½®æ•°æ®æº -->
        <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
            <property name="url" value="${atguigu.url}"/>
            <property name="driverClassName" value="${atguigu.driver}"/>
            <property name="username" value="${atguigu.username}"/>
            <property name="password" value="${atguigu.password}"/>
        </bean>

        <!-- é…ç½® JdbcTemplate -->
        <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
            <!-- è£…é…æ•°æ®æº -->
            <property name="dataSource" ref="druidDataSource"/>
        </bean>
        
    </beans>
    ```

	åŸºäºjdbcTemplateçš„CRUDä½¿ç”¨
    ```java
    public class JdbcTemplateTest {
        /**
         * ä½¿ç”¨jdbcTemplateè¿›è¡ŒDMLåŠ¨ä½œ
         */
        @Test
        public void testDML(){
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            JdbcTemplate jdbcTemplate = applicationContext.getBean(JdbcTemplate.class);
            //TODO æ‰§è¡Œæ’å…¥ä¸€æ¡å­¦å‘˜æ•°æ®
            String sql = "insert into students (id,name,gender,age,class) values (?,?,?,?,?);";
        /*
            å‚æ•°1: sqlè¯­å¥
            å‚æ•°2: å¯å˜å‚æ•°,å ä½ç¬¦çš„å€¼
         */
            int rows = jdbcTemplate.update(sql, 9,"åä¸€", "ç”·", 18, "äºŒå¹´ä¸‰ç­");

            System.out.println("rows = " + rows);

        }

        /**
         * æŸ¥è¯¢å•æ¡å®ä½“å¯¹è±¡
         *   public class Student {
         *     private Integer id;
         *     private String name;
         *     private String gender;
         *     private Integer age;
         *     private String classes;
         */
        @Test
        public void testDQLForPojo(){
            String sql = "select id , name , age , gender , class as classes from students where id = ? ;";
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            JdbcTemplate jdbcTemplate = applicationContext.getBean(JdbcTemplate.class);
            //æ ¹æ®idæŸ¥è¯¢
            Student student = jdbcTemplate.queryForObject(sql,  (rs, rowNum) -> {
                //è‡ªå·±å¤„ç†ç»“æœæ˜ å°„
                Student stu = new Student();
                stu.setId(rs.getInt("id"));
                stu.setName(rs.getString("name"));
                stu.setAge(rs.getInt("age"));
                stu.setGender(rs.getString("gender"));
                stu.setClasses(rs.getString("classes"));
                return stu;
            }, 2);

            System.out.println("student = " + student);
        }



        /**
         * æŸ¥è¯¢å®ä½“ç±»é›†åˆ
         */
        @Test
        public void testDQLForListPojo(){

            String sql = "select id , name , age , gender , class as classes from students  ;";
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            JdbcTemplate jdbcTemplate = applicationContext.getBean(JdbcTemplate.class);
        /*
            queryå¯ä»¥è¿”å›é›†åˆ!
            BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
         */
            List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));
            System.out.println("studentList = " + studentList);
        }
    }

    ```

5.  ä¸‰å±‚æ¶æ„æ­å»ºå’Œå®ç°
    1.  æŒä¹…å±‚
        ```java
        //æ¥å£
        public interface StudentDao {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            List<Student> queryAll();
        }

        //å®ç°ç±»
        public class StudentDaoImpl implements StudentDao {
            private JdbcTemplate jdbcTemplate;
            public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {
                this.jdbcTemplate = jdbcTemplate;
            }

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            @Override
            public List<Student> queryAll() {
                String sql = "select id , name , age , gender , class as classes from students ;";
                /*
                  queryå¯ä»¥è¿”å›é›†åˆ!
                  BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
                 */
                List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));
                return studentList;
           }
        }

        ```
    2.  ä¸šåŠ¡å±‚
        ```java
        //æ¥å£
        public interface StudentService {
            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            List<Student> findAll();
        }

        //å®ç°ç±»
        public class StudentServiceImpl  implements StudentService {

            private StudentDao studentDao;
            public void setStudentDao(StudentDao studentDao) {
                this.studentDao = studentDao;
            }

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            @Override
            public List<Student> findAll() {
                List<Student> studentList =  studentDao.queryAll();
                return studentList;
            }
        }

        ```
    3.  è¡¨è¿°å±‚
        ```java
        public class StudentController {
            
            private StudentService studentService;

            public void setStudentService(StudentService studentService) {
                this.studentService = studentService;
            }
            
            public void  findAll(){
               List<Student> studentList =  studentService.findAll();
                System.out.println("studentList = " + studentList);
            }
        }
        ```
6.  ä¸‰å±‚æ¶æ„IoCé…ç½®
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


        <!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
        <context:property-placeholder location="classpath:jdbc.properties" />

        <!-- é…ç½®æ•°æ®æº -->
        <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
            <property name="url" value="${atguigu.url}"/>
            <property name="driverClassName" value="${atguigu.driver}"/>
            <property name="username" value="${atguigu.username}"/>
            <property name="password" value="${atguigu.password}"/>
        </bean>

        <!-- é…ç½® JdbcTemplate -->
        <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
            <!-- è£…é…æ•°æ®æº -->
            <property name="dataSource" ref="druidDataSource"/>
        </bean>


        <bean id="studentDao" class="com.atguigu.dao.impl.StudentDaoImpl">
            <property name="jdbcTemplate" ref="jdbcTemplate" />
        </bean>

        <bean id="studentService" class="com.atguigu.service.impl.StudentServiceImpl">
            <property name="studentDao" ref="studentDao" />
        </bean>

        <bean id="studentController" class="com.atguigu.controller.StudentController">
            <property name="studentService" ref="studentService" />
        </bean>

    </beans>
    ```
7.  è¿è¡Œæµ‹è¯•
    ```java
    public class ControllerTest {

        @Test
        public  void testRun(){
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            StudentController studentController = applicationContext.getBean(StudentController.class);
            studentController.findAll();
        }
    }
    ```

8.  XMLIoCæ–¹å¼é—®é¢˜æ€»ç»“
    1.  æ³¨å…¥çš„å±æ€§å¿…é¡»æ·»åŠ setteræ–¹æ³•ã€ä»£ç ç»“æ„ä¹±ï¼
    2.  é…ç½®æ–‡ä»¶å’ŒJavaä»£ç åˆ†ç¦»ã€ç¼–å†™ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼
    3.  XMLé…ç½®æ–‡ä»¶è§£ææ•ˆç‡ä½

### 4.3 åŸºäº æ³¨è§£ æ–¹å¼ç®¡ç† Bean

#### 4.3.1 å®éªŒä¸€ï¼š Beanæ³¨è§£æ ‡è®°å’Œæ‰«æ (IoC)

1.  **æ³¨è§£ç†è§£**

    å’Œ XML é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œæ³¨è§£æœ¬èº«å¹¶ä¸èƒ½æ‰§è¡Œï¼Œæ³¨è§£æœ¬èº«ä»…ä»…åªæ˜¯åšä¸€ä¸ªæ ‡è®°ï¼Œå…·ä½“çš„åŠŸèƒ½æ˜¯æ¡†æ¶æ£€æµ‹åˆ°æ³¨è§£æ ‡è®°çš„ä½ç½®ï¼Œç„¶åé’ˆå¯¹è¿™ä¸ªä½ç½®æŒ‰ç…§æ³¨è§£æ ‡è®°çš„åŠŸèƒ½æ¥æ‰§è¡Œå…·ä½“æ“ä½œã€‚

    æœ¬è´¨ä¸Šï¼šæ‰€æœ‰ä¸€åˆ‡çš„æ“ä½œéƒ½æ˜¯ Java ä»£ç æ¥å®Œæˆçš„ï¼ŒXML å’Œæ³¨è§£åªæ˜¯å‘Šè¯‰æ¡†æ¶ä¸­çš„ Java ä»£ç å¦‚ä½•æ‰§è¡Œã€‚

    ä¸¾ä¾‹ï¼šå…ƒæ—¦è”æ¬¢ä¼šè¦å¸ƒç½®æ•™å®¤ï¼Œè“è‰²çš„åœ°æ–¹è´´ä¸Šå…ƒæ—¦å¿«ä¹å››ä¸ªå­—ï¼Œçº¢è‰²çš„åœ°æ–¹è´´ä¸Šæ‹‰èŠ±ï¼Œé»„è‰²çš„åœ°æ–¹è´´ä¸Šæ°”çƒã€‚

    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fff3969c25a6d2600fa10cbbb1966618.png)



    ç­é•¿åšäº†æ‰€æœ‰æ ‡è®°ï¼ŒåŒå­¦ä»¬æ¥å®Œæˆå…·ä½“å·¥ä½œã€‚å¢™ä¸Šçš„æ ‡è®°ç›¸å½“äºæˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨çš„æ³¨è§£ï¼Œåé¢åŒå­¦ä»¬åšçš„å·¥ä½œï¼Œç›¸å½“äºæ¡†æ¶çš„å…·ä½“æ“ä½œã€‚

2.  **æ‰«æç†è§£**

    Spring ä¸ºäº†çŸ¥é“ç¨‹åºå‘˜åœ¨å“ªäº›åœ°æ–¹æ ‡è®°äº†ä»€ä¹ˆæ³¨è§£ï¼Œå°±éœ€è¦é€šè¿‡æ‰«æçš„æ–¹å¼ï¼Œæ¥è¿›è¡Œæ£€æµ‹ã€‚ç„¶åæ ¹æ®æ³¨è§£è¿›è¡Œåç»­æ“ä½œã€‚

3.  **å‡†å¤‡Springé¡¹ç›®å’Œç»„ä»¶**
    1.  å‡†å¤‡é¡¹ç›®pom.xml
        ```xml
        <dependencies>
            <!--spring contextä¾èµ–-->
            <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-context</artifactId>
                <version>6.0.6</version>
            </dependency>

            <!--junit5æµ‹è¯•-->
            <dependency>
                <groupId>org.junit.jupiter</groupId>
                <artifactId>junit-jupiter-api</artifactId>
                <version>5.3.1</version>
            </dependency>
        </dependencies>
        ```
    2.  å‡†å¤‡ç»„ä»¶ç±»

        æ™®é€šç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: æ™®é€šçš„ç»„ä»¶
         */
        public class CommonComponent {
        }

        ```
        Controllerç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: controllerç±»å‹ç»„ä»¶
         */
        public class XxxController {
        }

        ```
        Serviceç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: serviceç±»å‹ç»„ä»¶
         */
        public class XxxService {
        }

        ```
        Daoç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: daoç±»å‹ç»„ä»¶
         */
        public class XxxDao {
        }

        ```

4.  **ç»„ä»¶æ·»åŠ æ ‡è®°æ³¨è§£**
    1.  ç»„ä»¶æ ‡è®°æ³¨è§£å’ŒåŒºåˆ«

        Spring æä¾›äº†ä»¥ä¸‹å¤šä¸ªæ³¨è§£ï¼Œè¿™äº›æ³¨è§£å¯ä»¥ç›´æ¥æ ‡æ³¨åœ¨ Java ç±»ä¸Šï¼Œå°†å®ƒä»¬å®šä¹‰æˆ Spring Beanã€‚
        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/443624052e46b3a5db4d472093c12f53.png)  
        é€šè¿‡æŸ¥çœ‹æºç æˆ‘ä»¬å¾—çŸ¥ï¼Œ@Controllerã€@Serviceã€@Repositoryè¿™ä¸‰ä¸ªæ³¨è§£åªæ˜¯åœ¨@Componentæ³¨è§£çš„åŸºç¡€ä¸Šèµ·äº†ä¸‰ä¸ªæ–°çš„åå­—ã€‚

        å¯¹äºSpringä½¿ç”¨IOCå®¹å™¨ç®¡ç†è¿™äº›ç»„ä»¶æ¥è¯´æ²¡æœ‰åŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯è¯­æ³•å±‚é¢æ²¡æœ‰åŒºåˆ«ã€‚æ‰€ä»¥@Controllerã€@Serviceã€@Repositoryè¿™ä¸‰ä¸ªæ³¨è§£åªæ˜¯ç»™å¼€å‘äººå‘˜çœ‹çš„ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿä¾¿äºåˆ†è¾¨ç»„ä»¶çš„ä½œç”¨ã€‚

        æ³¨æ„ï¼šè™½ç„¶å®ƒä»¬æœ¬è´¨ä¸Šä¸€æ ·ï¼Œä½†æ˜¯ä¸ºäº†ä»£ç çš„å¯è¯»æ€§ã€ç¨‹åºç»“æ„ä¸¥è°¨ï¼æˆ‘ä»¬è‚¯å®šä¸èƒ½éšä¾¿èƒ¡ä¹±æ ‡è®°ã€‚

	2.  ä½¿ç”¨æ³¨è§£æ ‡è®°

        æ™®é€šç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: æ™®é€šçš„ç»„ä»¶
         */
        @Component
        public class CommonComponent {
        }

        ```
        Controllerç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: controllerç±»å‹ç»„ä»¶
         */
        @Controller
        public class XxxController {
        }

        ```
        Serviceç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: serviceç±»å‹ç»„ä»¶
         */
        @Service
        public class XxxService {
        }

        ```
        Daoç»„ä»¶
        ```java
        /**
         * projectName: com.atguigu.components
         *
         * description: daoç±»å‹ç»„ä»¶
         */
        @Repository
        public class XxxDao {
        }

        ```

5.  **é…ç½®æ–‡ä»¶ç¡®å®šæ‰«æèŒƒå›´**

    æƒ…å†µ1ï¼šåŸºæœ¬æ‰«æé…ç½®
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">
        <!-- é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ… -->
        <!-- 1.åŒ…è¦ç²¾å‡†,æé«˜æ€§èƒ½!
             2.ä¼šæ‰«ææŒ‡å®šçš„åŒ…å’Œå­åŒ…å†…å®¹
             3.å¤šä¸ªåŒ…å¯ä»¥ä½¿ç”¨,åˆ†å‰² ä¾‹å¦‚: com.atguigu.controller,com.atguigu.serviceç­‰
        -->
        <context:component-scan base-package="com.atguigu.components"/>
      
    </beans>
    ```
    æƒ…å†µ2ï¼šæŒ‡å®šæ’é™¤ç»„ä»¶
    ```xml
    <!-- æƒ…å†µä¸‰ï¼šæŒ‡å®šä¸æ‰«æçš„ç»„ä»¶ -->
    <context:component-scan base-package="com.atguigu.components">
        
        <!-- context:exclude-filteræ ‡ç­¾ï¼šæŒ‡å®šæ’é™¤è§„åˆ™ -->
        <!-- typeå±æ€§ï¼šæŒ‡å®šæ ¹æ®ä»€ä¹ˆæ¥è¿›è¡Œæ’é™¤ï¼Œannotationå–å€¼è¡¨ç¤ºæ ¹æ®æ³¨è§£æ¥æ’é™¤ -->
        <!-- expressionå±æ€§ï¼šæŒ‡å®šæ’é™¤è§„åˆ™çš„è¡¨è¾¾å¼ï¼Œå¯¹äºæ³¨è§£æ¥è¯´æŒ‡å®šå…¨ç±»åå³å¯ -->
        <context:exclude-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
    </context:component-scan>
    ```
    æƒ…å†µ3ï¼šæŒ‡å®šæ‰«æç»„ä»¶
    ```xml
    <!-- æƒ…å†µå››ï¼šä»…æ‰«ææŒ‡å®šçš„ç»„ä»¶ -->
    <!-- ä»…æ‰«æ = å…³é—­é»˜è®¤è§„åˆ™ + è¿½åŠ è§„åˆ™ -->
    <!-- use-default-filterså±æ€§ï¼šå–å€¼falseè¡¨ç¤ºå…³é—­é»˜è®¤æ‰«æè§„åˆ™ -->
    <context:component-scan base-package="com.atguigu.ioc.components" use-default-filters="false">
        
        <!-- context:include-filteræ ‡ç­¾ï¼šæŒ‡å®šåœ¨åŸæœ‰æ‰«æè§„åˆ™çš„åŸºç¡€ä¸Šè¿½åŠ çš„è§„åˆ™ -->
        <context:include-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
    </context:component-scan>
    ```

6.  **ç»„ä»¶BeanNameé—®é¢˜**

    åœ¨æˆ‘ä»¬ä½¿ç”¨ XML æ–¹å¼ç®¡ç† bean çš„æ—¶å€™ï¼Œæ¯ä¸ª bean éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†â€”â€”id å±æ€§çš„å€¼ï¼Œä¾¿äºåœ¨å…¶ä»–åœ°æ–¹å¼•ç”¨ã€‚ç°åœ¨ä½¿ç”¨æ³¨è§£åï¼Œæ¯ä¸ªç»„ä»¶ä»ç„¶åº”è¯¥æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ã€‚

    é»˜è®¤æƒ…å†µï¼š

    ç±»åé¦–å­—æ¯å°å†™å°±æ˜¯ bean çš„ idã€‚ä¾‹å¦‚ï¼šSoldierController ç±»å¯¹åº”çš„ bean çš„ id å°±æ˜¯ soldierControllerã€‚

    ä½¿ç”¨valueå±æ€§æŒ‡å®šï¼š
    ```java
    @Controller(value = "tianDog")
    public class SoldierController {
    }
    ```
    å½“æ³¨è§£ä¸­åªè®¾ç½®ä¸€ä¸ªå±æ€§æ—¶ï¼Œvalueå±æ€§çš„å±æ€§åå¯ä»¥çœç•¥ï¼š
    ```java
    @Service("smallDog")
    public class SoldierService {
    }
    ```

7.  **æ€»ç»“**
    1.  æ³¨è§£æ–¹å¼IoCåªæ˜¯æ ‡è®°å“ªäº›ç±»è¦è¢«Springç®¡ç†
    2.  æœ€ç»ˆï¼Œæˆ‘ä»¬è¿˜éœ€è¦XMLæ–¹å¼æˆ–è€…åé¢è®²è§£Javaé…ç½®ç±»æ–¹å¼æŒ‡å®šæ³¨è§£ç”Ÿæ•ˆçš„åŒ…
    3.  **ç°é˜¶æ®µé…ç½®æ–¹å¼ä¸º æ³¨è§£ ï¼ˆæ ‡è®°ï¼‰+ XMLï¼ˆæ‰«æï¼‰**

#### 4.3.2 å®éªŒäºŒï¼š ç»„ä»¶ï¼ˆBeanï¼‰ä½œç”¨åŸŸå’Œå‘¨æœŸæ–¹æ³•æ³¨è§£;

1.  ç»„ä»¶å‘¨æœŸæ–¹æ³•é…ç½®
    1.  å‘¨æœŸæ–¹æ³•æ¦‚å¿µ

        æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ç±»ä¸­å®šä¹‰æ–¹æ³•ï¼Œç„¶åå½“IoCå®¹å™¨å®ä¾‹åŒ–å’Œé”€æ¯ç»„ä»¶å¯¹è±¡çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ï¼è¿™ä¸¤ä¸ªæ–¹æ³•æˆ‘ä»¬æˆä¸ºç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼

        ç±»ä¼¼äºServletçš„init/destroyæ–¹æ³•,æˆ‘ä»¬å¯ä»¥åœ¨å‘¨æœŸæ–¹æ³•å®Œæˆåˆå§‹åŒ–å’Œé‡Šæ”¾èµ„æºç­‰å·¥ä½œã€‚
    2.  å‘¨æœŸæ–¹æ³•å£°æ˜
        ```java
        public class BeanOne {

          //å‘¨æœŸæ–¹æ³•è¦æ±‚ï¼š æ–¹æ³•å‘½åéšæ„ï¼Œä½†æ˜¯è¦æ±‚æ–¹æ³•å¿…é¡»æ˜¯ public void æ— å½¢å‚åˆ—è¡¨
          @PostConstruct  //æ³¨è§£åˆ¶æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
          public void init() {
            // åˆå§‹åŒ–é€»è¾‘
          }
        }

        public class BeanTwo {
          
          @PreDestroy //æ³¨è§£æŒ‡å®šé”€æ¯æ–¹æ³•
          public void cleanup() {
            // é‡Šæ”¾èµ„æºé€»è¾‘
          }
        }
        ```

2.  ç»„ä»¶ä½œç”¨åŸŸé…ç½®
    1.  Beanä½œç”¨åŸŸæ¦‚å¿µ

        `<bean` æ ‡ç­¾å£°æ˜Beanï¼Œåªæ˜¯å°†Beançš„ä¿¡æ¯é…ç½®ç»™SpringIoCå®¹å™¨ï¼

        åœ¨IoCå®¹å™¨ä¸­ï¼Œè¿™äº›`<bean`æ ‡ç­¾å¯¹åº”çš„ä¿¡æ¯è½¬æˆSpringå†…éƒ¨ `BeanDefinition` å¯¹è±¡ï¼Œ`BeanDefinition` å¯¹è±¡å†…ï¼ŒåŒ…å«å®šä¹‰çš„ä¿¡æ¯ï¼ˆid,class,å±æ€§ç­‰ç­‰ï¼‰ï¼

        è¿™æ„å‘³ç€ï¼Œ`BeanDefinition`ä¸`ç±»`æ¦‚å¿µä¸€æ ·ï¼ŒSpringIoCå®¹å™¨å¯ä»¥å¯ä»¥æ ¹æ®`BeanDefinition`å¯¹è±¡åå°„åˆ›å»ºå¤šä¸ªBeanå¯¹è±¡å®ä¾‹ã€‚

        å…·ä½“åˆ›å»ºå¤šå°‘ä¸ªBeançš„å®ä¾‹å¯¹è±¡ï¼Œç”±Beançš„ä½œç”¨åŸŸScopeå±æ€§æŒ‡å®šï¼

	2.  ä½œç”¨åŸŸå¯é€‰å€¼![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/11efe06e9d6cd29a79d63ae347d5fe2a.png)


        
    3.  ä½œç”¨åŸŸé…ç½®
        ```java
        @Scope(scopeName = ConfigurableBeanFactory.SCOPE_SINGLETON) //å•ä¾‹,é»˜è®¤å€¼
        @Scope(scopeName = ConfigurableBeanFactory.SCOPE_PROTOTYPE) //å¤šä¾‹  äºŒé€‰ä¸€
        public class BeanOne {

          //å‘¨æœŸæ–¹æ³•è¦æ±‚ï¼š æ–¹æ³•å‘½åéšæ„ï¼Œä½†æ˜¯è¦æ±‚æ–¹æ³•å¿…é¡»æ˜¯ public void æ— å½¢å‚åˆ—è¡¨
          @PostConstruct  //æ³¨è§£åˆ¶æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
          public void init() {
            // åˆå§‹åŒ–é€»è¾‘
          }
        }
        ```

#### 4.3.3 å®éªŒä¸‰ï¼š Beanå±æ€§èµ‹å€¼ï¼šå¼•ç”¨ç±»å‹è‡ªåŠ¨è£…é… (DI)

1.  **è®¾å®šåœºæ™¯**
    -   SoldierController éœ€è¦ SoldierService
    -   SoldierService éœ€è¦ SoldierDao
         åŒæ—¶åœ¨å„ä¸ªç»„ä»¶ä¸­å£°æ˜è¦è°ƒç”¨çš„æ–¹æ³•ã€‚
    -   SoldierControllerä¸­å£°æ˜æ–¹æ³•
        ```java
        import org.springframework.stereotype.Controller;

        @Controller(value = "tianDog")
        public class SoldierController {
            private SoldierService soldierService;
            public void getMessage() {
                soldierService.getMessage();
            }
        }
        ```
    -   SoldierServiceä¸­å£°æ˜æ–¹æ³•
        ```java
        @Service("smallDog")
        public class SoldierService {
            private SoldierDao soldierDao;
            public void getMessage() {
                soldierDao.getMessage();
            }
        }
        ```
    -   SoldierDaoä¸­å£°æ˜æ–¹æ³•
        ```java
        @Repository
        public class SoldierDao {
            public void getMessage() {
                System.out.print("I am a soldier");
            }

        }
        ```

2.  **è‡ªåŠ¨è£…é…å®ç°**
    1.  å‰æ

        å‚ä¸è‡ªåŠ¨è£…é…çš„ç»„ä»¶ï¼ˆéœ€è¦è£…é…ã€è¢«è£…é…ï¼‰å…¨éƒ¨éƒ½å¿…é¡»åœ¨IoCå®¹å™¨ä¸­ã€‚

        æ³¨æ„ï¼šä¸åŒºåˆ†IoCçš„æ–¹å¼ï¼XMLå’Œæ³¨è§£éƒ½å¯ä»¥ï¼

	2.  `@Autowiredæ³¨è§£`

        åœ¨æˆå‘˜å˜é‡ä¸Šç›´æ¥æ ‡è®°@Autowiredæ³¨è§£å³å¯ï¼Œä¸éœ€è¦æä¾›setXxx()æ–¹æ³•ã€‚ä»¥åæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­çš„æ­£å¼ç”¨æ³•å°±æ˜¯è¿™æ ·ã€‚

	3.  ç»™Controllerè£…é…Service
        ```java
        @Controller(value = "tianDog")
        public class SoldierController {
            
            @Autowired
            private SoldierService soldierService;
            
            public void getMessage() {
                soldierService.getMessage();
            }
            
        }
        ```
    4.  ç»™Serviceè£…é…Dao
        ```java
        @Service("smallDog")
        public class SoldierService {
            
            @Autowired
            private SoldierDao soldierDao;
            
            public void getMessage() {
                soldierDao.getMessage();
            }
        }
        ```
3.  **@Autowiredæ³¨è§£ç»†èŠ‚**
    1.  æ ‡è®°ä½ç½®
        1.  æˆå‘˜å˜é‡

            è¿™æ˜¯æœ€ä¸»è¦çš„ä½¿ç”¨æ–¹å¼ï¼

            ä¸xmlè¿›è¡Œbean refå¼•ç”¨ä¸åŒï¼Œä»–ä¸éœ€è¦æœ‰setæ–¹æ³•ï¼
            ```java
            @Service("smallDog")
            public class SoldierService {
                
                @Autowired
                private SoldierDao soldierDao;
                
                public void getMessage() {
                    soldierDao.getMessage();
                }
            }
            ```
        2.  æ„é€ å™¨
            ```java
            @Controller(value = "tianDog")
            public class SoldierController {
                
                private SoldierService soldierService;
                
                @Autowired
                public SoldierController(SoldierService soldierService) {
                    this.soldierService = soldierService;
                }
                â€¦â€¦
            ```
        3.  setXxx()æ–¹æ³•
            ```java
            @Controller(value = "tianDog")
            public class SoldierController {

                private SoldierService soldierService;

                @Autowired
                public void setSoldierService(SoldierService soldierService) {
                    this.soldierService = soldierService;
                }
                â€¦â€¦
            ```
    2.  å·¥ä½œæµç¨‹

        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ebb0bb0670238bf1910015870b488027.png)


        -   é¦–å…ˆæ ¹æ®æ‰€éœ€è¦çš„ç»„ä»¶ç±»å‹åˆ° IOC å®¹å™¨ä¸­æŸ¥æ‰¾
            -   èƒ½å¤Ÿæ‰¾åˆ°å”¯ä¸€çš„ beanï¼šç›´æ¥æ‰§è¡Œè£…é…
            -   å¦‚æœå®Œå…¨æ‰¾ä¸åˆ°åŒ¹é…è¿™ä¸ªç±»å‹çš„ beanï¼šè£…é…å¤±è´¥
            -   å’Œæ‰€éœ€ç±»å‹åŒ¹é…çš„ bean ä¸æ­¢ä¸€ä¸ª
                -   æ²¡æœ‰ @Qualifier æ³¨è§£ï¼šæ ¹æ® @Autowired æ ‡è®°ä½ç½®æˆå‘˜å˜é‡çš„å˜é‡åä½œä¸º bean çš„ id è¿›è¡ŒåŒ¹é…
                    -   èƒ½å¤Ÿæ‰¾åˆ°ï¼šæ‰§è¡Œè£…é…
                    -   æ‰¾ä¸åˆ°ï¼šè£…é…å¤±è´¥
                -   ä½¿ç”¨ @Qualifier æ³¨è§£ï¼šæ ¹æ® @Qualifier æ³¨è§£ä¸­æŒ‡å®šçš„åç§°ä½œä¸º bean çš„idè¿›è¡ŒåŒ¹é…
                    -   èƒ½å¤Ÿæ‰¾åˆ°ï¼šæ‰§è¡Œè£…é…
                    -   æ‰¾ä¸åˆ°ï¼šè£…é…å¤±è´¥
        ```java
        @Controller(value = "tianDog")
        public class SoldierController {
            
            @Autowired
            @Qualifier(value = "maomiService222")
            // æ ¹æ®é¢å‘æ¥å£ç¼–ç¨‹æ€æƒ³ï¼Œä½¿ç”¨æ¥å£ç±»å‹å¼•å…¥Serviceç»„ä»¶
            private ISoldierService soldierService;
        ```

4.  **ä½›ç³»è£…é…**

    ç»™ @Autowired æ³¨è§£è®¾ç½® required = false å±æ€§è¡¨ç¤ºï¼šèƒ½è£…å°±è£…ï¼Œè£…ä¸ä¸Šå°±ä¸è£…ã€‚ä½†æ˜¯å®é™…å¼€å‘æ—¶ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰éœ€è¦è£…é…ç»„ä»¶çš„åœ°æ–¹éƒ½æ˜¯å¿…é¡»è£…é…çš„ï¼Œç”¨ä¸ä¸Šè¿™ä¸ªå±æ€§
    ```java
    @Controller(value = "tianDog")
    public class SoldierController {

        // ç»™@Autowiredæ³¨è§£è®¾ç½®required = falseå±æ€§è¡¨ç¤ºï¼šèƒ½è£…å°±è£…ï¼Œè£…ä¸ä¸Šå°±ä¸è£…
        @Autowired(required = false)
        private ISoldierService soldierService;
    ```

5.  **æ‰©å±•JSR-250æ³¨è§£@Resource**
    -   ç†è§£JSRç³»åˆ—æ³¨è§£

        JSRï¼ˆJava Specification Requestsï¼‰æ˜¯Javaå¹³å°æ ‡å‡†åŒ–è¿›ç¨‹ä¸­çš„ä¸€ç§æŠ€æœ¯è§„èŒƒï¼Œè€ŒJSRæ³¨è§£æ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†é‡è¦çš„å†…å®¹ã€‚æŒ‰ç…§JSRçš„åˆ†ç±»ä»¥åŠæ³¨è§£è¯­ä¹‰çš„ä¸åŒï¼Œå¯ä»¥å°†JSRæ³¨è§£åˆ†ä¸ºä¸åŒçš„ç³»åˆ—ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç³»åˆ—ï¼š
        1.  JSR-175: è¿™ä¸ªJSRæ˜¯Java SE 5å¼•å…¥çš„ï¼Œæ˜¯Javaæ³¨è§£æœ€æ—©çš„è§„èŒƒåŒ–ç‰ˆæœ¬ï¼ŒJava SE 5åçš„ç‰ˆæœ¬ä¸­éƒ½åŒ…å«è¯¥JSRä¸­å®šä¹‰çš„æ³¨è§£ã€‚ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§æ ‡å‡†æ³¨è§£ï¼š
        -   `@Deprecated`: æ ‡è¯†ä¸€ä¸ªç¨‹åºå…ƒç´ ï¼ˆå¦‚ç±»ã€æ–¹æ³•æˆ–å­—æ®µï¼‰å·²è¿‡æ—¶ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«åˆ é™¤ã€‚
        -   `@Override`: æ ‡è¯†ä¸€ä¸ªæ–¹æ³•é‡å†™äº†çˆ¶ç±»ä¸­çš„æ–¹æ³•ã€‚
        -   `@SuppressWarnings`: æŠ‘åˆ¶ç¼–è¯‘æ—¶äº§ç”Ÿçš„è­¦å‘Šæ¶ˆæ¯ã€‚
        -   `@SafeVarargs`: æ ‡è¯†ä¸€ä¸ªæœ‰å®‰å…¨æ€§è­¦å‘Šçš„å¯å˜å‚æ•°æ–¹æ³•ã€‚
        -   `@FunctionalInterface`: æ ‡è¯†ä¸€ä¸ªæ¥å£åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¯ä»¥ä½œä¸ºlambdaè¡¨è¾¾å¼çš„ç›®æ ‡ã€‚
        1.  JSR-250: è¿™ä¸ªJSRä¸»è¦ç”¨äºåœ¨Java EE 5ä¸­å®šä¹‰ä¸€äº›æ”¯æŒæ³¨è§£ã€‚è¯¥JSRä¸»è¦å®šä¹‰äº†ä¸€äº›ç”¨äºè¿›è¡Œå¯¹è±¡ç®¡ç†çš„æ³¨è§£ï¼ŒåŒ…æ‹¬ï¼š
        -   `@Resource`: æ ‡è¯†ä¸€ä¸ªéœ€è¦æ³¨å…¥çš„èµ„æºï¼Œæ˜¯å®ç°Java EEç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»çš„ä¸€ç§æ–¹å¼ã€‚
        -   `@PostConstruct`: æ ‡è¯†ä¸€ä¸ªæ–¹æ³•ä½œä¸ºåˆå§‹åŒ–æ–¹æ³•ã€‚
        -   `@PreDestroy`: æ ‡è¯†ä¸€ä¸ªæ–¹æ³•ä½œä¸ºé”€æ¯æ–¹æ³•ã€‚
        -   `@Resource.AuthenticationType`: æ ‡è¯†æ³¨å…¥çš„èµ„æºçš„èº«ä»½éªŒè¯ç±»å‹ã€‚
        -   `@Resource.AuthenticationType`: æ ‡è¯†æ³¨å…¥çš„èµ„æºçš„é»˜è®¤åç§°ã€‚
        1.  JSR-269: è¿™ä¸ªJSRä¸»è¦æ˜¯Java SE 6ä¸­å¼•å…¥çš„ä¸€ç§æ”¯æŒç¼–è¯‘æ—¶å…ƒæ•°æ®å¤„ç†çš„æ¡†æ¶ï¼Œå³ä½¿ç”¨æ³¨è§£æ¥å¤„ç†Javaæºæ–‡ä»¶ã€‚è¯¥JSRå®šä¹‰äº†ä¸€äº›å¯ä»¥ç”¨æ³¨è§£æ ‡è®°çš„æ³¨è§£å¤„ç†å™¨ï¼Œç”¨äºç”Ÿæˆä¸€äº›å…ƒæ•°æ®ï¼Œå¸¸ç”¨çš„æ³¨è§£æœ‰ï¼š
        -   `@SupportedAnnotationTypes`: æ ‡è¯†æ³¨è§£å¤„ç†å™¨æ‰€å¤„ç†çš„æ³¨è§£ç±»å‹ã€‚
        -   `@SupportedSourceVersion`: æ ‡è¯†æ³¨è§£å¤„ç†å™¨æ”¯æŒçš„Javaæºç ç‰ˆæœ¬ã€‚
        1.  JSR-330: è¯¥JSRä¸»è¦ä¸ºJavaåº”ç”¨ç¨‹åºå®šä¹‰äº†ä¸€ä¸ªä¾èµ–æ³¨å…¥çš„æ ‡å‡†ï¼Œå³Javaä¾èµ–æ³¨å…¥æ ‡å‡†ï¼ˆjavax.injectï¼‰ã€‚åœ¨æ­¤è§„èŒƒä¸­å®šä¹‰äº†å¤šç§æ³¨è§£ï¼ŒåŒ…æ‹¬ï¼š
        -   `@Named`: æ ‡è¯†ä¸€ä¸ªè¢«ä¾èµ–æ³¨å…¥çš„ç»„ä»¶çš„åç§°ã€‚
        -   `@Inject`: æ ‡è¯†ä¸€ä¸ªéœ€è¦è¢«æ³¨å…¥çš„ä¾èµ–ç»„ä»¶ã€‚
        -   `@Singleton`: æ ‡è¯†ä¸€ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªæœ‰ä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ã€‚
        1.  JSR-250: è¿™ä¸ªJSRä¸»è¦æ˜¯Java EE 5ä¸­å®šä¹‰ä¸€äº›æ”¯æŒæ³¨è§£ã€‚è¯¥JSRåŒ…å«äº†ä¸€äº›æ”¯æŒæ³¨è§£ï¼Œå¯ä»¥ç”¨äºå¯¹Java EEç»„ä»¶è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬ï¼š
        -   `@RolesAllowed`: æ ‡è¯†æˆæƒè§’è‰²
        -   `@PermitAll`: æ ‡è¯†ä¸€ä¸ªæ´»åŠ¨æ— éœ€è¿›è¡Œèº«ä»½éªŒè¯ã€‚
        -   `@DenyAll`: æ ‡è¯†ä¸æä¾›é’ˆå¯¹è¯¥æ–¹æ³•çš„è®¿é—®æ§åˆ¶ã€‚
        -   `@DeclareRoles`: å£°æ˜å®‰å…¨è§’è‰²ã€‚
            ä½†æ˜¯ä½ è¦ç†è§£JSRæ˜¯Javaæä¾›çš„**æŠ€æœ¯è§„èŒƒ**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–åªæ˜¯è§„å®šäº†æ³¨è§£å’Œæ³¨è§£çš„å«ä¹‰ï¼Œ**JSRå¹¶ä¸æ˜¯ç›´æ¥æä¾›ç‰¹å®šçš„å®ç°**ï¼Œè€Œæ˜¯æä¾›æ ‡å‡†å’ŒæŒ‡å¯¼æ–¹é’ˆï¼Œç”±ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼ˆSpringï¼‰å’Œåº“æ¥å®ç°å’Œæä¾›å¯¹åº”çš„åŠŸèƒ½ã€‚
    -   JSR-250 @Resourceæ³¨è§£

        @Resourceæ³¨è§£ä¹Ÿå¯ä»¥å®Œæˆå±æ€§æ³¨å…¥ã€‚é‚£å®ƒå’Œ@Autowiredæ³¨è§£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
        -   @Resourceæ³¨è§£æ˜¯JDKæ‰©å±•åŒ…ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å±äºJDKçš„ä¸€éƒ¨åˆ†ã€‚æ‰€ä»¥è¯¥æ³¨è§£æ˜¯æ ‡å‡†æ³¨è§£ï¼Œæ›´åŠ å…·æœ‰é€šç”¨æ€§ã€‚(JSR-250æ ‡å‡†ä¸­åˆ¶å®šçš„æ³¨è§£ç±»å‹ã€‚JSRæ˜¯Javaè§„èŒƒææ¡ˆã€‚)
        -   @Autowiredæ³¨è§£æ˜¯Springæ¡†æ¶è‡ªå·±çš„ã€‚
        -   **@Resourceæ³¨è§£é»˜è®¤æ ¹æ®Beanåç§°è£…é…ï¼ŒæœªæŒ‡å®šnameæ—¶ï¼Œä½¿ç”¨å±æ€§åä½œä¸ºnameã€‚é€šè¿‡nameæ‰¾ä¸åˆ°çš„è¯ä¼šè‡ªåŠ¨å¯åŠ¨é€šè¿‡ç±»å‹è£…é…ã€‚**
        -   **@Autowiredæ³¨è§£é»˜è®¤æ ¹æ®ç±»å‹è£…é…ï¼Œå¦‚æœæƒ³æ ¹æ®åç§°è£…é…ï¼Œéœ€è¦é…åˆ@Qualifieræ³¨è§£ä¸€èµ·ç”¨ã€‚**
        -   @Resourceæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€‚
        -   @Autowiredæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•å‚æ•°ä¸Šã€‚
            @Resourceæ³¨è§£å±äºJDKæ‰©å±•åŒ…ï¼Œæ‰€ä»¥ä¸åœ¨JDKå½“ä¸­ï¼Œéœ€è¦é¢å¤–å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼šã€**é«˜äºJDK11æˆ–ä½äºJDK8éœ€è¦å¼•å…¥ä»¥ä¸‹ä¾èµ–**ã€‘
        ```xml
        <dependency>
            <groupId>jakarta.annotation</groupId>
            <artifactId>jakarta.annotation-api</artifactId>
            <version>2.1.1</version>
        </dependency>
        ```
    -   @Resourceä½¿ç”¨
        ```java
        @Controller
        public class XxxController {
            /**
             * 1. å¦‚æœæ²¡æœ‰æŒ‡å®šname,å…ˆæ ¹æ®å±æ€§åæŸ¥æ‰¾IoCä¸­ç»„ä»¶xxxService
             * 2. å¦‚æœæ²¡æœ‰æŒ‡å®šname,å¹¶ä¸”å±æ€§åæ²¡æœ‰å¯¹åº”çš„ç»„ä»¶,ä¼šæ ¹æ®å±æ€§ç±»å‹æŸ¥æ‰¾
             * 3. å¯ä»¥æŒ‡å®šnameåç§°æŸ¥æ‰¾!  @Resource(name='test') == @Autowired + @Qualifier(value='test')
             */
            @Resource
            private XxxService xxxService;

            //@Resource(name = "æŒ‡å®šbeanName")
            //private XxxService xxxService;

            public void show(){
                System.out.println("XxxController.show");
                xxxService.show();
            }
        }
        ```

#### 4.3.4 å®éªŒå››ï¼š Beanå±æ€§èµ‹å€¼ï¼šåŸºæœ¬ç±»å‹å±æ€§èµ‹å€¼ (DI)

`@Value` é€šå¸¸ç”¨äºæ³¨å…¥å¤–éƒ¨åŒ–å±æ€§

**å£°æ˜å¤–éƒ¨é…ç½®**

application.properties

```java
catalog.name=MovieCatalog
```

**xmlå¼•å…¥å¤–éƒ¨é…ç½®**

```java
<!-- å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶-->
<context:property-placeholder location="application.properties" />
```

**@Valueæ³¨è§£è¯»å–é…ç½®**

```java
package com.atguigu.components;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

/**
 * projectName: com.atguigu.components
 *
 * description: æ™®é€šçš„ç»„ä»¶
 */
@Component
public class CommonComponent {

    /**
     * æƒ…å†µ1: ${key} å–å¤–éƒ¨é…ç½®keyå¯¹åº”çš„å€¼!
     * æƒ…å†µ2: ${key:defaultValue} æ²¡æœ‰key,å¯ä»¥ç»™ä¸é»˜è®¤å€¼
     */
    @Value("${catalog:hahaha}")
    private String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}

```
#### 4.3.5 å®éªŒäº”ï¼š åŸºäºæ³¨è§£+XMLæ–¹å¼æ•´åˆä¸‰å±‚æ¶æ„ç»„ä»¶

1.  éœ€æ±‚åˆ†æ

    æ­å»ºä¸€ä¸ªä¸‰å±‚æ¶æ„æ¡ˆä¾‹ï¼Œæ¨¡æ‹ŸæŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿï¼ˆå­¦ç”Ÿè¡¨ï¼‰ä¿¡æ¯ï¼ŒæŒä¹…å±‚ä½¿ç”¨JdbcTemplateå’ŒDruidæŠ€æœ¯ï¼Œä½¿ç”¨XML+æ³¨è§£æ–¹å¼è¿›è¡Œç»„ä»¶ç®¡ç†ï¼
	![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b5a625c5e5513915914a39324e02e07a.png)


1.  æ•°æ®åº“å‡†å¤‡
    ```java
    create database studb;

    use studb;

    CREATE TABLE students (
      id INT PRIMARY KEY,
      name VARCHAR(50) NOT NULL,
      gender VARCHAR(10) NOT NULL,
      age INT,
      class VARCHAR(50)
    );

    INSERT INTO students (id, name, gender, age, class)
    VALUES
      (1, 'å¼ ä¸‰', 'ç”·', 20, 'é«˜ä¸­ä¸€ç­'),
      (2, 'æå››', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (3, 'ç‹äº”', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (4, 'èµµå…­', 'å¥³', 20, 'é«˜ä¸­ä¸‰ç­'),
      (5, 'åˆ˜ä¸ƒ', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (6, 'é™ˆå…«', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (7, 'æ¨ä¹', 'ç”·', 20, 'é«˜ä¸­ä¸‰ç­'),
      (8, 'å´å', 'ç”·', 19, 'é«˜ä¸­äºŒç­');

    ```
3.  é¡¹ç›®å‡†å¤‡
    1.  é¡¹ç›®åˆ›å»º

        spring-annotation-practice-04
    2.  ä¾èµ–å¯¼å…¥
        ```xml
        <dependencies>
              <!--spring contextä¾èµ–-->
              <!--å½“ä½ å¼•å…¥SpringContextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-context</artifactId>
                  <version>6.0.6</version>
              </dependency>

              <!-- æ•°æ®åº“é©±åŠ¨å’Œè¿æ¥æ± -->
              <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
                  <version>8.0.25</version>
              </dependency>

              <dependency>
                  <groupId>com.alibaba</groupId>
                  <artifactId>druid</artifactId>
                  <version>1.2.8</version>
              </dependency>
              
              <dependency>
                    <groupId>jakarta.annotation</groupId>
                    <artifactId>jakarta.annotation-api</artifactId>
                    <version>2.1.1</version>
               </dependency>

              <!-- spring-jdbc -->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-jdbc</artifactId>
                  <version>6.0.6</version>
              </dependency>

        </dependencies> 
        ```
    3.  å®ä½“ç±»å‡†å¤‡
        ```java
        public class Student {

            private Integer id;
            private String name;
            private String gender;
            private Integer age;
            private String classes;

            public Integer getId() {
                return id;
            }

            public void setId(Integer id) {
                this.id = id;
            }

            public String getName() {
                return name;
            }

            public void setName(String name) {
                this.name = name;
            }

            public String getGender() {
                return gender;
            }

            public void setGender(String gender) {
                this.gender = gender;
            }

            public Integer getAge() {
                return age;
            }

            public void setAge(Integer age) {
                this.age = age;
            }

            public String getClasses() {
                return classes;
            }

            public void setClasses(String classes) {
                this.classes = classes;
            }

            @Override
            public String toString() {
                return "Student{" +
                        "id=" + id +
                        ", name='" + name + '\'' +
                        ", gender='" + gender + '\'' +
                        ", age=" + age +
                        ", classes='" + classes + '\'' +
                        '}';
            }
        }

        ```
4.  ä¸‰å±‚æ¶æ„æ­å»ºå’Œå®ç°
    1.  æŒä¹…å±‚
        ```java
        //æ¥å£
        public interface StudentDao {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            List<Student> queryAll();
        }

        //å®ç°ç±»
        @Repository
        public class StudentDaoImpl implements StudentDao {

            @Autowired
            private JdbcTemplate jdbcTemplate;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            @Override
            public List<Student> queryAll() {

                String sql = "select id , name , age , gender , class as classes from students ;";

                /*
                  queryå¯ä»¥è¿”å›é›†åˆ!
                  BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
                 */
                List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));

                return studentList;
            }
        }

        ```
    2.  ä¸šåŠ¡å±‚
        ```java
        //æ¥å£
        public interface StudentService {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            List<Student> findAll();

        }

        //å®ç°ç±»
        @Service
        public class StudentServiceImpl  implements StudentService {

            @Autowired
            private StudentDao studentDao;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            @Override
            public List<Student> findAll() {

                List<Student> studentList =  studentDao.queryAll();

                return studentList;
            }
        }

        ```
    3.  è¡¨è¿°å±‚
        ```java
        @Controller
        public class StudentController {

            @Autowired
            private StudentService studentService;

            public void  findAll(){
               List<Student> studentList =  studentService.findAll();
                System.out.println("studentList = " + studentList);
            }
        }

        ```
5.  ä¸‰å±‚æ¶æ„IoCé…ç½®
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:context="http://www.springframework.org/schema/context"
           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


        <!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
        <context:property-placeholder location="classpath:jdbc.properties" />

        <!-- é…ç½®æ•°æ®æº -->
        <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
            <property name="url" value="${atguigu.url}"/>
            <property name="driverClassName" value="${atguigu.driver}"/>
            <property name="username" value="${atguigu.username}"/>
            <property name="password" value="${atguigu.password}"/>
        </bean>

        <bean class="org.springframework.jdbc.core.JdbcTemplate">
            <property name="dataSource" ref="druidDataSource" />
        </bean>

        <!-- æ‰«æIoc/DIæ³¨è§£ -->
        <context:component-scan base-package="com.atguigu.dao,com.atguigu.service,com.atguigu.controller" />

    </beans>
    ```
6.  è¿è¡Œæµ‹è¯•
    ```java
    public class ControllerTest {

        @Test
        public  void testRun(){
            ApplicationContext applicationContext =
                    new ClassPathXmlApplicationContext("spring-ioc.xml");
            StudentController studentController = applicationContext.getBean(StudentController.class);
            studentController.findAll();
        }
    }
    ```
7.  æ³¨è§£+XML IoCæ–¹å¼é—®é¢˜æ€»ç»“
    1.  è‡ªå®šä¹‰ç±»å¯ä»¥ä½¿ç”¨æ³¨è§£æ–¹å¼ï¼Œä½†æ˜¯ç¬¬ä¸‰æ–¹ä¾èµ–çš„ç±»ä¾ç„¶ä½¿ç”¨XMLæ–¹å¼ï¼
    2.  XMLæ ¼å¼è§£ææ•ˆç‡ä½ï¼

### 4.4 åŸºäº é…ç½®ç±» æ–¹å¼ç®¡ç† Bean

#### 4.4.1 å®Œå…¨æ³¨è§£å¼€å‘ç†è§£

Spring å®Œå…¨æ³¨è§£é…ç½®ï¼ˆFully Annotation-based Configurationï¼‰æ˜¯æŒ‡é€šè¿‡ Javaé…ç½®ç±» ä»£ç æ¥é…ç½® Spring åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨æ³¨è§£æ¥æ›¿ä»£åŸæœ¬åœ¨ XML é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ã€‚ç›¸å¯¹äº XML é…ç½®ï¼Œå®Œå…¨æ³¨è§£é…ç½®å…·æœ‰æ›´å¼ºçš„ç±»å‹å®‰å…¨æ€§å’Œæ›´å¥½çš„å¯è¯»æ€§ã€‚

**ä¸¤ç§æ–¹å¼æ€ç»´è½¬åŒ–**ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8d48361bca8ca0627baaa07687caa48e.png)



#### 4.4.2 å®éªŒä¸€ï¼šé…ç½®ç±»å’Œæ‰«ææ³¨è§£

**xml+æ³¨è§£æ–¹å¼**

é…ç½®æ–‡ä»¶application.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


    <!-- é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ… -->
    <!-- 1.åŒ…è¦ç²¾å‡†,æé«˜æ€§èƒ½!
         2.ä¼šæ‰«ææŒ‡å®šçš„åŒ…å’Œå­åŒ…å†…å®¹
         3.å¤šä¸ªåŒ…å¯ä»¥ä½¿ç”¨,åˆ†å‰² ä¾‹å¦‚: com.atguigu.controller,com.atguigu.serviceç­‰
    -->
    <context:component-scan base-package="com.atguigu.components"/>

    <!-- å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶-->
    <context:property-placeholder location="application.properties" />
</beans>
```

æµ‹è¯•åˆ›å»ºIoCå®¹å™¨

```java
 // xmlæ–¹å¼é…ç½®æ–‡ä»¶ä½¿ç”¨ClassPathXmlApplicationContextå®¹å™¨è¯»å–
 ApplicationContext applicationContext =
                new ClassPathXmlApplicationContext("application.xml");
```

**é…ç½®ç±»+æ³¨è§£æ–¹å¼ï¼ˆå®Œå…¨æ³¨è§£æ–¹å¼ï¼‰**

é…ç½®ç±»

ä½¿ç”¨ @Configuration æ³¨è§£å°†ä¸€ä¸ªæ™®é€šçš„ç±»æ ‡è®°ä¸º Spring çš„é…ç½®ç±»ã€‚

```java
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;

//æ ‡æ³¨å½“å‰ç±»æ˜¯é…ç½®ç±»ï¼Œæ›¿ä»£application.xml    
@Configuration
//ä½¿ç”¨æ³¨è§£è¯»å–å¤–éƒ¨é…ç½®ï¼Œæ›¿ä»£ <context:property-placeholderæ ‡ç­¾
@PropertySource("classpath:application.properties")
//ä½¿ç”¨@ComponentScanæ³¨è§£,å¯ä»¥é…ç½®æ‰«æåŒ…,æ›¿ä»£<context:component-scanæ ‡ç­¾
@ComponentScan(basePackages = {"com.atguigu.components"})
public class MyConfiguration {
    
}
```

æµ‹è¯•åˆ›å»ºIoCå®¹å™¨

```java
// AnnotationConfigApplicationContext æ ¹æ®é…ç½®ç±»åˆ›å»º IOC å®¹å™¨å¯¹è±¡
ApplicationContext iocContainerAnnotation = 
new AnnotationConfigApplicationContext(MyConfiguration.class);
```

å¯ä»¥ä½¿ç”¨ no-arg æ„é€ å‡½æ•°å®ä¾‹åŒ– `AnnotationConfigApplicationContext` ï¼Œç„¶åä½¿ç”¨ `register()` æ–¹æ³•å¯¹å…¶è¿›è¡Œé…ç½®ã€‚æ­¤æ–¹æ³•åœ¨ä»¥ç¼–ç¨‹æ–¹å¼ç”Ÿæˆ `AnnotationConfigApplicationContext` æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š

```java
// AnnotationConfigApplicationContext-IOCå®¹å™¨å¯¹è±¡
ApplicationContext iocContainerAnnotation = 
new AnnotationConfigApplicationContext();
//å¤–éƒ¨è®¾ç½®é…ç½®ç±»
iocContainerAnnotation.register(MyConfiguration.class);
//åˆ·æ–°åæ–¹å¯ç”Ÿæ•ˆï¼ï¼
iocContainerAnnotation.refresh();

```

**æ€»ç»“ï¼š**

@ConfigurationæŒ‡å®šä¸€ä¸ªç±»ä¸ºé…ç½®ç±»ï¼Œå¯ä»¥æ·»åŠ é…ç½®æ³¨è§£ï¼Œæ›¿ä»£é…ç½®xmlæ–‡ä»¶

@ComponentScan(basePackages = {"åŒ…","åŒ…"}) æ›¿ä»£\<context:component-scanæ ‡ç­¾å®ç°æ³¨è§£æ‰«æ

@PropertySource("classpath:é…ç½®æ–‡ä»¶åœ°å€") æ›¿ä»£ \<context:property-placeholderæ ‡ç­¾

é…åˆIoC/DIæ³¨è§£ï¼Œå¯ä»¥è¿›è¡Œå®Œæ•´æ³¨è§£å¼€å‘ï¼

#### 4.4.3 å®éªŒäºŒï¼š@Beanå®šä¹‰ç»„ä»¶

**åœºæ™¯éœ€æ±‚**ï¼šå°†Druidè¿æ¥æ± å¯¹è±¡å­˜å‚¨åˆ°IoCå®¹å™¨

**éœ€æ±‚åˆ†æ**ï¼šç¬¬ä¸‰æ–¹jaråŒ…çš„ç±»ï¼Œæ·»åŠ åˆ°iocå®¹å™¨ï¼Œæ— æ³•ä½¿ç”¨@Componentç­‰ç›¸å…³æ³¨è§£ï¼å› ä¸ºæºç jaråŒ…å†…å®¹ä¸ºåªè¯»æ¨¡å¼ï¼

**xmlæ–¹å¼å®ç°**ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">


    <!-- å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
    <context:property-placeholder location="classpath:jdbc.properties"/>

    <!-- å®éªŒå…­ [é‡è¦]ç»™beançš„å±æ€§èµ‹å€¼ï¼šå¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ -->
    <bean id="druidDataSource" class="com.alibaba.druid.pool.DruidDataSource">
        <property name="url" value="${jdbc.url}"/>
        <property name="driverClassName" value="${jdbc.driver}"/>
        <property name="username" value="${jdbc.user}"/>
        <property name="password" value="${jdbc.password}"/>
    </bean>

</beans>
```

**é…ç½®ç±»æ–¹å¼å®ç°**ï¼š

`@Bean` æ³¨é‡Šç”¨äºæŒ‡ç¤ºæ–¹æ³•å®ä¾‹åŒ–ã€é…ç½®å’Œåˆå§‹åŒ–è¦ç”± Spring IoC å®¹å™¨ç®¡ç†çš„æ–°å¯¹è±¡ã€‚å¯¹äºé‚£äº›ç†Ÿæ‚‰ Spring çš„ `<beans/>` XML é…ç½®çš„äººæ¥è¯´ï¼Œ `@Bean` æ³¨é‡Šä¸ `<bean/>` å…ƒç´ èµ·ç€ç›¸åŒçš„ä½œç”¨ã€‚

```java
//æ ‡æ³¨å½“å‰ç±»æ˜¯é…ç½®ç±»ï¼Œæ›¿ä»£application.xml    
@Configuration
//å¼•å…¥jdbc.propertiesæ–‡ä»¶
@PropertySource({"classpath:application.properties","classpath:jdbc.properties"})
@ComponentScan(basePackages = {"com.atguigu.components"})
public class MyConfiguration {

    //å¦‚æœç¬¬ä¸‰æ–¹ç±»è¿›è¡ŒIoCç®¡ç†,æ— æ³•ç›´æ¥ä½¿ç”¨@Componentç›¸å…³æ³¨è§£
    //è§£å†³æ–¹æ¡ˆ: xmlæ–¹å¼å¯ä»¥ä½¿ç”¨<beanæ ‡ç­¾
    //è§£å†³æ–¹æ¡ˆ: é…ç½®ç±»æ–¹å¼,å¯ä»¥ä½¿ç”¨æ–¹æ³•è¿”å›å€¼+@Beanæ³¨è§£
    @Bean
    public DataSource createDataSource(@Value("${jdbc.user}") String username,
                                       @Value("${jdbc.password}")String password,
                                       @Value("${jdbc.url}")String url,
                                       @Value("${jdbc.driver}")String driverClassName){
        //ä½¿ç”¨Javaä»£ç å®ä¾‹åŒ–
        DruidDataSource dataSource = new DruidDataSource();
        dataSource.setUsername(username);
        dataSource.setPassword(password);
        dataSource.setUrl(url);
        dataSource.setDriverClassName(driverClassName);
        //è¿”å›ç»“æœå³å¯
        return dataSource;
    }
}
```

#### 4.4.4 å®éªŒä¸‰ï¼šé«˜çº§ç‰¹æ€§ï¼š@Beanæ³¨è§£ç»†èŠ‚

1.  **@Beanç”ŸæˆBeanNameé—®é¢˜**

    @Beanæ³¨è§£æºç ï¼š
    ```java
    public @interface Bean {
        //å‰ä¸¤ä¸ªæ³¨è§£å¯ä»¥æŒ‡å®šBeançš„æ ‡è¯†
        @AliasFor("name")
        String[] value() default {};
        @AliasFor("value")
        String[] name() default {};
      
        //autowireCandidate å±æ€§æ¥æŒ‡ç¤ºè¯¥ Bean æ˜¯å¦å€™é€‰ç”¨äºè‡ªåŠ¨è£…é…ã€‚
        //autowireCandidate å±æ€§é»˜è®¤å€¼ä¸º trueï¼Œè¡¨ç¤ºè¯¥ Bean æ˜¯ä¸€ä¸ªé»˜è®¤çš„è£…é…ç›®æ ‡ï¼Œ
        //å¯è¢«å€™é€‰ç”¨äºè‡ªåŠ¨è£…é…ã€‚å¦‚æœå°† autowireCandidate å±æ€§è®¾ç½®ä¸º falseï¼Œåˆ™è¯´æ˜è¯¥ Bean ä¸æ˜¯é»˜è®¤çš„è£…é…ç›®æ ‡ï¼Œä¸ä¼šè¢«å€™é€‰ç”¨äºè‡ªåŠ¨è£…é…ã€‚
        boolean autowireCandidate() default true;

        //æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
        String initMethod() default "";
        //æŒ‡å®šé”€æ¯æ–¹æ³•
        String destroyMethod() default "(inferred)";
    }

    ```
    æŒ‡å®š@Beançš„åç§°ï¼š
    ```java
    @Configuration
    public class AppConfig {

      @Bean("myThing") //æŒ‡å®šåç§°
      public Thing thing() {
        return new Thing();
      }
    }
    ```
    `@Bean` æ³¨é‡Šæ³¨é‡Šæ–¹æ³•ã€‚ä½¿ç”¨æ­¤æ–¹æ³•åœ¨æŒ‡å®šä¸ºæ–¹æ³•è¿”å›å€¼çš„ç±»å‹çš„ `ApplicationContext` ä¸­æ³¨å†Œ Bean å®šä¹‰ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼ŒBean åç§°ä¸æ–¹æ³•åç§°ç›¸åŒã€‚ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤º `@Bean` æ–¹æ³•å£°æ˜ï¼š
    ```java
    @Configuration
    public class AppConfig {

      @Bean
      public TransferServiceImpl transferService() {
        return new TransferServiceImpl();
      }
    }
    ```
    å‰é¢çš„é…ç½®å®Œå…¨ç­‰åŒäºä¸‹é¢çš„Spring XMLï¼š
    ```java
    <beans>
      <bean id="transferService" class="com.acme.TransferServiceImpl"/>
    </beans>
    ```
2.  **@Bean åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•æŒ‡å®š**

    `@Bean` æ³¨è§£æ”¯æŒæŒ‡å®šä»»æ„åˆå§‹åŒ–å’Œé”€æ¯å›è°ƒæ–¹æ³•ï¼Œéå¸¸ç±»ä¼¼äº Spring XML åœ¨ `bean` å…ƒç´ ä¸Šçš„ `init-method` å’Œ `destroy-method` å±æ€§ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š
    ```java
    public class BeanOne {

      public void init() {
        // initialization logic
      }
    }

    public class BeanTwo {

      public void cleanup() {
        // destruction logic
      }
    }

    @Configuration
    public class AppConfig {

      @Bean(initMethod = "init")
      public BeanOne beanOne() {
        return new BeanOne();
      }

      @Bean(destroyMethod = "cleanup")
      public BeanTwo beanTwo() {
        return new BeanTwo();
      }
    }
    ```
3.  **@Bean Scopeä½œç”¨åŸŸ**

    å¯ä»¥æŒ‡å®šä½¿ç”¨ `@Bean` æ³¨é‡Šå®šä¹‰çš„ bean åº”å…·æœ‰ç‰¹å®šèŒƒå›´ã€‚æ‚¨å¯ä»¥ä½¿ç”¨åœ¨ Bean ä½œç”¨åŸŸéƒ¨åˆ†ä¸­æŒ‡å®šçš„ä»»ä½•æ ‡å‡†ä½œç”¨åŸŸã€‚

    é»˜è®¤ä½œç”¨åŸŸä¸º `singleton` ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ `@Scope` æ³¨é‡Šè¦†ç›–æ­¤èŒƒå›´ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š
    ```java
    @Configuration
    public class MyConfiguration {

      @Bean
      @Scope("prototype")
      public Encryptor encryptor() {
        // ...
      }
    }
    ```
4.  **@Beanæ–¹æ³•ä¹‹é—´ä¾èµ–**

    **å‡†å¤‡ç»„ä»¶**
    ```java
    public class HappyMachine {
        private String machineName;
        public String getMachineName() {
            return machineName;
        }
        
        public void setMachineName(String machineName) {
            this.machineName = machineName;
        }
    }
    ```
    ```java
    public class HappyComponent {
        //å¼•ç”¨æ–°ç»„ä»¶
        private HappyMachine happyMachine;
        public HappyMachine getHappyMachine() {
            return happyMachine;
        }
        public void setHappyMachine(HappyMachine happyMachine) {
            this.happyMachine = happyMachine;
        }
        public void doWork() {
            System.out.println("HappyComponent.doWork");
        }
    }
    ```
    **Javaé…ç½®ç±»å®ç°ï¼š**

    æ–¹æ¡ˆ1ï¼š

    ç›´æ¥è°ƒç”¨æ–¹æ³•è¿”å› Bean å®ä¾‹ï¼šåœ¨ä¸€ä¸ª `@Bean` æ–¹æ³•ä¸­ç›´æ¥è°ƒç”¨å…¶ä»– `@Bean` æ–¹æ³•æ¥è·å– Bean å®ä¾‹ï¼Œè™½ç„¶æ˜¯æ–¹æ³•è°ƒç”¨ï¼Œä¹Ÿæ˜¯é€šè¿‡IoCå®¹å™¨è·å–å¯¹åº”çš„Beanï¼Œä¾‹å¦‚ï¼š
    ```java
    @Configuration
    public class JavaConfig {

        @Bean
        public HappyMachine happyMachine(){
            return new HappyMachine();
        }

        @Bean
        public HappyComponent happyComponent(){
            HappyComponent happyComponent = new HappyComponent();
            //ç›´æ¥è°ƒç”¨æ–¹æ³•å³å¯! 
            happyComponent.setHappyMachine(happyMachine());
            return happyComponent;
        }

    }
    ```
    æ–¹æ¡ˆ2ï¼š

    å‚æ•°å¼•ç”¨æ³•ï¼šé€šè¿‡æ–¹æ³•å‚æ•°ä¼ é€’ Bean å®ä¾‹çš„å¼•ç”¨æ¥è§£å†³ Bean å®ä¾‹ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚ï¼š
    ```java
    package com.atguigu.config;

    import com.atguigu.ioc.HappyComponent;
    import com.atguigu.ioc.HappyMachine;
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;

    /**
     * projectName: com.atguigu.config
     * description: é…ç½®HappyComponentå’ŒHappyMachineå…³ç³»
     */

    @Configuration
    public class JavaConfig {

        @Bean
        public HappyMachine happyMachine(){
            return new HappyMachine();
        }

        /**
         * å¯ä»¥ç›´æ¥åœ¨å½¢å‚åˆ—è¡¨æ¥æ”¶IoCå®¹å™¨ä¸­çš„Bean!
         *    æƒ…å†µ1: ç›´æ¥æŒ‡å®šç±»å‹å³å¯
         *    æƒ…å†µ2: å¦‚æœæœ‰å¤šä¸ªbean,(HappyMachine åç§° ) å½¢å‚åç§°ç­‰äºè¦æŒ‡å®šçš„beanåç§°!
         *           ä¾‹å¦‚:
         *               @Bean
         *               public Foo foo1(){
         *                   return new Foo();
         *               }
         *               @Bean
         *               public Foo foo2(){
         *                   return new Foo()
         *               }
         *               @Bean
         *               public Component component(Foo foo1 / foo2 é€šè¿‡æ­¤å¤„æŒ‡å®šå¼•å…¥çš„bean)
         */
        @Bean
        public HappyComponent happyComponent(HappyMachine happyMachine){
            HappyComponent happyComponent = new HappyComponent();
            //èµ‹å€¼
            happyComponent.setHappyMachine(happyMachine);
            return happyComponent;
        }

    }
    ```

#### 4.4.5 å®éªŒå››ï¼šé«˜çº§ç‰¹æ€§ï¼š@Importæ‰©å±•

`@Import` æ³¨é‡Šå…è®¸ä»å¦ä¸€ä¸ªé…ç½®ç±»åŠ è½½ `@Bean` å®šä¹‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š

```java
@Configuration
public class ConfigA {

  @Bean
  public A a() {
    return new A();
  }
}

@Configuration
@Import(ConfigA.class)
public class ConfigB {

  @Bean
  public B b() {
    return new B();
  }
}
```

ç°åœ¨ï¼Œåœ¨å®ä¾‹åŒ–ä¸Šä¸‹æ–‡æ—¶ä¸éœ€è¦åŒæ—¶æŒ‡å®š `ConfigA.class` å’Œ `ConfigB.class` ï¼Œåªéœ€æ˜¾å¼æä¾› `ConfigB` ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š

```java
public static void main(String[] args) {
  ApplicationContext ctx = new AnnotationConfigApplicationContext(ConfigB.class);

  // now both beans A and B will be available...
  A a = ctx.getBean(A.class);
  B b = ctx.getBean(B.class);
}
```

æ­¤æ–¹æ³•ç®€åŒ–äº†å®¹å™¨å®ä¾‹åŒ–ï¼Œå› ä¸ºåªéœ€è¦å¤„ç†ä¸€ä¸ªç±»ï¼Œè€Œä¸æ˜¯è¦æ±‚æ‚¨åœ¨æ„é€ æœŸé—´è®°ä½å¯èƒ½å¤§é‡çš„ `@Configuration` ç±»ã€‚

#### 4.4.6 å®éªŒäº”ï¼šåŸºäºæ³¨è§£+é…ç½®ç±»æ–¹å¼æ•´åˆä¸‰å±‚æ¶æ„ç»„ä»¶

1.  éœ€æ±‚åˆ†æ

    æ­å»ºä¸€ä¸ªä¸‰å±‚æ¶æ„æ¡ˆä¾‹ï¼Œæ¨¡æ‹ŸæŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿï¼ˆå­¦ç”Ÿè¡¨ï¼‰ä¿¡æ¯ï¼ŒæŒä¹…å±‚ä½¿ç”¨JdbcTemplateå’ŒDruidæŠ€æœ¯ï¼Œä½¿ç”¨æ³¨è§£+é…ç½®ç±»æ–¹å¼è¿›è¡Œç»„ä»¶ç®¡ç†ï¼
   ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ce141379e37460748a14b064aec78bda.png)


2.  æ•°æ®åº“å‡†å¤‡
    ```java
    create database studb;

    use studb;

    CREATE TABLE students (
      id INT PRIMARY KEY,
      name VARCHAR(50) NOT NULL,
      gender VARCHAR(10) NOT NULL,
      age INT,
      class VARCHAR(50)
    );

    INSERT INTO students (id, name, gender, age, class)
    VALUES
      (1, 'å¼ ä¸‰', 'ç”·', 20, 'é«˜ä¸­ä¸€ç­'),
      (2, 'æå››', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (3, 'ç‹äº”', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (4, 'èµµå…­', 'å¥³', 20, 'é«˜ä¸­ä¸‰ç­'),
      (5, 'åˆ˜ä¸ƒ', 'ç”·', 19, 'é«˜ä¸­äºŒç­'),
      (6, 'é™ˆå…«', 'å¥³', 18, 'é«˜ä¸­ä¸€ç­'),
      (7, 'æ¨ä¹', 'ç”·', 20, 'é«˜ä¸­ä¸‰ç­'),
      (8, 'å´å', 'ç”·', 19, 'é«˜ä¸­äºŒç­');

    ```
3.  é¡¹ç›®å‡†å¤‡
    1.  é¡¹ç›®åˆ›å»º

        spring-java-practice-06
    2.  ä¾èµ–å¯¼å…¥
        ```xml
        <dependencies>
              <!--spring contextä¾èµ–-->
              <!--å½“ä½ å¼•å…¥SpringContextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-context</artifactId>
                  <version>6.0.6</version>
              </dependency>

              <!-- æ•°æ®åº“é©±åŠ¨å’Œè¿æ¥æ± -->
              <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
                  <version>8.0.25</version>
              </dependency>

              <dependency>
                  <groupId>com.alibaba</groupId>
                  <artifactId>druid</artifactId>
                  <version>1.2.8</version>
              </dependency>
              
              <dependency>
                    <groupId>jakarta.annotation</groupId>
                    <artifactId>jakarta.annotation-api</artifactId>
                    <version>2.1.1</version>
               </dependency>

              <!-- spring-jdbc -->
              <dependency>
                  <groupId>org.springframework</groupId>
                  <artifactId>spring-jdbc</artifactId>
                  <version>6.0.6</version>
              </dependency>

        </dependencies> 
        ```
    3.  å®ä½“ç±»å‡†å¤‡
        ```java
        public class Student {

            private Integer id;
            private String name;
            private String gender;
            private Integer age;
            private String classes;

            public Integer getId() {
                return id;
            }

            public void setId(Integer id) {
                this.id = id;
            }

            public String getName() {
                return name;
            }

            public void setName(String name) {
                this.name = name;
            }

            public String getGender() {
                return gender;
            }

            public void setGender(String gender) {
                this.gender = gender;
            }

            public Integer getAge() {
                return age;
            }

            public void setAge(Integer age) {
                this.age = age;
            }

            public String getClasses() {
                return classes;
            }

            public void setClasses(String classes) {
                this.classes = classes;
            }

            @Override
            public String toString() {
                return "Student{" +
                        "id=" + id +
                        ", name='" + name + '\'' +
                        ", gender='" + gender + '\'' +
                        ", age=" + age +
                        ", classes='" + classes + '\'' +
                        '}';
            }
        }

        ```
4.  ä¸‰å±‚æ¶æ„æ­å»ºå’Œå®ç°
    1.  æŒä¹…å±‚
        ```java
        //æ¥å£
        public interface StudentDao {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            List<Student> queryAll();
        }

        //å®ç°ç±»
        @Repository
        public class StudentDaoImpl implements StudentDao {

            @Autowired
            private JdbcTemplate jdbcTemplate;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿæ•°æ®
             * @return
             */
            @Override
            public List<Student> queryAll() {

                String sql = "select id , name , age , gender , class as classes from students ;";

                /*
                  queryå¯ä»¥è¿”å›é›†åˆ!
                  BeanPropertyRowMapperå°±æ˜¯å°è£…å¥½RowMapperçš„å®ç°,è¦æ±‚å±æ€§åå’Œåˆ—åç›¸åŒå³å¯
                 */
                List<Student> studentList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(Student.class));

                return studentList;
            }
        }

        ```
    2.  ä¸šåŠ¡å±‚
        ```java
        //æ¥å£
        public interface StudentService {

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            List<Student> findAll();

        }

        //å®ç°ç±»
        @Service
        public class StudentServiceImpl  implements StudentService {

            @Autowired
            private StudentDao studentDao;

            /**
             * æŸ¥è¯¢å…¨éƒ¨å­¦å‘˜ä¸šåŠ¡
             * @return
             */
            @Override
            public List<Student> findAll() {

                List<Student> studentList =  studentDao.queryAll();

                return studentList;
            }
        }

        ```
    3.  è¡¨è¿°å±‚
        ```java
        @Controller
        public class StudentController {

            @Autowired
            private StudentService studentService;

            public void  findAll(){
               List<Student> studentList =  studentService.findAll();
                System.out.println("studentList = " + studentList);
            }
        }

        ```
5.  ä¸‰å±‚æ¶æ„IoCé…ç½®ç±»
    ```java
    @Configuration
    @ComponentScan(basePackages = "com.atguigu")
    @PropertySource("classpath:jdbc.properties")
    public class JavaConfig {

        @Value("${atguigu.url}")
        private String url;
        @Value("${atguigu.driver}")
        private String driver;
        @Value("${atguigu.username}")
        private String username;
        @Value("${atguigu.password}")
        private String password;

        @Bean(destroyMethod = "close")
        public DruidDataSource dataSource(){
            DruidDataSource dataSource = new DruidDataSource();
            dataSource.setUrl(url);
            dataSource.setDriverClassName(driver);
            dataSource.setUsername(username);
            dataSource.setPassword(password);
            return dataSource;
        }

        @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)
        @Bean
        public JdbcTemplate jdbcTemplate(DataSource dataSource){
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            jdbcTemplate.setDataSource(dataSource);
            return jdbcTemplate;
        }

    }
    ```
6.  è¿è¡Œæµ‹è¯•
    ```java
    public class ControllerTest {

        @Test
        public  void testRun(){

            AnnotationConfigApplicationContext applicationContext =
                    new AnnotationConfigApplicationContext(JavaConfig.class);

            StudentController studentController = applicationContext.getBean(StudentController.class);

            studentController.findAll();

        }
    }
    ```

7.  æ³¨è§£+é…ç½®ç±» IoCæ–¹å¼æ€»ç»“
    1.  å®Œå…¨æ‘’å¼ƒäº†XMLé…ç½®æ–‡ä»¶
    2.  è‡ªå®šä¹‰ç±»ä½¿ç”¨IoCå’ŒDIæ³¨è§£æ ‡è®°
    3.  ç¬¬ä¸‰æ–¹ç±»ä½¿ç”¨é…ç½®ç±»å£°æ˜æ–¹æ³•+\@Beanæ–¹å¼å¤„ç†
    4.  å®Œå…¨æ³¨è§£æ–¹å¼ï¼ˆé…ç½®ç±»+æ³¨è§£ï¼‰æ˜¯ç°åœ¨ä¸»æµé…ç½®æ–¹å¼

### 4.5 ä¸‰ç§é…ç½®æ–¹å¼æ€»ç»“

#### 4.5.1 XMLæ–¹å¼é…ç½®æ€»ç»“

1.  æ‰€æœ‰å†…å®¹å†™åˆ°xmlæ ¼å¼é…ç½®æ–‡ä»¶ä¸­
2.  å£°æ˜beané€šè¿‡`<bean>`æ ‡ç­¾
3.  \<beanæ ‡ç­¾åŒ…å«åŸºæœ¬ä¿¡æ¯ï¼ˆid,classï¼‰å’Œå±æ€§ä¿¡æ¯ \<property name value / ref
4.  å¼•å…¥å¤–éƒ¨çš„propertiesæ–‡ä»¶å¯ä»¥é€šè¿‡\<context:property-placeholder
5.  IoCå…·ä½“å®¹å™¨å®ç°é€‰æ‹©ClassPathXmlApplicationContextå¯¹è±¡

#### 4.5.2 XML+æ³¨è§£æ–¹å¼é…ç½®æ€»ç»“

1.  æ³¨è§£è´Ÿè´£æ ‡è®°IoCçš„ç±»å’Œè¿›è¡Œå±æ€§è£…é…
2.  xmlæ–‡ä»¶ä¾ç„¶éœ€è¦ï¼Œéœ€è¦é€šè¿‡\<context:component-scanæ ‡ç­¾æŒ‡å®šæ³¨è§£èŒƒå›´
3.  æ ‡è®°IoCæ³¨è§£ï¼š@Component,@Service,@Controller,@Repository&#x20;
4.  æ ‡è®°DIæ³¨è§£ï¼š@Autowired @Qualifier @Resource @Value
5.  IoCå…·ä½“å®¹å™¨å®ç°é€‰æ‹©ClassPathXmlApplicationContextå¯¹è±¡

#### 4.5.3 å®Œå…¨æ³¨è§£æ–¹å¼é…ç½®æ€»ç»“

1.  å®Œå…¨æ³¨è§£æ–¹å¼æŒ‡çš„æ˜¯å»æ‰xmlæ–‡ä»¶ï¼Œä½¿ç”¨é…ç½®ç±» + æ³¨è§£å®ç°
2.  xmlæ–‡ä»¶æ›¿æ¢æˆä½¿ç”¨@Configurationæ³¨è§£æ ‡è®°çš„ç±»
3.  æ ‡è®°IoCæ³¨è§£ï¼š@Component,@Service,@Controller,@Repository&#x20;
4.  æ ‡è®°DIæ³¨è§£ï¼š@Autowired @Qualifier @Resource @Value
5.  \<context:component-scanæ ‡ç­¾æŒ‡å®šæ³¨è§£èŒƒå›´ä½¿ç”¨@ComponentScan(basePackages = {"com.atguigu.components"})æ›¿ä»£
6.  \<context:property-placeholderå¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶ä½¿ç”¨@PropertySource({"classpath:application.properties","classpath:jdbc.properties"})æ›¿ä»£
7.  \<bean æ ‡ç­¾ä½¿ç”¨@Beanæ³¨è§£å’Œæ–¹æ³•å®ç°
8.  IoCå…·ä½“å®¹å™¨å®ç°é€‰æ‹©AnnotationConfigApplicationContextå¯¹è±¡

### 4.6 æ•´åˆSpring5-Test5æ­å»ºæµ‹è¯•ç¯å¢ƒ

1.  æ•´åˆæµ‹è¯•ç¯å¢ƒä½œç”¨

    å¥½å¤„1ï¼šä¸éœ€è¦è‡ªå·±åˆ›å»ºIOCå®¹å™¨å¯¹è±¡äº†

    å¥½å¤„2ï¼šä»»ä½•éœ€è¦çš„beanéƒ½å¯ä»¥åœ¨æµ‹è¯•ç±»ä¸­ç›´æ¥äº«å—è‡ªåŠ¨è£…é…

2.  å¯¼å…¥ç›¸å…³ä¾èµ–
    ```xml
    <!--junit5æµ‹è¯•-->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.3.1</version>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-test</artifactId>
        <version>6.0.6</version>
        <scope>test</scope>
    </dependency>
    ```
3.  æ•´åˆæµ‹è¯•æ³¨è§£ä½¿ç”¨
    ```java
    //@SpringJUnitConfig(locations = {"classpath:spring-context.xml"})  //æŒ‡å®šé…ç½®æ–‡ä»¶xml
    @SpringJUnitConfig(value = {BeanConfig.class})  //æŒ‡å®šé…ç½®ç±»
    public class Junit5IntegrationTest {
        
        @Autowired
        private User user;
        
        @Test
        public void testJunit5() {
            System.out.println(user);
        }
    }
    ```

## 5 Spring AOPé¢å‘åˆ‡é¢ç¼–ç¨‹

### 5.1 åœºæ™¯è®¾å®šå’Œé—®é¢˜å¤ç°

1.  å‡†å¤‡AOPé¡¹ç›®

    é¡¹ç›®åï¼šspring-aop-annotation

    pom.xml
    ```xml
    <dependencies>
        <!--spring contextä¾èµ–-->
        <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-context</artifactId>
            <version>6.0.6</version>
        </dependency>

        <!--junit5æµ‹è¯•-->
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-api</artifactId>
            <version>5.3.1</version>
        </dependency>


        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-test</artifactId>
            <version>6.0.6</version>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>jakarta.annotation</groupId>
            <artifactId>jakarta.annotation-api</artifactId>
            <version>2.1.1</version>
        </dependency>
    </dependencies>
    ```
2.  å£°æ˜æ¥å£
    ```java
    /**
     *       + - * / è¿ç®—çš„æ ‡å‡†æ¥å£!
     */
    public interface Calculator {
        
        int add(int i, int j);
        
        int sub(int i, int j);
        
        int mul(int i, int j);
        
        int div(int i, int j);
        
    }
    ```
3.  æ¥å£å®ç°
    ```java
    package com.atguigu.proxy;


    /**
     * å®ç°è®¡ç®—æ¥å£,å•çº¯æ·»åŠ  + - * / å®ç°! æºæ‚å…¶ä»–åŠŸèƒ½!
     */
    public class CalculatorPureImpl implements Calculator {
        
        @Override
        public int add(int i, int j) {
        
            int result = i + j;
        
            return result;
        }
        
        @Override
        public int sub(int i, int j) {
        
            int result = i - j;
        
            return result;
        }
        
        @Override
        public int mul(int i, int j) {
        
            int result = i * j;
        
            return result;
        }
        
        @Override
        public int div(int i, int j) {
        
            int result = i / j;
        
            return result;
        }
    }
    ```
4.  å£°æ˜å¸¦æ—¥å¿—æ¥å£å®ç°

    æ–°éœ€æ±‚ï¼š éœ€è¦åœ¨æ¯ä¸ªæ–¹æ³•ä¸­ï¼Œæ·»åŠ æ§åˆ¶å°è¾“å‡ºï¼Œè¾“å‡ºå‚æ•°å’Œè¾“å‡ºè®¡ç®—åçš„è¿”å›å€¼ï¼

    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7f0cb43ae6de39056dae562dcf857106.png)


    ```java
    package com.atguigu.proxy;

    /**
     * åœ¨æ¯ä¸ªæ–¹æ³•ä¸­,è¾“å‡ºä¼ å…¥çš„å‚æ•°å’Œè®¡ç®—åçš„è¿”å›ç»“æœ!
     */
    public class CalculatorLogImpl implements Calculator {
        
        @Override
        public int add(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
            int result = i + j;
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
          
            return result;
        }
        
        @Override
        public int sub(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            int result = i - j;
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
            return result;
        }
        
        @Override
        public int mul(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            int result = i * j;
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
        
            return result;
        }
        
        @Override
        public int div(int i, int j) {
        
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            int result = i / j;
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
            
            return result;
        }
    }
    ```
5.  ä»£ç é—®é¢˜åˆ†æ
    1.  ä»£ç ç¼ºé™·
        -   å¯¹æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æœ‰å¹²æ‰°ï¼Œå¯¼è‡´ç¨‹åºå‘˜åœ¨å¼€å‘æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æ—¶åˆ†æ•£äº†ç²¾åŠ›
        -   é™„åŠ åŠŸèƒ½ä»£ç é‡å¤ï¼Œåˆ†æ•£åœ¨å„ä¸ªä¸šåŠ¡åŠŸèƒ½æ–¹æ³•ä¸­ï¼å†—ä½™ï¼Œä¸”ä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤ï¼
    2.  è§£å†³æ€è·¯

        æ ¸å¿ƒå°±æ˜¯ï¼šè§£è€¦ã€‚æˆ‘ä»¬éœ€è¦æŠŠé™„åŠ åŠŸèƒ½ä»ä¸šåŠ¡åŠŸèƒ½ä»£ç ä¸­æŠ½å–å‡ºæ¥ã€‚

        å°†é‡å¤çš„ä»£ç ç»Ÿä¸€æå–ï¼Œå¹¶ä¸”åŠ¨æ€æ’å…¥åˆ°æ¯ä¸ªä¸šåŠ¡æ–¹æ³•ï¼

	3.  æŠ€æœ¯å›°éš¾

        è§£å†³é—®é¢˜çš„å›°éš¾ï¼šæå–é‡å¤é™„åŠ åŠŸèƒ½ä»£ç åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¯ä»¥å®ç°

        ä½†æ˜¯å¦‚ä½•å°†ä»£ç æ’å…¥åˆ°å„ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šï¼Œæˆ‘ä»¬éœ€è¦å¼•ç”¨æ–°æŠ€æœ¯ï¼ï¼ï¼

### 5.2 è§£å†³æŠ€æœ¯ä»£ç†æ¨¡å¼

1.  **ä»£ç†æ¨¡å¼**

    äºŒåä¸‰ç§è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ï¼Œå±äºç»“æ„å‹æ¨¡å¼ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯é€šè¿‡æä¾›ä¸€ä¸ªä»£ç†ç±»ï¼Œè®©æˆ‘ä»¬åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„æ—¶å€™ï¼Œä¸å†æ˜¯ç›´æ¥å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†ç±»é—´æ¥è°ƒç”¨ã€‚è®©ä¸å±äºç›®æ ‡æ–¹æ³•æ ¸å¿ƒé€»è¾‘çš„ä»£ç ä»ç›®æ ‡æ–¹æ³•ä¸­å‰¥ç¦»å‡ºæ¥â€”â€”è§£è€¦ã€‚è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶å…ˆè°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå‡å°‘å¯¹ç›®æ ‡æ–¹æ³•çš„è°ƒç”¨å’Œæ‰“æ‰°ï¼ŒåŒæ—¶è®©é™„åŠ åŠŸèƒ½èƒ½å¤Ÿé›†ä¸­åœ¨ä¸€èµ·ä¹Ÿæœ‰åˆ©äºç»Ÿä¸€ç»´æŠ¤ã€‚

    æ— ä»£ç†åœºæ™¯ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/4a7107b21913dfd91ab3a441bbced5af.png)



    æœ‰ä»£ç†åœºæ™¯ï¼š![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/77d10947a1bd16c5c8b20cb6fec68175.png)



    ç”Ÿæ´»ä¸­çš„ä»£ç†ï¼š
    -   å¹¿å‘Šå•†æ‰¾å¤§æ˜æ˜Ÿæ‹å¹¿å‘Šéœ€è¦ç»è¿‡ç»çºªäºº
    -   åˆä½œä¼™ä¼´æ‰¾å¤§è€æ¿è°ˆåˆä½œè¦çº¦è§é¢æ—¶é—´éœ€è¦ç»è¿‡ç§˜ä¹¦
    -   æˆ¿äº§ä¸­ä»‹æ˜¯ä¹°å–åŒæ–¹çš„ä»£ç†
    -   å¤ªç›‘æ˜¯å¤§è‡£å’Œçš‡ä¸Šä¹‹é—´çš„ä»£ç†
    ç›¸å…³æœ¯è¯­ï¼š
    -   ä»£ç†ï¼šå°†éæ ¸å¿ƒé€»è¾‘å‰¥ç¦»å‡ºæ¥ä»¥åï¼Œå°è£…è¿™äº›éæ ¸å¿ƒé€»è¾‘çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚(ä¸­ä»‹)
        -   åŠ¨è¯ï¼šæŒ‡åšä»£ç†è¿™ä¸ªåŠ¨ä½œï¼Œæˆ–è¿™é¡¹å·¥ä½œ
        -   åè¯ï¼šæ‰®æ¼”ä»£ç†è¿™ä¸ªè§’è‰²çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•
    -   ç›®æ ‡ï¼š**è¢«ä»£ç†**â€œå¥—ç”¨â€äº†æ ¸å¿ƒé€»è¾‘ä»£ç çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚(æˆ¿ä¸œ)
        ä»£ç†åœ¨å¼€å‘ä¸­å®ç°çš„æ–¹å¼å…·ä½“æœ‰ä¸¤ç§ï¼šé™æ€ä»£ç†ï¼Œ\[åŠ¨æ€ä»£ç†æŠ€æœ¯]

2.  **é™æ€ä»£ç†**

    ä¸»åŠ¨åˆ›å»ºä»£ç†ç±»ï¼š
    ```java
    public class CalculatorStaticProxy implements Calculator {
        
        // å°†è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡å£°æ˜ä¸ºæˆå‘˜å˜é‡
        private Calculator target;
        
        public CalculatorStaticProxy(Calculator target) {
            this.target = target;
        }
        
        @Override
        public int add(int i, int j) {
        
            // é™„åŠ åŠŸèƒ½ç”±ä»£ç†ç±»ä¸­çš„ä»£ç†æ–¹æ³•æ¥å®ç°
            System.out.println("å‚æ•°æ˜¯ï¼š" + i + "," + j);
        
            // é€šè¿‡ç›®æ ‡å¯¹è±¡æ¥å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
            int addResult = target.add(i, j);
        
            System.out.println("æ–¹æ³•å†…éƒ¨ result = " + result);
        
            return addResult;
        }
        â€¦â€¦
    ```
    é™æ€ä»£ç†ç¡®å®å®ç°äº†è§£è€¦ï¼Œä½†æ˜¯ç”±äºä»£ç éƒ½å†™æ­»äº†ï¼Œå®Œå…¨ä¸å…·å¤‡ä»»ä½•çš„çµæ´»æ€§ã€‚å°±æ‹¿æ—¥å¿—åŠŸèƒ½æ¥è¯´ï¼Œå°†æ¥å…¶ä»–åœ°æ–¹ä¹Ÿéœ€è¦é™„åŠ æ—¥å¿—ï¼Œé‚£è¿˜å¾—å†å£°æ˜æ›´å¤šä¸ªé™æ€ä»£ç†ç±»ï¼Œé‚£å°±äº§ç”Ÿäº†å¤§é‡é‡å¤çš„ä»£ç ï¼Œæ—¥å¿—åŠŸèƒ½è¿˜æ˜¯åˆ†æ•£çš„ï¼Œæ²¡æœ‰ç»Ÿä¸€ç®¡ç†ã€‚

    æå‡ºè¿›ä¸€æ­¥çš„éœ€æ±‚ï¼šå°†æ—¥å¿—åŠŸèƒ½é›†ä¸­åˆ°ä¸€ä¸ªä»£ç†ç±»ä¸­ï¼Œå°†æ¥æœ‰ä»»ä½•æ—¥å¿—éœ€æ±‚ï¼Œéƒ½é€šè¿‡è¿™ä¸€ä¸ªä»£ç†ç±»æ¥å®ç°ã€‚è¿™å°±éœ€è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯äº†ã€‚

3.  **åŠ¨æ€ä»£ç†**

    åŠ¨æ€ä»£ç†æŠ€æœ¯åˆ†ç±»
    -   JDKåŠ¨æ€ä»£ç†ï¼šJDKåŸç”Ÿçš„å®ç°æ–¹å¼ï¼Œéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡ç±»å¿…é¡»**å®ç°æ¥å£**ï¼ä»–ä¼šæ ¹æ®ç›®æ ‡ç±»çš„æ¥å£åŠ¨æ€ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡æœ‰ç›¸åŒçš„æ¥å£ï¼ï¼ˆæ‹œæŠŠå­ï¼‰
    -   cglibï¼šé€šè¿‡ç»§æ‰¿è¢«ä»£ç†çš„ç›®æ ‡ç±»å®ç°ä»£ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ï¼ï¼ˆè®¤å¹²çˆ¹ï¼‰
        JDKåŠ¨æ€ä»£ç†æŠ€æœ¯å®ç°ï¼ˆäº†è§£ï¼‰![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/1d03ea9bb9c927d65750bcac856fd205.png)



    ä»£ç†å·¥ç¨‹ï¼šåŸºäºjdkä»£ç†æŠ€æœ¯ï¼Œç”Ÿæˆä»£ç†å¯¹è±¡
    ```java
    public class ProxyFactory {

        private Object target;

        public ProxyFactory(Object target) {
            this.target = target;
        }

        public Object getProxy(){

            /**
             * newProxyInstance()ï¼šåˆ›å»ºä¸€ä¸ªä»£ç†å®ä¾‹
             * å…¶ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼š
             * 1ã€classLoaderï¼šåŠ è½½åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„ç±»åŠ è½½å™¨
             * 2ã€interfacesï¼šç›®æ ‡å¯¹è±¡å®ç°çš„æ‰€æœ‰æ¥å£çš„classå¯¹è±¡æ‰€ç»„æˆçš„æ•°ç»„
             * 3ã€invocationHandlerï¼šè®¾ç½®ä»£ç†å¯¹è±¡å®ç°ç›®æ ‡å¯¹è±¡æ–¹æ³•çš„è¿‡ç¨‹ï¼Œå³ä»£ç†ç±»ä¸­å¦‚ä½•é‡å†™æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•
             */
            ClassLoader classLoader = target.getClass().getClassLoader();
            Class<?>[] interfaces = target.getClass().getInterfaces();
            InvocationHandler invocationHandler = new InvocationHandler() {
                @Override
                public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                    /**
                     * proxyï¼šä»£ç†å¯¹è±¡
                     * methodï¼šä»£ç†å¯¹è±¡éœ€è¦å®ç°çš„æ–¹æ³•ï¼Œå³å…¶ä¸­éœ€è¦é‡å†™çš„æ–¹æ³•
                     * argsï¼šmethodæ‰€å¯¹åº”æ–¹æ³•çš„å‚æ•°
                     */
                    Object result = null;
                    try {
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œå‚æ•°ï¼š"+ Arrays.toString(args));
                        result = method.invoke(target, args);
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œç»“æœï¼š"+ result);
                    } catch (Exception e) {
                        e.printStackTrace();
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œå¼‚å¸¸ï¼š"+e.getMessage());
                    } finally {
                        System.out.println("[åŠ¨æ€ä»£ç†][æ—¥å¿—] "+method.getName()+"ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•");
                    }
                    return result;
                }
            };

            return Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);
        }
    }
    ```
    æµ‹è¯•ä»£ç ï¼š
    ```java
    @Test
    public void testDynamicProxy(){
        ProxyFactory factory = new ProxyFactory(new CalculatorLogImpl());
        Calculator proxy = (Calculator) factory.getProxy();
        proxy.div(1,0);
        //proxy.div(1,1);
    }
    ```
4.  **ä»£ç†æ€»ç»“**

    **ä»£ç†æ–¹å¼å¯ä»¥è§£å†³é™„åŠ åŠŸèƒ½ä»£ç å¹²æ‰°æ ¸å¿ƒä»£ç å’Œä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤çš„é—®é¢˜ï¼**

    ä»–ä¸»è¦æ˜¯å°†é™„åŠ åŠŸèƒ½ä»£ç æå–åˆ°ä»£ç†ä¸­æ‰§è¡Œï¼Œä¸å¹²æ‰°ç›®æ ‡æ ¸å¿ƒä»£ç ï¼

    ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå‘ç°ï¼Œæ— è®ºä½¿ç”¨é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†(jdk,cglib)ï¼Œç¨‹åºå‘˜çš„å·¥ä½œéƒ½æ¯”è¾ƒç¹çï¼

    éœ€è¦è‡ªå·±ç¼–å†™ä»£ç†å·¥å‚ç­‰ï¼

    ä½†æ˜¯ï¼Œæå‰å‰§é€ï¼Œæˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸éœ€è¦ç¼–å†™ä»£ç†ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨\[Spring AOP]æ¡†æ¶ï¼Œ

    ä»–ä¼šç®€åŒ–åŠ¨æ€ä»£ç†çš„å®ç°ï¼ï¼ï¼

### 5.3 é¢å‘åˆ‡é¢ç¼–ç¨‹æ€ç»´ï¼ˆAOPï¼‰

1.  **é¢å‘åˆ‡é¢ç¼–ç¨‹æ€æƒ³AOP**

    AOPï¼šAspect Oriented Programmingé¢å‘åˆ‡é¢ç¼–ç¨‹

    AOPå¯ä»¥è¯´æ˜¯OOPï¼ˆObject Oriented Programmingï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰çš„è¡¥å……å’Œå®Œå–„ã€‚OOPå¼•å…¥å°è£…ã€ç»§æ‰¿ã€å¤šæ€ç­‰æ¦‚å¿µæ¥å»ºç«‹ä¸€ç§å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œç”¨äºæ¨¡æ‹Ÿå…¬å…±è¡Œä¸ºçš„ä¸€ä¸ªé›†åˆã€‚ä¸è¿‡OOPå…è®¸å¼€å‘è€…å®šä¹‰çºµå‘çš„å…³ç³»ï¼Œä½†å¹¶ä¸é€‚åˆå®šä¹‰æ¨ªå‘çš„å…³ç³»ï¼Œä¾‹å¦‚æ—¥å¿—åŠŸèƒ½ã€‚æ—¥å¿—ä»£ç å¾€å¾€æ¨ªå‘åœ°æ•£å¸ƒåœ¨æ‰€æœ‰å¯¹è±¡å±‚æ¬¡ä¸­ï¼Œè€Œä¸å®ƒå¯¹åº”çš„å¯¹è±¡çš„æ ¸å¿ƒåŠŸèƒ½æ¯«æ— å…³ç³»å¯¹äºå…¶ä»–ç±»å‹çš„ä»£ç ï¼Œå¦‚å®‰å…¨æ€§ã€å¼‚å¸¸å¤„ç†å’Œé€æ˜çš„æŒç»­æ€§ä¹Ÿéƒ½æ˜¯å¦‚æ­¤ï¼Œè¿™ç§æ•£å¸ƒåœ¨å„å¤„çš„æ— å…³çš„ä»£ç è¢«ç§°ä¸ºæ¨ªåˆ‡ï¼ˆcross cuttingï¼‰ï¼Œåœ¨OOPè®¾è®¡ä¸­ï¼Œå®ƒå¯¼è‡´äº†å¤§é‡ä»£ç çš„é‡å¤ï¼Œè€Œä¸åˆ©äºå„ä¸ªæ¨¡å—çš„é‡ç”¨ã€‚

    AOPæŠ€æœ¯æ°æ°ç›¸åï¼Œå®ƒåˆ©ç”¨ä¸€ç§ç§°ä¸º"æ¨ªåˆ‡"çš„æŠ€æœ¯ï¼Œå‰–è§£å¼€å°è£…çš„å¯¹è±¡å†…éƒ¨ï¼Œå¹¶å°†é‚£äº›å½±å“äº†å¤šä¸ªç±»çš„å…¬å…±è¡Œä¸ºå°è£…åˆ°ä¸€ä¸ªå¯é‡ç”¨æ¨¡å—ï¼Œå¹¶å°†å…¶å‘½åä¸º"Aspect"ï¼Œå³åˆ‡é¢ã€‚æ‰€è°“"åˆ‡é¢"ï¼Œç®€å•è¯´å°±æ˜¯é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—ä¹‹é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ“ä½œæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

    ä½¿ç”¨AOPï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæ¥ä»£ç çš„åŸºç¡€ä¸Šæ·»åŠ æ–°åŠŸèƒ½ã€‚

2.  **AOPæ€æƒ³ä¸»è¦çš„åº”ç”¨åœºæ™¯**

    AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒé€šè¿‡å°†é€šç”¨çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ã€æƒé™æ§åˆ¶ç­‰ï¼‰ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°ã€ç®€æ´ã€æ˜“äºç»´æŠ¤ã€‚AOPå¯ä»¥åº”ç”¨äºå„ç§åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„AOPåº”ç”¨åœºæ™¯ï¼š
    1.  `æ—¥å¿—è®°å½•`ï¼šåœ¨ç³»ç»Ÿä¸­è®°å½•æ—¥å¿—æ˜¯éå¸¸é‡è¦çš„ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°æ—¥å¿—è®°å½•çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰ã€æ‰§è¡Œåæˆ–å¼‚å¸¸æŠ›å‡ºæ—¶è®°å½•æ—¥å¿—ã€‚
    2.  `äº‹åŠ¡å¤„ç†`ï¼šåœ¨æ•°æ®åº“æ“ä½œä¸­ä½¿ç”¨äº‹åŠ¡å¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•å¼€å§‹å‰å¼€å¯äº‹åŠ¡ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åæäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚
    3.  `å®‰å…¨æ§åˆ¶`ï¼šåœ¨ç³»ç»Ÿä¸­åŒ…å«æŸäº›éœ€è¦å®‰å…¨æ§åˆ¶çš„æ“ä½œï¼Œå¦‚ç™»å½•ã€ä¿®æ”¹å¯†ç ã€æˆæƒç­‰ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°å®‰å…¨æ§åˆ¶çš„åŠŸèƒ½ã€‚å¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰è¿›è¡Œæƒé™åˆ¤æ–­ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰æƒé™ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸æˆ–è½¬å‘åˆ°é”™è¯¯é¡µé¢ï¼Œä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ã€‚
    4.  `æ€§èƒ½ç›‘æ§`ï¼šåœ¨ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶éœ€è¦å¯¹æŸäº›æ–¹æ³•çš„æ€§èƒ½è¿›è¡Œç›‘æ§ï¼Œä»¥æ‰¾åˆ°ç³»ç»Ÿçš„ç“¶é¢ˆå¹¶è¿›è¡Œä¼˜åŒ–ã€‚å¯ä»¥ä½¿ç”¨AOPæ¥å®ç°æ€§èƒ½ç›‘æ§çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰è®°å½•æ—¶é—´æˆ³ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åè®¡ç®—æ–¹æ³•æ‰§è¡Œæ—¶é—´å¹¶è¾“å‡ºåˆ°æ—¥å¿—ä¸­ã€‚
    5.  `å¼‚å¸¸å¤„ç†`ï¼šç³»ç»Ÿä¸­å¯èƒ½å‡ºç°å„ç§å¼‚å¸¸æƒ…å†µï¼Œå¦‚ç©ºæŒ‡é’ˆå¼‚å¸¸ã€æ•°æ®åº“è¿æ¥å¼‚å¸¸ç­‰ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°å¼‚å¸¸å¤„ç†çš„åŠŸèƒ½ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼ˆå¦‚è®°å½•æ—¥å¿—ã€å‘é€é‚®ä»¶ç­‰ï¼‰ã€‚
    6.  `ç¼“å­˜æ§åˆ¶`ï¼šåœ¨ç³»ç»Ÿä¸­æœ‰äº›æ•°æ®å¯ä»¥ç¼“å­˜èµ·æ¥ä»¥æé«˜è®¿é—®é€Ÿåº¦ï¼Œå¯ä»¥ä½¿ç”¨AOPæ¥å®ç°ç¼“å­˜æ§åˆ¶çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œå‰æŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰åˆ™è¿”å›ï¼Œå¦åˆ™æ‰§è¡Œæ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼å­˜å…¥ç¼“å­˜ä¸­ã€‚
    7.  `åŠ¨æ€ä»£ç†`ï¼šAOPçš„å®ç°æ–¹å¼ä¹‹ä¸€æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œå¯ä»¥ä»£ç†æŸä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œç”¨äºå®ç°å„ç§åŠŸèƒ½ã€‚
        ç»¼ä¸Šæ‰€è¿°ï¼ŒAOPå¯ä»¥åº”ç”¨äºå„ç§åœºæ™¯ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†é€šç”¨çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°ã€ç®€æ´ã€æ˜“äºç»´æŠ¤ã€‚

3.  **AOPæœ¯è¯­åè¯ä»‹ç»**

    1-æ¨ªåˆ‡å…³æ³¨ç‚¹

    ä»æ¯ä¸ªæ–¹æ³•ä¸­æŠ½å–å‡ºæ¥çš„åŒä¸€ç±»éæ ¸å¿ƒä¸šåŠ¡ã€‚åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹å¯¹ç›¸å…³æ–¹æ³•è¿›è¡Œå¤šä¸ªä¸åŒæ–¹é¢çš„å¢å¼ºã€‚

    è¿™ä¸ªæ¦‚å¿µä¸æ˜¯è¯­æ³•å±‚é¢å¤©ç„¶å­˜åœ¨çš„ï¼Œè€Œæ˜¯æ ¹æ®é™„åŠ åŠŸèƒ½çš„é€»è¾‘ä¸Šçš„éœ€è¦ï¼šæœ‰åä¸ªé™„åŠ åŠŸèƒ½ï¼Œå°±æœ‰åä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/64876b20aa9aa52dbd206e36acd8f1d4.png)



    AOPæŠŠè½¯ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š`æ ¸å¿ƒå…³æ³¨ç‚¹`å’Œ`æ¨ªåˆ‡å…³æ³¨ç‚¹`ã€‚ä¸šåŠ¡å¤„ç†çš„ä¸»è¦æµç¨‹æ˜¯æ ¸å¿ƒå…³æ³¨ç‚¹ï¼Œä¸ä¹‹å…³ç³»ä¸å¤§çš„éƒ¨åˆ†æ˜¯æ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚æ¨ªåˆ‡å…³æ³¨ç‚¹çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œä»–ä»¬ç»å¸¸å‘ç”Ÿåœ¨æ ¸å¿ƒå…³æ³¨ç‚¹çš„å¤šå¤„ï¼Œè€Œå„å¤„åŸºæœ¬ç›¸ä¼¼ï¼Œæ¯”å¦‚æƒé™è®¤è¯ã€æ—¥å¿—ã€äº‹åŠ¡ã€å¼‚å¸¸ç­‰ã€‚AOPçš„ä½œç”¨åœ¨äºåˆ†ç¦»ç³»ç»Ÿä¸­çš„å„ç§å…³æ³¨ç‚¹ï¼Œå°†æ ¸å¿ƒå…³æ³¨ç‚¹å’Œæ¨ªåˆ‡å…³æ³¨ç‚¹åˆ†ç¦»å¼€æ¥ã€‚

    2-é€šçŸ¥(å¢å¼º)

    æ¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ä¸Šè¦åšçš„äº‹æƒ…éƒ½éœ€è¦å†™ä¸€ä¸ªæ–¹æ³•æ¥å®ç°ï¼Œè¿™æ ·çš„æ–¹æ³•å°±å«é€šçŸ¥æ–¹æ³•ã€‚
    -   å‰ç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•å‰æ‰§è¡Œ
    -   è¿”å›é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•æˆåŠŸç»“æŸåæ‰§è¡Œï¼ˆ**å¯¿ç»ˆæ­£å¯**ï¼‰
    -   å¼‚å¸¸é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•å¼‚å¸¸ç»“æŸåæ‰§è¡Œï¼ˆ**æ­»äºéå‘½**ï¼‰
    -   åç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•æœ€ç»ˆç»“æŸåæ‰§è¡Œï¼ˆ**ç›–æ£ºå®šè®º**ï¼‰
    -   ç¯ç»•é€šçŸ¥ï¼šä½¿ç”¨try...catch...finallyç»“æ„å›´ç»•æ•´ä¸ªè¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸Šé¢å››ç§é€šçŸ¥å¯¹åº”çš„æ‰€æœ‰ä½ç½®![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7fb04fe4b1786175790bbfffb1827823.png)


    3-è¿æ¥ç‚¹ joinpoint

    è¿™ä¹Ÿæ˜¯ä¸€ä¸ªçº¯é€»è¾‘æ¦‚å¿µï¼Œä¸æ˜¯è¯­æ³•å®šä¹‰çš„ã€‚

    æŒ‡é‚£äº›è¢«æ‹¦æˆªåˆ°çš„ç‚¹ã€‚åœ¨ Spring ä¸­ï¼Œå¯ä»¥è¢«åŠ¨æ€ä»£ç†æ‹¦æˆªç›®æ ‡ç±»çš„æ–¹æ³•![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/2825496dd4c521e78ff93b34082c8396.png)



    4-åˆ‡å…¥ç‚¹ pointcut

    å®šä½è¿æ¥ç‚¹çš„æ–¹å¼ï¼Œæˆ–è€…å¯ä»¥ç†è§£æˆè¢«é€‰ä¸­çš„è¿æ¥ç‚¹ï¼

    æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæ¯”å¦‚execution(\* com.spring.service.impl.*.*(..))ã€‚ç¬¦åˆæ¡ä»¶çš„æ¯ä¸ªæ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªå…·ä½“çš„è¿æ¥ç‚¹ã€‚

    5-åˆ‡é¢ aspect

    åˆ‡å…¥ç‚¹å’Œé€šçŸ¥çš„ç»“åˆã€‚æ˜¯ä¸€ä¸ªç±»ã€‚![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ced83016f1570ae6ddd6730331329bb4.png)



    6-ç›®æ ‡ target

    è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ã€‚

    7-ä»£ç† proxy

    å‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„ä»£ç†å¯¹è±¡ã€‚

    8-ç»‡å…¥ weave

    æŒ‡æŠŠé€šçŸ¥åº”ç”¨åˆ°ç›®æ ‡ä¸Šï¼Œç”Ÿæˆä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚å¯ä»¥åœ¨ç¼–è¯‘æœŸç»‡å…¥ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡ŒæœŸç»‡å…¥ï¼ŒSpringé‡‡ç”¨åè€…ã€‚

### 5.4 Spring AOPæ¡†æ¶ä»‹ç»å’Œå…³ç³»æ¢³ç†

1.  AOPä¸€ç§åŒºåˆ«äºOOPçš„ç¼–ç¨‹æ€ç»´ï¼Œç”¨æ¥å®Œå–„å’Œè§£å†³OOPçš„éæ ¸å¿ƒä»£ç å†—ä½™å’Œä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤é—®é¢˜ï¼
2.  ä»£ç†æŠ€æœ¯ï¼ˆåŠ¨æ€ä»£ç†|é™æ€ä»£ç†ï¼‰æ˜¯å®ç°AOPæ€ç»´ç¼–ç¨‹çš„å…·ä½“æŠ€æœ¯ï¼Œä½†æ˜¯è‡ªå·±ä½¿ç”¨åŠ¨æ€ä»£ç†å®ç°ä»£ç æ¯”è¾ƒç¹çï¼
3.  Spring AOPæ¡†æ¶ï¼ŒåŸºäºAOPç¼–ç¨‹æ€ç»´ï¼Œå°è£…åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œç®€åŒ–åŠ¨æ€ä»£ç†æŠ€æœ¯å®ç°çš„æ¡†æ¶ï¼SpringAOPå†…éƒ¨å¸®åŠ©æˆ‘ä»¬å®ç°åŠ¨æ€ä»£ç†ï¼Œæˆ‘ä»¬åªéœ€å†™å°‘é‡çš„é…ç½®ï¼ŒæŒ‡å®šç”Ÿæ•ˆèŒƒå›´å³å¯,å³å¯å®Œæˆé¢å‘åˆ‡é¢æ€ç»´ç¼–ç¨‹çš„å®ç°ï¼
### 5.5 Spring AOPåŸºäºæ³¨è§£æ–¹å¼å®ç°å’Œç»†èŠ‚

#### 5.5.1 Spring AOPåº•å±‚æŠ€æœ¯ç»„æˆ

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/1b5401be5e033cd393f6e3a2a0f0c03b.png)



-   åŠ¨æ€ä»£ç†ï¼ˆInvocationHandlerï¼‰ï¼šJDKåŸç”Ÿçš„å®ç°æ–¹å¼ï¼Œéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£ã€‚å› ä¸ºè¿™ä¸ªæŠ€æœ¯è¦æ±‚ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å®ç°åŒæ ·çš„æ¥å£ï¼ˆå…„å¼Ÿä¸¤ä¸ªæ‹œæŠŠå­æ¨¡å¼ï¼‰ã€‚
-   cglibï¼šé€šè¿‡ç»§æ‰¿è¢«ä»£ç†çš„ç›®æ ‡ç±»ï¼ˆè®¤å¹²çˆ¹æ¨¡å¼ï¼‰å®ç°ä»£ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ã€‚
-   AspectJï¼šæ—©æœŸçš„AOPå®ç°çš„æ¡†æ¶ï¼ŒSpringAOPå€Ÿç”¨äº†AspectJä¸­çš„AOPæ³¨è§£ã€‚

#### 5.5.2 åˆæ­¥å®ç°

1.  åŠ å…¥ä¾èµ–
    ```xml
    <!-- spring-aspectsä¼šå¸®æˆ‘ä»¬ä¼ é€’è¿‡æ¥aspectjweaver -->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-aop</artifactId>
        <version>6.0.6</version>
    </dependency>

    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-aspects</artifactId>
        <version>6.0.6</version>
    </dependency>
    ```

- å…³äºAOPå¯¼åŒ…çš„é—®é¢˜ï¼ˆaspectjweaverå’Œspring-aspectsçš„åŒºåˆ«ï¼‰
	1. `aspectjweaver`æ˜¯AspectJçš„è¿è¡Œæ—¶åº“ï¼Œå®ƒæä¾›äº†å®ç°åˆ‡é¢ç¼–ç¨‹çš„æ ¸å¿ƒåŠŸèƒ½ã€‚AspectJæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åˆ‡é¢ç¼–ç¨‹æ¡†æ¶ï¼Œå®ƒå…è®¸åœ¨Javaåº”ç”¨ç¨‹åºä¸­å®šä¹‰å’Œåº”ç”¨åˆ‡é¢ã€‚`aspectjweaver`åº“åŒ…å«äº†AspectJçš„æ ¸å¿ƒåŠŸèƒ½å’Œè¿è¡Œæ—¶å·¥å…·ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶ç»‡å…¥å’Œæ‰§è¡Œåˆ‡é¢ä»£ç ã€‚ä½¿ç”¨AspectJï¼Œä½ å¯ä»¥å®šä¹‰åˆ‡é¢ã€åˆ‡ç‚¹å’Œé€šçŸ¥ï¼Œæ¥å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹çš„å¤„ç†ã€‚
    
	1. `spring-aspects`æ˜¯Spring Frameworkæä¾›çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒä½¿ç”¨äº†AspectJå’Œ`aspectjweaver`åº“ï¼Œå¹¶æä¾›äº†ä¸Springæ¡†æ¶é›†æˆçš„åˆ‡é¢ç¼–ç¨‹åŠŸèƒ½ã€‚`spring-aspects`æ¨¡å—ä¸ºSpringåº”ç”¨ç¨‹åºæä¾›äº†ä¸€äº›é¢„å®šä¹‰çš„åˆ‡é¢ï¼Œä¾‹å¦‚äº‹åŠ¡ç®¡ç†çš„åˆ‡é¢(`@Transactional`)å’Œå¼‚æ­¥æ‰§è¡Œçš„åˆ‡é¢(`@Async`)ç­‰ã€‚é€šè¿‡ä½¿ç”¨`spring-aspects`ï¼Œä½ å¯ä»¥å°†è¿™äº›é¢„å®šä¹‰çš„åˆ‡é¢ç›´æ¥åº”ç”¨åˆ°ä½ çš„Springåº”ç”¨ç¨‹åºä¸­ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™AspectJåˆ‡é¢ã€‚

- ç®€è€Œè¨€ä¹‹ï¼Œ`aspectjweaver`æä¾›äº†AspectJåˆ‡é¢ç¼–ç¨‹æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½å’Œè¿è¡Œæ—¶æ”¯æŒï¼Œå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ã€‚è€Œ`spring-aspects`æ˜¯Spring Frameworkçš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒé›†æˆäº†AspectJå’Œ`aspectjweaver`ï¼Œæä¾›äº†ä¸€äº›ä¸Springæ¡†æ¶é›†æˆçš„åˆ‡é¢åŠŸèƒ½ã€‚

- å¦‚æœä½ åªéœ€è¦ä½¿ç”¨AspectJçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç‹¬ç«‹äºSpring Frameworkï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨`aspectjweaver`ã€‚å¦‚æœä½ æ­£åœ¨å¼€å‘åŸºäºSpring Frameworkçš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨Springæä¾›çš„åˆ‡é¢åŠŸèƒ½ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©ä½¿ç”¨`spring-aspects`æ¨¡å—ã€‚

2.  å‡†å¤‡æ¥å£
    ```java
    public interface Calculator {
        
        int add(int i, int j);
        
        int sub(int i, int j);
        
        int mul(int i, int j);
        
        int div(int i, int j);
        
    }
    ```
3.  çº¯å‡€å®ç°ç±»
    ```java
    package com.atguigu.proxy;


    /**
     * å®ç°è®¡ç®—æ¥å£,å•çº¯æ·»åŠ  + - * / å®ç°! æºæ‚å…¶ä»–åŠŸèƒ½!
     */
    @Component
    public class CalculatorPureImpl implements Calculator {
        
        @Override
        public int add(int i, int j) {
        
            int result = i + j;
        
            return result;
        }
        
        @Override
        public int sub(int i, int j) {
        
            int result = i - j;
        
            return result;
        }
        
        @Override
        public int mul(int i, int j) {
        
            int result = i * j;
        
            return result;
        }
        
        @Override
        public int div(int i, int j) {
        
            int result = i / j;
        
            return result;
        }
    }
    ```
4.  å£°æ˜åˆ‡é¢ç±»
    ```java
    package com.atguigu.advice;

    import org.aspectj.lang.annotation.*;
    import org.springframework.stereotype.Component;

    // @Aspectè¡¨ç¤ºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»
    @Aspect
    // @Componentæ³¨è§£ä¿è¯è¿™ä¸ªåˆ‡é¢ç±»èƒ½å¤Ÿæ”¾å…¥IOCå®¹å™¨
    @Component
    public class LogAspect {
            
        // @Beforeæ³¨è§£ï¼šå£°æ˜å½“å‰æ–¹æ³•æ˜¯å‰ç½®é€šçŸ¥æ–¹æ³•
        // valueå±æ€§ï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œç”±åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ§åˆ¶å½“å‰é€šçŸ¥æ–¹æ³•è¦ä½œç”¨åœ¨å“ªä¸€ä¸ªç›®æ ‡æ–¹æ³•ä¸Š
        @Before(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogBeforeCore() {
            System.out.println("[AOPå‰ç½®é€šçŸ¥] æ–¹æ³•å¼€å§‹äº†");
        }
        
        @AfterReturning(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogAfterSuccess() {
            System.out.println("[AOPè¿”å›é€šçŸ¥] æ–¹æ³•æˆåŠŸè¿”å›äº†");
        }
        
        @AfterThrowing(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogAfterException() {
            System.out.println("[AOPå¼‚å¸¸é€šçŸ¥] æ–¹æ³•æŠ›å¼‚å¸¸äº†");
        }
        
        @After(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
        public void printLogFinallyEnd() {
            System.out.println("[AOPåç½®é€šçŸ¥] æ–¹æ³•æœ€ç»ˆç»“æŸäº†");
        }
        
    }
    ```
5.  å¼€å¯aspectjæ³¨è§£æ”¯æŒ
    1.  xmlæ–¹å¼
        ```xml
        <?xml version="1.0" encoding="UTF-8"?>
        <beans xmlns="http://www.springframework.org/schema/beans"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns:context="http://www.springframework.org/schema/context"
               xmlns:aop="http://www.springframework.org/schema/aop"
               xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd">

            <!-- è¿›è¡ŒåŒ…æ‰«æ-->
            <context:component-scan base-package="com.atguigu" />
            <!-- å¼€å¯aspectjæ¡†æ¶æ³¨è§£æ”¯æŒ-->
            <aop:aspectj-autoproxy />
        </beans>
        ```
    2.  é…ç½®ç±»æ–¹å¼
        ```java
        @Configuration
        @ComponentScan(basePackages = "com.atguigu")
        //ä½œç”¨ç­‰äº <aop:aspectj-autoproxy /> é…ç½®ç±»ä¸Šå¼€å¯ Aspectjæ³¨è§£æ”¯æŒ!
        @EnableAspectJAutoProxy
        public class MyConfig {
        }

        ```
6.  æµ‹è¯•æ•ˆæœ
    ```java
    //@SpringJUnitConfig(locations = "classpath:spring-aop.xml")
    @SpringJUnitConfig(value = {MyConfig.class})
    public class AopTest {

        @Autowired
        private Calculator calculator;

        @Test
        public void testCalculator(){
            calculator.add(1,1);
        }
    }

    ```
    è¾“å‡ºç»“æœï¼š
    ```java
    [AOPå‰ç½®é€šçŸ¥] æ–¹æ³•å¼€å§‹äº†
    [AOPè¿”å›é€šçŸ¥] æ–¹æ³•æˆåŠŸè¿”å›äº†
    [AOPåç½®é€šçŸ¥] æ–¹æ³•æœ€ç»ˆç»“æŸäº†
    ```

- æ³¨æ„ï¼š`@Autowiredå£°æ˜çš„æ˜¯æ¥å£ï¼Œè€Œä¸æ˜¯å®ç°ç±»`
- å› ä¸ºï¼šAOPä»£ç†æ¨¡å¼ï¼Œä½¿ç”¨jdkè¿›è¡Œæ¥å£çš„ä»£ç†ï¼Œæ‰€ä»¥å…·ä½“çš„å®ç°ç±»ï¼Œå’ŒIOCä¸­çš„ä»£ç†ç±»ä¼šå‘ç”Ÿå†²çªï¼ï¼ï¼

#### 5.5.3 è·å–é€šçŸ¥ç»†èŠ‚ä¿¡æ¯

1.  **JointPointæ¥å£**

    éœ€è¦è·å–æ–¹æ³•ç­¾åã€ä¼ å…¥çš„å®å‚ç­‰ä¿¡æ¯æ—¶ï¼Œå¯ä»¥åœ¨é€šçŸ¥æ–¹æ³•å£°æ˜JoinPointç±»å‹çš„å½¢å‚ã€‚
    -   è¦ç‚¹1ï¼šJoinPoint æ¥å£é€šè¿‡ getSignature() æ–¹æ³•è·å–ç›®æ ‡æ–¹æ³•çš„ç­¾åï¼ˆæ–¹æ³•å£°æ˜æ—¶çš„å®Œæ•´ä¿¡æ¯ï¼‰
    -   è¦ç‚¹2ï¼šé€šè¿‡ç›®æ ‡æ–¹æ³•ç­¾åå¯¹è±¡è·å–æ–¹æ³•å
    -   è¦ç‚¹3ï¼šé€šè¿‡ JoinPoint å¯¹è±¡è·å–å¤–ç•Œè°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ä¼ å…¥çš„å®å‚åˆ—è¡¨ç»„æˆçš„æ•°ç»„![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b21e810f3c9ec7a8bfe98f9dc5f05c29.png)


    ```java
    // @Beforeæ³¨è§£æ ‡è®°å‰ç½®é€šçŸ¥æ–¹æ³•
    // valueå±æ€§ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œå‘Šè¯‰Springå½“å‰é€šçŸ¥æ–¹æ³•è¦å¥—ç”¨åˆ°å“ªä¸ªç›®æ ‡æ–¹æ³•ä¸Š
    // åœ¨å‰ç½®é€šçŸ¥æ–¹æ³•å½¢å‚ä½ç½®å£°æ˜ä¸€ä¸ªJoinPointç±»å‹çš„å‚æ•°ï¼ŒSpringå°±ä¼šå°†è¿™ä¸ªå¯¹è±¡ä¼ å…¥
    // æ ¹æ®JoinPointå¯¹è±¡å°±å¯ä»¥è·å–ç›®æ ‡æ–¹æ³•åç§°ã€å®é™…å‚æ•°åˆ—è¡¨
    @Before(value = "execution(public int com.atguigu.aop.api.Calculator.add(int,int))")
    public void printLogBeforeCore(JoinPoint joinPoint) {
        
        // 1.é€šè¿‡JoinPointå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•ç­¾åå¯¹è±¡
        // æ–¹æ³•çš„ç­¾åï¼šä¸€ä¸ªæ–¹æ³•çš„å…¨éƒ¨å£°æ˜ä¿¡æ¯
        Signature signature = joinPoint.getSignature();
        
        // 2.é€šè¿‡æ–¹æ³•çš„ç­¾åå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯
        String methodName = signature.getName();
        System.out.println("methodName = " + methodName);
        
        int modifiers = signature.getModifiers();
        System.out.println("modifiers = " + modifiers);
        
        String declaringTypeName = signature.getDeclaringTypeName();
        System.out.println("declaringTypeName = " + declaringTypeName);
        
        // 3.é€šè¿‡JoinPointå¯¹è±¡è·å–å¤–ç•Œè°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ä¼ å…¥çš„å®å‚åˆ—è¡¨
        Object[] args = joinPoint.getArgs();
        
        // 4.ç”±äºæ•°ç»„ç›´æ¥æ‰“å°çœ‹ä¸åˆ°å…·ä½“æ•°æ®ï¼Œæ‰€ä»¥è½¬æ¢ä¸ºListé›†åˆ
        List<Object> argList = Arrays.asList(args);
        
        System.out.println("[AOPå‰ç½®é€šçŸ¥] " + methodName + "æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°åˆ—è¡¨ï¼š" + argList);
    }
    ```
2.  **æ–¹æ³•è¿”å›å€¼**

    åœ¨è¿”å›é€šçŸ¥ä¸­ï¼Œé€šè¿‡ **@AfterReturning**æ³¨è§£çš„returningå±æ€§è·å–ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ï¼
    ```java
    // @AfterReturningæ³¨è§£æ ‡è®°è¿”å›é€šçŸ¥æ–¹æ³•
    // åœ¨è¿”å›é€šçŸ¥ä¸­è·å–ç›®æ ‡æ–¹æ³•è¿”å›å€¼åˆ†ä¸¤æ­¥ï¼š
    // ç¬¬ä¸€æ­¥ï¼šåœ¨@AfterReturningæ³¨è§£ä¸­é€šè¿‡returningå±æ€§è®¾ç½®ä¸€ä¸ªåç§°
    // ç¬¬äºŒæ­¥ï¼šä½¿ç”¨returningå±æ€§è®¾ç½®çš„åç§°åœ¨é€šçŸ¥æ–¹æ³•ä¸­å£°æ˜ä¸€ä¸ªå¯¹åº”çš„å½¢å‚
    @AfterReturning(
            value = "execution(public int com.atguigu.aop.api.Calculator.add(int,int))",
            returning = "targetMethodReturnValue"
    )
    public void printLogAfterCoreSuccess(JoinPoint joinPoint, Object targetMethodReturnValue) {
        
        String methodName = joinPoint.getSignature().getName();
        
        System.out.println("[AOPè¿”å›é€šçŸ¥] "+methodName+"æ–¹æ³•æˆåŠŸç»“æŸäº†ï¼Œè¿”å›å€¼æ˜¯ï¼š" + targetMethodReturnValue);
    }
    ```
3.  **å¼‚å¸¸å¯¹è±¡æ•æ‰**

    åœ¨å¼‚å¸¸é€šçŸ¥ä¸­ï¼Œé€šè¿‡@AfterThrowingæ³¨è§£çš„throwingå±æ€§è·å–ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡
    ```java
    // @AfterThrowingæ³¨è§£æ ‡è®°å¼‚å¸¸é€šçŸ¥æ–¹æ³•
    // åœ¨å¼‚å¸¸é€šçŸ¥ä¸­è·å–ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸åˆ†ä¸¤æ­¥ï¼š
    // ç¬¬ä¸€æ­¥ï¼šåœ¨@AfterThrowingæ³¨è§£ä¸­å£°æ˜ä¸€ä¸ªthrowingå±æ€§è®¾å®šå½¢å‚åç§°
    // ç¬¬äºŒæ­¥ï¼šä½¿ç”¨throwingå±æ€§æŒ‡å®šçš„åç§°åœ¨é€šçŸ¥æ–¹æ³•å£°æ˜å½¢å‚ï¼ŒSpringä¼šå°†ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡ä»è¿™é‡Œä¼ ç»™æˆ‘ä»¬
    @AfterThrowing(
            value = "execution(public int com.atguigu.aop.api.Calculator.add(int,int))",
            throwing = "targetMethodException"
    )
    public void printLogAfterCoreException(JoinPoint joinPoint, Throwable targetMethodException) {
        
        String methodName = joinPoint.getSignature().getName();
        
        System.out.println("[AOPå¼‚å¸¸é€šçŸ¥] "+methodName+"æ–¹æ³•æŠ›å¼‚å¸¸äº†ï¼Œå¼‚å¸¸ç±»å‹æ˜¯ï¼š" + targetMethodException.getClass().getName());
    }
    ```

#### 5.5.4 åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•

1.  **åˆ‡ç‚¹è¡¨è¾¾å¼ä½œç”¨**

    AOPåˆ‡ç‚¹è¡¨è¾¾å¼ï¼ˆPointcut Expressionï¼‰æ˜¯ä¸€ç§ç”¨äºæŒ‡å®šåˆ‡ç‚¹çš„è¯­è¨€ï¼Œå®ƒå¯ä»¥é€šè¿‡å®šä¹‰åŒ¹é…è§„åˆ™ï¼Œæ¥é€‰æ‹©éœ€è¦è¢«åˆ‡å…¥çš„ç›®æ ‡å¯¹è±¡ã€‚
    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/dcc7d03cd316a79c950bf2007f92350a.png)


2.  **åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•**

    åˆ‡ç‚¹è¡¨è¾¾å¼æ€»ç»“
    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/77a50f560c8e82530b5f56294469597b.png)



    è¯­æ³•ç»†èŠ‚
    -   ç¬¬ä¸€ä½ï¼šexecution( ) å›ºå®šå¼€å¤´
    -   ç¬¬äºŒä½ï¼šæ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦
        ```java
        public private ç›´æ¥æè¿°å¯¹åº”ä¿®é¥°ç¬¦å³å¯
        ```
    -   ç¬¬ä¸‰ä½ï¼šæ–¹æ³•è¿”å›å€¼
        ```java
        int String void ç›´æ¥æè¿°è¿”å›å€¼ç±»å‹

        ```
        æ³¨æ„ï¼š

        ç‰¹æ®Šæƒ…å†µÂ ä¸è€ƒè™‘Â è®¿é—®ä¿®é¥°ç¬¦å’Œè¿”å›å€¼

        execution(\*Â \*Â )Â è¿™æ˜¯é”™è¯¯è¯­æ³•

        execution( \*) == ä½ åªè¦è€ƒè™‘è¿”å›å€¼ æˆ–è€… ä¸è€ƒè™‘è®¿é—®ä¿®é¥°ç¬¦ ç›¸å½“äºå…¨éƒ¨ä¸è€ƒè™‘äº†
    -   ç¬¬å››ä½ï¼šæŒ‡å®šåŒ…çš„åœ°å€
        ```java
         å›ºå®šçš„åŒ…: com.atguigu.api | service | dao
         å•å±‚çš„ä»»æ„å‘½å: com.atguigu.*  = com.atguigu.api  com.atguigu.dao  * = ä»»æ„ä¸€å±‚çš„ä»»æ„å‘½å
         ä»»æ„å±‚ä»»æ„å‘½å: com.. = com.atguigu.api.erdaye com.a.a.a.a.a.a.a  ..ä»»æ„å±‚,ä»»æ„å‘½å ç”¨åœ¨åŒ…ä¸Š!
         æ³¨æ„: ..ä¸èƒ½ç”¨ä½œåŒ…å¼€å¤´   public int .. é”™è¯¯è¯­æ³•  com..
         æ‰¾åˆ°ä»»ä½•åŒ…ä¸‹: *..
        ```
    -   ç¬¬äº”ä½ï¼šæŒ‡å®šç±»åç§°
        ```java
        å›ºå®šåç§°: UserService
        ä»»æ„ç±»å: *
        éƒ¨åˆ†ä»»æ„: com..service.impl.*Impl
        ä»»æ„åŒ…ä»»æ„ç±»: *..*

        ```
    -   ç¬¬å…­ä½ï¼šæŒ‡å®šæ–¹æ³•åç§°
        ```java
        è¯­æ³•å’Œç±»åä¸€è‡´
        ä»»æ„è®¿é—®ä¿®é¥°ç¬¦,ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•: * *..*.*
        ```
    -   ç¬¬ä¸ƒä½ï¼šæ–¹æ³•å‚æ•°
        ```java
        ç¬¬ä¸ƒä½: æ–¹æ³•çš„å‚æ•°æè¿°
               å…·ä½“å€¼: (String,int) != (int,String) æ²¡æœ‰å‚æ•° ()
               æ¨¡ç³Šå€¼: ä»»æ„å‚æ•° æœ‰ æˆ–è€… æ²¡æœ‰ (..)  ..ä»»æ„å‚æ•°çš„æ„è¯†
               éƒ¨åˆ†å…·ä½“å’Œæ¨¡ç³Š:
                 ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²çš„æ–¹æ³• (String..)
                 æœ€åä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸² (..String)
                 å­—ç¬¦ä¸²å¼€å¤´,intç»“å°¾ (String..int)
                 åŒ…å«intç±»å‹(..int..)
        ```
3.  **åˆ‡ç‚¹è¡¨è¾¾å¼æ¡ˆä¾‹**
    ```java
    1.æŸ¥è¯¢æŸåŒ…æŸç±»ä¸‹ï¼Œè®¿é—®ä¿®é¥°ç¬¦æ˜¯å…¬æœ‰ï¼Œè¿”å›å€¼æ˜¯intçš„å…¨éƒ¨æ–¹æ³•
    public int xx.xx.jj.*(..)
    2.æŸ¥è¯¢æŸåŒ…ä¸‹ç±»ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Stringçš„æ–¹æ³•
    * xx.xx.jj.*(String..)
    3.æŸ¥è¯¢å…¨éƒ¨åŒ…ä¸‹ï¼Œæ— å‚æ•°çš„æ–¹æ³•ï¼
    * *..*()
    4.æŸ¥è¯¢comåŒ…ä¸‹ï¼Œä»¥intå‚æ•°ç±»å‹ç»“å°¾çš„æ–¹æ³•
    * com..*.*(..int)
    5.æŸ¥è¯¢æŒ‡å®šåŒ…ä¸‹ï¼ŒServiceå¼€å¤´ç±»çš„ç§æœ‰è¿”å›å€¼intçš„æ— å‚æ•°æ–¹æ³•
    private int xx.xx.Service*.*()
    ```
#### 5.5.5 é‡ç”¨ï¼ˆæå–ï¼‰åˆ‡ç‚¹è¡¨è¾¾å¼

1.  é‡ç”¨åˆ‡ç‚¹è¡¨è¾¾å¼ä¼˜ç‚¹
    ```java
     // @Beforeæ³¨è§£ï¼šå£°æ˜å½“å‰æ–¹æ³•æ˜¯å‰ç½®é€šçŸ¥æ–¹æ³•
    // valueå±æ€§ï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œç”±åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ§åˆ¶å½“å‰é€šçŸ¥æ–¹æ³•è¦ä½œç”¨åœ¨å“ªä¸€ä¸ªç›®æ ‡æ–¹æ³•ä¸Š
    @Before(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogBeforeCore() {
        System.out.println("[AOPå‰ç½®é€šçŸ¥] æ–¹æ³•å¼€å§‹äº†");
    }

    @AfterReturning(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogAfterSuccess() {
        System.out.println("[AOPè¿”å›é€šçŸ¥] æ–¹æ³•æˆåŠŸè¿”å›äº†");
    }

    @AfterThrowing(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogAfterException() {
        System.out.println("[AOPå¼‚å¸¸é€šçŸ¥] æ–¹æ³•æŠ›å¼‚å¸¸äº†");
    }

    @After(value = "execution(public int com.atguigu.proxy.CalculatorPureImpl.add(int,int))")
    public void printLogFinallyEnd() {
        System.out.println("[AOPåç½®é€šçŸ¥] æ–¹æ³•æœ€ç»ˆç»“æŸäº†");
    }
    ```
    ä¸Šé¢æ¡ˆä¾‹ï¼Œæ˜¯æˆ‘ä»¬ä¹‹å‰ç¼–å†™åˆ‡ç‚¹è¡¨è¾¾å¼çš„æ–¹å¼ï¼Œå‘ç°ï¼Œ æ‰€æœ‰å¢å¼ºæ–¹æ³•çš„åˆ‡ç‚¹è¡¨è¾¾å¼ç›¸åŒï¼

    å‡ºç°äº†å†—ä½™ï¼Œå¦‚æœéœ€è¦åˆ‡æ¢ä¹Ÿä¸æ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤ï¼

    æˆ‘ä»¬å¯ä»¥å°†åˆ‡ç‚¹æå–ï¼Œåœ¨å¢å¼ºä¸Šè¿›è¡Œå¼•ç”¨å³å¯ï¼

2.  åŒä¸€ç±»å†…éƒ¨å¼•ç”¨

    æå–
    ```java
    // åˆ‡å…¥ç‚¹è¡¨è¾¾å¼é‡ç”¨
    @Pointcut("execution(public int com.atguigu.aop.api.Calculator.add(int,int)))")
    public void declarPointCut() {}
    ```
    æ³¨æ„ï¼šæå–åˆ‡ç‚¹æ³¨è§£ä½¿ç”¨@Pointcut(åˆ‡ç‚¹è¡¨è¾¾å¼) ï¼Œ éœ€è¦æ·»åŠ åˆ°ä¸€ä¸ªæ— å‚æ•°æ— è¿”å›å€¼æ–¹æ³•ä¸Šå³å¯ï¼

    å¼•ç”¨
    ```java
    @Before(value = "declarPointCut()")
    public void printLogBeforeCoreOperation(JoinPoint joinPoint) {
    ```
3.  ä¸åŒç±»ä¸­å¼•ç”¨

    ä¸åŒç±»åœ¨å¼•ç”¨åˆ‡ç‚¹ï¼Œåªéœ€è¦æ·»åŠ ç±»çš„å…¨é™å®šç¬¦+æ–¹æ³•åå³å¯ï¼
    ```java
    @Before(value = "com.atguigu.spring.aop.aspect.LogAspect.declarPointCut()")
    public Object roundAdvice(ProceedingJoinPoint joinPoint) {
    ```
4.  åˆ‡ç‚¹ç»Ÿä¸€ç®¡ç†

    å»ºè®®ï¼šå°†åˆ‡ç‚¹è¡¨è¾¾å¼ç»Ÿä¸€å­˜å‚¨åˆ°ä¸€ä¸ªç±»ä¸­è¿›è¡Œé›†ä¸­ç®¡ç†å’Œç»´æŠ¤ï¼
    è¿™æ ·çš„è¯ï¼Œåœ¨å…¶ä»–é€šçŸ¥ç±»ï¼Œéœ€è¦å¼•ç”¨åˆ‡å…¥ç‚¹çš„æ—¶å€™ï¼Œéœ€è¦å†™å‡ºåˆ‡å…¥ç‚¹çš„å…¨ç±»å
    ```java
    @Component
    public class AtguiguPointCut {
        
        @Pointcut(value = "execution(public int *..Calculator.sub(int,int))")
        public void atguiguGlobalPointCut(){}
        
        @Pointcut(value = "execution(public int *..Calculator.add(int,int))")
        public void atguiguSecondPointCut(){}
        
        @Pointcut(value = "execution(* *..*Service.*(..))")
        public void transactionPointCut(){}
    }
    ```

#### 5.5.6 ç¯ç»•é€šçŸ¥

ç¯ç»•é€šçŸ¥å¯¹åº”æ•´ä¸ª try...catch...finally ç»“æ„ï¼ŒåŒ…æ‹¬å‰é¢å››ç§é€šçŸ¥çš„æ‰€æœ‰åŠŸèƒ½ã€‚

```java
// ä½¿ç”¨@Aroundæ³¨è§£æ ‡æ˜ç¯ç»•é€šçŸ¥æ–¹æ³•
@Around(value = "com.atguigu.aop.aspect.AtguiguPointCut.transactionPointCut()")
public Object manageTransaction(
    
        // é€šè¿‡åœ¨é€šçŸ¥æ–¹æ³•å½¢å‚ä½ç½®å£°æ˜ProceedingJoinPointç±»å‹çš„å½¢å‚ï¼Œ
        // Springä¼šå°†è¿™ä¸ªç±»å‹çš„å¯¹è±¡ä¼ ç»™æˆ‘ä»¬
        ProceedingJoinPoint joinPoint) {
    
    // é€šè¿‡ProceedingJoinPointå¯¹è±¡è·å–å¤–ç•Œè°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ä¼ å…¥çš„å®å‚æ•°ç»„
    Object[] args = joinPoint.getArgs();
    
    // é€šè¿‡ProceedingJoinPointå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•çš„ç­¾åå¯¹è±¡
    Signature signature = joinPoint.getSignature();
    
    // é€šè¿‡ç­¾åå¯¹è±¡è·å–ç›®æ ‡æ–¹æ³•çš„æ–¹æ³•å
    String methodName = signature.getName();
    
    // å£°æ˜å˜é‡ç”¨æ¥å­˜å‚¨ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼
    Object targetMethodReturnValue = null;
    
    try {
    
        // åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰ï¼šå¼€å¯äº‹åŠ¡ï¼ˆæ¨¡æ‹Ÿï¼‰
        log.debug("[AOP ç¯ç»•é€šçŸ¥] å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•åï¼š" + methodName + "ï¼Œå‚æ•°åˆ—è¡¨ï¼š" + Arrays.asList(args));
    
        // è¿‡ProceedingJoinPointå¯¹è±¡è°ƒç”¨ç›®æ ‡æ–¹æ³•
        // ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ä¸€å®šè¦è¿”å›ç»™å¤–ç•Œè°ƒç”¨è€…
        targetMethodReturnValue = joinPoint.proceed(args);
    
        // åœ¨ç›®æ ‡æ–¹æ³•æˆåŠŸè¿”å›åï¼šæäº¤äº‹åŠ¡ï¼ˆæ¨¡æ‹Ÿï¼‰
        log.debug("[AOP ç¯ç»•é€šçŸ¥] æäº¤äº‹åŠ¡ï¼Œæ–¹æ³•åï¼š" + methodName + "ï¼Œæ–¹æ³•è¿”å›å€¼ï¼š" + targetMethodReturnValue);
    
    }catch (Throwable e){
    
        // åœ¨ç›®æ ‡æ–¹æ³•æŠ›å¼‚å¸¸åï¼šå›æ»šäº‹åŠ¡ï¼ˆæ¨¡æ‹Ÿï¼‰
        log.debug("[AOP ç¯ç»•é€šçŸ¥] å›æ»šäº‹åŠ¡ï¼Œæ–¹æ³•åï¼š" + methodName + "ï¼Œå¼‚å¸¸ï¼š" + e.getClass().getName());
    
    }finally {
    
        // åœ¨ç›®æ ‡æ–¹æ³•æœ€ç»ˆç»“æŸåï¼šé‡Šæ”¾æ•°æ®åº“è¿æ¥
        log.debug("[AOP ç¯ç»•é€šçŸ¥] é‡Šæ”¾æ•°æ®åº“è¿æ¥ï¼Œæ–¹æ³•åï¼š" + methodName);
    
    }
    
    return targetMethodReturnValue;
}
```

#### 5.5.7 åˆ‡é¢ä¼˜å…ˆçº§è®¾ç½®

ç›¸åŒç›®æ ‡æ–¹æ³•ä¸ŠåŒæ—¶å­˜åœ¨å¤šä¸ªåˆ‡é¢æ—¶ï¼Œåˆ‡é¢çš„ä¼˜å…ˆçº§æ§åˆ¶åˆ‡é¢çš„å†…å¤–åµŒå¥—é¡ºåºã€‚

-   ä¼˜å…ˆçº§é«˜çš„åˆ‡é¢ï¼šå¤–é¢
-   ä¼˜å…ˆçº§ä½çš„åˆ‡é¢ï¼šé‡Œé¢

`ä½¿ç”¨ @Order æ³¨è§£å¯ä»¥æ§åˆ¶åˆ‡é¢çš„ä¼˜å…ˆçº§ï¼š`
`orderæ³¨è§£ä½œç”¨äºé€šçŸ¥ç±»ä¸Š`
-   @Order(è¾ƒå°çš„æ•°)ï¼šä¼˜å…ˆçº§é«˜
-   @Order(è¾ƒå¤§çš„æ•°)ï¼šä¼˜å…ˆçº§ä½

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/04a2e03c2c3a070e1000c3ef23c82771.png)



å®é™…æ„ä¹‰

`å®é™…å¼€å‘æ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªåˆ‡é¢åµŒå¥—çš„æƒ…å†µï¼Œè¦æ…é‡è€ƒè™‘`ã€‚ä¾‹å¦‚ï¼šå¦‚æœäº‹åŠ¡åˆ‡é¢ä¼˜å…ˆçº§é«˜ï¼Œé‚£ä¹ˆåœ¨ç¼“å­˜ä¸­å‘½ä¸­æ•°æ®çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åˆ‡é¢çš„æ“ä½œéƒ½æµªè´¹äº†ã€‚
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/9ecdc5970d0e1f646d51a08a0bed27a4.png)



æ­¤æ—¶åº”è¯¥å°†ç¼“å­˜åˆ‡é¢çš„ä¼˜å…ˆçº§æé«˜ï¼Œåœ¨äº‹åŠ¡æ“ä½œä¹‹å‰å…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç›®æ ‡æ•°æ®ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/015d67186cedc60c94dbd62b598e3d6e.png)



#### 5.5.8 CGLibåŠ¨æ€ä»£ç†ç”Ÿæ•ˆ

åœ¨ç›®æ ‡ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£çš„æƒ…å†µä¸‹ï¼ŒSpringä¼šè‡ªåŠ¨ä½¿ç”¨cglibæŠ€æœ¯å®ç°ä»£ç†ã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åšä¸‹é¢çš„æµ‹è¯•ï¼š

```java
@Service
public class EmployeeService {
    
    public void getEmpList() {
       System.out.print("æ–¹æ³•å†…éƒ¨ com.atguigu.aop.imp.EmployeeService.getEmpList");
    }
}
```

æµ‹è¯•ï¼š

```java
  @Autowired
  private EmployeeService employeeService;
  
  @Test
  public void testNoInterfaceProxy() {
      employeeService.getEmpList();
  }
```

æ²¡æœ‰æ¥å£ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3a2916c0106b3664169acdf6ebf4c596.png)



æœ‰æ¥å£ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/519f273ff88bee5bb7fece281db2b570.png)



ä½¿ç”¨æ€»ç»“ï¼š

a.  å¦‚æœç›®æ ‡ç±»æœ‰æ¥å£,é€‰æ‹©ä½¿ç”¨jdkåŠ¨æ€ä»£ç†
b.  å¦‚æœç›®æ ‡ç±»æ²¡æœ‰æ¥å£,é€‰æ‹©cglibåŠ¨æ€ä»£ç†
c.  å¦‚æœæœ‰æ¥å£,æ¥å£æ¥å€¼
d.  å¦‚æœæ²¡æœ‰æ¥å£,ç±»è¿›è¡Œæ¥å€¼

#### 5.5.9 æ³¨è§£å®ç°å°ç»“

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/f2cdd3ac4e6ab93b0e9f3fb6b7c2271f.png)

### 5.6 Spring AOPåŸºäºXMLæ–¹å¼å®ç°(äº†è§£)

1.  å‡†å¤‡å·¥ä½œ
    åŠ å…¥ä¾èµ–
    å’ŒåŸºäºæ³¨è§£çš„ AOP æ—¶ä¸€æ ·ã€‚
    å‡†å¤‡ä»£ç 
    æŠŠæµ‹è¯•åŸºäºæ³¨è§£åŠŸèƒ½æ—¶çš„Javaç±»å¤åˆ¶åˆ°æ–°moduleä¸­ï¼Œå»é™¤æ‰€æœ‰æ³¨è§£ã€‚
2.  é…ç½®Springé…ç½®æ–‡ä»¶
    ```xml
    <!-- é…ç½®ç›®æ ‡ç±»çš„bean -->
    <bean id="calculatorPure" class="com.atguigu.aop.imp.CalculatorPureImpl"/>
        
    <!-- é…ç½®åˆ‡é¢ç±»çš„bean -->
    <bean id="logAspect" class="com.atguigu.aop.aspect.LogAspect"/>
        
    <!-- é…ç½®AOP -->
    <aop:config>
        
        <!-- é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ -->
        <aop:pointcut id="logPointCut" expression="execution(* *..*.*(..))"/>
        
        <!-- aop:aspectæ ‡ç­¾ï¼šé…ç½®åˆ‡é¢ -->
        <!-- refå±æ€§ï¼šå…³è”åˆ‡é¢ç±»çš„bean -->
        <aop:aspect ref="logAspect">
            <!-- aop:beforeæ ‡ç­¾ï¼šé…ç½®å‰ç½®é€šçŸ¥ -->
            <!-- methodå±æ€§ï¼šæŒ‡å®šå‰ç½®é€šçŸ¥çš„æ–¹æ³•å -->
            <!-- pointcut-refå±æ€§ï¼šå¼•ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ -->
            <aop:before method="printLogBeforeCore" pointcut-ref="logPointCut"/>
        
            <!-- aop:after-returningæ ‡ç­¾ï¼šé…ç½®è¿”å›é€šçŸ¥ -->
            <!-- returningå±æ€§ï¼šæŒ‡å®šé€šçŸ¥æ–¹æ³•ä¸­ç”¨æ¥æ¥æ”¶ç›®æ ‡æ–¹æ³•è¿”å›å€¼çš„å‚æ•°å -->
            <aop:after-returning
                    method="printLogAfterCoreSuccess"
                    pointcut-ref="logPointCut"
                    returning="targetMethodReturnValue"/>
        
            <!-- aop:after-throwingæ ‡ç­¾ï¼šé…ç½®å¼‚å¸¸é€šçŸ¥ -->
            <!-- throwingå±æ€§ï¼šæŒ‡å®šé€šçŸ¥æ–¹æ³•ä¸­ç”¨æ¥æ¥æ”¶ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„å¼‚å¸¸å¯¹è±¡çš„å‚æ•°å -->
            <aop:after-throwing
                    method="printLogAfterCoreException"
                    pointcut-ref="logPointCut"
                    throwing="targetMethodException"/>
        
            <!-- aop:afteræ ‡ç­¾ï¼šé…ç½®åç½®é€šçŸ¥ -->
            <aop:after method="printLogCoreFinallyEnd" pointcut-ref="logPointCut"/>
        
            <!-- aop:aroundæ ‡ç­¾ï¼šé…ç½®ç¯ç»•é€šçŸ¥ -->
            <!--<aop:around method="â€¦â€¦" pointcut-ref="logPointCut"/>-->
        </aop:aspect>
        
    </aop:config>

    ```
3.  æµ‹è¯•
    ```java
    @SpringJUnitConfig(locations = "classpath:spring-aop.xml")
    public class AopTest {

        @Autowired
        private Calculator calculator;

        @Test
        public void testCalculator(){
            System.out.println(calculator);
            calculator.add(1,1);
        }
    }
    ```

### 5.7 Spring AOPå¯¹è·å–Beançš„å½±å“ç†è§£

#### 5.7.1 æ ¹æ®ç±»å‹è£…é… bean

1.  æƒ…æ™¯ä¸€
    -   bean å¯¹åº”çš„ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£
    -   æ ¹æ® bean æœ¬èº«çš„ç±»å‹è·å– bean
        -   æµ‹è¯•ï¼šIOCå®¹å™¨ä¸­åŒç±»å‹çš„ bean åªæœ‰ä¸€ä¸ª
	            æ­£å¸¸è·å–åˆ° IOC å®¹å™¨ä¸­çš„é‚£ä¸ª bean å¯¹è±¡
        -   æµ‹è¯•ï¼šIOC å®¹å™¨ä¸­åŒç±»å‹çš„ bean æœ‰å¤šä¸ª
	            ä¼šæŠ›å‡º NoUniqueBeanDefinitionException å¼‚å¸¸ï¼Œè¡¨ç¤º IOC å®¹å™¨ä¸­è¿™ä¸ªç±»å‹çš„ bean æœ‰å¤šä¸ª

2.  æƒ…æ™¯äºŒ
    -   bean å¯¹åº”çš„ç±»å®ç°äº†æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¹Ÿåªæœ‰è¿™ä¸€ä¸ªå®ç°ç±»
        -   æµ‹è¯•ï¼šæ ¹æ®æ¥å£ç±»å‹è·å– bean
        -   æµ‹è¯•ï¼šæ ¹æ®ç±»è·å– bean
        -   ç»“è®ºï¼šä¸Šé¢ä¸¤ç§æƒ…å†µå…¶å®éƒ½èƒ½å¤Ÿæ­£å¸¸è·å–åˆ° beanï¼Œè€Œä¸”æ˜¯åŒä¸€ä¸ªå¯¹è±¡

3.  æƒ…æ™¯ä¸‰
    -   å£°æ˜ä¸€ä¸ªæ¥å£
    -   æ¥å£æœ‰å¤šä¸ªå®ç°ç±»
    -   æ¥å£æ‰€æœ‰å®ç°ç±»éƒ½æ”¾å…¥ IOC å®¹å™¨
        -   æµ‹è¯•ï¼šæ ¹æ®æ¥å£ç±»å‹è·å– bean
	            ä¼šæŠ›å‡º NoUniqueBeanDefinitionException å¼‚å¸¸ï¼Œè¡¨ç¤º IOC å®¹å™¨ä¸­è¿™ä¸ªç±»å‹çš„ bean æœ‰å¤šä¸ª
        -   æµ‹è¯•ï¼šæ ¹æ®ç±»è·å–bean
	            æ­£å¸¸

4.  æƒ…æ™¯å››
    -   å£°æ˜ä¸€ä¸ªæ¥å£
    -   æ¥å£æœ‰ä¸€ä¸ªå®ç°ç±»
    -   åˆ›å»ºä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå¯¹ä¸Šé¢æ¥å£çš„å®ç°ç±»åº”ç”¨é€šçŸ¥
        -   æµ‹è¯•ï¼šæ ¹æ®æ¥å£ç±»å‹è·å–bean
	            æ­£å¸¸
        -   æµ‹è¯•ï¼šæ ¹æ®å®ç°ç±»è·å–bean
	            æ— æ³•è·å–
	            åŸå› åˆ†æï¼š
		    -   åº”ç”¨äº†åˆ‡é¢åï¼ŒçœŸæ­£æ”¾åœ¨IOCå®¹å™¨ä¸­çš„æ˜¯ä»£ç†ç±»çš„å¯¹è±¡
		    -   ç›®æ ‡ç±»å¹¶æ²¡æœ‰è¢«æ”¾åˆ°IOCå®¹å™¨ä¸­ï¼Œæ‰€ä»¥æ ¹æ®ç›®æ ‡ç±»çš„ç±»å‹ä»IOCå®¹å™¨ä¸­æ˜¯æ‰¾ä¸åˆ°çš„

        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/030dd650475cb3c80042ec171684c3f5.png)


5.  æƒ…æ™¯äº”
    -   å£°æ˜ä¸€ä¸ªç±»
    -   åˆ›å»ºä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå¯¹ä¸Šé¢çš„ç±»åº”ç”¨é€šçŸ¥
        -   æµ‹è¯•ï¼šæ ¹æ®ç±»è·å– beanï¼Œèƒ½è·å–åˆ°
            ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0018e1e556ceecc8e00c71a3ddd680a8.png)


        debugæŸ¥çœ‹å®é™…ç±»å‹ï¼š

        ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8b8e6f2627bcab0eefc8a83c813f247b.png)



#### 5.7.2 ä½¿ç”¨æ€»ç»“

å¯¹å®ç°äº†æ¥å£çš„ç±»åº”ç”¨åˆ‡é¢![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7cdc0cdbbe9552e825a4c984a4a681bc.png)

å¯¹æ²¡å®ç°æ¥å£çš„ç±»åº”ç”¨åˆ‡é¢new![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b0a966e9c142c014379e426db5f1ee7b.png)



**å¦‚æœä½¿ç”¨AOPæŠ€æœ¯ï¼Œç›®æ ‡ç±»æœ‰æ¥å£ï¼Œå¿…é¡»ä½¿ç”¨æ¥å£ç±»å‹æ¥æ”¶IoCå®¹å™¨ä¸­ä»£ç†ç»„ä»¶ï¼**

## 6 Spring å£°æ˜å¼äº‹åŠ¡

### 6.1 å£°æ˜å¼äº‹åŠ¡æ¦‚å¿µ

#### 6.1.1 ç¼–ç¨‹å¼äº‹åŠ¡

ç¼–ç¨‹å¼äº‹åŠ¡æ˜¯æŒ‡æ‰‹åŠ¨ç¼–å†™ç¨‹åºæ¥ç®¡ç†äº‹åŠ¡ï¼Œå³é€šè¿‡ç¼–å†™ä»£ç çš„æ–¹å¼ç›´æ¥æ§åˆ¶äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚åœ¨ Java ä¸­ï¼Œé€šå¸¸ä½¿ç”¨äº‹åŠ¡ç®¡ç†å™¨(å¦‚ Spring ä¸­çš„`PlatformTransactionManager`)æ¥å®ç°ç¼–ç¨‹å¼äº‹åŠ¡ã€‚

ç¼–ç¨‹å¼äº‹åŠ¡çš„ä¸»è¦ä¼˜ç‚¹æ˜¯çµæ´»æ€§é«˜ï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚æ¥æ§åˆ¶äº‹åŠ¡çš„ç²’åº¦ã€æ¨¡å¼ç­‰ç­‰ã€‚ä½†æ˜¯ï¼Œç¼–å†™å¤§é‡çš„äº‹åŠ¡æ§åˆ¶ä»£ç å®¹æ˜“å‡ºç°é—®é¢˜ï¼Œå¯¹ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æœ‰ä¸€å®šå½±å“ã€‚

```java
Connection conn = ...;
  
try {
    // å¼€å¯äº‹åŠ¡ï¼šå…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤
    conn.setAutoCommit(false);
    // æ ¸å¿ƒæ“ä½œ
    // ä¸šåŠ¡ä»£ç 
    // æäº¤äº‹åŠ¡
    conn.commit();
  
}catch(Exception e){
  
    // å›æ»šäº‹åŠ¡
    conn.rollBack();
  
}finally{
  
    // é‡Šæ”¾æ•°æ®åº“è¿æ¥
    conn.close();
  
}
```

`ç¼–ç¨‹å¼çš„å®ç°æ–¹å¼å­˜åœ¨ç¼ºé™·`ï¼š

-   `ç»†èŠ‚æ²¡æœ‰è¢«å±è”½`ï¼šå…·ä½“æ“ä½œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰ç»†èŠ‚éƒ½éœ€è¦ç¨‹åºå‘˜è‡ªå·±æ¥å®Œæˆï¼Œæ¯”è¾ƒç¹çã€‚
-   `ä»£ç å¤ç”¨æ€§ä¸é«˜`ï¼šå¦‚æœæ²¡æœ‰æœ‰æ•ˆæŠ½å–å‡ºæ¥ï¼Œæ¯æ¬¡å®ç°åŠŸèƒ½éƒ½éœ€è¦è‡ªå·±ç¼–å†™ä»£ç ï¼Œä»£ç å°±æ²¡æœ‰å¾—åˆ°å¤ç”¨ã€‚

#### 6.1.2 å£°æ˜å¼äº‹åŠ¡

å£°æ˜å¼äº‹åŠ¡æ˜¯æŒ‡ä½¿ç”¨æ³¨è§£æˆ– XML é…ç½®çš„æ–¹å¼æ¥æ§åˆ¶äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚

å¼€å‘è€…åªéœ€è¦æ·»åŠ é…ç½®å³å¯ï¼Œ å…·ä½“äº‹åŠ¡çš„å®ç°ç”±ç¬¬ä¸‰æ–¹æ¡†æ¶å®ç°ï¼Œé¿å…æˆ‘ä»¬ç›´æ¥è¿›è¡Œäº‹åŠ¡æ“ä½œï¼

`ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡å¯ä»¥å°†äº‹åŠ¡çš„æ§åˆ¶å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»å¼€æ¥ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§`

åŒºåˆ«ï¼š

-   ç¼–ç¨‹å¼äº‹åŠ¡éœ€è¦`æ‰‹åŠ¨ç¼–å†™ä»£ç æ¥ç®¡ç†äº‹åŠ¡`
-   è€Œå£°æ˜å¼äº‹åŠ¡å¯ä»¥`é€šè¿‡é…ç½®æ–‡ä»¶æˆ–æ³¨è§£æ¥æ§åˆ¶äº‹åŠ¡`

#### 6.1.3 Springäº‹åŠ¡ç®¡ç†å™¨

1.  Springå£°æ˜å¼äº‹åŠ¡å¯¹åº”ä¾èµ–
    -   spring-tx: åŒ…å«å£°æ˜å¼äº‹åŠ¡å®ç°çš„åŸºæœ¬è§„èŒƒï¼ˆäº‹åŠ¡ç®¡ç†å™¨è§„èŒƒæ¥å£å’Œäº‹åŠ¡å¢å¼ºç­‰ç­‰ï¼‰
    -   spring-jdbc: åŒ…å«DataSourceæ–¹å¼äº‹åŠ¡ç®¡ç†å™¨å®ç°ç±»DataSourceTransactionManager
    -   spring-orm: åŒ…å«å…¶ä»–æŒä¹…å±‚æ¡†æ¶çš„äº‹åŠ¡ç®¡ç†å™¨å®ç°ç±»ä¾‹å¦‚ï¼šHibernate/Jpaç­‰

2.  Springå£°æ˜å¼äº‹åŠ¡å¯¹åº”äº‹åŠ¡ç®¡ç†å™¨æ¥å£![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/639cbece8808e89c32ff60ffd02ade83.png)



    æˆ‘ä»¬ç°åœ¨è¦ä½¿ç”¨çš„äº‹åŠ¡ç®¡ç†å™¨æ˜¯org.springframework.jdbc.datasource.DataSourceTransactionManagerï¼Œå°†æ¥æ•´åˆ JDBCæ–¹å¼ã€JdbcTemplateæ–¹å¼ã€Mybatisæ–¹å¼çš„äº‹åŠ¡å®ç°ï¼

    DataSourceTransactionManagerç±»ä¸­çš„ä¸»è¦æ–¹æ³•ï¼š
    -   `doBegin()`ï¼šå¼€å¯äº‹åŠ¡
    -   `doSuspend()`ï¼šæŒ‚èµ·äº‹åŠ¡
    -   `doResume()`ï¼šæ¢å¤æŒ‚èµ·çš„äº‹åŠ¡
    -   `doCommit()`ï¼šæäº¤äº‹åŠ¡
    -   `doRollback()`ï¼šå›æ»šäº‹åŠ¡

### 6.2 åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡

#### 6.2.1 å‡†å¤‡å·¥ä½œ

1.  å‡†å¤‡é¡¹ç›®
    ```xml
    <dependencies>
      <!--spring contextä¾èµ–-->
      <!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†-->
      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-context</artifactId>
          <version>6.0.6</version>
      </dependency>

      <!--junit5æµ‹è¯•-->
      <dependency>
          <groupId>org.junit.jupiter</groupId>
          <artifactId>junit-jupiter-api</artifactId>
          <version>5.3.1</version>
      </dependency>


      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-test</artifactId>
          <version>6.0.6</version>
          <scope>test</scope>
      </dependency>

      <dependency>
          <groupId>jakarta.annotation</groupId>
          <artifactId>jakarta.annotation-api</artifactId>
          <version>2.1.1</version>
      </dependency>

      <!-- æ•°æ®åº“é©±åŠ¨ å’Œ è¿æ¥æ± -->
      <dependency>
          <groupId>mysql</groupId>
          <artifactId>mysql-connector-java</artifactId>
          <version>8.0.25</version>
      </dependency>

      <dependency>
          <groupId>com.alibaba</groupId>
          <artifactId>druid</artifactId>
          <version>1.2.8</version>
      </dependency>

      <!-- spring-jdbc -->
      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-jdbc</artifactId>
          <version>6.0.6</version>
      </dependency>

      <!-- å£°æ˜å¼äº‹åŠ¡ä¾èµ–-->
      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-tx</artifactId>
          <version>6.0.6</version>
      </dependency>


      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-aop</artifactId>
          <version>6.0.6</version>
      </dependency>

      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-aspects</artifactId>
          <version>6.0.6</version>
      </dependency>
    </dependencies>
    ```

2.  å¤–éƒ¨é…ç½®æ–‡ä»¶

    jdbc.properties
    ```.properties
    atguigu.url=jdbc:mysql://localhost:3306/studb
    atguigu.driver=com.mysql.cj.jdbc.Driver
    atguigu.username=root
    atguigu.password=root
    ```

3.  springé…ç½®æ–‡ä»¶
    ```java
    @Configuration
    @ComponentScan("com.atguigu")
    @PropertySource("classpath:jdbc.properties")
    public class JavaConfig {

        @Value("${atguigu.driver}")
        private String driver;
        @Value("${atguigu.url}")
        private String url;
        @Value("${atguigu.username}")
        private String username;
        @Value("${atguigu.password}")
        private String password;



        //druidè¿æ¥æ± 
        @Bean
        public DataSource dataSource(){
            DruidDataSource dataSource = new DruidDataSource();
            dataSource.setDriverClassName(driver);
            dataSource.setUrl(url);
            dataSource.setUsername(username);
            dataSource.setPassword(password);
            return dataSource;
        }


        @Bean
        //jdbcTemplate
        public JdbcTemplate jdbcTemplate(DataSource dataSource){
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            jdbcTemplate.setDataSource(dataSource);
            return jdbcTemplate;
        }

    }

    ```

4.  å‡†å¤‡dao/serviceå±‚

    dao
    ```java
    @Repository
    public class StudentDao {
        
        @Autowired
        private JdbcTemplate jdbcTemplate;
        
        public void updateNameById(String name,Integer id){
            String sql = "update students set name = ? where id = ? ;";
            int rows = jdbcTemplate.update(sql, name, id);
        }

        public void updateAgeById(Integer age,Integer id){
            String sql = "update students set age = ? where id = ? ;";
            jdbcTemplate.update(sql,age,id);
        }
    }

    ```
    service
    ```java
    @Service
    public class StudentService {
        
        @Autowired
        private StudentDao studentDao;
        
        public void changeInfo(){
            studentDao.updateAgeById(100,1);
            System.out.println("-----------");
            studentDao.updateNameById("test1",1);
        }
    }

    ```
5.  æµ‹è¯•ç¯å¢ƒæ­å»º
    ```java
    /**
     * projectName: com.atguigu.test
     *
     * description:
     */
    @SpringJUnitConfig(JavaConfig.class)
    public class TxTest {

        @Autowired
        private StudentService studentService;

        @Test
        public void  testTx(){
            studentService.changeInfo();
        }
    }

    ```

#### 6.2.2 åŸºæœ¬äº‹åŠ¡æ§åˆ¶

1.  é…ç½®äº‹åŠ¡ç®¡ç†å™¨

    æ•°æ®åº“ç›¸å…³çš„é…ç½®
    ```java
    /**
     * projectName: com.atguigu.config
     *
     * description: æ•°æ®åº“å’Œè¿æ¥æ± é…ç½®ç±»
     */

    @Configuration
    @ComponenScan("com.atguigu")
    @PropertySource(value = "classpath:jdbc.properties")
    @EnableTransactionManagement
    public class DataSourceConfig {

        /**
         * å®ä¾‹åŒ–dataSourceåŠ å…¥åˆ°iocå®¹å™¨
         * @param url
         * @param driver
         * @param username
         * @param password
         * @return
         */
        @Bean
        public DataSource dataSource(@Value("${atguigu.url}")String url,
                                     @Value("${atguigu.driver}")String driver,
                                     @Value("${atguigu.username}")String username,
                                     @Value("${atguigu.password}")String password){
            DruidDataSource dataSource = new DruidDataSource();
            dataSource.setDriverClassName(driver);
            dataSource.setUrl(url);
            dataSource.setUsername(username);
            dataSource.setPassword(password);

            return dataSource;
        }

        /**
         * å®ä¾‹åŒ–JdbcTemplateå¯¹è±¡,éœ€è¦ä½¿ç”¨iocä¸­çš„DataSource
         * @param dataSource
         * @return
         */
        @Bean
        public JdbcTemplate jdbcTemplate(DataSource dataSource){
            JdbcTemplate jdbcTemplate = new JdbcTemplate();
            jdbcTemplate.setDataSource(dataSource);
            return jdbcTemplate;
        }
        
        /**
         * è£…é…äº‹åŠ¡ç®¡ç†å®ç°å¯¹è±¡
         * @param dataSource
         * @return
         */
        @Bean
        public TransactionManager transactionManager(DataSource dataSource){
            return new DataSourceTransactionManager(dataSource);
        }

    }

    ```

2.  ä½¿ç”¨å£°æ˜äº‹åŠ¡æ³¨è§£@Transactional
    ```java
    /**
     * projectName: com.atguigu.service
     *
     */
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        @Transactional
        public void changeInfo(){
            studentDao.updateAgeById(100,1);
            System.out.println("-----------");
            int i = 1/0;
            studentDao.updateNameById("test1",1);
        }
    }

    ```

3.  æµ‹è¯•äº‹åŠ¡æ•ˆæœ
    ```java
    /**
     * projectName: com.atguigu.test
     *
     * description:
     */
    //@SpringJUnitConfig(locations = "classpath:application.xml")
    @SpringJUnitConfig(classes = DataSourceConfig.class)
    public class TxTest {

        @Autowired
        private StudentService studentService;

        @Test
        public void  testTx(){
            studentService.changeInfo();
        }
    }

    ```

#### 6.2.3 äº‹åŠ¡å±æ€§ï¼šåªè¯»

1.  åªè¯»ä»‹ç»

    å¯¹ä¸€ä¸ªæŸ¥è¯¢æ“ä½œæ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå®ƒè®¾ç½®æˆåªè¯»ï¼Œå°±èƒ½å¤Ÿæ˜ç¡®å‘Šè¯‰æ•°æ®åº“ï¼Œè¿™ä¸ªæ“ä½œä¸æ¶‰åŠå†™æ“ä½œã€‚è¿™æ ·æ•°æ®åº“å°±èƒ½å¤Ÿé’ˆå¯¹æŸ¥è¯¢æ“ä½œæ¥è¿›è¡Œä¼˜åŒ–ã€‚

2.  è®¾ç½®æ–¹å¼
    ```java
    // readOnly = trueæŠŠå½“å‰äº‹åŠ¡è®¾ç½®ä¸ºåªè¯» é»˜è®¤æ˜¯false!
    @Transactional(readOnly = true)
    ```

3.  é’ˆå¯¹DMLåŠ¨ä½œè®¾ç½®åªè¯»æ¨¡å¼

    ä¼šæŠ›å‡ºä¸‹é¢å¼‚å¸¸ï¼š

    Caused by: java.sql.SQLException: Connection is read-only. Queries leading to data modification are not allowed

4.  @Transactionalæ³¨è§£æ”¾åœ¨ç±»ä¸Š
    1.  ç”Ÿæ•ˆåŸåˆ™

        `å¦‚æœä¸€ä¸ªç±»ä¸­æ¯ä¸€ä¸ªæ–¹æ³•ä¸Šéƒ½ä½¿ç”¨äº† @Transactional æ³¨è§£ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°† @Transactional æ³¨è§£æå–åˆ°ç±»ä¸Š`ã€‚åè¿‡æ¥è¯´ï¼š@Transactional æ³¨è§£åœ¨ç±»çº§åˆ«æ ‡è®°ï¼Œä¼šå½±å“åˆ°ç±»ä¸­çš„æ¯ä¸€ä¸ªæ–¹æ³•ã€‚åŒæ—¶ï¼Œç±»çº§åˆ«æ ‡è®°çš„ @Transactional æ³¨è§£ä¸­è®¾ç½®çš„äº‹åŠ¡å±æ€§ä¹Ÿä¼šå»¶ç»­å½±å“åˆ°æ–¹æ³•æ‰§è¡Œæ—¶çš„äº‹åŠ¡å±æ€§ã€‚é™¤éåœ¨æ–¹æ³•ä¸Šåˆè®¾ç½®äº† @Transactional æ³¨è§£ã€‚

        å¯¹ä¸€ä¸ªæ–¹æ³•æ¥è¯´ï¼Œç¦»å®ƒæœ€è¿‘çš„ @Transactional æ³¨è§£ä¸­çš„äº‹åŠ¡å±æ€§è®¾ç½®ç”Ÿæ•ˆã€‚

	2.  ç”¨æ³•ä¸¾ä¾‹

        åœ¨ç±»çº§åˆ«@Transactionalæ³¨è§£ä¸­è®¾ç½®åªè¯»ï¼Œè¿™æ ·ç±»ä¸­æ‰€æœ‰çš„æŸ¥è¯¢æ–¹æ³•éƒ½ä¸éœ€è¦è®¾ç½®@Transactionalæ³¨è§£äº†ã€‚å› ä¸ºå¯¹æŸ¥è¯¢æ“ä½œæ¥è¯´ï¼Œå…¶ä»–å±æ€§é€šå¸¸ä¸éœ€è¦è®¾ç½®ï¼Œæ‰€ä»¥ä½¿ç”¨å…¬å…±è®¾ç½®å³å¯ã€‚

        ç„¶ååœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå¯¹å¢åˆ æ”¹æ–¹æ³•è®¾ç½®@Transactionalæ³¨è§£ readOnly å±æ€§ä¸º falseã€‚
    ```java
    @Service
    @Transactional(readOnly = true)
    public class EmpService {
        
        // ä¸ºäº†ä¾¿äºæ ¸å¯¹æ•°æ®åº“æ“ä½œç»“æœï¼Œä¸è¦ä¿®æ”¹åŒä¸€æ¡è®°å½•
        @Transactional(readOnly = false)
        public void updateTwice(â€¦â€¦) {
        â€¦â€¦
        }
        
        // readOnly = trueæŠŠå½“å‰äº‹åŠ¡è®¾ç½®ä¸ºåªè¯»
        // @Transactional(readOnly = true)
        public String getEmpName(Integer empId) {
        â€¦â€¦
        }
        
    }
    ```

#### 6.2.4 äº‹åŠ¡å±æ€§ï¼šè¶…æ—¶æ—¶é—´

1.  éœ€æ±‚

    äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½å› ä¸ºé‡åˆ°æŸäº›é—®é¢˜ï¼Œå¯¼è‡´ç¨‹åºå¡ä½ï¼Œä»è€Œé•¿æ—¶é—´å ç”¨æ•°æ®åº“èµ„æºã€‚è€Œé•¿æ—¶é—´å ç”¨èµ„æºï¼Œå¤§æ¦‚ç‡æ˜¯å› ä¸ºç¨‹åºè¿è¡Œå‡ºç°äº†é—®é¢˜ï¼ˆå¯èƒ½æ˜¯Javaç¨‹åºæˆ–MySQLæ•°æ®åº“æˆ–ç½‘ç»œè¿æ¥ç­‰ç­‰ï¼‰ã€‚

    æ­¤æ—¶è¿™ä¸ªå¾ˆå¯èƒ½å‡ºé—®é¢˜çš„ç¨‹åºåº”è¯¥è¢«å›æ»šï¼Œæ’¤é”€å®ƒå·²åšçš„æ“ä½œï¼Œäº‹åŠ¡ç»“æŸï¼ŒæŠŠèµ„æºè®©å‡ºæ¥ï¼Œè®©å…¶ä»–æ­£å¸¸ç¨‹åºå¯ä»¥æ‰§è¡Œã€‚

    æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ä¸€å¥è¯ï¼š`è¶…æ—¶å›æ»šï¼Œé‡Šæ”¾èµ„æº`ã€‚

2.  è®¾ç½®è¶…æ—¶æ—¶é—´
    ```java
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         */
        @Transactional(readOnly = false,timeout = 3)
        public void changeInfo(){
            studentDao.updateAgeById(100,1);
            //ä¼‘çœ 4ç§’,ç­‰å¾…æ–¹æ³•è¶…æ—¶!
            try {
                Thread.sleep(4000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            studentDao.updateNameById("test1",1);
        }
    }

    ```

3.  æµ‹è¯•è¶…æ—¶æ•ˆæœ

    æ‰§è¡ŒæŠ›å‡ºäº‹åŠ¡è¶…æ—¶å¼‚å¸¸
    ```java
    org.springframework.transaction.TransactionTimedOutException: Transaction timed out: deadline was Wed May 24 09:10:43 IRKT 2023

      at org.springframework.transaction.support.ResourceHolderSupport.checkTransactionTimeout(ResourceHolderSupport.java:155)
      at org.springframework.transaction.support.ResourceHolderSupport.getTimeToLiveInMillis(ResourceHolderSupport.java:144)
      at org.springframework.transaction.support.ResourceHolderSupport.getTimeToLiveInSeconds(ResourceHolderSupport.java:128)
      at org.springframework.jdbc.datasource.DataSourceUtils.applyTimeout(DataSourceUtils.java:341)
      at org.springframework.jdbc.core.JdbcTemplate.applyStatementSettings(JdbcTemplate.java:1467)

    ```

#### 6.2.5 äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡å¼‚å¸¸

1.  é»˜è®¤æƒ…å†µ

    `é»˜è®¤åªé’ˆå¯¹è¿è¡Œæ—¶å¼‚å¸¸å›æ»š`ï¼Œç¼–è¯‘æ—¶å¼‚å¸¸ä¸å›æ»šã€‚æƒ…æ™¯æ¨¡æ‹Ÿä»£ç å¦‚ä¸‹ï¼š
    ```java
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
         * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
         */
        @Transactional(readOnly = false,timeout = 3)
        public void changeInfo() throws FileNotFoundException {
            studentDao.updateAgeById(100,1);
            //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…! 
            new FileInputStream("xxxx");
            studentDao.updateNameById("test1",1);
        }
    }
    ```

2.  è®¾ç½®å›æ»šå¼‚å¸¸

    `rollbackForå±æ€§ï¼šæŒ‡å®šå“ªäº›å¼‚å¸¸ç±»æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š`!
    ```java
    /**
     * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
     * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
     * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
     */
    @Transactional(readOnly = false,timeout = 3,rollbackFor = Exception.class)
    public void changeInfo() throws FileNotFoundException {
        studentDao.updateAgeById(100,1);
        //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…! 
        new FileInputStream("xxxx");
        studentDao.updateNameById("test1",1);
    }
    ```

3.  è®¾ç½®ä¸å›æ»šçš„å¼‚å¸¸

    åœ¨é»˜è®¤è®¾ç½®å’Œå·²æœ‰è®¾ç½®çš„åŸºç¡€ä¸Šï¼Œå†æŒ‡å®šä¸€ä¸ªå¼‚å¸¸ç±»å‹ï¼Œç¢°åˆ°å®ƒä¸å›æ»šã€‚

    `noRollbackForå±æ€§ï¼šæŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…`!
    ```java
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
         * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
         */
        @Transactional(readOnly = false,timeout = 3,rollbackFor = Exception.class,noRollbackFor = FileNotFoundException.class)
        public void changeInfo() throws FileNotFoundException {
            studentDao.updateAgeById(100,1);
            //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…!
            new FileInputStream("xxxx");
            studentDao.updateNameById("test1",1);
        }
    }

    ```

#### 6.2.6 äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«

1.  äº‹åŠ¡éš”ç¦»çº§åˆ«

    æ•°æ®åº“äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æ˜¯æŒ‡åœ¨å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œæ•°æ®åº“ç³»ç»Ÿä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§æ‰€éµå¾ªçš„è§„å®šã€‚å¸¸è§çš„éš”ç¦»çº§åˆ«åŒ…æ‹¬ï¼š
    1.  è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰ï¼šäº‹åŠ¡å¯ä»¥è¯»å–æœªè¢«æäº¤çš„æ•°æ®ï¼Œå®¹æ˜“äº§ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ç­‰é—®é¢˜ã€‚å®ç°ç®€å•ä½†ä¸å¤ªå®‰å…¨ï¼Œä¸€èˆ¬ä¸ç”¨ã€‚
    2.  è¯»å·²æäº¤ï¼ˆRead Committedï¼‰ï¼šäº‹åŠ¡åªèƒ½è¯»å–å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é¿å…è„è¯»é—®é¢˜ï¼Œä½†å¯èƒ½å¼•å‘ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚
    3.  å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç›¸åŒçš„æŸ¥è¯¢å°†è¿”å›ç›¸åŒçš„ç»“æœé›†ï¼Œä¸ç®¡å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®åšäº†ä»€ä¹ˆä¿®æ”¹ã€‚å¯ä»¥é¿å…è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†ä»æœ‰å¹»è¯»çš„é—®é¢˜ã€‚
    4.  ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨ç¦æ­¢äº†å¹¶å‘ï¼Œåªå…è®¸ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½æ‰§è¡Œå¦ä¸€ä¸ªäº‹åŠ¡ã€‚å¯ä»¥é¿å…ä»¥ä¸Šæ‰€æœ‰é—®é¢˜ï¼Œä½†æ•ˆç‡è¾ƒä½ï¼Œä¸é€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ã€‚
        ä¸åŒçš„éš”ç¦»çº§åˆ«é€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼Œéœ€è¦æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚è¿›è¡Œé€‰æ‹©å’Œè°ƒæ•´ã€‚

2.  äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®
    ```java
    package com.atguigu.service;

    import com.atguigu.dao.StudentDao;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Service;
    import org.springframework.transaction.annotation.Isolation;
    import org.springframework.transaction.annotation.Transactional;

    import java.io.FileInputStream;
    import java.io.FileNotFoundException;

    /**
     * projectName: com.atguigu.service
     */
    @Service
    public class StudentService {

        @Autowired
        private StudentDao studentDao;

        /**
         * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
         * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
         * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
         * isolation = è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«,mysqlé»˜è®¤æ˜¯repeatable read!
         */
        @Transactional(readOnly = false,
                       timeout = 3,
                       rollbackFor = Exception.class,
                       noRollbackFor = FileNotFoundException.class,
                       isolation = Isolation.REPEATABLE_READ)
        public void changeInfo() throws FileNotFoundException {
            studentDao.updateAgeById(100,1);
            //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…!
            new FileInputStream("xxxx");
            studentDao.updateNameById("test1",1);
        }
    }

    ```

#### 6.2.7 äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡ä¼ æ’­è¡Œä¸º

1.  äº‹åŠ¡ä¼ æ’­è¡Œä¸ºè¦ç ”ç©¶çš„é—®é¢˜
    ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0e644245b9e1ef88c501ca3b5e82c916.png)
    ä¸¾ä¾‹ä»£ç ï¼š
    ```java
    @Transactional
    public void MethodA(){
        // ...
        MethodB();
        // ...
    }

    //åœ¨è¢«è°ƒç”¨çš„å­æ–¹æ³•ä¸­è®¾ç½®ä¼ æ’­è¡Œä¸ºï¼Œä»£è¡¨å¦‚ä½•å¤„ç†è°ƒç”¨çš„äº‹åŠ¡ï¼ æ˜¯åŠ å…¥ï¼Œè¿˜æ˜¯æ–°äº‹åŠ¡ç­‰ï¼
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void MethodB(){
        // ...
    }

    ```

2.  propagationå±æ€§

    @Transactional æ³¨è§£é€šè¿‡ propagation å±æ€§è®¾ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯ï¼š
    ```java
    Propagation propagation() default Propagation.REQUIRED;

    ```
    propagation å±æ€§çš„å¯é€‰å€¼ç”± org.springframework.transaction.annotation.Propagation æšä¸¾ç±»æä¾›ï¼š
	 ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/bad87ddca6c2ccac14d7a97a8dea3975.png)


    
1.  æµ‹è¯•
    1.  å£°æ˜ä¸¤ä¸ªä¸šåŠ¡æ–¹æ³•
        ```java
        @Service
        public class StudentService {

            @Autowired
            private StudentDao studentDao;

            /**
             * timeoutè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´,å•ä½ç§’! é»˜è®¤: -1 æ°¸ä¸è¶…æ—¶,ä¸é™åˆ¶äº‹åŠ¡æ—¶é—´!
             * rollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸æ‰ä¼šå›æ»š,é»˜è®¤æ˜¯ RuntimeException and Error å¼‚å¸¸æ–¹å¯å›æ»š!
             * noRollbackFor = æŒ‡å®šå“ªäº›å¼‚å¸¸ä¸ä¼šå›æ»š, é»˜è®¤æ²¡æœ‰æŒ‡å®š,å¦‚æœæŒ‡å®š,åº”è¯¥åœ¨rollbackForçš„èŒƒå›´å†…!
             * isolation = è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«,mysqlé»˜è®¤æ˜¯repeatable read!
             */
            @Transactional(readOnly = false,
                           timeout = 3,
                           rollbackFor = Exception.class,
                           noRollbackFor = FileNotFoundException.class,
                           isolation = Isolation.REPEATABLE_READ)
            public void changeInfo() throws FileNotFoundException {
                studentDao.updateAgeById(100,1);
                //ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªæ£€æŸ¥å¼‚å¸¸,æµ‹è¯•! å‘ç°ä¸ä¼šå›æ»š,å› ä¸ºä¸åœ¨rollbackForçš„é»˜è®¤èŒƒå›´å†…!
                new FileInputStream("xxxx");
                studentDao.updateNameById("test1",1);
            }
            

            /**
             * å£°æ˜ä¸¤ä¸ªç‹¬ç«‹ä¿®æ”¹æ•°æ®åº“çš„äº‹åŠ¡ä¸šåŠ¡æ–¹æ³•
             */
            @Transactional(propagation = Propagation.REQUIRED)
            public void changeAge(){
                studentDao.updateAgeById(99,1);
            }

            @Transactional(propagation = Propagation.REQUIRED)
            public void changeName(){
                studentDao.updateNameById("test2",1);
                int i = 1/0;
            }

        }
        ```

	2.  å£°æ˜ä¸€ä¸ªæ•´åˆä¸šåŠ¡æ–¹æ³•
        ```java
        @Service
        public class TopService {

            @Autowired
            private StudentService studentService;

            @Transactional
            public void  topService(){
                studentService.changeAge();
                studentService.changeName();
            }
        }

        ```

	3.  æ·»åŠ ä¼ æ’­è¡Œä¸ºæµ‹è¯•
        ```java
        @SpringJUnitConfig(classes = AppConfig.class)
        public class TxTest {

            @Autowired
            private StudentService studentService;

            @Autowired
            private TopService topService;

            @Test
            public void  testTx() throws FileNotFoundException {
                topService.topService();
            }
        }

        ```
    **æ³¨æ„ï¼š**

    `åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œå¯¹äº@Transactionalæ³¨è§£çš„æ–¹æ³•è°ƒç”¨ï¼Œäº‹åŠ¡ä¼ æ’­è¡Œä¸ºä¸ä¼šç”Ÿæ•ˆ`ã€‚è¿™æ˜¯å› ä¸ºSpringæ¡†æ¶ä¸­ä½¿ç”¨ä»£ç†æ¨¡å¼å®ç°äº†äº‹åŠ¡æœºåˆ¶ï¼Œåœ¨åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•è°ƒç”¨å¹¶ä¸ç»è¿‡ä»£ç†ï¼Œè€Œæ˜¯é€šè¿‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤@Transactionalæ³¨è§£çš„è®¾ç½®ä¸ä¼šè¢«ä»£ç†æ•è·ï¼Œä¹Ÿå°±ä¸ä¼šäº§ç”Ÿä»»ä½•äº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„æ•ˆæœã€‚
4.  å…¶ä»–ä¼ æ’­è¡Œä¸ºå€¼ï¼ˆäº†è§£ï¼‰
    1.  `Propagation.REQUIRED`ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥å½“å‰äº‹åŠ¡ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚
    2.  `Propagation.REQUIRES_NEW`ï¼šåˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨æ–°äº‹åŠ¡ä¸­æ‰§è¡Œã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œå³ä½¿æ–°äº‹åŠ¡æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šå½±å“å½“å‰äº‹åŠ¡ã€‚
    3.  `Propagation.NESTED`ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨è¯¥äº‹åŠ¡ä¸­åµŒå¥—ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä¸Propagation.REQUIREDä¸€æ ·ã€‚
    4.  `Propagation.SUPPORTS`ï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦åˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚
    5.  `Propagation.NOT\_SUPPORTED`ï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŒ‚èµ·è¯¥äº‹åŠ¡ã€‚
    6.  `Propagation.MANDATORY`ï¼šå¿…é¡»åœ¨ä¸€ä¸ªå·²æœ‰çš„äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
    7.  P`ropagation.NEVER`ï¼šå¿…é¡»åœ¨æ²¡æœ‰äº‹åŠ¡çš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

## 7 Springæ ¸å¿ƒæŒæ¡æ€»ç»“

| æ ¸å¿ƒç‚¹             | æŒæ¡ç›®æ ‡                        |
| --------------- | --------------------------- |
| springæ¡†æ¶ç†è§£      | springå®¶æ—å’Œspring frameworkæ¡†æ¶ |
| springæ ¸å¿ƒåŠŸèƒ½      | ioc/di , aop , tx           |
| spring ioc / di | ç»„ä»¶ç®¡ç†ã€iocå®¹å™¨ã€ioc/di , ä¸‰ç§é…ç½®æ–¹å¼  |
| spring aop      | aopå’Œaopæ¡†æ¶å’Œä»£ç†æŠ€æœ¯ã€åŸºäºæ³¨è§£çš„aopé…ç½®   |
| spring tx       | å£°æ˜å¼å’Œç¼–ç¨‹å¼äº‹åŠ¡ã€åŠ¨æ€äº‹åŠ¡ç®¡ç†å™¨ã€äº‹åŠ¡æ³¨è§£ã€å±æ€§   |
