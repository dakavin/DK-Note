---
æ–‡ç« æ ‡é¢˜: "[[5_ç‰¹æ®Šå…³é”®å­—çš„ç†è§£]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æ–‡ç« æ·±å…¥è§£æJavaä¸­`transient`ã€`instanceof`ã€`final`ã€`static`ç­‰æ ¸å¿ƒå…³é”®å­—ã€‚é‡ç‚¹è¯¦ç»†é˜è¿°`volatile`å’Œ`synchronized`åœ¨Javaå†…å­˜æ¨¡å‹ä¸‹å¦‚ä½•ä¿è¯å¯è§æ€§ã€åŸå­æ€§ã€æœ‰åºæ€§ï¼Œå¹¶åˆ†æå…¶åº•å±‚å®ç°åŸç†ã€‚
tags:
- "Java"
- "å…³é”®å­—"
- "å¹¶å‘ç¼–ç¨‹"
- "Javaå†…å­˜æ¨¡å‹"
- "volatile"
- "synchronized"
- "çº¿ç¨‹å®‰å…¨"
- "åºåˆ—åŒ–"
ç›¸å…³æ–‡ç« :
- "[[0_å‰ç½®çŸ¥è¯†å¿«é€Ÿå›é¡¾]]"
- "[[7_Volatileå…³é”®å­—çš„ä½œç”¨]]"
- "[[14_åºåˆ—åŒ–ä¸ååºåˆ—åŒ–]]"
- "[[2_Javaåºåˆ—åŒ–è¯¦è§£]]"
- "[[4_æŠ€æœ¯ä¸€é¢ï¼ˆåä¸ºodï¼‰]]"
æ–‡ç« åˆ†ç±»: "ğŸ’» ç¼–ç¨‹è¯­è¨€"
æ–‡ç« è·¯å¾„: "02-ğŸ’» ç¼–ç¨‹è¯­è¨€/01-â˜• JavaæŠ€æœ¯æ ˆ/02-ğŸ“š åŸºç¡€è¯­æ³•/2_Javaå¤ä¹ ç¬”è®°/2_æ•°æ®ç±»å‹ã€å…³é”®å­—/5_ç‰¹æ®Šå…³é”®å­—çš„ç†è§£.md"
æ–‡ç« éš¾åº¦: ä¸­çº§ ğŸŒ³
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­â­ ç²¾é€šå¿…å¤‡
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2025-05-27 21:36:04
---

## 1 transient

åœ¨å…³äºjavaçš„é›†åˆç±»çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å‘ç°ArrayListç±»å’ŒVectorç±»éƒ½æ˜¯ä½¿ç”¨æ•°ç»„å®ç°çš„ï¼Œä½†æ˜¯åœ¨å®šä¹‰æ•°ç»„elementDataè¿™ä¸ªå±æ€§æ—¶ç¨æœ‰ä¸åŒï¼Œé‚£å°±æ˜¯ArrayListä½¿ç”¨transientå…³é”®å­—ï¼š

```tsx
private transient Object[] elementData;  

protected Object[] elementData;
```

é‚£ä¹ˆï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹transientå…³é”®å­—çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

> Javaè¯­è¨€çš„å…³é”®å­—ï¼Œå˜é‡ä¿®é¥°ç¬¦ï¼Œå¦‚æœç”¨`transient`å£°æ˜ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œå½“å¯¹è±¡å­˜å‚¨æ—¶ï¼Œå®ƒçš„å€¼ä¸éœ€è¦ç»´æŒã€‚è¿™é‡Œçš„å¯¹è±¡å­˜å‚¨æ˜¯æŒ‡ï¼ŒJavaçš„serializationæä¾›çš„ä¸€ç§æŒä¹…åŒ–å¯¹è±¡å®ä¾‹çš„æœºåˆ¶ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¢«åºåˆ—åŒ–çš„æ—¶å€™ï¼Œ`transient`å‹å˜é‡çš„å€¼ä¸åŒ…æ‹¬åœ¨åºåˆ—åŒ–çš„è¡¨ç¤ºä¸­ï¼Œç„¶è€Œé`transient`å‹çš„å˜é‡æ˜¯è¢«åŒ…æ‹¬è¿›å»çš„ã€‚ä½¿ç”¨æƒ…å†µæ˜¯ï¼šå½“æŒä¹…åŒ–å¯¹è±¡æ—¶ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡æ•°æ®æˆå‘˜ï¼Œæˆ‘ä»¬ä¸æƒ³ç”¨serializationæœºåˆ¶æ¥ä¿å­˜å®ƒã€‚ä¸ºäº†åœ¨ä¸€ä¸ªç‰¹å®šå¯¹è±¡çš„ä¸€ä¸ªåŸŸä¸Šå…³é—­serializationï¼Œå¯ä»¥åœ¨è¿™ä¸ªåŸŸå‰åŠ ä¸Šå…³é”®å­—`transient`ã€‚

ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯è¢«`transient`ä¿®é¥°çš„æˆå‘˜å˜é‡ï¼Œåœ¨åºåˆ—åŒ–çš„æ—¶å€™å…¶å€¼ä¼šè¢«å¿½ç•¥ï¼Œåœ¨è¢«ååºåˆ—åŒ–åï¼Œ`transient`å˜é‡çš„å€¼è¢«è®¾ä¸ºåˆå§‹å€¼ï¼Œ å¦‚intå‹çš„æ˜¯0ï¼Œå¯¹è±¡å‹çš„æ˜¯nullã€‚

## 2 instanceof

`instanceof`æ˜¯Javaçš„ä¸€ä¸ªäºŒå…ƒæ“ä½œç¬¦ï¼Œç±»ä¼¼äº ==ï¼Œ>ï¼Œ< ç­‰æ“ä½œç¬¦ã€‚`instanceof`æ˜¯Javaçš„ä¿ç•™å…³é”®å­—ã€‚å®ƒçš„ä½œç”¨æ˜¯æµ‹è¯•å®ƒå·¦è¾¹çš„å¯¹è±¡æ˜¯å¦æ˜¯å®ƒå³è¾¹çš„ç±»çš„å®ä¾‹ï¼Œè¿”å›`boolean`çš„æ•°æ®ç±»å‹ã€‚

ä»¥ä¸‹å®ä¾‹åˆ›å»ºäº†displayObjectClass()æ–¹æ³•æ¥æ¼”ç¤ºJava instanceofå…³é”®å­—ç”¨æ³•ï¼š

```csharp
public static void displayObjectClass(Object o) {
  if (o instanceof Vector)
     System.out.println("å¯¹è±¡æ˜¯ java.util.Vector ç±»çš„å®ä¾‹");
  else if (o instanceof ArrayList)
     System.out.println("å¯¹è±¡æ˜¯ java.util.ArrayList ç±»çš„å®ä¾‹");
  else
    System.out.println("å¯¹è±¡æ˜¯ " + o.getClass() + " ç±»çš„å®ä¾‹");
}
```

## 3 volatile

åœ¨Javaå†…å­˜æ¨¡å‹ä¸­æˆ‘ä»¬æ›¾ç»ä»‹ç»è¿‡ï¼ŒJavaè¯­è¨€ä¸ºäº†è§£å†³å¹¶å‘ç¼–ç¨‹ä¸­å­˜åœ¨çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜ï¼Œæä¾›äº†ä¸€ç³»åˆ—å’Œå¹¶å‘å¤„ç†ç›¸å…³çš„å…³é”®å­—ï¼Œæ¯”å¦‚`synchronized`ã€`volatile`ã€`final`ã€`concurrentåŒ…`ç­‰ã€‚åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»ä»‹ç»äº†`synchronized`çš„ç”¨æ³•åŠåŸç†ã€‚ä¸‹é¢å°±å›´ç»•`volatile`å±•å¼€ï¼Œä¸»è¦ä»‹ç»`volatile`çš„ç”¨æ³•ã€`volatile`çš„åŸç†ï¼Œä»¥åŠ`volatile`æ˜¯å¦‚ä½•æä¾›å¯è§æ€§å’Œæœ‰åºæ€§ä¿éšœçš„ç­‰ã€‚

`volatile`è¿™ä¸ªå…³é”®å­—ï¼Œä¸ä»…ä»…åœ¨Javaè¯­è¨€ä¸­æœ‰ï¼Œåœ¨å¾ˆå¤šè¯­è¨€ä¸­éƒ½æœ‰çš„ï¼Œè€Œä¸”å…¶ç”¨æ³•å’Œè¯­ä¹‰ä¹Ÿéƒ½æ˜¯ä¸å°½ç›¸åŒçš„ã€‚å°¤å…¶åœ¨Cè¯­è¨€ã€C++ä»¥åŠJavaä¸­ï¼Œéƒ½æœ‰`volatile`å…³é”®å­—ã€‚éƒ½å¯ä»¥ç”¨æ¥å£°æ˜å˜é‡æˆ–è€…å¯¹è±¡ã€‚ä¸‹é¢ç®€å•æ¥ä»‹ç»ä¸€ä¸‹Javaè¯­è¨€ä¸­çš„`volatile`å…³é”®å­—ã€‚

### 3.1 volatileç”¨æ³•

`volatile`é€šå¸¸è¢«æ¯”å–»æˆ"è½»é‡çº§çš„`synchronized`"ï¼Œä¹Ÿæ˜¯Javaå¹¶å‘ç¼–ç¨‹ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå…³é”®å­—ã€‚å’Œ`synchronized`ä¸åŒï¼Œ`volatile`æ˜¯ä¸€ä¸ªå˜é‡ä¿®é¥°ç¬¦ï¼Œåªèƒ½ç”¨æ¥ä¿®é¥°å˜é‡ã€‚æ— æ³•ä¿®é¥°æ–¹æ³•åŠä»£ç å—ç­‰ã€‚

`volatile`çš„ç”¨æ³•æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åœ¨å£°æ˜ä¸€ä¸ªå¯èƒ½è¢«å¤šçº¿ç¨‹åŒæ—¶è®¿é—®çš„å˜é‡æ—¶ï¼Œä½¿ç”¨`volatile`ä¿®é¥°å°±å¯ä»¥äº†ï¼š

```java
public class Singleton {  
    private volatile static Singleton singleton;  
    private Singleton (){}  
    public static Singleton getSingleton() {  
    if (singleton == null) {  
        synchronized (Singleton.class) {  
        if (singleton == null) {  
            singleton = new Singleton();  
        }  
        }  
    }  
    return singleton;  
    }  
}
```

å¦‚ä»¥ä¸Šä»£ç ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„ä½¿ç”¨åŒé‡é”æ ¡éªŒçš„å½¢å¼å®ç°å•ä¾‹çš„ï¼Œå…¶ä¸­ä½¿ç”¨`volatile`å…³é”®å­—ä¿®é¥°å¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åˆ°çš„singletonã€‚

### 3.2 volatileåŸç†

åœ¨Javaå†…å­˜æ¨¡å‹ä¸­æˆ‘ä»¬æ›¾ç»ä»‹ç»è¿‡ï¼Œä¸ºäº†æé«˜å¤„ç†å™¨çš„æ‰§è¡Œé€Ÿåº¦ï¼Œåœ¨å¤„ç†å™¨å’Œå†…å­˜ä¹‹é—´å¢åŠ äº†å¤šçº§ç¼“å­˜æ¥æå‡ã€‚ä½†æ˜¯ç”±äºå¼•å…¥äº†å¤šçº§ç¼“å­˜ï¼Œå°±å­˜åœ¨ç¼“å­˜æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚

ä½†æ˜¯ï¼Œå¯¹äº`volatile`å˜é‡ï¼Œå½“å¯¹`volatile`å˜é‡è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ï¼ŒJVMä¼šå‘å¤„ç†å™¨å‘é€ä¸€æ¡lockå‰ç¼€çš„æŒ‡ä»¤ï¼Œå°†è¿™ä¸ªç¼“å­˜ä¸­çš„å˜é‡å›å†™åˆ°ç³»ç»Ÿä¸»å­˜ä¸­ã€‚

ä½†æ˜¯å°±ç®—å†™å›åˆ°å†…å­˜ï¼Œå¦‚æœå…¶ä»–å¤„ç†å™¨ç¼“å­˜çš„å€¼è¿˜æ˜¯æ—§çš„ï¼Œå†æ‰§è¡Œè®¡ç®—æ“ä½œå°±ä¼šæœ‰é—®é¢˜ï¼Œæ‰€ä»¥åœ¨å¤šå¤„ç†å™¨ä¸‹ï¼Œä¸ºäº†ä¿è¯å„ä¸ªå¤„ç†å™¨çš„ç¼“å­˜æ˜¯ä¸€è‡´çš„ï¼Œå°±ä¼šå®ç°`ç¼“å­˜ä¸€è‡´æ€§åè®®`ã€‚

**ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼š** æ¯ä¸ªå¤„ç†å™¨é€šè¿‡å—…æ¢åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æŸ¥è‡ªå·±ç¼“å­˜çš„å€¼æ˜¯ä¸æ˜¯è¿‡æœŸäº†ï¼Œå½“å¤„ç†å™¨å‘ç°è‡ªå·±ç¼“å­˜è¡Œå¯¹åº”çš„å†…å­˜åœ°å€è¢«ä¿®æ”¹ï¼Œå°±ä¼šå°†å½“å‰å¤„ç†å™¨çš„ç¼“å­˜è¡Œè®¾ç½®æˆæ— æ•ˆçŠ¶æ€ï¼Œå½“å¤„ç†å™¨è¦å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œä¼šå¼ºåˆ¶é‡æ–°ä»ç³»ç»Ÿå†…å­˜é‡ŒæŠŠæ•°æ®è¯»åˆ°å¤„ç†å™¨ç¼“å­˜é‡Œã€‚

æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªå˜é‡è¢«`volatile`æ‰€ä¿®é¥°çš„è¯ï¼Œåœ¨æ¯æ¬¡æ•°æ®å˜åŒ–ä¹‹åï¼Œå…¶å€¼éƒ½ä¼šè¢«å¼ºåˆ¶åˆ·å…¥ä¸»å­˜ã€‚è€Œå…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜ç”±äºéµå®ˆäº†ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œä¹Ÿä¼šæŠŠè¿™ä¸ªå˜é‡çš„å€¼ä»ä¸»å­˜åŠ è½½åˆ°è‡ªå·±çš„ç¼“å­˜ä¸­ã€‚è¿™å°±ä¿è¯äº†ä¸€ä¸ª`volatile`åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå…¶å€¼åœ¨å¤šä¸ªç¼“å­˜ä¸­æ˜¯å¯è§çš„ã€‚

### 3.3 volatileä¸å¯è§æ€§

å¯è§æ€§æ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼ã€‚

æˆ‘ä»¬åœ¨Javaå†…å­˜æ¨¡å‹ä¸­åˆ†æè¿‡ï¼šJavaå†…å­˜æ¨¡å‹è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä¸­ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ã€‚ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡çš„ä¼ é€’å‡éœ€è¦è‡ªå·±çš„å·¥ä½œå†…å­˜å’Œä¸»å­˜ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥è¿›è¡Œã€‚æ‰€ä»¥ï¼Œå°±å¯èƒ½å‡ºç°çº¿ç¨‹1æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œä½†æ˜¯çº¿ç¨‹2ä¸å¯è§çš„æƒ…å†µã€‚

å‰é¢çš„å…³äº`volatile`çš„åŸç†ä¸­ä»‹ç»è¿‡äº†ï¼ŒJavaä¸­çš„`volatile`å…³é”®å­—æä¾›äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯è¢«å…¶ä¿®é¥°çš„å˜é‡åœ¨è¢«ä¿®æ”¹åå¯ä»¥ç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œè¢«å…¶ä¿®é¥°çš„å˜é‡åœ¨æ¯æ¬¡ä½¿ç”¨ä¹‹å‰éƒ½ä»ä¸»å†…å­˜åˆ·æ–°ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨`volatile`æ¥ä¿è¯å¤šçº¿ç¨‹æ“ä½œæ—¶å˜é‡çš„å¯è§æ€§ã€‚

### 3.4 volatileä¸æœ‰åºæ€§

æœ‰åºæ€§å³ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚

æˆ‘ä»¬åœ¨Javaå†…å­˜æ¨¡å‹ä¸­åˆ†æè¿‡ï¼šé™¤äº†å¼•å…¥äº†æ—¶é—´ç‰‡ä»¥å¤–ï¼Œç”±äºå¤„ç†å™¨ä¼˜åŒ–å’ŒæŒ‡ä»¤é‡æ’ç­‰ï¼ŒCPUè¿˜å¯èƒ½å¯¹è¾“å…¥ä»£ç è¿›è¡Œä¹±åºæ‰§è¡Œï¼Œæ¯”å¦‚`load->add->save` æœ‰å¯èƒ½è¢«ä¼˜åŒ–æˆ`load->save->add` ã€‚è¿™å°±æ˜¯å¯èƒ½å­˜åœ¨æœ‰åºæ€§é—®é¢˜ã€‚è€Œ`volatile`é™¤äº†å¯ä»¥ä¿è¯æ•°æ®çš„å¯è§æ€§ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯ä»–å¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’ä¼˜åŒ–ç­‰ã€‚

æ™®é€šçš„å˜é‡ä»…ä»…ä¼šä¿è¯åœ¨è¯¥æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€ä¾èµ–çš„èµ‹å€¼ç»“æœçš„åœ°æ–¹éƒ½èƒ½è·å¾—æ­£ç¡®çš„ç»“æœï¼Œè€Œä¸èƒ½ä¿è¯å˜é‡çš„èµ‹å€¼æ“ä½œçš„é¡ºåºä¸ç¨‹åºä»£ç ä¸­çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚

`volatile`å¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œè¿™å°±ä¿è¯äº†ä»£ç çš„ç¨‹åºä¼šä¸¥æ ¼æŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚è¿™å°±ä¿è¯äº†æœ‰åºæ€§ã€‚è¢«`volatile`ä¿®é¥°çš„å˜é‡çš„æ“ä½œï¼Œä¼šä¸¥æ ¼æŒ‰ç…§ä»£ç é¡ºåºæ‰§è¡Œï¼Œ`load->add->save` çš„æ‰§è¡Œé¡ºåºå°±æ˜¯ï¼šloadã€addã€saveã€‚

### 3.5 volatileä¸åŸå­æ€§

åŸå­æ€§æ˜¯æŒ‡ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œè¦å…¨éƒ¨æ‰§è¡Œå®Œæˆï¼Œè¦ä¸å°±éƒ½ä¸æ‰§è¡Œã€‚

æˆ‘ä»¬åœ¨Javaçš„å¹¶å‘ç¼–ç¨‹ä¸­çš„å¤šçº¿ç¨‹é—®é¢˜åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å„¿ï¼Ÿä¸­åˆ†æè¿‡ï¼šçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚CPUæœ‰æ—¶é—´ç‰‡çš„æ¦‚å¿µï¼Œä¼šæ ¹æ®ä¸åŒçš„è°ƒåº¦ç®—æ³•è¿›è¡Œçº¿ç¨‹è°ƒåº¦ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è·å¾—æ—¶é—´ç‰‡ä¹‹åå¼€å§‹æ‰§è¡Œï¼Œåœ¨æ—¶é—´ç‰‡è€—å°½ä¹‹åï¼Œå°±ä¼šå¤±å»CPUä½¿ç”¨æƒã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œç”±äºæ—¶é—´ç‰‡åœ¨çº¿ç¨‹é—´è½®æ¢ï¼Œå°±ä¼šå‘ç”ŸåŸå­æ€§é—®é¢˜ã€‚

å‰é¢ï¼Œæˆ‘ä»¬ä»‹ç»`synchronized`çš„æ—¶å€™ï¼Œæåˆ°è¿‡ï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œéœ€è¦é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤`monitorenter`å’Œ`monitorexit`ï¼Œä½†æ˜¯`volatile`å’Œè¿™ä¸¤ä¸ªæŒ‡ä»¤ä¹‹é—´æ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ã€‚

**æ‰€ä»¥ï¼Œ`volatile`æ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§çš„ã€‚**

åœ¨ä»¥ä¸‹ä¸¤ä¸ªåœºæ™¯ä¸­å¯ä»¥ä½¿ç”¨`volatile`æ¥ä»£æ›¿`synchronized`ï¼š

> 1ã€è¿ç®—ç»“æœå¹¶ä¸ä¾èµ–å˜é‡çš„å½“å‰å€¼ï¼Œæˆ–è€…èƒ½å¤Ÿç¡®ä¿åªæœ‰å•ä¸€çš„çº¿ç¨‹ä¼šä¿®æ”¹å˜é‡çš„å€¼ã€‚  
> 2ã€å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸã€‚

é™¤ä»¥ä¸Šåœºæ™¯å¤–ï¼Œéƒ½éœ€è¦ä½¿ç”¨å…¶ä»–æ–¹å¼æ¥ä¿è¯åŸå­æ€§ï¼Œå¦‚`synchronized`æˆ–è€…`concurrent`åŒ…ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹volatileå’ŒåŸå­æ€§çš„ä¾‹å­ï¼š

```csharp
public class Test {
    public volatile int inc = 0;

    public void increase() {
        inc++;
    }

    public static void main(String[] args) {
        final Test test = new Test();
        for(int i=0;i<10;i++){
            new Thread(){
                public void run() {
                    for(int j=0;j<1000;j++)
                        test.increase();
                };
            }.start();
        }

        while(Thread.activeCount()>1)  //ä¿è¯å‰é¢çš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œ
            Thread.yield();
        System.out.println(test.inc);
    }
}
```

ä»¥ä¸Šä»£ç æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åˆ›å»º10ä¸ªçº¿ç¨‹ï¼Œç„¶ååˆ†åˆ«æ‰§è¡Œ1000æ¬¡`i++`æ“ä½œã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œç¨‹åºçš„è¾“å‡ºç»“æœåº”è¯¥æ˜¯10000ï¼Œä½†æ˜¯ï¼Œå¤šæ¬¡æ‰§è¡Œçš„ç»“æœéƒ½å°äº10000ã€‚è¿™å…¶å®å°±æ˜¯volatileæ— æ³•æ»¡è¶³åŸå­æ€§çš„åŸå› ã€‚

ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Œé‚£æ˜¯å› ä¸ºè™½ç„¶`volatile`å¯ä»¥ä¿è¯`inc`åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ã€‚ä½†æ˜¯æ— æ³•ä¿è¯`inc++`çš„åŸå­æ€§ã€‚

### 3.6 æ€»ç»“ä¸æ€è€ƒ

æˆ‘ä»¬ä»‹ç»è¿‡äº†`volatile`å…³é”®å­—å’Œ`synchronized`å…³é”®å­—ã€‚ç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼Œ`synchronized`å¯ä»¥ä¿è¯åŸå­æ€§ã€æœ‰åºæ€§å’Œå¯è§æ€§ã€‚è€Œ`volatile`å´åªèƒ½ä¿è¯æœ‰åºæ€§å’Œå¯è§æ€§ã€‚

é‚£ä¹ˆï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹åŒé‡æ ¡éªŒé”å®ç°çš„å•ä¾‹ï¼Œå·²ç»ä½¿ç”¨äº†`synchronized`ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦`volatile`ï¼Ÿ

```java
public class Singleton {  
    private volatile static Singleton singleton;  
    private Singleton (){}  
    public static Singleton getSingleton() {  
    if (singleton == null) {  
        synchronized (Singleton.class) {  
        if (singleton == null) {  
            singleton = new Singleton();  
        }  
        }  
    }  
    return singleton;  
    }  
}
```

## 4 synchronized

åœ¨[Javaå†…å­˜æ¨¡å‹](https://www.jianshu.com/p/ce81f98ce134)ä¸­æˆ‘ä»¬æ›¾ç»ä»‹ç»è¿‡ï¼ŒJavaè¯­è¨€ä¸ºäº†è§£å†³å¹¶å‘ç¼–ç¨‹ä¸­å­˜åœ¨çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜ï¼Œæä¾›äº†ä¸€ç³»åˆ—å’Œå¹¶å‘å¤„ç†ç›¸å…³çš„å…³é”®å­—ï¼Œæ¯”å¦‚`synchronized`ã€`volatile`ã€`final`ã€`concurrentåŒ…`ç­‰ã€‚

åœ¨ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸­ï¼Œæœ‰è¿™æ ·ä¸€æ®µè¯ï¼š

> `synchronized`å…³é”®å­—åœ¨éœ€è¦åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§è¿™ä¸‰ç§ç‰¹æ€§çš„æ—¶å€™éƒ½å¯ä»¥ä½œä¸ºå…¶ä¸­ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œçœ‹èµ·æ¥æ˜¯â€œä¸‡èƒ½â€çš„ã€‚çš„ç¡®ï¼Œå¤§éƒ¨åˆ†å¹¶å‘æ§åˆ¶æ“ä½œéƒ½èƒ½ä½¿ç”¨synchronizedæ¥å®Œæˆã€‚

æµ·æ˜å¨åœ¨ä»–çš„ã€Šåˆåä¹‹æ­»ã€‹è¯´è¿‡çš„ï¼šâ€œå†°å±±è¿åŠ¨ä¹‹é›„ä¼Ÿå£®è§‚ï¼Œæ˜¯å› ä¸ºä»–åªæœ‰å…«åˆ†ä¹‹ä¸€åœ¨æ°´é¢ä¸Šã€‚â€å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œ`synchronized`åªæ˜¯ä¸ªå…³é”®å­—è€Œå·²ï¼Œç”¨èµ·æ¥å¾ˆç®€å•ã€‚ä¹‹æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å¤„ç†å¤šçº¿ç¨‹é—®é¢˜æ—¶å¯ä»¥ä¸ç”¨è€ƒè™‘å¤ªå¤šï¼Œå°±æ˜¯å› ä¸ºè¿™ä¸ªå…³é”®å­—å¸®æˆ‘ä»¬å±è”½äº†å¾ˆå¤šç»†èŠ‚ã€‚

é‚£ä¹ˆï¼Œæœ¬æ–‡å°±å›´ç»•`synchronized`å±•å¼€ï¼Œä¸»è¦ä»‹ç»`synchronized`çš„ç”¨æ³•ã€`synchronized`çš„åŸç†ï¼Œä»¥åŠ`synchronized`æ˜¯å¦‚ä½•æä¾›åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ä¿éšœçš„ç­‰ã€‚

### 4.1 synchronizedçš„ç”¨æ³•

`synchronized`æ˜¯Javaæä¾›çš„ä¸€ä¸ªå¹¶å‘æ§åˆ¶çš„å…³é”®å­—ã€‚ä¸»è¦æœ‰ä¸¤ç§ç”¨æ³•ï¼Œåˆ†åˆ«æ˜¯åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥ä»£ç å—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`synchronized`æ—¢å¯ä»¥ä¿®é¥°æ–¹æ³•ä¹Ÿå¯ä»¥ä¿®é¥°ä»£ç å—ã€‚

```java
public class SynchronizedDemo {
     //åŒæ­¥æ–¹æ³•
    public synchronized void doSth(){
        System.out.println("Hello World");
    }

    //åŒæ­¥ä»£ç å—
    public void doSth1(){
        synchronized (SynchronizedDemo.class){
            System.out.println("Hello World");
        }
    }
}
```

è¢«`synchronized`ä¿®é¥°çš„ä»£ç å—åŠæ–¹æ³•ï¼Œåœ¨åŒä¸€æ—¶é—´ï¼Œåªèƒ½è¢«å•ä¸ªçº¿ç¨‹è®¿é—®ã€‚

### 4.2 synchronizedçš„å®ç°åŸç†

`synchronized`æ˜¯Javaä¸­ç”¨äºè§£å†³å¹¶å‘æƒ…å†µä¸‹æ•°æ®åŒæ­¥è®¿é—®çš„ä¸€ä¸ªå¾ˆé‡è¦çš„å…³é”®å­—ã€‚å½“æˆ‘ä»¬æƒ³è¦ä¿è¯ä¸€ä¸ªå…±äº«èµ„æºåœ¨åŒä¸€æ—¶é—´åªä¼šè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®åˆ°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨`synchronized`å…³é”®å­—å¯¹ç±»æˆ–è€…å¯¹è±¡åŠ é”ã€‚

åœ¨[æ·±å…¥ç†è§£å¤šçº¿ç¨‹ï¼ˆä¸€ï¼‰â€”â€”Synchronizedçš„å®ç°åŸç†](https://www.jianshu.com/p/b59e5ab1dff0)ä¸­æ›¾ç»ä»‹ç»è¿‡å…¶å®ç°åŸç†ï¼Œä¸ºäº†ä¿è¯çŸ¥è¯†çš„å®Œæ•´æ€§ï¼Œè¿™é‡Œå†ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œè¯¦ç»†çš„å†…å®¹è¯·å»åŸæ–‡é˜…è¯»ã€‚

æˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œåç¼–è¯‘ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ä»£ç ï¼š

```cpp
public synchronized void doSth();
    descriptor: ()V
    flags: ACC_PUBLIC, ACC_SYNCHRONIZED
    Code:
      stack=2, locals=1, args_size=1
         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;
         3: ldc           #3                  // String Hello World
         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V
         8: return

  public void doSth1();
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      stack=2, locals=3, args_size=1
         0: ldc           #5                  // class com/hollis/SynchronizedTest
         2: dup
         3: astore_1
         4: monitorenter
         5: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;
         8: ldc           #3                  // String Hello World
        10: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V
        13: aload_1
        14: monitorexit
        15: goto          23
        18: astore_2
        19: aload_1
        20: monitorexit
        21: aload_2
        22: athrow
        23: return
```

é€šè¿‡åç¼–è¯‘åä»£ç å¯ä»¥çœ‹å‡ºï¼šå¯¹äºåŒæ­¥æ–¹æ³•ï¼ŒJVMé‡‡ç”¨`ACC_SYNCHRONIZED`æ ‡è®°ç¬¦æ¥å®ç°åŒæ­¥ã€‚ å¯¹äºåŒæ­¥ä»£ç å—ã€‚JVMé‡‡ç”¨`monitorenter`ã€`monitorexit`ä¸¤ä¸ªæŒ‡ä»¤æ¥å®ç°åŒæ­¥ã€‚

åœ¨[The JavaÂ® Virtual Machine Specification](https://links.jianshu.com/go?to=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2Fspecs%2Fjvms%2Fse8%2Fhtml%2Fjvms-2.html%23jvms-2.11.10)ä¸­æœ‰å…³äºåŒæ­¥æ–¹æ³•å’ŒåŒæ­¥ä»£ç å—çš„å®ç°åŸç†çš„ä»‹ç»ï¼Œæˆ‘ç¿»è¯‘æˆä¸­æ–‡å¦‚ä¸‹ï¼š

> æ–¹æ³•çº§çš„åŒæ­¥æ˜¯éšå¼çš„ã€‚åŒæ­¥æ–¹æ³•çš„å¸¸é‡æ± ä¸­ä¼šæœ‰ä¸€ä¸ª`ACC_SYNCHRONIZED`æ ‡å¿—ã€‚å½“æŸä¸ªçº¿ç¨‹è¦è®¿é—®æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥æ˜¯å¦æœ‰`ACC_SYNCHRONIZED`ï¼Œå¦‚æœæœ‰è®¾ç½®ï¼Œåˆ™éœ€è¦å…ˆè·å¾—ç›‘è§†å™¨é”ï¼Œç„¶åå¼€å§‹æ‰§è¡Œæ–¹æ³•ï¼Œæ–¹æ³•æ‰§è¡Œä¹‹åå†é‡Šæ”¾ç›‘è§†å™¨é”ã€‚è¿™æ—¶å¦‚æœå…¶ä»–çº¿ç¨‹æ¥è¯·æ±‚æ‰§è¡Œæ–¹æ³•ï¼Œä¼šå› ä¸ºæ— æ³•è·å¾—ç›‘è§†å™¨é”è€Œè¢«é˜»æ–­ä½ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå‘ç”Ÿäº†å¼‚å¸¸ï¼Œå¹¶ä¸”æ–¹æ³•å†…éƒ¨å¹¶æ²¡æœ‰å¤„ç†è¯¥å¼‚å¸¸ï¼Œé‚£ä¹ˆåœ¨å¼‚å¸¸è¢«æŠ›åˆ°æ–¹æ³•å¤–é¢ä¹‹å‰ç›‘è§†å™¨é”ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚

> åŒæ­¥ä»£ç å—ä½¿ç”¨`monitorenter`å’Œ`monitorexit`ä¸¤ä¸ªæŒ‡ä»¤å®ç°ã€‚å¯ä»¥æŠŠæ‰§è¡Œ`monitorenter`æŒ‡ä»¤ç†è§£ä¸ºåŠ é”ï¼Œæ‰§è¡Œ`monitorexit`ç†è§£ä¸ºé‡Šæ”¾é”ã€‚ æ¯ä¸ªå¯¹è±¡ç»´æŠ¤ç€ä¸€ä¸ªè®°å½•ç€è¢«é”æ¬¡æ•°çš„è®¡æ•°å™¨ã€‚æœªè¢«é”å®šçš„å¯¹è±¡çš„è¯¥è®¡æ•°å™¨ä¸º0ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ï¼ˆæ‰§è¡Œ`monitorenter`ï¼‰åï¼Œè¯¥è®¡æ•°å™¨è‡ªå¢å˜ä¸º 1 ï¼Œå½“åŒä¸€ä¸ªçº¿ç¨‹å†æ¬¡è·å¾—è¯¥å¯¹è±¡çš„é”çš„æ—¶å€™ï¼Œè®¡æ•°å™¨å†æ¬¡è‡ªå¢ã€‚å½“åŒä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾é”ï¼ˆæ‰§è¡Œ`monitorexit`æŒ‡ä»¤ï¼‰çš„æ—¶å€™ï¼Œè®¡æ•°å™¨å†è‡ªå‡ã€‚å½“è®¡æ•°å™¨ä¸º0çš„æ—¶å€™ã€‚é”å°†è¢«é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹ä¾¿å¯ä»¥è·å¾—é”ã€‚

æ— è®ºæ˜¯`ACC_SYNCHRONIZED`è¿˜æ˜¯`monitorenter`ã€`monitorexit`éƒ½æ˜¯åŸºäºMonitorå®ç°çš„ï¼Œåœ¨Javaè™šæ‹Ÿæœº(HotSpot)ä¸­ï¼ŒMonitoræ˜¯åŸºäºC++å®ç°çš„ï¼Œç”±ObjectMonitorå®ç°ã€‚

ObjectMonitorç±»ä¸­æä¾›äº†å‡ ä¸ªæ–¹æ³•ï¼Œå¦‚`enter`ã€`exit`ã€`wait`ã€`notify`ã€`notifyAll`ç­‰ã€‚`sychronized`åŠ é”çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨objectMonitorçš„enteræ–¹æ³•ï¼Œè§£é”çš„æ—¶å€™ä¼šè°ƒç”¨exitæ–¹æ³•ã€‚ï¼ˆå…³äºMonitorè¯¦è§[æ·±å…¥ç†è§£å¤šçº¿ç¨‹ï¼ˆå››ï¼‰â€”â€” Moniterçš„å®ç°åŸç†](https://www.jianshu.com/p/825c5e5e7b7b)ï¼‰

### 4.3 synchronizedä¸åŸå­æ€§

åŸå­æ€§æ˜¯æŒ‡ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œè¦å…¨éƒ¨æ‰§è¡Œå®Œæˆï¼Œè¦ä¸å°±éƒ½ä¸æ‰§è¡Œã€‚

æˆ‘ä»¬åœ¨[Javaçš„å¹¶å‘ç¼–ç¨‹ä¸­çš„å¤šçº¿ç¨‹é—®é¢˜åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å„¿ï¼Ÿ](https://www.jianshu.com/p/b2657c010077)ä¸­åˆ†æè¿‡ï¼šçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚CPUæœ‰æ—¶é—´ç‰‡çš„æ¦‚å¿µï¼Œä¼šæ ¹æ®ä¸åŒçš„è°ƒåº¦ç®—æ³•è¿›è¡Œçº¿ç¨‹è°ƒåº¦ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è·å¾—æ—¶é—´ç‰‡ä¹‹åå¼€å§‹æ‰§è¡Œï¼Œåœ¨æ—¶é—´ç‰‡è€—å°½ä¹‹åï¼Œå°±ä¼šå¤±å»CPUä½¿ç”¨æƒã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œç”±äºæ—¶é—´ç‰‡åœ¨çº¿ç¨‹é—´è½®æ¢ï¼Œå°±ä¼šå‘ç”ŸåŸå­æ€§é—®é¢˜ã€‚

åœ¨Javaä¸­ï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæä¾›äº†ä¸¤ä¸ªé«˜çº§çš„å­—èŠ‚ç æŒ‡ä»¤`monitorenter`å’Œ`monitorexit`ã€‚å‰é¢ä¸­ï¼Œä»‹ç»è¿‡ï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼Œåœ¨Javaä¸­å¯¹åº”çš„å…³é”®å­—å°±æ˜¯`synchronized`ã€‚

é€šè¿‡`monitorenter`å’Œ`monitorexit`æŒ‡ä»¤ï¼Œå¯ä»¥ä¿è¯è¢«`synchronized`ä¿®é¥°çš„ä»£ç åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œåœ¨é”æœªé‡Šæ”¾ä¹‹å‰ï¼Œæ— æ³•è¢«å…¶ä»–çº¿ç¨‹è®¿é—®åˆ°ã€‚å› æ­¤ï¼Œåœ¨Javaä¸­å¯ä»¥ä½¿ç”¨`synchronized`æ¥ä¿è¯æ–¹æ³•å’Œä»£ç å—å†…çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚

> çº¿ç¨‹1åœ¨æ‰§è¡Œ`monitorenter`æŒ‡ä»¤çš„æ—¶å€™ï¼Œä¼šå¯¹Monitorè¿›è¡ŒåŠ é”ï¼ŒåŠ é”åå…¶ä»–çº¿ç¨‹æ— æ³•è·å¾—é”ï¼Œé™¤éçº¿ç¨‹1ä¸»åŠ¨è§£é”ã€‚å³ä½¿åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºæŸç§åŸå› ï¼Œæ¯”å¦‚CPUæ—¶é—´ç‰‡ç”¨å®Œï¼Œçº¿ç¨‹1æ”¾å¼ƒäº†CPUï¼Œä½†æ˜¯ï¼Œä»–å¹¶æ²¡æœ‰è¿›è¡Œè§£é”ã€‚è€Œç”±äº`synchronized`çš„é”æ˜¯å¯é‡å…¥çš„ï¼Œä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡è¿˜æ˜¯åªèƒ½è¢«ä»–è‡ªå·±è·å–åˆ°ï¼Œè¿˜æ˜¯ä¼šç»§ç»­æ‰§è¡Œä»£ç ã€‚ç›´åˆ°æ‰€æœ‰ä»£ç æ‰§è¡Œå®Œã€‚è¿™å°±ä¿è¯äº†åŸå­æ€§ã€‚

### 4.4 synchronizedä¸å¯è§æ€§

å¯è§æ€§æ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼ã€‚

æˆ‘ä»¬åœ¨[Javaå†…å­˜æ¨¡å‹](https://www.jianshu.com/p/ce81f98ce134)ä¸­åˆ†æè¿‡ï¼šJavaå†…å­˜æ¨¡å‹è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä¸­æ˜¯ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ã€‚ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡çš„ä¼ é€’å‡éœ€è¦è‡ªå·±çš„å·¥ä½œå†…å­˜å’Œä¸»å­˜ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥è¿›è¡Œã€‚æ‰€ä»¥ï¼Œå°±å¯èƒ½å‡ºç°çº¿ç¨‹1æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œä½†æ˜¯çº¿ç¨‹2ä¸å¯è§çš„æƒ…å†µã€‚

å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ï¼Œè¢«`synchronized`ä¿®é¥°çš„ä»£ç ï¼Œåœ¨å¼€å§‹æ‰§è¡Œæ—¶ä¼šåŠ é”ï¼Œæ‰§è¡Œå®Œæˆåä¼šè¿›è¡Œè§£é”ã€‚è€Œä¸ºäº†ä¿è¯å¯è§æ€§ï¼Œæœ‰ä¸€æ¡è§„åˆ™æ˜¯è¿™æ ·çš„ï¼šå¯¹ä¸€ä¸ªå˜é‡è§£é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å­˜ä¸­ã€‚è¿™æ ·è§£é”åï¼Œåç»­çº¿ç¨‹å°±å¯ä»¥è®¿é—®åˆ°è¢«ä¿®æ”¹åçš„å€¼ã€‚

æ‰€ä»¥ï¼Œ`synchronized`å…³é”®å­—é”ä½çš„å¯¹è±¡ï¼Œå…¶å€¼æ˜¯å…·æœ‰å¯è§æ€§çš„ã€‚

### 4.5 synchronizedä¸æœ‰åºæ€§

æœ‰åºæ€§å³ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚

æˆ‘ä»¬åœ¨[Javaå†…å­˜æ¨¡å‹](https://www.jianshu.com/p/ce81f98ce134)ä¸­åˆ†æè¿‡ï¼šé™¤äº†å¼•å…¥äº†æ—¶é—´ç‰‡ä»¥å¤–ï¼Œç”±äºå¤„ç†å™¨ä¼˜åŒ–å’ŒæŒ‡ä»¤é‡æ’ç­‰ï¼ŒCPUè¿˜å¯èƒ½å¯¹è¾“å…¥ä»£ç è¿›è¡Œä¹±åºæ‰§è¡Œï¼Œæ¯”å¦‚load->add->save æœ‰å¯èƒ½è¢«ä¼˜åŒ–æˆload->save->add ã€‚è¿™å°±æ˜¯å¯èƒ½å­˜åœ¨æœ‰åºæ€§é—®é¢˜ã€‚

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`synchronized`æ˜¯æ— æ³•ç¦æ­¢æŒ‡ä»¤é‡æ’å’Œå¤„ç†å™¨ä¼˜åŒ–çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`synchronized`æ— æ³•é¿å…ä¸Šè¿°æåˆ°çš„é—®é¢˜ã€‚

é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¯´`synchronized`ä¹Ÿæä¾›äº†æœ‰åºæ€§ä¿è¯å‘¢ï¼Ÿ

è¿™å°±è¦å†æŠŠæœ‰åºæ€§çš„æ¦‚å¿µæ‰©å±•ä¸€ä¸‹äº†ã€‚Javaç¨‹åºä¸­å¤©ç„¶çš„æœ‰åºæ€§å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼šå¦‚æœåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯å¤©ç„¶æœ‰åºçš„ã€‚å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚

ä»¥ä¸Šè¿™å¥è¯ä¹Ÿæ˜¯ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸­çš„åŸå¥ï¼Œä½†æ˜¯æ€ä¹ˆç†è§£å‘¢ï¼Ÿå‘¨å¿—æ˜å¹¶æ²¡æœ‰è¯¦ç»†çš„è§£é‡Šã€‚è¿™é‡Œæˆ‘ç®€å•æ‰©å±•ä¸€ä¸‹ï¼Œè¿™å…¶å®å’Œ`as-if-serialè¯­ä¹‰`æœ‰å…³ã€‚

`as-if-serial`è¯­ä¹‰çš„æ„æ€æŒ‡ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åºï¼ˆç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰ï¼Œå•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœéƒ½ä¸èƒ½è¢«æ”¹å˜ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ— è®ºå¦‚ä½•ä¼˜åŒ–ï¼Œéƒ½å¿…é¡»éµå®ˆ`as-if-serial`è¯­ä¹‰ã€‚

è¿™é‡Œä¸å¯¹`as-if-serialè¯­ä¹‰`è¯¦ç»†å±•å¼€äº†ï¼Œç®€å•è¯´å°±æ˜¯ï¼Œ`as-if-serialè¯­ä¹‰`ä¿è¯äº†å•çº¿ç¨‹ä¸­ï¼ŒæŒ‡ä»¤é‡æ’æ˜¯æœ‰ä¸€å®šçš„é™åˆ¶çš„ï¼Œè€Œåªè¦ç¼–è¯‘å™¨å’Œå¤„ç†å™¨éƒ½éµå®ˆäº†è¿™ä¸ªè¯­ä¹‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¤ä¸ºå•çº¿ç¨‹ç¨‹åºæ˜¯æŒ‰ç…§é¡ºåºæ‰§è¡Œçš„ã€‚å½“ç„¶ï¼Œå®é™…ä¸Šè¿˜æ˜¯æœ‰é‡æ’çš„ï¼Œåªä¸è¿‡æˆ‘ä»¬æ— é¡»å…³å¿ƒè¿™ç§é‡æ’çš„å¹²æ‰°ã€‚

æ‰€ä»¥å‘¢ï¼Œç”±äº`synchronized`ä¿®é¥°çš„ä»£ç ï¼ŒåŒä¸€æ—¶é—´åªèƒ½è¢«åŒä¸€çº¿ç¨‹è®¿é—®ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ã€‚æ‰€ä»¥ï¼Œå¯ä»¥ä¿è¯å…¶æœ‰åºæ€§ã€‚

### 4.6 synchronizedä¸é”ä¼˜åŒ–

å‰é¢ä»‹ç»äº†`synchronized`çš„ç”¨æ³•ã€åŸç†ä»¥åŠå¯¹å¹¶å‘ç¼–ç¨‹çš„ä½œç”¨ã€‚æ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å…³é”®å­—ã€‚

`synchronized`å…¶å®æ˜¯å€ŸåŠ©Monitorå®ç°çš„ï¼Œåœ¨åŠ é”æ—¶ä¼šè°ƒç”¨objectMonitorçš„`enter`æ–¹æ³•ï¼Œè§£é”çš„æ—¶å€™ä¼šè°ƒç”¨`exit`æ–¹æ³•ã€‚äº‹å®ä¸Šï¼Œåªæœ‰åœ¨JDK1.6ä¹‹å‰ï¼Œsynchronizedçš„å®ç°æ‰ä¼šç›´æ¥è°ƒç”¨ObjectMonitorçš„`enter`å’Œ`exit`ï¼Œè¿™ç§é”è¢«ç§°ä¹‹ä¸ºé‡é‡çº§é”ã€‚

æ‰€ä»¥ï¼Œåœ¨JDK1.6ä¸­å‡ºç°å¯¹é”è¿›è¡Œäº†å¾ˆå¤šçš„ä¼˜åŒ–ï¼Œè¿›è€Œå‡ºç°è½»é‡çº§é”ï¼Œåå‘é”ï¼Œé”æ¶ˆé™¤ï¼Œé€‚åº”æ€§è‡ªæ—‹é”ï¼Œé”ç²—åŒ–(è‡ªæ—‹é”åœ¨1.4å°±æœ‰ï¼Œåªä¸è¿‡é»˜è®¤çš„æ˜¯å…³é—­çš„ï¼Œjdk1.6æ˜¯é»˜è®¤å¼€å¯çš„)ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ä¸ºäº†åœ¨çº¿ç¨‹ä¹‹é—´æ›´é«˜æ•ˆçš„å…±äº«æ•°æ® ï¼Œè§£å†³ç«äº‰é—®é¢˜ã€‚

å…³äºè‡ªæ—‹é”ã€é”ç²—åŒ–å’Œé”æ¶ˆé™¤å¯ä»¥å‚è€ƒ[æ·±å…¥ç†è§£å¤šçº¿ç¨‹ï¼ˆäº”ï¼‰â€”â€” Javaè™šæ‹Ÿæœºçš„é”ä¼˜åŒ–æŠ€æœ¯](https://www.jianshu.com/p/3a6fd02471df)
## 5 final

finalæ˜¯Javaä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œå®ƒæ‰€è¡¨ç¤ºçš„æ˜¯â€œè¿™éƒ¨åˆ†æ˜¯æ— æ³•ä¿®æ”¹çš„â€ã€‚ä½¿ç”¨finalå¯ä»¥å®šä¹‰ï¼šå˜é‡ã€æ–¹æ³•ã€ç±»ã€‚

### 5.1 finalå˜é‡

å¦‚æœå°†å˜é‡è®¾ç½®ä¸ºfinalï¼Œåˆ™ä¸èƒ½æ›´æ”¹finalå˜é‡çš„å€¼(å®ƒå°†æ˜¯å¸¸é‡)ã€‚

```dart
class Test{
     final String name = "hello";
}
```

ä¸€æ—¦finalå˜é‡è¢«å®šä¹‰ä¹‹åï¼Œæ˜¯æ— æ³•è¿›è¡Œä¿®æ”¹çš„ã€‚

### 5.2 finalæ–¹æ³•

å¦‚æœä»»ä½•æ–¹æ³•å£°æ˜ä¸ºfinalï¼Œåˆ™ä¸èƒ½è¦†ç›–å®ƒã€‚

```csharp
class Test {
    final void name() {
        System.out.println("hello");
    }
}
```

å½“æˆ‘ä»¬å®šä¹‰ä»¥ä¸Šç±»çš„å­ç±»çš„æ—¶å€™ï¼Œæ— æ³•è¦†ç›–å…¶nameæ–¹æ³•ï¼Œä¼šç¼–è¯‘å¤±è´¥ã€‚

### 5.3 finalç±»

å¦‚æœæŠŠä»»ä½•ä¸€ä¸ªç±»å£°æ˜ä¸ºfinalï¼Œåˆ™ä¸èƒ½ç»§æ‰¿å®ƒã€‚

```dart
final class Test {
    
}
```

ä»¥ä¸Šç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼

## 6 static

staticè¡¨ç¤ºâ€œé™æ€â€çš„æ„æ€ï¼Œç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å½¢æˆé™æ€staticä»£ç å—

### 6.1 é™æ€å˜é‡

æˆ‘ä»¬ç”¨staticè¡¨ç¤ºå˜é‡çš„çº§åˆ«ï¼Œä¸€ä¸ªç±»ä¸­çš„é™æ€å˜é‡ï¼Œä¸å±äºç±»çš„å¯¹è±¡æˆ–è€…å®ä¾‹ã€‚å› ä¸ºé™æ€å˜é‡ä¸æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹å…±äº«ï¼Œå› æ­¤ä»–ä»¬ä¸å…·çº¿ç¨‹å®‰å…¨æ€§ã€‚

é€šå¸¸ï¼Œé™æ€å˜é‡å¸¸ç”¨finalå…³é”®æ¥ä¿®é¥°ï¼Œè¡¨ç¤ºé€šç”¨èµ„æºæˆ–å¯ä»¥è¢«æ‰€æœ‰çš„å¯¹è±¡æ‰€ä½¿ç”¨ã€‚å¦‚æœé™æ€å˜é‡æœªè¢«ç§æœ‰åŒ–ï¼Œå¯ä»¥ç”¨â€œç±»å.å˜é‡åâ€çš„æ–¹å¼æ¥ä½¿ç”¨ã€‚

```cpp
//static variable example
private static int count;
public static String str;
```

### 6.2 é™æ€æ–¹æ³•

ä¸é™æ€å˜é‡ä¸€æ ·ï¼Œé™æ€æ–¹æ³•æ˜¯å±äºç±»è€Œä¸æ˜¯å®ä¾‹ã€‚

ä¸€ä¸ªé™æ€æ–¹æ³•åªèƒ½ä½¿ç”¨é™æ€å˜é‡å’Œè°ƒç”¨é™æ€æ–¹æ³•ã€‚é€šå¸¸é™æ€æ–¹æ³•ç”¨äºæƒ³ç»™å…¶ä»–çš„ç±»ä½¿ç”¨è€Œä¸éœ€è¦åˆ›å»ºå®ä¾‹ã€‚ä¾‹å¦‚ï¼šCollections class(ç±»é›†åˆ)ã€‚

Javaçš„åŒ…è£…ç±»å’Œå®ç”¨ç±»åŒ…å«è®¸å¤šé™æ€æ–¹æ³•ã€‚main()æ–¹æ³•å°±æ˜¯Javaç¨‹åºå…¥å£ç‚¹ï¼Œæ˜¯é™æ€æ–¹æ³•ã€‚

```cpp
//static method example
public static void setCount(int count) {
    if(count > 0)
    StaticExample.count = count;
}

//static util method
public static int addInts(int i, int...js){
    int sum=i;
    for(int x : js) sum+=x;
    return sum;
}
```

ä»Java8ä»¥ä¸Šç‰ˆæœ¬å¼€å§‹ä¹Ÿå¯ä»¥æœ‰æ¥å£ç±»å‹çš„é™æ€æ–¹æ³•äº†ã€‚

### 6.3 é™æ€ä»£ç å—

Javaçš„é™æ€å—æ˜¯ä¸€ç»„æŒ‡ä»¤åœ¨ç±»è£…è½½çš„æ—¶å€™åœ¨å†…å­˜ä¸­ç”±Java ClassLoaderæ‰§è¡Œã€‚é™æ€å—å¸¸ç”¨äºåˆå§‹åŒ–ç±»çš„é™æ€å˜é‡ã€‚å¤§å¤šæ—¶å€™è¿˜ç”¨äºåœ¨ç±»è£…è½½æ—¶å€™åˆ›å»ºé™æ€èµ„æºã€‚

Javaä¸å…è®¸åœ¨é™æ€å—ä¸­ä½¿ç”¨éé™æ€å˜é‡ã€‚ä¸€ä¸ªç±»ä¸­å¯ä»¥æœ‰å¤šä¸ªé™æ€å—ï¼Œå°½ç®¡è¿™ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚é™æ€å—åªåœ¨ç±»è£…è½½å…¥å†…å­˜æ—¶ï¼Œæ‰§è¡Œä¸€æ¬¡ã€‚

```ruby
static{
    //can be used to initialize resources when class is loaded
    System.out.println("StaticExample static block");
    //can access only static variables and methods
    str="Test";
    setCount(2);
}
```

### 6.4 é™æ€ç±»

Javaå¯ä»¥åµŒå¥—ä½¿ç”¨é™æ€ç±»ï¼Œä½†æ˜¯é™æ€ç±»ä¸èƒ½ç”¨äºåµŒå¥—çš„é¡¶å±‚ã€‚é™æ€åµŒå¥—ç±»çš„ä½¿ç”¨ä¸å…¶ä»–é¡¶å±‚ç±»ä¸€æ ·ï¼ŒåµŒå¥—åªæ˜¯ä¸ºäº†ä¾¿äºé¡¹ç›®æ‰“åŒ…ã€‚

## 7 const

constæ˜¯Javaé¢„ç•™å…³é”®å­—ï¼Œç”¨äºåæœŸæ‰©å±•ç”¨ï¼Œç”¨æ³•è·Ÿfinalç›¸ä¼¼ï¼Œä¸å¸¸ç”¨ã€‚

  