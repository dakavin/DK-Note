---
æ–‡ç« æ ‡é¢˜: "[[13_æ•°æ®ç»“æ„ä¸é›†åˆæºç ]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æ–‡ç« å…¨é¢æ¦‚è¿°äº†æ•°æ®ç»“æ„ï¼ˆæ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€æ ‘ã€å“ˆå¸Œè¡¨ï¼‰åŠJavaé›†åˆæ¡†æ¶ã€‚é€šè¿‡ArrayListã€LinkedListã€HashMapç­‰æ ¸å¿ƒAPIçš„æºç åˆ†æï¼Œè¯¦ç»†é˜è¿°äº†å…¶å†…éƒ¨å®ç°åŸç†ã€å“ˆå¸Œå†²çªã€çº¢é»‘æ ‘æœºåˆ¶åŠä¸åŒJDKç‰ˆæœ¬å·®å¼‚ï¼Œæ—¨åœ¨åŠ æ·±å¯¹Javaé›†åˆåº•å±‚è¿ä½œçš„ç†è§£ã€‚
æ–‡ç« æ ‡ç­¾:
- "æ•°æ®ç»“æ„"
- "Javaé›†åˆæ¡†æ¶"
- "ArrayList"
- "LinkedList"
- "HashMap"
- "çº¢é»‘æ ‘"
- "æºç åˆ†æ"
- "ç®—æ³•"
ç›¸å…³æ–‡ç« :
- "[[2_é±¼éª¨å¤´èŠç®—æ³•]]"
æ–‡ç« åˆ†ç±»: "ğŸ’» ç¼–ç¨‹è¯­è¨€"
æ–‡ç« è·¯å¾„: "02-ğŸ’» ç¼–ç¨‹è¯­è¨€/01-â˜• JavaæŠ€æœ¯æ ˆ/02-ğŸ“š åŸºç¡€è¯­æ³•/1_JavaåŸºç¡€/13_æ•°æ®ç»“æ„ä¸é›†åˆæºç .md"
æ–‡ç« éš¾åº¦: é«˜çº§ ğŸ”¥
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­â­ ç²¾é€šå¿…å¤‡
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2025-05-26 07:15:05
---

## 1 æœ¬ç« ä¸“é¢˜ä¸è„‰ç»œ

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/336ab76b2f331b0b1f5be88b1c75e747.png)

## 2 æ•°æ®ç»“æ„å‰–æ

æˆ‘ä»¬ä¸¾ä¸€ä¸ªå½¢è±¡çš„ä¾‹å­æ¥ç†è§£æ•°æ®ç»“æ„çš„ä½œç”¨ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/5f14440fe41644919d4cd5be37b6cdf0.png)


> **æˆ˜åœºï¼š** ç¨‹åºè¿è¡Œæ‰€éœ€çš„è½¯ä»¶ã€ç¡¬ä»¶ç¯å¢ƒ
>
> **æ•Œäººï¼š** é¡¹ç›®æˆ–æ¨¡å—çš„åŠŸèƒ½éœ€æ±‚
>
> **æŒ‡æŒ¥å®˜ï¼š** ç¼–å†™ç¨‹åºçš„ç¨‹åºå‘˜
>
> **å£«å…µå’Œè£…å¤‡ï¼š** ä¸€è¡Œä¸€è¡Œçš„ä»£ç 
>
> **æˆ˜æœ¯å’Œç­–ç•¥ï¼š** æ•°æ®ç»“æ„

`æ²¡æœ‰æˆ˜æœ¯ï¼Œæ‰“ä»—äº‹å€åŠŸåŠ`

`æœ‰æˆ˜æœ¯ï¼Œæ‰“ä»—äº‹åŠåŠŸå€`

æ€»ç»“ï¼šç®€å•æ¥è¯´ï¼Œæ•°æ®ç»“æ„ï¼Œå°±æ˜¯ä¸€ç§ç¨‹åºè®¾è®¡ä¼˜åŒ–çš„æ–¹æ³•è®ºï¼Œç ”ç©¶æ•°æ®çš„`é€»è¾‘ç»“æ„`å’Œ`ç‰©ç†ç»“æ„`ä»¥åŠå®ƒä»¬ä¹‹é—´ç›¸äº’å…³ç³»ï¼Œå¹¶å¯¹è¿™ç§ç»“æ„å®šä¹‰ç›¸åº”çš„`è¿ç®—`ï¼Œ**ç›®çš„æ˜¯åŠ å¿«ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ã€å‡å°‘å†…å­˜å ç”¨çš„ç©ºé—´ã€‚**

å…·ä½“ç ”ç©¶å¯¹è±¡å¦‚ä¸‹ï¼š

### 2.1 ç ”ç©¶å¯¹è±¡ä¸€ï¼šæ•°æ®é—´é€»è¾‘å…³ç³»

æ•°æ®çš„é€»è¾‘ç»“æ„æŒ‡åæ˜ æ•°æ®å…ƒç´ ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼Œè€Œä¸æ•°æ®çš„å­˜å‚¨æ— å…³ï¼Œæ˜¯ç‹¬ç«‹äºè®¡ç®—æœºçš„ã€‚

* **é›†åˆç»“æ„**ï¼šæ•°æ®ç»“æ„ä¸­çš„å…ƒç´ ä¹‹é—´é™¤äº†â€œ`åŒå±ä¸€ä¸ªé›†åˆ`â€ çš„ç›¸äº’å…³ç³»å¤–ï¼Œåˆ«æ— å…¶ä»–å…³ç³»ã€‚é›†åˆå…ƒç´ ä¹‹é—´æ²¡æœ‰é€»è¾‘å…³ç³»ã€‚
* **çº¿æ€§ç»“æ„**ï¼šæ•°æ®ç»“æ„ä¸­çš„å…ƒç´ å­˜åœ¨`ä¸€å¯¹ä¸€`çš„ç›¸äº’å…³ç³»ã€‚æ¯”å¦‚ï¼šæ’é˜Ÿã€‚ç»“æ„ä¸­å¿…é¡»å­˜åœ¨å”¯ä¸€çš„é¦–å…ƒç´ å’Œå”¯ä¸€çš„å°¾å…ƒç´ ã€‚ä½“ç°ä¸ºï¼šä¸€ç»´æ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—
* **æ ‘å½¢ç»“æ„**ï¼šæ•°æ®ç»“æ„ä¸­çš„å…ƒç´ å­˜åœ¨`ä¸€å¯¹å¤š`çš„ç›¸äº’å…³ç³»ã€‚æ¯”å¦‚ï¼šå®¶è°±ã€æ–‡ä»¶ç³»ç»Ÿã€ç»„ç»‡æ¶æ„
* **å›¾å½¢ç»“æ„**ï¼šæ•°æ®ç»“æ„ä¸­çš„å…ƒç´ å­˜åœ¨`å¤šå¯¹å¤š`çš„ç›¸äº’å…³ç³»ã€‚æ¯”å¦‚ï¼šå…¨å›½é“è·¯ç½‘ã€åœ°é“å›¾

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c671912ccaac7f489856aaff37a1548d.png)

### 2.2 ç ”ç©¶å¯¹è±¡äºŒï¼šæ•°æ®çš„å­˜å‚¨ç»“æ„ï¼ˆæˆ–ç‰©ç†ç»“æ„ï¼‰

æ•°æ®çš„ç‰©ç†ç»“æ„/å­˜å‚¨ç»“æ„ï¼šåŒ…æ‹¬`æ•°æ®å…ƒç´ çš„è¡¨ç¤º`å’Œ`å…³ç³»çš„è¡¨ç¤º`ã€‚æ•°æ®çš„å­˜å‚¨ç»“æ„æ˜¯é€»è¾‘ç»“æ„ç”¨è®¡ç®—æœºè¯­è¨€çš„å®ç°ï¼Œå®ƒä¾èµ–äºè®¡ç®—æœºè¯­è¨€ã€‚

**ç»“æ„1ï¼šé¡ºåºç»“æ„**

- é¡ºåºç»“æ„å°±æ˜¯ä½¿ç”¨ä¸€ç»„è¿ç»­çš„å­˜å‚¨å•å…ƒä¾æ¬¡å­˜å‚¨é€»è¾‘ä¸Šç›¸é‚»çš„å„ä¸ªå…ƒç´ ã€‚

- ä¼˜ç‚¹ï¼š åªéœ€è¦ç”³è¯·å­˜æ”¾æ•°æ®æœ¬èº«çš„å†…å­˜ç©ºé—´å³å¯ï¼Œæ”¯æŒä¸‹æ ‡è®¿é—®ï¼Œä¹Ÿå¯ä»¥å®ç°éšæœºè®¿é—®ã€‚
- ç¼ºç‚¹ï¼š å¿…é¡»é™æ€åˆ†é…è¿ç»­ç©ºé—´ï¼Œå†…å­˜ç©ºé—´çš„åˆ©ç”¨ç‡æ¯”è¾ƒä½ã€‚æ’å…¥æˆ–åˆ é™¤å¯èƒ½éœ€è¦ç§»åŠ¨å¤§é‡å…ƒç´ ï¼Œæ•ˆç‡æ¯”è¾ƒä½

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/67eeb10bb6eb5e93701f9da425640ec0.png)


**ç»“æ„2ï¼šé“¾å¼ç»“æ„**

- ä¸ä½¿ç”¨è¿ç»­çš„å­˜å‚¨ç©ºé—´å­˜æ”¾ç»“æ„çš„å…ƒç´ ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸€ä¸ªå…ƒç´ æ„é€ ä¸€ä¸ªèŠ‚ç‚¹ã€‚èŠ‚ç‚¹ä¸­é™¤äº†å­˜æ”¾æ•°æ®æœ¬èº«ä»¥å¤–ï¼Œè¿˜éœ€è¦å­˜æ”¾æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚
- ä¼˜ç‚¹ï¼šä¸é‡‡ç”¨è¿ç»­çš„å­˜å‚¨ç©ºé—´å¯¼è‡´å†…å­˜ç©ºé—´åˆ©ç”¨ç‡æ¯”è¾ƒé«˜ï¼Œå…‹æœé¡ºåºå­˜å‚¨ç»“æ„ä¸­é¢„çŸ¥å…ƒç´ ä¸ªæ•°çš„ç¼ºç‚¹ã€‚æ’å…¥æˆ–åˆ é™¤å…ƒç´ æ—¶ï¼Œä¸éœ€è¦ç§»åŠ¨å¤§é‡çš„å…ƒç´ ã€‚
- ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–çš„ç©ºé—´æ¥è¡¨è¾¾æ•°æ®ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼Œä¸æ”¯æŒä¸‹æ ‡è®¿é—®å’Œéšæœºè®¿é—®ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/2284e48acc08a9881a8864442ea2f43a.png)


**ç»“æ„3ï¼šç´¢å¼•ç»“æ„**

- é™¤å»ºç«‹å­˜å‚¨èŠ‚ç‚¹ä¿¡æ¯å¤–ï¼Œè¿˜å»ºç«‹é™„åŠ çš„`ç´¢å¼•è¡¨`æ¥è®°å½•æ¯ä¸ªå…ƒç´ èŠ‚ç‚¹çš„åœ°å€ã€‚ç´¢å¼•è¡¨ç”±è‹¥å¹²ç´¢å¼•é¡¹ç»„æˆã€‚ç´¢å¼•é¡¹çš„ä¸€èˆ¬å½¢å¼æ˜¯ï¼šï¼ˆå…³é”®å­—ï¼Œåœ°å€ï¼‰ã€‚
- ä¼˜ç‚¹ï¼šç”¨èŠ‚ç‚¹çš„ç´¢å¼•å·æ¥ç¡®å®šç»“ç‚¹å­˜å‚¨åœ°å€ï¼Œæ£€ç´¢é€Ÿåº¦å¿«ã€‚
- ç¼ºç‚¹ï¼š å¢åŠ äº†é™„åŠ çš„ç´¢å¼•è¡¨ï¼Œä¼šå ç”¨è¾ƒå¤šçš„å­˜å‚¨ç©ºé—´ã€‚åœ¨å¢åŠ å’Œåˆ é™¤æ•°æ®æ—¶è¦ä¿®æ”¹ç´¢å¼•è¡¨ï¼Œå› è€Œä¼šèŠ±è´¹è¾ƒå¤šçš„æ—¶é—´ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0a69747d042fe13f43e5ed1dfd8cd338.png)


**ç»“æ„4ï¼šæ•£åˆ—ç»“æ„**

- æ ¹æ®å…ƒç´ çš„å…³é”®å­—ç›´æ¥è®¡ç®—å‡ºè¯¥å…ƒç´ çš„å­˜å‚¨åœ°å€ï¼Œåˆç§°ä¸ºHashå­˜å‚¨ã€‚
- ä¼˜ç‚¹ï¼šæ£€ç´¢ã€å¢åŠ å’Œåˆ é™¤ç»“ç‚¹çš„æ“ä½œéƒ½å¾ˆå¿«ã€‚
- ç¼ºç‚¹ï¼šä¸æ”¯æŒæ’åºï¼Œä¸€èˆ¬æ¯”ç”¨çº¿æ€§è¡¨å­˜å‚¨éœ€è¦æ›´å¤šçš„ç©ºé—´ï¼Œå¹¶ä¸”è®°å½•çš„å…³é”®å­—ä¸èƒ½é‡å¤ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/d82dc62246b5aa2d8b9f3f2d65c61f71.png)

### 2.3 ç ”ç©¶å¯¹è±¡ä¸‰ï¼šè¿ç®—ç»“æ„

æ–½åŠ åœ¨æ•°æ®ä¸Šçš„è¿ç®—åŒ…æ‹¬è¿ç®—çš„å®šä¹‰å’Œå®ç°ã€‚è¿ç®—çš„å®šä¹‰æ˜¯é’ˆå¯¹é€»è¾‘ç»“æ„çš„ï¼ŒæŒ‡å‡ºè¿ç®—çš„åŠŸèƒ½ï¼›è¿ç®—çš„å®ç°æ˜¯é’ˆå¯¹å­˜å‚¨ç»“æ„çš„ï¼ŒæŒ‡å‡ºè¿ç®—çš„å…·ä½“æ“ä½œæ­¥éª¤ã€‚

- åˆ†é…èµ„æºï¼Œå»ºç«‹ç»“æ„ï¼Œé‡Šæ”¾èµ„æº
- æ’å…¥å’Œåˆ é™¤
- è·å–å’Œéå†
- ä¿®æ”¹å’Œæ’åº

### 2.4 å°ç»“

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/359b8c469a5ebb3df84d24fa462ee035.png)

## 3 ä¸€ç»´æ•°ç»„

### 3.1 æ•°ç»„çš„ç‰¹ç‚¹

- åœ¨Javaä¸­ï¼Œæ•°ç»„æ˜¯ç”¨æ¥å­˜æ”¾åŒä¸€ç§æ•°æ®ç±»å‹çš„é›†åˆï¼Œæ³¨æ„åªèƒ½å­˜æ”¾åŒä¸€ç§æ•°æ®ç±»å‹ã€‚

```java
//åªå£°æ˜äº†ç±»å‹å’Œé•¿åº¦
æ•°æ®ç±»å‹[]  æ•°ç»„åç§° = new æ•°æ®ç±»å‹[æ•°ç»„é•¿åº¦];

//å£°æ˜äº†ç±»å‹ï¼Œåˆå§‹åŒ–èµ‹å€¼ï¼Œå¤§å°ç”±å…ƒç´ ä¸ªæ•°å†³å®š
æ•°æ®ç±»å‹[] æ•°ç»„åç§° = {æ•°ç»„å…ƒç´ 1ï¼Œæ•°ç»„å…ƒç´ 2ï¼Œ......}
```

ä¾‹å¦‚ï¼šæ•´å‹æ•°ç»„
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/a8842febd6ea28b592056b052b3662ae.png)



ä¾‹å¦‚ï¼šå¯¹è±¡æ•°ç»„
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3414726d4135820d8b5450e3efd5bf8b.png)



- ç‰©ç†ç»“æ„ç‰¹ç‚¹ï¼š
  - ç”³è¯·å†…å­˜ï¼šä¸€æ¬¡ç”³è¯·ä¸€å¤§æ®µè¿ç»­çš„ç©ºé—´ï¼Œä¸€æ—¦ç”³è¯·åˆ°äº†ï¼Œå†…å­˜å°±å›ºå®šäº†ã€‚
  - ä¸èƒ½åŠ¨æ€æ‰©å±•(åˆå§‹åŒ–ç»™å¤§äº†ï¼Œæµªè´¹ï¼›ç»™å°äº†ï¼Œä¸å¤Ÿç”¨)ï¼Œæ’å…¥å¿«ï¼Œåˆ é™¤å’ŒæŸ¥æ‰¾æ…¢ã€‚
  - å­˜å‚¨ç‰¹ç‚¹ï¼šæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨è¿™ä¸ªè¿ç»­çš„ç©ºé—´ä¸­ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå…·ä½“çš„æ•°æ®ï¼ˆæˆ–å¯¹è±¡ï¼‰ï¼Œæ‰€æœ‰æ•°æ®éƒ½ç´§å¯†æ’å¸ƒï¼Œä¸èƒ½æœ‰é—´éš”ã€‚
- å…·ä½“çš„ï¼Œå¦‚ä¸‹å›¾ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/5c80addb6e45d8fefe2609b7c33f4b61.png)

### 3.2 è‡ªå®šä¹‰æ•°ç»„

```java
package com.atguigu01.overview.array;

/**
 * @author å°šç¡…è°·-å®‹çº¢åº·
 * @create 14:39
 */
class Array {
    private Object[] elementData;

    private int size;

    public Array(int capacity){
        elementData = new Object[capacity];
    }

    /**
     * æ·»åŠ å…ƒç´ 
     * @param value
     */
    public void add(Object value){
        if(size >= elementData.length){
            throw new RuntimeException("æ•°ç»„å·²æ»¡ï¼Œä¸å¯æ·»åŠ ");
        }
        elementData[size] = value;
        size++;
    }

    /**
     * æŸ¥è¯¢å…ƒç´ valueåœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®
     * @param value
     * @return
     */
    public int find(Object value){
        for (int i = 0; i < size; i++) {
            if(elementData[i].equals(value)){
                return i;
            }
        }
        return -1;
    }

    /**
     * ä»å½“å‰æ•°ç»„ä¸­ç§»é™¤é¦–æ¬¡å‡ºç°çš„valueå…ƒç´ 
     * @param value
     * @return
     */
    public boolean delete(Object value){
        int index = find(value);
        if(index == -1){
            return false;
        }

        for(int i = index;i < size - 1;i++){
            elementData[i] = elementData[i + 1];
        }
        elementData[size - 1] = null;
        size--;
        return true;
    }

    /**
     * å°†æ•°ç»„ä¸­é¦–æ¬¡å‡ºç°çš„oldValueæ›¿æ¢ä¸ºnewValue
     * @param oldValue
     * @param newValue
     * @return
     */
    public boolean update(Object oldValue,Object newValue){
        int index = find(oldValue);
        if(index == -1){
            return false;
        }
        elementData[index] = newValue;
        return true;

    }

    /**
     * éå†æ•°ç»„ä¸­æ‰€æœ‰æ•°æ®
     */
    public void print(){
        System.out.print("{");
        for (int i = 0; i < size; i++) {
            if(i == size - 1){
                System.out.println(elementData[i] + "}");
                break;
            }
            System.out.print(elementData[i] + ",");
        }
    }
}

//æµ‹è¯•ç±»
public class ArrayTest {
    public static void main(String[] args) {
        Array arr = new Array(10);

        arr.add(123);
        arr.add("AA");
        arr.add(345);
        arr.add(345);
        arr.add("BB");

        arr.delete(345);

        arr.update(345,444);

        arr.print();
    }
}
```

## 4 é“¾è¡¨

### 4.1 é“¾è¡¨çš„ç‰¹ç‚¹

- é€»è¾‘ç»“æ„ï¼šçº¿æ€§ç»“æ„


- ç‰©ç†ç»“æ„ï¼šä¸è¦æ±‚è¿ç»­çš„å­˜å‚¨ç©ºé—´


- å­˜å‚¨ç‰¹ç‚¹ï¼šé“¾è¡¨ç”±ä¸€ç³»åˆ—ç»“ç‚¹nodeï¼ˆé“¾è¡¨ä¸­æ¯ä¸€ä¸ªå…ƒç´ ç§°ä¸ºç»“ç‚¹ï¼‰ç»„æˆï¼Œç»“ç‚¹å¯ä»¥åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åˆ›å»ºã€‚æ¯ä¸ªç»“ç‚¹åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šä¸€ä¸ªæ˜¯å­˜å‚¨æ•°æ®å…ƒç´ çš„`æ•°æ®åŸŸ`ï¼Œå¦ä¸€ä¸ªæ˜¯å­˜å‚¨ä¸‹ä¸€ä¸ªç»“ç‚¹åœ°å€çš„`æŒ‡é’ˆåŸŸ`![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0d8e7066c782a451aa13a55251f0c917.png)


- å¸¸è§çš„é“¾è¡¨ç»“æ„æœ‰å¦‚ä¸‹çš„å½¢å¼ï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c80e28a541db241f868ebdf6eb55d8e1.png)

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/6f659e3258c5b4c039466f39a813fea5.png)


### 4.2 è‡ªå®šä¹‰é“¾è¡¨

#### 4.2.1 è‡ªå®šä¹‰å•å‘é“¾è¡¨

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/f58af34111d482cbb5155e7c212d0430.png)


```java
/*
å•é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚
èŠ‚ç‚¹æ˜¯å•å‘é“¾è¡¨ä¸­åŸºæœ¬çš„å•å…ƒã€‚
æ¯ä¸€ä¸ªèŠ‚ç‚¹Nodeéƒ½æœ‰ä¸¤ä¸ªå±æ€§ï¼š
    ä¸€ä¸ªå±æ€§ï¼šæ˜¯å­˜å‚¨çš„æ•°æ®ã€‚
    å¦ä¸€ä¸ªå±æ€§ï¼šæ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å†…å­˜åœ°å€ã€‚
 */
public class Node {

    // å­˜å‚¨çš„æ•°æ®
    Object data;

    // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å†…å­˜åœ°å€
    Node next;

    public Node(){

    }

    public Node(Object data, Node next){
        this.data = data;
        this.next = next;
    }
}

```

```java
/*
é“¾è¡¨ç±»(å•å‘é“¾è¡¨)
 */
public class Link<E> {

    // å¤´èŠ‚ç‚¹
    Node header;

    private int size = 0;

    public int size(){
        return size;
    }

    // å‘é“¾è¡¨ä¸­æ·»åŠ å…ƒç´ çš„æ–¹æ³•ï¼ˆå‘æœ«å°¾æ·»åŠ ï¼‰
    public void add(E data){
    //public void add(Object data){
        // åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å¯¹è±¡
        // è®©ä¹‹å‰å•é“¾è¡¨çš„æœ«å°¾èŠ‚ç‚¹nextæŒ‡å‘æ–°èŠ‚ç‚¹å¯¹è±¡ã€‚
        // æœ‰å¯èƒ½è¿™ä¸ªå…ƒç´ æ˜¯ç¬¬ä¸€ä¸ªï¼Œä¹Ÿå¯èƒ½æ˜¯ç¬¬äºŒä¸ªï¼Œä¹Ÿå¯èƒ½æ˜¯ç¬¬ä¸‰ä¸ªã€‚
        if(header == null){
            // è¯´æ˜è¿˜æ²¡æœ‰èŠ‚ç‚¹ã€‚
            // newä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å¯¹è±¡ï¼Œä½œä¸ºå¤´èŠ‚ç‚¹å¯¹è±¡ã€‚
            // è¿™ä¸ªæ—¶å€™çš„å¤´èŠ‚ç‚¹æ—¢æ˜¯ä¸€ä¸ªå¤´èŠ‚ç‚¹ï¼Œåˆæ˜¯ä¸€ä¸ªæœ«å°¾èŠ‚ç‚¹ã€‚
            header = new Node(data, null);
        }else {
            // è¯´æ˜å¤´ä¸æ˜¯ç©ºï¼
            // å¤´èŠ‚ç‚¹å·²ç»å­˜åœ¨äº†ï¼
            // æ‰¾å‡ºå½“å‰æœ«å°¾èŠ‚ç‚¹ï¼Œè®©å½“å‰æœ«å°¾èŠ‚ç‚¹çš„nextæ˜¯æ–°èŠ‚ç‚¹ã€‚
            Node currentLastNode = findLast(header);
            currentLastNode.next = new Node(data, null);
        }
        size++;
    }

    /**
     * ä¸“é—¨æŸ¥æ‰¾æœ«å°¾èŠ‚ç‚¹çš„æ–¹æ³•ã€‚
     */
    private Node findLast(Node node) {
        if(node.next == null) {
            // å¦‚æœä¸€ä¸ªèŠ‚ç‚¹çš„nextæ˜¯null
            // è¯´æ˜è¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯æœ«å°¾èŠ‚ç‚¹ã€‚
            return node;
        }
        // ç¨‹åºèƒ½å¤Ÿåˆ°è¿™é‡Œè¯´æ˜ï¼šnodeä¸æ˜¯æœ«å°¾èŠ‚ç‚¹ã€‚
        return findLast(node.next); // é€’å½’ç®—æ³•ï¼
    }

    /*// åˆ é™¤é“¾è¡¨ä¸­æŸä¸ªæ•°æ®çš„æ–¹æ³•
    public void remove(Object obj){
        //ç•¥
    }

    // ä¿®æ”¹é“¾è¡¨ä¸­æŸä¸ªæ•°æ®çš„æ–¹æ³•
    public void modify(Object newObj){
        //ç•¥
    }

    // æŸ¥æ‰¾é“¾è¡¨ä¸­æŸä¸ªå…ƒç´ çš„æ–¹æ³•ã€‚
    public int find(Object obj){
        //ç•¥
    }*/
}
```

#### 4.2.2 è‡ªå®šä¹‰åŒå‘é“¾è¡¨

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0d6194f03133fd8761e54444bd6fe6d7.png)


```java
/*
åŒå‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚
 */
public class Node<E> {
    Node prev;
    E data;
    Node next;

    Node(Node prev, E data, Node next) {
        this.prev = prev;
        this.data = data;
        this.next = next;
    }
}
```

```java
/**
 * é“¾è¡¨ç±»(åŒå‘é“¾è¡¨)
 * @author å°šç¡…è°·-å®‹çº¢åº·
 * @create 15:05
 */
public class MyLinkedList<E> implements Iterable<E>{
    private Node first;  //é“¾è¡¨çš„é¦–å…ƒç´ 
    private Node last;   //é“¾è¡¨çš„å°¾å…ƒç´ 
    private int total;

    public void add(E e){
        Node newNode = new Node(last, e, null);

        if(first == null){
            first = newNode;
        }else{
            last.next = newNode;
        }
        last = newNode;
        total++;
    }

    public int size(){
        return total;
    }

    public void delete(Object obj){
        Node find = findNode(obj);
        if(find != null){
            if(find.prev != null){
                find.prev.next = find.next;
            }else{
                first = find.next;
            }
            if(find.next != null){
                find.next.prev = find.prev;
            }else{
                last = find.prev;
            }

            find.prev = null;
            find.next = null;
            find.data = null;

            total--;
        }
    }

    private Node findNode(Object obj){
        Node node = first;
        Node find = null;

        if(obj == null){
            while(node != null){
                if(node.data == null){
                    find = node;
                    break;
                }
                node = node.next;
            }
        }else{
            while(node != null){
                if(obj.equals(node.data)){
                    find = node;
                    break;
                }
                node = node.next;
            }
        }
        return find;
    }

    public boolean contains(Object obj){
        return findNode(obj) != null;
    }

    public void update(E old, E value){
        Node find = findNode(old);
        if(find != null){
            find.data = value;
        }
    }

    @Override
    public Iterator<E> iterator() {
        return new Itr();
    }

    private class Itr implements Iterator<E>{
        private Node<E> node = first;

        @Override
        public boolean hasNext() {
            return node!=null;
        }

        @Override
        public E next() {
            E value = node.data;
            node = node.next;
            return value;
        }
    }
}
```

è‡ªå®šä¹‰åŒé“¾è¡¨æµ‹è¯•ï¼š

```java
package com.atguigu.list;

public class MyLinkedListTest {
    public static void main(String[] args) {
        MyLinkedList<String> my = new MyLinkedList<>();
        my.add("hello");
        my.add("world");
        my.add(null);
        my.add(null);
        my.add("java");
        my.add("java");
        my.add("atguigu");

        System.out.println("ä¸€å…±æœ‰ï¼š" + my.size());
        System.out.println("æ‰€æœ‰å…ƒç´ ï¼š");
        for (String s : my) {
            System.out.println(s);
        }
        System.out.println("-------------------------------------");
        System.out.println("æŸ¥æ‰¾java,null,hahaçš„ç»“æœï¼š");
        System.out.println(my.contains("java"));
        System.out.println(my.contains(null));
        System.out.println(my.contains("haha"));

        System.out.println("-------------------------------------");
        System.out.println("æ›¿æ¢java,nullåï¼š");
        my.update("java","JAVA");
        my.update(null,"songhk");
        System.out.println("æ‰€æœ‰å…ƒç´ ï¼š");
        for (String s : my) {
            System.out.println(s);
        }
        System.out.println("-------------------------------------");
        System.out.println("åˆ é™¤helloï¼ŒJAVA,nullï¼Œatguiguåï¼š");
        my.delete("hello");
        my.delete("JAVA");
        my.delete(null);
        my.delete("atguigu");
        System.out.println("æ‰€æœ‰å…ƒç´ ï¼š");
        for (String s : my) {
            System.out.println(s);
        }
    }
}
```

## 5 æ ˆ

### 5.1 æ ˆçš„ç‰¹ç‚¹

- æ ˆï¼ˆStackï¼‰åˆç§°ä¸ºå †æ ˆæˆ–å †å ï¼Œæ˜¯é™åˆ¶ä»…åœ¨è¡¨çš„ä¸€ç«¯è¿›è¡Œæ’å…¥å’Œåˆ é™¤è¿ç®—çš„çº¿æ€§è¡¨ã€‚

- æ ˆæŒ‰ç…§`å…ˆè¿›åå‡º(FILO,first in last out)`çš„åŸåˆ™å­˜å‚¨æ•°æ®ï¼Œå…ˆè¿›å…¥çš„æ•°æ®è¢«å‹å…¥æ ˆåº•ï¼Œæœ€åçš„æ•°æ®åœ¨æ ˆé¡¶ã€‚æ¯æ¬¡åˆ é™¤ï¼ˆé€€æ ˆï¼‰çš„æ€»æ˜¯åˆ é™¤å½“å‰æ ˆä¸­æœ€åæ’å…¥ï¼ˆè¿›æ ˆï¼‰çš„å…ƒç´ ï¼Œè€Œæœ€å…ˆæ’å…¥çš„æ˜¯è¢«æ”¾åœ¨æ ˆçš„åº•éƒ¨ï¼Œè¦åˆ°æœ€åæ‰èƒ½åˆ é™¤ã€‚

- æ ¸å¿ƒç±»åº“ä¸­çš„æ ˆç»“æ„æœ‰Stackå’ŒLinkedListã€‚
  - Stackå°±æ˜¯é¡ºåºæ ˆï¼Œå®ƒæ˜¯Vectorçš„å­ç±»ã€‚
  - LinkedListæ˜¯é“¾å¼æ ˆã€‚
  
- ä½“ç°æ ˆç»“æ„çš„æ“ä½œæ–¹æ³•ï¼š

   *  peek()æ–¹æ³•ï¼šæŸ¥çœ‹æ ˆé¡¶å…ƒç´ ï¼Œä¸å¼¹å‡º
   *  pop()æ–¹æ³•ï¼šå¼¹å‡ºæ ˆ
   *  push(E e)æ–¹æ³•ï¼šå‹å…¥æ ˆ 
   
- æ—¶é—´å¤æ‚åº¦:
  - ç´¢å¼•: `O(n)`
  - æœç´¢: `O(n)`
  - æ’å…¥: `O(1)`
  - ç§»é™¤: `O(1)`
  
- å›¾ç¤ºï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/021c59f9f334ccc4fa3416021df3ad96.png)

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7542f308f90ba0fd3471e84462477184.png)


### 5.2 Stackä½¿ç”¨ä¸¾ä¾‹

```java
/**
 * @author å°šç¡…è°·-å®‹çº¢åº·
 * @create 15:44
 */
public class TestStack {
    /*
    * æµ‹è¯•Stack
    * */
    @Test
    public void test1(){
        Stack<Integer> list = new Stack<>();
        list.push(1);
        list.push(2);
        list.push(3);

        System.out.println("list = " + list);

        System.out.println("list.peek()=" + list.peek());
        System.out.println("list.peek()=" + list.peek());
        System.out.println("list.peek()=" + list.peek());

/*
		System.out.println("list.pop() =" + list.pop());
		System.out.println("list.pop() =" + list.pop());
		System.out.println("list.pop() =" + list.pop());
		System.out.println("list.pop() =" + list.pop());//java.util.NoSuchElementException
*/

        while(!list.empty()){
            System.out.println("list.pop() =" + list.pop());
        }
    }

    /*
    * æµ‹è¯•LinkedList
    * */
    @Test
    public void test2(){
        LinkedList<Integer> list = new LinkedList<>();
        list.push(1);
        list.push(2);
        list.push(3);

        System.out.println("list = " + list);

        System.out.println("list.peek()=" + list.peek());
        System.out.println("list.peek()=" + list.peek());
        System.out.println("list.peek()=" + list.peek());

/*
		System.out.println("list.pop() =" + list.pop());
		System.out.println("list.pop() =" + list.pop());
		System.out.println("list.pop() =" + list.pop());
		System.out.println("list.pop() =" + list.pop());//java.util.NoSuchElementException
*/
        while(!list.isEmpty()){
            System.out.println("list.pop() =" + list.pop());
        }
    }
}
```

### 5.3 è‡ªå®šä¹‰æ ˆ

```java
public class MyStack {
    // å‘æ ˆå½“ä¸­å­˜å‚¨å…ƒç´ ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨ä¸€ç»´æ•°ç»„æ¨¡æ‹Ÿã€‚å­˜åˆ°æ ˆä¸­ï¼Œå°±è¡¨ç¤ºå­˜å‚¨åˆ°æ•°ç»„ä¸­ã€‚
    // ä¸ºä»€ä¹ˆé€‰æ‹©Objectç±»å‹æ•°ç»„ï¼Ÿå› ä¸ºè¿™ä¸ªæ ˆå¯ä»¥å­˜å‚¨javaä¸­çš„ä»»ä½•å¼•ç”¨ç±»å‹çš„æ•°æ®
    private Object[] elements;

    // æ ˆå¸§ï¼Œæ°¸è¿œæŒ‡å‘æ ˆé¡¶éƒ¨å…ƒç´ 
    // é‚£ä¹ˆè¿™ä¸ªé»˜è®¤åˆå§‹å€¼åº”è¯¥æ˜¯å¤šå°‘ã€‚æ³¨æ„ï¼šæœ€åˆçš„æ ˆæ˜¯ç©ºçš„ï¼Œä¸€ä¸ªå…ƒç´ éƒ½æ²¡æœ‰ã€‚
    //private int index = 0; // å¦‚æœindexé‡‡ç”¨0ï¼Œè¡¨ç¤ºæ ˆå¸§æŒ‡å‘äº†é¡¶éƒ¨å…ƒç´ çš„ä¸Šæ–¹ã€‚
    //private int index = -1; // å¦‚æœindexé‡‡ç”¨-1ï¼Œè¡¨ç¤ºæ ˆå¸§æŒ‡å‘äº†é¡¶éƒ¨å…ƒç´ ã€‚
    private int index;

    /**
     * æ— å‚æ•°æ„é€ æ–¹æ³•ã€‚é»˜è®¤åˆå§‹åŒ–æ ˆå®¹é‡10.
     */
    public MyStack() {
        // ä¸€ç»´æ•°ç»„åŠ¨æ€åˆå§‹åŒ–
        // é»˜è®¤åˆå§‹åŒ–å®¹é‡æ˜¯10.
        this.elements = new Object[10];
        // ç»™indexåˆå§‹åŒ–
        this.index = -1;
    }

    /**
     * å‹æ ˆçš„æ–¹æ³•
     * @param obj è¢«å‹å…¥çš„å…ƒç´ 
     */
    public void push(Object obj) throws Exception {
        if(index >= elements.length - 1){
            //æ–¹å¼1ï¼š
            //System.out.println("å‹æ ˆå¤±è´¥ï¼Œæ ˆå·²æ»¡ï¼");
            //return;
            //æ–¹å¼2ï¼š
            throw new Exception("å‹æ ˆå¤±è´¥ï¼Œæ ˆå·²æ»¡ï¼");
        }
        // ç¨‹åºèƒ½å¤Ÿèµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜æ ˆæ²¡æ»¡
        // å‘æ ˆä¸­åŠ 1ä¸ªå…ƒç´ ï¼Œæ ˆå¸§å‘ä¸Šç§»åŠ¨ä¸€ä¸ªä½ç½®ã€‚
        index++;
        elements[index] = obj;
        System.out.println("å‹æ ˆ" + obj + "å…ƒç´ æˆåŠŸï¼Œæ ˆå¸§æŒ‡å‘" + index);
    }

    /**
     * å¼¹æ ˆçš„æ–¹æ³•ï¼Œä»æ•°ç»„ä¸­å¾€å¤–å–å…ƒç´ ã€‚æ¯å–å‡ºä¸€ä¸ªå…ƒç´ ï¼Œæ ˆå¸§å‘ä¸‹ç§»åŠ¨ä¸€ä½ã€‚
     * @return
     */
    public Object pop() throws Exception {
        if (index < 0) {
            //æ–¹å¼1ï¼š
            //System.out.println("å¼¹æ ˆå¤±è´¥ï¼Œæ ˆå·²ç©ºï¼");
            //return;
            //æ–¹å¼2ï¼š
            throw new Exception("å¼¹æ ˆå¤±è´¥ï¼Œæ ˆå·²ç©ºï¼");
        }
        // ç¨‹åºèƒ½å¤Ÿæ‰§è¡Œåˆ°æ­¤å¤„è¯´æ˜æ ˆæ²¡æœ‰ç©ºã€‚
        Object obj = elements[index];
        System.out.print("å¼¹æ ˆ" + obj + "å…ƒç´ æˆåŠŸï¼Œ");
        elements[index] = null;
        // æ ˆå¸§å‘ä¸‹ç§»åŠ¨ä¸€ä½ã€‚
        index--;
        return obj;
    }

    // setå’Œgetä¹Ÿè®¸ç”¨ä¸ä¸Šï¼Œä½†æ˜¯ä½ å¿…é¡»å†™ä¸Šï¼Œè¿™æ˜¯è§„çŸ©ã€‚ä½ ä½¿ç”¨IDEAç”Ÿæˆå°±è¡Œäº†ã€‚
    // å°è£…ï¼šç¬¬ä¸€æ­¥ï¼šå±æ€§ç§æœ‰åŒ–ï¼Œç¬¬äºŒæ­¥ï¼šå¯¹å¤–æä¾›setå’Œgetæ–¹æ³•ã€‚
    public Object[] getElements() {
        return elements;
    }

    public void setElements(Object[] elements) {
        this.elements = elements;
    }

    public int getIndex() {
        return index;
    }

    public void setIndex(int index) {
        this.index = index;
    }
}

```

## 6 é˜Ÿåˆ—

- é˜Ÿåˆ—ï¼ˆQueueï¼‰æ˜¯åªå…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥ï¼Œè€Œåœ¨å¦ä¸€ç«¯è¿›è¡Œåˆ é™¤çš„è¿ç®—å—é™çš„çº¿æ€§è¡¨ã€‚


- é˜Ÿåˆ—æ˜¯é€»è¾‘ç»“æ„ï¼Œå…¶ç‰©ç†ç»“æ„å¯ä»¥æ˜¯æ•°ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯é“¾è¡¨ã€‚


- é˜Ÿåˆ—çš„ä¿®æ”¹åŸåˆ™ï¼šé˜Ÿåˆ—çš„ä¿®æ”¹æ˜¯ä¾`å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŸåˆ™`è¿›è¡Œçš„ã€‚æ–°æ¥çš„æˆå‘˜æ€»æ˜¯åŠ å…¥é˜Ÿå°¾ï¼ˆå³ä¸å…è®¸"åŠ å¡"ï¼‰ï¼Œæ¯æ¬¡ç¦»å¼€çš„æˆå‘˜æ€»æ˜¯é˜Ÿåˆ—å¤´ä¸Šçš„ï¼ˆä¸å…è®¸ä¸­é€”ç¦»é˜Ÿï¼‰ï¼Œå³å½“å‰"æœ€è€çš„"æˆå‘˜ç¦»é˜Ÿã€‚

- å›¾ç¤ºï¼š
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/93d7c8e3c824df539021fe8fdea62e0e.png)


![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/449282114db9601182798893c0cef339.png)

## 7 æ ‘ä¸äºŒå‰æ ‘

### 7.1 æ ‘çš„ç†è§£

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/99ed85edd11a0e09251a592f569379f2.png)


**ä¸“æœ‰åè¯è§£é‡Šï¼š**

`ç»“ç‚¹`ï¼šæ ‘ä¸­çš„æ•°æ®å…ƒç´ éƒ½ç§°ä¹‹ä¸ºç»“ç‚¹

`æ ¹èŠ‚ç‚¹`ï¼šæœ€ä¸Šé¢çš„ç»“ç‚¹ç§°ä¹‹ä¸ºæ ¹ï¼Œä¸€é¢—æ ‘åªæœ‰ä¸€ä¸ªæ ¹ä¸”ç”±æ ¹å‘å±•è€Œæ¥ï¼Œä»å¦å¤–ä¸€ä¸ªè§’åº¦æ¥è¯´ï¼Œæ¯ä¸ªç»“ç‚¹éƒ½å¯ä»¥è®¤ä¸ºæ˜¯å…¶å­æ ‘çš„æ ¹

`çˆ¶èŠ‚ç‚¹`ï¼šç»“ç‚¹çš„ä¸Šå±‚ç»“ç‚¹ï¼Œå¦‚å›¾ä¸­ï¼Œç»“ç‚¹Kçš„çˆ¶èŠ‚ç‚¹æ˜¯Eã€ç»“ç‚¹Lçš„çˆ¶èŠ‚ç‚¹æ˜¯G

`å­èŠ‚ç‚¹`ï¼šèŠ‚ç‚¹çš„ä¸‹å±‚ç»“ç‚¹ï¼Œå¦‚å›¾ä¸­ï¼ŒèŠ‚ç‚¹Eçš„å­èŠ‚ç‚¹æ˜¯KèŠ‚ç‚¹ã€èŠ‚ç‚¹Gçš„å­èŠ‚ç‚¹æ˜¯LèŠ‚ç‚¹

`å…„å¼ŸèŠ‚ç‚¹`ï¼šå…·æœ‰ç›¸åŒçˆ¶èŠ‚ç‚¹çš„ç»“ç‚¹ç§°ä¸ºå…„å¼ŸèŠ‚ç‚¹ï¼Œå›¾ä¸­Fã€Gã€Häº’ä¸ºå…„å¼ŸèŠ‚ç‚¹

`ç»“ç‚¹çš„åº¦æ•°`ï¼šæ¯ä¸ªç»“ç‚¹æ‰€æ‹¥æœ‰çš„å­æ ‘çš„ä¸ªæ•°ç§°ä¹‹ä¸ºç»“ç‚¹çš„åº¦ï¼Œå¦‚ç»“ç‚¹Bçš„åº¦ä¸º3

`æ ‘å¶`ï¼šåº¦æ•°ä¸º0çš„ç»“ç‚¹ï¼Œä¹Ÿå«ä½œç»ˆç«¯ç»“ç‚¹ï¼Œå›¾ä¸­Dã€Kã€Fã€Lã€Hã€Iã€Jéƒ½æ˜¯æ ‘å¶

`éç»ˆç«¯èŠ‚ç‚¹ï¼ˆæˆ–åˆ†æ”¯èŠ‚ç‚¹ï¼‰`ï¼šæ ‘å¶ä»¥å¤–çš„èŠ‚ç‚¹ï¼Œæˆ–åº¦æ•°ä¸ä¸º0çš„èŠ‚ç‚¹ã€‚å›¾ä¸­æ ¹ã€Aã€Bã€Cã€Eã€Géƒ½æ˜¯

`æ ‘çš„æ·±åº¦ï¼ˆæˆ–é«˜åº¦ï¼‰`ï¼šæ ‘ä¸­ç»“ç‚¹çš„æœ€å¤§å±‚æ¬¡æ•°ï¼Œå›¾ä¸­æ ‘çš„æ·±åº¦ä¸º4

`ç»“ç‚¹çš„å±‚æ•°`ï¼šä»æ ¹èŠ‚ç‚¹åˆ°æ ‘ä¸­æŸç»“ç‚¹æ‰€ç»è·¯å¾„ä¸Šçš„åˆ†æ”¯æ ‘ç§°ä¸ºè¯¥ç»“ç‚¹çš„å±‚æ•°ï¼Œæ ¹èŠ‚ç‚¹çš„å±‚æ•°è§„å®šä¸º1ï¼Œå…¶ä½™ç»“ç‚¹çš„å±‚æ•°ç­‰äºå…¶çˆ¶äº²ç»“ç‚¹çš„å±‚æ•°+1

`åŒä»£`ï¼šåœ¨åŒä¸€æ£µæ ‘ä¸­å…·æœ‰ç›¸åŒå±‚æ•°çš„èŠ‚ç‚¹

### 7.2 äºŒå‰æ ‘çš„åŸºæœ¬æ¦‚å¿µ

äºŒå‰æ ‘ï¼ˆBinary treeï¼‰æ˜¯æ ‘å½¢ç»“æ„çš„ä¸€ä¸ªé‡è¦ç±»å‹ã€‚äºŒå‰æ ‘ç‰¹ç‚¹æ˜¯æ¯ä¸ªç»“ç‚¹æœ€å¤šåªèƒ½æœ‰ä¸¤æ£µå­æ ‘ï¼Œä¸”æœ‰å·¦å³ä¹‹åˆ†ã€‚è®¸å¤šå®é™…é—®é¢˜æŠ½è±¡å‡ºæ¥çš„æ•°æ®ç»“æ„å¾€å¾€æ˜¯äºŒå‰æ ‘å½¢å¼ï¼ŒäºŒå‰æ ‘çš„å­˜å‚¨ç»“æ„åŠå…¶ç®—æ³•éƒ½è¾ƒä¸ºç®€å•ï¼Œå› æ­¤äºŒå‰æ ‘æ˜¾å¾—ç‰¹åˆ«é‡è¦ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/98f852b9438b5b23d5d64a0cf43f0524.png)

### 7.3 äºŒå‰æ ‘çš„éå†

* **å‰åºéå†ï¼šä¸­å·¦å³ï¼ˆæ ¹å·¦å³ï¼‰**

  å³å…ˆè®¿é—®æ ¹ç»“ç‚¹ï¼Œå†å‰åºéå†å·¦å­æ ‘ï¼Œæœ€åå†å‰åºéå†å³å­ æ ‘ã€‚å‰åºéå†è¿ç®—è®¿é—®äºŒå‰æ ‘å„ç»“ç‚¹æ˜¯ä»¥æ ¹ã€å·¦ã€å³çš„é¡ºåºè¿›è¡Œè®¿é—®çš„ã€‚

* **ä¸­åºéå†ï¼šå·¦ä¸­å³ï¼ˆå·¦æ ¹å³ï¼‰**

  å³å…ˆä¸­å‰åºéå†å·¦å­æ ‘ï¼Œç„¶åå†è®¿é—®æ ¹ç»“ç‚¹ï¼Œæœ€åå†ä¸­åºé å†å³å­æ ‘ã€‚ä¸­åºéå†è¿ç®—è®¿é—®äºŒå‰æ ‘å„ç»“ç‚¹æ˜¯ä»¥å·¦ã€æ ¹ã€å³çš„é¡ºåºè¿›è¡Œè®¿é—®çš„ã€‚

* **ååºéå†ï¼šå·¦å³ä¸­ï¼ˆå·¦å³æ ¹ï¼‰**

  å³å…ˆååºéå†å·¦å­æ ‘ï¼Œç„¶åå†ååºéå†å³å­æ ‘ï¼Œæœ€åè®¿é—®æ ¹ ç»“ç‚¹ã€‚ååºéå†è¿ç®—è®¿é—®äºŒå‰æ ‘å„ç»“ç‚¹æ˜¯ä»¥å·¦ã€å³ã€æ ¹çš„é¡ºåºè¿›è¡Œè®¿é—®çš„ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0626c815f1d16674ee211a0bf20f3ae1.png)


å‰åºéå†ï¼šABDHIECFG

ä¸­åºéå†ï¼šHDIBEAFCG

ååºéå†ï¼šHIDEBFGCA

### 7.4 ç»å…¸äºŒå‰æ ‘

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/53582a0a1be80736ea9ff38dbf3b91a5.png)


1ã€`æ»¡äºŒå‰æ ‘`ï¼š é™¤æœ€åä¸€å±‚æ— ä»»ä½•å­èŠ‚ç‚¹å¤–ï¼Œæ¯ä¸€å±‚ä¸Šçš„æ‰€æœ‰ç»“ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­ç»“ç‚¹çš„äºŒå‰æ ‘ã€‚ ç¬¬nå±‚çš„ç»“ç‚¹æ•°æ˜¯2çš„n-1æ¬¡æ–¹ï¼Œæ€»çš„ç»“ç‚¹ä¸ªæ•°æ˜¯2çš„næ¬¡æ–¹-1
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0e36a9e89c3890a8f73a07e49cc72add.png)


2ã€`å®Œå…¨äºŒå‰æ ‘`ï¼š å¶ç»“ç‚¹åªèƒ½å‡ºç°åœ¨æœ€åº•å±‚çš„ä¸¤å±‚ï¼Œä¸”æœ€åº•å±‚å¶ç»“ç‚¹å‡å¤„äºæ¬¡åº•å±‚å¶ç»“ç‚¹çš„å·¦ä¾§ã€‚
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/03e7189f9907c01196cc8de59f50503d.png)


3ã€`äºŒå‰æ’åº/æŸ¥æ‰¾/æœç´¢æ ‘`ï¼šå³ä¸ºBST  (binary search/sort tree)ã€‚æ»¡è¶³å¦‚ä¸‹æ€§è´¨ï¼š
ï¼ˆ1ï¼‰è‹¥å®ƒçš„å·¦å­æ ‘ä¸ä¸ºç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼› 
ï¼ˆ2ï¼‰è‹¥å®ƒçš„å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼› 
ï¼ˆ3ï¼‰å®ƒçš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æ’åº/æŸ¥æ‰¾/æœç´¢æ ‘ã€‚
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/cee3a2ec5c484e9bf93f5ec77501b726.png)

> å¯¹äºŒå‰æŸ¥æ‰¾æ ‘è¿›è¡Œä¸­åºéå†ï¼Œå¾—åˆ°æœ‰åºé›†åˆã€‚ä¾¿äºæ£€ç´¢ã€‚

4ã€`å¹³è¡¡äºŒå‰æ ‘`ï¼šï¼ˆSelf-balancing binary search treeï¼ŒAVLï¼‰é¦–å…ˆæ˜¯äºŒå‰æ’åºæ ‘ï¼Œæ­¤å¤–å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š
ï¼ˆ1ï¼‰å®ƒæ˜¯ä¸€æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1
ï¼ˆ2ï¼‰å¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘ä¹Ÿéƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘
ï¼ˆ3ï¼‰ä¸è¦æ±‚éå¶èŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­ç»“ç‚¹ 

> å¹³è¡¡äºŒå‰æ ‘çš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘äºŒå‰æŸ¥æ‰¾æ ‘çš„å±‚æ¬¡ï¼Œæé«˜æŸ¥æ‰¾é€Ÿåº¦ã€‚å¹³è¡¡äºŒå‰æ ‘çš„å¸¸ç”¨å®ç°æœ‰çº¢é»‘æ ‘ã€AVLã€æ›¿ç½ªç¾Šæ ‘ã€Treapã€ä¼¸å±•æ ‘ç­‰ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/974e266468a01b5a62f9d42768a8504e.png)


6ã€`çº¢é»‘æ ‘`ï¼šå³Red-Black Treeã€‚çº¢é»‘æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰å­˜å‚¨ä½è¡¨ç¤ºèŠ‚ç‚¹çš„é¢œè‰²ï¼Œå¯ä»¥æ˜¯çº¢(Red)æˆ–é»‘(Black)ã€‚ 

çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ˜¯åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ç”¨åˆ°çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯åœ¨ 1972 å¹´ç”± Rudolf Bayer å‘æ˜çš„ã€‚çº¢é»‘æ ‘æ˜¯å¤æ‚çš„ï¼Œä½†å®ƒçš„æ“ä½œæœ‰ç€`è‰¯å¥½çš„æœ€åæƒ…å†µè¿è¡Œæ—¶é—´`ï¼Œå¹¶ä¸”åœ¨`å®è·µä¸­æ˜¯é«˜æ•ˆçš„`ï¼šå®ƒå¯ä»¥åœ¨ O(log n)æ—¶é—´å†…åšæŸ¥æ‰¾ï¼Œæ’å…¥å’Œåˆ é™¤ï¼Œ è¿™é‡Œçš„ n æ˜¯æ ‘ä¸­å…ƒç´ çš„æ•°ç›®ã€‚

çº¢é»‘æ ‘çš„ç‰¹æ€§ï¼š

- æ¯ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–è€…é»‘è‰²
- æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²

- æ¯ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆNILï¼‰æ˜¯é»‘è‰²ã€‚ï¼ˆæ³¨æ„ï¼šè¿™é‡Œå¶å­èŠ‚ç‚¹ï¼Œæ˜¯æŒ‡ä¸ºç©º(NILæˆ–NULL)çš„å¶å­èŠ‚ç‚¹ï¼‰

- æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ã€‚(ä»æ¯ä¸ªå¶å­åˆ°æ ¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹) 

- ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ï¼ˆç¡®ä¿æ²¡æœ‰ä¸€æ¡è·¯å¾„ä¼šæ¯”å…¶ä»–è·¯å¾„é•¿å‡º2å€ï¼‰
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/33864aebb28c69b24b8d2f16d0d6e421.png)


å½“æˆ‘ä»¬æ’å…¥æˆ–åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œå¯èƒ½ä¼šç ´åå·²æœ‰çš„çº¢é»‘æ ‘ï¼Œä½¿å¾—å®ƒä¸æ»¡è¶³ä»¥ä¸Š5ä¸ªè¦æ±‚ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦è¿›è¡Œå¤„ç†ï¼Œä½¿å¾—å®ƒç»§ç»­æ»¡è¶³ä»¥ä¸Šçš„5ä¸ªè¦æ±‚ï¼š

1ã€`recolor` ï¼šå°†æŸä¸ªèŠ‚ç‚¹å˜çº¢æˆ–å˜é»‘

2ã€`rotation` ï¼šå°†çº¢é»‘æ ‘æŸäº›ç»“ç‚¹åˆ†æ”¯è¿›è¡Œæ—‹è½¬ï¼ˆå·¦æ—‹æˆ–å³æ—‹ï¼‰
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8e37b85b9849c060401be2f8d61ad5f7.png)

> çº¢é»‘æ ‘å¯ä»¥é€šè¿‡çº¢è‰²èŠ‚ç‚¹å’Œé»‘è‰²èŠ‚ç‚¹å°½å¯èƒ½çš„ä¿è¯äºŒå‰æ ‘çš„å¹³è¡¡ã€‚ä¸»è¦æ˜¯ç”¨å®ƒæ¥å­˜å‚¨æœ‰åºçš„æ•°æ®ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logN)ï¼Œæ•ˆç‡éå¸¸ä¹‹é«˜ã€‚
>

### 7.5 äºŒå‰æ ‘åŠå…¶ç»“ç‚¹çš„è¡¨ç¤º

æ™®é€šäºŒå‰æ ‘ï¼š

```java
public class BinaryTree<E>{
    private TreeNode root; //äºŒå‰æ ‘çš„æ ¹ç»“ç‚¹
    private int total;//ç»“ç‚¹æ€»ä¸ªæ•°
    
    private class TreeNode{
        //è‡³å°‘æœ‰ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†
        TreeNode parent;
        TreeNode left;
        E data;
        TreeNode right;
        
        public TreeNode(TreeNode parent, TreeNode left, E data, TreeNode right) {
            this.parent = parent;
            this.left = left;
            this.data = data;
            this.right = right;
        }
	}
}
```

TreeMapçº¢é»‘æ ‘ï¼š

```java
public class TreeMap<K,V> {
    private transient Entry<K,V> root;
    private transient int size = 0;
    
	static final class Entry<K,V> implements Map.Entry<K,V> {
        K key;
        V value;
        Entry<K,V> left;
        Entry<K,V> right;
        Entry<K,V> parent;
        boolean color = BLACK;

        /**
         * Make a new cell with given key, value, and parent, and with
         * {@code null} child links, and BLACK color.
         */
        Entry(K key, V value, Entry<K,V> parent) {
            this.key = key;
            this.value = value;
            this.parent = parent;
        }
    }
}
```

## 8 Listæ¥å£åˆ†æ

### 8.1 Listæ¥å£ç‰¹ç‚¹

- Listé›†åˆæ‰€æœ‰çš„å…ƒç´ æ˜¯ä»¥ä¸€ç§`çº¿æ€§æ–¹å¼`è¿›è¡Œå­˜å‚¨çš„ï¼Œä¾‹å¦‚ï¼Œå­˜å…ƒç´ çš„é¡ºåºæ˜¯11ã€22ã€33ã€‚é‚£ä¹ˆé›†åˆä¸­ï¼Œå…ƒç´ çš„å­˜å‚¨å°±æ˜¯æŒ‰ç…§11ã€22ã€33çš„é¡ºåºå®Œæˆçš„ï¼‰ã€‚
- å®ƒæ˜¯ä¸€ä¸ªå…ƒç´ `å­˜å–æœ‰åº`çš„é›†åˆã€‚å³å…ƒç´ çš„å­˜å…¥é¡ºåºå’Œå–å‡ºé¡ºåºæœ‰ä¿è¯ã€‚
- å®ƒæ˜¯ä¸€ä¸ª`å¸¦æœ‰ç´¢å¼•`çš„é›†åˆï¼Œé€šè¿‡ç´¢å¼•å°±å¯ä»¥ç²¾ç¡®çš„æ“ä½œé›†åˆä¸­çš„å…ƒç´ ï¼ˆä¸æ•°ç»„çš„ç´¢å¼•æ˜¯ä¸€ä¸ªé“ç†ï¼‰ã€‚
- é›†åˆä¸­å¯ä»¥æœ‰`é‡å¤`çš„å…ƒç´ ï¼Œé€šè¿‡å…ƒç´ çš„equalsæ–¹æ³•ï¼Œæ¥æ¯”è¾ƒæ˜¯å¦ä¸ºé‡å¤çš„å…ƒç´ ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3fc127ecbdd1520d03fb6f900f63151d.png)


> æ³¨æ„ï¼š
>
> Listé›†åˆå…³å¿ƒå…ƒç´ æ˜¯å¦æœ‰åºï¼Œè€Œä¸å…³å¿ƒæ˜¯å¦é‡å¤ï¼Œè¯·å¤§å®¶è®°ä½è¿™ä¸ªåŸåˆ™ã€‚ä¾‹å¦‚â€œå¼ ä¸‰â€å¯ä»¥é¢†å–ä¸¤ä¸ªå·ã€‚

-  Listæ¥å£çš„ä¸»è¦å®ç°ç±»
   - ArrayListï¼šåŠ¨æ€æ•°ç»„
   - Vectorï¼šåŠ¨æ€æ•°ç»„
   - LinkedListï¼šåŒå‘é“¾è¡¨
   - Stackï¼šæ ˆ

### 8.2 åŠ¨æ€æ•°ç»„ArrayListä¸Vector

Javaçš„Listæ¥å£çš„å®ç°ç±»ä¸­æœ‰ä¸¤ä¸ªåŠ¨æ€æ•°ç»„çš„å®ç°ï¼šArrayList å’Œ Vectorã€‚

#### 8.2.1 ArrayListä¸Vectorçš„åŒºåˆ«

å®ƒä»¬çš„åº•å±‚ç‰©ç†ç»“æ„éƒ½æ˜¯æ•°ç»„ï¼Œæˆ‘ä»¬ç§°ä¸ºåŠ¨æ€æ•°ç»„ã€‚

* ArrayListæ˜¯æ–°ç‰ˆçš„åŠ¨æ€æ•°ç»„ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜ï¼ŒVectoræ˜¯æ—§ç‰ˆçš„åŠ¨æ€æ•°ç»„ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½ã€‚
* åŠ¨æ€æ•°ç»„çš„æ‰©å®¹æœºåˆ¶ä¸åŒï¼ŒArrayListé»˜è®¤æ‰©å®¹ä¸ºåŸæ¥çš„1.5å€ï¼ŒVectoré»˜è®¤æ‰©å®¹å¢åŠ ä¸ºåŸæ¥çš„2å€ã€‚
* æ•°ç»„çš„åˆå§‹åŒ–å®¹é‡ï¼Œå¦‚æœåœ¨æ„å»ºArrayListä¸Vectorçš„é›†åˆå¯¹è±¡æ—¶ï¼Œæ²¡æœ‰æ˜¾å¼æŒ‡å®šåˆå§‹åŒ–å®¹é‡ï¼Œé‚£ä¹ˆVectorçš„å†…éƒ¨æ•°ç»„çš„åˆå§‹å®¹é‡é»˜è®¤ä¸º10ï¼Œè€ŒArrayListåœ¨JDK 6.0 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¹Ÿæ˜¯10ï¼ŒJDK8.0 ä¹‹åçš„ç‰ˆæœ¬ArrayListåˆå§‹åŒ–ä¸ºé•¿åº¦ä¸º0çš„ç©ºæ•°ç»„ï¼Œä¹‹ååœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå†åˆ›å»ºé•¿åº¦ä¸º10çš„æ•°ç»„ã€‚åŸå› ï¼š
  * ç”¨çš„æ—¶å€™ï¼Œå†åˆ›å»ºæ•°ç»„ï¼Œé¿å…æµªè´¹ã€‚å› ä¸ºå¾ˆå¤šæ–¹æ³•çš„è¿”å›å€¼æ˜¯ArrayListç±»å‹ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªArrayListçš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼šåæœŸä»æ•°æ®åº“æŸ¥è¯¢å¯¹è±¡çš„æ–¹æ³•ï¼Œè¿”å›å€¼å¾ˆå¤šå°±æ˜¯ArrayListã€‚æœ‰å¯èƒ½ä½ è¦æŸ¥è¯¢çš„æ•°æ®ä¸å­˜åœ¨ï¼Œè¦ä¹ˆè¿”å›nullï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªæ²¡æœ‰å…ƒç´ çš„ArrayListå¯¹è±¡ã€‚

#### 8.2.2 ArrayListéƒ¨åˆ†æºç åˆ†æ

**JDK1.7.0_07ä¸­ï¼š**

```java
//å±æ€§
private transient Object[] elementData; //å­˜å‚¨åº•å±‚æ•°ç»„å…ƒç´ 
private int size; //è®°å½•æ•°ç»„ä¸­å­˜å‚¨çš„å…ƒç´ çš„ä¸ªæ•°

//æ„é€ å™¨
public ArrayList() {
    this(10); //æŒ‡å®šåˆå§‹å®¹é‡ä¸º10
}

public ArrayList(int initialCapacity) {
    super();
    //æ£€æŸ¥åˆå§‹å®¹é‡çš„åˆæ³•æ€§
    if (initialCapacity < 0)
        throw new IllegalArgumentException("Illegal Capacity: "+ initialCapacity);
    //æ•°ç»„åˆå§‹åŒ–ä¸ºé•¿åº¦ä¸ºinitialCapacityçš„æ•°ç»„
    this.elementData = new Object[initialCapacity]; 
}

//æ–¹æ³•ï¼šadd()ç›¸å…³æ–¹æ³•
public boolean add(E e) {
    ensureCapacityInternal(size + 1);  //æŸ¥çœ‹å½“å‰æ•°ç»„æ˜¯å¦å¤Ÿå¤šå­˜ä¸€ä¸ªå…ƒç´ 
    elementData[size++] = e; //å°†å…ƒç´ eæ·»åŠ åˆ°elementDataæ•°ç»„ä¸­
    return true;
}

private void ensureCapacityInternal(int minCapacity) {
    modCount++;
    // å¦‚æœifæ¡ä»¶æ»¡è¶³ï¼Œåˆ™è¿›è¡Œæ•°ç»„çš„æ‰©å®¹
    if (minCapacity - elementData.length > 0)
        grow(minCapacity);
}

private void grow(int minCapacity) {
    // overflow-conscious code
    int oldCapacity = elementData.length; //å½“å‰æ•°ç»„å®¹é‡
    int newCapacity = oldCapacity + (oldCapacity >> 1); //æ–°æ•°ç»„å®¹é‡æ˜¯æ—§æ•°ç»„å®¹é‡çš„1.5å€
    if (newCapacity - minCapacity < 0)  //åˆ¤æ–­æ—§æ•°ç»„çš„1.5å€æ˜¯å¦å¤Ÿ
        newCapacity = minCapacity;
    //åˆ¤æ–­æ—§æ•°ç»„çš„1.5å€æ˜¯å¦è¶…è¿‡æœ€å¤§æ•°ç»„é™åˆ¶
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
    //å¤åˆ¶ä¸€ä¸ªæ–°æ•°ç»„
    elementData = Arrays.copyOf(elementData, newCapacity);
}

//æ–¹æ³•ï¼šremove()ç›¸å…³æ–¹æ³•
public E remove(int index) {
    rangeCheck(index); //åˆ¤æ–­indexæ˜¯å¦åœ¨æœ‰æ•ˆçš„èŒƒå›´å†…

    modCount++; //ä¿®æ”¹æ¬¡æ•°åŠ 1
    //å–å‡º[index]ä½ç½®çš„å…ƒç´ ï¼Œ[index]ä½ç½®çš„å…ƒç´ å°±æ˜¯è¦è¢«åˆ é™¤çš„å…ƒç´ ï¼Œç”¨äºæœ€åè¿”å›è¢«åˆ é™¤çš„å…ƒç´ 
    E oldValue = elementData(index); 

    int numMoved = size - index - 1; //ç¡®å®šè¦ç§»åŠ¨çš„æ¬¡æ•°
    //å¦‚æœéœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œå°±ç”¨System.arraycopyç§»åŠ¨å…ƒç´ 
    if (numMoved > 0)
        System.arraycopy(elementData, index+1, elementData, index, numMoved);
    //å°†elementData[size-1]ä½ç½®ç½®ç©ºï¼Œè®©GCå›æ”¶ç©ºé—´ï¼Œå…ƒç´ ä¸ªæ•°å‡å°‘
    elementData[--size] = null; 

    return oldValue;
}

private void rangeCheck(int index) {
    if (index >= size) //indexä¸åˆæ³•çš„æƒ…å†µ
        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));
}

E elementData(int index) { //è¿”å›æŒ‡å®šä½ç½®çš„å…ƒç´ 
    return (E) elementData[index];
}

//æ–¹æ³•ï¼šset()æ–¹æ³•ç›¸å…³
public E set(int index, E element) {
    rangeCheck(index); //æ£€éªŒindexæ˜¯å¦åˆæ³•
	
    //å–å‡º[index]ä½ç½®çš„å…ƒç´ ï¼Œ[index]ä½ç½®çš„å…ƒç´ å°±æ˜¯è¦è¢«æ›¿æ¢çš„å…ƒç´ ï¼Œç”¨äºæœ€åè¿”å›è¢«æ›¿æ¢çš„å…ƒç´ 
    E oldValue = elementData(index);
    //ç”¨elementæ›¿æ¢[index]ä½ç½®çš„å…ƒç´ 
    elementData[index] = element;
    return oldValue;
}

//æ–¹æ³•ï¼šget()ç›¸å…³æ–¹æ³•
public E get(int index) {
    rangeCheck(index); //æ£€éªŒindexæ˜¯å¦åˆæ³•

    return elementData(index); //è¿”å›[index]ä½ç½®çš„å…ƒç´ 
}

//æ–¹æ³•ï¼šindexOf()
public int indexOf(Object o) {
    //åˆ†ä¸ºoæ˜¯å¦ä¸ºç©ºä¸¤ç§æƒ…å†µ
    if (o == null) {
        //ä»å‰å¾€åæ‰¾
        for (int i = 0; i < size; i++)
            if (elementData[i]==null)
                return i;
    } else {
        for (int i = 0; i < size; i++)
            if (o.equals(elementData[i]))
                return i;
    }
    return -1;
}

//æ–¹æ³•ï¼šlastIndexOf()
public int lastIndexOf(Object o) {
    //åˆ†ä¸ºoæ˜¯å¦ä¸ºç©ºä¸¤ç§æƒ…å†µ
    if (o == null) {
        //ä»åå¾€å‰æ‰¾
        for (int i = size-1; i >= 0; i--)
            if (elementData[i]==null)
                return i;
    } else {
        for (int i = size-1; i >= 0; i--)
            if (o.equals(elementData[i]))
                return i;
    }
    return -1;
}
```

**jdk1.8.0_271ä¸­ï¼š**

```java
//å±æ€§
transient Object[] elementData;
private int size;
private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};

//æ„é€ å™¨
public ArrayList() {
    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;  //åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„
}

//æ–¹æ³•:add()ç›¸å…³æ–¹æ³•
public boolean add(E e) {
    //æŸ¥çœ‹å½“å‰æ•°ç»„æ˜¯å¦å¤Ÿå¤šå­˜ä¸€ä¸ªå…ƒç´ 
    ensureCapacityInternal(size + 1);  // Increments modCount!!
    //å­˜å…¥æ–°å…ƒç´ åˆ°[size]ä½ç½®ï¼Œç„¶åsizeè‡ªå¢1
    elementData[size++] = e;
    return true;
}

private void ensureCapacityInternal(int minCapacity) {
    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));
}

private static int calculateCapacity(Object[] elementData, int minCapacity) {
    //å¦‚æœå½“å‰æ•°ç»„è¿˜æ˜¯ç©ºæ•°ç»„
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        //é‚£ä¹ˆminCapacityå–DEFAULT_CAPACITYä¸minCapacityçš„æœ€å¤§å€¼
        return Math.max(DEFAULT_CAPACITY, minCapacity);
    }
    return minCapacity;
}

//æŸ¥çœ‹æ˜¯å¦éœ€è¦æ‰©å®¹
private void ensureExplicitCapacity(int minCapacity) {
    modCount++;  //ä¿®æ”¹æ¬¡æ•°åŠ 1

    //å¦‚æœéœ€è¦çš„æœ€å°å®¹é‡æ¯”å½“å‰æ•°ç»„çš„é•¿åº¦å¤§ï¼Œå³å½“å‰æ•°ç»„ä¸å¤Ÿå­˜ï¼Œå°±æ‰©å®¹
    if (minCapacity - elementData.length > 0)
        grow(minCapacity);
}

private void grow(int minCapacity) {
    // overflow-conscious code
    int oldCapacity = elementData.length; //å½“å‰æ•°ç»„å®¹é‡
    int newCapacity = oldCapacity + (oldCapacity >> 1); //æ–°æ•°ç»„å®¹é‡æ˜¯æ—§æ•°ç»„å®¹é‡çš„1.5å€
    //çœ‹æ—§æ•°ç»„çš„1.5å€æ˜¯å¦å¤Ÿ
    if (newCapacity - minCapacity < 0)
        newCapacity = minCapacity;
    //çœ‹æ—§æ•°ç»„çš„1.5å€æ˜¯å¦è¶…è¿‡æœ€å¤§æ•°ç»„é™åˆ¶
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
    //å¤åˆ¶ä¸€ä¸ªæ–°æ•°ç»„
    elementData = Arrays.copyOf(elementData, newCapacity);
}
```

#### 8.2.3 ArrayListç›¸å…³æ–¹æ³•å›¾ç¤º

- **ArrayListé‡‡ç”¨æ•°ç»„ä½œä¸ºåº•å±‚å®ç°**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b07515211e58545b0b94be79e3e16858.png)

- **ArrayListè‡ªåŠ¨æ‰©å®¹è¿‡ç¨‹**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/6bdb4fcceea014b01c2aab459f1de4bb.png)

- **ArrayListçš„add(E e)æ–¹æ³•**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0ec623a6b7282a80e80421e13c4be57f.png)

- **ArrayListçš„add(int index,E e)æ–¹æ³•**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/bd8dac2552809572dfe5e94ab4117f67.png)

#### 8.2.4 Vectoréƒ¨åˆ†æºç åˆ†æ

**jdk1.8.0_271ä¸­ï¼š**

```java
//å±æ€§
protected Object[] elementData;
protected int elementCount;

//æ„é€ å™¨
public Vector() {
	this(10); //æŒ‡å®šåˆå§‹å®¹é‡initialCapacityä¸º10
}

public Vector(int initialCapacity) {
	this(initialCapacity, 0); //æŒ‡å®šcapacityIncrementå¢é‡ä¸º0
}

public Vector(int initialCapacity, int capacityIncrement) {
    super();
    //åˆ¤æ–­äº†å½¢å‚åˆå§‹å®¹é‡initialCapacityçš„åˆæ³•æ€§
    if (initialCapacity < 0)
        throw new IllegalArgumentException("Illegal Capacity: "+ initialCapacity);
    //åˆ›å»ºäº†ä¸€ä¸ªObject[]ç±»å‹çš„æ•°ç»„
    this.elementData = new Object[initialCapacity];
    //å¢é‡ï¼Œé»˜è®¤æ˜¯0ï¼Œå¦‚æœæ˜¯0ï¼Œåé¢å°±æŒ‰ç…§2å€å¢åŠ ï¼Œå¦‚æœä¸æ˜¯0ï¼Œåé¢å°±æŒ‰ç…§ä½ æŒ‡å®šçš„å¢é‡è¿›è¡Œå¢é‡
    this.capacityIncrement = capacityIncrement;
}

//æ–¹æ³•ï¼šadd()ç›¸å…³æ–¹æ³•
//synchronizedæ„å‘³ç€çº¿ç¨‹å®‰å…¨çš„   
public synchronized boolean add(E e) {
    modCount++;
    //çœ‹æ˜¯å¦éœ€è¦æ‰©å®¹
    ensureCapacityHelper(elementCount + 1);
    //æŠŠæ–°çš„å…ƒç´ å­˜å…¥[elementCount]ï¼Œå­˜å…¥åï¼ŒelementCountå…ƒç´ çš„ä¸ªæ•°å¢1
    elementData[elementCount++] = e;
    return true;
}

private void ensureCapacityHelper(int minCapacity) {
     //çœ‹æ˜¯å¦è¶…è¿‡äº†å½“å‰æ•°ç»„çš„å®¹é‡
    if (minCapacity - elementData.length > 0)
        grow(minCapacity); //æ‰©å®¹
}

private void grow(int minCapacity) {
    // overflow-conscious code
    int oldCapacity = elementData.length; //è·å–ç›®å‰æ•°ç»„çš„é•¿åº¦
    //å¦‚æœcapacityIncrementå¢é‡æ˜¯0ï¼Œæ–°å®¹é‡ = oldCapacityçš„2å€
    //å¦‚æœcapacityIncrementå¢é‡æ˜¯ä¸æ˜¯0ï¼Œæ–°å®¹é‡ = oldCapacity + capacityIncrementå¢é‡;
    int newCapacity = oldCapacity + ((capacityIncrement > 0) ?
                                     capacityIncrement : oldCapacity);
    //å¦‚æœæŒ‰ç…§ä¸Šé¢è®¡ç®—çš„æ–°å®¹é‡è¿˜ä¸å¤Ÿï¼Œå°±æŒ‰ç…§ä½ æŒ‡å®šçš„éœ€è¦çš„æœ€å°å®¹é‡æ¥æ‰©å®¹minCapacity
    if (newCapacity - minCapacity < 0)
        newCapacity = minCapacity;
    //å¦‚æœæ–°å®¹é‡è¶…è¿‡äº†æœ€å¤§æ•°ç»„é™åˆ¶ï¼Œé‚£ä¹ˆå•ç‹¬å¤„ç†
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
    //æŠŠæ—§æ•°ç»„ä¸­çš„æ•°æ®å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ï¼Œæ–°æ•°ç»„çš„é•¿åº¦ä¸ºnewCapacity
    elementData = Arrays.copyOf(elementData, newCapacity);
}

//æ–¹æ³•ï¼šremove()ç›¸å…³æ–¹æ³•
public boolean remove(Object o) {
    return removeElement(o);
}
public synchronized boolean removeElement(Object obj) {
    modCount++;
    //æŸ¥æ‰¾objåœ¨å½“å‰Vectorä¸­çš„ä¸‹æ ‡
    int i = indexOf(obj);
    //å¦‚æœi>=0ï¼Œè¯´æ˜å­˜åœ¨ï¼Œåˆ é™¤[i]ä½ç½®çš„å…ƒç´ 
    if (i >= 0) {
        removeElementAt(i);
        return true;
    }
    return false;
}

//æ–¹æ³•ï¼šindexOf()
public int indexOf(Object o) {
    return indexOf(o, 0);
}
public synchronized int indexOf(Object o, int index) {
    if (o == null) {//è¦æŸ¥æ‰¾çš„å…ƒç´ æ˜¯nullå€¼
        for (int i = index ; i < elementCount ; i++)
            if (elementData[i]==null)//å¦‚æœæ˜¯nullå€¼ï¼Œç”¨==nullåˆ¤æ–­
                return i;
    } else {//è¦æŸ¥æ‰¾çš„å…ƒç´ æ˜¯énullå€¼
        for (int i = index ; i < elementCount ; i++)
            if (o.equals(elementData[i]))//å¦‚æœæ˜¯énullå€¼ï¼Œç”¨equalsåˆ¤æ–­
                return i;
    }
    return -1;
}

//æ–¹æ³•ï¼šremoveElementAt()
public synchronized void removeElementAt(int index) {
    modCount++;
    //åˆ¤æ–­ä¸‹æ ‡çš„åˆæ³•æ€§
    if (index >= elementCount) {
        throw new ArrayIndexOutOfBoundsException(index + " >= " +
                                                 elementCount);
    }
    else if (index < 0) {
        throw new ArrayIndexOutOfBoundsException(index);
    }

    //jæ˜¯è¦ç§»åŠ¨çš„å…ƒç´ çš„ä¸ªæ•°
    int j = elementCount - index - 1;
    //å¦‚æœéœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œå°±è°ƒç”¨System.arraycopyè¿›è¡Œç§»åŠ¨
    if (j > 0) {
        //æŠŠindex+1ä½ç½®ä»¥åŠåé¢çš„å…ƒç´ å¾€å‰ç§»åŠ¨
        //index+1çš„ä½ç½®çš„å…ƒç´ ç§»åŠ¨åˆ°indexä½ç½®ï¼Œä¾æ¬¡ç±»æ¨
        //ä¸€å…±ç§»åŠ¨jä¸ª
        System.arraycopy(elementData, index + 1, elementData, index, j);
    }
    //å…ƒç´ çš„æ€»ä¸ªæ•°å‡å°‘
    elementCount--;
    //å°†elementData[elementCount]è¿™ä¸ªä½ç½®ç½®ç©ºï¼Œç”¨æ¥æ·»åŠ æ–°å…ƒç´ ï¼Œä½ç½®çš„å…ƒç´ ç­‰ç€è¢«GCå›æ”¶
    elementData[elementCount] = null; /* to let gc do its work */
}
```

### 8.3 é“¾è¡¨LinkedList

Javaä¸­æœ‰åŒé“¾è¡¨çš„å®ç°ï¼šLinkedListï¼Œå®ƒæ˜¯Listæ¥å£çš„å®ç°ç±»ã€‚

LinkedListæ˜¯ä¸€ä¸ª`åŒå‘é“¾è¡¨`ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0d6194f03133fd8761e54444bd6fe6d7.png)
#### 8.3.1 é“¾è¡¨ä¸åŠ¨æ€æ•°ç»„çš„åŒºåˆ«

åŠ¨æ€æ•°ç»„åº•å±‚çš„ç‰©ç†ç»“æ„æ˜¯æ•°ç»„ï¼Œå› æ­¤æ ¹æ®ç´¢å¼•è®¿é—®çš„æ•ˆç‡éå¸¸é«˜ã€‚ä½†æ˜¯éæœ«å°¾ä½ç½®çš„æ’å…¥å’Œåˆ é™¤æ•ˆç‡ä¸é«˜ï¼Œå› ä¸ºæ¶‰åŠåˆ°ç§»åŠ¨å…ƒç´ ã€‚å¦å¤–æ·»åŠ æ“ä½œæ—¶æ¶‰åŠåˆ°æ‰©å®¹é—®é¢˜ï¼Œå°±ä¼šå¢åŠ æ—¶ç©ºæ¶ˆè€—ã€‚

é“¾è¡¨åº•å±‚çš„ç‰©ç†ç»“æ„æ˜¯é“¾è¡¨ï¼Œå› æ­¤æ ¹æ®ç´¢å¼•è®¿é—®çš„æ•ˆç‡ä¸é«˜ï¼Œå³æŸ¥æ‰¾å…ƒç´ æ…¢ã€‚ä½†æ˜¯æ’å…¥å’Œåˆ é™¤ä¸éœ€è¦ç§»åŠ¨å…ƒç´ ï¼Œåªéœ€è¦ä¿®æ”¹å‰åå…ƒç´ çš„æŒ‡å‘å…³ç³»å³å¯ï¼Œæ‰€ä»¥æ’å…¥ã€åˆ é™¤å…ƒç´ å¿«ã€‚è€Œä¸”é“¾è¡¨çš„æ·»åŠ ä¸ä¼šæ¶‰åŠåˆ°æ‰©å®¹é—®é¢˜ã€‚

#### 8.3.2 LinkedListæºç åˆ†æ

**jdk1.8.0_271ä¸­ï¼š**

```java
//å±æ€§
transient Node<E> first; //è®°å½•ç¬¬ä¸€ä¸ªç»“ç‚¹çš„ä½ç½®
transient Node<E> last; //è®°å½•å½“å‰é“¾è¡¨çš„å°¾å…ƒç´ 
transient int size = 0; //è®°å½•æœ€åä¸€ä¸ªç»“ç‚¹çš„ä½ç½®

//æ„é€ å™¨
public LinkedList() {
}

//æ–¹æ³•ï¼šadd()ç›¸å…³æ–¹æ³•
public boolean add(E e) {
    linkLast(e); //é»˜è®¤æŠŠæ–°å…ƒç´ é“¾æ¥åˆ°é“¾è¡¨å°¾éƒ¨
    return true;
}

void linkLast(E e) {
    final Node<E> l = last; //ç”¨ l è®°å½•åŸæ¥çš„æœ€åä¸€ä¸ªç»“ç‚¹
    //åˆ›å»ºæ–°ç»“ç‚¹
    final Node<E> newNode = new Node<>(l, e, null);
    //ç°åœ¨çš„æ–°ç»“ç‚¹æ˜¯æœ€åä¸€ä¸ªç»“ç‚¹äº†
    last = newNode;
    //å¦‚æœl==nullï¼Œè¯´æ˜åŸæ¥çš„é“¾è¡¨æ˜¯ç©ºçš„
    if (l == null)
        //é‚£ä¹ˆæ–°ç»“ç‚¹åŒæ—¶ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªç»“ç‚¹
        first = newNode;
    else
        //å¦åˆ™æŠŠæ–°ç»“ç‚¹é“¾æ¥åˆ°åŸæ¥çš„æœ€åä¸€ä¸ªç»“ç‚¹çš„nextä¸­
        l.next = newNode;
    //å…ƒç´ ä¸ªæ•°å¢åŠ 
    size++;
    //ä¿®æ”¹æ¬¡æ•°å¢åŠ 
    modCount++;
}

//å…¶ä¸­ï¼ŒNodeç±»å®šä¹‰å¦‚ä¸‹
private static class Node<E> {
    E item; //å…ƒç´ æ•°æ®
    Node<E> next; //ä¸‹ä¸€ä¸ªç»“ç‚¹
    Node<E> prev; //å‰ä¸€ä¸ªç»“ç‚¹

    Node(Node<E> prev, E element, Node<E> next) {
        this.item = element;
        this.next = next;
        this.prev = prev;
    }
}
//æ–¹æ³•ï¼šè·å–get()ç›¸å…³æ–¹æ³•
public E get(int index) {
    checkElementIndex(index);
    return node(index).item;
} 

//æ–¹æ³•ï¼šæ’å…¥add()ç›¸å…³æ–¹æ³•
public void add(int index, E element) {
    checkPositionIndex(index);//æ£€æŸ¥indexèŒƒå›´

    if (index == size)//å¦‚æœindex==sizeï¼Œè¿æ¥åˆ°å½“å‰é“¾è¡¨çš„å°¾éƒ¨
        linkLast(element);
    else
        linkBefore(element, node(index));
}

Node<E> node(int index) {
    // assert isElementIndex(index);
	/*
	index < (size >> 1)é‡‡ç”¨äºŒåˆ†æ€æƒ³ï¼Œå…ˆå°†indexä¸é•¿åº¦sizeçš„ä¸€åŠæ¯”è¾ƒï¼Œå¦‚æœindex<size/2ï¼Œå°±åªä»ä½ç½®0
	å¾€åéå†åˆ°ä½ç½®indexå¤„ï¼Œè€Œå¦‚æœindex>size/2ï¼Œå°±åªä»ä½ç½®sizeå¾€å‰éå†åˆ°ä½ç½®indexå¤„ã€‚è¿™æ ·å¯ä»¥å‡å°‘ä¸€éƒ¨
	åˆ†ä¸å¿…è¦çš„éå†ã€‚
	*/
    //å¦‚æœindex<size/2ï¼Œå°±ä»å‰å¾€åæ‰¾ç›®æ ‡ç»“ç‚¹
    if (index < (size >> 1)) {
        Node<E> x = first;
        for (int i = 0; i < index; i++)
            x = x.next;
        return x;
    } else {//å¦åˆ™ä»åå¾€å‰æ‰¾ç›®æ ‡ç»“ç‚¹
        Node<E> x = last;
        for (int i = size - 1; i > index; i--)
            x = x.prev;
        return x;
    }
}

//æŠŠæ–°ç»“ç‚¹æ’å…¥åˆ°[index]ä½ç½®çš„ç»“ç‚¹succå‰é¢
void linkBefore(E e, Node<E> succ) {//succæ˜¯[index]ä½ç½®å¯¹åº”çš„ç»“ç‚¹
    // assert succ != null;
    final Node<E> pred = succ.prev; //[index]ä½ç½®çš„å‰ä¸€ä¸ªç»“ç‚¹

    //æ–°ç»“ç‚¹çš„prevæ˜¯åŸæ¥[index]ä½ç½®çš„å‰ä¸€ä¸ªç»“ç‚¹
    //æ–°ç»“ç‚¹çš„nextæ˜¯åŸæ¥[index]ä½ç½®çš„ç»“ç‚¹
    final Node<E> newNode = new Node<>(pred, e, succ);

    //[index]ä½ç½®å¯¹åº”çš„ç»“ç‚¹çš„prevæŒ‡å‘æ–°ç»“ç‚¹
    succ.prev = newNode;

    //å¦‚æœåŸæ¥[index]ä½ç½®å¯¹åº”çš„ç»“ç‚¹æ˜¯ç¬¬ä¸€ä¸ªç»“ç‚¹ï¼Œé‚£ä¹ˆç°åœ¨æ–°ç»“ç‚¹æ˜¯ç¬¬ä¸€ä¸ªç»“ç‚¹
    if (pred == null)
        first = newNode;
    else
        pred.next = newNode;//åŸæ¥[index]ä½ç½®çš„å‰ä¸€ä¸ªç»“ç‚¹çš„nextæŒ‡å‘æ–°ç»“ç‚¹
    size++;
    modCount++;
}

//æ–¹æ³•ï¼šremove()ç›¸å…³æ–¹æ³•
public boolean remove(Object o) {
    //åˆ†oæ˜¯å¦ä¸ºç©ºä¸¤ç§æƒ…å†µ
    if (o == null) {
        //æ‰¾åˆ°oå¯¹åº”çš„ç»“ç‚¹x
        for (Node<E> x = first; x != null; x = x.next) {
            if (x.item == null) {
                unlink(x);//åˆ é™¤xç»“ç‚¹
                return true;
            }
        }
    } else {
        //æ‰¾åˆ°oå¯¹åº”çš„ç»“ç‚¹x
        for (Node<E> x = first; x != null; x = x.next) {
            if (o.equals(x.item)) {
                unlink(x);//åˆ é™¤xç»“ç‚¹
                return true;
            }
        }
    }
    return false;
}
E unlink(Node<E> x) {//xæ˜¯è¦è¢«åˆ é™¤çš„ç»“ç‚¹
    // assert x != null;
    final E element = x.item;//è¢«åˆ é™¤ç»“ç‚¹çš„æ•°æ®
    final Node<E> next = x.next;//è¢«åˆ é™¤ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹
    final Node<E> prev = x.prev;//è¢«åˆ é™¤ç»“ç‚¹çš„ä¸Šä¸€ä¸ªç»“ç‚¹

    //å¦‚æœè¢«åˆ é™¤ç»“ç‚¹çš„å‰é¢æ²¡æœ‰ç»“ç‚¹ï¼Œè¯´æ˜è¢«åˆ é™¤ç»“ç‚¹æ˜¯ç¬¬ä¸€ä¸ªç»“ç‚¹
    if (prev == null) {
        //é‚£ä¹ˆè¢«åˆ é™¤ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹å˜ä¸ºç¬¬ä¸€ä¸ªç»“ç‚¹
        first = next;
    } else {//è¢«åˆ é™¤ç»“ç‚¹ä¸æ˜¯ç¬¬ä¸€ä¸ªç»“ç‚¹
        //è¢«åˆ é™¤ç»“ç‚¹çš„ä¸Šä¸€ä¸ªç»“ç‚¹çš„nextæŒ‡å‘è¢«åˆ é™¤ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹
        prev.next = next;
        //æ–­å¼€è¢«åˆ é™¤ç»“ç‚¹ä¸ä¸Šä¸€ä¸ªç»“ç‚¹çš„é“¾æ¥
        x.prev = null;//ä½¿å¾—GCå›æ”¶
    }

    //å¦‚æœè¢«åˆ é™¤ç»“ç‚¹çš„åé¢æ²¡æœ‰ç»“ç‚¹ï¼Œè¯´æ˜è¢«åˆ é™¤ç»“ç‚¹æ˜¯æœ€åä¸€ä¸ªç»“ç‚¹
    if (next == null) {
        //é‚£ä¹ˆè¢«åˆ é™¤ç»“ç‚¹çš„ä¸Šä¸€ä¸ªç»“ç‚¹å˜ä¸ºæœ€åä¸€ä¸ªç»“ç‚¹
        last = prev;
    } else {//è¢«åˆ é™¤ç»“ç‚¹ä¸æ˜¯æœ€åä¸€ä¸ªç»“ç‚¹
        //è¢«åˆ é™¤ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹çš„prevæ‰§è¡Œè¢«åˆ é™¤ç»“ç‚¹çš„ä¸Šä¸€ä¸ªç»“ç‚¹
        next.prev = prev;
        //æ–­å¼€è¢«åˆ é™¤ç»“ç‚¹ä¸ä¸‹ä¸€ä¸ªç»“ç‚¹çš„è¿æ¥
        x.next = null;//ä½¿å¾—GCå›æ”¶
    }
    //æŠŠè¢«åˆ é™¤ç»“ç‚¹çš„æ•°æ®ä¹Ÿç½®ç©ºï¼Œä½¿å¾—GCå›æ”¶
    x.item = null;
    //å…ƒç´ ä¸ªæ•°å‡å°‘
    size--;
    //ä¿®æ”¹æ¬¡æ•°å¢åŠ 
    modCount++;
    //è¿”å›è¢«åˆ é™¤ç»“ç‚¹çš„æ•°æ®
    return element;
}

public E remove(int index) { //indexæ˜¯è¦åˆ é™¤å…ƒç´ çš„ç´¢å¼•ä½ç½®
    checkElementIndex(index);
    return unlink(node(index));
}
```

#### 8.3.3 LinkedListç›¸å…³æ–¹æ³•å›¾ç¤º

- **åªæœ‰1ä¸ªå…ƒç´ çš„LinkedList**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ac3edb135fd10a959a6603126204b39c.png)


- **åŒ…å«4ä¸ªå…ƒç´ çš„LinkedList**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/800a31fdd8c85f3a2511014760d0479b.png)


- **add(E e)æ–¹æ³•**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/1215cff53e130673368c2a0465fb8072.png)


- **add(int index,E e)æ–¹æ³•**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/95e14bc86e422a299f16bee7adf8bd6c.png)

- **remove(Object obj)æ–¹æ³•**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c101ac3660cdb1aa0f939cd90ad5eafd.png)


- **remove(int index)æ–¹æ³•**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/d42ff23c6062501fae594d9041245b02.png)

## 9 Mapæ¥å£åˆ†æ

### 9.1 å“ˆå¸Œè¡¨çš„ç‰©ç†ç»“æ„

HashMapå’ŒHashtableåº•å±‚éƒ½æ˜¯å“ˆå¸Œè¡¨ï¼ˆä¹Ÿç§°æ•£åˆ—è¡¨ï¼‰ï¼Œå…¶ä¸­ç»´æŠ¤äº†ä¸€ä¸ªé•¿åº¦ä¸º**2çš„å¹‚æ¬¡æ–¹**çš„Entryç±»å‹çš„æ•°ç»„tableï¼Œæ•°ç»„çš„æ¯ä¸€ä¸ªç´¢å¼•ä½ç½®è¢«ç§°ä¸ºä¸€ä¸ªæ¡¶(bucket)ï¼Œä½ æ·»åŠ çš„æ˜ å°„å…³ç³»(key,value)æœ€ç»ˆéƒ½è¢«å°è£…ä¸ºä¸€ä¸ªMap.Entryç±»å‹çš„å¯¹è±¡ï¼Œæ”¾åˆ°æŸä¸ªtable[index]æ¡¶ä¸­ã€‚

ä½¿ç”¨æ•°ç»„çš„ç›®çš„æ˜¯æŸ¥è¯¢å’Œæ·»åŠ çš„æ•ˆç‡é«˜ï¼Œå¯ä»¥æ ¹æ®ç´¢å¼•ç›´æ¥å®šä½åˆ°æŸä¸ªtable[index]ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/68164adee8e75ebaca747db264de65c1.png)

### 9.2 HashMapä¸­æ•°æ®æ·»åŠ è¿‡ç¨‹

#### 9.2.1 JDK7ä¸­è¿‡ç¨‹åˆ†æ

```java
// åœ¨åº•å±‚åˆ›å»ºäº†é•¿åº¦ä¸º16çš„Entry[] tableçš„æ•°ç»„
HashMap map = new HashMap(); 
```

```java
map.put(key1,value1);
/*
åˆ†æè¿‡ç¨‹å¦‚ä¸‹ï¼š

å°†(key1,value1)æ·»åŠ åˆ°å½“å‰hashmapçš„å¯¹è±¡ä¸­ã€‚é¦–å…ˆä¼šè°ƒç”¨key1æ‰€åœ¨ç±»çš„hashCode()æ–¹æ³•ï¼Œè®¡ç®—key1çš„å“ˆå¸Œå€¼1ï¼Œ
æ­¤å“ˆå¸Œå€¼1å†ç»è¿‡æŸç§è¿ç®—(hash())ï¼Œå¾—åˆ°å“ˆå¸Œå€¼2ã€‚æ­¤å“ˆå¸Œå€¼2å†ç»è¿‡æŸç§è¿ç®—(indexFor())ï¼Œç¡®å®šåœ¨åº•å±‚tableæ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®iã€‚
   ï¼ˆ1ï¼‰å¦‚æœæ•°ç»„ç´¢å¼•ä¸ºiä¸Šçš„æ•°æ®ä¸ºç©ºï¼Œåˆ™(key1,value1)ç›´æ¥æ·»åŠ æˆåŠŸ   ------ä½ç½®1
   ï¼ˆ2ï¼‰å¦‚æœæ•°ç»„ç´¢å¼•ä¸ºiä¸Šçš„æ•°æ®ä¸ä¸ºç©ºï¼Œæœ‰(key2,value2)ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­ï¼š
       åˆ¤æ–­key1çš„å“ˆå¸Œå€¼2ä¸key2çš„å“ˆå¸Œå€¼æ˜¯å¦ç›¸åŒï¼š
         ï¼ˆ3ï¼‰ å¦‚æœå“ˆå¸Œå€¼ä¸åŒï¼Œåˆ™(key1,value1)ç›´æ¥æ·»åŠ æˆåŠŸ   ------ä½ç½®2
              å¦‚æœå“ˆå¸Œå€¼ç›¸åŒï¼Œåˆ™éœ€è¦ç»§ç»­è°ƒç”¨key1æ‰€åœ¨ç±»çš„equals()æ–¹æ³•ï¼Œå°†key2æ”¾å…¥equals()å½¢å‚è¿›è¡Œåˆ¤æ–­
                ï¼ˆ4ï¼‰ equalsæ–¹æ³•è¿”å›false : åˆ™(key1,value1)ç›´æ¥æ·»åŠ æˆåŠŸ   ------ä½ç½®3
                      equalsæ–¹æ³•è¿”å›true : é»˜è®¤æƒ…å†µä¸‹ï¼Œvalue1ä¼šè¦†ç›–value2ã€‚

ä½ç½®1ï¼šç›´æ¥å°†(key1,value1)ä»¥Entryå¯¹è±¡çš„æ–¹å¼å­˜æ”¾åˆ°tableæ•°ç»„ç´¢å¼•içš„ä½ç½®ã€‚
ä½ç½®2ã€ä½ç½®3ï¼š(key1,value1) ä¸ç°æœ‰çš„å…ƒç´ ä»¥é“¾è¡¨çš„æ–¹å¼å­˜å‚¨åœ¨tableæ•°ç»„ç´¢å¼•içš„ä½ç½®ï¼Œæ–°æ·»åŠ çš„å…ƒç´ æŒ‡å‘æ—§æ·»åŠ çš„å…ƒç´ ã€‚

...
åœ¨ä¸æ–­çš„æ·»åŠ çš„æƒ…å†µä¸‹ï¼Œæ»¡è¶³å¦‚ä¸‹æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œä¼šè¿›è¡Œæ‰©å®¹:
if ((size >= threshold) && (null != table[bucketIndex])) :
é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“è¦æ·»åŠ çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡12(å³ï¼šæ•°ç»„çš„é•¿åº¦ * loadFactorå¾—åˆ°çš„ç»“æœ)æ—¶ï¼Œå°±è¦è€ƒè™‘æ‰©å®¹ã€‚

è¡¥å……ï¼šjdk7æºç ä¸­å®šä¹‰çš„ï¼š
static class Entry<K,V> implements Map.Entry<K,V>
*/
```

```java
map.get(key1);
/*
â‘  è®¡ç®—key1çš„hashå€¼ï¼Œç”¨è¿™ä¸ªæ–¹æ³•hash(key1)

â‘¡ æ‰¾index = table.length-1 & hash;

â‘¢ å¦‚æœtable[index]ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±æŒ¨ä¸ªæ¯”è¾ƒå“ªä¸ªEntryçš„keyä¸å®ƒç›¸åŒï¼Œå°±è¿”å›å®ƒçš„value
*/

```

```java
map.remove(key1);
/*
â‘  è®¡ç®—key1çš„hashå€¼ï¼Œç”¨è¿™ä¸ªæ–¹æ³•hash(key1)

â‘¡ æ‰¾index = table.length-1 & hash;

â‘¢ å¦‚æœtable[index]ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±æŒ¨ä¸ªæ¯”è¾ƒå“ªä¸ªEntryçš„keyä¸å®ƒç›¸åŒï¼Œå°±åˆ é™¤å®ƒï¼ŒæŠŠå®ƒå‰é¢çš„Entryçš„nextçš„å€¼ä¿®æ”¹ä¸ºè¢«åˆ é™¤Entryçš„next
*/
```

#### 9.2.2 JDK8ä¸­è¿‡ç¨‹åˆ†æ

ä¸‹é¢è¯´æ˜æ˜¯JDK8ç›¸è¾ƒäºJDK7çš„ä¸åŒä¹‹å¤„ï¼š

```java
/*
â‘ 
ä½¿ç”¨HashMap()çš„æ„é€ å™¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå¹¶æ²¡æœ‰åœ¨åº•å±‚åˆå§‹åŒ–é•¿åº¦ä¸º16çš„tableæ•°ç»„ã€‚åªæœ‰åœ¨æ·»åŠ äº†å…ƒç´ åï¼Œæ‰ä¼šåˆå§‹åŒ–æ•°ç»„é•¿åº¦

â‘¡
jdk8ä¸­æ·»åŠ çš„key,valueå°è£…åˆ°äº†HashMap.Nodeç±»çš„å¯¹è±¡ä¸­ã€‚è€Œéjdk7ä¸­çš„HashMap.Entryã€‚

â‘¢
jdk8ä¸­æ–°å¢çš„å…ƒç´ æ‰€åœ¨çš„ç´¢å¼•ä½ç½®å¦‚æœæœ‰å…¶ä»–å…ƒç´ ã€‚åœ¨ç»è¿‡ä¸€ç³»åˆ—åˆ¤æ–­åï¼Œå¦‚æœèƒ½æ·»åŠ ï¼Œåˆ™æ˜¯æ—§çš„å…ƒç´ æŒ‡å‘æ–°çš„å…ƒç´ ã€‚è€Œéjdk7ä¸­çš„æ–°çš„å…ƒç´ æŒ‡å‘æ—§çš„å…ƒç´ ã€‚â€œä¸ƒä¸Šå…«ä¸‹â€

â‘£
jdk7æ—¶åº•å±‚çš„æ•°æ®ç»“æ„æ˜¯ï¼šæ•°ç»„+å•å‘é“¾è¡¨ã€‚ è€Œjdk8æ—¶ï¼Œåº•å±‚çš„æ•°æ®ç»“æ„æ˜¯ï¼šæ•°ç»„+å•å‘é“¾è¡¨+çº¢é»‘æ ‘ã€‚
çº¢é»‘æ ‘å‡ºç°çš„æ—¶æœºï¼šå½“æŸä¸ªç´¢å¼•ä½ç½®iä¸Šçš„é“¾è¡¨çš„é•¿åº¦è¾¾åˆ°8ï¼Œä¸”æ•°ç»„çš„é•¿åº¦è¶…è¿‡64æ—¶ï¼Œæ­¤ç´¢å¼•ä½ç½®ä¸Šçš„å…ƒç´ è¦ä»å•å‘é“¾è¡¨æ”¹ä¸ºçº¢é»‘æ ‘ã€‚
å¦‚æœç´¢å¼•iä½ç½®æ˜¯çº¢é»‘æ ‘çš„ç»“æ„ï¼Œå½“ä¸æ–­åˆ é™¤å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œå½“å‰ç´¢å¼•iä½ç½®ä¸Šçš„å…ƒç´ çš„ä¸ªæ•°ä½äº6æ—¶ï¼Œè¦ä»çº¢é»‘æ ‘æ”¹ä¸ºå•å‘é“¾è¡¨ã€‚

*/
```

### 9.3 HashMapæºç å‰–æ

#### 9.3.1 JDK1.7.0_07ä¸­æºç 

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/a61fafe7e8c7cce7da5c7ccd21f77558.png)

**1ã€Entry**

key-valueè¢«å°è£…ä¸ºHashMap.Entryç±»å‹ï¼Œè€Œè¿™ä¸ªç±»å‹å®ç°äº†Map.Entryæ¥å£ã€‚

```java
public class HashMap<K,V>{
    transient Entry<K,V>[] table;
    
    static class Entry<K,V> implements Map.Entry<K,V> {
        final K key;
        V value;
        Entry<K,V> next;
        int hash;

        /**
         * Creates new entry.
         */
        Entry(int h, K k, V v, Entry<K,V> n) {
            value = v;
            next = n;
            key = k;
            hash = h;
        }
        //ç•¥
    }
}
```

##### 9.3.1.1 å±æ€§

```java
//tableæ•°ç»„çš„é»˜è®¤åˆå§‹åŒ–é•¿åº¦
static final int DEFAULT_INITIAL_CAPACITY = 16;
//å“ˆå¸Œè¡¨
transient Entry<K,V>[] table;
//å“ˆå¸Œè¡¨ä¸­key-valueçš„ä¸ªæ•°
transient int size;
//ä¸´ç•Œå€¼ã€é˜ˆå€¼ï¼ˆæ‰©å®¹çš„ä¸´ç•Œå€¼ï¼‰
int threshold;
//åŠ è½½å› å­
final float loadFactor;
//é»˜è®¤åŠ è½½å› å­
static final float DEFAULT_LOAD_FACTOR = 0.75f;
```

##### 9.3.1.2 æ„é€ å™¨

```java
public HashMap() {
    //DEFAULT_INITIAL_CAPACITYï¼šé»˜è®¤åˆå§‹å®¹é‡16
  	//DEFAULT_LOAD_FACTORï¼šé»˜è®¤åŠ è½½å› å­0.75
    this(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR);
}
```

```java
public HashMap(int initialCapacity, float loadFactor) {
    //æ ¡éªŒinitialCapacityåˆæ³•æ€§
    if (initialCapacity < 0)
        throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity);
    //æ ¡éªŒinitialCapacityåˆæ³•æ€§ 
    if (initialCapacity > MAXIMUM_CAPACITY)
        initialCapacity = MAXIMUM_CAPACITY;
    //æ ¡éªŒloadFactoråˆæ³•æ€§
    if (loadFactor <= 0 || Float.isNaN(loadFactor))
        throw new IllegalArgumentException("Illegal load factor: " + loadFactor);

    //è®¡ç®—å¾—åˆ°tableæ•°ç»„çš„é•¿åº¦ï¼ˆä¿è¯capacityæ˜¯2çš„æ•´æ¬¡å¹‚ï¼‰
    int capacity = 1;
    while (capacity < initialCapacity)
        capacity <<= 1;
	//åŠ è½½å› å­ï¼Œåˆå§‹åŒ–ä¸º0.75
    this.loadFactor = loadFactor;
    // threshold åˆå§‹ä¸ºé»˜è®¤å®¹é‡
    threshold = (int)Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + 1);
    //åˆå§‹åŒ–tableæ•°ç»„
    table = new Entry[capacity];
    useAltHashing = sun.misc.VM.isBooted() &&
                                       (capacity >= Holder.ALTERNATIVE_HASHING_THRESHOLD);
    init();
}
```

##### 9.3.1.3 put()æ–¹æ³•

```java
public V put(K key, V value) {
    //å¦‚æœkeyæ˜¯nullï¼Œå•ç‹¬å¤„ç†ï¼Œå­˜å‚¨åˆ°table[0]ä¸­ï¼Œå¦‚æœæœ‰å¦ä¸€ä¸ªkeyä¸ºnullï¼Œvalueè¦†ç›–
    if (key == null)
        return putForNullKey(value);
    //å¯¹keyçš„hashCodeè¿›è¡Œå¹²æ‰°ï¼Œç®—å‡ºä¸€ä¸ªhashå€¼
    /*
      hashCodeå€¼        xxxxxxxxxx
      table.length-1    000001111
   
      hashCodeå€¼ xxxxxxxxxx  æ— ç¬¦å·å³ç§»å‡ ä½å’ŒåŸæ¥çš„hashCodeå€¼åš^è¿ç®—ï¼Œä½¿å¾—hashCodeé«˜ä½äºŒè¿›åˆ¶å€¼å‚ä¸è®¡ç®—ï¼Œ
                            ä¹Ÿå‘æŒ¥ä½œç”¨ï¼Œé™ä½indexå†²çªçš„æ¦‚ç‡ã€‚
    */
    int hash = hash(key);
    //è®¡ç®—æ–°çš„æ˜ å°„å…³ç³»åº”è¯¥å­˜åˆ°table[i]ä½ç½®ï¼Œ
    //i = hash & table.length-1ï¼Œå¯ä»¥ä¿è¯iåœ¨[0,table.length-1]èŒƒå›´å†…
    int i = indexFor(hash, table.length);
    //æ£€æŸ¥table[i]ä¸‹é¢æœ‰æ²¡æœ‰keyä¸æˆ‘æ–°çš„æ˜ å°„å…³ç³»çš„keyé‡å¤ï¼Œå¦‚æœé‡å¤æ›¿æ¢value
    for (Entry<K,V> e = table[i]; e != null; e = e.next) {
        Object k;
        if (e.hash == hash && ((k = e.key) == key || key.equals(k))) {
            V oldValue = e.value;
            e.value = value;
            e.recordAccess(this);
            return oldValue;
        }
    }

    modCount++;
    //æ·»åŠ æ–°çš„æ˜ å°„å…³ç³»
    addEntry(hash, key, value, i);
    return null;
}
```

å…¶ä¸­ï¼Œ

```java
//å¦‚æœkeyæ˜¯nullï¼Œç›´æ¥å­˜å…¥[0]çš„ä½ç½®
private V putForNullKey(V value) {
    //åˆ¤æ–­æ˜¯å¦æœ‰é‡å¤çš„keyï¼Œå¦‚æœæœ‰é‡å¤çš„ï¼Œå°±æ›¿æ¢value
    for (Entry<K,V> e = table[0]; e != null; e = e.next) {
        if (e.key == null) {
            V oldValue = e.value;
            e.value = value;
            e.recordAccess(this);
            return oldValue;
        }
    }
    modCount++;
    //æŠŠæ–°çš„æ˜ å°„å…³ç³»å­˜å…¥[0]çš„ä½ç½®ï¼Œè€Œä¸”keyçš„hashå€¼ç”¨0è¡¨ç¤º
    addEntry(0, null, value, 0);
    return null;
}
```

```java
final int hash(Object k) {
    int h = 0;
    if (useAltHashing) {
        if (k instanceof String) {
            return sun.misc.Hashing.stringHash32((String) k);
        }
        h = hashSeed;
    }

    h ^= k.hashCode();

    // This function ensures that hashCodes that differ only by
    // constant multiples at each bit position have a bounded
    // number of collisions (approximately 8 at default load factor).
    h ^= (h >>> 20) ^ (h >>> 12);
    return h ^ (h >>> 7) ^ (h >>> 4);
}
```

```java
static int indexFor(int h, int length) {
    return h & (length-1);
}
```

```java
void addEntry(int hash, K key, V value, int bucketIndex) {
    //åˆ¤æ–­æ˜¯å¦éœ€è¦åº“å®¹
    //æ‰©å®¹ï¼šï¼ˆ1ï¼‰sizeè¾¾åˆ°é˜ˆå€¼ï¼ˆ2ï¼‰table[i]æ­£å¥½éç©º
    if ((size >= threshold) && (null != table[bucketIndex])) {
        //tableæ‰©å®¹ä¸ºåŸæ¥çš„2å€ï¼Œå¹¶ä¸”æ‰©å®¹åï¼Œä¼šé‡æ–°è°ƒæ•´æ‰€æœ‰key-valueçš„å­˜å‚¨ä½ç½®
        resize(2 * table.length); 
        //æ–°çš„key-valueçš„hashå’Œindexä¹Ÿä¼šé‡æ–°è®¡ç®—
        hash = (null != key) ? hash(key) : 0;
        bucketIndex = indexFor(hash, table.length);
    }
	//å­˜å…¥tableä¸­
    createEntry(hash, key, value, bucketIndex);
}
```

```java
void createEntry(int hash, K key, V value, int bucketIndex) {
    Entry<K,V> e = table[bucketIndex];
    //åŸæ¥table[i]ä¸‹é¢çš„æ˜ å°„å…³ç³»ä½œä¸ºæ–°çš„æ˜ å°„å…³ç³»next
    table[bucketIndex] = new Entry<>(hash, key, value, e);
    //ä¸ªæ•°å¢åŠ 
    size++; 
}
```

#### 9.3.2 JDK1.8.0_271ä¸­æºç 

##### 9.3.2.1 Node

key-valueè¢«å°è£…ä¸ºHashMap.Nodeç±»å‹æˆ–HashMap.TreeNodeç±»å‹ï¼Œå®ƒä¿©éƒ½ç›´æ¥æˆ–é—´æ¥çš„å®ç°äº†Map.Entryæ¥å£ã€‚

å­˜å‚¨åˆ°tableæ•°ç»„çš„å¯èƒ½æ˜¯Nodeç»“ç‚¹å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ˜¯TreeNodeç»“ç‚¹å¯¹è±¡ï¼Œå®ƒä»¬ä¹Ÿæ˜¯Map.Entryæ¥å£çš„å®ç°ç±»ã€‚å³table[index]ä¸‹çš„æ˜ å°„å…³ç³»å¯èƒ½ä¸²èµ·æ¥ä¸€ä¸ªé“¾è¡¨æˆ–ä¸€æ£µçº¢é»‘æ ‘ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/d551dd9ff59cf3d28681909737f4593b.png)


```java
public class HashMap<K,V>{
    transient Node<K,V>[] table;
    
    //Nodeç±»
    static class Node<K,V> implements Map.Entry<K,V> {
        final int hash;
        final K key;
        V value;
        Node<K,V> next;

        Node(int hash, K key, V value, Node<K,V> next) {
            this.hash = hash;
            this.key = key;
            this.value = value;
            this.next = next;
        }
        // å…¶å®ƒç»“æ„ï¼šç•¥
    }
    
    //TreeNodeç±»
    static final class TreeNode<K,V> extends LinkedHashMap.Entry<K,V> {
        TreeNode<K,V> parent;
        TreeNode<K,V> left;
        TreeNode<K,V> right;
        TreeNode<K,V> prev;
        boolean red; //æ˜¯çº¢ç»“ç‚¹è¿˜æ˜¯é»‘ç»“ç‚¹
        TreeNode(int hash, K key, V val, Node<K,V> next) {
            super(hash, key, val, next);
        }
    }
    
    //....
}
```

##### 9.3.2.2 å±æ€§

```java
static final int DEFAULT_INITIAL_CAPACITY = 1 << 4; // é»˜è®¤çš„åˆå§‹å®¹é‡ 16
static final int MAXIMUM_CAPACITY = 1 << 30; //æœ€å¤§å®¹é‡  1 << 30
static final float DEFAULT_LOAD_FACTOR = 0.75f;  //é»˜è®¤åŠ è½½å› å­
static final int TREEIFY_THRESHOLD = 8; //é»˜è®¤æ ‘åŒ–é˜ˆå€¼8ï¼Œå½“é“¾è¡¨çš„é•¿åº¦è¾¾åˆ°è¿™ä¸ªå€¼åï¼Œè¦è€ƒè™‘æ ‘åŒ–
static final int UNTREEIFY_THRESHOLD = 6;//é»˜è®¤åæ ‘åŒ–é˜ˆå€¼6ï¼Œå½“æ ‘ä¸­ç»“ç‚¹çš„ä¸ªæ•°è¾¾åˆ°æ­¤é˜ˆå€¼åï¼Œè¦è€ƒè™‘å˜ä¸ºé“¾è¡¨

//å½“å•ä¸ªçš„é“¾è¡¨çš„ç»“ç‚¹ä¸ªæ•°è¾¾åˆ°8ï¼Œå¹¶ä¸”tableçš„é•¿åº¦è¾¾åˆ°64ï¼Œæ‰ä¼šæ ‘åŒ–ã€‚
//å½“å•ä¸ªçš„é“¾è¡¨çš„ç»“ç‚¹ä¸ªæ•°è¾¾åˆ°8ï¼Œä½†æ˜¯tableçš„é•¿åº¦æœªè¾¾åˆ°64ï¼Œä¼šå…ˆæ‰©å®¹
static final int MIN_TREEIFY_CAPACITY = 64; //æœ€å°æ ‘åŒ–å®¹é‡64

transient Node<K,V>[] table; //æ•°ç»„
transient int size;  //è®°å½•æœ‰æ•ˆæ˜ å°„å…³ç³»çš„å¯¹æ•°ï¼Œä¹Ÿæ˜¯Entryå¯¹è±¡çš„ä¸ªæ•°
int threshold; //é˜ˆå€¼ï¼Œå½“sizeè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè€ƒè™‘æ‰©å®¹
final float loadFactor; //åŠ è½½å› å­ï¼Œå½±å“æ‰©å®¹çš„é¢‘ç‡
```

##### 9.3.2.3 æ„é€ å™¨

```java
public HashMap() {
    this.loadFactor = DEFAULT_LOAD_FACTOR; // all other fields defaulted (å…¶ä»–å­—æ®µéƒ½æ˜¯é»˜è®¤å€¼)
}
```

##### 9.3.2.4 put()æ–¹æ³•

```java
public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}
```

å…¶ä¸­ï¼Œ

```java
static final int hash(Object key) {
    int h;
    //å¦‚æœkeyæ˜¯nullï¼Œhashæ˜¯0
	//å¦‚æœkeyénullï¼Œç”¨keyçš„hashCodeå€¼ ä¸ keyçš„hashCodeå€¼é«˜16è¿›è¡Œå¼‚æˆ–
	//		å³å°±æ˜¯ç”¨keyçš„hashCodeå€¼é«˜16ä½ä¸ä½16ä½è¿›è¡Œäº†å¼‚æˆ–çš„å¹²æ‰°è¿ç®—
		
	/*
	index = hash & table.length-1
	å¦‚æœç”¨keyçš„åŸå§‹çš„hashCodeå€¼  ä¸ table.length-1 è¿›è¡ŒæŒ‰ä½ä¸ï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šé«˜16æ²¡æœºä¼šç”¨ä¸Šã€‚
	è¿™æ ·å°±ä¼šå¢åŠ å†²çªçš„æ¦‚ç‡ï¼Œä¸ºäº†é™ä½å†²çªçš„æ¦‚ç‡ï¼ŒæŠŠé«˜16ä½åŠ å…¥åˆ°hashä¿¡æ¯ä¸­ã€‚
	*/
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

```java
final V putVal(int hash, K key, V value, boolean onlyIfAbsent,boolean evict) {
    Node<K,V>[] tab; //æ•°ç»„
    Node<K,V> p;  //ä¸€ä¸ªç»“ç‚¹
    int n, i; //næ˜¯æ•°ç»„çš„é•¿åº¦   iæ˜¯ä¸‹æ ‡
    
    //tabå’Œtableç­‰ä»·
	//å¦‚æœtableæ˜¯ç©ºçš„
    if ((tab = table) == null || (n = tab.length) == 0){
        n = (tab = resize()).length;
        /*
		tab = resize();
		n = tab.length;*/
		/*
		å¦‚æœtableæ˜¯ç©ºçš„ï¼Œresize()å®Œæˆäº†â‘ åˆ›å»ºäº†ä¸€ä¸ªé•¿åº¦ä¸º16çš„æ•°ç»„â‘¡threshold = 12
		n = 16
		*/
	}
    //i = (n - 1) & hash ï¼Œä¸‹æ ‡ = æ•°ç»„é•¿åº¦-1 & hash
	//p = tab[i] ç¬¬1ä¸ªç»“ç‚¹
	//if(p==null) æ¡ä»¶æ»¡è¶³çš„è¯è¯´æ˜ table[i]è¿˜æ²¡æœ‰å…ƒç´ 
    if ((p = tab[i = (n - 1) & hash]) == null){
        //æŠŠæ–°çš„æ˜ å°„å…³ç³»ç›´æ¥æ”¾å…¥table[i]
        tab[i] = newNode(hash, key, value, null);
        //newNodeï¼ˆï¼‰æ–¹æ³•å°±åˆ›å»ºäº†ä¸€ä¸ªNodeç±»å‹çš„æ–°ç»“ç‚¹ï¼Œæ–°ç»“ç‚¹çš„nextæ˜¯null
    }else {
        Node<K,V> e; K k;
        //pæ˜¯table[i]ä¸­ç¬¬ä¸€ä¸ªç»“ç‚¹
		//if(table[i]çš„ç¬¬ä¸€ä¸ªç»“ç‚¹ä¸æ–°çš„æ˜ å°„å…³ç³»çš„keyé‡å¤)
        if (p.hash == hash &&
            ((k = p.key) == key || (key != null && key.equals(k))))
            e = p;//ç”¨eè®°å½•è¿™ä¸ªtable[i]çš„ç¬¬ä¸€ä¸ªç»“ç‚¹
        else if (p instanceof TreeNode){ //å¦‚æœtable[i]ç¬¬ä¸€ä¸ªç»“ç‚¹æ˜¯ä¸€ä¸ªæ ‘ç»“ç‚¹
            //å•ç‹¬å¤„ç†æ ‘ç»“ç‚¹
            //å¦‚æœæ ‘ç»“ç‚¹ä¸­ï¼Œæœ‰keyé‡å¤çš„ï¼Œå°±è¿”å›é‚£ä¸ªé‡å¤çš„ç»“ç‚¹ç”¨eæ¥æ”¶ï¼Œå³e!=null
            //å¦‚æœæ ‘ç»“ç‚¹ä¸­ï¼Œæ²¡æœ‰keyé‡å¤çš„ï¼Œå°±æŠŠæ–°ç»“ç‚¹æ”¾åˆ°æ ‘ä¸­ï¼Œå¹¶ä¸”è¿”å›nullï¼Œå³e=null
            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
        }else {
            //table[i]çš„ç¬¬ä¸€ä¸ªç»“ç‚¹ä¸æ˜¯æ ‘ç»“ç‚¹ï¼Œä¹Ÿä¸æ–°çš„æ˜ å°„å…³ç³»çš„keyä¸é‡å¤
			//binCountè®°å½•äº†table[i]ä¸‹é¢çš„ç»“ç‚¹çš„ä¸ªæ•°
            for (int binCount = 0; ; ++binCount) {
                //å¦‚æœpçš„ä¸‹ä¸€ä¸ªç»“ç‚¹æ˜¯ç©ºçš„ï¼Œè¯´æ˜å½“å‰çš„pæ˜¯æœ€åä¸€ä¸ªç»“ç‚¹
                if ((e = p.next) == null) {
                    //æŠŠæ–°çš„ç»“ç‚¹è¿æ¥åˆ°table[i]çš„æœ€å
                    p.next = newNode(hash, key, value, null);
                    //å¦‚æœbinCount>=8-1ï¼Œè¾¾åˆ°7ä¸ªæ—¶
                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
                        //è¦ä¹ˆæ‰©å®¹ï¼Œè¦ä¹ˆæ ‘åŒ–
                        treeifyBin(tab, hash);
                    break;
                }
                //å¦‚æœkeyé‡å¤äº†ï¼Œå°±è·³å‡ºforå¾ªç¯ï¼Œæ­¤æ—¶eç»“ç‚¹è®°å½•çš„å°±æ˜¯é‚£ä¸ªkeyé‡å¤çš„ç»“ç‚¹
                if (e.hash == hash &&
                        ((k = e.key) == key || (key != null && key.equals(k))))
                    break;
                p = e;//ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œe=p.nextï¼Œå°±ç±»ä¼¼äºe=e.nextï¼Œå¾€é“¾è¡¨ä¸‹ç§»åŠ¨
            }
        }
        //å¦‚æœè¿™ä¸ªeä¸æ˜¯nullï¼Œè¯´æ˜æœ‰keyé‡å¤ï¼Œå°±è€ƒè™‘æ›¿æ¢åŸæ¥çš„value
        if (e != null) { // existing mapping for key
            V oldValue = e.value;
            if (!onlyIfAbsent || oldValue == null)
                e.value = value;
            afterNodeAccess(e); //ä»€ä¹ˆä¹Ÿæ²¡å¹²
            return oldValue;
        }
    }
    ++modCount;
    
    //å…ƒç´ ä¸ªæ•°å¢åŠ 
	//sizeè¾¾åˆ°é˜ˆå€¼
    if (++size > threshold)
        resize(); //ä¸€æ—¦æ‰©å®¹ï¼Œé‡æ–°è°ƒæ•´æ‰€æœ‰æ˜ å°„å…³ç³»çš„ä½ç½®
    afterNodeInsertion(evict); //ä»€ä¹ˆä¹Ÿæ²¡å¹²
    return null;
}
```

```java
final Node<K,V>[] resize() {
    Node<K,V>[] oldTab = table; //oldTabåŸæ¥çš„table
    //oldCapï¼šåŸæ¥æ•°ç»„çš„é•¿åº¦
    int oldCap = (oldTab == null) ? 0 : oldTab.length;
    //oldThrï¼šåŸæ¥çš„é˜ˆå€¼
    int oldThr = threshold;//æœ€å¼€å§‹thresholdæ˜¯0
    
    //newCapï¼Œæ–°å®¹é‡
	//newThrï¼šæ–°é˜ˆå€¼
    int newCap, newThr = 0;
    if (oldCap > 0) { //è¯´æ˜åŸæ¥ä¸æ˜¯ç©ºæ•°ç»„
        if (oldCap >= MAXIMUM_CAPACITY) { //æ˜¯å¦è¾¾åˆ°æ•°ç»„æœ€å¤§é™åˆ¶
            threshold = Integer.MAX_VALUE;
            return oldTab;
        }
        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&
                 oldCap >= DEFAULT_INITIAL_CAPACITY)
            //newCap = æ—§çš„å®¹é‡*2 ï¼Œæ–°å®¹é‡<æœ€å¤§æ•°ç»„å®¹é‡é™åˆ¶
			//æ–°å®¹é‡ï¼š32,64ï¼Œ...
			//oldCap >= åˆå§‹å®¹é‡16
			//æ–°é˜ˆå€¼é‡æ–°ç®— = 24ï¼Œ48 ....
            newThr = oldThr << 1; // double threshold
    }
    else if (oldThr > 0) // initial capacity was placed in threshold
        newCap = oldThr;
    else {               // zero initial threshold signifies using defaults
        newCap = DEFAULT_INITIAL_CAPACITY; //æ–°å®¹é‡æ˜¯é»˜è®¤åˆå§‹åŒ–å®¹é‡16
        //æ–°é˜ˆå€¼= é»˜è®¤çš„åŠ è½½å› å­ * é»˜è®¤çš„åˆå§‹åŒ–å®¹é‡ = 0.75*16 = 12
        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
    }
    if (newThr == 0) {
        float ft = (float)newCap * loadFactor;
        newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY ?
                  (int)ft : Integer.MAX_VALUE);
    }
    threshold = newThr; //é˜ˆå€¼èµ‹å€¼ä¸ºæ–°é˜ˆå€¼12ï¼Œ24.ã€‚ã€‚ã€‚
    //åˆ›å»ºäº†ä¸€ä¸ªæ–°æ•°ç»„ï¼Œé•¿åº¦ä¸ºnewCapï¼Œ16ï¼Œ32,64.ã€‚ã€‚
    @SuppressWarnings({"rawtypes","unchecked"})
    Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];
    table = newTab;
    if (oldTab != null) { //åŸæ¥ä¸æ˜¯ç©ºæ•°ç»„
        //æŠŠåŸæ¥çš„tableä¸­æ˜ å°„å…³ç³»ï¼Œå€’è…¾åˆ°æ–°çš„tableä¸­
        for (int j = 0; j < oldCap; ++j) {
            Node<K,V> e;
            if ((e = oldTab[j]) != null) {//eæ˜¯tableä¸‹é¢çš„ç»“ç‚¹
                oldTab[j] = null; //æŠŠæ—§çš„table[j]ä½ç½®æ¸…ç©º
                if (e.next == null) //å¦‚æœæ˜¯æœ€åä¸€ä¸ªç»“ç‚¹
                    newTab[e.hash & (newCap - 1)] = e; //é‡æ–°è®¡ç®—eçš„åœ¨æ–°tableä¸­çš„å­˜å‚¨ä½ç½®ï¼Œç„¶åæ”¾å…¥
                else if (e instanceof TreeNode) //å¦‚æœeæ˜¯æ ‘ç»“ç‚¹
                    //æŠŠåŸæ¥çš„æ ‘æ‹†è§£ï¼Œæ”¾åˆ°æ–°çš„table
                    ((TreeNode<K,V>)e).split(this, newTab, j, oldCap);
                else { // preserve order
                    Node<K,V> loHead = null, loTail = null;
                    Node<K,V> hiHead = null, hiTail = null;
                    Node<K,V> next;
                    //æŠŠåŸæ¥table[i]ä¸‹é¢çš„æ•´ä¸ªé“¾è¡¨ï¼Œé‡æ–°æŒªåˆ°äº†æ–°çš„tableä¸­
                    do {
                        next = e.next;
                        if ((e.hash & oldCap) == 0) {
                            if (loTail == null)
                                loHead = e;
                            else
                                loTail.next = e;
                            loTail = e;
                        }
                        else {
                            if (hiTail == null)
                                hiHead = e;
                            else
                                hiTail.next = e;
                            hiTail = e;
                        }
                    } while ((e = next) != null);
                    if (loTail != null) {
                        loTail.next = null;
                        newTab[j] = loHead;
                    }
                    if (hiTail != null) {
                        hiTail.next = null;
                        newTab[j + oldCap] = hiHead;
                    }
                }
            }
        }
    }
    return newTab;
}
```

```java
Node<K,V> newNode(int hash, K key, V value, Node<K,V> next) {
    //åˆ›å»ºä¸€ä¸ªæ–°ç»“ç‚¹
    return new Node<>(hash, key, value, next);
}
```

```java
final void treeifyBin(Node<K,V>[] tab, int hash) {
    int n, index; 
    Node<K,V> e;
    //MIN_TREEIFY_CAPACITYï¼šæœ€å°æ ‘åŒ–å®¹é‡64
    //å¦‚æœtableæ˜¯ç©ºçš„ï¼Œæˆ–è€…  tableçš„é•¿åº¦æ²¡æœ‰è¾¾åˆ°64
    if (tab == null || (n = tab.length) < MIN_TREEIFY_CAPACITY)
        resize();//å…ˆæ‰©å®¹
    else if ((e = tab[index = (n - 1) & hash]) != null) {
        //ç”¨eè®°å½•table[index]çš„ç»“ç‚¹çš„åœ°å€
        TreeNode<K,V> hd = null, tl = null;
        /*
			do...whileï¼ŒæŠŠtable[index]é“¾è¡¨çš„Nodeç»“ç‚¹å˜ä¸ºTreeNodeç±»å‹çš„ç»“ç‚¹
			*/
        do {
            TreeNode<K,V> p = replacementTreeNode(e, null);
            if (tl == null)
                hd = p;//hdè®°å½•æ ¹ç»“ç‚¹
            else {
                p.prev = tl;
                tl.next = p;
            }
            tl = p;
        } while ((e = e.next) != null);

        //å¦‚æœtable[index]ä¸‹é¢ä¸æ˜¯ç©º
        if ((tab[index] = hd) != null)
            hd.treeify(tab);//å°†table[index]ä¸‹é¢çš„é“¾è¡¨è¿›è¡Œæ ‘åŒ–
    }
}	
```

å°ç»“ï¼š
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/2e295a6f9e874930e309849d78cf945a.png)


### 9.4 LinkedHashMapæºç å‰–æ

#### 9.4.1 æºç 

å†…éƒ¨å®šä¹‰çš„Entryå¦‚ä¸‹ï¼š

```java
static class Entry<K,V> extends HashMap.Node<K,V> {
	Entry<K,V> before, after;
	
	Entry(int hash, K key, V value, Node<K,V> next) {
		super(hash, key, value, next);
	}
}
```

LinkedHashMapé‡å†™äº†HashMapä¸­çš„newNode()æ–¹æ³•ï¼š

```java
Node<K,V> newNode(int hash, K key, V value, Node<K,V> e) {
    LinkedHashMap.Entry<K,V> p =
        new LinkedHashMap.Entry<K,V>(hash, key, value, e);
    linkNodeLast(p);
    return p;
}
```

```java
TreeNode<K,V> newTreeNode(int hash, K key, V value, Node<K,V> next) {
    TreeNode<K,V> p = new TreeNode<K,V>(hash, key, value, next);
    linkNodeLast(p);
    return p;
}
```

#### 9.4.2 å›¾ç¤º

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fc7533a3d26f8bb93387fa7c8bf4e13e.png)



## 10 Setæ¥å£åˆ†æ

### 10.1 Seté›†åˆä¸Mapé›†åˆçš„å…³ç³»

Setçš„å†…éƒ¨å®ç°å…¶å®æ˜¯ä¸€ä¸ªMapï¼ŒSetä¸­çš„å…ƒç´ ï¼Œå­˜å‚¨åœ¨HashMapçš„keyä¸­ã€‚å³HashSetçš„å†…éƒ¨å®ç°æ˜¯ä¸€ä¸ªHashMapï¼ŒTreeSetçš„å†…éƒ¨å®ç°æ˜¯ä¸€ä¸ªTreeMapï¼ŒLinkedHashSetçš„å†…éƒ¨å®ç°æ˜¯ä¸€ä¸ªLinkedHashMapã€‚

### 10.2 æºç å‰–æ

**HashSetæºç ï¼š**

```java
//æ„é€ å™¨
public HashSet() {
    map = new HashMap<>();
}

public HashSet(int initialCapacity, float loadFactor) {
    map = new HashMap<>(initialCapacity, loadFactor);
}

public HashSet(int initialCapacity) {
    map = new HashMap<>(initialCapacity);
}

//è¿™ä¸ªæ„é€ å™¨æ˜¯ç»™å­ç±»LinkedHashSetè°ƒç”¨çš„
HashSet(int initialCapacity, float loadFactor, boolean dummy) {
    map = new LinkedHashMap<>(initialCapacity, loadFactor);
}

//add()æ–¹æ³•ï¼š
public boolean add(E e) {
    return map.put(e, PRESENT)==null;
}
//å…¶ä¸­ï¼Œ
private transient HashMap<E,Object> map;
private static final Object PRESENT = new Object();

//iterator()æ–¹æ³•ï¼š
public Iterator<E> iterator() {
    return map.keySet().iterator();
}
```

**LinkedHashSetæºç ï¼š**

```java
//æ„é€ å™¨
public LinkedHashSet() {
    super(16, .75f, true);
} 
public LinkedHashSet(int initialCapacity) {
    super(initialCapacity, .75f, true);//è°ƒç”¨HashSetçš„æŸä¸ªæ„é€ å™¨
}
public LinkedHashSet(int initialCapacity, float loadFactor) {
    super(initialCapacity, loadFactor, true);//è°ƒç”¨HashSetçš„æŸä¸ªæ„é€ å™¨
} 
```

**TreeSetæºç ï¼š**

```java
public TreeSet() {
    this(new TreeMap<E,Object>());
}

TreeSet(NavigableMap<E,Object> m) {
    this.m = m;
}
//å…¶ä¸­ï¼Œ
private transient NavigableMap<E,Object> m;

//add()æ–¹æ³•ï¼š
public boolean add(E e) {
    return m.put(e, PRESENT)==null;
}
//å…¶ä¸­ï¼Œ
private static final Object PRESENT = new Object();
```

## 11 ã€æ‹“å±•ã€‘HashMapçš„ç›¸å…³é—®é¢˜

### 11.1 è¯´è¯´ä½ ç†è§£çš„å“ˆå¸Œç®—æ³•

hashç®—æ³•æ˜¯ä¸€ç§å¯ä»¥ä»ä»»ä½•æ•°æ®ä¸­æå–å‡ºå…¶â€œæŒ‡çº¹â€çš„æ•°æ®æ‘˜è¦ç®—æ³•ï¼Œå®ƒå°†ä»»æ„å¤§å°çš„æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªå›ºå®šå¤§å°çš„åºåˆ—ä¸Šï¼Œè¿™ä¸ªåºåˆ—è¢«ç§°ä¸ºhash codeã€æ•°æ®æ‘˜è¦æˆ–è€…æŒ‡çº¹ã€‚æ¯”è¾ƒå‡ºåçš„hashç®—æ³•æœ‰MD5ã€SHAã€‚hashæ˜¯å…·æœ‰å”¯ä¸€æ€§ä¸”ä¸å¯é€†çš„ï¼Œå”¯ä¸€æ€§æ˜¯æŒ‡ç›¸åŒçš„â€œå¯¹è±¡â€äº§ç”Ÿçš„hash codeæ°¸è¿œæ˜¯ä¸€æ ·çš„ã€‚
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/50dacdf3e91e41aad6efb8d293a48dce.png)


### 11.2 Entryä¸­çš„hashå±æ€§ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨keyçš„hashCode()è¿”å›å€¼å‘¢ï¼Ÿ

ä¸ç®¡æ˜¯JDK1.7è¿˜æ˜¯JDK1.8ä¸­ï¼Œéƒ½ä¸æ˜¯ç›´æ¥ç”¨keyçš„hashCodeå€¼ç›´æ¥ä¸table.length-1è®¡ç®—æ±‚ä¸‹æ ‡çš„ï¼Œè€Œæ˜¯å…ˆå¯¹keyçš„hashCodeå€¼è¿›è¡Œäº†ä¸€ä¸ªè¿ç®—ï¼ŒJDK1.7å’ŒJDK1.8å…³äºhash()çš„å®ç°ä»£ç ä¸ä¸€æ ·ï¼Œä½†æ˜¯ä¸ç®¡æ€ä¹ˆæ ·éƒ½æ˜¯ä¸ºäº†æé«˜hash codeå€¼ä¸ (table.length-1)çš„æŒ‰ä½ä¸å®Œçš„ç»“æœï¼Œå°½é‡çš„å‡åŒ€åˆ†å¸ƒã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ff5537d3f0526777ef8d70ab5fcf2139.png)


JDK1.7ï¼š

```java
    final int hash(Object k) {
        int h = hashSeed;
        if (0 != h && k instanceof String) {
            return sun.misc.Hashing.stringHash32((String) k);
        }

        h ^= k.hashCode();
        h ^= (h >>> 20) ^ (h >>> 12);
        return h ^ (h >>> 7) ^ (h >>> 4);
    }
```

JDK1.8ï¼š

```java
	static final int hash(Object key) {
        int h;
        return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
    }
```

è™½ç„¶ç®—æ³•ä¸åŒï¼Œä½†æ˜¯æ€è·¯éƒ½æ˜¯å°†hashCodeå€¼çš„é«˜ä½äºŒè¿›åˆ¶ä¸ä½ä½äºŒè¿›åˆ¶å€¼è¿›è¡Œäº†å¼‚æˆ–ï¼Œç„¶é«˜ä½äºŒè¿›åˆ¶å‚ä¸åˆ°indexçš„è®¡ç®—ä¸­ã€‚

ä¸ºä»€ä¹ˆè¦hashCodeå€¼çš„äºŒè¿›åˆ¶çš„é«˜ä½å‚ä¸åˆ°indexè®¡ç®—å‘¢ï¼Ÿ

å› ä¸ºä¸€ä¸ªHashMapçš„tableæ•°ç»„ä¸€èˆ¬ä¸ä¼šç‰¹åˆ«å¤§ï¼Œè‡³å°‘åœ¨ä¸æ–­æ‰©å®¹ä¹‹å‰ï¼Œé‚£ä¹ˆtable.length-1çš„å¤§éƒ¨åˆ†é«˜ä½éƒ½æ˜¯0ï¼Œç›´æ¥ç”¨hashCodeå’Œtable.length-1è¿›è¡Œ&è¿ç®—çš„è¯ï¼Œå°±ä¼šå¯¼è‡´æ€»æ˜¯åªæœ‰æœ€ä½çš„å‡ ä½æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆå°±ç®—ä½ çš„hashCode()å®ç°çš„å†å¥½ä¹Ÿéš¾ä»¥é¿å…å‘ç”Ÿç¢°æ’ï¼Œè¿™æ—¶è®©é«˜ä½å‚ä¸è¿›æ¥çš„æ„ä¹‰å°±ä½“ç°å‡ºæ¥äº†ã€‚å®ƒå¯¹hashcodeçš„ä½ä½æ·»åŠ äº†éšæœºæ€§å¹¶ä¸”æ··åˆäº†é«˜ä½çš„éƒ¨åˆ†ç‰¹å¾ï¼Œæ˜¾è‘—å‡å°‘äº†ç¢°æ’å†²çªçš„å‘ç”Ÿã€‚

### 11.3 HashMapæ˜¯å¦‚ä½•å†³å®šæŸä¸ªkey-valueå­˜åœ¨å“ªä¸ªæ¡¶çš„å‘¢ï¼Ÿ

å› ä¸ºhashå€¼æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè€Œæ•°ç»„çš„é•¿åº¦ä¹Ÿæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œæœ‰ä¸¤ç§æ€è·¯ï¼š

â‘ hash å€¼ % table.lengthä¼šå¾—åˆ°ä¸€ä¸ª[0,table.length-1]èŒƒå›´çš„å€¼ï¼Œæ­£å¥½æ˜¯ä¸‹æ ‡èŒƒå›´ï¼Œä½†æ˜¯ç”¨%è¿ç®—æ•ˆç‡æ²¡æœ‰ä½è¿ç®—ç¬¦&é«˜ã€‚

â‘¡hash å€¼ & (table.length-1)ï¼Œä»»ä½•æ•° & (table.length-1)çš„ç»“æœä¹Ÿä¸€å®šåœ¨[0, table.length-1]èŒƒå›´ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8ef6d6ddd1f69dff7e1846e51645c2cd.png)


JDK1.7ï¼š

```java
static int indexFor(int h, int length) {
    // assert Integer.bitCount(length) == 1 : "length must be a non-zero power of 2";
    return h & (length-1); //æ­¤å¤„hå°±æ˜¯hash
}
```

JDK1.8ï¼š

```java
final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) {
    Node<K,V>[] tab; Node<K,V> p; int n, i;
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;
    if ((p = tab[i = (n - 1) & hash]) == null)  // i = (n - 1) & hash
        tab[i] = newNode(hash, key, value, null);
    //....çœç•¥å¤§é‡ä»£ç 
}
```

### 11.4 ä¸ºä»€ä¹ˆè¦ä¿æŒtableæ•°ç»„ä¸€ç›´æ˜¯2çš„næ¬¡å¹‚å‘¢ï¼Ÿ

å› ä¸ºå¦‚æœæ•°ç»„çš„é•¿åº¦ä¸º2çš„næ¬¡å¹‚ï¼Œé‚£ä¹ˆtable.length-1çš„äºŒè¿›åˆ¶å°±æ˜¯ä¸€ä¸ªé«˜ä½å…¨æ˜¯0ï¼Œä½ä½å…¨æ˜¯1çš„æ•°å­—ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ¯ä¸€ä¸ªä¸‹æ ‡ä½ç½®éƒ½æœ‰æœºä¼šè¢«ç”¨åˆ°ã€‚

ä¸¾ä¾‹1ï¼š

```java
hashCodeå€¼æ˜¯   ï¼Ÿ
table.lengthæ˜¯10
table.length-1æ˜¯9

ï¼Ÿ   ????????
9	 00001001
&_____________
	 00000000	[0]
	 00000001	[1]
	 00001000	[8]
	 00001001	[9]
	 ä¸€å®š[0]~[9]
```

ä¸¾ä¾‹2ï¼š

```java
hashCodeå€¼æ˜¯   ï¼Ÿ
table.lengthæ˜¯16
table.length-1æ˜¯15

ï¼Ÿ   ????????
15	 00001111
&_____________
	 00000000	[0]
	 00000001	[1]
	 00000010	[2]
	 00000011	[3]
	 ...
	 00001111    [15]
	 èŒƒå›´æ˜¯[0,15]ï¼Œä¸€å®šåœ¨[0,table.length-1]èŒƒå›´å†…
```

### 11.5 è§£å†³[index]å†²çªé—®é¢˜

è™½ç„¶ä»è®¾è®¡hashCode()åˆ°ä¸Šé¢HashMapçš„hash()å‡½æ•°ï¼Œéƒ½å°½é‡å‡å°‘å†²çªï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡è¿”å›çš„hashCodeå€¼ç›¸åŒï¼Œæˆ–è€…hashCodeå€¼å°±ç®—ä¸åŒï¼Œé€šè¿‡hash()å‡½æ•°è®¡ç®—åï¼Œå¾—åˆ°çš„indexä¹Ÿä¼šå­˜åœ¨å¤§é‡çš„ç›¸åŒï¼Œå› æ­¤keyåˆ†å¸ƒå®Œå…¨å‡åŒ€çš„æƒ…å†µæ˜¯ä¸å­˜åœ¨çš„ã€‚é‚£ä¹ˆå‘ç”Ÿç¢°æ’å†²çªæ—¶æ€ä¹ˆåŠï¼Ÿ

JDK1.8ä¹‹é—´ä½¿ç”¨ï¼šæ•°ç»„+é“¾è¡¨çš„ç»“æ„ã€‚
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/96ede5f1592cf73e03f2cf29390acec8.png)


JDK1.8ä¹‹åä½¿ç”¨ï¼šæ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘çš„ç»“æ„ã€‚
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/cd487cf446c7e903587a145ac98a186d.png)


å³hashç›¸åŒæˆ–hash&(table.lengt-1)çš„å€¼ç›¸åŒï¼Œé‚£ä¹ˆå°±å­˜å…¥åŒä¸€ä¸ªâ€œæ¡¶â€table[index]ä¸­ï¼Œä½¿ç”¨é“¾è¡¨æˆ–çº¢é»‘æ ‘è¿æ¥èµ·æ¥ã€‚

### 11.6 ä¸ºä»€ä¹ˆJDK1.8ä¼šå‡ºç°çº¢é»‘æ ‘å’Œé“¾è¡¨å…±å­˜å‘¢ï¼Ÿ

å› ä¸ºå½“å†²çªæ¯”è¾ƒä¸¥é‡æ—¶ï¼Œtable[index]ä¸‹é¢çš„é“¾è¡¨å°±ä¼šå¾ˆé•¿ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æŸ¥æ‰¾æ•ˆç‡å¤§å¤§é™ä½ï¼Œè€Œå¦‚æœæ­¤æ—¶é€‰ç”¨äºŒå‰æ ‘å¯ä»¥å¤§å¤§æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚

ä½†æ˜¯äºŒå‰æ ‘çš„ç»“æ„åˆè¿‡äºå¤æ‚ï¼Œå ç”¨å†…å­˜ä¹Ÿè¾ƒå¤šï¼Œå¦‚æœç»“ç‚¹ä¸ªæ•°æ¯”è¾ƒå°‘çš„æ—¶å€™ï¼Œé‚£ä¹ˆé€‰æ‹©é“¾è¡¨åè€Œæ›´ç®€å•ã€‚æ‰€ä»¥ä¼šå‡ºç°çº¢é»‘æ ‘å’Œé“¾è¡¨å…±å­˜ã€‚

### 11.7 åŠ è½½å› å­çš„å€¼å¤§å°æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ

å¦‚æœå¤ªå¤§ï¼Œthresholdå°±ä¼šå¾ˆå¤§ï¼Œé‚£ä¹ˆå¦‚æœå†²çªæ¯”è¾ƒä¸¥é‡çš„è¯ï¼Œå°±ä¼šå¯¼è‡´table[index]ä¸‹é¢çš„ç»“ç‚¹ä¸ªæ•°å¾ˆå¤šï¼Œå½±å“æ•ˆç‡ã€‚

å¦‚æœå¤ªå°ï¼Œthresholdå°±ä¼šå¾ˆå°ï¼Œé‚£ä¹ˆæ•°ç»„æ‰©å®¹çš„é¢‘ç‡å°±ä¼šæé«˜ï¼Œæ•°ç»„çš„ä½¿ç”¨ç‡ä¹Ÿä¼šé™ä½ï¼Œé‚£ä¹ˆä¼šé€ æˆç©ºé—´çš„æµªè´¹ã€‚

### 11.8 ä»€ä¹ˆæ—¶å€™æ ‘åŒ–ï¼Ÿä»€ä¹ˆæ—¶å€™åæ ‘åŒ–ï¼Ÿ

```java
static final int TREEIFY_THRESHOLD = 8;//æ ‘åŒ–é˜ˆå€¼
static final int UNTREEIFY_THRESHOLD = 6;//åæ ‘åŒ–é˜ˆå€¼
static final int MIN_TREEIFY_CAPACITY = 64;//æœ€å°æ ‘åŒ–å®¹é‡
```

* å½“æŸtable[index]ä¸‹çš„é“¾è¡¨çš„ç»“ç‚¹ä¸ªæ•°è¾¾åˆ°8ï¼Œå¹¶ä¸”table.length>=64ï¼Œé‚£ä¹ˆå¦‚æœæ–°Entryå¯¹è±¡è¿˜æ·»åŠ åˆ°è¯¥table[index]ä¸­ï¼Œé‚£ä¹ˆå°±ä¼šå°†table[index]çš„é“¾è¡¨è¿›è¡Œæ ‘åŒ–ã€‚

* å½“æŸtable[index]ä¸‹çš„çº¢é»‘æ ‘ç»“ç‚¹ä¸ªæ•°å°‘äº6ä¸ªï¼Œæ­¤æ—¶ï¼Œ
  * å½“ç»§ç»­åˆ é™¤table[index]ä¸‹çš„æ ‘ç»“ç‚¹ï¼Œæœ€åè¿™ä¸ªæ ¹ç»“ç‚¹çš„å·¦å³ç»“ç‚¹æœ‰nullï¼Œæˆ–æ ¹ç»“ç‚¹çš„å·¦ç»“ç‚¹çš„å·¦ç»“ç‚¹ä¸ºnullï¼Œä¼šåæ ‘åŒ–
  * å½“é‡æ–°æ·»åŠ æ–°çš„æ˜ å°„å…³ç³»åˆ°mapä¸­ï¼Œå¯¼è‡´äº†mapé‡æ–°æ‰©å®¹äº†ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœtable[index]ä¸‹é¢è¿˜æ˜¯å°äºç­‰äº6çš„ä¸ªæ•°ï¼Œé‚£ä¹ˆä¼šåæ ‘åŒ–

```java
package com.atguigu.map;

public class MyKey{
    int num;

    public MyKey(int num) {
        super();
        this.num = num;
    }

    @Override
    public int hashCode() {
        if(num<=20){
            return 1;
        }else{
            final int prime = 31;
            int result = 1;
            result = prime * result + num;
            return result;
        }
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj)
            return true;
        if (obj == null)
            return false;
        if (getClass() != obj.getClass())
            return false;
        MyKey other = (MyKey) obj;
        if (num != other.num)
            return false;
        return true;
    }

}

```

```java
package com.atguigu.map;

import org.junit.Test;

import java.util.HashMap;

public class TestHashMapMyKey {
    @Test
    public void test1(){
        //è¿™é‡Œä¸ºäº†æ¼”ç¤ºçš„æ•ˆæœï¼Œæˆ‘ä»¬é€ ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼Œè¿™ä¸ªç±»çš„hashCodeï¼ˆï¼‰æ–¹æ³•è¿”å›å›ºå®šå€¼1
        //å› ä¸ºè¿™æ ·å°±å¯ä»¥é€ æˆå†²çªé—®é¢˜ï¼Œä½¿å¾—å®ƒä»¬éƒ½å­˜åˆ°table[1]ä¸­
        HashMap<MyKey, String> map = new HashMap<>();
        for (int i = 1; i <= 11; i++) {
            map.put(new MyKey(i), "value"+i);//æ ‘åŒ–æ¼”ç¤º
        }
    }
    @Test
    public void test2(){
        HashMap<MyKey, String> map = new HashMap<>();
        for (int i = 1; i <= 11; i++) {
            map.put(new MyKey(i), "value"+i);
        }
        for (int i = 1; i <=11; i++) {
            map.remove(new MyKey(i));//åæ ‘åŒ–æ¼”ç¤º
        }
    }
    @Test
    public void test3(){
        HashMap<MyKey, String> map = new HashMap<>();
        for (int i = 1; i <= 11; i++) {
            map.put(new MyKey(i), "value"+i);
        }

        for (int i = 1; i <=5; i++) {
            map.remove(new MyKey(i));
        }//table[1]ä¸‹å‰©ä½™6ä¸ªç»“ç‚¹

        for (int i = 21; i <= 100; i++) {
            map.put(new MyKey(i), "value"+i);//æ·»åŠ åˆ°æ‰©å®¹æ—¶ï¼Œåæ ‘åŒ–
        }
    }
}

```

### 11.9 key-valueä¸­çš„keyæ˜¯å¦å¯ä»¥ä¿®æ”¹ï¼Ÿ

key-valueå­˜å‚¨åˆ°HashMapä¸­ä¼šå­˜å‚¨keyçš„hashå€¼ï¼Œè¿™æ ·å°±ä¸ç”¨åœ¨æ¯æ¬¡æŸ¥æ‰¾æ—¶é‡æ–°è®¡ç®—æ¯ä¸€ä¸ªEntryæˆ–Nodeï¼ˆTreeNodeï¼‰çš„hashå€¼äº†ï¼Œå› æ­¤å¦‚æœå·²ç»putåˆ°Mapä¸­çš„key-valueï¼Œå†ä¿®æ”¹keyçš„å±æ€§ï¼Œè€Œè¿™ä¸ªå±æ€§åˆå‚ä¸hashcodeå€¼çš„è®¡ç®—ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´åŒ¹é…ä¸ä¸Šã€‚

è¿™ä¸ªè§„åˆ™ä¹ŸåŒæ ·é€‚ç”¨äºLinkedHashMapã€HashSetã€LinkedHashSetã€Hashtableç­‰æ‰€æœ‰æ•£åˆ—å­˜å‚¨ç»“æ„çš„é›†åˆã€‚

### 11.10 JDK1.7ä¸­HashMapçš„å¾ªç¯é“¾è¡¨æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/f9231a1a0145de2456b7f364371a6e58.png)


é¿å…HashMapå‘ç”Ÿæ­»å¾ªç¯çš„å¸¸ç”¨è§£å†³æ–¹æ¡ˆï¼š

- å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ConcurrentHashMapæ›¿ä»£HashMapï¼Œæ¨è
- å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨synchronizedæˆ–LockåŠ é”ï¼Œä½†ä¼šå½±å“æ€§èƒ½ï¼Œä¸æ¨è
- å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„Hashtableæ›¿ä»£ï¼Œæ€§èƒ½ä½ï¼Œä¸æ¨è

HashMapæ­»å¾ªç¯åªä¼šå‘ç”Ÿåœ¨JDK1.7ç‰ˆæœ¬ä¸­ï¼Œä¸»è¦åŸå› ï¼šå¤´æ’æ³•+é“¾è¡¨+å¤šçº¿ç¨‹å¹¶å‘+æ‰©å®¹ã€‚

åœ¨JDK1.8ä¸­ï¼ŒHashMapæ”¹ç”¨å°¾æ’æ³•ï¼Œè§£å†³äº†é“¾è¡¨æ­»å¾ªç¯çš„é—®é¢˜ã€‚