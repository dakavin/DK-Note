---
æ–‡ç« æ ‡é¢˜: "[[18_JDK8-17æ–°ç‰¹æ€§ï¼ˆä¸‹ï¼‰]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æ–‡ç« æ¦‚è¿°JDK 9-17çš„æ–°ç‰¹æ€§ï¼Œæ¶µç›–äº†`jShell`ã€`try-with-resources`ã€`var`ã€æ¨¡å¼åŒ¹é…ã€`switch`è¡¨è¾¾å¼ã€æ–‡æœ¬å—ã€`Record`ã€`å¯†å°ç±»`ç­‰è¯­æ³•å¢å¼ºã€‚åŒæ—¶ï¼Œä»‹ç»äº†`Optional`ã€`String` APIæ”¹è¿›åŠ`G1`ã€`Shenandoah`ã€`ZGC`ç­‰åƒåœ¾å›æ”¶å™¨æ¼”è¿›ï¼Œæ—¨åœ¨æå‡Javaå¼€å‘æ•ˆç‡å’Œæ€§èƒ½ã€‚
æ–‡ç« æ ‡ç­¾:
- "Javaæ–°ç‰¹æ€§"
- "JDK9-17"
- "ç°ä»£Javaè¯­æ³•"
- "Try-with-resources"
- "Optional API"
- "åƒåœ¾å›æ”¶å™¨"
- "ZGC"
- "Shenandoah GC"
ç›¸å…³æ–‡ç« : æš‚æ—  ğŸ¤·
æ–‡ç« åˆ†ç±»: "ğŸ’» ç¼–ç¨‹è¯­è¨€"
æ–‡ç« è·¯å¾„: "02-ğŸ’» ç¼–ç¨‹è¯­è¨€/01-â˜• JavaæŠ€æœ¯æ ˆ/02-ğŸ“š åŸºç¡€è¯­æ³•/1_JavaåŸºç¡€/18_JDK8-17æ–°ç‰¹æ€§ï¼ˆä¸‹ï¼‰.md"
æ–‡ç« éš¾åº¦: åˆçº§ ğŸ’§
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­â­ ç²¾é€šå¿…å¤‡
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2025-05-26 07:15:21
---

## 1 æ–°è¯­æ³•ç»“æ„

æ–°çš„è¯­æ³•ç»“æ„ï¼Œä¸ºæˆ‘ä»¬å‹¾å‹’å‡ºäº† Java è¯­æ³•è¿›åŒ–çš„ä¸€ä¸ªè¶‹åŠ¿ï¼Œå°†å¼€å‘è€…ä»`å¤æ‚ã€ç¹ç`çš„ä½å±‚æ¬¡æŠ½è±¡ä¸­é€æ¸è§£æ”¾å‡ºæ¥ï¼Œä»¥æ›´é«˜å±‚æ¬¡ã€æ›´ä¼˜é›…çš„æŠ½è±¡ï¼Œæ—¢`é™ä½ä»£ç é‡`ï¼Œåˆé¿å…æ„å¤–ç¼–ç¨‹é”™è¯¯çš„å‡ºç°ï¼Œè¿›è€Œæé«˜ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡ã€‚

### 1.1 Javaçš„REPLå·¥å…·ï¼š jShellå‘½ä»¤

**JDK9çš„æ–°ç‰¹æ€§**

Java ç»ˆäºæ‹¥æœ‰äº†åƒPython å’Œ Scala ä¹‹ç±»è¯­è¨€çš„REPLå·¥å…·ï¼ˆäº¤äº’å¼ç¼–ç¨‹ç¯å¢ƒï¼Œread - evaluate - print - loopï¼‰ï¼š`jShell`ã€‚ä»¥äº¤äº’å¼çš„æ–¹å¼å¯¹è¯­å¥å’Œè¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ã€‚`å³å†™å³å¾—`ã€`å¿«é€Ÿè¿è¡Œ`ã€‚

åˆ©ç”¨jShellåœ¨æ²¡æœ‰åˆ›å»ºç±»çš„æƒ…å†µä¸‹ï¼Œåœ¨å‘½ä»¤è¡Œé‡Œç›´æ¥å£°æ˜å˜é‡ï¼Œè®¡ç®—è¡¨è¾¾å¼ï¼Œæ‰§è¡Œè¯­å¥ã€‚æ— éœ€è·Ÿäººè§£é‡Šâ€public static void main(String[] args)â€è¿™å¥"åºŸè¯"ã€‚

**ä½¿ç”¨ä¸¾ä¾‹**

- è°ƒå‡ºjShell
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/6cea3838e8eaf7576ef8d1c7f1893931.png)



- è·å–å¸®åŠ©
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/16358848dd1a2d79ae008475b6960187.png)



- åŸºæœ¬ä½¿ç”¨
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/22782d42aec266a11837cfc011033c2a.png)


- å¯¼å…¥æŒ‡å®šçš„åŒ…

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/8d273e9ae8a3c0dd6bc32c0a26cb2429.png)


- é»˜è®¤å·²ç»å¯¼å…¥å¦‚ä¸‹çš„æ‰€æœ‰åŒ…ï¼šï¼ˆåŒ…å«java.langåŒ…ï¼‰
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/a8b8594b6ab87de124bf991f9fbbebef.png)



- åªéœ€æŒ‰ä¸‹ Tab é”®ï¼Œå°±èƒ½è‡ªåŠ¨è¡¥å…¨ä»£ç 
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/bc30c12f858eaf122988361aefacea13.png)



- åˆ—å‡ºå½“å‰ session é‡Œæ‰€æœ‰æœ‰æ•ˆçš„ä»£ç ç‰‡æ®µ

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/f87c20d0c382349bac8d58e80d133ff2.png)




- æŸ¥çœ‹å½“å‰ session ä¸‹æ‰€æœ‰åˆ›å»ºè¿‡çš„å˜é‡
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/e144effe53de382512b0c632980f6253.png)



- æŸ¥çœ‹å½“å‰ session ä¸‹æ‰€æœ‰åˆ›å»ºè¿‡çš„æ–¹æ³•
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/6e1f21e9a3066ee5d5e8a4402db3de05.png)



> Tipsï¼šæˆ‘ä»¬è¿˜å¯ä»¥é‡æ–°å®šä¹‰ç›¸åŒæ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨çš„æ–¹æ³•ï¼Œå³å¯¹ç°æœ‰æ–¹æ³•çš„ä¿®æ”¹ï¼ˆæˆ–è¦†ç›–ï¼‰ã€‚

- ä½¿ç”¨å¤–éƒ¨ä»£ç ç¼–è¾‘å™¨æ¥ç¼–å†™ Java ä»£ç 
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/01b26ca457c3ad0ce313b1c059ad0794.png)


ä»å¤–éƒ¨æ–‡ä»¶åŠ è½½æºä»£ç ã€HelloWorld.javaã€‘

```java
/**
 * Created by songhongkang
 */
public void printHello() {
    System.out.println("é©¬ä¸Š2023å¹´äº†ï¼Œå°šç¡…è°·ç¥æ‰€æœ‰çš„è°·ç²‰å…ƒæ—¦å¿«ä¹ï¼");
}
printHello();

```

- ä½¿ç”¨/openå‘½ä»¤è°ƒç”¨
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/20d3f850595c2b28f91d384f3003f0ef.png)


- é€€å‡ºjShell
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/6a07eb5d26379d629c0eaeab211736f0.png)



### 1.2 å¼‚å¸¸å¤„ç†ä¹‹try-catchèµ„æºå…³é—­

åœ¨JDK7 ä¹‹å‰ï¼Œæˆ‘ä»¬è¿™æ ·å¤„ç†èµ„æºçš„å…³é—­ï¼š

```java
@Test
public void test01() {
    FileWriter fw = null;
    BufferedWriter bw = null;
    try {
        fw = new FileWriter("d:/1.txt");
        bw = new BufferedWriter(fw);

        bw.write("hello");
    } catch (IOException e) {
        e.printStackTrace();
    } finally {
        try {
            if (bw != null) {
                bw.close();
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        try {
            if (fw != null) {
                fw.close();
            }
        } catch (IOException e) {
            e.printStackTrace();
        }

    }
}
```

**JDK7çš„æ–°ç‰¹æ€§**

åœ¨tryçš„åé¢å¯ä»¥å¢åŠ ä¸€ä¸ª()ï¼Œåœ¨æ‹¬å·ä¸­å¯ä»¥å£°æ˜æµå¯¹è±¡å¹¶åˆå§‹åŒ–ã€‚tryä¸­çš„ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œä¼šè‡ªåŠ¨æŠŠæµå¯¹è±¡é‡Šæ”¾ï¼Œå°±ä¸ç”¨å†™finallyäº†ã€‚

æ ¼å¼ï¼š

```java
try(èµ„æºå¯¹è±¡çš„å£°æ˜å’Œåˆå§‹åŒ–){
    ä¸šåŠ¡é€»è¾‘ä»£ç ,å¯èƒ½ä¼šäº§ç”Ÿå¼‚å¸¸
}catch(å¼‚å¸¸ç±»å‹1 e){
    å¤„ç†å¼‚å¸¸ä»£ç 
}catch(å¼‚å¸¸ç±»å‹2 e){
    å¤„ç†å¼‚å¸¸ä»£ç 
}
```

è¯´æ˜ï¼š

1ã€åœ¨try()ä¸­å£°æ˜çš„èµ„æºï¼Œæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œæ— è®ºæ˜¯å¦å¤„ç†å¼‚å¸¸ï¼Œéƒ½ä¼šè‡ªåŠ¨å…³é—­èµ„æºå¯¹è±¡ï¼Œä¸ç”¨æ‰‹åŠ¨å…³é—­äº†ã€‚

2ã€è¿™äº›èµ„æºå®ç°ç±»å¿…é¡»å®ç°AutoCloseableæˆ–Closeableæ¥å£ï¼Œå®ç°å…¶ä¸­çš„close()æ–¹æ³•ã€‚Closeableæ˜¯AutoCloseableçš„å­æ¥å£ã€‚Java7å‡ ä¹æŠŠæ‰€æœ‰çš„â€œèµ„æºç±»â€ï¼ˆåŒ…æ‹¬æ–‡ä»¶IOçš„å„ç§ç±»ã€JDBCç¼–ç¨‹çš„Connectionã€Statementç­‰æ¥å£â€¦ï¼‰éƒ½è¿›è¡Œäº†æ”¹å†™ï¼Œæ”¹å†™åèµ„æºç±»éƒ½å®ç°äº†AutoCloseableæˆ–Closeableæ¥å£ï¼Œå¹¶å®ç°äº†close()æ–¹æ³•ã€‚

3ã€å†™åˆ°try()ä¸­çš„èµ„æºç±»çš„å˜é‡é»˜è®¤æ˜¯finalå£°æ˜çš„ï¼Œä¸èƒ½ä¿®æ”¹ã€‚

ä¸¾ä¾‹ï¼š

```java
//ä¸¾ä¾‹1
@Test
public void test02() {
    try (
        FileWriter fw = new FileWriter("d:/1.txt");
        BufferedWriter bw = new BufferedWriter(fw);
    ) {
        bw.write("hello");
    } catch (IOException e) {
        e.printStackTrace();
    }
}

//ä¸¾ä¾‹2
@Test
public void test03() {
    //ä»d:/1.txt(utf-8)æ–‡ä»¶ä¸­ï¼Œè¯»å–å†…å®¹ï¼Œå†™åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹1.txt(gbk)æ–‡ä»¶ä¸­
    try (
        FileInputStream fis = new FileInputStream("d:/1.txt");
        InputStreamReader isr = new InputStreamReader(fis, "utf-8");
        BufferedReader br = new BufferedReader(isr);

        FileOutputStream fos = new FileOutputStream("1.txt");
        OutputStreamWriter osw = new OutputStreamWriter(fos, "gbk");
        BufferedWriter bw = new BufferedWriter(osw);
    ) {
        String str;
        while ((str = br.readLine()) != null) {
            bw.write(str);
            bw.newLine();
        }
    } catch (FileNotFoundException e) {
        e.printStackTrace();
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

**JDK9çš„æ–°ç‰¹æ€§**

tryçš„å‰é¢å¯ä»¥å®šä¹‰æµå¯¹è±¡ï¼Œtryåé¢çš„()ä¸­å¯ä»¥ç›´æ¥å¼•ç”¨æµå¯¹è±¡çš„åç§°ã€‚åœ¨tryä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œæµå¯¹è±¡ä¹Ÿå¯ä»¥é‡Šæ”¾æ‰ï¼Œä¹Ÿä¸ç”¨å†™finallyäº†ã€‚

æ ¼å¼ï¼š

```java
A a = new A();
B b = new B();
try(a;b){
    å¯èƒ½äº§ç”Ÿçš„å¼‚å¸¸ä»£ç 
}catch(å¼‚å¸¸ç±»å å˜é‡å){
    å¼‚å¸¸å¤„ç†çš„é€»è¾‘
}
```

ä¸¾ä¾‹ï¼š

```java
@Test
public void test04() {
    InputStreamReader reader = new InputStreamReader(System.in);
    OutputStreamWriter writer = new OutputStreamWriter(System.out);
    try (reader; writer) {
        //readeræ˜¯finalçš„ï¼Œä¸å¯å†è¢«èµ‹å€¼
        //   reader = null;

    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

### 1.3 å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­

**JDK 10çš„æ–°ç‰¹æ€§**

å±€éƒ¨å˜é‡çš„æ˜¾ç¤ºç±»å‹å£°æ˜ï¼Œå¸¸å¸¸è¢«è®¤ä¸ºæ˜¯ä¸å¿…é¡»çš„ï¼Œç»™ä¸€ä¸ªå¥½å¬çš„åå­—åè€Œå¯ä»¥å¾ˆæ¸…æ¥šçš„è¡¨è¾¾å‡ºä¸‹é¢åº”è¯¥æ€æ ·ç»§ç»­ã€‚æœ¬æ–°ç‰¹æ€§å…è®¸å¼€å‘äººå‘˜çœç•¥é€šå¸¸ä¸å¿…è¦çš„å±€éƒ¨å˜é‡ç±»å‹å£°æ˜ï¼Œä»¥å¢å¼ºJavaè¯­è¨€çš„ä½“éªŒæ€§ã€å¯è¯»æ€§ã€‚

- ä½¿ç”¨ä¸¾ä¾‹


```java
//1.å±€éƒ¨å˜é‡çš„å®ä¾‹åŒ–
var list = new ArrayList<String>();

var set = new LinkedHashSet<Integer>();

//2.å¢å¼ºforå¾ªç¯ä¸­çš„ç´¢å¼•
for (var v : list) {
    System.out.println(v);
}

//3.ä¼ ç»Ÿforå¾ªç¯ä¸­
for (var i = 0; i < 100; i++) {
    System.out.println(i);
}

//4. è¿”å›å€¼ç±»å‹å«å¤æ‚æ³›å‹ç»“æ„
var iterator = set.iterator();
//Iterator<Map.Entry<Integer, Student>> iterator = set.iterator();

```

- ä¸é€‚ç”¨åœºæ™¯
  - å£°æ˜ä¸€ä¸ªæˆå‘˜å˜é‡
  - å£°æ˜ä¸€ä¸ªæ•°ç»„å˜é‡ï¼Œå¹¶ä¸ºæ•°ç»„é™æ€åˆå§‹åŒ–ï¼ˆçœç•¥newçš„æƒ…å†µä¸‹ï¼‰
  - æ–¹æ³•çš„è¿”å›å€¼ç±»å‹
  - æ–¹æ³•çš„å‚æ•°ç±»å‹
  - æ²¡æœ‰åˆå§‹åŒ–çš„æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡å£°æ˜
  - ä½œä¸ºcatchå—ä¸­å¼‚å¸¸ç±»å‹
  - Lambdaè¡¨è¾¾å¼ä¸­å‡½æ•°å¼æ¥å£çš„ç±»å‹
  - æ–¹æ³•å¼•ç”¨ä¸­å‡½æ•°å¼æ¥å£çš„ç±»å‹

ä»£ç ä¸¾ä¾‹ï¼š

å£°æ˜ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œå¹¶åˆå§‹åŒ–å€¼ä¸ºnull
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/643a27b4de63959a91cb5f9550d13391.png)


å£°æ˜ä¸€ä¸ªæ•°ç»„å˜é‡ï¼Œå¹¶ä¸ºæ•°ç»„é™æ€åˆå§‹åŒ–ï¼ˆçœç•¥newçš„æƒ…å†µä¸‹ï¼‰
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/363057578fcac008226a4da24106b7db.png)


æ²¡æœ‰åˆå§‹åŒ–çš„æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡å£°æ˜
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/73d8108574453615240ea97d407adbd3.png)


æ–¹æ³•çš„è¿”å›å€¼ç±»å‹
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b259f07a14fd2650414eb367030a7d84.png)


æ–¹æ³•çš„å‚æ•°ç±»å‹
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/88291f6bd6d56804f12a2cd1e53a397c.png)



æ„é€ å™¨çš„å‚æ•°ç±»å‹

 ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fdf1ccf3bf522595e4c3e146a5d87883.png)



ä½œä¸ºcatchå—ä¸­å¼‚å¸¸ç±»å‹
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/12eed56315d55408f41ecbd9757190b4.png)



Lambdaè¡¨è¾¾å¼ä¸­å‡½æ•°å¼æ¥å£çš„ç±»å‹

 ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/493fb1241b417f0325d98e627b92e193.png)



æ–¹æ³•å¼•ç”¨ä¸­å‡½æ•°å¼æ¥å£çš„ç±»å‹

 ![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/abc50041a333e073c744f5d1b47892ab.png)

**æ³¨æ„ï¼š**

- varä¸æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»å‹åï¼Œå°†å®ƒä½œä¸ºå˜é‡çš„ç±»å‹ã€‚ä¸èƒ½ä½¿ç”¨varä½œä¸ºç±»åã€‚

- è¿™ä¸æ˜¯JavaScriptã€‚varå¹¶ä¸ä¼šæ”¹å˜ Javaæ˜¯ä¸€é—¨é™æ€ç±»å‹è¯­è¨€çš„äº‹å®ã€‚ç¼–è¯‘å™¨è´Ÿè´£æ¨æ–­å‡ºç±»å‹ï¼Œå¹¶æŠŠç»“æœå†™å…¥å­—èŠ‚ç æ–‡ä»¶ï¼Œå°±å¥½åƒæ˜¯å¼€å‘äººå‘˜è‡ªå·±æ•²å…¥ç±»å‹ä¸€æ ·ã€‚

### 1.4 instanceofçš„æ¨¡å¼åŒ¹é…

**JDK14ä¸­é¢„è§ˆç‰¹æ€§ï¼š**

instanceof æ¨¡å¼åŒ¹é…é€šè¿‡æä¾›æ›´ä¸ºç®€ä¾¿çš„è¯­æ³•ï¼Œæ¥æé«˜ç”Ÿäº§åŠ›ã€‚æœ‰äº†è¯¥åŠŸèƒ½ï¼Œå¯ä»¥å‡å°‘Javaç¨‹åºä¸­æ˜¾å¼å¼ºåˆ¶è½¬æ¢çš„æ•°é‡ï¼Œå®ç°æ›´ç²¾ç¡®ã€ç®€æ´çš„ç±»å‹å®‰å…¨çš„ä»£ç ã€‚

Java 14ä¹‹å‰æ—§å†™æ³•ï¼š

```java
if(obj instanceof String){
    String str = (String)obj; //éœ€è¦å¼ºè½¬
    .. str.contains(..)..
}else{
    ...
}
```

Java 14æ–°ç‰¹æ€§å†™æ³•ï¼š

```java
if(obj instanceof String str){
    .. str.contains(..)..
}else{
    ...
}
```

ä¸¾ä¾‹ï¼š

```java
/**
 * instanceofçš„æ¨¡å¼åŒ¹é…ï¼ˆé¢„è§ˆï¼‰
 *
 * @author shkstart
 * @create ä¸Šåˆ 11:32
 */
public class Feature01 {
    @Test
    public void test1(){

        Object obj = new String("hello,Java14");
        obj = null;//åœ¨ä½¿ç”¨null åŒ¹é…instanceof æ—¶ï¼Œè¿”å›éƒ½æ˜¯false.
        if(obj instanceof String){
            String str = (String) obj;
            System.out.println(str.contains("Java"));
        }else{
            System.out.println("éStringç±»å‹");
        }

        //ä¸¾ä¾‹1ï¼š
        if(obj instanceof String str){ //æ–°ç‰¹æ€§ï¼šçœå»äº†å¼ºåˆ¶ç±»å‹è½¬æ¢çš„è¿‡ç¨‹
            System.out.println(str.contains("Java"));
        }else{
            System.out.println("éStringç±»å‹");
        }
    }
}

// ä¸¾ä¾‹2
class InstanceOf{

    String str = "abc";

    public void test(Object obj){

        if(obj instanceof String str){//æ­¤æ—¶çš„strçš„ä½œç”¨åŸŸä»…é™äºifç»“æ„å†…ã€‚
            System.out.println(str.toUpperCase());
        }else{
            System.out.println(str.toLowerCase());
        }

    }

}

//ä¸¾ä¾‹3ï¼š
class Monitor{
    private String model;
    private double price;

//    public boolean equals(Object o){
//        if(o instanceof Monitor other){
//            if(model.equals(other.model) && price == other.price){
//                return true;
//            }
//        }
//        return false;
//    }


    public boolean equals(Object o){
        return o instanceof Monitor other && model.equals(other.model) && price == other.price;
    }

}
```

**JDK15ä¸­ç¬¬äºŒæ¬¡é¢„è§ˆï¼š**

æ²¡æœ‰ä»»ä½•æ›´æ”¹ã€‚

**JDK16ä¸­è½¬æ­£ç‰¹æ€§ï¼š**

åœ¨Java16ä¸­è½¬æ­£ã€‚

### 1.5 switchè¡¨è¾¾å¼

ä¼ ç»Ÿswitchå£°æ˜è¯­å¥çš„å¼Šç«¯ï¼š

- åŒ¹é…æ˜¯è‡ªä¸Šè€Œä¸‹çš„ï¼Œå¦‚æœå¿˜è®°å†™breakï¼Œåé¢çš„caseè¯­å¥ä¸è®ºåŒ¹é…ä¸å¦éƒ½ä¼šæ‰§è¡Œï¼› --->caseç©¿é€
- æ‰€æœ‰çš„caseè¯­å¥å…±ç”¨ä¸€ä¸ªå—èŒƒå›´ï¼Œåœ¨ä¸åŒçš„caseè¯­å¥å®šä¹‰çš„å˜é‡åä¸èƒ½é‡å¤ï¼›
- ä¸èƒ½åœ¨ä¸€ä¸ªcaseé‡Œå†™å¤šä¸ªæ‰§è¡Œç»“æœä¸€è‡´çš„æ¡ä»¶ï¼›
- æ•´ä¸ªswitchä¸èƒ½ä½œä¸ºè¡¨è¾¾å¼è¿”å›å€¼ï¼›

```java
//å¸¸è§é”™è¯¯å®ç°
switch(month){
    case 3|4|5://3|4|5 ç”¨äº†ä½è¿ç®—ç¬¦ï¼Œ11 | 100 | 101ç»“æœæ˜¯ 111æ˜¯7
        System.out.println("æ˜¥å­£");
        break;
    case 6|7|8://6|7|8ç”¨äº†ä½è¿ç®—ç¬¦ï¼Œ110 | 111 | 1000ç»“æœæ˜¯1111æ˜¯15
        System.out.println("å¤å­£");
        break;
    case 9|10|11://9|10|11ç”¨äº†ä½è¿ç®—ç¬¦ï¼Œ1001 | 1010 | 1011ç»“æœæ˜¯1011æ˜¯11
        System.out.println("ç§‹å­£");
        break;
    case 12|1|2://12|1|2 ç”¨äº†ä½è¿ç®—ç¬¦ï¼Œ1100 | 1 | 10 ç»“æœæ˜¯1111ï¼Œæ˜¯15
        System.out.println("å†¬å­£");
        break;
    default:
        System.out.println("è¾“å…¥æœ‰è¯¯");
}
```

**JDK12ä¸­é¢„è§ˆç‰¹æ€§ï¼š**

- Java 12å°†ä¼šå¯¹switchå£°æ˜è¯­å¥è¿›è¡Œæ‰©å±•ï¼Œä½¿ç”¨`case L ->`æ¥æ›¿ä»£ä»¥å‰çš„`break;`ï¼Œçœå»äº† break è¯­å¥ï¼Œé¿å…äº†å› å°‘å†™ break è€Œå‡ºé”™ã€‚

- åŒæ—¶å°†å¤šä¸ª case åˆå¹¶åˆ°ä¸€è¡Œï¼Œæ˜¾å¾—ç®€æ´ã€æ¸…æ™°ï¼Œä¹Ÿæ›´åŠ ä¼˜é›…çš„è¡¨è¾¾é€»è¾‘åˆ†æ”¯ã€‚

- ä¸ºäº†ä¿æŒå…¼å®¹æ€§ï¼Œcase æ¡ä»¶è¯­å¥ä¸­ä¾ç„¶å¯ä»¥ä½¿ç”¨å­—ç¬¦` :` ï¼Œä½†æ˜¯åŒä¸€ä¸ª switch ç»“æ„é‡Œä¸èƒ½æ··ç”¨` ->` å’Œ` :` ï¼Œå¦åˆ™ç¼–è¯‘é”™è¯¯ã€‚


ä¸¾ä¾‹ï¼š

Java 12ä¹‹å‰

```java
/**
 * @author shkstart
 * @create ä¸‹åˆ 4:47
 */
public class SwitchTest {
    public static void main(String[] args) {
        int numberOfLetters;
        Fruit fruit = Fruit.APPLE;
        switch (fruit) {
            case PEAR:
                numberOfLetters = 4;
                break;
            case APPLE:
            case GRAPE:
            case MANGO:
                numberOfLetters = 5;
                break;
            case ORANGE:
            case PAPAYA:
                numberOfLetters = 6;
                break;
            default:
                throw new IllegalStateException("No Such Fruit:" + fruit);
        }
        System.out.println(numberOfLetters);

    }
}
enum Fruit {
    PEAR, APPLE, GRAPE, MANGO, ORANGE, PAPAYA;
}
```

switch è¯­å¥å¦‚æœæ¼å†™äº†ä¸€ä¸ª breakï¼Œé‚£ä¹ˆé€»è¾‘å¾€å¾€å°±è·‘åäº†ï¼Œè¿™ç§æ–¹å¼æ—¢ç¹çï¼Œåˆå®¹æ˜“å‡ºé”™ã€‚

Java 12ä¸­ï¼š

```java
/**
 * @author shkstart
 * @create ä¸‹åˆ 10:38
 */
public class SwitchTest1 {
    public static void main(String[] args) {
        Fruit fruit = Fruit.GRAPE;
        switch(fruit){
            case PEAR -> System.out.println(4);
            case APPLE,MANGO,GRAPE -> System.out.println(5);
            case ORANGE,PAPAYA -> System.out.println(6);
            default -> throw new IllegalStateException("No Such Fruit:" + fruit);
        };
    }
}
```

æ›´è¿›ä¸€æ­¥ï¼š

```java
/**
 * @author shkstart
 * @create 2019 ä¸‹åˆ 10:44
 */
public class SwitchTest2 {
    public static void main(String[] args) {
        Fruit fruit = Fruit.GRAPE;
        int numberOfLetters = switch(fruit){
            case PEAR -> 4;
            case APPLE,MANGO,GRAPE -> 5;
            case ORANGE,PAPAYA -> 6;
            default -> throw new IllegalStateException("No Such Fruit:" + fruit);
        };
        System.out.println(numberOfLetters);
    }
}
```

**JDK13ä¸­äºŒæ¬¡é¢„è§ˆç‰¹æ€§ï¼š**

JDK13ä¸­å¼•å…¥äº†yieldè¯­å¥ï¼Œç”¨äºè¿”å›å€¼ã€‚è¿™æ„å‘³ç€ï¼Œswitchè¡¨è¾¾å¼(è¿”å›å€¼)åº”è¯¥ä½¿ç”¨yieldï¼Œswitchè¯­å¥(ä¸è¿”å›å€¼)åº”è¯¥ä½¿ç”¨breakã€‚

yieldå’Œreturnçš„åŒºåˆ«åœ¨äºï¼šreturnä¼šç›´æ¥è·³å‡ºå½“å‰å¾ªç¯æˆ–è€…æ–¹æ³•ï¼Œè€Œyieldåªä¼šè·³å‡ºå½“å‰switchå—ã€‚

åœ¨ä»¥å‰ï¼š

```java
@Test
public void testSwitch1(){
    String x = "3";
    int i;
    switch (x) {
        case "1":
            i=1;
            break;
        case "2":
            i=2;
            break;
        default:
            i = x.length();
            break;
    }
    System.out.println(i);
}
```

åœ¨JDK13ä¸­ï¼š

```java
@Test
public void testSwitch2(){
    String x = "3";
    int i = switch (x) {
        case "1" -> 1;
        case "2" -> 2;
        default -> {
            yield 3;
        }
    };
    System.out.println(i);
}
```

æˆ–è€…

```java
@Test
public void testSwitch3() {
    String x = "3";
    int i = switch (x) {
        case "1":
            yield 1;
        case "2":
            yield 2;
        default:
            yield 3;
    };
    System.out.println(i);
}
```

**JDK14ä¸­è½¬æ­£ç‰¹æ€§ï¼š**

è¿™æ˜¯JDK 12å’ŒJDK 13ä¸­çš„é¢„è§ˆç‰¹æ€§ï¼Œç°åœ¨æ˜¯æ­£å¼ç‰¹æ€§äº†ã€‚

**JDK17çš„é¢„è§ˆç‰¹æ€§ï¼šswitchçš„æ¨¡å¼åŒ¹é…**

æ—§å†™æ³•ï¼š

```java
static String formatter(Object o) {
    String formatted = "unknown";
    if (o instanceof Integer i) {
        formatted = String.format("int %d", i);
    } else if (o instanceof Long l) {
        formatted = String.format("long %d", l);
    } else if (o instanceof Double d) {
        formatted = String.format("double %f", d);
    } else if (o instanceof String s) {
        formatted = String.format("String %s", s);
    }
    return formatted;
}
```

æ¨¡å¼åŒ¹é…æ–°å†™æ³•ï¼š

```java
static String formatterPatternSwitch(Object o) {
    return switch (o) {
        case Integer i -> String.format("int %d", i);
        case Long l    -> String.format("long %d", l);
        case Double d  -> String.format("double %f", d);
        case String s  -> String.format("String %s", s);
        default        -> o.toString();
    };
}
```

ç›´æ¥åœ¨ switch ä¸Šæ”¯æŒ Object ç±»å‹ï¼Œè¿™å°±ç­‰äºåŒæ—¶æ”¯æŒå¤šç§ç±»å‹ï¼Œä½¿ç”¨æ¨¡å¼åŒ¹é…å¾—åˆ°å…·ä½“ç±»å‹ï¼Œå¤§å¤§ç®€åŒ–äº†è¯­æ³•é‡ï¼Œè¿™ä¸ªåŠŸèƒ½å¾ˆå®ç”¨ã€‚

### 1.6 æ–‡æœ¬å—

ç°å®é—®é¢˜ï¼š

åœ¨Javaä¸­ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨Stringç±»å‹è¡¨è¾¾HTMLï¼ŒXMLï¼ŒSQLæˆ–JSONç­‰æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œåœ¨è¿›è¡Œå­—ç¬¦ä¸²èµ‹å€¼æ—¶éœ€è¦è¿›è¡Œè½¬ä¹‰å’Œè¿æ¥æ“ä½œï¼Œç„¶åæ‰èƒ½ç¼–è¯‘è¯¥ä»£ç ï¼Œè¿™ç§è¡¨è¾¾æ–¹å¼éš¾ä»¥é˜…è¯»å¹¶ä¸”éš¾ä»¥ç»´æŠ¤ã€‚

**JDK13çš„æ–°ç‰¹æ€§**

ä½¿ç”¨"""ä½œä¸ºæ–‡æœ¬å—çš„å¼€å§‹ç¬¦å’Œç»“æŸç¬¦ï¼Œåœ¨å…¶ä¸­å°±å¯ä»¥æ”¾ç½®å¤šè¡Œçš„å­—ç¬¦ä¸²ï¼Œä¸éœ€è¦è¿›è¡Œä»»ä½•è½¬ä¹‰ã€‚å› æ­¤ï¼Œæ–‡æœ¬å—å°†æé«˜Javaç¨‹åºçš„å¯è¯»æ€§å’Œå¯å†™æ€§ã€‚

åŸºæœ¬ä½¿ç”¨ï¼š

```java
"""
line1
line2
line3
"""
```

ç›¸å½“äºï¼š

```java
"line1\nline2\nline3\n"
```

æˆ–è€…ä¸€ä¸ªè¿æ¥çš„å­—ç¬¦ä¸²ï¼š

```java
"line1\n" +
"line2\n" +
"line3\n"
```

å¦‚æœå­—ç¬¦ä¸²æœ«å°¾ä¸éœ€è¦è¡Œç»ˆæ­¢ç¬¦ï¼Œåˆ™ç»“æŸåˆ†éš”ç¬¦å¯ä»¥æ”¾åœ¨æœ€åä¸€è¡Œå†…å®¹ä¸Šã€‚ä¾‹å¦‚ï¼š

```java
"""
line1
line2
line3"""
```

ç›¸å½“äº

```java
"line1\nline2\nline3"
```

æ–‡æœ¬å—å¯ä»¥è¡¨ç¤ºç©ºå­—ç¬¦ä¸²ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºå®ƒéœ€è¦ä¸¤è¡Œæºä»£ç ï¼š

```java
String empty = """
""";
```

ä¸¾ä¾‹1ï¼šæ™®é€šæ–‡æœ¬

åŸæœ‰å†™æ³•ï¼š

```java
 String text1 = "The Sound of silence\n" +
                "Hello darkness, my old friend\n" +
                "I've come to talk with you again\n" +
                "Because a vision softly creeping\n" +
                "Left its seeds while I was sleeping\n" +
                "And the vision that was planted in my brain\n" +
                "Still remains\n" +
                "Within the sound of silence";

System.out.println(text1);
```

ä½¿ç”¨æ–°ç‰¹æ€§ï¼š

```java
String text2 = """
                The Sound of silence
                Hello darkness, my old friend
                I've come to talk with you again
                Because a vision softly creeping
                Left its seeds while I was sleeping
                And the vision that was planted in my brain
                Still remains
                Within the sound of silence
                """;
System.out.println(text2);
```

ä¸¾ä¾‹2ï¼šHTMLè¯­å¥

```html
<html>
  <body>
      <p>Hello, å°šç¡…è°·</p>
  </body>
</html>
```

å°†å…¶å¤åˆ¶åˆ°Javaçš„å­—ç¬¦ä¸²ä¸­ï¼Œä¼šå±•ç¤ºæˆä»¥ä¸‹å†…å®¹ï¼š

```java
"<html>\n" +
"    <body>\n" +
"        <p>Hello, å°šç¡…è°·</p>\n" +
"    </body>\n" +
"</html>\n";
```

å³è¢«è‡ªåŠ¨è¿›è¡Œäº†è½¬ä¹‰ï¼Œè¿™æ ·çš„å­—ç¬¦ä¸²çœ‹èµ·æ¥ä¸æ˜¯å¾ˆç›´è§‚ï¼Œåœ¨JDK 13ä¸­ï¼š

```java
"""
<html>
  <body>
      <p>Hello, world</p>
  </body>
</html>
""";
```

ä¸¾ä¾‹3ï¼šSQLè¯­å¥

```sql
select employee_id,last_name,salary,department_id
from employees
where department_id in (40,50,60)
order by department_id asc
```

åŸæœ‰æ–¹å¼ï¼š

```java
String sql = "SELECT id,NAME,email\n" +
                "FROM customers\n" +
                "WHERE id > 4\n" +
                "ORDER BY email DESC";
```

ä½¿ç”¨æ–°ç‰¹æ€§ï¼š

```java
String sql1 = """
                SELECT id,NAME,email
                FROM customers
                WHERE id > 4
                ORDER BY email DESC
                """;
```

ä¸¾ä¾‹4ï¼šJSONå­—ç¬¦ä¸²

åŸæœ‰æ–¹å¼ï¼š

```java
String myJson = "{\n" +
                "    \"name\":\"Song Hongkang\",\n" +
                "     \"address\":\"www.atguigu.com\",\n" +
                "    \"email\":\"shkstart@126.com\"\n" +
                "}";
System.out.println(myJson);
```

ä½¿ç”¨æ–°ç‰¹æ€§ï¼š

```java
String myJson1 = """
                {
                    "name":"Song Hongkang",
                     "address":"www.atguigu.com",
                    "email":"shkstart@126.com"
                }""";
System.out.println(myJson1);
```

**JDK14ä¸­äºŒæ¬¡é¢„è§ˆç‰¹æ€§**

JDK14çš„ç‰ˆæœ¬ä¸»è¦å¢åŠ äº†ä¸¤ä¸ªescape sequencesï¼Œåˆ†åˆ«æ˜¯` \ <line-terminator>`ä¸`\s  escape sequence`ã€‚

ä¸¾ä¾‹ï¼š

```java
/**
 * @author shkstart
 * @create ä¸‹åˆ 7:13
 */
public class Feature05 {
    //jdk14æ–°ç‰¹æ€§
    @Test
    public void test5(){
        String sql1 = """
                SELECT id,NAME,email
                FROM customers
                WHERE id > 4
                ORDER BY email DESC
                """;
        System.out.println(sql1);

        // \:å–æ¶ˆæ¢è¡Œæ“ä½œ
        // \s:è¡¨ç¤ºä¸€ä¸ªç©ºæ ¼
        String sql2 = """
                SELECT id,NAME,email \
                FROM customers\s\
                WHERE id > 4 \
                ORDER BY email DESC
                """;
        System.out.println(sql2);
    }
}
```

**JDK15ä¸­åŠŸèƒ½è½¬æ­£**

### 1.7 Record

`èƒŒæ™¯`

æ—©åœ¨2019å¹´2æœˆä»½ï¼ŒJava è¯­è¨€æ¶æ„å¸ˆ Brian Goetzï¼Œæ›¾å†™æ–‡æŠ±æ€¨â€œ`Javaå¤ªå•°å—¦`â€æˆ–æœ‰å¤ªå¤šçš„â€œç¹æ–‡ç¼›èŠ‚â€ã€‚ä»–æåˆ°ï¼šå¼€å‘äººå‘˜æƒ³è¦åˆ›å»ºçº¯æ•°æ®è½½ä½“ç±»ï¼ˆplain data carriersï¼‰é€šå¸¸éƒ½å¿…é¡»ç¼–å†™å¤§é‡ä½ä»·å€¼ã€é‡å¤çš„ã€å®¹æ˜“å‡ºé”™çš„ä»£ç ã€‚å¦‚ï¼šæ„é€ å‡½æ•°ã€getter/setterã€equals()ã€hashCode()ä»¥åŠtoString()ç­‰ã€‚

ä»¥è‡³äºå¾ˆå¤šäººé€‰æ‹©ä½¿ç”¨IDEçš„åŠŸèƒ½æ¥è‡ªåŠ¨ç”Ÿæˆè¿™äº›ä»£ç ã€‚è¿˜æœ‰ä¸€äº›å¼€å‘ä¼šé€‰æ‹©ä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹ç±»åº“ï¼Œå¦‚Lombokç­‰æ¥ç”Ÿæˆè¿™äº›æ–¹æ³•ã€‚

**JDK14ä¸­é¢„è§ˆç‰¹æ€§ï¼šç¥è¯´è¦ç”¨recordï¼Œäºæ˜¯å°±æœ‰äº†ã€‚** å®ç°ä¸€ä¸ªç®€å•çš„æ•°æ®è½½ä½“ç±»ï¼Œä¸ºäº†é¿å…ç¼–å†™ï¼šæ„é€ å‡½æ•°ï¼Œè®¿é—®å™¨ï¼Œequals()ï¼ŒhashCode () ï¼ŒtoString ()ç­‰ï¼ŒJava 14æ¨å‡ºrecordã€‚

`record` æ˜¯ä¸€ç§å…¨æ–°çš„ç±»å‹ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª `final` ç±»ï¼ŒåŒæ—¶æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ `final` ä¿®é¥°ï¼Œå®ƒä¼šè‡ªåŠ¨ç¼–è¯‘å‡º `public get` ã€`hashcode` ã€`equals`ã€`toString`ã€æ„é€ å™¨ç­‰ç»“æ„ï¼Œå‡å°‘äº†ä»£ç ç¼–å†™é‡ã€‚

å…·ä½“æ¥è¯´ï¼šå½“ä½ ç”¨`record` å£°æ˜ä¸€ä¸ªç±»æ—¶ï¼Œè¯¥ç±»å°†è‡ªåŠ¨æ‹¥æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š
- è·å–æˆå‘˜å˜é‡çš„ç®€å•æ–¹æ³•ï¼Œæ¯”å¦‚ä¾‹é¢˜ä¸­çš„ name() å’Œ partner() ã€‚æ³¨æ„åŒºåˆ«äºæˆ‘ä»¬å¹³å¸¸getter()çš„å†™æ³•ã€‚
- ä¸€ä¸ª equals æ–¹æ³•çš„å®ç°ï¼Œæ‰§è¡Œæ¯”è¾ƒæ—¶ä¼šæ¯”è¾ƒè¯¥ç±»çš„æ‰€æœ‰æˆå‘˜å±æ€§ã€‚
- é‡å†™ hashCode() æ–¹æ³•ã€‚
- ä¸€ä¸ªå¯ä»¥æ‰“å°è¯¥ç±»æ‰€æœ‰æˆå‘˜å±æ€§çš„ toString() æ–¹æ³•ã€‚
- åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ã€‚

æ­¤å¤–ï¼š

- è¿˜å¯ä»¥åœ¨recordå£°æ˜çš„ç±»ä¸­å®šä¹‰é™æ€å­—æ®µã€é™æ€æ–¹æ³•ã€æ„é€ å™¨æˆ–å®ä¾‹æ–¹æ³•ã€‚

- ä¸èƒ½åœ¨recordå£°æ˜çš„ç±»ä¸­å®šä¹‰å®ä¾‹å­—æ®µï¼›ç±»ä¸èƒ½å£°æ˜ä¸ºabstractï¼›ä¸èƒ½å£°æ˜æ˜¾å¼çš„çˆ¶ç±»ç­‰ã€‚


ä¸¾ä¾‹1ï¼ˆæ—§å†™æ³•ï¼‰ï¼š

```java
class Point {
    private final int x;
    private final int y;

    Point(int x, int y) {
        this.x = x;
        this.y = y;
    }

    int x() {
        return x;
    }

    int y() {
        return y;
    }

    public boolean equals(Object o) {
        if (!(o instanceof Point)) return false;
        Point other = (Point) o;
        return other.x == x && other.y == y;
    }

    public int hashCode() {
        return Objects.hash(x, y);
    }

    @Override
    public String toString() {
        return "Point{" +
                "x=" + x +
                ", y=" + y +
                '}';
    }
}
```

ä¸¾ä¾‹1ï¼ˆæ–°å†™æ³•ï¼‰ï¼š

```java
record Point(int x, int y) { }
```

ä¸¾ä¾‹1ï¼š

```java
public record Dog(String name, Integer age) {
}
```

```java
public class Java14Record {

    public static void main(String[] args) {
        Dog dog1 = new Dog("ç‰§ç¾ŠçŠ¬", 1);
        Dog dog2 = new Dog("ç”°å›­çŠ¬", 2);
        Dog dog3 = new Dog("å“ˆå£«å¥‡", 3);
        System.out.println(dog1);
        System.out.println(dog2);
        System.out.println(dog3);
    }
}
```

ä¸¾ä¾‹2ï¼š

```java
/**
 *  Recordç±»å‹çš„æ¼”ç¤º
 *
 * @author shkstart
 * @create ä¸‹åˆ 6:13
 */
public class Feature07 {
    @Test
    public void test1(){
        //æµ‹è¯•æ„é€ å™¨
        Person p1 = new Person("ç½—å¯†æ¬§",new Person("zhuliye",null));
        //æµ‹è¯•toString()
        System.out.println(p1);
        //æµ‹è¯•equals():
        Person p2 = new Person("ç½—å¯†æ¬§",new Person("zhuliye",null));
        System.out.println(p1.equals(p2));

        //æµ‹è¯•hashCode()å’Œequals()
        HashSet<Person> set = new HashSet<>();
        set.add(p1);
        set.add(p2);

        for (Person person : set) {
            System.out.println(person);
        }

        //æµ‹è¯•name()å’Œpartner():ç±»ä¼¼äºgetName()å’ŒgetPartner()
        System.out.println(p1.name());
        System.out.println(p1.partner());

    }

    @Test
    public void test2(){
        Person p1 = new Person("zhuyingtai");

        System.out.println(p1.getNameInUpperCase());

        Person.nation = "CHN";
        System.out.println(Person.showNation());

    }
}
```

```java
/**
 * @author shkstart
 * @create ä¸‹åˆ 6:20
 */
public record Person(String name,Person partner) {

    //è¿˜å¯ä»¥å£°æ˜é™æ€çš„å±æ€§ã€é™æ€çš„æ–¹æ³•ã€æ„é€ å™¨ã€å®ä¾‹æ–¹æ³•

    public static String nation;

    public static String showNation(){
        return nation;
    }

    public Person(String name){
        this(name,null);
    }

    public String getNameInUpperCase(){
        return name.toUpperCase();
    }
    //ä¸å¯ä»¥å£°æ˜éé™æ€çš„å±æ€§
//    private int id;//æŠ¥é”™
}

//ä¸å¯ä»¥å°†recordå®šä¹‰çš„ç±»å£°æ˜ä¸ºabstractçš„
//abstract record Order(){
//
//}

//ä¸å¯ä»¥ç»™recordå®šä¹‰çš„ç±»å£°æ˜æ˜¾å¼çš„çˆ¶ç±»ï¼ˆéRecordç±»ï¼‰
//record Order() extends Thread{
//
//}
```

**JDK15ä¸­ç¬¬äºŒæ¬¡é¢„è§ˆç‰¹æ€§**

**JDK16ä¸­è½¬æ­£ç‰¹æ€§**

æœ€ç»ˆåˆ°JDK16ä¸­è½¬æ­£ã€‚

`è®°å½•ä¸é€‚åˆå“ªäº›åœºæ™¯`

recordçš„è®¾è®¡ç›®æ ‡æ˜¯æä¾›ä¸€ç§å°†æ•°æ®å»ºæ¨¡ä¸ºæ•°æ®çš„å¥½æ–¹æ³•ã€‚å®ƒä¹Ÿä¸æ˜¯ JavaBeans çš„ç›´æ¥æ›¿ä»£å“ï¼Œå› ä¸ºrecordçš„æ–¹æ³•ä¸ç¬¦åˆ JavaBeans çš„ get æ ‡å‡†ã€‚å¦å¤– JavaBeans é€šå¸¸æ˜¯å¯å˜çš„ï¼Œè€Œè®°å½•æ˜¯ä¸å¯å˜çš„ã€‚å°½ç®¡å®ƒä»¬çš„ç”¨é€”æœ‰ç‚¹åƒï¼Œä½†è®°å½•å¹¶ä¸ä¼šä»¥æŸç§æ–¹å¼å–ä»£ JavaBeanã€‚

### 1.8 å¯†å°ç±»

èƒŒæ™¯ï¼š

åœ¨ Java ä¸­å¦‚æœæƒ³è®©ä¸€ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿å’Œä¿®æ”¹ï¼Œè¿™æ—¶æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ `final` å…³é”®å­—å¯¹ç±»è¿›è¡Œä¿®é¥°ã€‚ä¸è¿‡è¿™ç§è¦ä¹ˆå¯ä»¥ç»§æ‰¿ï¼Œè¦ä¹ˆä¸èƒ½ç»§æ‰¿çš„æœºåˆ¶ä¸å¤Ÿçµæ´»ï¼Œæœ‰äº›æ—¶å€™æˆ‘ä»¬å¯èƒ½æƒ³è®©æŸä¸ªç±»å¯ä»¥è¢«æŸäº›ç±»å‹ç»§æ‰¿ï¼Œä½†æ˜¯åˆä¸èƒ½éšæ„ç»§æ‰¿ï¼Œæ˜¯åšä¸åˆ°çš„ã€‚Java 15 å°è¯•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº† `sealed` ç±»ï¼Œè¢« `sealed` ä¿®é¥°çš„ç±»å¯ä»¥æŒ‡å®šå­ç±»ã€‚è¿™æ ·è¿™ä¸ªç±»å°±åªèƒ½è¢«æŒ‡å®šçš„ç±»ç»§æ‰¿ã€‚

**JDK15çš„é¢„è§ˆç‰¹æ€§ï¼š**

é€šè¿‡å¯†å°çš„ç±»å’Œæ¥å£æ¥é™åˆ¶è¶…ç±»çš„ä½¿ç”¨ï¼Œå¯†å°çš„ç±»å’Œæ¥å£é™åˆ¶å…¶å®ƒå¯èƒ½ç»§æ‰¿æˆ–å®ç°å®ƒä»¬çš„å…¶å®ƒç±»æˆ–æ¥å£ã€‚

å…·ä½“ä½¿ç”¨ï¼š

- ä½¿ç”¨ä¿®é¥°ç¬¦`sealed`ï¼Œå¯ä»¥å°†ä¸€ä¸ªç±»å£°æ˜ä¸ºå¯†å°ç±»ã€‚å¯†å°çš„ç±»ä½¿ç”¨ä¿ç•™å…³é”®å­—`permits`åˆ—å‡ºå¯ä»¥ç›´æ¥æ‰©å±•ï¼ˆå³extendsï¼‰å®ƒçš„ç±»ã€‚


-  `sealed` ä¿®é¥°çš„ç±»çš„æœºåˆ¶å…·æœ‰ä¼ é€’æ€§ï¼Œå®ƒçš„å­ç±»å¿…é¡»ä½¿ç”¨æŒ‡å®šçš„å…³é”®å­—è¿›è¡Œä¿®é¥°ï¼Œä¸”åªèƒ½æ˜¯ `final`ã€`sealed`ã€`non-sealed` ä¸‰è€…ä¹‹ä¸€ã€‚


ä¸¾ä¾‹ï¼š

```java
package com.atguigu.java;
public abstract sealed class Shape permits Circle, Rectangle, Square {...}

public final class Circle extends Shape {...} //finalè¡¨ç¤ºCircleä¸èƒ½å†è¢«ç»§æ‰¿äº†

public sealed class Rectangle extends Shape permits TransparentRectangle, FilledRectangle {...}

public final class TransparentRectangle extends Rectangle {...}

public final class FilledRectangle extends Rectangle {...}

public non-sealed class Square extends Shape {...} //non-sealedè¡¨ç¤ºå¯ä»¥å…è®¸ä»»ä½•ç±»ç»§æ‰¿
```

**JDK16äºŒæ¬¡é¢„è§ˆç‰¹æ€§**

**JDK17ä¸­è½¬æ­£ç‰¹æ€§**

## 2 APIçš„å˜åŒ–

### 2.1 Optionalç±»

**JDK8çš„æ–°ç‰¹æ€§**

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè‡­åæ˜­è‘—çš„ç©ºæŒ‡é’ˆå¼‚å¸¸æ˜¯å¯¼è‡´Javaåº”ç”¨ç¨‹åºå¤±è´¥çš„æœ€å¸¸è§åŸå› ã€‚ä»¥å‰ï¼Œä¸ºäº†è§£å†³ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ŒGoogleåœ¨è‘—åçš„Guavaé¡¹ç›®å¼•å…¥äº†Optionalç±»ï¼Œé€šè¿‡æ£€æŸ¥ç©ºå€¼çš„æ–¹å¼é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚å—åˆ°Googleçš„å¯å‘ï¼ŒOptionalç±»å·²ç»æˆä¸ºJava 8ç±»åº“çš„ä¸€éƒ¨åˆ†ã€‚

`Optional<T>` ç±»(java.util.Optional) æ˜¯ä¸€ä¸ªå®¹å™¨ç±»ï¼Œå®ƒå¯ä»¥ä¿å­˜ç±»å‹Tçš„å€¼ï¼Œä»£è¡¨è¿™ä¸ªå€¼å­˜åœ¨ã€‚æˆ–è€…ä»…ä»…ä¿å­˜nullï¼Œè¡¨ç¤ºè¿™ä¸ªå€¼ä¸å­˜åœ¨ã€‚å¦‚æœå€¼å­˜åœ¨ï¼Œåˆ™isPresent()æ–¹æ³•ä¼šè¿”å›trueï¼Œè°ƒç”¨get()æ–¹æ³•ä¼šè¿”å›è¯¥å¯¹è±¡ã€‚

Optionalæä¾›å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨æ˜¾å¼è¿›è¡Œç©ºå€¼æ£€æµ‹ã€‚

- `åˆ›å»ºOptionalç±»å¯¹è±¡çš„æ–¹æ³•ï¼š`
- `static <T> Optional<T> empty() `ï¼šç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºçš„Optionalå®ä¾‹
  - `static <T> Optional<T> of(T value) `ï¼šç”¨æ¥åˆ›å»ºä¸€ä¸ªOptionalå®ä¾‹ï¼Œvalueå¿…é¡»éç©º
  - `static <T> Optional<T> ofNullable(T value)` ï¼šç”¨æ¥åˆ›å»ºä¸€ä¸ªOptionalå®ä¾‹ï¼Œvalueå¯èƒ½æ˜¯ç©ºï¼Œä¹Ÿå¯èƒ½éç©º
  
- `åˆ¤æ–­Optionalå®¹å™¨ä¸­æ˜¯å¦åŒ…å«å¯¹è±¡ï¼š`

  - `boolean isPresent()` : åˆ¤æ–­Optionalå®¹å™¨ä¸­çš„å€¼æ˜¯å¦å­˜åœ¨
  - `void ifPresent(Consumer<? super T> consumer) `ï¼šåˆ¤æ–­Optionalå®¹å™¨ä¸­çš„å€¼æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±å¯¹å®ƒè¿›è¡ŒConsumeræŒ‡å®šçš„æ“ä½œï¼Œå¦‚æœä¸å­˜åœ¨å°±ä¸åš

- `è·å–Optionalå®¹å™¨çš„å¯¹è±¡ï¼š`
- T get(): å¦‚æœè°ƒç”¨å¯¹è±¡åŒ…å«å€¼ï¼Œè¿”å›è¯¥å€¼ã€‚å¦åˆ™æŠ›å¼‚å¸¸ã€‚T get()ä¸of(T value)é…åˆä½¿ç”¨
  
- `T orElse(T other) `ï¼šorElse(T other) ä¸ofNullable(T value)é…åˆä½¿ç”¨ï¼Œå¦‚æœOptionalå®¹å™¨ä¸­éç©ºï¼Œå°±è¿”å›æ‰€åŒ…è£…å€¼ï¼Œå¦‚æœä¸ºç©ºï¼Œå°±ç”¨orElse(T other)otheræŒ‡å®šçš„é»˜è®¤å€¼ï¼ˆå¤‡èƒï¼‰ä»£æ›¿
  
- `T orElseGet(Supplier<? extends T> other) `ï¼šå¦‚æœOptionalå®¹å™¨ä¸­éç©ºï¼Œå°±è¿”å›æ‰€åŒ…è£…å€¼ï¼Œå¦‚æœä¸ºç©ºï¼Œå°±ç”¨Supplieræ¥å£çš„Lambdaè¡¨è¾¾å¼æä¾›çš„å€¼ä»£æ›¿
  
- `T orElseThrow(Supplier<? extends X> exceptionSupplier) `ï¼šå¦‚æœOptionalå®¹å™¨ä¸­éç©ºï¼Œå°±è¿”å›æ‰€åŒ…è£…å€¼ï¼Œå¦‚æœä¸ºç©ºï¼Œå°±æŠ›å‡ºä½ æŒ‡å®šçš„å¼‚å¸¸ç±»å‹ä»£æ›¿åŸæ¥çš„NoSuchElementException

ä¸¾ä¾‹ï¼š

```java
package com.atguigu.optional;

import java.util.Optional;

import org.junit.Test;

public class TestOptional {
	@Test
    public void test1(){
        String str = "hello";
        Optional<String> opt = Optional.of(str);
        System.out.println(opt);
    }
    @Test
    public void test2(){
        Optional<String> opt = Optional.empty();
        System.out.println(opt);
    }
    @Test
    public void test3(){
        String str = null;
        Optional<String> opt = Optional.ofNullable(str);
        System.out.println(opt);
    }
    @Test
    public void test4(){
        String str = "hello";
        Optional<String> opt = Optional.of(str);

        String string = opt.get();
        System.out.println(string);
    }
    @Test
    public void test5(){
        String str = null;
        Optional<String> opt = Optional.ofNullable(str);
//		System.out.println(opt.get());//java.util.NoSuchElementException: No value present
    }
    @Test
    public void test6(){
        String str = "hello";
        Optional<String> opt = Optional.ofNullable(str);
        String string = opt.orElse("atguigu");
        System.out.println(string);
    }
    @Test
    public void test7(){
        String str = null;
        Optional<String> opt = Optional.ofNullable(str);
        String string = opt.orElseGet(String::new);
        System.out.println(string);
    }
    @Test
    public void test8(){
        String str = null;
        Optional<String> opt = Optional.ofNullable(str);
        String string = opt.orElseThrow(()->new RuntimeException("å€¼ä¸å­˜åœ¨"));
        System.out.println(string);
    }
    @Test
    public void test9(){
        String str = "Hello1";
        Optional<String> opt = Optional.ofNullable(str);
        //åˆ¤æ–­æ˜¯å¦æ˜¯çº¯å­—æ¯å•è¯ï¼Œå¦‚æœæ˜¯ï¼Œè½¬ä¸ºå¤§å†™ï¼Œå¦åˆ™ä¿æŒä¸å˜
        String result = opt.filter(s->s.matches("[a-zA-Z]+"))
                .map(s -> s.toUpperCase()).orElse(str);
        System.out.println(result);
    }
}

```

**è¿™æ˜¯JDK9-11çš„æ–°ç‰¹æ€§**

| **æ–°å¢æ–¹æ³•**                                                 | **æè¿°**                                                     | **æ–°å¢çš„ç‰ˆæœ¬** |
| ------------------------------------------------------------ | ------------------------------------------------------------ | -------------- |
| boolean isEmpty()                                            | åˆ¤æ–­valueæ˜¯å¦ä¸ºç©º                                            | JDK  11        |
| `ifPresentOrElse(Consumer<? super T> action, Runnable emptyAction)` | valueéç©ºï¼Œæ‰§è¡Œå‚æ•°1åŠŸèƒ½ï¼›å¦‚æœvalueä¸ºç©ºï¼Œæ‰§è¡Œå‚æ•°2åŠŸèƒ½       | JDK  9         |
| `Optional<T> or(Supplier<? extends Optional<? extends T>> supplier)` | valueéç©ºï¼Œè¿”å›å¯¹åº”çš„Optionalï¼›valueä¸ºç©ºï¼Œè¿”å›å½¢å‚å°è£…çš„Optional | JDK  9         |
| `Stream<T> stream() `                                          | valueéç©ºï¼Œè¿”å›ä»…åŒ…å«æ­¤valueçš„Streamï¼›å¦åˆ™ï¼Œè¿”å›ä¸€ä¸ªç©ºçš„Stream | JDK  9         |
| T orElseThrow()                                              | valueéç©ºï¼Œè¿”å›valueï¼›å¦åˆ™æŠ›å¼‚å¸¸NoSuchElementException       | JDK  10        |

### 2.2 Stringå­˜å‚¨ç»“æ„å’ŒAPIå˜æ›´

**è¿™æ˜¯JDK9çš„æ–°ç‰¹æ€§ã€‚**

äº§ç”ŸèƒŒæ™¯ï¼š

> Motivation
> The current implementation of the String class stores characters in a char array, using two bytes (sixteen bits) for each character. Data gathered from many different applications indicates that strings are a major component of heap usage and, moreover, that most String objects contain only Latin-1 characters. Such characters require only one byte of storage, hence half of the space in the internal char arrays of such String objects is going unused.

ä½¿ç”¨è¯´æ˜ï¼š

> ## Description
>
> We propose to change the internal representation of the String class from a UTF-16 char array to a byte array plus an encoding-flag field. The new String class will store characters encoded either as ISO-8859-1/Latin-1 (one byte per character), or as UTF-16 (two bytes per character), based upon the contents of the string. The encoding flag will indicate which encoding is used.

ç»“è®ºï¼šString å†ä¹Ÿä¸ç”¨ char[] æ¥å­˜å‚¨å•¦ï¼Œæ”¹æˆäº† byte[] åŠ ä¸Šç¼–ç æ ‡è®°ï¼ŒèŠ‚çº¦äº†ä¸€äº›ç©ºé—´ã€‚

```java
public final class String
    implements java.io.Serializable, Comparable<String>, CharSequence {
    @Stable
    private final byte[] value;
	...
}
```

æ‹“å±•ï¼šStringBuffer ä¸ StringBuilder

é‚£StringBuffer å’Œ StringBuilder æ˜¯å¦ä»æ— åŠ¨äºè¡·å‘¢ï¼Ÿ

> String-related classes such as AbstractStringBuilder, StringBuilder, and StringBuffer will be updated to use the same representation, as will the HotSpot VM's intrinsic string operations.

**JDK11æ–°ç‰¹æ€§ï¼šæ–°å¢äº†ä¸€ç³»åˆ—å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•**

| **æè¿°**             | **ä¸¾ä¾‹**                                        |
| -------------------- | ----------------------------------------------- |
| åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºç™½ | "  ".isBlank(); // true                         |
| å»é™¤é¦–å°¾ç©ºç™½         | "  Javastack ".strip(); // "Javastack"          |
| å»é™¤å°¾éƒ¨ç©ºæ ¼         | "  Javastack ".stripTrailing(); // " Javastack" |
| å»é™¤é¦–éƒ¨ç©ºæ ¼         | "  Javastack ".stripLeading(); // "Javastack "  |
| å¤åˆ¶å­—ç¬¦ä¸²           | "Java".repeat(3);//  "JavaJavaJava"             |
| è¡Œæ•°ç»Ÿè®¡             | "A\nB\nC".lines().count();  // 3                |

**JDK12æ–°ç‰¹æ€§ï¼šString å®ç°äº† Constable æ¥å£**

Stringæºç ï¼š

```java
public final class String implements java.io.Serializable, Comparable<String>, CharSequence,Constable, ConstantDesc {
```

java.lang.constant.Constableæ¥å£å®šä¹‰äº†æŠ½è±¡æ–¹æ³•ï¼š

```java
public interface Constable {
	Optional<? extends ConstantDesc> describeConstable();
}
```

Java 12 String çš„å®ç°æºç ï¼š

```java
/**
 * Returns an {@link Optional} containing the nominal descriptor for this
 * instance, which is the instance itself.
 *
 * @return an {@link Optional} describing the {@linkplain String} instance
 * @since 12
 */
@Override
public Optional<String> describeConstable() {
	return Optional.of(this);
}
```

å¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨ Optional.of æ–¹æ³•è¿”å›ä¸€ä¸ª Optional ç±»å‹ã€‚

ä¸¾ä¾‹ï¼š

```java
private static void testDescribeConstable() {
	String name = "å°šç¡…è°·Javaé«˜çº§å·¥ç¨‹å¸ˆ";
	Optional<String> optional = name.describeConstable();
	System.out.println(optional.get());
}
```

ç»“æœè¾“å‡ºï¼š

```
å°šç¡…è°·Javaé«˜çº§å·¥ç¨‹å¸ˆ
```

**JDK12æ–°ç‰¹æ€§ï¼šStringæ–°å¢æ–¹æ³•**

Stringçš„transform(Function)

```java
var result = "foo".transform(input -> input + " bar");
System.out.println(result); //foo bar
```

æˆ–è€…

```java
var result = "foo".transform(input -> input + " bar").transform(String::toUpperCase)
System.out.println(result); //FOO BAR
```

å¯¹åº”çš„æºç ï¼š

```java
/**
* This method allows the application of a function to {@code this}
* string. The function should expect a single String argument
* and produce an {@code R} result.
* @since 12
*/
public <R> R transform(Function<? super String, ? extends R> f) {
 return f.apply(this);
}
```

åœ¨æŸç§æƒ…å†µä¸‹ï¼Œè¯¥æ–¹æ³•åº”è¯¥è¢«ç§°ä¸ºmap()ã€‚

ä¸¾ä¾‹ï¼š

```java
private static void testTransform() {
	System.out.println("======test java 12 transform======");
	List<String> list1 = List.of("Java", " Python", " C++ ");
	List<String> list2 = new ArrayList<>();
	list1.forEach(element -> list2.add(element.transform(String::strip)
								  .transform(String::toUpperCase)
								  .transform((e) -> "Hi," + e))
				 );
	list2.forEach(System.out::println);
}
```

ç»“æœè¾“å‡ºï¼š

```java
======test java 12 transform======
Hi,JAVA
Hi,PYTHON
Hi,C++
```

å¦‚æœä½¿ç”¨Java 8çš„Streamç‰¹æ€§ï¼Œå¯ä»¥å¦‚ä¸‹å®ç°ï¼š

```java
private static void testTransform1() {
        System.out.println("======test before java 12 ======");
        List<String> list1 = List.of("Java  ", " Python", " C++ ");

        Stream<String> stringStream = list1.stream().map(element -> element.strip()).map(String::toUpperCase).map(element -> "Hello," + element);
        List<String> list2 = stringStream.collect(Collectors.toList());
        list2.forEach(System.out::println);
    }
```

### 2.3 JDK17ï¼šæ ‡è®°åˆ é™¤Applet API

Applet API æä¾›äº†ä¸€ç§å°† Java AWT/Swing æ§ä»¶åµŒå…¥åˆ°æµè§ˆå™¨ç½‘é¡µä¸­çš„æ–¹æ³•ã€‚ä¸è¿‡ï¼Œç›®å‰ Applet å·²ç»è¢«æ·˜æ±°ã€‚å¤§éƒ¨åˆ†äººå¯èƒ½å‹æ ¹å°±æ²¡æœ‰ç”¨è¿‡ Appletã€‚

Applet API å®é™…ä¸Šæ˜¯æ— ç”¨çš„ï¼Œå› ä¸ºæ‰€æœ‰ Web æµè§ˆå™¨ä¾›åº”å•†éƒ½å·²åˆ é™¤æˆ–é€éœ²è®¡åˆ’æ”¾å¼ƒå¯¹ Java æµè§ˆå™¨æ’ä»¶çš„æ”¯æŒã€‚Java 9 çš„æ—¶å€™ï¼ŒApplet API å·²ç»è¢«æ ‡è®°ä¸ºè¿‡æ—¶ï¼ŒJava 17 çš„æ—¶å€™ç»ˆäºæ ‡è®°ä¸ºåˆ é™¤äº†ã€‚

å…·ä½“å¦‚ä¸‹ï¼š

```java
java.applet.Applet
java.applet.AppletStub
java.applet.AppletContext
java.applet.AudioClip
javax.swing.JApplet
java.beans.AppletInitializer
```

## 3 å…¶å®ƒç»“æ„å˜åŒ–

### 3.1 JDK9ï¼šUnderScore(ä¸‹åˆ’çº¿)ä½¿ç”¨çš„é™åˆ¶

åœ¨java 8 ä¸­ï¼Œæ ‡è¯†ç¬¦å¯ä»¥ç‹¬ç«‹ä½¿ç”¨â€œ_â€æ¥å‘½åï¼š

```java
String _ = "hello";
System.out.println(_);
```

ä½†æ˜¯ï¼Œåœ¨java 9 ä¸­è§„å®š`â€œ_â€`ä¸å†å¯ä»¥å•ç‹¬å‘½åæ ‡è¯†ç¬¦äº†ï¼Œå¦‚æœä½¿ç”¨ï¼Œä¼šæŠ¥é”™ï¼š
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/2d00486d004f94041946e123cbe5df47.png)

### 3.2 JDK11ï¼šæ›´ç®€åŒ–çš„ç¼–è¯‘è¿è¡Œç¨‹åº

çœ‹ä¸‹é¢çš„ä»£ç ã€‚

```java
// ç¼–è¯‘
javac JavaStack.java

// è¿è¡Œ
java JavaStack
```

æˆ‘ä»¬çš„è®¤çŸ¥é‡Œï¼Œè¦è¿è¡Œä¸€ä¸ª Java æºä»£ç å¿…é¡»å…ˆç¼–è¯‘ï¼Œå†è¿è¡Œã€‚è€Œåœ¨ Java 11 ç‰ˆæœ¬ä¸­ï¼Œé€šè¿‡ä¸€ä¸ª java å‘½ä»¤å°±ç›´æ¥æå®šäº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
java JavaStack.java
```

æ³¨æ„ç‚¹ï¼š

- æ‰§è¡Œæºæ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªç±»ï¼Œç¬¬ä¸€ä¸ªç±»å¿…é¡»åŒ…å«ä¸»æ–¹æ³•ã€‚


### 3.3 GCæ–¹é¢æ–°ç‰¹æ€§

GCæ˜¯Javaä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€ã€‚ ç„¶è€Œï¼Œå½“GCåœé¡¿å¤ªé•¿ï¼Œå°±ä¼šå¼€å§‹å½±å“åº”ç”¨çš„å“åº”æ—¶é—´ã€‚éšç€ç°ä»£ç³»ç»Ÿä¸­å†…å­˜ä¸æ–­å¢é•¿ï¼Œç”¨æˆ·å’Œç¨‹åºå‘˜å¸Œæœ›JVMèƒ½å¤Ÿä»¥é«˜æ•ˆçš„æ–¹å¼å……åˆ†åˆ©ç”¨è¿™äº›å†…å­˜ï¼Œ å¹¶ä¸”æ— éœ€é•¿æ—¶é—´çš„GCæš‚åœæ—¶é—´ã€‚

#### 3.3.1 G1 GC

JDK9ä»¥åé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨æ˜¯G1GCã€‚

**JDK10 : ä¸ºG1æä¾›å¹¶è¡Œçš„Full GC**

G1æœ€å¤§çš„äº®ç‚¹å°±æ˜¯å¯ä»¥å°½é‡çš„é¿å…full gcã€‚ä½†æ¯•ç«Ÿæ˜¯â€œå°½é‡â€ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹ï¼ŒG1å°±è¦è¿›è¡Œfull gcäº†ï¼Œæ¯”å¦‚å¦‚æœå®ƒæ— æ³•è¶³å¤Ÿå¿«çš„å›æ”¶å†…å­˜çš„æ—¶å€™ï¼Œå®ƒå°±ä¼šå¼ºåˆ¶åœæ­¢æ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹ç„¶åæ¸…ç†ã€‚

åœ¨Java10ä¹‹å‰ï¼Œä¸€ä¸ªå•çº¿ç¨‹ç‰ˆçš„æ ‡è®°-æ¸…é™¤-å‹ç¼©ç®—æ³•è¢«ç”¨äºfull gcã€‚ä¸ºäº†å°½é‡å‡å°‘full gcå¸¦æ¥çš„å½±å“ï¼Œåœ¨Java10ä¸­ï¼Œå°±æŠŠä¹‹å‰çš„é‚£ä¸ªå•çº¿ç¨‹ç‰ˆçš„æ ‡è®°-æ¸…é™¤-å‹ç¼©çš„full gcç®—æ³•æ”¹æˆäº†æ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶full gcã€‚è¿™æ ·ä¹Ÿç®—æ˜¯å‡å°‘äº†full gcæ‰€å¸¦æ¥çš„åœé¡¿ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚

ä½ å¯ä»¥é€šè¿‡`-XX:ParallelGCThreads`å‚æ•°æ¥æŒ‡å®šç”¨äºå¹¶è¡ŒGCçš„çº¿ç¨‹æ•°ã€‚

**JDK12ï¼šå¯ä¸­æ–­çš„ G1 Mixed GC**

**JDK12ï¼šå¢å¼ºG1ï¼Œè‡ªåŠ¨è¿”å›æœªç”¨å †å†…å­˜ç»™æ“ä½œç³»ç»Ÿ**

#### 3.3.2 Shenandoah GC

**JDK12ï¼šShenandoah GCï¼šä½åœé¡¿æ—¶é—´çš„GC**

Shenandoah åƒåœ¾å›æ”¶å™¨æ˜¯ Red Hat åœ¨ 2014 å¹´å®£å¸ƒè¿›è¡Œçš„ä¸€é¡¹åƒåœ¾æ”¶é›†å™¨ç ”ç©¶é¡¹ç›® Pauseless GC çš„å®ç°ï¼Œæ—¨åœ¨**é’ˆå¯¹ JVM ä¸Šçš„å†…å­˜æ”¶å›å®ç°ä½åœé¡¿çš„éœ€æ±‚**ã€‚

æ® Red Hat ç ”å‘ Shenandoah å›¢é˜Ÿå¯¹å¤–å®£ç§°ï¼ŒShenandoah åƒåœ¾å›æ”¶å™¨çš„æš‚åœæ—¶é—´ä¸å †å¤§å°æ— å…³ï¼Œè¿™æ„å‘³ç€æ— è®ºå°†å †è®¾ç½®ä¸º 200 MB è¿˜æ˜¯ 200 GBï¼Œéƒ½å°†æ‹¥æœ‰ä¸€è‡´çš„ç³»ç»Ÿæš‚åœæ—¶é—´ï¼Œä¸è¿‡å®é™…ä½¿ç”¨æ€§èƒ½å°†å–å†³äºå®é™…å·¥ä½œå †çš„å¤§å°å’Œå·¥ä½œè´Ÿè½½ã€‚

Shenandoah GC ä¸»è¦ç›®æ ‡æ˜¯ 99.9% çš„æš‚åœå°äº 10msï¼Œæš‚åœä¸å †å¤§å°æ— å…³ç­‰ã€‚

è¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼Œä¸åŒ…å«åœ¨é»˜è®¤ï¼ˆOracleï¼‰çš„OpenJDKç‰ˆæœ¬ä¸­ã€‚

Shenandoahå¼€å‘å›¢é˜Ÿåœ¨å®é™…åº”ç”¨ä¸­çš„æµ‹è¯•æ•°æ®ï¼š
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/d71542840f39c0198375ee10419a23c2.png)

**JDK15ï¼šShenandoahåƒåœ¾å›æ”¶ç®—æ³•è½¬æ­£**

Shenandoahåƒåœ¾å›æ”¶ç®—æ³•ç»ˆäºä»å®éªŒç‰¹æ€§è½¬å˜ä¸ºäº§å“ç‰¹æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªä» JDK 12 å¼•å…¥çš„å›æ”¶ç®—æ³•ï¼Œè¯¥ç®—æ³•é€šè¿‡ä¸æ­£åœ¨è¿è¡Œçš„ Java çº¿ç¨‹åŒæ—¶è¿›è¡Œç–æ•£å·¥ä½œæ¥å‡å°‘ GC æš‚åœæ—¶é—´ã€‚Shenandoah çš„æš‚åœæ—¶é—´ä¸å †å¤§å°æ— å…³ï¼Œæ— è®ºå †æ ˆæ˜¯ 200 MB è¿˜æ˜¯ 200 GBï¼Œéƒ½å…·æœ‰ç›¸åŒçš„ä¸€è‡´æš‚åœæ—¶é—´ã€‚

Shenandoahåœ¨JDK12è¢«ä½œä¸ºexperimentalå¼•å…¥ï¼Œåœ¨JDK15å˜ä¸ºProductionï¼›ä¹‹å‰éœ€è¦é€šè¿‡`-XX:+UnlockExperimentalVMOptions` `-XX:+UseShenandoahGC`æ¥å¯ç”¨ï¼Œç°åœ¨åªéœ€è¦`-XX:+UseShenandoahGC`å³å¯å¯ç”¨

#### 3.3.3 é©å‘½æ€§çš„ ZGC

**JDK11ï¼šå¼•å…¥é©å‘½æ€§çš„ ZGC**

ZGCï¼Œè¿™åº”è¯¥æ˜¯JDK11æœ€ä¸ºç©ç›®çš„ç‰¹æ€§ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚ 

ZGCæ˜¯ä¸€ä¸ªå¹¶å‘ã€åŸºäºregionã€å‹ç¼©å‹çš„åƒåœ¾æ”¶é›†å™¨ã€‚

ZGCçš„è®¾è®¡ç›®æ ‡æ˜¯ï¼šæ”¯æŒTBçº§å†…å­˜å®¹é‡ï¼Œæš‚åœæ—¶é—´ä½ï¼ˆ<10msï¼‰ï¼Œå¯¹æ•´ä¸ªç¨‹åºååé‡çš„å½±å“å°äº15%ã€‚ å°†æ¥è¿˜å¯ä»¥æ‰©å±•å®ç°æœºåˆ¶ï¼Œä»¥æ”¯æŒä¸å°‘ä»¤äººå…´å¥‹çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å¤šå±‚å †ï¼ˆå³çƒ­å¯¹è±¡ç½®äºDRAMå’Œå†·å¯¹è±¡ç½®äºNVMeé—ªå­˜ï¼‰ï¼Œæˆ–å‹ç¼©å †ã€‚

**JDK13ï¼šZGC:å°†æœªä½¿ç”¨çš„å †å†…å­˜å½’è¿˜ç»™æ“ä½œç³»ç»Ÿ**

**JDK14ï¼šZGC on macOSå’Œwindows**

- JDK14ä¹‹å‰ï¼ŒZGCä»…Linuxæ‰æ”¯æŒã€‚ç°åœ¨macæˆ–Windowsä¸Šä¹Ÿèƒ½ä½¿ç”¨ZGCäº†ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

  ```
  -XX:+UnlockExperimentalVMOptions -XX:+UseZGC
  ```

- ZGCä¸Shenandoahç›®æ ‡é«˜åº¦ç›¸ä¼¼ï¼Œåœ¨å°½å¯èƒ½å¯¹ååé‡å½±å“ä¸å¤§çš„å‰æä¸‹ï¼Œå®ç°åœ¨ä»»æ„å †å†…å­˜å¤§å°ä¸‹éƒ½å¯ä»¥æŠŠåƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´é™åˆ¶åœ¨`åæ¯«ç§’ä»¥å†…`çš„ä½å»¶è¿Ÿã€‚
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c70ac369aca1ffaaaf94f64b95df64b1.png)

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/bfa3e1aa0ec0347d9aa75a4dc4a62ab5.png)


**JDK15ï¼šZGC åŠŸèƒ½è½¬æ­£**

ZGCæ˜¯Java 11å¼•å…¥çš„æ–°çš„åƒåœ¾æ”¶é›†å™¨ï¼Œç»è¿‡äº†å¤šä¸ªå®éªŒé˜¶æ®µï¼Œè‡ªæ­¤ç»ˆäºæˆä¸ºæ­£å¼ç‰¹æ€§ã€‚

ä½†æ˜¯è¿™å¹¶ä¸æ˜¯æ›¿æ¢é»˜è®¤çš„GCï¼Œé»˜è®¤çš„GCä»ç„¶è¿˜æ˜¯G1ï¼›ä¹‹å‰éœ€è¦é€šè¿‡`-XX:+UnlockExperimentalVMOptions`ã€` -XX:+UseZGC`æ¥å¯ç”¨ZGCï¼Œç°åœ¨åªéœ€è¦`-XX:+UseZGC`å°±å¯ä»¥ã€‚ç›¸ä¿¡ä¸ä¹…çš„å°†æ¥å®ƒå¿…å°†æˆä¸ºé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨ã€‚

> ZGCçš„æ€§èƒ½å·²ç»ç›¸å½“äº®çœ¼ï¼Œç”¨â€œä»¤äººéœ‡æƒŠã€é©å‘½æ€§â€æ¥å½¢å®¹ï¼Œä¸ä¸ºè¿‡ã€‚æœªæ¥å°†æˆä¸ºæœåŠ¡ç«¯ã€å¤§å†…å­˜ã€ä½å»¶è¿Ÿåº”ç”¨çš„é¦–é€‰åƒåœ¾æ”¶é›†å™¨ã€‚

æ€ä¹ˆå½¢å®¹Shenandoahå’ŒZGCçš„å…³ç³»å‘¢ï¼Ÿå¼‚åŒç‚¹å¤§æ¦‚å¦‚ä¸‹ï¼š

- ç›¸åŒç‚¹ï¼šæ€§èƒ½å‡ ä¹å¯è®¤ä¸ºæ˜¯ç›¸åŒçš„
- ä¸åŒç‚¹ï¼šZGCæ˜¯Oracle JDKçš„ï¼Œæ ¹æ­£è‹—çº¢ã€‚è€ŒShenandoahåªå­˜åœ¨äºOpenJDKä¸­ï¼Œå› æ­¤ä½¿ç”¨æ—¶éœ€æ³¨æ„ä½ çš„JDKç‰ˆæœ¬

**JDK16ï¼šZGC å¹¶å‘çº¿ç¨‹å¤„ç†**

åœ¨çº¿ç¨‹çš„å †æ ˆå¤„ç†è¿‡ç¨‹ä¸­ï¼Œæ€»æœ‰ä¸€ä¸ªåˆ¶çº¦å› ç´ å°±æ˜¯safepointsã€‚åœ¨safepointsè¿™ä¸ªç‚¹ï¼ŒJavaçš„çº¿ç¨‹æ˜¯è¦æš‚åœæ‰§è¡Œçš„ï¼Œä»è€Œé™åˆ¶äº†GCçš„æ•ˆç‡ã€‚

> å›é¡¾ï¼š
>
> æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨ä¹‹å‰ï¼Œéœ€è¦ GC çš„æ—¶å€™ï¼Œä¸ºäº†è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œéœ€è¦æ‰€æœ‰çš„çº¿ç¨‹éƒ½æš‚åœä¸‹æ¥ï¼Œè¿™ä¸ªæš‚åœçš„æ—¶é—´æˆ‘ä»¬ç§°ä¸º **Stop The World**ã€‚
>
> è€Œä¸ºäº†å®ç° STW è¿™ä¸ªæ“ä½œï¼Œ JVM éœ€è¦ä¸ºæ¯ä¸ªçº¿ç¨‹é€‰æ‹©ä¸€ä¸ªç‚¹åœæ­¢è¿è¡Œï¼Œè¿™ä¸ªç‚¹å°±å«åš**å®‰å…¨ç‚¹ï¼ˆSafepointsï¼‰**ã€‚

è€ŒZGCçš„å¹¶å‘çº¿ç¨‹å †æ ˆå¤„ç†å¯ä»¥ä¿è¯Javaçº¿ç¨‹å¯ä»¥åœ¨GC safepointsçš„åŒæ—¶å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚å®ƒæœ‰åŠ©äºæé«˜æ‰€å¼€å‘çš„Javaè½¯ä»¶åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚

## 4 å°ç»“ä¸å±•æœ›

éšç€äº‘è®¡ç®—å’Œ AI ç­‰æŠ€æœ¯æµªæ½®ï¼Œå½“å‰çš„è®¡ç®—æ¨¡å¼å’Œåœºæ™¯æ­£åœ¨å‘ç”Ÿç¿»å¤©è¦†åœ°çš„å˜åŒ–ï¼Œä¸ä»…å¯¹ Java çš„å‘å±•é€Ÿåº¦æå‡ºäº†æ›´é«˜è¦æ±‚ï¼Œä¹Ÿæ·±åˆ»å½±å“ç€ Java æŠ€æœ¯çš„å‘å±•æ–¹å‘ã€‚**ä¼ ç»Ÿçš„å¤§å‹ä¼ä¸šæˆ–äº’è”ç½‘åº”ç”¨ï¼Œæ­£åœ¨è¢«äº‘ç«¯ã€å®¹å™¨åŒ–åº”ç”¨ã€æ¨¡å—åŒ–çš„å¾®æœåŠ¡ç”šè‡³æ˜¯å‡½æ•°(FaaSï¼Œ Function-as-a-Service)æ‰€æ›¿ä»£ã€‚**

**Java éœ€è¦åœ¨æ–°çš„è®¡ç®—åœºæ™¯ä¸‹ï¼Œæ”¹è¿›å¼€å‘æ•ˆç‡ã€‚** æ¯”å¦‚ï¼ŒJava ä»£ç è™½ç„¶è¿›è¡Œäº†ä¸€äº›ç±»å‹æ¨æ–­ç­‰æ”¹è¿›ï¼Œæ›´æ˜“ç”¨çš„é›†åˆ API ç­‰ï¼Œä½†ä»ç„¶ç»™å¼€å‘è€…ç•™ä¸‹äº†è¿‡äºåˆ»æ¿ã€å½¢å¼ä¸»ä¹‰çš„å°è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªé•¿æœŸçš„æ”¹è¿›æ–¹å‘ã€‚

Javaè™½ç„¶æ ‡æ¦œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå´æ¯«ä¸é¡¾å¿Œçš„åŠ å…¥`é¢å‘æ¥å£ç¼–ç¨‹æ€æƒ³`ï¼Œåˆæ‰¯å‡º`åŒ¿åå¯¹è±¡`çš„æ¦‚å¿µï¼Œæ¯å¢åŠ ä¸€ä¸ªæ–°çš„ä¸œè¥¿ï¼Œå¯¹Javaçš„æ ¹æœ¬ï¼ˆé¢å‘å¯¹è±¡æ€æƒ³ï¼‰çš„ä¸€æ¬¡å†²å‡»ã€‚

> å£«ï¼Œä¸å¯ä¸å¼˜æ¯…ï¼Œä»»é‡è€Œé“è¿œã€‚

