---
æ–‡ç« æ ‡é¢˜: "[[16_åå°„æœºåˆ¶]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æ–‡ç« è¯¦ç»†é˜è¿°Javaåå°„æœºåˆ¶ï¼ŒåŒ…æ‹¬å…¶æ¦‚å¿µã€ä¼˜ç¼ºç‚¹ã€æ ¸å¿ƒClasså¯¹è±¡è·å–æ–¹å¼ï¼Œä»¥åŠç±»åŠ è½½ä¸ç±»åŠ è½½å™¨ä½“ç³»ã€‚é€šè¿‡å®ä¾‹æ¼”ç¤ºäº†åå°„åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºå¯¹è±¡ã€è®¿é—®/æ“ä½œç±»æˆå‘˜å’Œå¤„ç†æ³¨è§£çš„åº”ç”¨ï¼Œä½“ç°å…¶çµæ´»æ€§ã€‚
æ–‡ç« æ ‡ç­¾:
- "Java Reflection"
- "Classå¯¹è±¡"
- "ç±»åŠ è½½å™¨"
- "åŠ¨æ€ç¼–ç¨‹"
- "è¿è¡Œæ—¶"
- "æ³¨è§£"
- "JVM"
ç›¸å…³æ–‡ç« :
- "[[1_Javaå­¦ä¹ è·¯çº¿]]"
- "[[1_Javaè¯­è¨€æ¦‚è¿°]]"
- "[[19_å‰©ä½™çŸ¥è¯†ç‚¹è¡¥å……]]"
- "[[2_Javaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œçš„æ•´ä¸ªè¿‡ç¨‹]]"
- "[[3_2023-9-25åç»­å­¦ä¹ åˆ†æ]]"
æ–‡ç« åˆ†ç±»: "ğŸ’» ç¼–ç¨‹è¯­è¨€"
æ–‡ç« è·¯å¾„: "02-ğŸ’» ç¼–ç¨‹è¯­è¨€/01-â˜• JavaæŠ€æœ¯æ ˆ/02-ğŸ“š åŸºç¡€è¯­æ³•/1_JavaåŸºç¡€/16_åå°„æœºåˆ¶.md"
æ–‡ç« éš¾åº¦: ä¸­çº§ ğŸŒ³
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­â­ ç²¾é€šå¿…å¤‡
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2025-05-26 07:14:59
---

## 1 æœ¬ç« ä¸“é¢˜ä¸è„‰ç»œ

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/9cfda47244344f125ae4c7b54855b6d9.png)

## 2 åå°„(Reflection)çš„æ¦‚å¿µ

### 2.1 åå°„çš„å‡ºç°èƒŒæ™¯

Javaç¨‹åºä¸­ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æœ‰ä¸¤ç§ç±»å‹ï¼š`ç¼–è¯‘æ—¶ç±»å‹`å’Œ`è¿è¡Œæ—¶ç±»å‹`ï¼Œè€Œå¾ˆå¤šæ—¶å€™å¯¹è±¡çš„ç¼–è¯‘æ—¶ç±»å‹å’Œè¿è¡Œæ—¶ç±»å‹`ä¸ä¸€è‡´`ã€‚ Object obj = new String("hello");    obj.getClass()

ä¾‹å¦‚ï¼šæŸäº›å˜é‡æˆ–å½¢å‚çš„å£°æ˜ç±»å‹æ˜¯Objectç±»å‹ï¼Œä½†æ˜¯ç¨‹åºå´éœ€è¦è°ƒç”¨è¯¥å¯¹è±¡è¿è¡Œæ—¶ç±»å‹çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸æ˜¯Objectä¸­çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿ

è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š

æ–¹æ¡ˆ1ï¼šåœ¨ç¼–è¯‘å’Œè¿è¡Œæ—¶éƒ½å®Œå…¨çŸ¥é“ç±»å‹çš„å…·ä½“ä¿¡æ¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å…ˆä½¿ç”¨`instanceof`è¿ç®—ç¬¦è¿›è¡Œåˆ¤æ–­ï¼Œå†åˆ©ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ç¬¦å°†å…¶è½¬æ¢æˆè¿è¡Œæ—¶ç±»å‹çš„å˜é‡å³å¯ã€‚

æ–¹æ¡ˆ2ï¼šç¼–è¯‘æ—¶æ ¹æœ¬æ— æ³•é¢„çŸ¥è¯¥å¯¹è±¡å’Œç±»çš„çœŸå®ä¿¡æ¯ï¼Œç¨‹åºåªèƒ½ä¾é `è¿è¡Œæ—¶ä¿¡æ¯`æ¥å‘ç°è¯¥å¯¹è±¡å’Œç±»çš„çœŸå®ä¿¡æ¯ï¼Œè¿™å°±å¿…é¡»ä½¿ç”¨åå°„ã€‚

### 2.2 åå°„æ¦‚è¿°

Reflectionï¼ˆåå°„ï¼‰æ˜¯è¢«è§†ä¸º`åŠ¨æ€è¯­è¨€`çš„å…³é”®ï¼Œåå°„æœºåˆ¶å…è®¸ç¨‹åºåœ¨`è¿è¡ŒæœŸé—´`å€ŸåŠ©äºReflection APIå–å¾—ä»»ä½•ç±»çš„å†…éƒ¨ä¿¡æ¯ï¼Œå¹¶èƒ½ç›´æ¥æ“ä½œä»»æ„å¯¹è±¡çš„å†…éƒ¨å±æ€§åŠæ–¹æ³•ã€‚

åŠ è½½å®Œç±»ä¹‹åï¼Œåœ¨å †å†…å­˜çš„æ–¹æ³•åŒºä¸­å°±äº§ç”Ÿäº†ä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡ï¼ˆä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªClasså¯¹è±¡ï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±åŒ…å«äº†å®Œæ•´çš„ç±»çš„ç»“æ„ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡çœ‹åˆ°ç±»çš„ç»“æ„ã€‚`è¿™ä¸ªå¯¹è±¡å°±åƒä¸€é¢é•œå­ï¼Œé€è¿‡è¿™ä¸ªé•œå­çœ‹åˆ°ç±»çš„ç»“æ„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å½¢è±¡çš„ç§°ä¹‹ä¸ºï¼šåå°„ã€‚`

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c1673fcb75d4c3e1ac9f140c83eb62b0.png)


**ä»å†…å­˜åŠ è½½ä¸Šçœ‹åå°„ï¼š**

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/fabf2da5fc7dff92cf6d3072185f9c26.png)

### 2.3 Javaåå°„æœºåˆ¶ç ”ç©¶åŠåº”ç”¨

Javaåå°„æœºåˆ¶æä¾›çš„åŠŸèƒ½ï¼š

- åœ¨è¿è¡Œæ—¶`åˆ¤æ–­ä»»æ„ä¸€ä¸ªå¯¹è±¡æ‰€å±çš„ç±»`
- åœ¨è¿è¡Œæ—¶`æ„é€ ä»»æ„ä¸€ä¸ªç±»çš„å¯¹è±¡`
- åœ¨è¿è¡Œæ—¶`åˆ¤æ–­ä»»æ„ä¸€ä¸ªç±»æ‰€å…·æœ‰çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•`
- åœ¨è¿è¡Œæ—¶`è·å–æ³›å‹ä¿¡æ¯`
- åœ¨è¿è¡Œæ—¶`è°ƒç”¨ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•`
- åœ¨è¿è¡Œæ—¶`å¤„ç†æ³¨è§£`
- ç”Ÿæˆ`åŠ¨æ€ä»£ç†`

### 2.4 åå°„ç›¸å…³çš„ä¸»è¦API

`java.lang.Class`ï¼šä»£è¡¨ä¸€ä¸ªç±»
java.lang.reflect.Methodï¼šä»£è¡¨ç±»çš„æ–¹æ³•
java.lang.reflect.Fieldï¼šä»£è¡¨ç±»çš„æˆå‘˜å˜é‡
java.lang.reflect.Constructorï¼šä»£è¡¨ç±»çš„æ„é€ å™¨
â€¦ â€¦

### 2.5 åå°„çš„ä¼˜ç¼ºç‚¹

**ä¼˜ç‚¹ï¼š**

- æé«˜äº†Javaç¨‹åºçš„çµæ´»æ€§å’Œæ‰©å±•æ€§ï¼Œ`é™ä½äº†è€¦åˆæ€§`ï¼Œæé«˜`è‡ªé€‚åº”`èƒ½åŠ›

- å…è®¸ç¨‹åºåˆ›å»ºå’Œæ§åˆ¶ä»»ä½•ç±»çš„å¯¹è±¡ï¼Œæ— éœ€æå‰`ç¡¬ç¼–ç `ç›®æ ‡ç±»

**ç¼ºç‚¹ï¼š**

- åå°„çš„`æ€§èƒ½è¾ƒä½`ã€‚
- åå°„æœºåˆ¶ä¸»è¦åº”ç”¨åœ¨å¯¹çµæ´»æ€§å’Œæ‰©å±•æ€§è¦æ±‚å¾ˆé«˜çš„ç³»ç»Ÿæ¡†æ¶ä¸Š

- åå°„ä¼š`æ¨¡ç³Š`ç¨‹åºå†…éƒ¨é€»è¾‘ï¼Œ`å¯è¯»æ€§è¾ƒå·®`ã€‚

## 3 ç†è§£Classç±»å¹¶è·å–Classå®ä¾‹

è¦æƒ³`è§£å‰–`ä¸€ä¸ªç±»ï¼Œå¿…é¡»å…ˆè¦è·å–åˆ°è¯¥ç±»çš„Classå¯¹è±¡ã€‚è€Œå‰–æä¸€ä¸ªç±»æˆ–ç”¨åå°„è§£å†³å…·ä½“çš„é—®é¢˜å°±æ˜¯ä½¿ç”¨ç›¸å…³API:

- java.lang.Class
- java.lang.reflect.*

æ‰€ä»¥ï¼ŒClasså¯¹è±¡æ˜¯åå°„çš„æ ¹æºã€‚

### 3.1 ç†è§£Class

#### 3.1.1 ç†è®ºä¸Š

åœ¨Objectç±»ä¸­å®šä¹‰äº†ä»¥ä¸‹çš„æ–¹æ³•ï¼Œæ­¤æ–¹æ³•å°†è¢«æ‰€æœ‰å­ç±»ç»§æ‰¿ï¼š

```java
public final Class getClass()
```

ä»¥ä¸Šçš„æ–¹æ³•è¿”å›å€¼çš„ç±»å‹æ˜¯ä¸€ä¸ªClassç±»ï¼Œæ­¤ç±»æ˜¯Javaåå°„çš„æºå¤´ï¼Œå®é™…ä¸Šæ‰€è°“åå°„ä»ç¨‹åºçš„è¿è¡Œç»“æœæ¥çœ‹ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå³ï¼šå¯ä»¥é€šè¿‡å¯¹è±¡åå°„æ±‚å‡ºç±»çš„åç§°ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3a7b77fcf77c9b34fb542404d9f2f7f5.png)

å¯¹è±¡ç…§é•œå­åå¯ä»¥å¾—åˆ°çš„ä¿¡æ¯ï¼šæŸä¸ªç±»çš„å±æ€§ã€æ–¹æ³•å’Œæ„é€ å™¨ã€æŸä¸ªç±»åˆ°åº•å®ç°äº†å“ªäº›æ¥å£ã€‚å¯¹äºæ¯ä¸ªç±»è€Œè¨€ï¼ŒJRE éƒ½ä¸ºå…¶ä¿ç•™ä¸€ä¸ªä¸å˜çš„ Class ç±»å‹çš„å¯¹è±¡ã€‚ä¸€ä¸ª Class å¯¹è±¡åŒ…å«äº†ç‰¹å®šæŸä¸ªç»“æ„(class/interface/enum/annotation/primitive type/void/[])çš„æœ‰å…³ä¿¡æ¯ã€‚

- Classæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç±»
- Class å¯¹è±¡åªèƒ½ç”±ç³»ç»Ÿå»ºç«‹å¯¹è±¡
- ä¸€ä¸ªåŠ è½½çš„ç±»åœ¨ JVM ä¸­åªä¼šæœ‰ä¸€ä¸ªClasså®ä¾‹ 
- ä¸€ä¸ªClasså¯¹è±¡å¯¹åº”çš„æ˜¯ä¸€ä¸ªåŠ è½½åˆ°JVMä¸­çš„ä¸€ä¸ª.classæ–‡ä»¶
- æ¯ä¸ªç±»çš„å®ä¾‹éƒ½ä¼šè®°å¾—è‡ªå·±æ˜¯ç”±å“ªä¸ª Class å®ä¾‹æ‰€ç”Ÿæˆ
- é€šè¿‡Classå¯ä»¥å®Œæ•´åœ°å¾—åˆ°ä¸€ä¸ªç±»ä¸­çš„æ‰€æœ‰è¢«åŠ è½½çš„ç»“æ„ 
- Classç±»æ˜¯Reflectionçš„æ ¹æºï¼Œé’ˆå¯¹ä»»ä½•ä½ æƒ³åŠ¨æ€åŠ è½½ã€è¿è¡Œçš„ç±»ï¼Œå”¯æœ‰å…ˆè·å¾—ç›¸åº”çš„Classå¯¹è±¡

#### 3.1.2 å†…å­˜ç»“æ„ä¸Š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/d6a6a17e9a0b85911bc8a510087d1c57.png)

è¯´æ˜ï¼šä¸Šå›¾ä¸­å­—ç¬¦ä¸²å¸¸é‡æ± åœ¨JDK6ä¸­å­˜å‚¨åœ¨æ–¹æ³•åŒºï¼›JDK7åŠä»¥åï¼Œå­˜å‚¨åœ¨å †ç©ºé—´ã€‚

### 3.2 è·å–Classç±»çš„å®ä¾‹(å››ç§æ–¹æ³•)

`æ–¹å¼1ï¼šè¦æ±‚ç¼–è¯‘æœŸé—´å·²çŸ¥ç±»å‹`

å‰æï¼šè‹¥`å·²çŸ¥å…·ä½“çš„ç±»`ï¼Œé€šè¿‡ç±»çš„classå±æ€§è·å–ï¼Œè¯¥æ–¹æ³•æœ€ä¸ºå®‰å…¨å¯é ï¼Œç¨‹åºæ€§èƒ½æœ€é«˜

å®ä¾‹ï¼š

```java
Class clazz = String.class;
```

`æ–¹å¼2ï¼šè·å–å¯¹è±¡çš„è¿è¡Œæ—¶ç±»å‹`

å‰æï¼š`å·²çŸ¥æŸä¸ªç±»çš„å®ä¾‹`ï¼Œè°ƒç”¨è¯¥å®ä¾‹çš„getClass()æ–¹æ³•è·å–Classå¯¹è±¡

å®ä¾‹ï¼š

```java
Class clazz = "www.atguigu.com".getClass();
```

`æ–¹å¼3ï¼šå¯ä»¥è·å–ç¼–è¯‘æœŸé—´æœªçŸ¥çš„ç±»å‹`

å‰æï¼š`å·²çŸ¥ä¸€ä¸ªç±»çš„å…¨ç±»å`ï¼Œä¸”è¯¥ç±»åœ¨ç±»è·¯å¾„ä¸‹ï¼Œå¯é€šè¿‡Classç±»çš„é™æ€æ–¹æ³•forName()è·å–ï¼Œå¯èƒ½æŠ›å‡ºClassNotFoundException

å®ä¾‹ï¼š

```java
Class clazz = Class.forName("java.lang.String");
```

æ–¹å¼4ï¼šå…¶ä»–æ–¹å¼(ä¸åšè¦æ±‚)

å‰æï¼šå¯ä»¥`ç”¨ç³»ç»Ÿç±»åŠ è½½å¯¹è±¡æˆ–è‡ªå®šä¹‰åŠ è½½å™¨å¯¹è±¡åŠ è½½æŒ‡å®šè·¯å¾„ä¸‹çš„ç±»å‹`

å®ä¾‹ï¼š

```java
ClassLoader cl = this.getClass().getClassLoader();
Class clazz4 = cl.loadClass("ç±»çš„å…¨ç±»å");
```

å†ä¸¾ä¾‹ï¼š

```java
public class GetClassObject {
    @Test
    public void test01() throws ClassNotFoundException{
        Class c1 = GetClassObject.class;
        GetClassObject obj = new GetClassObject();
        Class c2 = obj.getClass();
        Class c3 = Class.forName("com.atguigu.classtype.GetClassObject");
        Class c4 = ClassLoader.getSystemClassLoader().loadClass("com.atguigu.classtype.GetClassObject");

        System.out.println("c1 = " + c1);
        System.out.println("c2 = " + c2);
        System.out.println("c3 = " + c3);
        System.out.println("c4 = " + c4);

        System.out.println(c1 == c2);
        System.out.println(c1 == c3);
        System.out.println(c1 == c4);
    }
}
```

### 3.3 å“ªäº›ç±»å‹å¯ä»¥æœ‰Classå¯¹è±¡

ç®€è¨€ä¹‹ï¼Œæ‰€æœ‰Javaç±»å‹ï¼

ï¼ˆ1ï¼‰classï¼šå¤–éƒ¨ç±»ï¼Œæˆå‘˜(æˆå‘˜å†…éƒ¨ç±»ï¼Œé™æ€å†…éƒ¨ç±»)ï¼Œå±€éƒ¨å†…éƒ¨ç±»ï¼ŒåŒ¿åå†…éƒ¨ç±»
ï¼ˆ2ï¼‰interfaceï¼šæ¥å£
ï¼ˆ3ï¼‰[]ï¼šæ•°ç»„
ï¼ˆ4ï¼‰enumï¼šæšä¸¾
ï¼ˆ5ï¼‰annotationï¼šæ³¨è§£@interface
ï¼ˆ6ï¼‰primitive typeï¼šåŸºæœ¬æ•°æ®ç±»å‹
ï¼ˆ7ï¼‰void

ä¸¾ä¾‹ï¼š

```java
Class c1 = Object.class;
Class c2 = Comparable.class;
Class c3 = String[].class;
Class c4 = int[][].class;
Class c5 = ElementType.class;
Class c6 = Override.class;
Class c7 = int.class;
Class c8 = void.class;
Class c9 = Class.class;

int[] a = new int[10];
int[] b = new int[100];
Class c10 = a.getClass();
Class c11 = b.getClass();
// åªè¦å…ƒç´ ç±»å‹ä¸ç»´åº¦ä¸€æ ·ï¼Œå°±æ˜¯åŒä¸€ä¸ªClass
System.out.println(c10 == c11);
```

### 3.4 Classç±»çš„å¸¸ç”¨æ–¹æ³•

| **æ–¹æ³•å**                                            | **åŠŸèƒ½è¯´æ˜**                               |
| -------------------------------------------------- | -------------------------------------- |
| static  Class forName(String  name)                | è¿”å›æŒ‡å®šç±»å  name  çš„  Class  å¯¹è±¡             |
| Object  newInstance()                              | è°ƒç”¨ç¼ºçœæ„é€ å‡½æ•°ï¼Œè¿”å›è¯¥Classå¯¹è±¡çš„ä¸€ä¸ªå®ä¾‹               |
| getName()                                          | è¿”å›æ­¤Classå¯¹è±¡æ‰€è¡¨ç¤ºçš„å®ä½“ï¼ˆç±»ã€æ¥å£ã€æ•°ç»„ç±»ã€åŸºæœ¬ç±»å‹æˆ–voidï¼‰åç§° |
| Class  getSuperClass()                             | è¿”å›å½“å‰Classå¯¹è±¡çš„çˆ¶ç±»çš„Classå¯¹è±¡                 |
| Class  [] getInterfaces()                          | è·å–å½“å‰Classå¯¹è±¡çš„æ¥å£                         |
| ClassLoader  getClassLoader()                      | è¿”å›è¯¥ç±»çš„ç±»åŠ è½½å™¨                              |
| Class  getSuperclass()                             | è¿”å›è¡¨ç¤ºæ­¤Classæ‰€è¡¨ç¤ºçš„å®ä½“çš„è¶…ç±»çš„Class              |
| Constructor[]  getConstructors()                   | è¿”å›ä¸€ä¸ªåŒ…å«æŸäº›Constructorå¯¹è±¡çš„æ•°ç»„               |
| Field[]  getDeclaredFields()                       | è¿”å›Fieldå¯¹è±¡çš„ä¸€ä¸ªæ•°ç»„                         |
| Method  getMethod(String  name,Class â€¦ paramTypes) | è¿”å›ä¸€ä¸ªMethodå¯¹è±¡ï¼Œ`æ­¤å¯¹è±¡çš„å½¢å‚ç±»å‹`ä¸ºparamType      |

ä¸¾ä¾‹ï¼š

```java
String str = "test4.Person";
Class clazz = Class.forName(str);

Object obj = clazz.newInstance();

Field field = clazz.getField("name");
field.set(obj, "Peter");
Object name = field.get(obj);
System.out.println(name);

//æ³¨ï¼štest4.Personæ˜¯test4åŒ…ä¸‹çš„Personç±»
```

## 4 ç±»çš„åŠ è½½ä¸ClassLoaderçš„ç†è§£

### 4.1 ç±»çš„ç”Ÿå‘½å‘¨æœŸ

ç±»åœ¨å†…å­˜ä¸­å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼šåŠ è½½-->ä½¿ç”¨-->å¸è½½ã€‚å…¶ä¸­åŠ è½½è¿‡ç¨‹åˆåˆ†ä¸ºï¼šè£…è½½ã€é“¾æ¥ã€åˆå§‹åŒ–ä¸‰ä¸ªé˜¶æ®µã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0b86b652757d7ffaf234077635dc8e4e.png)


### 4.2 ç±»çš„åŠ è½½è¿‡ç¨‹

å½“ç¨‹åºä¸»åŠ¨ä½¿ç”¨æŸä¸ªç±»æ—¶ï¼Œå¦‚æœè¯¥ç±»è¿˜æœªè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç³»ç»Ÿä¼šé€šè¿‡åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–ä¸‰ä¸ªæ­¥éª¤æ¥å¯¹è¯¥ç±»è¿›è¡Œåˆå§‹åŒ–ã€‚å¦‚æœæ²¡æœ‰æ„å¤–ï¼ŒJVMå°†ä¼šè¿ç»­å®Œæˆè¿™ä¸‰ä¸ªæ­¥éª¤ï¼Œæ‰€ä»¥æœ‰æ—¶ä¹ŸæŠŠè¿™ä¸‰ä¸ªæ­¥éª¤ç»Ÿç§°ä¸ºç±»åŠ è½½ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c25a399e30d6837a2f67aca14ce7f6b1.png)

ç±»çš„åŠ è½½åˆåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š

ï¼ˆ1ï¼‰è£…è½½ï¼ˆLoadingï¼‰

å°†ç±»çš„classæ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œ`å¹¶ä¸ºä¹‹åˆ›å»ºä¸€ä¸ªjava.lang.Classå¯¹è±¡`ã€‚æ­¤è¿‡ç¨‹ç”±ç±»åŠ è½½å™¨å®Œæˆ

ï¼ˆ2ï¼‰é“¾æ¥ï¼ˆLinkingï¼‰

â‘ éªŒè¯Verifyï¼šç¡®ä¿åŠ è½½çš„ç±»ä¿¡æ¯ç¬¦åˆJVMè§„èŒƒï¼Œä¾‹å¦‚ï¼šä»¥cafebabeå¼€å¤´ï¼Œæ²¡æœ‰å®‰å…¨æ–¹é¢çš„é—®é¢˜ã€‚

â‘¡å‡†å¤‡Prepareï¼šæ­£å¼ä¸ºç±»å˜é‡ï¼ˆstaticï¼‰åˆ†é…å†…å­˜å¹¶`è®¾ç½®ç±»å˜é‡é»˜è®¤åˆå§‹å€¼`çš„é˜¶æ®µï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚

â‘¢è§£æResolveï¼šè™šæ‹Ÿæœºå¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨ï¼ˆå¸¸é‡åï¼‰æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼ˆåœ°å€ï¼‰çš„è¿‡ç¨‹ã€‚
	- æ³¨æ„ï¼šä¸æ˜¯æˆ‘ä»¬ä¹‹å‰å­¦çš„å­—ç¬¦ä¸²å¸¸é‡æ± å’ŒåŒ…è£…ç±»å…ƒæ•°æ®ï¼Œè€Œæ˜¯å­—èŠ‚ç æ–‡ä»¶ä¸­çš„ä¸€äº›å…³é”®å­—ç­‰ï¼Œè½¬ä¸ºJVMå¸¸é‡æ± ä¸ºå®ƒä»¬æä¾›çš„ç›´æ¥å¼•ç”¨ï¼ˆåœ°å€ï¼‰

ï¼ˆ3ï¼‰åˆå§‹åŒ–ï¼ˆInitializationï¼‰

- æ‰§è¡Œ`ç±»æ„é€ å™¨<clinit>()æ–¹æ³•`çš„è¿‡ç¨‹ã€‚`ç±»æ„é€ å™¨<clinit>()æ–¹æ³•`æ˜¯ç”±ç¼–è¯‘æœŸè‡ªåŠ¨æ”¶é›†ç±»ä¸­æ‰€æœ‰ç±»ï¼ˆé™æ€ï¼‰å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ã€‚ï¼ˆç±»æ„é€ å™¨æ˜¯æ„é€ ç±»ä¿¡æ¯çš„ï¼Œä¸æ˜¯æ„é€ è¯¥ç±»å¯¹è±¡çš„æ„é€ å™¨ï¼‰ã€‚
	- `å°±æ˜¯ç»™å‡†å¤‡è¿‡ç¨‹ä¸­ï¼Œé»˜è®¤å€¼çš„é™æ€æ•°æ®ï¼Œèµ‹å€¼ï¼`

- å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚

- è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ª`ç±»çš„<clinit>()æ–¹æ³•`åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«æ­£ç¡®åŠ é”å’ŒåŒæ­¥ã€‚

### 4.3 ç±»åŠ è½½å™¨ï¼ˆclassloader)

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/de12474af71ba661be33130b7180cbdd.png)

#### 4.3.1 ç±»åŠ è½½å™¨çš„ä½œç”¨

å°†classæ–‡ä»¶å­—èŠ‚ç å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†å…¶é™æ€æ•°æ®è½¬æ¢æˆæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼Œç„¶ååœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºä¸­ç±»æ•°æ®çš„è®¿é—®å…¥å£ã€‚

ç±»ç¼“å­˜ï¼šæ ‡å‡†çš„JavaSEç±»åŠ è½½å™¨å¯ä»¥æŒ‰è¦æ±‚æŸ¥æ‰¾ç±»ï¼Œä½†ä¸€æ—¦æŸä¸ªç±»è¢«åŠ è½½åˆ°ç±»åŠ è½½å™¨ä¸­ï¼Œå®ƒå°†ç»´æŒåŠ è½½ï¼ˆç¼“å­˜ï¼‰ä¸€æ®µæ—¶é—´ã€‚ä¸è¿‡JVMåƒåœ¾å›æ”¶æœºåˆ¶å¯ä»¥å›æ”¶è¿™äº›Classå¯¹è±¡ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/9fa2fc8d2f2c981c3105ccf5449e6ed4.png)

#### 4.3.2 ç±»åŠ è½½å™¨çš„åˆ†ç±»(JDK8ä¸ºä¾‹)

JVMæ”¯æŒä¸¤ç§ç±»å‹çš„ç±»åŠ è½½å™¨ï¼Œåˆ†åˆ«ä¸º`å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰`å’Œ`è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆUser-Defined ClassLoaderï¼‰`ã€‚

ä»æ¦‚å¿µä¸Šæ¥è®²ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬æŒ‡çš„æ˜¯ç¨‹åºä¸­ç”±å¼€å‘äººå‘˜è‡ªå®šä¹‰çš„ä¸€ç±»ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒå´æ²¡æœ‰è¿™ä¹ˆå®šä¹‰ï¼Œè€Œæ˜¯å°†æ‰€æœ‰æ´¾ç”ŸäºæŠ½è±¡ç±»ClassLoaderçš„ç±»åŠ è½½å™¨éƒ½åˆ’åˆ†ä¸ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚æ— è®ºç±»åŠ è½½å™¨çš„ç±»å‹å¦‚ä½•åˆ’åˆ†ï¼Œåœ¨ç¨‹åºä¸­æˆ‘ä»¬æœ€å¸¸è§çš„ç±»åŠ è½½å™¨ç»“æ„ä¸»è¦æ˜¯å¦‚ä¸‹æƒ…å†µï¼š

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/b0dc4d0be02db7cade3fee6532c18a84.png)


**ï¼ˆ1ï¼‰å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼ŒBootstrap ClassLoaderï¼‰**

- è¿™ä¸ªç±»åŠ è½½ä½¿ç”¨`C/C++è¯­è¨€`å®ç°çš„ï¼ŒåµŒå¥—åœ¨JVMå†…éƒ¨ã€‚`è·å–å®ƒçš„å¯¹è±¡æ—¶å¾€å¾€è¿”å›null`
- å®ƒç”¨æ¥`åŠ è½½Javaçš„æ ¸å¿ƒåº“`ï¼ˆJAVA_HOME/jre/lib/rt.jaræˆ–sun.boot.class.pathè·¯å¾„ä¸‹çš„å†…å®¹ï¼‰ã€‚ç”¨äºæä¾›JVMè‡ªèº«éœ€è¦çš„ç±»ã€‚
- `å¹¶ä¸ç»§æ‰¿è‡ªjava.lang.ClassLoaderï¼Œæ²¡æœ‰çˆ¶åŠ è½½å™¨`ã€‚
- å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒBootstrapå¯åŠ¨ç±»åŠ è½½å™¨åªåŠ è½½åŒ…åä¸ºjavaã€javaxã€sunç­‰å¼€å¤´çš„ç±»
- åŠ è½½æ‰©å±•ç±»å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå¹¶æŒ‡å®šä¸ºä»–ä»¬çš„çˆ¶ç±»åŠ è½½å™¨ã€‚

**ï¼ˆ2ï¼‰æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰**

- Javaè¯­è¨€ç¼–å†™ï¼Œç”±sun.misc.Launcher$ExtClassLoaderå®ç°ã€‚
- ç»§æ‰¿äºClassLoaderç±»
- çˆ¶ç±»åŠ è½½å™¨ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨
- ä»java.ext.dirsç³»ç»Ÿå±æ€§æ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ï¼Œæˆ–ä»JDKçš„å®‰è£…ç›®å½•çš„jre/lib/extå­ç›®å½•ä¸‹åŠ è½½ç±»åº“ã€‚å¦‚æœç”¨æˆ·åˆ›å»ºçš„JARæ”¾åœ¨æ­¤ç›®å½•ä¸‹ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ã€‚

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/a301baf8afe8bdcbb6bbfd0889efabba.png)


**ï¼ˆ3ï¼‰åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼ŒAppClassLoaderï¼‰**

- javaè¯­è¨€ç¼–å†™ï¼Œç”±sun.misc.Launcher$AppClassLoaderå®ç°
- ç»§æ‰¿äºClassLoaderç±»
- çˆ¶ç±»åŠ è½½å™¨ä¸ºæ‰©å±•ç±»åŠ è½½å™¨
- å®ƒè´Ÿè´£åŠ è½½ç¯å¢ƒå˜é‡classpathæˆ–ç³»ç»Ÿå±æ€§ java.class.path æŒ‡å®šè·¯å¾„ä¸‹çš„ç±»åº“ 
- `åº”ç”¨ç¨‹åºä¸­çš„ç±»åŠ è½½å™¨é»˜è®¤æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨`ã€‚
- å®ƒæ˜¯ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„é»˜è®¤çˆ¶åŠ è½½å™¨
- é€šè¿‡ClassLoaderçš„getSystemClassLoader()æ–¹æ³•å¯ä»¥è·å–åˆ°è¯¥ç±»åŠ è½½å™¨

**ï¼ˆ4ï¼‰ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆäº†è§£ï¼‰**

- åœ¨Javaçš„æ—¥å¸¸åº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œç±»çš„åŠ è½½å‡ ä¹æ˜¯ç”±ä¸Šè¿°3ç§ç±»åŠ è½½å™¨ç›¸äº’é…åˆæ‰§è¡Œçš„ã€‚åœ¨å¿…è¦æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œæ¥å®šåˆ¶ç±»çš„åŠ è½½æ–¹å¼ã€‚
- ä½“ç°Javaè¯­è¨€å¼ºå¤§ç”Ÿå‘½åŠ›å’Œå·¨å¤§é­…åŠ›çš„å…³é”®å› ç´ ä¹‹ä¸€ä¾¿æ˜¯ï¼ŒJavaå¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å®ç°ç±»åº“çš„åŠ¨æ€åŠ è½½ï¼ŒåŠ è½½æºå¯ä»¥æ˜¯æœ¬åœ°çš„JARåŒ…ï¼Œä¹Ÿå¯ä»¥æ˜¯ç½‘ç»œä¸Šçš„è¿œç¨‹èµ„æºã€‚
- åŒæ—¶ï¼Œè‡ªå®šä¹‰åŠ è½½å™¨èƒ½å¤Ÿå®ç°`åº”ç”¨éš”ç¦»`ï¼Œä¾‹å¦‚ Tomcatï¼ŒSpringç­‰ä¸­é—´ä»¶å’Œç»„ä»¶æ¡†æ¶éƒ½åœ¨å†…éƒ¨å®ç°äº†è‡ªå®šä¹‰çš„åŠ è½½å™¨ï¼Œå¹¶é€šè¿‡è‡ªå®šä¹‰åŠ è½½å™¨éš”ç¦»ä¸åŒçš„ç»„ä»¶æ¨¡å—ã€‚è¿™ç§æœºåˆ¶æ¯”C/C++ç¨‹åºè¦å¥½å¤ªå¤šï¼Œæƒ³ä¸ä¿®æ”¹C/C++ç¨‹åºå°±èƒ½ä¸ºå…¶æ–°å¢åŠŸèƒ½ï¼Œå‡ ä¹æ˜¯ä¸å¯èƒ½çš„ï¼Œä»…ä»…ä¸€ä¸ªå…¼å®¹æ€§ä¾¿èƒ½é˜»æŒ¡ä½æ‰€æœ‰ç¾å¥½çš„è®¾æƒ³ã€‚
- è‡ªå®šä¹‰ç±»åŠ è½½å™¨é€šå¸¸éœ€è¦ç»§æ‰¿äºClassLoaderã€‚

#### 4.3.3 æŸ¥çœ‹æŸä¸ªç±»çš„ç±»åŠ è½½å™¨å¯¹è±¡

ï¼ˆ1ï¼‰è·å–é»˜è®¤çš„ç³»ç»Ÿç±»åŠ è½½å™¨

```java
ClassLoader classloader = ClassLoader.getSystemClassLoader();
```

ï¼ˆ2ï¼‰æŸ¥çœ‹æŸä¸ªç±»æ˜¯å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½çš„

```java
ClassLoader classloader = Class.forName("exer2.ClassloaderDemo").getClassLoader();

//å¦‚æœæ˜¯æ ¹åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œåˆ™ä¼šå¾—åˆ°null
ClassLoader classloader1 = Class.forName("java.lang.Object").getClassLoader();
```

ï¼ˆ3ï¼‰è·å–æŸä¸ªç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨

```java
ClassLoader parentClassloader = classloader.getParent();
```

ç¤ºä¾‹ä»£ç ï¼š

```java
package com.atguigu.loader;

import org.junit.Test;

public class TestClassLoader {
    @Test
    public void test01(){
        ClassLoader systemClassLoader = ClassLoader.getSystemClassLoader();
        System.out.println("systemClassLoader = " + systemClassLoader);
    }

    @Test
    public void test02()throws Exception{
        ClassLoader c1 = String.class.getClassLoader();
        System.out.println("åŠ è½½Stringç±»çš„ç±»åŠ è½½å™¨ï¼š" + c1);

        ClassLoader c2 = Class.forName("sun.util.resources.cldr.zh.TimeZoneNames_zh").getClassLoader();
        System.out.println("åŠ è½½sun.util.resources.cldr.zh.TimeZoneNames_zhç±»çš„ç±»åŠ è½½å™¨ï¼š" + c2);

        ClassLoader c3 = TestClassLoader.class.getClassLoader();
        System.out.println("åŠ è½½å½“å‰ç±»çš„ç±»åŠ è½½å™¨ï¼š" + c3);
    }

    @Test
    public void test03(){
        ClassLoader c1 = TestClassLoader.class.getClassLoader();
        System.out.println("åŠ è½½å½“å‰ç±»çš„ç±»åŠ è½½å™¨c1=" + c1);

        ClassLoader c2 = c1.getParent();
        System.out.println("c1.parent = " + c2);

        ClassLoader c3 = c2.getParent();
        System.out.println("c2.parent = " + c3);

    }
}
```

#### 4.3.4 ä½¿ç”¨ClassLoaderè·å–æµ

å…³äºç±»åŠ è½½å™¨çš„ä¸€ä¸ªä¸»è¦æ–¹æ³•ï¼šgetResourceAsStream(String str):è·å–ç±»è·¯å¾„ä¸‹çš„æŒ‡å®šæ–‡ä»¶çš„è¾“å…¥æµ

```java

InputStream in = null;
in = this.getClass().getClassLoader().getResourceAsStream("exer2\\test.properties");
System.out.println(in);

```

ä¸¾ä¾‹ï¼š

```java
//éœ€è¦æŒæ¡å¦‚ä¸‹çš„ä»£ç 
    @Test
    public void test5() throws IOException {
        Properties pros = new Properties();
        //æ–¹å¼1ï¼šæ­¤æ—¶é»˜è®¤çš„ç›¸å¯¹è·¯å¾„æ˜¯å½“å‰çš„module
//        FileInputStream is = new FileInputStream("info.properties");
//        FileInputStream is = new FileInputStream("src//info1.properties");

        //æ–¹å¼2ï¼šä½¿ç”¨ç±»çš„åŠ è½½å™¨
        //æ­¤æ—¶é»˜è®¤çš„ç›¸å¯¹è·¯å¾„æ˜¯å½“å‰moduleçš„srcç›®å½•
        InputStream is = ClassLoader.getSystemClassLoader().getResourceAsStream("info1.properties");


        pros.load(is);

        //è·å–é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯
        String name = pros.getProperty("name");
        String password = pros.getProperty("password");
        System.out.println("name = " + name + ", password = " + password);
    }
```

## 5 åå°„çš„åŸºæœ¬åº”ç”¨

æœ‰äº†Classå¯¹è±¡ï¼Œèƒ½åšä»€ä¹ˆï¼Ÿ

### 5.1 åº”ç”¨1ï¼šåˆ›å»ºè¿è¡Œæ—¶ç±»çš„å¯¹è±¡

è¿™æ˜¯åå°„æœºåˆ¶åº”ç”¨æœ€å¤šçš„åœ°æ–¹ã€‚åˆ›å»ºè¿è¡Œæ—¶ç±»çš„å¯¹è±¡æœ‰ä¸¤ç§æ–¹å¼ï¼š

**æ–¹å¼1ï¼šç›´æ¥è°ƒç”¨Classå¯¹è±¡çš„newInstance()æ–¹æ³•**

è¦ æ±‚ï¼š 
1ï¼‰ç±»å¿…é¡»æœ‰ä¸€ä¸ªæ— å‚æ•°çš„æ„é€ å™¨ã€‚
2ï¼‰ç±»çš„æ„é€ å™¨çš„è®¿é—®æƒé™éœ€è¦è¶³å¤Ÿã€‚

æ­¥éª¤ï¼š
1ï¼‰è·å–è¯¥ç±»å‹çš„Classå¯¹è±¡  
2ï¼‰è°ƒç”¨Classå¯¹è±¡çš„newInstance()æ–¹æ³•åˆ›å»ºå¯¹è±¡

**æ–¹å¼2ï¼šé€šè¿‡è·å–æ„é€ å™¨å¯¹è±¡æ¥è¿›è¡Œå®ä¾‹åŒ–**

æ­¥éª¤ï¼š
1ï¼‰é€šè¿‡Classç±»çš„getDeclaredConstructor(Class â€¦ parameterTypes)å–å¾—æœ¬ç±»çš„æŒ‡å®šå½¢å‚ç±»å‹çš„æ„é€ å™¨
2ï¼‰å‘æ„é€ å™¨çš„å½¢å‚ä¸­ä¼ é€’ä¸€ä¸ªå¯¹è±¡æ•°ç»„è¿›å»ï¼Œé‡Œé¢åŒ…å«äº†æ„é€ å™¨ä¸­æ‰€éœ€çš„å„ä¸ªå‚æ•°ã€‚
3ï¼‰é€šè¿‡Constructorå®ä¾‹åŒ–å¯¹è±¡ã€‚

> å¦‚æœæ„é€ å™¨çš„æƒé™ä¿®é¥°ç¬¦ä¿®é¥°çš„èŒƒå›´ä¸å¯è§ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨setAccessible(true)

ç¤ºä¾‹ä»£ç ï¼š

```java
package com.atguigu.reflect;

import org.junit.Test;

import java.lang.reflect.Constructor;

public class TestCreateObject {
    @Test
    public void test1() throws Exception{
//        AtGuiguClass obj = new AtGuiguClass();//ç¼–è¯‘æœŸé—´æ— æ³•åˆ›å»º

        Class<?> clazz = Class.forName("com.atguigu.ext.demo.AtGuiguClass");
        //clazzä»£è¡¨com.atguigu.ext.demo.AtGuiguClassç±»å‹
        //clazz.newInstance()åˆ›å»ºçš„å°±æ˜¯AtGuiguClassçš„å¯¹è±¡
        Object obj = clazz.newInstance();
        System.out.println(obj);
    }

    @Test
    public void test2()throws Exception{
        Class<?> clazz = Class.forName("com.atguigu.ext.demo.AtGuiguDemo");
        //java.lang.InstantiationException: com.atguigu.ext.demo.AtGuiguDemo
        //Caused by: java.lang.NoSuchMethodException: com.atguigu.ext.demo.AtGuiguDemo.<init>()
        //å³è¯´æ˜AtGuiguDemoæ²¡æœ‰æ— å‚æ„é€ ï¼Œå°±æ²¡æœ‰æ— å‚å®ä¾‹åˆå§‹åŒ–æ–¹æ³•<init>
        Object stu = clazz.newInstance();
        System.out.println(stu);
    }

    @Test
    public void test3()throws Exception{
        //(1)è·å–Classå¯¹è±¡
        Class<?> clazz = Class.forName("com.atguigu.ext.demo.AtGuiguDemo");
        /*
         * è·å–AtGuiguDemoç±»å‹ä¸­çš„æœ‰å‚æ„é€ 
         * å¦‚æœæ„é€ å™¨æœ‰å¤šä¸ªï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯æ ¹æ®å½¢å‚ã€ç±»å‹ã€‘åˆ—è¡¨æ¥è·å–æŒ‡å®šçš„ä¸€ä¸ªæ„é€ å™¨çš„
         * ä¾‹å¦‚ï¼špublic AtGuiguDemo(String title, int num)
         */
        //(2)è·å–æ„é€ å™¨å¯¹è±¡
        Constructor<?> constructor = clazz.getDeclaredConstructor(String.class,int.class);

        //(3)åˆ›å»ºå®ä¾‹å¯¹è±¡
        // T newInstance(Object... initargs)  è¿™ä¸ªObject...æ˜¯åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œç»™æœ‰å‚æ„é€ çš„å®å‚åˆ—è¡¨
        Object obj = constructor.newInstance("å°šç¡…è°·",2022);
        System.out.println(obj);
    }
}
```

### 5.2 åº”ç”¨2ï¼šè·å–è¿è¡Œæ—¶ç±»çš„å®Œæ•´ç»“æ„

å¯ä»¥è·å–ï¼šåŒ…ã€ä¿®é¥°ç¬¦ã€ç±»å‹åã€çˆ¶ç±»ï¼ˆåŒ…æ‹¬æ³›å‹çˆ¶ç±»ï¼‰ã€çˆ¶æ¥å£ï¼ˆåŒ…æ‹¬æ³›å‹çˆ¶æ¥å£ï¼‰ã€æˆå‘˜ï¼ˆå±æ€§ã€æ„é€ å™¨ã€æ–¹æ³•ï¼‰ã€æ³¨è§£ï¼ˆç±»ä¸Šçš„ã€æ–¹æ³•ä¸Šçš„ã€å±æ€§ä¸Šçš„ï¼‰ã€‚

#### 5.2.1 ç›¸å…³API

```java
//1.å®ç°çš„å…¨éƒ¨æ¥å£
public Class<?>[] getInterfaces()   
//ç¡®å®šæ­¤å¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£å®ç°çš„æ¥å£ã€‚ 

//2.æ‰€ç»§æ‰¿çš„çˆ¶ç±»
public Class<? Super T> getSuperclass()
//è¿”å›è¡¨ç¤ºæ­¤ Class æ‰€è¡¨ç¤ºçš„å®ä½“ï¼ˆç±»ã€æ¥å£ã€åŸºæœ¬ç±»å‹ï¼‰çš„çˆ¶ç±»çš„ Classã€‚

//3.å…¨éƒ¨çš„æ„é€ å™¨
public Constructor<T>[] getConstructors()
//è¿”å›æ­¤ Class å¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»çš„æ‰€æœ‰publicæ„é€ æ–¹æ³•ã€‚
public Constructor<T>[] getDeclaredConstructors()
//è¿”å›æ­¤ Class å¯¹è±¡è¡¨ç¤ºçš„ç±»å£°æ˜çš„æ‰€æœ‰æ„é€ æ–¹æ³•ã€‚

//Constructorç±»ä¸­ï¼š
//å–å¾—ä¿®é¥°ç¬¦: 
public int getModifiers();
//å–å¾—æ–¹æ³•åç§°: 
public String getName();
//å–å¾—å‚æ•°çš„ç±»å‹ï¼š
public Class<?>[] getParameterTypes();

//4.å…¨éƒ¨çš„æ–¹æ³•
public Method[] getDeclaredMethods()
//è¿”å›æ­¤Classå¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„å…¨éƒ¨æ–¹æ³•
public Method[] getMethods()  
//è¿”å›æ­¤Classå¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„publicçš„æ–¹æ³•

//Methodç±»ä¸­ï¼š
public Class<?> getReturnType()
//å–å¾—å…¨éƒ¨çš„è¿”å›å€¼
public Class<?>[] getParameterTypes()
//å–å¾—å…¨éƒ¨çš„å‚æ•°
public int getModifiers()
//å–å¾—ä¿®é¥°ç¬¦
public Class<?>[] getExceptionTypes()
//å–å¾—å¼‚å¸¸ä¿¡æ¯

//5.å…¨éƒ¨çš„Field
public Field[] getFields() 
//è¿”å›æ­¤Classå¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„publicçš„Fieldã€‚
public Field[] getDeclaredFields() 
//è¿”å›æ­¤Classå¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„å…¨éƒ¨Fieldã€‚

//Fieldæ–¹æ³•ä¸­ï¼š
public int getModifiers()
//ä»¥æ•´æ•°å½¢å¼è¿”å›æ­¤Fieldçš„ä¿®é¥°ç¬¦
public Class<?> getType()  
//å¾—åˆ°Fieldçš„å±æ€§ç±»å‹
public String getName()  
//è¿”å›Fieldçš„åç§°ã€‚

//6. Annotationç›¸å…³
get Annotation(Class<T> annotationClass) 
getDeclaredAnnotations() 

//7.æ³›å‹ç›¸å…³

//è·å–çˆ¶ç±»æ³›å‹ç±»å‹ï¼š
Type getGenericSuperclass()

//æ³›å‹ç±»å‹ï¼šParameterizedType
//è·å–å®é™…çš„æ³›å‹ç±»å‹å‚æ•°æ•°ç»„ï¼š
getActualTypeArguments()

//8.ç±»æ‰€åœ¨çš„åŒ…
Package getPackage() 
```

#### 5.2.2 è·å–æ‰€æœ‰çš„å±æ€§åŠç›¸å…³ç»†èŠ‚

```java
package com.atguigu.java2;

import java.lang.reflect.Field;
import java.lang.reflect.Modifier;

import org.junit.Test;

import com.atguigu.java1.Person;

public class FieldTest {
	
	@Test
	public void test1(){
		
		Class clazz = Person.class;
		//getFields():è·å–åˆ°è¿è¡Œæ—¶ç±»æœ¬èº«åŠå…¶æ‰€æœ‰çš„çˆ¶ç±»ä¸­å£°æ˜ä¸ºpublicæƒé™çš„å±æ€§
//		Field[] fields = clazz.getFields();
//
//		for(Field f : fields){
//			System.out.println(f);
//		}
		
		//getDeclaredFields():è·å–å½“å‰è¿è¡Œæ—¶ç±»ä¸­å£°æ˜çš„æ‰€æœ‰å±æ€§
		Field[] declaredFields = clazz.getDeclaredFields();
		for(Field f : declaredFields){
			System.out.println(f);
		}
	}
	
	//æƒé™ä¿®é¥°ç¬¦  å˜é‡ç±»å‹  å˜é‡å
	@Test
	public void test2(){
		Class clazz = Person.class;
        Field[] declaredFields = clazz.getDeclaredFields();
        for(Field f : declaredFields){
            //1.æƒé™ä¿®é¥°ç¬¦
            /*
         	* 0xæ˜¯åå…­è¿›åˆ¶
         	* PUBLIC           = 0x00000001;  1    1
         	* PRIVATE          = 0x00000002;  2	10
         	* PROTECTED        = 0x00000004;  4	100
         	* STATIC           = 0x00000008;  8	1000
         	* FINAL            = 0x00000010;  16	10000
         	* ...
         	*
         	* è®¾è®¡çš„ç†å¿µï¼Œå°±æ˜¯ç”¨äºŒè¿›åˆ¶çš„æŸä¸€ä½æ˜¯1ï¼Œæ¥ä»£è¡¨ä¸€ç§ä¿®é¥°ç¬¦ï¼Œæ•´ä¸ªäºŒè¿›åˆ¶ä¸­åªæœ‰ä¸€ä½æ˜¯1ï¼Œå…¶ä½™éƒ½æ˜¯0
         	*
         	* mod = 17          0x00000011
         	* if ((mod & PUBLIC) != 0)  è¯´æ˜ä¿®é¥°ç¬¦ä¸­æœ‰public
         	* if ((mod & FINAL) != 0)   è¯´æ˜ä¿®é¥°ç¬¦ä¸­æœ‰final
         	*/
            int modifier = f.getModifiers();
            System.out.print(Modifier.toString(modifier) + "\t");

//            //2.æ•°æ®ç±»å‹
            Class type = f.getType();
            System.out.print(type.getName() + "\t");
//
//            //3.å˜é‡å
            String fName = f.getName();
            System.out.print(fName);
//
            System.out.println();
        }
	}
}

```

#### 5.2.3 è·å–æ‰€æœ‰çš„æ–¹æ³•åŠç›¸å…³ç»†èŠ‚

```java
package com.atguigu.java2;

import java.lang.annotation.Annotation;
import java.lang.reflect.Method;
import java.lang.reflect.Modifier;

import org.junit.Test;

import com.atguigu.java1.Person;

public class MethodTest {

	@Test
	public void test1() {

		Class clazz = Person.class;
		// getMethods():è·å–åˆ°è¿è¡Œæ—¶ç±»æœ¬èº«åŠå…¶æ‰€æœ‰çš„çˆ¶ç±»ä¸­å£°æ˜ä¸ºpublicæƒé™çš„æ–¹æ³•
		// Method[] methods = clazz.getMethods();
		//
		// for(Method m : methods){
		// System.out.println(m);
		// }

		// getDeclaredMethods():è·å–å½“å‰è¿è¡Œæ—¶ç±»ä¸­å£°æ˜çš„æ‰€æœ‰æ–¹æ³•
		Method[] declaredMethods = clazz.getDeclaredMethods();
		for (Method m : declaredMethods) {
			System.out.println(m);
		}
		//
	}

	// æ³¨è§£ä¿¡æ¯
	// æƒé™ä¿®é¥°ç¬¦ è¿”å›å€¼ç±»å‹ æ–¹æ³•å(å½¢å‚ç±»å‹1 å‚æ•°1,å½¢å‚ç±»å‹2 å‚æ•°2,...) throws å¼‚å¸¸ç±»å‹1,...{}
	@Test
	public void test2() {
		Class clazz = Person.class;
		Method[] declaredMethods = clazz.getDeclaredMethods();
		for (Method m : declaredMethods) {
			// 1.è·å–æ–¹æ³•å£°æ˜çš„æ³¨è§£
			Annotation[] annos = m.getAnnotations();
			for (Annotation a : annos) {
				System.out.println(a);
			}

			// 2.æƒé™ä¿®é¥°ç¬¦
			System.out.print(Modifier.toString(m.getModifiers()) + "\t");

			// 3.è¿”å›å€¼ç±»å‹
			System.out.print(m.getReturnType().getName() + "\t");

			// 4.æ–¹æ³•å
			System.out.print(m.getName());
			System.out.print("(");
			// 5.å½¢å‚åˆ—è¡¨
			Class[] parameterTypes = m.getParameterTypes();
			if (!(parameterTypes == null && parameterTypes.length == 0)) {
				for (int i = 0; i < parameterTypes.length; i++) {

					if (i == parameterTypes.length - 1) {
						System.out.print(parameterTypes[i].getName() + " args_" + i);
						break;
					}

					System.out.print(parameterTypes[i].getName() + " args_" + i + ",");
				}
			}

			System.out.print(")");

			// 6.æŠ›å‡ºçš„å¼‚å¸¸
			Class[] exceptionTypes = m.getExceptionTypes();
			if (exceptionTypes.length > 0) {
				System.out.print("throws ");
				for (int i = 0; i < exceptionTypes.length; i++) {
					if (i == exceptionTypes.length - 1) {
						System.out.print(exceptionTypes[i].getName());
						break;
					}
					System.out.print(exceptionTypes[i].getName() + ",");
				}
			}
			System.out.println();
		}
	}
}

```

#### 5.2.4 è·å–å…¶ä»–ç»“æ„(æ„é€ å™¨ã€çˆ¶ç±»ã€æ¥å£ã€åŒ…ã€æ³¨è§£ç­‰)

```java
package com.atguigu.java2;

import com.atguigu.java1.Person;
import org.junit.Test;

import java.lang.annotation.Annotation;
import java.lang.reflect.Constructor;
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Type;

/**
 * @author å°šç¡…è°·-å®‹çº¢åº·
 * @create 2020 ä¸‹åˆ 2:47
 */
public class OtherTest {

    /*
    	è·å–å½“å‰ç±»ä¸­çš„æ‰€æœ‰çš„æ„é€ å™¨
     */
    @Test
    public void test1(){
        Class clazz = Person.class;
        Constructor[] cons = clazz.getDeclaredConstructors();
        for(Constructor c :cons){
            System.out.println(c);
        }
    }
    /*
    	è·å–è¿è¡Œæ—¶ç±»çš„çˆ¶ç±»
     */
    @Test
    public void test2(){
        Class clazz = Person.class;
        Class superclass = clazz.getSuperclass();
        System.out.println(superclass);//class com.atguigu.java1.Creature
    }
    /*
    	è·å–è¿è¡Œæ—¶ç±»çš„æ‰€åœ¨çš„åŒ…
     */
    @Test
    public void test3(){
        Class clazz = Person.class;
        Package pack = clazz.getPackage();
        System.out.println(pack);

    }
    /*
    	è·å–è¿è¡Œæ—¶ç±»çš„æ³¨è§£
     */
    @Test
    public void test4(){
        Class clazz = Person.class;
        Annotation[] annos = clazz.getAnnotations();
        for (Annotation anno : annos) {

            System.out.println(anno);
        }

    }

    /*
    	è·å–è¿è¡Œæ—¶ç±»æ‰€å®ç°çš„æ¥å£
     */
    @Test
    public void test5(){
        Class clazz = Person.class;
        Class[] interfaces = clazz.getInterfaces();
        for (Class anInterface : interfaces) {

            System.out.println(anInterface);
        }

    }
    /*
    	è·å–è¿è¡Œæ—¶ç±»çš„å¸¦æ³›å‹çš„çˆ¶ç±»
     */
    @Test
    public void test6(){
        Class clazz = Person.class;
        Type genericSuperclass = clazz.getGenericSuperclass();
        System.out.println(genericSuperclass);//com.atguigu.java1.Creature<java.lang.String>
    }
}

```

#### 5.2.5 è·å–æ³›å‹çˆ¶ç±»ä¿¡æ¯ï¼ˆé€‰è®²ï¼‰

ç¤ºä¾‹ä»£ç è·å–æ³›å‹çˆ¶ç±»ä¿¡æ¯ï¼š

```java
/* Typeï¼š
 * ï¼ˆ1ï¼‰Class
 * ï¼ˆ2ï¼‰ParameterizedType   
 * 		ä¾‹å¦‚ï¼šFather<String,Integer>
 * 			ArrayList<String>
 * ï¼ˆ3ï¼‰TypeVariable
 * 		ä¾‹å¦‚ï¼šTï¼ŒU,E,K,V
 * ï¼ˆ4ï¼‰WildcardType
 * 		ä¾‹å¦‚ï¼š
 * 		ArrayList<?>
 * 		ArrayList<? super ä¸‹é™>
 * 		ArrayList<? extends ä¸Šé™>
 * ï¼ˆ5ï¼‰GenericArrayType
 * 		ä¾‹å¦‚ï¼šT[]
 * 	
 */
public class TestGeneric {
	public static void main(String[] args) {
		//éœ€æ±‚ï¼šåœ¨è¿è¡Œæ—¶ï¼Œè·å–Sonç±»å‹çš„æ³›å‹çˆ¶ç±»çš„æ³›å‹å®å‚<String,Integer>
		
		//ï¼ˆ1ï¼‰è¿˜æ˜¯å…ˆè·å–Classå¯¹è±¡
		Class clazz = Son.class;//å››ç§å½¢å¼ä»»æ„ä¸€ç§éƒ½å¯ä»¥
		
		//ï¼ˆ2ï¼‰è·å–æ³›å‹çˆ¶ç±»
//		Class sc = clazz.getSuperclass();
//		System.out.println(sc);
		/*
		 * getSuperclass()åªèƒ½å¾—åˆ°çˆ¶ç±»åï¼Œæ— æ³•å¾—åˆ°çˆ¶ç±»çš„æ³›å‹å®å‚åˆ—è¡¨
		 */
		Type type = clazz.getGenericSuperclass();
		
		// Father<String,Integer>å±äºParameterizedType
		ParameterizedType pt = (ParameterizedType) type;
		
		//ï¼ˆ3ï¼‰è·å–æ³›å‹çˆ¶ç±»çš„æ³›å‹å®å‚åˆ—è¡¨
		Type[] typeArray = pt.getActualTypeArguments();
		for (Type type2 : typeArray) {
			System.out.println(type2);
		}
	}
}
//æ³›å‹å½¢å‚ï¼š<T,U>
class Father<T,U>{
	
}
//æ³›å‹å®å‚ï¼š<String,Integer>
class Son extends Father<String,Integer>{
	
}
```

#### 5.2.6 è·å–å†…éƒ¨ç±»æˆ–å¤–éƒ¨ç±»ä¿¡æ¯ï¼ˆé€‰è®²ï¼‰

public Class<?>[] getClasses()ï¼šè¿”å›æ‰€æœ‰å…¬å…±å†…éƒ¨ç±»å’Œå†…éƒ¨æ¥å£ã€‚åŒ…æ‹¬ä»è¶…ç±»ç»§æ‰¿çš„å…¬å…±ç±»å’Œæ¥å£æˆå‘˜ä»¥åŠè¯¥ç±»å£°æ˜çš„å…¬å…±ç±»å’Œæ¥å£æˆå‘˜ã€‚

public Class<?>[] getDeclaredClasses()ï¼šè¿”å› Class å¯¹è±¡çš„ä¸€ä¸ªæ•°ç»„ï¼Œè¿™äº›å¯¹è±¡åæ˜ å£°æ˜ä¸ºæ­¤ Class å¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»çš„æˆå‘˜çš„æ‰€æœ‰ç±»å’Œæ¥å£ã€‚åŒ…æ‹¬è¯¥ç±»æ‰€å£°æ˜çš„å…¬å…±ã€ä¿æŠ¤ã€é»˜è®¤ï¼ˆåŒ…ï¼‰è®¿é—®åŠç§æœ‰ç±»å’Œæ¥å£ï¼Œä½†ä¸åŒ…æ‹¬ç»§æ‰¿çš„ç±»å’Œæ¥å£ã€‚

public Class<?> getDeclaringClass()ï¼šå¦‚æœæ­¤ Class å¯¹è±¡æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£æ˜¯ä¸€ä¸ªå†…éƒ¨ç±»æˆ–å†…éƒ¨æ¥å£ï¼Œåˆ™è¿”å›å®ƒçš„å¤–éƒ¨ç±»æˆ–å¤–éƒ¨æ¥å£ï¼Œå¦åˆ™è¿”å›nullã€‚

Class<?> getEnclosingClass() ï¼šè¿”å›æŸä¸ªå†…éƒ¨ç±»çš„å¤–éƒ¨ç±»

```java
	@Test
	public void test5(){
		Class<?> clazz = Map.class;
		Class<?>[] inners = clazz.getDeclaredClasses();
		for (Class<?> inner : inners) {
			System.out.println(inner);
		}
		
		Class<?> ec = Map.Entry.class;
		Class<?> outer = ec.getDeclaringClass();
		System.out.println(outer);
	}
```



#### 5.2.7 å° ç»“

1. åœ¨å®é™…çš„æ“ä½œä¸­ï¼Œå–å¾—ç±»çš„ä¿¡æ¯çš„æ“ä½œä»£ç ï¼Œå¹¶ä¸ä¼šç»å¸¸å¼€å‘ã€‚

2. `ä¸€å®šè¦ç†Ÿæ‚‰java.lang.reflectåŒ…çš„ä½œç”¨ï¼Œåå°„æœºåˆ¶`ã€‚

### 5.3 åº”ç”¨3ï¼šè°ƒç”¨è¿è¡Œæ—¶ç±»çš„æŒ‡å®šç»“æ„

#### 5.3.1 è°ƒç”¨æŒ‡å®šçš„å±æ€§

åœ¨åå°„æœºåˆ¶ä¸­ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡Fieldç±»æ“ä½œç±»ä¸­çš„å±æ€§ï¼Œé€šè¿‡Fieldç±»æä¾›çš„set()å’Œget()æ–¹æ³•å°±å¯ä»¥å®Œæˆè®¾ç½®å’Œå–å¾—å±æ€§å†…å®¹çš„æ“ä½œã€‚

ï¼ˆ1ï¼‰è·å–è¯¥ç±»å‹çš„Classå¯¹è±¡

Class clazz = Class.forName("åŒ….ç±»å");

ï¼ˆ2ï¼‰è·å–å±æ€§å¯¹è±¡

Field field = clazz.getDeclaredField("å±æ€§å");

ï¼ˆ3ï¼‰å¦‚æœå±æ€§çš„æƒé™ä¿®é¥°ç¬¦ä¸æ˜¯publicï¼Œé‚£ä¹ˆéœ€è¦è®¾ç½®å±æ€§å¯è®¿é—®

field.setAccessible(true);

ï¼ˆ4ï¼‰åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼šå¦‚æœæ“ä½œçš„æ˜¯éé™æ€å±æ€§ï¼Œéœ€è¦åˆ›å»ºå®ä¾‹å¯¹è±¡

Object obj = clazz.newInstance(); //æœ‰å…¬å…±çš„æ— å‚æ„é€ 

Object obj = æ„é€ å™¨å¯¹è±¡.newInstance(å®å‚...);//é€šè¿‡ç‰¹å®šæ„é€ å™¨å¯¹è±¡åˆ›å»ºå®ä¾‹å¯¹è±¡

ï¼ˆ4ï¼‰è®¾ç½®æŒ‡å®šå¯¹è±¡objä¸Šæ­¤Fieldçš„å±æ€§å†…å®¹

`field.set(obj,"å±æ€§å€¼");`

> `å¦‚æœæ“ä½œé™æ€å˜é‡ï¼Œé‚£ä¹ˆå®ä¾‹å¯¹è±¡å¯ä»¥çœç•¥ï¼Œç”¨nullè¡¨ç¤º`

ï¼ˆ5ï¼‰å–å¾—æŒ‡å®šå¯¹è±¡objä¸Šæ­¤Fieldçš„å±æ€§å†…å®¹

`Object value = field.get(obj);`

> å¦‚æœæ“ä½œé™æ€å˜é‡ï¼Œé‚£ä¹ˆå®ä¾‹å¯¹è±¡å¯ä»¥çœç•¥ï¼Œç”¨nullè¡¨ç¤º

ç¤ºä¾‹ä»£ç ï¼š

```java
package com.atguigu.reflect;

public class Student {
    private int id;
    private String name;

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @Override
    public String toString() {
        return "Student{" +
                "id=" + id +
                ", name='" + name + '\'' +
                '}';
    }
}

```

```java
package com.atguigu.reflect;

import java.lang.reflect.Field;

public class TestField {
    public static void main(String[] args)throws Exception {
        //1ã€è·å–Studentçš„Classå¯¹è±¡
        Class clazz = Class.forName("com.atguigu.reflect.Student");

        //2ã€è·å–å±æ€§å¯¹è±¡ï¼Œä¾‹å¦‚ï¼šidå±æ€§
        Field idField = clazz.getDeclaredField("id");

        //3ã€å¦‚æœidæ˜¯ç§æœ‰çš„ç­‰åœ¨å½“å‰ç±»ä¸­ä¸å¯è®¿é—®accessçš„ï¼Œæˆ‘ä»¬éœ€è¦åšå¦‚ä¸‹æ“ä½œ
        idField.setAccessible(true);

        //4ã€åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œå³ï¼Œåˆ›å»ºStudentå¯¹è±¡
        Object stu = clazz.newInstance();

        //5ã€è·å–å±æ€§å€¼
        /*
         * ä»¥å‰ï¼šint å˜é‡= å­¦ç”Ÿå¯¹è±¡.getId()
         * ç°åœ¨ï¼šObject idå±æ€§å¯¹è±¡.get(å­¦ç”Ÿå¯¹è±¡)
         */
        Object value = idField.get(stu);
        System.out.println("id = "+ value);

        //6ã€è®¾ç½®å±æ€§å€¼
        /*
         * ä»¥å‰ï¼šå­¦ç”Ÿå¯¹è±¡.setId(å€¼)
         * ç°åœ¨ï¼šidå±æ€§å¯¹è±¡.set(å­¦ç”Ÿå¯¹è±¡,å€¼)
         */
        idField.set(stu, 2);

        value = idField.get(stu);
        System.out.println("id = "+ value);
    }
}
```

**å…³äºsetAccessibleæ–¹æ³•çš„ä½¿ç”¨ï¼š**

- Methodå’ŒFieldã€Constructorå¯¹è±¡éƒ½æœ‰setAccessible()æ–¹æ³•ã€‚
- setAccessibleå¯åŠ¨å’Œç¦ç”¨è®¿é—®å®‰å…¨æ£€æŸ¥çš„å¼€å…³ã€‚
- å‚æ•°å€¼ä¸ºtrueåˆ™æŒ‡ç¤ºåå°„çš„å¯¹è±¡åœ¨ä½¿ç”¨æ—¶åº”è¯¥å–æ¶ˆJavaè¯­è¨€è®¿é—®æ£€æŸ¥ã€‚
	- æé«˜åå°„çš„æ•ˆç‡ã€‚å¦‚æœä»£ç ä¸­å¿…é¡»ç”¨åå°„ï¼Œè€Œè¯¥å¥ä»£ç éœ€è¦é¢‘ç¹çš„è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆè¯·è®¾ç½®ä¸ºtrueã€‚
	- ä½¿å¾—åŸæœ¬æ— æ³•è®¿é—®çš„ç§æœ‰æˆå‘˜ä¹Ÿå¯ä»¥è®¿é—®
- å‚æ•°å€¼ä¸ºfalseåˆ™æŒ‡ç¤ºåå°„çš„å¯¹è±¡åº”è¯¥å®æ–½Javaè¯­è¨€è®¿é—®æ£€æŸ¥ã€‚

#### 5.3.2 è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/91818e4d06f3696719aa986387a2c623.png)


ï¼ˆ1ï¼‰è·å–è¯¥ç±»å‹çš„Classå¯¹è±¡

Class clazz = Class.forName("åŒ….ç±»å");

ï¼ˆ2ï¼‰è·å–æ–¹æ³•å¯¹è±¡

Method method = clazz.getDeclaredMethod("æ–¹æ³•å",æ–¹æ³•çš„å½¢å‚ç±»å‹åˆ—è¡¨);

ï¼ˆ3ï¼‰åˆ›å»ºå®ä¾‹å¯¹è±¡

Object obj = clazz.newInstance();

ï¼ˆ4ï¼‰è°ƒç”¨æ–¹æ³•

`Object result = method.invoke(obj, æ–¹æ³•çš„å®å‚å€¼åˆ—è¡¨);`

> å¦‚æœæ–¹æ³•çš„æƒé™ä¿®é¥°ç¬¦ä¿®é¥°çš„èŒƒå›´ä¸å¯è§ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨setAccessible(true)
>
> `å¦‚æœæ–¹æ³•æ˜¯é™æ€æ–¹æ³•ï¼Œå®ä¾‹å¯¹è±¡ä¹Ÿå¯ä»¥çœç•¥ï¼Œç”¨nullä»£æ›¿`

ç¤ºä¾‹ä»£ç ï¼š

```java
package com.atguigu.reflect;

import org.junit.Test;

import java.lang.reflect.Method;

public class TestMethod {
    @Test
    public void test()throws Exception {
        // 1ã€è·å–Studentçš„Classå¯¹è±¡
        Class<?> clazz = Class.forName("com.atguigu.reflect.Student");

        //2ã€è·å–æ–¹æ³•å¯¹è±¡
        /*
         * åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå”¯ä¸€å®šä½åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œéœ€è¦ï¼šï¼ˆ1ï¼‰æ–¹æ³•åï¼ˆ2ï¼‰å½¢å‚åˆ—è¡¨ï¼Œå› ä¸ºæ–¹æ³•å¯èƒ½é‡è½½
         *
         * ä¾‹å¦‚ï¼švoid setName(String name)
         */
        Method setNameMethod = clazz.getDeclaredMethod("setName", String.class);

        //3ã€åˆ›å»ºå®ä¾‹å¯¹è±¡
        Object stu = clazz.newInstance();

        //4ã€è°ƒç”¨æ–¹æ³•
        /*
         * ä»¥å‰ï¼šå­¦ç”Ÿå¯¹è±¡.setName(å€¼)
         * ç°åœ¨ï¼šæ–¹æ³•å¯¹è±¡.invoke(å­¦ç”Ÿå¯¹è±¡ï¼Œå€¼)
         */
        Object setNameMethodReturnValue = setNameMethod.invoke(stu, "å¼ ä¸‰");

        System.out.println("stu = " + stu);
        //setNameæ–¹æ³•è¿”å›å€¼ç±»å‹voidï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥setNameMethodReturnValueä¸ºnull
        System.out.println("setNameMethodReturnValue = " + setNameMethodReturnValue);

        Method getNameMethod = clazz.getDeclaredMethod("getName");
        Object getNameMethodReturnValue = getNameMethod.invoke(stu);
        //getNameæ–¹æ³•è¿”å›å€¼ç±»å‹Stringï¼Œæœ‰è¿”å›å€¼ï¼ŒgetNameMethod.invokeçš„è¿”å›å€¼å°±æ˜¯getNameæ–¹æ³•çš„è¿”å›å€¼
        System.out.println("getNameMethodReturnValue = " + getNameMethodReturnValue);//å¼ ä¸‰
    }

    @Test
    public void test02()throws Exception{
        Class<?> clazz = Class.forName("com.atguigu.ext.demo.AtGuiguClass");
        Method printInfoMethod = clazz.getMethod("printInfo", String.class);
        //printInfoæ–¹æ³•æ˜¯é™æ€æ–¹æ³•
        printInfoMethod.invoke(null,"å°šç¡…è°·");
    }
}

```

#### 5.3.3 ç»ƒä¹ 

è¯»å–user.propertiesæ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œé€šè¿‡åå°„å®ŒæˆUserç±»å¯¹è±¡çš„åˆ›å»ºåŠå¯¹åº”æ–¹æ³•çš„è°ƒç”¨ã€‚

é…ç½®æ–‡ä»¶ï¼šuser.properties

```
className:com.atguigu.bean.User
methodName:show
```

User.javaæ–‡ä»¶ï¼š

```java
package com.atguigu.bean;

/**
 * @author å°šç¡…è°·-å®‹çº¢åº·
 * @create 18:41
 */
public class User {
    private String name;

    public User() {
    }

    public User(String name) {
        this.name = name;
    }

    public void show(){
        System.out.println("æˆ‘æ˜¯ä¸€ä¸ªè„‰è„‰å¹³å°çš„ç”¨æˆ·");
    }
}
```

ReflectTest.javaæ–‡ä»¶ï¼š

```java
package com.atguigu.java4;

import org.junit.Test;

import java.io.IOException;
import java.io.InputStream;
import java.lang.reflect.Method;
import java.util.Properties;

/**
 * @author å°šç¡…è°·-å®‹çº¢åº·
 * @create 18:43
 */
public class ReflectTest {
    @Test
    public void test() throws Exception {
        //1.åˆ›å»ºPropertieså¯¹è±¡
        Properties pro = new Properties();

        //2.åŠ è½½é…ç½®æ–‡ä»¶ï¼Œè½¬æ¢ä¸ºä¸€ä¸ªé›†åˆ
        ClassLoader classLoader = ClassLoader.getSystemClassLoader();
        InputStream is = classLoader.getResourceAsStream("user.properties");
        pro.load(is);

        //3.è·å–é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„æ•°æ®
        String className = pro.getProperty("className");
        String methodName = pro.getProperty("methodName");

        //4.åŠ è½½è¯¥ç±»è¿›å†…å­˜
        Class clazz = Class.forName(className);

        //5.åˆ›å»ºå¯¹è±¡
        Object instance = clazz.newInstance();

        //6.è·å–æ–¹æ³•å¯¹è±¡
        Method showMethod = clazz.getMethod(methodName);

        //7.æ‰§è¡Œæ–¹æ³•
        showMethod.invoke(instance);
    }
}

```

## 6 åº”ç”¨4ï¼šè¯»å–æ³¨è§£ä¿¡æ¯

ä¸€ä¸ªå®Œæ•´çš„æ³¨è§£åº”è¯¥åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š
ï¼ˆ1ï¼‰å£°æ˜
ï¼ˆ2ï¼‰ä½¿ç”¨
ï¼ˆ3ï¼‰è¯»å–

### 6.1 å£°æ˜è‡ªå®šä¹‰æ³¨è§£

```java
package com.atguigu.annotation;

import java.lang.annotation.*;

@Inherited
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Table {
    String value();
}
```

```java
package com.atguigu.annotation;

import java.lang.annotation.*;

@Inherited
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Column {
    String columnName();
    String columnType();
}
```

* è‡ªå®šä¹‰æ³¨è§£å¯ä»¥é€šè¿‡å››ä¸ªå…ƒæ³¨è§£@Retention,@Targetï¼Œ@Inherited,@Documentedï¼Œåˆ†åˆ«è¯´æ˜å®ƒçš„å£°æ˜å‘¨æœŸï¼Œä½¿ç”¨ä½ç½®ï¼Œæ˜¯å¦è¢«ç»§æ‰¿ï¼Œæ˜¯å¦è¢«ç”Ÿæˆåˆ°APIæ–‡æ¡£ä¸­ã€‚
* `Annotation çš„æˆå‘˜åœ¨ Annotation å®šä¹‰ä¸­ä»¥æ— å‚æ•°æœ‰è¿”å›å€¼çš„æŠ½è±¡æ–¹æ³•çš„å½¢å¼æ¥å£°æ˜ï¼Œæˆ‘ä»¬åˆç§°ä¸ºé…ç½®å‚æ•°`ã€‚è¿”å›å€¼ç±»å‹åªèƒ½æ˜¯å…«ç§åŸºæœ¬æ•°æ®ç±»å‹ã€Stringç±»å‹ã€Classç±»å‹ã€enumç±»å‹ã€Annotationç±»å‹ã€å’Œä»¥ä¸Šæ‰€æœ‰ç±»å‹çš„æ•°ç»„
* å¯ä»¥ä½¿ç”¨ default å…³é”®å­—ä¸ºæŠ½è±¡æ–¹æ³•æŒ‡å®šé»˜è®¤è¿”å›å€¼
* å¦‚æœå®šä¹‰çš„æ³¨è§£å«æœ‰æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆä½¿ç”¨æ—¶å¿…é¡»æŒ‡å®šè¿”å›å€¼ï¼Œé™¤éå®ƒæœ‰é»˜è®¤å€¼ã€‚æ ¼å¼æ˜¯â€œæ–¹æ³•å = è¿”å›å€¼â€ï¼Œ
* å¦‚æœåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•éœ€è¦èµ‹å€¼ï¼Œä¸”æ–¹æ³•åä¸ºvalueï¼Œå¯ä»¥çœç•¥â€œvalue=â€ï¼Œæ‰€ä»¥å¦‚æœæ³¨è§£åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•æˆå‘˜ï¼Œå»ºè®®ä½¿ç”¨æ–¹æ³•åvalueã€‚

### 6.2 ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£

```java
package com.atguigu.annotation;

@Table("t_stu")
public class Student {
    @Column(columnName = "sid",columnType = "int")
    private int id;
    @Column(columnName = "sname",columnType = "varchar(20)")
    private String name;

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @Override
    public String toString() {
        return "Student{" +
                "id=" + id +
                ", name='" + name + '\'' +
                '}';
    }
}

```

### 6.3 è¯»å–å’Œå¤„ç†è‡ªå®šä¹‰æ³¨è§£

è‡ªå®šä¹‰æ³¨è§£å¿…é¡»é…ä¸Šæ³¨è§£çš„ä¿¡æ¯å¤„ç†æµç¨‹æ‰æœ‰æ„ä¹‰ã€‚

æˆ‘ä»¬`è‡ªå·±å®šä¹‰çš„æ³¨è§£ï¼Œåªèƒ½ä½¿ç”¨åå°„çš„ä»£ç è¯»å–ã€‚æ‰€ä»¥è‡ªå®šä¹‰æ³¨è§£çš„å£°æ˜å‘¨æœŸå¿…é¡»æ˜¯RetentionPolicy.RUNTIME`ã€‚

```java
package com.atguigu.annotation;

import java.lang.reflect.Field;

public class TestAnnotation {
    public static void main(String[] args) {
        Class studentClass = Student.class;
        Table tableAnnotation = (Table) studentClass.getAnnotation(Table.class);
        String tableName = "";
        if(tableAnnotation != null){
            tableName = tableAnnotation.value();
        }

        Field[] declaredFields = studentClass.getDeclaredFields();
        String[] columns = new String[declaredFields.length];
        int index = 0;
        for (Field declaredField : declaredFields) {
            Column column = declaredField.getAnnotation(Column.class);
            if(column!= null) {
                columns[index++] = column.columnName();
            }
        }
        
        String sql = "select ";
        for (int i=0; i<index; i++) {
            sql += columns[i];
            if(i<index-1){
                sql += ",";
            }
        }
        sql += " from " + tableName;
        System.out.println("sql = " + sql);
    }
}

```

## 7 ä½“ä¼šåå°„çš„åŠ¨æ€æ€§

**ä½“ä¼š1ï¼š**

```java
public class ReflectionTest {

    //ä½“ä¼šåå°„çš„åŠ¨æ€æ€§ï¼šåŠ¨æ€çš„åˆ›å»ºç»™å®šå­—ç¬¦ä¸²å¯¹åº”çš„ç±»çš„å¯¹è±¡
    public <T> T getInstance(String classPath) throws Exception {

        Class clazz = Class.forName(classPath);

        Constructor constructor = clazz.getDeclaredConstructor();
        constructor.setAccessible(true);
        return (T) constructor.newInstance();

    }

    @Test
    public void test1() throws Exception {
        String classPath = "com.atguigu.java1.Person";
        Person p1 = getInstance(classPath);
        System.out.println(p1);
    }
}
```

**ä½“ä¼š2ï¼š**

```java
public class ReflectionTest {
    //ä½“ä¼šåå°„çš„åŠ¨æ€æ€§ï¼šåŠ¨æ€çš„åˆ›å»ºæŒ‡å®šå­—ç¬¦ä¸²å¯¹åº”ç±»çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•
    public Object  invoke(String classPath,String methodName) throws Exception {
        Class clazz = Class.forName(classPath);
        Constructor constructor = clazz.getDeclaredConstructor();
        constructor.setAccessible(true);
        //åŠ¨æ€çš„åˆ›å»ºæŒ‡å®šå­—ç¬¦ä¸²å¯¹åº”ç±»çš„å¯¹è±¡
        Object obj = constructor.newInstance();

        Method method = clazz.getDeclaredMethod(methodName);
        method.setAccessible(true);
        return method.invoke(obj);
    }

    @Test
    public void test2() throws Exception {
        String info = (String) invoke("com.atguigu.java1.Person", "show");

        System.out.println("è¿”å›å€¼ä¸ºï¼š" + info);

    }
}
```

**ä½“ä¼š3ï¼š**

```java
public class ReflectionTest {
	@Test
    public void test1() throws Exception {
        //1.åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¹¶è·å–æŒ‡å®šçš„fruitNameå€¼
        Properties pros = new Properties();
        InputStream is = ClassLoader.getSystemClassLoader().getResourceAsStream("config.properties");
        pros.load(is);
        String fruitStr = pros.getProperty("fruitName");
        //2.åˆ›å»ºæŒ‡å®šå…¨ç±»åå¯¹åº”ç±»çš„å®ä¾‹
        Class clazz = Class.forName(fruitStr);
        Constructor constructor = clazz.getDeclaredConstructor();
        constructor.setAccessible(true);
        Fruit fruit = (Fruit) constructor.newInstance();
        //3. è°ƒç”¨ç›¸å…³æ–¹æ³•ï¼Œè¿›è¡Œæµ‹è¯•
        Juicer juicer = new Juicer();
        juicer.run(fruit);

    }

}

interface Fruit {
	public void squeeze();
}

class Apple implements Fruit {
	public void squeeze() {
		System.out.println("æ¦¨å‡ºä¸€æ¯è‹¹æœæ±å„¿");
	}
}

class Orange implements Fruit {
	public void squeeze() {
		System.out.println("æ¦¨å‡ºä¸€æ¯æ¡”å­æ±å„¿");
	}
}

class Juicer {
	public void run(Fruit f) {
		f.squeeze();
	}
}

```

å…¶ä¸­ï¼Œé…ç½®æ–‡ä»¶ã€config.propertiesã€‘å­˜æ”¾åœ¨å½“å‰Moduleçš„srcä¸‹

```
com.atguigu.java1.Orange
```

