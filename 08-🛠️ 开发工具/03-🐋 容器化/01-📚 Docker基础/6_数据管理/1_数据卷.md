---
æ–‡ç« æ ‡é¢˜: "[[1_æ•°æ®å·]]"
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æ–‡ç« è¯¦ç»†ä»‹ç»äº†Dockeræ•°æ®å·çš„æ¦‚å¿µã€å¿…è¦æ€§åŠç‰¹æ€§ï¼Œæ˜¯å®¹å™¨æ•°æ®æŒä¹…åŒ–ä¸å…±äº«çš„å…³é”®ã€‚å®ƒåŒºåˆ†äº†Volumeã€Bind Mountå’ŒTmpfs Mountä¸‰ç§æŒ‚è½½æ–¹å¼ï¼Œå¹¶æä¾›äº†æ•°æ®å·çš„åˆ›å»ºã€æŒ‚è½½ã€ç®¡ç†ç­‰å®ç”¨æ“ä½œç¤ºä¾‹ã€‚
tags:
  - Docker
  - æ•°æ®å·
  - Volume
  - Bind Mount
  - æ•°æ®æŒä¹…åŒ–
  - å®¹å™¨ç®¡ç†
  - æŒ‚è½½
ç›¸å…³æ–‡ç« :
  - "[[../9_å¸¸è§ç¯å¢ƒå®‰è£…/2_å®‰è£…MySQL]]"
  - "[[2_ğŸ“•Docker æœ¬åœ°å®‰è£… Minio å¯¹è±¡å­˜å‚¨]]"
  - "[[../../../04-â˜ï¸ è¿ç»´éƒ¨ç½²/02-ğŸ¤– è‡ªåŠ¨åŒ–éƒ¨ç½²/10_è¡¥å……ï¼šJetBrainså…¨å®¶æ¡¶é›†æˆæœåŠ¡å™¨ä¸Šçš„DockeræœåŠ¡]]"
  - "[[2_æ•°æ®å·å®¹å™¨]]"
  - "[[../9_å¸¸è§ç¯å¢ƒå®‰è£…/3_å®‰è£…Nginx]]"
æ–‡ç« åˆ†ç±»: ğŸ› ï¸ å¼€å‘å·¥å…·å’ŒOSç›¸å…³
æ–‡ç« è·¯å¾„: 08-ğŸ› ï¸ å¼€å‘å·¥å…·å’ŒOSç›¸å…³/03-ğŸ‹ å®¹å™¨åŒ–/01-ğŸ“š DockeråŸºç¡€/6_æ•°æ®ç®¡ç†/1_æ•°æ®å·.md
æ–‡ç« éš¾åº¦: å…¥é—¨ ğŸŒ±
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­â­ ç²¾é€šå¿…å¤‡
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2025-05-28 01:03:09
---

## 1 ä»€ä¹ˆæ˜¯æ•°æ®å·ï¼Ÿ

**ç®€å•æ¥è¯´ï¼Œæ•°æ®å·æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®ä»¥åŠå…±äº«å®¹å™¨é—´çš„æ•°æ®ï¼Œå®ƒä»¥æ­£å¸¸çš„æ–‡ä»¶æˆ–ç›®å½•çš„å½¢å¼å­˜åœ¨äºå®¿ä¸»æœºä¸Šã€‚**Â å¦å¤–ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³å½“ä½ åˆ é™¤å®¹å™¨æ—¶ï¼Œæ•°æ®å·å¹¶ä¸ä¼šè¢«åˆ é™¤ã€‚

## 2 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®å·ï¼Ÿ

Docker é•œåƒç”±å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ˆåªè¯»å±‚ï¼‰å åŠ è€Œæˆã€‚Docker ä¼šåŠ è½½åªè¯»é•œåƒå±‚ï¼Œå¹¶åœ¨é•œåƒæ ˆé¡¶éƒ¨æ·»åŠ ä¸€ä¸ªè¯»å†™å±‚ã€‚å½“è¿è¡Œå®¹å™¨åï¼Œå¦‚æœä¿®æ”¹äº†æŸä¸ªå·²å­˜åœ¨çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å°†ä¼šä»ä¸‹é¢çš„åªè¯»å±‚å¤åˆ¶åˆ°ä¸Šé¢çš„è¯»å†™å±‚ï¼ŒåŒæ—¶ï¼Œè¯¥æ–‡ä»¶åœ¨åªè¯»å±‚ä¸­ä»ç„¶å­˜åœ¨ã€‚**å½“æˆ‘ä»¬åˆ é™¤ Docker å®¹å™¨ï¼Œå¹¶é€šè¿‡é•œåƒé‡æ–°å¯åŠ¨å®¹å™¨æ—¶ï¼Œä¹‹å‰çš„æ›´æ”¹çš„æ–‡ä»¶å°†ä¼šä¸¢å¤±ã€‚**

é‚£ä¹ˆï¼Œè¦å¦‚ä½•è§£å†³æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜å‘¢ï¼Ÿäºæ˜¯ï¼ŒDocker æå‡ºäº† Volume æ•°æ®å·çš„æ¦‚å¿µã€‚

## 3 æ•°æ®å·ç‰¹æ€§

- ==æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨==ï¼›
- ==å¯¹æ•°æ®å·çš„ä¿®æ”¹ä¼šç«‹åˆ»ç”Ÿæ•ˆ==ï¼›
- ==æ›´æ–°æ•°æ®å·ä¸ä¼šå½±å“é•œåƒ==ï¼›
- ==æ•°æ®å·é»˜è®¤ä¸€ç›´å­˜åœ¨ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤==ï¼›

## 4 æŒ‚è½½æ•°æ®å·

Docker æä¾›äº† 3 ç§ä¸åŒçš„æ–¹å¼å°†æ•°æ®ä»å®¿ä¸»æœºæŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚
![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/064fb7cdd6c5ce83adcc36b03a338ed1.png)

### 4.1 volume (æœ€å¸¸ç”¨çš„æ–¹å¼)

volume : Docker ç®¡ç†å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œé»˜è®¤ä½äºÂ `/var/lib/docker/volumes`Â ç›®å½•ä¸‹, ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚
![image.png|300](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/2889cb75c06c89f0eb0d47658bcfe3f9.png)

çœ‹ä¸Šå›¾ï¼Œæ‰€æœ‰çš„ Docker å®¹å™¨æ•°æ®éƒ½ä¿å­˜åœ¨Â `/var/lib/docker/volumes`Â ç›®å½•ä¸‹ã€‚è‹¥å®¹å™¨è¿è¡Œæ—¶æœªæŒ‡å®šæ•°æ®å·ï¼Œ Docker åˆ›å»ºå®¹å™¨æ—¶ä¼šä½¿ç”¨é»˜è®¤çš„åŒ¿åå·ï¼ˆåç§°ä¸ºä¸€å †å¾ˆé•¿çš„ IDï¼‰ã€‚

> æ³¨æ„ï¼šMac ç³»ç»Ÿä¸­ï¼Œ Docker æ˜¯åŸºäºè™šæ‹Ÿæœºçš„ ï¼Œå¿…é¡»ç™»å½•åˆ°è™šæ‹Ÿæœºé‡Œé¢ï¼Œç™»å½•ååœ¨ç›®å½•Â `/var/lib/docker/volumes/`Â ä¸‹å³å¯æ‰¾åˆ°æ•°æ®å·ã€‚

### 4.2 bind mountï¼ˆæ¯”è¾ƒå¸¸ç”¨çš„æ–¹å¼ï¼‰

bind mount: æ„ä¸ºå¯ä»¥==å­˜å‚¨åœ¨å®¿ä¸»æœºä¸­çš„ä»»æ„ä½ç½®==ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œbind mount åœ¨ä¸åŒçš„å®¿ä¸»æœºç³»ç»Ÿæ—¶ä¸å¯ç§»æ¤çš„ï¼Œæ¯”å¦‚ Windows å’Œ Linux çš„ç›®å½•ç»“æ„æ˜¯ä¸ä¸€æ ·çš„ï¼Œbind mount æ‰€æŒ‡å‘çš„ host ç›®å½•ä¹Ÿä¸ä¸€æ ·ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ bind mount ä¸èƒ½å‡ºç°åœ¨ Dockerfile ä¸­çš„åŸå› æ‰€åœ¨ï¼Œå› ä¸ºè¿™æ · Dockerfile å°±ä¸å¯ç§»æ¤äº†ã€‚
### 4.3 tmpfs mount (ä¸€èˆ¬ä¸ç”¨è¿™ç§æ–¹å¼)

tmpfs mount : æŒ‚è½½å­˜å‚¨åœ¨å®¿ä¸»æœºçš„å†…å­˜ä¸­ï¼Œè€Œä¸ä¼šå†™å…¥å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¸€èˆ¬ä¸ç”¨æ­¤ç§æ–¹å¼ã€‚

## 5 Volume ä½¿ç”¨

### 5.1 åˆ›å»ºä¸€ä¸ªæ•°æ®å·

æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆ›å»ºæ•°æ®å·ï¼š

```
docker volume create test-vol
```

![image.png|600](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/b3399102f70dec5e1cee239f9646f016.png)

### 5.2 æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®å·

```
docker volume ls
```

![image.png|600](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/36068779b50bea72cb598a8e5b508550.png)

### 5.3 æŸ¥çœ‹æ•°æ®å·ä¿¡æ¯

æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹æŒ‡å®šçš„æ•°æ®å·ä¿¡æ¯ï¼š

```
# æŸ¥çœ‹æ•°æ®å·åä¸º test-vol çš„ä¿¡æ¯
docker volume inspect test-vol
```

![image.png|600](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/36e98c9bacb2fde1efc46a301a0f0e10.png)

### 5.4 è¿è¡Œå®¹å™¨æ—¶æŒ‚è½½æ•°æ®å·

æ•°æ®å·Â `test-vol`åˆ›å»ºæˆåŠŸåï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸ª Nginx å®¹å™¨ï¼Œå¹¶å°è¯•æŒ‚è½½è¯¥æ•°æ®å·ï¼ŒæŒ‚è½½å‘½ä»¤æ”¯æŒä¸¤ç§ï¼š

1. `-v`

```
docker run -d -it --name=test-nginx -p 8011:80 -v test-vol:/usr/share/nginx/html nginx:1.13.12
```

![image.png|600](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/bd69a79708fb15cc4aedb2efc8789ee9.png)

å‚æ•°è¯´æ˜ï¼š
- `-d`Â : åå°è¿è¡Œå®¹å™¨ï¼›
- `--name=test-nginx`Â : æŒ‡å®šå®¹å™¨åä¸º test-nginx;
- `-p 8011:80`Â : å°†å®¹å™¨çš„ 80 ç«¯å£æŒ‚è½½åˆ°å®¿ä¸»æœºçš„ 8011 ç«¯å£ï¼›
- `-v test-vol:/usr/share/nginx/html`Â : å°†Â `test-vol`Â æ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„ /usr/share/nginx/html ç›®å½•ä¸Šï¼›

2. `--mount`

```
docker run -d -it --name=test-nginx -p 8011:80 --mount source=test-vol,target=/usr/share/nginx/html nginx:1.13.12
```

å‚æ•°è¯´æ˜ï¼š
- `--mount source=test-vol,target=/usr/share/nginx/html`Â : å°†Â `test-vol`Â æ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„ /usr/share/nginx/html ç›®å½•ä¸Šï¼›

#### 5.4.1 `-v`Â å’ŒÂ `--mount`Â æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

éƒ½æ˜¯æŒ‚è½½å‘½ä»¤ï¼Œä½¿ç”¨Â `-v`Â æŒ‚è½½æ—¶ï¼Œå¦‚æœ==å®¿ä¸»æœºä¸Šæ²¡æœ‰æŒ‡å®šæ–‡ä»¶ä¸ä¼šæŠ¥é”™ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæŒ‡å®šæ–‡ä»¶==ï¼›å½“ä½¿ç”¨Â `--mount`æ—¶ï¼Œå¦‚æœå®¿ä¸»æœºä¸­æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ä¼šæŠ¥é”™æ‰¾ä¸åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œä¸ä¼šè‡ªåŠ¨åˆ›å»ºæŒ‡å®šæ–‡ä»¶ã€‚

---

å®¹å™¨è¿è¡ŒæˆåŠŸåï¼Œè¿›å…¥åˆ°Â `/var/lib/docker/volumes`Â ç›®å½•ä¸‹ï¼ŒéªŒè¯æ•°æ®æ˜¯å¦æŒ‚è½½æˆåŠŸï¼š
![image.png|600](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/72df512c4d4b83a091560d002ced81af.png)

å¯ä»¥çœ‹åˆ°å·²ç»æœ‰äº†Â `50x.html`Â ã€Â `index.html`Â ä¸¤ä¸ª Nginx é¡µé¢ç›¸å…³æ•°æ®ï¼Œè¯´æ˜æ•°æ®å·æŒ‚è½½æˆåŠŸäº†ã€‚æŒ‚è½½æˆåŠŸåï¼Œæˆ‘ä»¬ä¸è®ºæ˜¯ä¿®æ”¹Â `/var/lib/docker/volumes`Â ä¸‹çš„æ•°æ®ï¼Œè¿˜æ˜¯è¿›å…¥åˆ°å®¹å™¨ä¸­ä¿®æ”¹Â `/usr/share/nginx/html`Â ä¸‹çš„æ•°æ®ï¼Œéƒ½ä¼šåŒæ­¥ä¿®æ”¹å¯¹åº”çš„æŒ‚è½½ç›®å½•ï¼Œç±»ä¼¼å‰ç«¯å¼€å‘ä¸­åŒå‘ç»‘å®šçš„ä½œç”¨ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬åœæ­¢å¹¶åˆ é™¤åˆšåˆšè¿è¡Œçš„ Nginx å®¹å™¨, çœ‹çœ‹æ•°æ®å·ä¸­çš„æ•°æ®æ˜¯å¦ä¼šè·Ÿç€è¢«åˆ é™¤ï¼š
![image.png|600](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/05/f1bd9163e5652697d3a0acdd5c1f8b97.png)

å¯ä»¥å‘ç°æ•°æ®å·ç›¸å…³æ•°æ®éƒ½è¿˜åœ¨ï¼Œè¡¨æ˜æ•°æ®å·çš„ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºå®¹å™¨ã€‚å¦å¤–ï¼Œè‹¥ä¸‹æ¬¡å†åˆ›å»º Nginx å®¹å™¨ï¼Œè¿˜å¯ä»¥å¤ç”¨è¿™ä¸ªæ•°æ®å·ï¼Œå¤ç”¨æ€§ä»¥åŠæ‰©å¼ æ€§éƒ½éå¸¸ä¸é”™ã€‚

### 5.5 åˆ é™¤æ•°æ®å·

ç”±äºæ•°æ®å·çš„ç”Ÿå‘½æœŸç‹¬ç«‹äºå®¹å™¨ï¼Œæƒ³è¦åˆ é™¤æ•°æ®å·ï¼Œå°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥æ“ä½œ, æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š

```
docker volume rm test-vol
```

> 1. å¦‚æœä½ éœ€è¦åœ¨åˆ é™¤å®¹å™¨çš„åŒæ—¶ç§»é™¤æ•°æ®å·ï¼Œè¯·ä½¿ç”¨Â `docker rm -v`Â å‘½ä»¤ã€‚
>     
> 2. å¯¹äºé‚£äº›æ²¡æœ‰è¢«ä½¿ç”¨çš„æ•°æ®å·ï¼Œå¯èƒ½ä¼šå ç”¨è¾ƒå¤šçš„ç£ç›˜ç©ºé—´ï¼Œä½ å¯ä»¥é€šè¿‡å‘½ä»¤ `docker volume prune`ç»Ÿä¸€åˆ é™¤

## 6 bind mount ä½¿ç”¨

é€šè¿‡ bind mount æ¨¡å¼å¯ä»¥æŒ‚è½½åˆ°å®¿ä¸»æœºçš„ä»»æ„ä½ç½®ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```
docker run -d -it --name=test-nginx -p 8011:80 -v /docker/nginx1:/usr/share/nginx/html nginx:1.13.12
```

å‚æ•°è¯´æ˜ï¼š

- `-v /docker/nginx1:/usr/share/nginx/html`Â : å°†å®¿ä¸»æœºä¸­çš„Â `/docker/nginx1`Â ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„Â `/usr/share/nginx/html`Â ç›®å½•ï¼›

å®¹å™¨è¿è¡ŒæˆåŠŸåï¼Œè¿›å…¥å®¹å™¨ä¸­ï¼š

```
docker exec -it test-nginx /bin/bash
```

![docker è¿›å…¥å®¹å™¨](https://img.quanxiaoha.com/quanxiaoha/165796623336460 "docker è¿›å…¥å®¹å™¨")

ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œä¸ volume ä¸åŒï¼Œbind mount è¿™ç§æ–¹å¼ä¼šéšè—ç›®å½•ä¸­çš„å†…å®¹ï¼ˆéç©ºæƒ…å†µä¸‹ï¼‰ï¼Œè¿™é‡Œçš„Â `/usr/share/nginx/html`Â ç›®å½•ä¸‹çš„ html æ–‡ä»¶è¢«éšè—äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸åˆ°ã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®¿ä¸»æœºä¸­è¯¥ç›®å½•ä¸­çš„æ–‡ä»¶ç«‹åˆ»æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œä¸‹é¢éªŒè¯ä¸€ä¸‹ï¼š

1. æ–°å»ºä¸€ä¸ªÂ `index.html`:
![åˆ›å»º index.html æ–‡ä»¶](https://img.quanxiaoha.com/quanxiaoha/165796671029332 "åˆ›å»º index.html æ–‡ä»¶")

2. å†æ¬¡è¿›å…¥å®¹å™¨ï¼ŒæŸ¥çœ‹æŒ‚è½½ç›®å½•å†…å®¹ï¼š

![è¿›å…¥ docker å®¹å™¨](https://img.quanxiaoha.com/quanxiaoha/165796684481635 "è¿›å…¥ docker å®¹å™¨")