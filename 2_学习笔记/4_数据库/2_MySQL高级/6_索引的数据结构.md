## 1 为什么使用索引

**索引是存储引擎用于快速找到数据记录的一种数据结构**，就好比一本教课书的目录部分，通过目录中找到对应文章的页码，便可快速定位到需要的文章。MySQL中也是一样的道理，进行数据查找时，首先查看查询条件是否命中某条索引，**符合则通过索引查找相关数据**，如果**不符合则需要全表扫描**，即需要一条一条地查找记录，直到找到与条件符合的记录。

![image.png|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/e74bb53463af2eed8ad188b974100129.png)

- 如上图所示
	- 数据库没有索引的情况下，数据 **分布在硬盘的不同的位置上面**，读取数据时，摆臂需要前后摆动查找数据，这样的操作非常耗时！
	- 如果 **数据按顺序摆放（连续的地址空间）**，也需要按照顺序读取数据，这样操作依旧非常耗时！如果表很大时，有上千万条数据，就意味着要 **做很多次磁盘IO** 才能找到
	- 执行过程：CPU先去磁盘查找记录，找到后加载到内存，然后对数据进行处理
	- 耗时情况：磁盘IO最耗时（涉及到磁盘的旋转时间、磁头的寻道时间）

假如给数据使用 **二叉树** 这样的数据结构进行存储，如下图所示
![image.png|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/70266c0f157e71a5383554aad1130199.png)
- 如上图所示
	- 对字段`Col2`添加索引，相当于在硬盘中维护了一个索引的数据结构（**二叉查找树**）
	- 二叉查找树的每个节点存储的是`Key-Value结构`
	- 如果知道算法，简单的说，使用这种结构，我们在查找数据的时候，时间复杂度是O(logn)的
	- 这样我们减少了磁盘IO的次数，加快查询的速度（时间少了）；
## 2 什么是索引及其优缺点

### 2.1 索引概述

MySQL官方对索引的定义为：**索引（Index）是帮助MySQL高效获取数据的一种数据结构**

**索引的本质**：索引是数据结构。
- 你可以简单理解为“排好序的快速查找数据结构”，满足特定查找算法。 这些数据结构以某种方式指向数据， 这样就可以**在这些数据结构的基础上实现 高级查找算法**

**索引是在存储引擎中实现的（即索引是个存储引擎（表的结构）相关的）**，因此每种存储引擎的索引不一定完全相同，并且每种存储引擎不一定支持所有索引类型。

同时，**存储引擎可以定义每个表的最大索引数和最大索引长度**。所有存储引擎支持每个表至少16个索引，总索引长度至少为256字节。有些存储引擎支持更多的索引数和更大的索引长度。
### 2.2 优点

（1）类似大学图书馆建书目索引，提高数据检索的效率，**降低 数据库的IO成本 ，这也是创建索引最主 要的原因**。
（2）通过**创建唯一索引**，可以保证数据库表中每一行 **数据的唯一性** 。
（3）在实现数据的 **参考完整性方面**，可以 加速表和表之间的连接 。换句话说，对于有依赖关系的子表和父表联合查询时， 可以提高查询速度。
（4）在使用分组和排序子句进行数据查询时，可以**显著减少查询中分组和排序的时 间 ，降低了CPU的消耗**
### 2.3 缺点

增加索引也有许多不利的方面，主要表现在如下几个方面： 
（1）**创建索引和维护索引要 耗费时间** ，并 且随着数据量的增加，所耗费的时间也会增加。 
（2）索引**需要占磁盘空间** ，除了数据表占数据空间之 外，每一个索引还要占一定的物理空间， 存储在磁盘上 ，如果有大量的索引，索引文件就可能比数据文 件更快达到最大文件尺寸。 
（3）虽然索引大大提高了查询速度，同时却会 **降低更新表的速度** 。当对表 中的数据进行增加、删除和修改的时候，索引也要动态地维护，这样就降低了数据的维护速度。 

因此，选择使用索引时，需要综合考虑索引的优点和缺点。
## 3 InnoDB中索引的推演

### 3.1 索引之前的查找

先来看一个精确匹配的例子：
```mysql
SELECT [列名列表] FROM 表名 WHERE 列名 = xxx ；
```
<h4>1. 一个页中的查找</h4>

<h4>2. 很多页中查找</h4>
### 3.2 设计索引

<h4>1. 简单的索引设计方案</h4>

<h4>2. InnoDB的索引方案</h4>

<h5>①迭代1次</h5>

<h5>②迭代2次</h5>

<h5>③迭代3次</h5>

<h5>④B+Tree</h5>
### 3.3 常见索引概念

<h4>1. 聚簇索引</h4>

<h4>2. 二级索引（辅助索引、非聚簇索引）</h4>

<h4>3. 联合索引</h4>

### 3.4 InnoDB和B+树索引的注意事项

<h4>1. 根页面位置万年不懂</h4>

<h4>2. 内节点中目录项记录的唯一性</h4>

<h4>3. 一个页面最少存储2条记录</h4>
## 4 MyISAM中的索引方案

### 4.1 MyISAM索引的原理

### 4.2 MyISAM 与 InnoDB 对比
## 5 索引的代价

## 6 MySQL数据结构选择的合理性

### 6.1 全表遍历

### 6.2 Hash结构

### 6.3 二叉搜索树

### 6.4 AVL树

### 6.5 B-Tree

### 6.6 B+Tree

### 6.7 R树

## 7 附录：算法的时间复杂度