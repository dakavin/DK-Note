
## 一、排序查询

### 1.1 语法

```mysql
select 查询的字段

from 表名

【where  筛选条件】

order by 排序的字段或表达式  asc（desc）;
```

### 1.2 按单个字段排序

案例：查询所有员工信息，并按员工工资降序

```mysql
SELECT * FROM employees ORDER BY salary DESC;
```

### 1.3 添加筛选条件再排序

案例：查询部门编号>=90的员工信息，并按员工编号降序

```mysql
SELECT *

FROM employees

WHERE department_id>=90

ORDER BY employee_id DESC;
```

### 1.4 按表达式排序

案例：查询员工信息 按年薪降序

```mysql
SELECT *,salary*12*(1+IF NULL(commission_pct,0))

FROM employees

ORDER BY salary*12*(1+IFNULL(commission_pct,0)) DESC;
```

### 1.5 按别名排序

案例：查询员工信息 按年薪升序

```mysql
SELECT *,salary*12*(1+IFNULL(commission_pct,0)) 年薪

FROM employees

ORDER BY 年薪 ASC;
```

### 1.6 按函数排序

案例：查询员工名，并且按名字的长度降序

```mysql
SELECT LENGTH(last_name),last_name

FROM employees

ORDER BY LENGTH(last_name) DESC;
```

### 1.7 按多个字段排序

案例：查询员工信息，要求先按工资降序，再按employee_id升序

```mysql
SELECT *

FROM employees

ORDER BY salary DESC,employee_id ASC;
```

特点：

1、asc代表的是升序，可以省略

desc代表的是降序,不可以省略

2、order by子句可以支持 单个字段、别名、表达式、函数、多个字段

3、order by子句在查询语句的最后面，除了limit子句


## 二、常见函数

### 2.1 概念及特点

- 概念：类似于java的方法，将一组逻辑语句封装在方法体中，对外暴露方法名

- 好处：1、隐藏了实现细节  2、提高代码的重用性

- 特点：
	- 叫什么（函数名）
	- 干什么（函数功能）

### 2.2 分类：

- 单行函数
	- 如 concat、length、if null等

- 分组函数
	- 功能：做统计使用，又称为统计函数、聚合函数、组函数

### 2.3 常见的单行函数：


#### 2.3.1 字符函数：

- `length:获取字节个数(utf-8一个汉字代表3个字节,gbk为2个字节)`
```mysql
SELECT LENGTH('john');

SELECT LENGTH('张三丰hahaha');

SHOW VARIABLES LIKE '%char%'
```

- `concat:拼接字符串`
```mysql

```

- `upper、lower:将字符串变大写或小写`
```mysql
#示例：将姓变大写，名变小写，然后拼接

SELECT CONCAT(UPPER(last_name),LOWER(first_name))  姓名 FROM employees;
```

- `substr`
- `注意：索引从1开始,截取从指定索引处后面所有字符`
```mysql
#截取从指定索引处后面所有字符

SELECT SUBSTR('李莫愁爱上了陆展元',7)  out_put;

#截取从指定索引处指定字符长度的字符

SELECT SUBSTR('李莫愁爱上了陆展元',1,3) out_put;

#案例：名字中首字符大写，其他字符小写然后用_拼接，显示出来

SELECT CONCAT(UPPER(SUBSTR(last_name,1,1)),'_',LOWER(SUBSTR(last_name,2)))  out_put

FROM employees;
```

- `instr:返回子串第一次出现的索引，如果找不到返回0`
```mysql
SELECT INSTR('杨不殷六侠悔爱上了殷六侠','殷八侠') AS out_put;
```

- `trim:去除字符串前后空格`
```mysql
SELECT LENGTH(TRIM('    张翠山    ')) AS out_put;

SELECT TRIM('aa' FROM 'aaaaaaaaa张aaaaaaaaaaaa翠山aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa')  AS out_put;
```

- `lpad:用指定的字符实现左填充指定长度`
```mysql
SELECT LPAD('殷素素',2,'*') AS out_put;
```

- `rpad:用指定的字符实现右填充指定长度`
```mysql
SELECT RPAD('殷素素',12,'ab') AS out_put;
```

- `replace:替换`
```mysql
SELECT REPLACE('周芷若周芷若周芷若周芷若张无忌爱上了周芷若','周芷若','赵敏') AS out_put;
```

#### 2.3.2 数学函数：

- round:四舍五入
```mysql
SELECT ROUND(-1.55);

SELECT ROUND(1.567,2);
```

- ceil:向上取整,返回>=该参数的最小整数
```mysql
SELECT CEIL(-9.99);
```

- floor:向下取整,返回<=该参数的最小整数
```mysql
SELECT FLOOR(-9.99);
```

- truncate:截断
```mysql
SELECT TRUNCATE(1.69999,1);
```

- mod:取余
```mysql
SELECT MOD(10,-3);

SELECT 10%3;
```

#### 2.3.3 日期函数：

- now:返回当前系统日期+时间
```mysql
SELECT NOW();
```

- curdate:返回当前系统日期，不包含时间
```mysql
SELECT CURDATE();
```

- curtime:返回当前时间，不包含日期
```mysql
SELECT CURTIME();
```

- year、month、monthname、day、hour、minute、second：可以获取指定的部分，年、月、日、小时、分钟、秒
```mysql
SELECT YEAR(NOW()) 年;

SELECT YEAR('1998-1-1') 年;

SELECT  YEAR(hiredate) 年 FROM employees;

SELECT MONTH(NOW()) 月;

SELECT MONTHNAME(NOW()) 月;
```


- str_to_date：将字符通过指定的格式转换成日期
```mysql
SELECT STR_TO_DATE('1998-3-2','%Y-%c-%d') AS out_put;

#查询入职日期为1992-4-3的员工信息

SELECT * FROM employees WHERE hiredate = '1992-4-3';

SELECT * FROM employees WHERE hiredate = STR_TO_DATE('4-3 1992','%c-%d %Y');
```

- date_format：将日期转换成字符
```mysql
SELECT DATE_FORMAT(NOW(),'%y年%m月%d日') AS out_put;

#查询有奖金的员工名和入职日期(xx月/xx日 xx年)

SELECT last_name,DATE_FORMAT(hiredate,'%m月/%d日 %y年') 入职日期

FROM employees

WHERE commission_pct IS NOT NULL;
```

#### 2.3.4 其他函数：

- version
```mysql
SELECT VERSION();
```

- database
```mysql
SELECT DATABASE();
```

- user
```mysql
SELECT USER();
```

#### 2.3.5 控制函数

- if： if else 的效果
```mysql
SELECT IF(10<5,'大','小');

SELECT last_name,commission_pct,IF(commission_pct IS NULL,'没奖金，呵呵','有奖金，嘻嘻') 备注

FROM employees;
```

- case
- switch case 的效果
```mysql
case 要判断的字段或表达式

when 常量1 then 要显示的值1或语句1;

when 常量2 then 要显示的值2或语句2;

...

else 要显示的值n或语句n;

end

/*案例：查询员工的工资，要求

部门号=30，显示的工资为1.1倍

部门号=40，显示的工资为1.2倍

部门号=50，显示的工资为1.3倍

其他部门，显示的工资为原工资

*/

SELECT salary 原始工资,department_id,

CASE department_id

WHEN 30 THEN salary*1.1

WHEN 40 THEN salary*1.2

WHEN 50 THEN salary*1.3

ELSE salary

END AS 新工资

FROM employees;
```

- 类似于 多重if
```mysql
case

when 条件1 then 要显示的值1或语句1

when 条件2 then 要显示的值2或语句2

。。。

else 要显示的值n或语句n

end

*/

案例：查询员工的工资的情况

如果工资>20000,显示A级别

如果工资>15000,显示B级别

如果工资>10000，显示C级别

否则，显示D级别

SELECT salary,

CASE

WHEN salary>20000 THEN 'A'

WHEN salary>15000 THEN 'B'

WHEN salary>10000 THEN 'C'

ELSE 'D'

END AS 工资级别

FROM employees;
```
