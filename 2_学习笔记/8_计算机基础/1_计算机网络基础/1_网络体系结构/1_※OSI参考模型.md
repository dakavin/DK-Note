
## 1、常见的计算机网络体系结构

OSI（Open Systems Interconnection，开放式通信系统互联参考模型）

OSI体系结构：开发系统互连参考模型，是一个七层协议的体系结构，从下往上依次是物理层、数据链路层、网络层、运输层、会话层、表示层、应用层；以一个`法律`上的国际标准

TCP/IP体系结构：是一个四层协议的体系结构，从下往上一次是网络接口层、网际层、运输层、应用层；是`事实`上的国际标准

OSI标准失败的原因：
1. OSI的专家们缺乏实际经验，没有商业驱动力
2. OSI的协议实现起来过分复杂，而且运行效率很低
3. OSI标准的制定周期太长
4. OSI的层次划分不顾合理

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/913ce4cc61a4ca171ddd28bbdbf1613e.png)

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/5b04c5bced7a169e0b739bb61201b6e6.png)

在TCP/IP协议体系中包含有大量的协议，IP协议和TCP协议是两个最重要的协议，所以使用TCP/IP协议代表整个协议大家族。

在嵌入式系统开发领域，TCP/IP协议族常称为TCP/IP协议栈，这是因为TCP/IP协议体系的分层结构，与数据结构中的栈，在图形画法上是类似的。

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/3561077ec1458a1c7ed1d8b759db8b80.png)

原理体系结构，更加适合教学使用
## 2、分层的必要性

`计算机网络是个非常复杂的系统。`早在最初的ARPANET设计时就提出了分层的设计理念。

`分层`可将庞大而复杂的问题，转化为若干较小的局部问题，而这些较小的局部问题就比较易于研究和处理

下面，我们按照由简单到复杂的顺序，来看看实现计算机网络要面临哪些主要的问题，以及如何将这些问题划分到相应的层次，层层处理。

### 2.1 物理层

- `最简单的情况`：两台计算机通过一条网线连接![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/90fcce2e404305b475090ed277734aba.png)
	- 采用怎么样的传输媒体（介质）--- 无线
	- 采用怎么样的无接口 --- RJ45以太网接口
	- 使用怎么样的信号来表示比特0和1 --- 方波信号的低高电平
- 可以将`这些问题归到物理层`，注意传输媒体不属于物理层，且方波信号不是计算机网络传输的信号

### 2.2 数据链路层

- `实际的计算机网络`，由多台主机构成，假设我们已经物理层之间的问题了![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/cf76693a915071fbcda2960f44dda2eb.png)
	- 主机A给主机C发送数据，但是表示数据的信号，会通过主线传播到每一个主机，主机C如何知道数据是发送给自己的，并接收；其他主机如何知道数据不是发送给自己的，并拒绝接收
		- 如何标识网络中的各个主机（主机编址问题，例如MAC地址）
		- 如何从信号所表示的一连串比特流中区分出地址和数据
		- 如何协调各主机争用总线

- 这种总线型的网络早已淘汰，目前常用的是使用以太网交换机，将多台主机互连形成的交换式以太网
- 那么以太网交换机又是如何实现的呢？
- `我们将这些问题归到数据链路层`

### 2.3 网络层

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/226f1a0fddc5c49749d355e6be5f5ae8.png)

在本例中又多个网络，很显然，我们面临着`如何标识个网络以及网络中各主机的问题`。

- 如何标识各网络以及网络中的各主机（网络和主机共同编址的问题，例如IP地址）![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ac4b010957d11b930342ca5b4d844ee0.png)
- 路由器如何转发分组，如何进行路由选择

`我们将这些问题归到网络层`
### 2.4 运输层

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/e142a3703dced02e5b8b8fb91c0fc306.png)

- 如何解决进程之间基于网络的通信问题
- 若出现传输错误（误码、丢包），如何处理
### 2.5 应用层

完成上述各层问题的基础上，我们需要制定各种应用层协议，并按协议标准编写相应的应用程序，通过应用进程间的交互来完成特点的网络应用。

- 通过应用进程间的交互来完成特点的网络应用![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/202e4a7bc9aff827d00e2886ef2d4de9.png)
### 2.6 总结

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ae0b7ce9b2936c71c4bc5e395197a391.png)

## 3、分层思想举例

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/4845409f78e7e5fec938950eecaafb25.png)

我们使用N1服务器的主机上的浏览器，访问N2服务器上内容

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0348d3229657fd013af7e4445fd6039b.png)

N1上的主机流程：
1. `应用层`按Http协议的规定，构建一个HTTP请求报文，交付给运输层
2. `运输层`给HTTP报文添加一个TCP首部（区分应用进程，实现可靠传输），使之成为TCP报文段，并交付给网络层处理
3. `网络层`给TCP报文段添加一个IP首部（可以在互联网上传输，即被路由器转发），使之成为IP数据报，并交付给数据链路层处理
4. `数据链路层`给IP数据报首部和尾部添加一个ETH，使之成为一个帧。首部的作用是可以让帧在一段链路或一个网络上传输，被相应的目的主机接收。尾部的作用是让目的主机检查所接收到的帧是否有误码。最后交付给物理层处理
5. `物理层`把帧转为比特流，在以太网内，还会给比特流前面添加前导码（让目的主机做好接收帧的准备），将该比特流变化为相应的信号发送到传输媒体，信号通过传输媒体到达路由器

路由器上的流程：
1. `物理层`将信号转换为比特率，并去掉前导码，将其交付给数据链路层；
2. `数据链路层`将帧的首部和尾部去掉后，交付给网络层
3. `网络层`解析IP数据报的首部，从中提取出目的网络地址，然后查找自身的路由表，确定转发端口，以便进行转发；
4. 之后，在通过网络层，数据链路层和物理层，重新将数据转化为信号，并通过传输媒体，传输到目的主机/服务器上

目的主机/服务器处理流程：
1. 从物理层、数据链路层、网络层、运输层、应用层依次读取报文；
2. 应用层对HTTP请求报文进行解析，然后给主机发回HTTP响应报文；
3. 响应报文经过五层结构，层层封装后发回给请求主机

## 4、专用术语

下述专用术语，来源于OSI的七层体系结构，也适用于TCP/IP的四层体系结构和五层协议原理体系结构

### 4.1 实体

实体：任何可发送或接收信息的`硬件`或`软件进程`
对等实体：收发双方`相同层次中的实体`

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/37ebe69c783171fa0cb3d36c9a2d0dcb.png)

### 4.2 协议

协议：控制两个实体进行逻辑通信规则的集合
协议的三个要素：
- 语法：定义所交换信息的格式
- 语义：定义收发双方索要完成的操作
- 同步：定义收发双方的时序关系

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/a4994edcbd11acbe2028ccb0384e3493.png)

### 4.3 服务

在协议的控制下，两个对等实体间的逻辑通信使得本层能够向上一层提供服务

要实现本层协议，还需要使用下面一层所提供的服务

协议是`水平的`，服务是`垂直的`

实体看得见相邻下层所提供的服务，但并不知道实现该服务的具体协议。也就是说，下面的协议对上面的实体是`透明`的，例如：手机为我们提供各种服务，但是我们不需要知道这些服务是如何实现的

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/41c608daebec517bd0b47cbc65a3b186.png)

`服务访问点`：在同一系统中`相邻两层的实体交换信息的逻辑接口`，用于区分不同的服务类型
- 数据链路层的服务访问点为帧的“类型”字段
- 网络层的服务访问点为IP数据报首部中的“协议字段”
- 运输层的服务访问点为”端口号“

`服务原语`：上传使用下层所提供的服务必须通过与下层交换一些命令，这些命令称为服务原语
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/ba479ab6ce6d81bcbaa7422331fce4e0.png)

`协议数据单元PDU`：==对等层次之间传送的数据==报称为该层的协议数据单元
`服务数据单元SDU`：同一系统内，层与层之间交换的数据包成为服务数据单元
多个SDU可以合成为一个PDU；一个SDU也可以划分为几个PDU

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/f438d0c898ecef9aa74ee1c066de0d78.png)

## 5、补充说明

### 5.1 通过对话理解分层

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/7ed91bd95d7e6bd48623798d53716aa1.png)

表面上看A跟C是在用汉语直接对话，实际上A与C都是在通过电话机的听筒听取声音，都在对着麦克风说话。

其实在这个图中，他们所用的语言协议作为麦克风的音频输入，在通信设备层被转换为电波信号传送出去了。传送到对方的电话机后，又被通信设备层转换为音频输出，传递给了对方。因此A与C其实是利用电话机之间通过音频转化声音的`接口`实现了对话。

### 5.2 OSI参考模型

前面只是将协议简单地分为了两层进行了举例说明。然而，实际的分组通信协议会相当复杂。OSI参考模型将这样一个复杂的协议整理并分为了易于理解的7个分层。

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c0422ceadeedbcff48f571b9d5fdac3b.png)

人们也时常能听到`OSI协议`这个词。
`OSI协议`是为了让异构的计算机之间能够相互通信、又ISO和ITU-T推荐其标准化的一种网络体系结构。

OSI参考模型将通信功能划分为7个分层，称作OSI参考模型。

OSI协议以OSI参考模型为基础界定了`每个阶层的协议`和`每个阶层之间的接口相关的标准`。遵循OSI协议的产品叫OSI产品，而他们所遵循的通信规则被称为OSI通信，由于OSI参考模型和OSI协议指代的意义不同，请勿混淆。

### 5.3 OSI参考模型各个分层的作用

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/c198716728f8a453ed5170b35a27cc0b.png)

- 应用层
	- 为应用程序提供服务并规定应用程序中通信相关的细节。包括文件传输、电子邮件、远程登录（虚拟终端）等协议。
	- 这是唯一直接接触用户数据的层。软件应用程序（如 Web 浏览器和电子邮件客户端）依靠应用程序层发起通信。但需要明确的是，客户端软件应用程序不属于应用程序层；相反，应用程序层负责协议和数据操作，软件依靠上述操作向用户呈现有效数据。
	- 应用程序层协议包括 [HTTP](https://www.cloudflare-cn.com/learning/ddos/glossary/hypertext-transfer-protocol-http/) 和 [SMTP](https://www.cloudflare-cn.com/learning/email-security/what-is-smtp/)（简单邮件传输协议是支持开展[电子邮件](https://www.cloudflare-cn.com/learning/email-security/what-is-email/)通信的协议之一）。
- 表示层
	- 将应用处理的信息转换为适合网络传输的格式，或将来自下一层的数据转换位上层能够处理的格式，因此它主要负责数据格式的转换
	- 具体来说，就是将设备固有的数据格式转换为网络标准传输格式。不同设备对同一比特流解释的结果可能会不同。因此，使他们保持一致是这一层的主要作用
	- 两台相互通信的设备可能使用不同的编码方法，因此第 6 层负责将传入数据转换为接收设备应用程序层可以理解的语法。
- 会话层
	- 负责建立和断开通信连接（数据流动的逻辑通路），以及数据的分割等数据传输相关的管理
	- 会话层还负责同步数据传输与检查点。例如，如果传输一个 100MB 的文件，会话层可以每 5MB 设置一个检查点。如果在传输了 52MB 后连接断开或崩溃，可以从最后一个检查点恢复会话，也就是只需再传输 50MB 数据。若未设置检查点，则必须从头开始传输整个文件。
- 传输层
	- 起着可靠传输的作用。只在通信双方节点上进行处理，而无需再路由器上处理
	- 传输层还负责进行流量控制和错误控制。流量控制用于确定最佳传输速度，避免采用快速连接的发件人淹没采用慢速连接的收件人。传输层通过确保接收数据的完整性（如果不完整，则请求重新传输）来对接收端进行错误控制。
- 网络层
	- 将数据传输到目标地址。目标地址可以是多个网络通过路由器连接而成的某一个地址。因此这一层主要负责寻址和路由选择
- 数据链路层
	- 负责物理层面上互连的、节点之间的通信传输。例如与1个以太网相连的2个节点之间的通信
	- 将0、1序列划分为具有意义的数据帧传送给对端（数据帧的生成和接收）
- 物理层
	- 负责0、1比特流（0、1序列）与电压的高低、光的闪灭之间的互换

### 5.4 OSI参考模型通信实例

![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/759a2fb16d274a3e3eb0123df9105260.png)

每个分层上，在处理由上一层传过来的数据时可以`附上当前分层的协议所必须的“首部”信息`。然后接收端对收到的数据`进行数据“首部”与“内容”的分离`，再转发给上一分层，并最终将发送端的数据`恢复为原状`；