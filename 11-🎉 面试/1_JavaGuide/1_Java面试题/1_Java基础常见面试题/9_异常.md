---
æ–‡ç« æ ‡é¢˜: "[[9_å¼‚å¸¸]]" 
æ–‡ç« ä½œè€…: Dakkk
æ–‡ç« æ¦‚è¦: |
  æœ¬æ–‡æ¦‚è§ˆJavaå¼‚å¸¸ä½“ç³»ï¼ŒåŒºåˆ†Errorä¸Exceptionï¼Œè¯¦è§£å—æ£€/éå—æ£€å¼‚å¸¸ã€‚é˜è¿°try-catch-finallyç”¨æ³•ï¼Œåˆ†æfinallyæ‰§è¡Œæ¡ä»¶ä¸returné—®é¢˜ï¼Œå¹¶æ¨ètry-with-resourcesç®€åŒ–èµ„æºå…³é—­ï¼Œæœ€åæå‡ºå¼‚å¸¸ä½¿ç”¨æ³¨æ„äº‹é¡¹ã€‚
æ–‡ç« æ ‡ç­¾:
- "Java"
- "å¼‚å¸¸å¤„ç†"
- "Exception"
- "Error"
- "try-catch-finally"
- "try-with-resources"
- "Checked Exception"
- "Unchecked Exception"
ç›¸å…³æ–‡ç« :
- "[[1_Javaå¼‚å¸¸å¤„ç†é€šå…³æŒ‡å—]]"
- "[[2_Javaç²¾è®²ï¼šå¼‚å¸¸å¤„ç†æ–¹æ³•ï¼]]"
- "[[0_try catch finallyåŸç†]]"
- "[[8_å¼‚å¸¸å¤„ç†]]"
- "[[3_å…³é”®å­—]]"
æ–‡ç« åˆ†ç±»: "ğŸ‰ é¢è¯•"
æ–‡ç« è·¯å¾„: "11-ğŸ‰ é¢è¯•/1_JavaGuide/1_Javaé¢è¯•é¢˜/1_JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜/9_å¼‚å¸¸.md"
æ–‡ç« éš¾åº¦: åˆçº§ ğŸ’§
ç›®å‰é˜¶æ®µ: âœ… å·²å®Œæˆ
é‡è¦æ€§: â­â­â­â­ æ ¸å¿ƒèƒ½åŠ›
åˆ›å»ºæ—¶é—´: 2024-08-11 18:15:12
ä¿®æ”¹æ—¶é—´: 2024-08-11 18:15:12
---

**Java å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„å›¾æ¦‚è§ˆ**ï¼š
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/1976ca41e257e404e1ad1970f2287918.png)

## 1 Exceptionå’ŒErroræœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

åœ¨ Java ä¸­ï¼Œæ‰€æœ‰çš„å¼‚å¸¸éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç¥–å…ˆ `java.lang` åŒ…ä¸­çš„ `Throwable` ç±»ã€‚`Throwable` ç±»æœ‰ä¸¤ä¸ªé‡è¦çš„å­ç±»:

- **`Exception`** :ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡ `catch` æ¥è¿›è¡Œæ•è·ã€‚`Exception` åˆå¯ä»¥åˆ†ä¸º Checked Exception (å—æ£€æŸ¥å¼‚å¸¸ï¼Œå¿…é¡»å¤„ç†) å’Œ Unchecked Exception (ä¸å—æ£€æŸ¥å¼‚å¸¸ï¼Œå¯ä»¥ä¸å¤„ç†)ã€‚
- **`Error`**ï¼š`Error` å±äºç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ ï¼Œ~~æˆ‘ä»¬æ²¡åŠæ³•é€šè¿‡ `catch` æ¥è¿›è¡Œæ•è·~~ä¸å»ºè®®é€šè¿‡`catch`æ•è· ã€‚ä¾‹å¦‚ Java è™šæ‹Ÿæœºè¿è¡Œé”™è¯¯ï¼ˆ`Virtual MachineError`ï¼‰ã€è™šæ‹Ÿæœºå†…å­˜ä¸å¤Ÿé”™è¯¯(`OutOfMemoryError`)ã€ç±»å®šä¹‰é”™è¯¯ï¼ˆ`NoClassDefFoundError`ï¼‰ç­‰ ã€‚è¿™äº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒJava è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸€èˆ¬ä¼šé€‰æ‹©çº¿ç¨‹ç»ˆæ­¢ã€‚

`å›ç­”æ€è·¯ï¼š`
	1. Exceptionå’ŒErroréƒ½å±äºThrowableç±»çš„å­ç±»
	2. Exceptionæ˜¯ç¨‹åºå¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼ŒErroræ˜¯ç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ï¼›
	3. Exceptionåˆ†ä¸ºå—æ£€ï¼ˆéœ€è¦å¤„ç†ï¼‰å’Œéå—æ£€å¼‚å¸¸ï¼ˆå¯ä»¥ä¸å¤„ç†ï¼‰
## 2 å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**Checked Exception**Â å³ å—æ£€æŸ¥å¼‚å¸¸ ï¼ŒJava ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå—æ£€æŸ¥å¼‚å¸¸æ²¡æœ‰è¢«Â `catch`æˆ–è€…`throws`Â å…³é”®å­—å¤„ç†çš„è¯ï¼Œå°±æ²¡åŠæ³•é€šè¿‡ç¼–è¯‘ã€‚

æ¯”å¦‚ä¸‹é¢è¿™æ®µ IO æ“ä½œçš„ä»£ç ï¼š
![|380](https://my-obsidian-image.oss-cn-guangzhou.aliyuncs.com/2024/04/0f7a765da5ad8c0eacdc76f7e6d3b6a8.png)

é™¤äº†`RuntimeException`åŠå…¶å­ç±»ä»¥å¤–ï¼Œå…¶ä»–çš„`Exception`ç±»åŠå…¶å­ç±»éƒ½å±äºå—æ£€æŸ¥å¼‚å¸¸ ã€‚å¸¸è§çš„å—æ£€æŸ¥å¼‚å¸¸æœ‰ï¼šIO ç›¸å…³çš„å¼‚å¸¸ã€`ClassNotFoundException`ã€`SQLException`...ã€‚

**Unchecked Exception** å³ **ä¸å—æ£€æŸ¥å¼‚å¸¸** ï¼ŒJava ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ ï¼Œæˆ‘ä»¬å³ä½¿ä¸å¤„ç†ä¸å—æ£€æŸ¥å¼‚å¸¸ä¹Ÿå¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ã€‚

`RuntimeException` åŠå…¶å­ç±»éƒ½ç»Ÿç§°ä¸ºéå—æ£€æŸ¥å¼‚å¸¸ï¼Œå¸¸è§çš„æœ‰ï¼ˆå»ºè®®è®°ä¸‹æ¥ï¼Œæ—¥å¸¸å¼€å‘ä¸­ä¼šç»å¸¸ç”¨åˆ°ï¼‰ï¼š

- `NullPointerException`(ç©ºæŒ‡é’ˆé”™è¯¯)
- `IllegalArgumentException`(å‚æ•°é”™è¯¯æ¯”å¦‚æ–¹æ³•å…¥å‚ç±»å‹é”™è¯¯)
- `NumberFormatException`ï¼ˆå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ ¼å¼é”™è¯¯ï¼Œ`IllegalArgumentException`çš„å­ç±»ï¼‰
- `ArrayIndexOutOfBoundsException`ï¼ˆæ•°ç»„è¶Šç•Œé”™è¯¯ï¼‰
- `ClassCastException`ï¼ˆç±»å‹è½¬æ¢é”™è¯¯ï¼‰
- `ArithmeticException`ï¼ˆç®—æœ¯é”™è¯¯ï¼‰
- `SecurityException` ï¼ˆå®‰å…¨é”™è¯¯æ¯”å¦‚æƒé™ä¸å¤Ÿï¼‰
- `UnsupportedOperationException`(ä¸æ”¯æŒçš„æ“ä½œé”™è¯¯æ¯”å¦‚é‡å¤åˆ›å»ºåŒä¸€ç”¨æˆ·)
- â€¦â€¦

`å›ç­”æ€è·¯ï¼š`
	1. å—æ£€å¼‚å¸¸æ˜¯éœ€è¦å¤„ç†çš„ï¼Œä¸å¤„ç†ä¼šå¯¼è‡´ä»£ç ç¼–è¯‘ä¸è¿‡ï¼›
	2. éå—æ£€å¼‚å¸¸å¯ä»¥å¤„ç†ï¼Œä¹Ÿå¯ä»¥ä¸å¤„ç†ï¼Œä¸»è¦æ˜¯RuntimeExceptionç±»åŠå…¶å­ç±»ï¼›
	3. å¸¸è§çš„éå—æ£€å¼‚å¸¸æœ‰ï¼šç©ºæŒ‡é’ˆã€è„šæ ‡è¶Šç•Œã€ç±»å‹è½¬æ¢é”™è¯¯ã€ç®—æœ¯é”™è¯¯ã€å‚æ•°é”™è¯¯ç­‰
## 3 Throwableç±»å¸¸ç”¨çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ

- `String getMessage()`: è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„ç®€è¦æè¿°
- `String toString()`: è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„è¯¦ç»†ä¿¡æ¯
- `String getLocalizedMessage()`: è¿”å›å¼‚å¸¸å¯¹è±¡çš„æœ¬åœ°åŒ–ä¿¡æ¯ã€‚ä½¿ç”¨ `Throwable` çš„å­ç±»è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”Ÿæˆæœ¬åœ°åŒ–ä¿¡æ¯ã€‚å¦‚æœå­ç±»æ²¡æœ‰è¦†ç›–è¯¥æ–¹æ³•ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å›çš„ä¿¡æ¯ä¸ `getMessage()`è¿”å›çš„ç»“æœç›¸åŒ
- `void printStackTrace()`: åœ¨æ§åˆ¶å°ä¸Šæ‰“å° `Throwable` å¯¹è±¡å°è£…çš„å¼‚å¸¸ä¿¡æ¯

`å›ç­”æ€è·¯ï¼š`
	getMessageï¼ˆç®€è¦ä¿¡æ¯ï¼‰ã€toStringï¼ˆè¯¦ç»†ä¿¡æ¯ï¼‰ã€getLocalizedMessageã€ï¼ˆæœ¬åœ°ä¿¡æ¯ï¼Œå¯ä»¥è¦†å†™ï¼‰printStackTraceï¼ˆçˆ¶ç±»å°è£…çš„å¼‚å¸¸ä¿¡æ¯ï¼‰
## 4 try-catch-Finallyå¦‚ä½•ä½¿ç”¨

- `try`å—ï¼šç”¨äºæ•è·å¼‚å¸¸ã€‚å…¶åå¯æ¥é›¶ä¸ªæˆ–å¤šä¸ª `catch` å—ï¼Œå¦‚æœæ²¡æœ‰ `catch` å—ï¼Œåˆ™å¿…é¡»è·Ÿä¸€ä¸ª `finally` å—ã€‚
- `catch`å—ï¼šç”¨äºå¤„ç† try æ•è·åˆ°çš„å¼‚å¸¸ã€‚
- `finally` å—ï¼šæ— è®ºæ˜¯å¦æ•è·æˆ–å¤„ç†å¼‚å¸¸ï¼Œ`finally` å—é‡Œçš„è¯­å¥éƒ½ä¼šè¢«æ‰§è¡Œã€‚å½“åœ¨ `try` å—æˆ– `catch` å—ä¸­é‡åˆ° `return` è¯­å¥æ—¶ï¼Œ`finally` è¯­å¥å—å°†åœ¨æ–¹æ³•è¿”å›ä¹‹å‰è¢«æ‰§è¡Œã€‚

ä»£ç ç¤ºä¾‹ï¼š

```java
try {
    System.out.println("Try to do something");
    throw new RuntimeException("RuntimeException");
} catch (Exception e) {
    System.out.println("Catch Exception -> " + e.getMessage());
} finally {
    System.out.println("Finally");
}
```

è¾“å‡ºï¼š

```plain
Try to do something
Catch Exception -> RuntimeException
Finally
```

**æ³¨æ„ï¼šä¸è¦åœ¨ finally è¯­å¥å—ä¸­ä½¿ç”¨ return!** å½“ try è¯­å¥å’Œ finally è¯­å¥ä¸­éƒ½æœ‰ return è¯­å¥æ—¶ï¼Œtry è¯­å¥å—ä¸­çš„ return è¯­å¥ä¼šè¢«å¿½ç•¥ã€‚è¿™æ˜¯å› ä¸º try è¯­å¥ä¸­çš„ return è¿”å›å€¼ä¼šå…ˆè¢«æš‚å­˜åœ¨ä¸€ä¸ªæœ¬åœ°å˜é‡ä¸­ï¼Œå½“æ‰§è¡Œåˆ° finally è¯­å¥ä¸­çš„ return ä¹‹åï¼Œè¿™ä¸ªæœ¬åœ°å˜é‡çš„å€¼å°±å˜ä¸ºäº† finally è¯­å¥ä¸­çš„ return è¿”å›å€¼ã€‚

[jvm å®˜æ–¹æ–‡æ¡£open in new window](https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.10.2.5)ä¸­æœ‰æ˜ç¡®æåˆ°ï¼š

> If the `try` clause executes a _return_, the compiled code does the following:
> 
> 1. Saves the return value (if any) in a local variable.
> 2. Executes a _jsr_ to the code for the `finally` clause.
> 3. Upon return from the `finally` clause, returns the value saved in the local variable.

ä»£ç ç¤ºä¾‹ï¼š

```java
public static void main(String[] args) {
    System.out.println(f(2));
}

public static int f(int value) {
    try {
        return value * value;
    } finally {
        if (value == 2) {
            return 0;
        }
    }
}
```

è¾“å‡ºï¼š

```plain
0
```

`å›ç­”æ€è·¯ï¼š`
	1. tryä¸»è¦ç”¨äºåŒ…æ‹¬ä¼šå‘ç”Ÿå¼‚å¸¸çš„ä»£ç ï¼Œåé¢å¯ä»¥æ¥ä¸€ä¸ªæˆ–å¤šä¸ªcatch
	2. catchä¸»è¦å¤„ç†tryä¸­å‘ç”Ÿçš„å¼‚å¸¸
	3. æ— è®ºtryè¿˜æ˜¯catchï¼Œfinallyéƒ½ä¼šåœ¨æ–¹æ³•è¿”å›ï¼ˆtryæˆ–è€…catchç»“æŸï¼‰å‰è¢«æ‰§è¡Œï¼ˆæ³¨æ„finallyä¸è¦ä½¿ç”¨returnï¼‰
## 5 finallyä¸­çš„ä»£ç ä¸€å®šä¼šæ‰§è¡Œå—ï¼Ÿ

ä¸ä¸€å®šçš„ï¼åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œfinally ä¸­çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œã€‚

å°±æ¯”å¦‚è¯´ finally ä¹‹å‰è™šæ‹Ÿæœºè¢«ç»ˆæ­¢è¿è¡Œçš„è¯ï¼Œfinally ä¸­çš„ä»£ç å°±ä¸ä¼šè¢«æ‰§è¡Œã€‚

```java
try {
    System.out.println("Try to do something");
    throw new RuntimeException("RuntimeException");
} catch (Exception e) {
    System.out.println("Catch Exception -> " + e.getMessage());
    // ç»ˆæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„Javaè™šæ‹Ÿæœº
    System.exit(1);
} finally {
    System.out.println("Finally");
}
```

è¾“å‡ºï¼š

```plain
Try to do something
Catch Exception -> RuntimeException
```

å¦å¤–ï¼Œåœ¨ä»¥ä¸‹ 2 ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œ`finally`Â å—çš„ä»£ç ä¹Ÿä¸ä¼šè¢«æ‰§è¡Œï¼š

1. ç¨‹åºæ‰€åœ¨çš„çº¿ç¨‹æ­»äº¡ã€‚
2. å…³é—­ CPUã€‚

`å›ç­”æ€è·¯ï¼š`
	1. æ­£å¸¸æƒ…å†µä¸‹ï¼Œfinallyä¸€å®šä¼šè¢«æ‰§è¡Œï¼›
	2. å¦‚æœtryæˆ–catchæœ‰`System.exit()`ï¼Œå°±ä¸ä¼šè¢«æ‰§è¡Œ
	3. è¿˜æœ‰çš„æ˜¯`ç¨‹åºæ‰€åœ¨çº¿ç¨‹æ­»äº¡`ï¼Œæˆ–è€…`å…³é—­CPU`ï¼Œä¹Ÿä¸ä¼šè¢«æ‰§è¡Œ
## 6 å¦‚ä½•ä½¿ç”¨try-with-resourcesä»£æ›¿try-catch-finallyï¼Ÿ

1. **é€‚ç”¨èŒƒå›´ï¼ˆèµ„æºçš„å®šä¹‰ï¼‰ï¼š** ä»»ä½•å®ç° `java.lang.AutoCloseable`æˆ–è€… `java.io.Closeable` çš„å¯¹è±¡
2. **å…³é—­èµ„æºå’Œ finally å—çš„æ‰§è¡Œé¡ºåºï¼š** åœ¨ `try-with-resources` è¯­å¥ä¸­ï¼Œä»»ä½• catch æˆ– finally å—åœ¨å£°æ˜çš„èµ„æºå…³é—­åè¿è¡Œ

ã€ŠEffective Javaã€‹ä¸­æ˜ç¡®æŒ‡å‡ºï¼š

> é¢å¯¹å¿…é¡»è¦å…³é—­çš„èµ„æºï¼Œæˆ‘ä»¬æ€»æ˜¯åº”è¯¥ä¼˜å…ˆä½¿ç”¨ `try-with-resources` è€Œä¸æ˜¯`try-finally`ã€‚éšä¹‹äº§ç”Ÿçš„ä»£ç æ›´ç®€çŸ­ï¼Œæ›´æ¸…æ™°ï¼Œäº§ç”Ÿçš„å¼‚å¸¸å¯¹æˆ‘ä»¬ä¹Ÿæ›´æœ‰ç”¨ã€‚`try-with-resources`è¯­å¥è®©æˆ‘ä»¬æ›´å®¹æ˜“ç¼–å†™å¿…é¡»è¦å…³é—­çš„èµ„æºçš„ä»£ç ï¼Œè‹¥é‡‡ç”¨`try-finally`åˆ™å‡ ä¹åšä¸åˆ°è¿™ç‚¹ã€‚

Java ä¸­ç±»ä¼¼äº`InputStream`ã€`OutputStream`ã€`Scanner`ã€`PrintWriter`ç­‰çš„èµ„æºéƒ½éœ€è¦æˆ‘ä»¬è°ƒç”¨`close()`æ–¹æ³•æ¥æ‰‹åŠ¨å…³é—­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡`try-catch-finally`è¯­å¥æ¥å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œå¦‚ä¸‹ï¼š

```java
//è¯»å–æ–‡æœ¬æ–‡ä»¶çš„å†…å®¹
Scanner scanner = null;
try {
    scanner = new Scanner(new File("D://read.txt"));
    while (scanner.hasNext()) {
        System.out.println(scanner.nextLine());
    }
} catch (FileNotFoundException e) {
    e.printStackTrace();
} finally {
    if (scanner != null) {
        scanner.close();
    }
}
```

ä½¿ç”¨ Java 7 ä¹‹åçš„ `try-with-resources` è¯­å¥æ”¹é€ ä¸Šé¢çš„ä»£ç :

```java
try (Scanner scanner = new Scanner(new File("test.txt"))) {
    while (scanner.hasNext()) {
        System.out.println(scanner.nextLine());
    }
} catch (FileNotFoundException fnfe) {
    fnfe.printStackTrace();
}
```
å½“ç„¶å¤šä¸ªèµ„æºéœ€è¦å…³é—­çš„æ—¶å€™ï¼Œä½¿ç”¨ `try-with-resources` å®ç°èµ·æ¥ä¹Ÿéå¸¸ç®€å•ï¼Œå¦‚æœä½ è¿˜æ˜¯ç”¨`try-catch-finally`å¯èƒ½ä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ã€‚

é€šè¿‡ä½¿ç”¨åˆ†å·åˆ†éš”ï¼Œå¯ä»¥åœ¨`try-with-resources`å—ä¸­å£°æ˜å¤šä¸ªèµ„æºã€‚

```java
try (BufferedInputStream bin = new BufferedInputStream(new FileInputStream(new File("test.txt")));
     BufferedOutputStream bout = new BufferedOutputStream(new FileOutputStream(new File("out.txt")))) {
    int b;
    while ((b = bin.read()) != -1) {
        bout.write(b);
    }
}
catch (IOException e) {
    e.printStackTrace();
}
```

`å›ç­”æ€è·¯ï¼š`
	1. é€‚ç”¨èµ„æºï¼šä»»ä½•å®ç°AutoCloseableæ¥å£æˆ–Closeableæ¥å£çš„ç±»çš„å¯¹è±¡ï¼›
	2. ä¼šåœ¨å…³é—­èµ„æºåï¼Œæ‰§è¡Œcatchæˆ–finallyï¼›
	3. åœ¨tryåå¡«ä¸€ä¸ªæ‹¬å·ï¼Œæ‹¬å·å†…åŒ…å«tryä»£ç å—ä¸­éœ€è¦çš„èµ„æºå³å¯ï¼›

## 7 å¼‚å¸¸ä½¿ç”¨æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ

`å›ç­”æ€è·¯ï¼š`
	1. ä¸èƒ½æŠŠå¼‚å¸¸`å®šä¹‰ä¸ºé™æ€å˜é‡`ï¼Œæ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥newä¸€ä¸ªå³å¯ï¼›
	2. æŠ›å‡ºçš„å¼‚å¸¸ä¸€å®šè¦`æœ‰æ„ä¹‰ï¼Œæ›´åŠ å…·ä½“`ï¼›
	3. ä½¿ç”¨`æ—¥å¿—æ‰“å°`å°±ä¸è¦æŠ›å‡ºå¼‚å¸¸äº†ï¼›